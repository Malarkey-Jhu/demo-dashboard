!(function(){var z_=(Qt,re,U)=>new Promise((ee,ve)=>{var _=he=>{try{Z(U.next(he))}catch(ce){ve(ce)}},fe=he=>{try{Z(U.throw(he))}catch(ce){ve(ce)}},Z=he=>he.done?ee(he.value):Promise.resolve(he.value).then(_,fe);Z((U=U.apply(Qt,re)).next())});(self.webpackChunkalluxio_dashboard=self.webpackChunkalluxio_dashboard||[]).push([[422],{67880:function(Qt,re){"use strict";var U={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M912 190h-69.9c-9.8 0-19.1 4.5-25.1 12.2L404.7 724.5 207 474a32 32 0 00-25.1-12.2H112c-6.7 0-10.4 7.7-6.3 12.9l273.9 347c12.8 16.2 37.4 16.2 50.3 0l488.4-618.9c4.1-5.1.4-12.8-6.3-12.8z"}}]},name:"check",theme:"outlined"};re.Z=U},63374:function(Qt,re){"use strict";var U={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M482 152h60q8 0 8 8v704q0 8-8 8h-60q-8 0-8-8V160q0-8 8-8z"}},{tag:"path",attrs:{d:"M192 474h672q8 0 8 8v60q0 8-8 8H160q-8 0-8-8v-60q0-8 8-8z"}}]},name:"plus",theme:"outlined"};re.Z=U},76388:function(Qt,re,U){"use strict";var ee=U(27263),ve=U(50959),_=U(67880),fe=U(30961),Z=function(ce,Ge){return ve.createElement(fe.Z,(0,ee.Z)({},ce,{ref:Ge,icon:_.Z}))};re.Z=ve.forwardRef(Z)},14790:function(Qt,re,U){"use strict";var ee=U(27263),ve=U(50959),_=U(63374),fe=U(30961),Z=function(ce,Ge){return ve.createElement(fe.Z,(0,ee.Z)({},ce,{ref:Ge,icon:_.Z}))};re.Z=ve.forwardRef(Z)},54564:function(Qt,re,U){"use strict";var ee=U(50959),ve=U(55989),_=function(){return _=Object.assign||function(Z){for(var he,ce=1,Ge=arguments.length;ce<Ge;ce++){he=arguments[ce];for(var oe in he)Object.prototype.hasOwnProperty.call(he,oe)&&(Z[oe]=he[oe])}return Z},_.apply(this,arguments)},fe=function(Z){return ee.createElement(ve.P,_({},Z,{chartType:"Gauge"}))};re.Z=fe},49708:function(Qt,re,U){"use strict";var ee=U(50959),ve=U(55989),_=function(){return _=Object.assign||function(Z){for(var he,ce=1,Ge=arguments.length;ce<Ge;ce++){he=arguments[ce];for(var oe in he)Object.prototype.hasOwnProperty.call(he,oe)&&(Z[oe]=he[oe])}return Z},_.apply(this,arguments)},fe=function(Z){return ee.createElement(ve.P,_({},Z,{chartType:"Liquid"}))};re.Z=fe},86e3:function(Qt,re,U){"use strict";var ee=U(50959),ve=U(55989),_=function(){return _=Object.assign||function(Z){for(var he,ce=1,Ge=arguments.length;ce<Ge;ce++){he=arguments[ce];for(var oe in he)Object.prototype.hasOwnProperty.call(he,oe)&&(Z[oe]=he[oe])}return Z},_.apply(this,arguments)},fe=function(Z){return ee.createElement(ve.P,_({},Z,{chartType:"WordCloud"}))};re.Z=fe},9037:function(Qt,re,U){"use strict";U.d(re,{S:function(){return ce}});var ee=U(35361),ve=U(56929),_=U(38631),fe=U(50959),Z=U(11527),he=["isLoading","pastDelay","timedOut","error","retry"],ce=function(oe){var We=oe.isLoading,qe=oe.pastDelay,pt=oe.timedOut,vt=oe.error,bt=oe.retry,Et=(0,ve.Z)(oe,he);return(0,Z.jsx)("div",{style:{paddingBlockStart:100,textAlign:"center"},children:(0,Z.jsx)(_.Z,(0,ee.Z)({size:"large"},Et))})}},95460:function(){window._iconfont_svg_string_3580659='<svg><symbol id="l7-icon-area1" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.064889 219.136l38.798223 466.261333a113.777778 113.777778 0 1 1-133.518223 145.237334H279.210667a113.777778 113.777778 0 1 1-60.302223-137.272889L697.856 227.555556A113.777778 113.777778 0 0 1 796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m577.592889-534.072889L269.198222 796.444444c4.152889 7.168 7.509333 14.791111 10.012445 22.812445h465.578666a114.119111 114.119111 0 0 1 65.479111-71.224889l-38.798222-466.261333a112.924444 112.924444 0 0 1-23.210666-7.964445zM796.444444 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-area" viewBox="0 0 1024 1024"><path d="M796.444444 56.888889a113.777778 113.777778 0 0 1 43.008 219.136l38.855112 466.261333a113.777778 113.777778 0 0 1-16.497778 224.540445L853.333333 967.111111a113.777778 113.777778 0 0 1-108.544-79.644444H279.210667a113.834667 113.834667 0 0 1-100.067556 79.36L170.666667 967.111111a113.777778 113.777778 0 0 1-17.066667-226.304l30.492444-351.175111a113.777778 113.777778 0 0 1 34.986667-218.680889L227.555556 170.666667a113.777778 113.777778 0 0 1 99.896888 59.221333l355.84-71.395556a113.777778 113.777778 0 0 1 104.675556-101.262222L796.444444 56.888889z m56.888889 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-682.666666 0a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m526.051555-582.314666L340.650667 296.903111a113.891556 113.891556 0 0 1-88.462223 98.645333l-30.947555 355.84c27.477333 13.653333 48.64 38.115556 58.026667 67.754667h465.521777a114.119111 114.119111 0 0 1 65.536-71.168l-38.855111-466.261333a113.948444 113.948444 0 0 1-74.752-56.206222zM227.555556 238.933333a45.511111 45.511111 0 1 0 0 91.022223 45.511111 45.511111 0 0 0 0-91.022223z m568.888888-113.777777a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-delete" viewBox="0 0 1024 1024"><path d="M705.422222 85.333333a34.133333 34.133333 0 0 1 34.133334 34.133334V227.555556h136.533333a34.133333 34.133333 0 0 1 0 68.266666h-25.543111l-24.348445 610.076445a34.133333 34.133333 0 0 1-34.133333 32.768H231.936a34.133333 34.133333 0 0 1-34.076444-32.768L173.340444 295.822222H147.911111a34.133333 34.133333 0 1 1 0-68.266666H284.444444V119.466667a34.133333 34.133333 0 0 1 34.133334-34.133334h386.844444zM241.720889 295.822222l22.983111 574.577778h494.535111l23.04-574.577778H241.720889zM671.288889 153.6H352.711111V227.555556h318.577778V153.6z"  ></path></symbol><symbol id="l7-icon-color" viewBox="0 0 1024 1024"><path d="M512 56.888889c9.841778 0 19.626667 0.341333 29.354667 0.910222 69.176889 4.437333 119.068444 62.577778 124.302222 131.072l0.455111 9.386667c0.739556 44.600889 15.303111 84.935111 44.999111 114.631111 27.022222 27.022222 62.805333 41.528889 102.570667 44.430222l12.060444 0.568889c72.476444 1.194667 135.793778 52.451556 140.458667 124.757333 1.137778 18.261333 1.251556 36.807111 0.170667 55.637334-13.198222 233.585778-211.399111 424.220444-445.326223 428.714666L512 967.111111a455.111111 455.111111 0 0 1-455.054222-464.156444c4.551111-233.927111 195.185778-432.128 428.771555-445.326223C494.535111 57.116444 503.296 56.888889 512 56.888889z m0 68.266667a385.706667 385.706667 0 0 0-22.414222 0.625777C291.726222 136.988444 129.080889 305.948444 125.155556 504.263111c-4.152889 212.366222 163.100444 387.185778 372.508444 394.353778l13.425778 0.227555 8.533333-0.113777c198.371556-3.811556 367.331556-166.456889 378.538667-364.373334a396.174222 396.174222 0 0 0-0.170667-47.331555c-1.991111-31.232-29.127111-56.604444-67.128889-60.472889l-8.248889-0.455111-14.051555-0.682667c-56.547556-4.209778-107.406222-25.884444-145.806222-64.284444-38.855111-38.798222-60.416-90.225778-64.284445-145.749334l-0.910222-21.333333c-2.901333-38.001778-28.785778-66.048-60.302222-68.096A433.891556 433.891556 0 0 0 512 125.155556zM438.044444 682.666667a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m-170.666666-227.555556a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z m142.222222-227.555555a68.266667 68.266667 0 1 1 0 136.533333 68.266667 68.266667 0 0 1 0-136.533333z"  ></path></symbol><symbol id="l7-icon-base-map" viewBox="0 0 1024 1024"><path d="M923.761778 115.029333A34.133333 34.133333 0 0 1 967.111111 147.911111v624.128a34.133333 34.133333 0 0 1-22.186667 32.028445l-278.755555 103.992888a34.133333 34.133333 0 0 1-23.665778 0.056889L381.724444 812.714667a34.133333 34.133333 0 0 0-23.665777 0.113777L102.968889 908.060444a34.133333 34.133333 0 0 1-45.738667-26.965333L56.888889 876.088889V251.960889a34.133333 34.133333 0 0 1 22.186667-32.028445l278.755555-103.992888a34.133333 34.133333 0 0 1 20.992-0.967112l266.183111 72.988445a34.133333 34.133333 0 0 0 18.204445 0zM403.911111 192.625778v555.576889l216.177778 79.075555V251.960889l-216.177778-59.335111z m-68.266667 4.380444L125.155556 275.569778v551.310222l210.432-78.506667V197.006222zM898.844444 192.853333l-210.545777 58.936889v575.089778l210.545777-78.563556V192.853333z"  ></path></symbol><symbol id="l7-icon-dot" viewBox="0 0 1024 1024"><path d="M341.333333 739.555556a113.777778 113.777778 0 0 1 8.533334 227.271111L341.333333 967.111111a113.777778 113.777778 0 0 1-8.533333-227.271111L341.333333 739.555556z m0 68.266666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM910.222222 341.333333a113.777778 113.777778 0 0 1 8.533334 227.271111L910.222222 568.888889a113.777778 113.777778 0 0 1-8.533333-227.271111L910.222222 341.333333z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM227.555556 56.888889a113.777778 113.777778 0 0 1 8.533333 227.271111L227.555556 284.444444a113.777778 113.777778 0 0 1-8.533334-227.271111L227.555556 56.888889z m0 68.266667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-display" viewBox="0 0 1024 1024"><path d="M512 170.666667c284.444444 0 455.111111 227.555556 455.111111 341.333333s-170.666667 341.333333-455.111111 341.333333-455.111111-227.555556-455.111111-341.333333 170.666667-341.333333 455.111111-341.333333z m0 68.266666C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 110.762667 178.574222 273.066667 386.844444 273.066667s386.844444-162.304 386.844444-273.066667c0-110.762667-178.574222-273.066667-386.844444-273.066667zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-enlarge" viewBox="0 0 1024 1024"><path d="M546.133333 147.911111l-0.056889 329.955556H876.088889a34.133333 34.133333 0 0 1 0 68.266666H546.076444v329.955556a34.133333 34.133333 0 0 1-68.266666 0V546.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h329.898667V147.911111a34.133333 34.133333 0 0 1 68.266666 0z"  ></path></symbol><symbol id="l7-icon-export-picture" viewBox="0 0 1024 1024"><path d="M883.873684 161.684211a32.336842 32.336842 0 0 1 32.336842 32.336842v582.063158a32.336842 32.336842 0 0 1-32.336842 32.336842H86.231579a32.336842 32.336842 0 0 1-32.336842-32.336842V194.021053a32.336842 32.336842 0 0 1 32.336842-32.336842h797.642105z m-32.336842 64.673684H118.568421v517.389473h170.792421a32.175158 32.175158 0 0 1 0.431158-0.646736l3.772632-4.473264 330.320842-330.374736a32.336842 32.336842 0 0 1 38.588631-5.389474l4.473263 3.018105 184.589474 147.725474V226.357895z m-202.428631 248.131368L379.850105 743.747368H851.536842v-107.304421l-202.428631-161.953684zM323.368421 323.368421a107.789474 107.789474 0 1 1 0 215.578947 107.789474 107.789474 0 0 1 0-215.578947z m0 64.673684a43.115789 43.115789 0 1 0 0 86.231579 43.115789 43.115789 0 0 0 0-86.231579z"  ></path></symbol><symbol id="l7-icon-exit-fullscreen" viewBox="0 0 1024 1024"><path d="M841.955556 591.644444a34.133333 34.133333 0 0 1 5.518222 67.811556l-5.518222 0.455111h-133.745778l192 192.056889a34.133333 34.133333 0 0 1-38.343111 55.182222l-5.176889-2.958222-4.721778-3.982222L659.911111 708.266667V841.955556a34.133333 34.133333 0 0 1-28.615111 33.678222L625.777778 876.088889a34.133333 34.133333 0 0 1-33.678222-28.615111L591.644444 841.955556V625.777778a34.133333 34.133333 0 0 1 28.615112-33.678222L625.777778 591.644444h216.177778z m-443.733334 0a34.133333 34.133333 0 0 1 33.678222 28.615112L432.355556 625.777778v216.177778a34.133333 34.133333 0 0 1-67.811556 5.518222L364.088889 841.955556v-133.745778l-192.056889 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L315.847111 659.911111H182.044444a34.133333 34.133333 0 0 1-33.678222-28.615111L147.911111 625.777778a34.133333 34.133333 0 0 1 28.615111-33.678222L182.044444 591.644444H398.222222zM167.310222 119.808l4.721778 3.982222L364.088889 315.847111V182.044444a34.133333 34.133333 0 0 1 28.615111-33.678222L398.222222 147.911111a34.133333 34.133333 0 0 1 33.678222 28.615111L432.355556 182.044444V398.222222a34.133333 34.133333 0 0 1-28.615112 33.678222L398.222222 432.355556H182.044444a34.133333 34.133333 0 0 1-5.518222-67.811556L182.044444 364.088889h133.802667L123.790222 172.032a34.133333 34.133333 0 0 1 43.52-52.224z m732.899556 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L708.266667 364.088889H841.955556a34.133333 34.133333 0 0 1 33.678222 28.615111L876.088889 398.222222a34.133333 34.133333 0 0 1-28.615111 33.678222L841.955556 432.355556H625.777778a34.133333 34.133333 0 0 1-33.678222-28.615112L591.644444 398.222222V182.044444a34.133333 34.133333 0 0 1 67.811556-5.518222l0.455111 5.518222v133.802667l192.056889-192.056889a34.133333 34.133333 0 0 1 48.241778 0z"  ></path></symbol><symbol id="l7-icon-line" viewBox="0 0 1024 1024"><path d="M853.333333 56.888889a113.777778 113.777778 0 0 1 8.533334 227.271111L853.333333 284.444444c-19.000889 0-36.864-4.664889-52.622222-12.856888l-529.123555 529.066666a113.777778 113.777778 0 0 1-92.387556 166.115556L170.666667 967.111111a113.777778 113.777778 0 0 1-8.533334-227.271111L170.666667 739.555556c19.000889 0 36.864 4.664889 52.622222 12.856888l529.123555-529.066666a113.777778 113.777778 0 0 1 92.387556-166.115556L853.333333 56.888889zM170.666667 807.822222a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m682.666666-682.666666a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-layer" viewBox="0 0 1024 1024"><path d="M767.089778 625.777778l180.167111 82.773333a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730667-420.977778 193.422222a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422222a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730667L256.853333 625.777778l81.749334 37.546666L172.771556 739.555556 512 895.374222 851.171556 739.555556l-165.831112-76.231112 81.749334-37.546666z m0-227.555556l180.167111 82.773334a34.133333 34.133333 0 0 1 4.892444 59.278222l-4.892444 2.730666-420.977778 193.422223a34.133333 34.133333 0 0 1-22.983111 1.991111l-5.575111-1.991111-420.977778-193.422223a34.133333 34.133333 0 0 1-4.892444-59.278222l4.892444-2.730666L256.853333 398.222222l81.749334 37.546667-165.831111 76.174222L512 667.818667l339.171556-155.875556-165.831112-76.174222L767.089778 398.222222zM497.720889 60.017778a34.133333 34.133333 0 0 1 28.558222 0l420.977778 193.422222a34.133333 34.133333 0 0 1 0 62.008889l-420.977778 193.422222a34.133333 34.133333 0 0 1-28.558222 0l-420.977778-193.422222a34.133333 34.133333 0 0 1 0-62.008889zM512 128.568889L172.771556 284.387556 512 440.263111l339.171556-155.875555L512 128.568889z"  ></path></symbol><symbol id="l7-icon-narrow" viewBox="0 0 1024 1024"><path d="M910.222222 512a34.133333 34.133333 0 0 1-34.133333 34.133333H147.911111a34.133333 34.133333 0 1 1 0-68.266666h728.177778a34.133333 34.133333 0 0 1 34.133333 34.133333z"  ></path></symbol><symbol id="l7-icon-fullscreen" viewBox="0 0 1024 1024"><path d="M645.176889 597.674667l4.721778 3.982222L841.955556 793.6l0.056888-133.688889a34.133333 34.133333 0 0 1 28.615112-33.678222L876.088889 625.777778a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 659.911111v216.177778a34.133333 34.133333 0 0 1-28.615111 33.678222L876.088889 910.222222h-216.177778a34.133333 34.133333 0 0 1-5.518222-67.811555l5.518222-0.455111h133.745778l-192-192.056889a34.133333 34.133333 0 0 1 43.52-52.224z m-222.833778 3.982222a34.133333 34.133333 0 0 1 3.982222 43.52l-3.982222 4.721778L230.286222 841.955556H364.088889a34.133333 34.133333 0 0 1 33.678222 28.615111L398.222222 876.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L364.088889 910.222222H147.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 876.088889v-216.177778a34.133333 34.133333 0 0 1 67.811555-5.518222l0.455111 5.518222-0.056888 133.745778 192.113777-192a34.133333 34.133333 0 0 1 48.241778 0zM364.088889 113.777778a34.133333 34.133333 0 0 1 5.518222 67.811555L364.088889 182.044444H230.343111l192 192.056889a34.133333 34.133333 0 0 1-43.52 52.224l-4.721778-3.982222-192.113777-192.056889L182.044444 364.088889a34.133333 34.133333 0 0 1-28.615111 33.678222L147.911111 398.222222a34.133333 34.133333 0 0 1-33.678222-28.615111L113.777778 364.088889V147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L147.911111 113.777778h216.177778z m512 0a34.133333 34.133333 0 0 1 33.678222 28.615111L910.222222 147.911111v216.177778a34.133333 34.133333 0 0 1-67.811555 5.518222L841.955556 364.088889l-0.056889-133.745778-192 192a34.133333 34.133333 0 0 1-52.224-43.52l3.982222-4.721778L793.6 182.044444H659.911111a34.133333 34.133333 0 0 1-33.678222-28.615111L625.777778 147.911111a34.133333 34.133333 0 0 1 28.615111-33.678222L659.911111 113.777778h216.177778z"  ></path></symbol><symbol id="l7-icon-hide" viewBox="0 0 1024 1024"><path d="M875.52 87.836444a34.133333 34.133333 0 0 1 7.281778 43.121778l-3.527111 5.006222-682.666667 796.444445a34.133333 34.133333 0 0 1-55.409778-39.367111l3.527111-5.006222 97.166223-113.379556C123.164444 697.969778 56.888889 582.940444 56.888889 512c0-113.777778 170.666667-341.333333 455.111111-341.333333a496.64 496.64 0 0 1 208.952889 45.112889l106.439111-124.188445a34.133333 34.133333 0 0 1 48.128-3.754667z m-38.684444 202.524445C921.031111 362.951111 967.111111 452.835556 967.111111 512c0 113.777778-170.666667 341.333333-455.111111 341.333333-50.631111 0-97.678222-7.224889-140.8-19.740444l50.232889-58.595556A417.393778 417.393778 0 0 0 512 785.066667c208.270222 0 386.844444-162.304 386.844444-273.066667 0-52.849778-40.675556-117.418667-105.813333-170.496l43.804445-51.2zM512 238.933333C303.729778 238.933333 125.155556 401.237333 125.155556 512c0 66.787556 64.853333 152.291556 162.133333 209.692444L377.173333 616.675556a170.666667 170.666667 0 0 1 217.713778-253.895112l78.620445-91.704888A432.924444 432.924444 0 0 0 512 238.933333z m166.684444 236.088889a170.666667 170.666667 0 0 1-177.664 207.303111l177.607112-207.303111zM512 409.6a102.4 102.4 0 0 0-88.746667 153.486222L548.864 416.426667A102.172444 102.172444 0 0 0 512 409.6z"  ></path></symbol><symbol id="l7-icon-rectangle" viewBox="0 0 1024 1024"><path d="M170.666667 56.888889a113.777778 113.777778 0 0 1 108.544 79.644444H853.333333a34.133333 34.133333 0 0 1 33.678223 28.615111L887.466667 170.666667v574.122666a113.777778 113.777778 0 1 1-142.677334 142.734223L170.666667 887.466667a34.133333 34.133333 0 0 1-33.678223-28.615111L136.533333 853.333333V279.210667A113.777778 113.777778 0 0 1 170.666667 56.888889z m682.666666 750.933333a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z m-34.133333-603.022222H279.210667a114.062222 114.062222 0 0 1-74.353778 74.410667L204.8 819.2h539.989333a114.062222 114.062222 0 0 1 74.410667-74.410667V204.8zM170.666667 125.155556a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-ranging" viewBox="0 0 1024 1024"><path d="M723.171556 50.403556l250.424888 250.424888a31.061333 31.061333 0 0 1 0 43.918223L344.746667 973.596444a31.061333 31.061333 0 0 1-43.918223 0L50.403556 723.171556a31.061333 31.061333 0 0 1 0-43.918223L679.253333 50.403556a31.061333 31.061333 0 0 1 43.918223 0z m-21.959112 74.524444l-39.765333 39.822222 98.986667 98.872889a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222 62.179556 62.122667a34.133333 34.133333 0 0 1-44.088889 51.882667L563.2 387.242667 501.077333 325.063111 437.191111 388.949333l98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-63.886222 63.886222L387.242667 563.2a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.584-62.122667-62.179556-63.886222 63.886222 98.986667 98.929778a34.133333 34.133333 0 0 1-44.088889 51.882667l-4.209778-3.640889-98.929778-98.929778-39.765333 39.822222 197.802667 197.745778 576.284444-576.284444-197.802667-197.745778z"  ></path></symbol><symbol id="l7-icon-reposition" viewBox="0 0 1024 1024"><path d="M512 56.888889a34.133333 34.133333 0 0 1 34.133333 34.133333v24.177778A398.336 398.336 0 0 1 908.856889 477.866667h24.177778a34.133333 34.133333 0 0 1 0 68.266666h-24.177778A398.336 398.336 0 0 1 546.133333 908.856889L546.133333 932.977778a34.133333 34.133333 0 0 1-68.266666 0v-24.177778A398.336 398.336 0 0 1 115.2 546.133333L91.022222 546.133333a34.133333 34.133333 0 1 1 0-68.266666h24.177778A398.336 398.336 0 0 1 477.866667 115.2V91.022222A34.133333 34.133333 0 0 1 512 56.888889z m34.190222 126.862222L546.133333 193.422222a34.133333 34.133333 0 1 1-68.266666 0v-9.671111A330.069333 330.069333 0 0 0 183.751111 477.866667h9.671111a34.133333 34.133333 0 1 1 0 68.266666l-9.671111 0.056889A330.069333 330.069333 0 0 0 477.866667 840.248889V830.577778a34.133333 34.133333 0 0 1 68.266666 0l0.056889 9.671111A330.069333 330.069333 0 0 0 840.248889 546.133333L830.577778 546.133333a34.133333 34.133333 0 0 1 0-68.266666h9.671111A330.069333 330.069333 0 0 0 546.133333 183.751111zM512 341.333333a170.666667 170.666667 0 1 1 0 341.333334 170.666667 170.666667 0 0 1 0-341.333334z m0 68.266667a102.4 102.4 0 1 0 0 204.8 102.4 102.4 0 0 0 0-204.8z"  ></path></symbol><symbol id="l7-icon-round" viewBox="0 0 1024 1024"><path d="M512 56.888889a455.111111 455.111111 0 0 1 391.395556 687.502222 113.777778 113.777778 0 0 1-159.061334 158.890667A455.111111 455.111111 0 0 1 120.604444 279.608889 113.777778 113.777778 0 0 1 279.608889 120.604444 452.835556 452.835556 0 0 1 512 56.888889z m0 68.266667a384.910222 384.910222 0 0 0-191.715556 50.744888A113.777778 113.777778 0 0 1 175.957333 320.284444a386.844444 386.844444 0 0 0 527.815111 527.758223 113.777778 113.777778 0 0 1 144.270223-144.440889A386.844444 386.844444 0 0 0 512 125.155556z m299.406222 640.739555a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222zM212.593778 167.082667a45.511111 45.511111 0 1 0 0 91.022222 45.511111 45.511111 0 0 0 0-91.022222z"  ></path></symbol><symbol id="l7-icon-guanbi" viewBox="0 0 1024 1024"><path d="M576 512l277.333333 277.333333-64 64-277.333333-277.333333L234.666667 853.333333 170.666667 789.333333l277.333333-277.333333L170.666667 234.666667 234.666667 170.666667l277.333333 277.333333L789.333333 170.666667 853.333333 234.666667 576 512z"  ></path></symbol></svg>',function(Qt){try{let oe=function(){Z||(Z=!0,_())},We=function(){try{fe.documentElement.doScroll("left")}catch(qe){return void setTimeout(We,50)}oe()};var ce=oe,Ge=We,U=(U=document.getElementsByTagName("script"))[U.length-1],re=U.getAttribute("data-injectcss"),U=U.getAttribute("data-disable-injectsvg");if(!U){var ee,ve,_,fe,Z,he=function(pt,vt){vt.parentNode.insertBefore(pt,vt)};if(re&&!Qt.__iconfont__svg__cssinject__){Qt.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(qe){console&&console.log(qe)}}ee=function(){var pt,vt=document.createElement("div");vt.innerHTML=Qt._iconfont_svg_string_3580659,(vt=vt.getElementsByTagName("svg")[0])&&(vt.setAttribute("aria-hidden","true"),vt.style.position="absolute",vt.style.width=0,vt.style.height=0,vt.style.overflow="hidden",vt=vt,(pt=document.body).firstChild?he(vt,pt.firstChild):pt.appendChild(vt))},document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(ee,0):(ve=function(){document.removeEventListener("DOMContentLoaded",ve,!1),ee()},document.addEventListener("DOMContentLoaded",ve,!1)):document.attachEvent&&(_=ee,fe=Qt.document,Z=!1,We(),fe.onreadystatechange=function(){fe.readyState=="complete"&&(fe.onreadystatechange=null,oe())})}}catch(oe){}}(window)},27354:function(Qt,re,U){"use strict";U.d(re,{zP:function(){return aB},JE:function(){return nL},ns:function(){return iB}});var ee=U(50959),ve=(0,ee.createContext)({});function _(){return(0,ee.useContext)(ve)}var fe={},Z={},he=function(r){return Z[r]},ce=function(r,t){Z[r]=t},Ge=function(r){return fe[r]},oe=function(r,t){fe[r]=t},We={},qe={},pt=34,vt=10,bt=13;function Et(e){return new Function("d","return {"+e.map(function(r,t){return JSON.stringify(r)+": d["+t+'] || ""'}).join(",")+"}")}function Dt(e,r){var t=Et(e);return function(n,i){return r(t(n),i,e)}}function wt(e){var r=Object.create(null),t=[];return e.forEach(function(n){for(var i in n)i in r||t.push(r[i]=i)}),t}function at(e,r){var t=e+"",n=t.length;return n<r?new Array(r-n+1).join(0)+t:t}function Tt(e){return e<0?"-"+at(-e,6):e>9999?"+"+at(e,6):at(e,4)}function wr(e){var r=e.getUTCHours(),t=e.getUTCMinutes(),n=e.getUTCSeconds(),i=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":Tt(e.getUTCFullYear(),4)+"-"+at(e.getUTCMonth()+1,2)+"-"+at(e.getUTCDate(),2)+(i?"T"+at(r,2)+":"+at(t,2)+":"+at(n,2)+"."+at(i,3)+"Z":n?"T"+at(r,2)+":"+at(t,2)+":"+at(n,2)+"Z":t||r?"T"+at(r,2)+":"+at(t,2)+"Z":"")}function pr(e){var r=new RegExp('["'+e+`
\r]`),t=e.charCodeAt(0);function n(b,T){var M,P,k=i(b,function(H,q){if(M)return M(H,q-1);P=H,M=T?Dt(H,T):Et(H)});return k.columns=P||[],k}function i(b,T){var M=[],P=b.length,k=0,H=0,q,ae=P<=0,Se=!1;b.charCodeAt(P-1)===vt&&--P,b.charCodeAt(P-1)===bt&&--P;function ze(){if(ae)return qe;if(Se)return Se=!1,We;var ut,ot=k,Ct;if(b.charCodeAt(ot)===pt){for(;k++<P&&b.charCodeAt(k)!==pt||b.charCodeAt(++k)===pt;);return(ut=k)>=P?ae=!0:(Ct=b.charCodeAt(k++))===vt?Se=!0:Ct===bt&&(Se=!0,b.charCodeAt(k)===vt&&++k),b.slice(ot+1,ut-1).replace(/""/g,'"')}for(;k<P;){if((Ct=b.charCodeAt(ut=k++))===vt)Se=!0;else if(Ct===bt)Se=!0,b.charCodeAt(k)===vt&&++k;else if(Ct!==t)continue;return b.slice(ot,ut)}return ae=!0,b.slice(ot,P)}for(;(q=ze())!==qe;){for(var it=[];q!==We&&q!==qe;)it.push(q),q=ze();T&&(it=T(it,H++))==null||M.push(it)}return M}function a(b,T){return b.map(function(M){return T.map(function(P){return y(M[P])}).join(e)})}function s(b,T){return T==null&&(T=wt(b)),[T.map(y).join(e)].concat(a(b,T)).join(`
`)}function l(b,T){return T==null&&(T=wt(b)),a(b,T).join(`
`)}function f(b){return b.map(d).join(`
`)}function d(b){return b.map(y).join(e)}function y(b){return b==null?"":b instanceof Date?wr(b):r.test(b+="")?'"'+b.replace(/"/g,'""')+'"':b}return{parse:n,parseRows:i,format:s,formatBody:l,formatRows:f,formatRow:d,formatValue:y}}var lr=pr(","),Ot=lr.parse,ht=lr.parseRows,Ft=lr.format,Qe=lr.formatBody,Nt=lr.formatRows,sr=lr.formatRow,ie=lr.formatValue,W=U(35361),te=63710088e-1,Oe={centimeters:te*100,centimetres:te*100,degrees:te/111325,feet:te*3.28084,inches:te*39.37,kilometers:te/1e3,kilometres:te/1e3,meters:te,metres:te,miles:te/1609.344,millimeters:te*1e3,millimetres:te*1e3,nauticalmiles:te/1852,radians:1,yards:te*1.0936},Te={centimeters:100,centimetres:100,degrees:1/111325,feet:3.28084,inches:39.37,kilometers:1/1e3,kilometres:1/1e3,meters:1,metres:1,miles:1/1609.344,millimeters:1e3,millimetres:1e3,nauticalmiles:1/1852,radians:1/te,yards:1.0936133},nt={acres:247105e-9,centimeters:1e4,centimetres:1e4,feet:10.763910417,hectares:1e-4,inches:1550.003100006,kilometers:1e-6,kilometres:1e-6,meters:1,metres:1,miles:386e-9,millimeters:1e6,millimetres:1e6,yards:1.195990046};function De(e,r,t){t===void 0&&(t={});var n={type:"Feature"};return(t.id===0||t.id)&&(n.id=t.id),t.bbox&&(n.bbox=t.bbox),n.properties=r||{},n.geometry=e,n}function Ze(e,r,t){switch(t===void 0&&(t={}),e){case"Point":return Ke(r).geometry;case"LineString":return fn(r).geometry;case"Polygon":return dr(r).geometry;case"MultiPoint":return Sn(r).geometry;case"MultiLineString":return Fn(r).geometry;case"MultiPolygon":return Jr(r).geometry;default:throw new Error(e+" is invalid")}}function Ke(e,r,t){if(t===void 0&&(t={}),!e)throw new Error("coordinates is required");if(!Array.isArray(e))throw new Error("coordinates must be an Array");if(e.length<2)throw new Error("coordinates must be at least 2 numbers long");if(!Ia(e[0])||!Ia(e[1]))throw new Error("coordinates must contain numbers");var n={type:"Point",coordinates:e};return De(n,r,t)}function At(e,r,t){return t===void 0&&(t={}),Lr(e.map(function(n){return Ke(n,r)}),t)}function dr(e,r,t){t===void 0&&(t={});for(var n=0,i=e;n<i.length;n++){var a=i[n];if(a.length<4)throw new Error("Each LinearRing of a Polygon must have 4 or more Positions.");for(var s=0;s<a[a.length-1].length;s++)if(a[a.length-1][s]!==a[0][s])throw new Error("First and last Position are not equivalent.")}var l={type:"Polygon",coordinates:e};return De(l,r,t)}function Pt(e,r,t){return t===void 0&&(t={}),Lr(e.map(function(n){return dr(n,r)}),t)}function fn(e,r,t){if(t===void 0&&(t={}),e.length<2)throw new Error("coordinates must be an array of two or more positions");var n={type:"LineString",coordinates:e};return De(n,r,t)}function cn(e,r,t){return t===void 0&&(t={}),Lr(e.map(function(n){return fn(n,r)}),t)}function Lr(e,r){r===void 0&&(r={});var t={type:"FeatureCollection"};return r.id&&(t.id=r.id),r.bbox&&(t.bbox=r.bbox),t.features=e,t}function Fn(e,r,t){t===void 0&&(t={});var n={type:"MultiLineString",coordinates:e};return De(n,r,t)}function Sn(e,r,t){t===void 0&&(t={});var n={type:"MultiPoint",coordinates:e};return De(n,r,t)}function Jr(e,r,t){t===void 0&&(t={});var n={type:"MultiPolygon",coordinates:e};return De(n,r,t)}function bi(e,r,t){t===void 0&&(t={});var n={type:"GeometryCollection",geometries:e};return De(n,r,t)}function Gn(e,r){if(r===void 0&&(r=0),r&&!(r>=0))throw new Error("precision must be a positive number");var t=Math.pow(10,r||0);return Math.round(e*t)/t}function zi(e,r){r===void 0&&(r="kilometers");var t=Oe[r];if(!t)throw new Error(r+" units is invalid");return e*t}function bn(e,r){r===void 0&&(r="kilometers");var t=Oe[r];if(!t)throw new Error(r+" units is invalid");return e/t}function Pn(e,r){return Zi(bn(e,r))}function Aa(e){var r=e%360;return r<0&&(r+=360),r}function Zi(e){var r=e%(2*Math.PI);return r*180/Math.PI}function Ma(e){var r=e%360;return r*Math.PI/180}function To(e,r,t){if(r===void 0&&(r="kilometers"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("length must be a positive number");return zi(bn(e,r),t)}function Ce(e,r,t){if(r===void 0&&(r="meters"),t===void 0&&(t="kilometers"),!(e>=0))throw new Error("area must be a positive number");var n=nt[r];if(!n)throw new Error("invalid original units");var i=nt[t];if(!i)throw new Error("invalid final units");return e/n*i}function Ia(e){return!isNaN(e)&&e!==null&&!Array.isArray(e)}function Ta(e){return!!e&&e.constructor===Object}function no(e){if(!e)throw new Error("bbox is required");if(!Array.isArray(e))throw new Error("bbox must be an Array");if(e.length!==4&&e.length!==6)throw new Error("bbox must be an Array of 4 or 6 numbers");e.forEach(function(r){if(!Ia(r))throw new Error("bbox must only contain numbers")})}function qs(e){if(!e)throw new Error("id is required");if(["string","number"].indexOf(typeof e)===-1)throw new Error("id must be a number or a string")}function Rs(e){if(!e)throw new Error("coord is required");if(!Array.isArray(e)){if(e.type==="Feature"&&e.geometry!==null&&e.geometry.type==="Point")return e.geometry.coordinates;if(e.type==="Point")return e.coordinates}if(Array.isArray(e)&&e.length>=2&&!Array.isArray(e[0])&&!Array.isArray(e[1]))return e;throw new Error("coord must be GeoJSON Point or an Array of numbers")}function ts(e){if(Array.isArray(e))return e;if(e.type==="Feature"){if(e.geometry!==null)return e.geometry.coordinates}else if(e.coordinates)return e.coordinates;throw new Error("coords must be GeoJSON Feature, Geometry Object or an Array")}function Wt(e){if(e.length>1&&isNumber(e[0])&&isNumber(e[1]))return!0;if(Array.isArray(e[0])&&e[0].length)return Wt(e[0]);throw new Error("coordinates must only contain numbers")}function xr(e,r,t){if(!r||!t)throw new Error("type and name required");if(!e||e.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.type)}function Gr(e,r,t){if(!e)throw new Error("No feature passed");if(!t)throw new Error(".featureOf() requires a name");if(!e||e.type!=="Feature"||!e.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!e.geometry||e.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+e.geometry.type)}function nn(e,r,t){if(!e)throw new Error("No featureCollection passed");if(!t)throw new Error(".collectionOf() requires a name");if(!e||e.type!=="FeatureCollection")throw new Error("Invalid input to "+t+", FeatureCollection required");for(var n=0,i=e.features;n<i.length;n++){var a=i[n];if(!a||a.type!=="Feature"||!a.geometry)throw new Error("Invalid input to "+t+", Feature with geometry required");if(!a.geometry||a.geometry.type!==r)throw new Error("Invalid input to "+t+": must be a "+r+", given "+a.geometry.type)}}function Nn(e){return e.type==="Feature"?e.geometry:e}function Ki(e,r){return e.type==="FeatureCollection"?"FeatureCollection":e.type==="GeometryCollection"?"GeometryCollection":e.type==="Feature"&&e.geometry!==null?e.geometry.type:e.type}function ue(e,r,t){if(e!==null)for(var n,i,a,s,l,f,d,y=0,b=0,T,M=e.type,P=M==="FeatureCollection",k=M==="Feature",H=P?e.features.length:1,q=0;q<H;q++){d=P?e.features[q].geometry:k?e.geometry:e,T=d?d.type==="GeometryCollection":!1,l=T?d.geometries.length:1;for(var ae=0;ae<l;ae++){var Se=0,ze=0;if(s=T?d.geometries[ae]:d,s!==null){f=s.coordinates;var it=s.type;switch(y=t&&(it==="Polygon"||it==="MultiPolygon")?1:0,it){case null:break;case"Point":if(r(f,b,q,Se,ze)===!1)return!1;b++,Se++;break;case"LineString":case"MultiPoint":for(n=0;n<f.length;n++){if(r(f[n],b,q,Se,ze)===!1)return!1;b++,it==="MultiPoint"&&Se++}it==="LineString"&&Se++;break;case"Polygon":case"MultiLineString":for(n=0;n<f.length;n++){for(i=0;i<f[n].length-y;i++){if(r(f[n][i],b,q,Se,ze)===!1)return!1;b++}it==="MultiLineString"&&Se++,it==="Polygon"&&ze++}it==="Polygon"&&Se++;break;case"MultiPolygon":for(n=0;n<f.length;n++){for(ze=0,i=0;i<f[n].length;i++){for(a=0;a<f[n][i].length-y;a++){if(r(f[n][i][a],b,q,Se,ze)===!1)return!1;b++}ze++}Se++}break;case"GeometryCollection":for(n=0;n<s.geometries.length;n++)if(ue(s.geometries[n],r,t)===!1)return!1;break;default:throw new Error("Unknown Geometry Type")}}}}}function D(e,r,t,n){var i=t;return ue(e,function(a,s,l,f,d){s===0&&t===void 0?i=a:i=r(i,a,s,l,f,d)},n),i}function z(e,r){var t;switch(e.type){case"FeatureCollection":for(t=0;t<e.features.length&&r(e.features[t].properties,t)!==!1;t++);break;case"Feature":r(e.properties,0);break}}function se(e,r,t){var n=t;return z(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function be(e,r){if(e.type==="Feature")r(e,0);else if(e.type==="FeatureCollection")for(var t=0;t<e.features.length&&r(e.features[t],t)!==!1;t++);}function ke(e,r,t){var n=t;return be(e,function(i,a){a===0&&t===void 0?n=i:n=r(n,i,a)}),n}function Ht(e){var r=[];return ue(e,function(t){r.push(t)}),r}function Mt(e,r){var t,n,i,a,s,l,f,d,y,b,T=0,M=e.type==="FeatureCollection",P=e.type==="Feature",k=M?e.features.length:1;for(t=0;t<k;t++){for(l=M?e.features[t].geometry:P?e.geometry:e,d=M?e.features[t].properties:P?e.properties:{},y=M?e.features[t].bbox:P?e.bbox:void 0,b=M?e.features[t].id:P?e.id:void 0,f=l?l.type==="GeometryCollection":!1,s=f?l.geometries.length:1,i=0;i<s;i++){if(a=f?l.geometries[i]:l,a===null){if(r(null,T,d,y,b)===!1)return!1;continue}switch(a.type){case"Point":case"LineString":case"MultiPoint":case"Polygon":case"MultiLineString":case"MultiPolygon":{if(r(a,T,d,y,b)===!1)return!1;break}case"GeometryCollection":{for(n=0;n<a.geometries.length;n++)if(r(a.geometries[n],T,d,y,b)===!1)return!1;break}default:throw new Error("Unknown Geometry Type")}}T++}}function Lt(e,r,t){var n=t;return Mt(e,function(i,a,s,l,f){a===0&&t===void 0?n=i:n=r(n,i,a,s,l,f)}),n}function mt(e,r){Mt(e,function(t,n,i,a,s){var l=t===null?null:t.type;switch(l){case null:case"Point":case"LineString":case"Polygon":return r(De(t,i,{bbox:a,id:s}),n,0)===!1?!1:void 0}var f;switch(l){case"MultiPoint":f="Point";break;case"MultiLineString":f="LineString";break;case"MultiPolygon":f="Polygon";break}for(var d=0;d<t.coordinates.length;d++){var y=t.coordinates[d],b={type:f,coordinates:y};if(r(De(b,i),n,d)===!1)return!1}})}function N(e,r,t){var n=t;return mt(e,function(i,a,s){a===0&&s===0&&t===void 0?n=i:n=r(n,i,a,s)}),n}function B(e,r){mt(e,function(t,n,i){var a=0;if(t.geometry){var s=t.geometry.type;if(!(s==="Point"||s==="MultiPoint")){var l,f=0,d=0,y=0;if(ue(t,function(b,T,M,P,k){if(l===void 0||n>f||P>d||k>y){l=b,f=n,d=P,y=k,a=0;return}var H=lineString([l,b],t.properties);if(r(H,n,i,k,a)===!1)return!1;a++,l=b})===!1)return!1}}})}function $(e,r,t){var n=t,i=!1;return B(e,function(a,s,l,f,d){i===!1&&t===void 0?n=a:n=r(n,a,s,l,f,d),i=!0}),n}function ne(e,r){if(!e)throw new Error("geojson is required");mt(e,function(t,n,i){if(t.geometry!==null){var a=t.geometry.type,s=t.geometry.coordinates;switch(a){case"LineString":if(r(t,n,i,0,0)===!1)return!1;break;case"Polygon":for(var l=0;l<s.length;l++)if(r(lineString(s[l],t.properties),n,i,l)===!1)return!1;break}}})}function xe(e,r,t){var n=t;return ne(e,function(i,a,s,l){a===0&&t===void 0?n=i:n=r(n,i,a,s,l)}),n}function Fe(e,r){if(r=r||{},!isObject(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.segmentIndex||0,s=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),s=s||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var f=l.coordinates;switch(l.type){case"Point":case"MultiPoint":return null;case"LineString":return a<0&&(a=f.length+a-1),lineString([f[a],f[a+1]],s,r);case"Polygon":return i<0&&(i=f.length+i),a<0&&(a=f[i].length+a-1),lineString([f[i][a],f[i][a+1]],s,r);case"MultiLineString":return n<0&&(n=f.length+n),a<0&&(a=f[n].length+a-1),lineString([f[n][a],f[n][a+1]],s,r);case"MultiPolygon":return n<0&&(n=f.length+n),i<0&&(i=f[n].length+i),a<0&&(a=f[n][i].length-a-1),lineString([f[n][i][a],f[n][i][a+1]],s,r)}throw new Error("geojson is invalid")}function et(e,r){if(r=r||{},!isObject(r))throw new Error("options is invalid");var t=r.featureIndex||0,n=r.multiFeatureIndex||0,i=r.geometryIndex||0,a=r.coordIndex||0,s=r.properties,l;switch(e.type){case"FeatureCollection":t<0&&(t=e.features.length+t),s=s||e.features[t].properties,l=e.features[t].geometry;break;case"Feature":s=s||e.properties,l=e.geometry;break;case"Point":case"MultiPoint":return null;case"LineString":case"Polygon":case"MultiLineString":case"MultiPolygon":l=e;break;default:throw new Error("geojson is invalid")}if(l===null)return null;var f=l.coordinates;switch(l.type){case"Point":return point(f,s,r);case"MultiPoint":return n<0&&(n=f.length+n),point(f[n],s,r);case"LineString":return a<0&&(a=f.length+a),point(f[a],s,r);case"Polygon":return i<0&&(i=f.length+i),a<0&&(a=f[i].length+a),point(f[i][a],s,r);case"MultiLineString":return n<0&&(n=f.length+n),a<0&&(a=f[n].length+a),point(f[n][a],s,r);case"MultiPolygon":return n<0&&(n=f.length+n),i<0&&(i=f[n].length+i),a<0&&(a=f[n][i].length-a),point(f[n][i][a],s,r)}throw new Error("geojson is invalid")}var j=U(97086),Q=U(5952),Le=U(90242),rt=U(70657),Ee=U(82028),Yt=U(92569);function gr(e){try{return Function.toString.call(e).indexOf("[native code]")!==-1}catch(r){return typeof e=="function"}}var tn=U(41081);function Qr(e,r,t){return(0,tn.Z)()?Qr=Reflect.construct.bind():Qr=function(i,a,s){var l=[null];l.push.apply(l,a);var f=Function.bind.apply(i,l),d=new f;return s&&(0,Yt.Z)(d,s.prototype),d},Qr.apply(null,arguments)}function rr(e){var r=typeof Map=="function"?new Map:void 0;return rr=function(n){if(n===null||!gr(n))return n;if(typeof n!="function")throw new TypeError("Super expression must either be null or a function");if(typeof r!="undefined"){if(r.has(n))return r.get(n);r.set(n,i)}function i(){return Qr(n,arguments,(0,Ee.Z)(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),(0,Yt.Z)(i,n)},rr(e)}var Xr={REGISTERED_PROTOCOLS:{}};function zr(e){var r=Vr();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function Vr(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ei=function(r){return Xr.REGISTERED_PROTOCOLS[r.substring(0,r.indexOf("://"))]},sn=function(e){(0,Le.Z)(t,e);var r=zr(t);function t(n,i,a,s){var l;return(0,Q.Z)(this,t),l=r.call(this,"AJAXError: ".concat(i," (").concat(n,"): ").concat(a)),l.status=n,l.statusText=i,l.url=a,l.body=s,l}return(0,j.Z)(t)}(rr(Error));function hi(e,r){var t=new XMLHttpRequest,n=Array.isArray(e.url)?e.url[0]:e.url;t.open(e.method||"GET",n,!0),e.type==="arrayBuffer"&&(t.responseType="arraybuffer");for(var i in e.headers)e.headers.hasOwnProperty(i)&&t.setRequestHeader(i,e.headers[i]);return e.type==="json"&&(t.responseType="text",t.setRequestHeader("Accept","application/json")),t.withCredentials=e.credentials==="include",t.onerror=function(){r(new Error(t.statusText))},t.onload=function(){if((t.status>=200&&t.status<300||t.status===0)&&t.response!==null){var a=t.response;if(e.type==="json")try{a=JSON.parse(t.response)}catch(l){return r(l)}r(null,a,t.getResponseHeader("Cache-Control"),t.getResponseHeader("Expires"),t)}else{var s=new Blob([t.response],{type:t.getResponseHeader("Content-Type")});r(new sn(t.status,t.statusText,n.toString(),s))}},t.cancel=t.abort,t.send(e.body),t}function Vi(e){return new Promise(function(r,t){hi(e,function(n,i,a,s,l){n?t({err:n,data:null,xhr:l}):r({err:null,data:i,cacheControl:a,expires:s,xhr:l})})})}function ci(e,r){return hi(e,r)}var Di=function(r,t){var n=ei(r.url)||ci;return n((0,W.Z)((0,W.Z)({},r),{},{type:"json"}),t)},Ei=function(r,t){var n=ei(r.url)||ci;return n((0,W.Z)((0,W.Z)({},r),{},{type:"arrayBuffer"}),t)},rs=function(r,t){return ci(_objectSpread(_objectSpread({},r),{},{method:"POST"}),t)},Qi=function(r,t){return ci((0,W.Z)((0,W.Z)({},r),{},{method:"GET"}),t)};function Pa(e){var r=window.document.createElement("a");return r.href=e,r.protocol===window.document.location.protocol&&r.host===window.document.location.host}var Si="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";function di(e,r){var t=new window.Image,n=window.URL||window.webkitURL;t.crossOrigin="anonymous",t.onload=function(){r(null,t),n.revokeObjectURL(t.src),t.onload=null,window.requestAnimationFrame(function(){t.src=Si})},t.onerror=function(){return r(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var i=new Blob([new Uint8Array(e)],{type:"image/png"});t.src=e.byteLength?n.createObjectURL(i):Si}function Ai(e,r){var t=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(t).then(function(n){r(null,n)}).catch(function(n){r(new Error("Could not load image because of ".concat(n.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}var Oa=function(r,t,n){var i=function(s,l){if(s)t(s);else if(l){var f=typeof createImageBitmap=="function",d=n?n(l):l;f?Ai(d,t):di(d,t)}};return r.type==="json"?Di(r,i):Ei(r,i)},vu=function(r,t){var n=typeof createImageBitmap=="function";n?Ai(r,t):di(r,t)},ca=function(e){return e.CENTER="center",e.TOP="top",e["TOP-LEFT"]="top-left",e["TOP-RIGHT"]="top-right",e.BOTTOM="bottom",e["BOTTOM-LEFT"]="bottom-left",e["BOTTOM-RIGHT"]="bottom-right",e.LEFT="left",e.RIGHT="right",e}({}),wa={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Gl(e,r,t){var n=e.classList;for(var i in wa)wa.hasOwnProperty(i)&&n.remove("l7-".concat(t,"-anchor-").concat(i));n.add("l7-".concat(t,"-anchor-").concat(r))}var ds=U(52617);function Ca(e){return typeof e=="string"?!!d3.color(e):!1}function vi(e){var r=ds.ZP(e),t=[0,0,0,0];return r!=null&&(t[0]=r.r/255,t[1]=r.g/255,t[2]=r.b/255,t[3]=r.opacity),t}function ka(e){var r=e&&e[0],t=e&&e[1],n=e&&e[2],i=r+t*256+n*65536-1;return i}function na(e){return[e+1&255,e+1>>8&255,e+1>>8>>8&255]}function zo(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;for(var n=null,i=t.createLinearGradient(0,0,256,1),a=e.positions[0],s=e.positions[e.positions.length-1],l=0;l<e.colors.length;++l){var f=(e.positions[l]-a)/(s-a);i.addColorStop(f,e.colors[l])}return t.fillStyle=i,t.fillRect(0,0,256,1),n=new Uint8ClampedArray(t.getImageData(0,0,256,1).data),r=null,t=null,{data:n,width:256,height:1}}function la(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");t.width=256,t.height=1;for(var i=n.createLinearGradient(0,0,256,1),a=r[1]-r[0],s=0;s<e.colors.length;++s){var l=Math.max((e.positions[s]-r[0])/a,0);i.addColorStop(l,e.colors[s])}n.fillStyle=i,n.fillRect(0,0,256,1);var f=n.getImageData(0,0,256,1).data,d=vs(n,f);return t=null,n=null,d}function ns(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");r.width=256,r.height=1;var n=t.createImageData(256,1);return n.data.fill(0),e.positions.forEach(function(i,a){var s=vi(e.colors[a]);n.data[i*4+0]=s[0]*255,n.data[i*4+1]=s[1]*255,n.data[i*4+2]=s[2]*255,n.data[i*4+3]=s[3]*255}),r=null,t=null,n}function $o(e){var r=window.document.createElement("canvas"),t=r.getContext("2d");t.globalAlpha=1,r.width=256,r.height=1;for(var n=256/e.colors.length,i=0;i<e.colors.length;i++)t.beginPath(),t.lineWidth=2,t.strokeStyle=e.colors[i],t.moveTo(i*n,0),t.lineTo((i+1)*n,0),t.stroke();var a=t.getImageData(0,0,256,1).data,s=vs(t,a);return r=null,t=null,s}function Du(e,r){var t=window.document.createElement("canvas"),n=t.getContext("2d");n.globalAlpha=1,t.width=256,t.height=1;var i=r[1]-r[0];e.positions.length-e.colors.length!==1&&console.warn("positions \u7684\u6570\u5B57\u4E2A\u6570\u5E94\u5F53\u6BD4 colors \u7684\u6837\u5F0F\u591A\u4E00\u4E2A,poisitions \u7684\u9996\u5C3E\u503C\u4E00\u822C\u4E3A\u6570\u636E\u7684\u6700\u5927\u6700\u65B0\u503C");for(var a=0;a<e.colors.length;a++)n.beginPath(),n.lineWidth=2,n.strokeStyle=e.colors[a],n.moveTo((e.positions[a]-r[0])/i*255,0),n.lineTo((e.positions[a+1]-r[0])/i*255,0),n.stroke();var s=n.getImageData(0,0,256,1).data,l=vs(n,s);return t=null,n=null,l}function vs(e,r){for(var t=e.createImageData(256,1),n=0;n<t.data.length;n+=4)t.data[n+0]=r[n+0],t.data[n+1]=r[n+1],t.data[n+2]=r[n+2],t.data[n+3]=r[n+3];return t}function _c(e){switch(e.type){case"cat":return[0,255];default:return[0,1]}}var ya={BACK:1029,FRONT:1028};function Ji(e){switch(e){case"GAODE1.x":return ya.BACK;case"GAODE2.x":return ya.BACK;case"MAPBOX":return ya.FRONT;case"SIMPLE":return ya.FRONT;case"GLOBEL":return ya.BACK;case"DEBAULT":return ya.FRONT;default:return ya.FRONT}}var Jt=U(30360),yn=U(959),ge=U(35636),Pe=U.n(ge),_t=U(32222),cr=U.n(_t),Kr=U(66292),kn=U.n(Kr),ji=U(65439),vo=U.n(ji),wo=U(98071),fo=U.n(wo),Ds=U(31223),Ms=U.n(Ds),ep=U(46207),Af=U.n(ep),Yo=U(59933),El=U.n(Yo),Sl=U(69143),Lu=U.n(Sl),Bu=U(56549),Ju=U.n(Bu),$c=U(73806),Ls=U.n($c),Ya=U(67929),Al=U.n(Ya),el=U(53954),Tf=U.n(el),tp=U(25066),wf=U.n(tp),hh=U(38209),ph=U.n(hh),dh=U(4363),rp=U.n(dh),np=U(42950),zp=U.n(np),Yc=U(92042),Fu=U.n(Yc),ip=U(36838),qo=U.n(ip),Xl=U(89300),Tl=U.n(Xl),Ks=U(47638),wl=U.n(Ks),ui={isNil:Af(),merge:Al(),throttle:ph(),isString:Ju(),debounce:kn(),pull:wf(),isTypedArray:Ls(),isPlainObject:Lu(),isNumber:El(),isBoolean:fo(),isEqual:Ms(),cloneDeep:cr(),uniq:rp(),clamp:Pe(),upperFirst:zp(),get:vo(),mergeWith:Tf(),isFunction:Fu(),isObject:qo(),isUndefined:Tl(),camelCase:wl()},tl=ui.pull;function Bs(e){var r=e;return typeof e=="string"&&(r=window.document.getElementById(e)),r}function Nu(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")}function rl(e){return Nu(e).split(/\s+/)}function ap(e){var r,t=(r=document)===null||r===void 0||(r=r.documentElement)===null||r===void 0?void 0:r.style;if(!t)return e[0];for(var n in e)if(e[n]&&e[n]in t)return e[n];return e[0]}function $i(e,r,t){var n=window.document.createElement(e);return r&&(n.className=r||""),t&&t.appendChild(n),n}function Ci(e){var r=e.parentNode;r&&r.removeChild(e)}function ou(e,r){if(e.classList!==void 0)for(var t=rl(r),n=0,i=t.length;n<i;n++)e.classList.add(t[n]);else if(!Cf(e,r)){var a=Rf(e);Za(e,(a?a+" ":"")+r)}}function mu(e,r){if(e.classList!==void 0){var t=rl(r);t.forEach(function(n){e.classList.remove(n)})}else Za(e,Nu((" "+Rf(e)+" ").replace(" "+r+" "," ")))}function Cf(e,r){if(e.classList!==void 0)return e.classList.contains(r);var t=Rf(e);return t.length>0&&new RegExp("(^|\\s)"+r+"(\\s|$)").test(t)}function Za(e,r){e instanceof HTMLElement?e.className=r:e.className.baseVal=r}function vh(e,r,t){t===void 0?Cf(e,r)?mu(e,r):ou(e,r):t?ou(e,r):mu(e,r)}function Rf(e){return e instanceof SVGElement&&(e=e.correspondingElement),e.className.baseVal===void 0?e.className:e.className.baseVal}function Fs(e){for(;e&&e.firstChild;)e.removeChild(e.firstChild)}var nl=ap(["transform","WebkitTransform"]);function gu(e,r){e.style[nl]=r}function Cl(){if(typeof Event=="function")window.dispatchEvent(new Event("resize"));else{var e=window.document.createEvent("UIEvents");e.initUIEvent("resize",!0,!1,window,0),window.dispatchEvent(e)}}function mh(e){var r=["padding: "+(e.height/2-8)+"px "+e.width/2+"px;","line-height: "+e.height+"px;","background-image: url("+e.toDataURL()+");"];console.log(`%c
`,r.join(""))}function yc(){var e,r=window.document.querySelector('meta[name="viewport"]');if(!r)return 1;var t=(e=r.content)===null||e===void 0?void 0:e.split(","),n=t.find(function(i){var a=i.split("="),s=(0,yn.Z)(a,1),l=s[0];return l==="initial-scale"});return n?n.split("=")[1]*1:1}var sa=yc()<1?1:window.devicePixelRatio;function xc(e,r){e.setAttribute("style","".concat(e.style.cssText).concat(r))}function il(e){return e.split(";").map(function(r){return r.trim()}).filter(function(r){return r})}function Rl(e,r){var t,n=il((t=e.getAttribute("style"))!==null&&t!==void 0?t:""),i=il(r),a=tl.apply(void 0,[n].concat((0,Jt.Z)(i)));e.setAttribute("style",a.join(";"))}function gh(e){return Object.entries(e).map(function(r){var t=(0,yn.Z)(r,2),n=t[0],i=t[1];return"".concat(n,": ").concat(i)}).join(";")}function qc(e,r){return{left:e.left-r.left,top:e.top-r.top,right:r.left+r.width-e.left-e.width,bottom:r.top+r.height-e.top-e.height}}function fa(e,r){e.checked=r,r?e.setAttribute("checked","true"):e.removeAttribute("checked")}function Ml(e){e.innerHTML=""}function op(e){e.setAttribute("draggable","false")}function al(e,r){if(typeof r=="string"){var t=document.createElement("div");for(t.innerHTML=r;t.firstChild;)e.append(t.firstChild)}else Array.isArray(r)?e.append.apply(e,(0,Jt.Z)(r)):e.append(r)}function Kc(e,r){for(var t=Array.isArray(r)?r:[r],n=e;n instanceof Element&&n!==window.document.body;){var i,a;if(t.find(function(s){var l;return(l=n)===null||l===void 0?void 0:l.matches(s)}))return n;n=(i=(a=n)===null||a===void 0?void 0:a.parentElement)!==null&&i!==void 0?i:null}}var Qc;function Mf(e){return typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap}function ol(){return typeof importScripts=="function"}var $l=ol()?function(){return self.worker&&self.worker.referrer}:function(){return(window.location.protocol==="blob:"?window.parent:window).location.href},Uu=(Qc=navigator)===null||Qc===void 0?void 0:Qc.userAgent,Jc=!!Uu.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),bc=Uu.indexOf("Android")>-1||Uu.indexOf("Adr")>-1;function Yl(){for(var e=Uu,r=["Android","iPhone","SymbianOS","Windows Phone","iPad","iPod"],t=!0,n=0,i=r;n<i.length;n++){var a=i[n];if(e.indexOf(a)>0){t=!1;break}}return t}function _h(e,r){e.forEach(function(t){r[t]&&(r[t]=r[t].bind(r))})}var Ec=null;function Ns(e){var r=[1/0,1/0,-1/0,-1/0];return ue(e,function(t){r[0]>t[0]&&(r[0]=t[0]),r[1]>t[1]&&(r[1]=t[1]),r[2]<t[0]&&(r[2]=t[0]),r[3]<t[1]&&(r[3]=t[1])}),r}Ns.default=Ns;var yh=Ns;function ef(e){return typeof e=="number"}var Sc=2*Math.PI*6378137/2;function Il(e,r){var t=(0,yn.Z)(r,4),n=t[0],i=t[1],a=t[2],s=t[3];return e.lng>n&&e.lng<=a&&e.lat>i&&e.lat<=s}function zu(e){var r=[1/0,1/0,-1/0,-1/0];return e.forEach(function(t){var n=t.coordinates;ql(r,n)}),r}function ql(e,r){return Array.isArray(r[0])?r.forEach(function(t){ql(e,t)}):(e[0]>r[0]&&(e[0]=r[0]),e[1]>r[1]&&(e[1]=r[1]),e[2]<r[0]&&(e[2]=r[0]),e[3]<r[1]&&(e[3]=r[1])),e}function If(e,r){return sl(e,r)}function sl(e,r){return Array.isArray(e[0])?e.map(function(t){return sl(t,r)}):r(e)}function xh(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{enable:!0,decimal:1};e=sp(e,r);var n=e[0],i=e[1],a=n*Sc/180,s=Math.log(Math.tan((90+i)*Math.PI/360))/(Math.PI/180);return s=s*Sc/180,t.enable&&(a=Number(a.toFixed(t.decimal)),s=Number(s.toFixed(t.decimal))),e.length===3?[a,s,e[2]]:[a,s]}function bh(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:6,t=e[0],n=e[1],i=t/Sc*180,a=n/Sc*180;return a=180/Math.PI*(2*Math.atan(Math.exp(a*Math.PI/180))-Math.PI/2),r!=null&&(i=Number(i.toFixed(r)),a=Number(a.toFixed(r))),e.length===3?[i,a,e[2]]:[i,a]}function Eh(e){if(e==null)throw new Error("lng is required");return(e>180||e<-180)&&(e=e%360,e>180&&(e=-360+e),e<-180&&(e=360+e),e===0&&(e=0)),e}function Pf(e){if(e==null)throw new Error("lat is required");return(e>90||e<-90)&&(e=e%180,e>90&&(e=-180+e),e<-90&&(e=180+e),e===0&&(e=0)),e}function sp(e,r){if(r===!1)return e;var t=Eh(e[0]),n=Pf(e[1]);return n>85&&(n=85),n<-85&&(n=-85),e.length===3?[t,n,e[2]]:[t,n]}function Va(e){var r=85.0511287798,t=Math.max(Math.min(r,e[1]),-r),n=256<<20,i=Math.PI/180,a=e[0]*i,s=t*i;s=Math.log(Math.tan(Math.PI/4+s/2));var l=.5/Math.PI,f=.5,d=-.5/Math.PI;return i=.5,a=n*(l*a+f),s=n*(d*s+i),[Math.floor(a),Math.floor(s)]}function up(e){var r=.5/Math.PI,t=.5,n=-.5/Math.PI,i=.5,a=256<<20,s=_slicedToArray(e,2),l=s[0],f=s[1];l=(l/a-t)/r,f=(f/a-i)/n,f=(Math.atan(Math.pow(Math.E,f))-Math.PI/4)*2,i=Math.PI/180;var d=f/i,y=l/i;return[y,d]}function Of(e,r){var t=85.0511287798,n=Math.PI/180,i=6378137;return r=Math.max(Math.min(t,r),-t),e*=n,r*=n,r=Math.log(Math.tan(Math.PI/4+r/2)),[e*i,r*i]}function lp(e,r){var t=Math.PI/180,n=6378137,i=e/n/t,a=2*(Math.atan(Math.exp(r/n))-Math.PI/4)/t;return[i,a]}function Kl(e,r,t){var n=Ma(r[1]-e[1]),i=Ma(r[0]-e[0]),a=Ma(e[1]),s=Ma(r[1]),l=Math.pow(Math.sin(n/2),2)+Math.pow(Math.sin(i/2),2)*Math.cos(a)*Math.cos(s);return zi(2*Math.atan2(Math.sqrt(l),Math.sqrt(1-l)),t="meters")}function cp(e){var r=Math.PI/180,t=85.0511287798,n=6378137,i=Math.max(Math.min(t,e[1]),-t),a=Math.sin(i*r),s=n*e[0]*r,l=n*Math.log((1+a)/(1-a))/2;return[s,l]}function Zu(e,r){var t=Math.abs(e[1][1]-e[0][1])*r,n=Math.abs(e[1][0]-e[0][0])*r;return[[e[0][0]-n,e[0][1]-t],[e[1][0]+n,e[1][1]+t]]}function da(e,r){return e[0][0]<=r[0][0]&&e[0][1]<=r[0][1]&&e[1][0]>=r[1][0]&&e[1][1]>=r[1][1]}function Ql(e){return[[e[0],e[1]],[e[2],e[3]]]}function Vu(e){var r=ul(e,[0,0]);return[e[0]/r,e[1]/r]}function ul(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function Li(e,r){return e[0]*r[0]+e[1]*r[1]}function va(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function su(e,r){return Math.acos(Li(e,r)/(va(e)*va(r)))*180/Math.PI}function tf(e,r){return r[0]>0?r[1]>0?90-Math.atan(r[1]/r[0])*180/Math.PI:90+Math.atan(-r[1]/r[0])*180/Math.PI:r[1]<0?180+(90-Math.atan(r[1]/r[0])*180/Math.PI):270+Math.atan(r[1]/-r[0])*180/Math.PI}function rf(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:100;if(!(!e||e.length<2)){for(var t=[0,1],n=0,i=[],a=0;a<e.length-1;a++){var s=e[a],l=e[a+1],f=ul(s,l);n+=f;var d=[s[0]-l[0],s[1]-l[1]],y=tf(t,d);if(a>0){var b=i[a-1].rotation;b-y>360-b+y&&(y=y+360)}i.push({start:s,end:l,dis:f,rotation:y,duration:0})}return i.map(function(T){T.duration=r*(T.dis/n)}),i}}function Qs(e){if(ef(e[0]))return e;if(ef(e[0][0]))throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8");if(ef(e[0][0][0])){var r=e,t=0,n=0,i=0;return r.forEach(function(a){a.forEach(function(s){t+=s[0],n+=s[1],i++})}),[t/i,n/i,0]}else throw new Error("\u5F53\u524D\u6570\u636E\u4E0D\u652F\u6301\u6807\u6CE8")}function fp(e){for(var r=e[0],t=e[1],n=e[0],i=e[1],a=0,s=0,l=0,f=0;f<e.length;f+=2){var d=e[f],y=e[f+1];d&&y&&(r=Math.max(d,r),t=Math.max(y,t),n=Math.min(d,n),i=Math.min(y,i),a+=d,s+=y,l++)}return{center:[a/l,s/l],radius:Math.sqrt(Math.pow(r-n,2)+Math.pow(t-i,2))/2}}function kf(e){return yh(Lr([fn(e)]))}function Df(e){var r=131,t=137,n=0;e+="x";for(var i=Math.floor(9007199254740991/t),a=0;a<e.length;a++)n>i&&(n=Math.floor(n/t)),n=n*r+e.charCodeAt(a);return n}function Jl(e){e=e.toString();for(var r=5381,t=e.length;t;)r=r*33^e.charCodeAt(--t);return r>>>0}function Co(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var r=Math.random()*16|0,t=e==="x"?r:r&3|8;return t.toString(16)})}var ja=function(e){return e["GAODE1.x"]="GAODE1.x",e["GAODE2.x"]="GAODE2.x",e.MAPBOX="MAPBOX",e.DEFAULT="DEFAUlTMAP",e.SIMPLE="SIMPLE",e.GLOBEL="GLOBEL",e}({});function nf(e,r,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=t;return s&&(l=Math.round(t*(a-1))/(a-1)),n?ms(e,r,l,n,i):ms(e,r,l,.314,i)}function Ac(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function io(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function xn(e,r,t){var n=[r[0]-e[0],r[1]-e[1]],i=io(n,[0,0]),a=Math.atan2(n[1],n[0]),s=i/2/Math.cos(t),l=a+t,f=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return f}function ms(e,r,t,n,i){if(i===MapType["GAODE2.x"]){var a=amap2Project(e[0],e[1]),s=amap2Project(r[0],r[1]),l=xn(a,s,n),f=[a[0],l[0],s[0]],d=[a[1],l[1],s[1]];return[].concat(_toConsumableArray(amap2UnProject(Ac(f,t),Ac(d,t))),[0])}else{var y=xn(e,r,n),b=[e[0],y[0],r[0]],T=[e[1],y[1],r[1]];return[Ac(b,t),Ac(T,t),0]}}function Lf(e,r,t,n,i){var a=arguments.length>5&&arguments[5]!==void 0?arguments[5]:30,s=arguments.length>6?arguments[6]:void 0,l=t;return s&&(l=Math.round(t*29)/29),Bf(e,r,l,i)}function Tc(e,r){var t=[r[0]-e[0],r[1]-e[1]],n=calDistance(t,[0,0]),i=Math.atan2(t[1],t[0]),a=.314,s=n/2/Math.cos(a),l=i+a,f=[s*Math.cos(l)+e[0],s*Math.sin(l)+e[1]];return f}function is(e,r){var t=1-r;return(e[0]*t+e[1]*r)*t+(e[1]*t+e[2]*r)*r}function ha(e,r){var t=[e[0]-r[0],e[1]-r[1]],n=[Math.sin(t[0]/2),Math.sin(t[1]/2)],i=n[1]*n[1]+Math.cos(e[1])*Math.cos(r[1])*n[0]*n[0];return 2*Math.atan2(Math.sqrt(i),Math.sqrt(1-i))}function Bf(e,r,t,n){var i=[degreesToRadians(e[0]),degreesToRadians(e[1])],a=[degreesToRadians(r[0]),degreesToRadians(r[1])];if(n==="GAODE2.x"){var s=Tc(i,a),l=[i[0],s[0],a[0]],f=[i[1],s[1],a[1]];return[is(l,t),is(f,t),0]}else{var d=ha(i,a);if(Math.abs(d-Math.PI)<.001)return[(1-t)*i[0]+t*a[0],(1-t)*i[1]+t*a[1]];var y=Math.sin((1-t)*d)/Math.sin(d),b=Math.sin(t*d)/Math.sin(d),T=[Math.sin(i[0]),Math.sin(i[1])],M=[Math.cos(i[0]),Math.cos(i[1])],P=[Math.sin(a[0]),Math.sin(a[1])],k=[Math.cos(a[0]),Math.cos(a[1])],H=y*M[1]*M[0]+b*k[1]*k[0],q=y*M[1]*T[0]+b*k[1]*P[0],ae=y*T[1]+b*P[1];return[radiansToDegrees(Math.atan2(q,H)),radiansToDegrees(Math.atan2(ae,Math.sqrt(H*H+q*q)))]}}function an(e,r){for(var t=0,n=[],i=0;i<e.length-1;i++){var a=e[i],s=e[i+1],l=af(a,s),f=t;t+=l,n.push({p1:a,p2:s,totalDistance:t,distance:l,lastTotalDistance:f})}for(var d=t*r,y,b,T=0,M=n;T<M.length;T++){var P=M[T],k=P.totalDistance;if(k>d){var H=P.p1,q=P.p2,ae=(d-P.lastTotalDistance)/P.distance,Se=ll(q,H,ae);y=Se[0],b=Se[1];break}}return{lng:y,lat:b,height:0}}function ll(e,r,t){return[e[0]*t+r[0]*(1-t),e[1]*t+r[1]*(1-t)]}function af(e,r){return Math.sqrt(Math.pow(e[0]-r[0],2)+Math.pow(e[1]-r[1],2))}function of(e,r){var t=r.featureId,n=e.data.dataArray;return typeof t=="number"&&(n=n.filter(function(i){var a=i.id;return a===t})),n.map(function(i){var a=Us(i,r);return _objectSpread(_objectSpread({},i),a)})}function _u(e,r){return new Promise(function(t){e.inited?t(of(e,r)):e.once("update",function(){t(of(e,r))})})}function Us(e,r){var t=r.offset,n=r.shape,i=r.thetaOffset,a=r.mapVersion,s=r.segmentNumber,l=s===void 0?30:s,f=r.autoFit,d=f===void 0?!0:f,y=e.coordinates;if(n==="line")return pathLineAtOffset(y,t);var b=y[0],T=y[1],M=typeof i=="string"?e[i]||0:i,P;switch(n){case"arc":P=arcLineAtOffset;break;case"greatcircle":P=greatCircleLineAtOffset;break;default:P=arcLineAtOffset}var k=P(b,T,t,M,a,l,d),H=_slicedToArray(k,3),q=H[0],ae=H[1],Se=H[2];return{lng:q,lat:ae,height:Se}}var Ff=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:50,t=arguments.length>1?arguments[1]:void 0;(0,Q.Z)(this,e),this.limit=r,this.destroy=t||this.defaultDestroy,this.order=[],this.clear()}return(0,j.Z)(e,[{key:"clear",value:function(){var t=this;this.order.forEach(function(n){t.delete(n)}),this.cache={},this.order=[]}},{key:"get",value:function(t){var n=this.cache[t];return n&&(this.deleteOrder(t),this.appendOrder(t)),n}},{key:"set",value:function(t,n){this.cache[t]?(this.delete(t),this.cache[t]=n,this.appendOrder(t)):(Object.keys(this.cache).length===this.limit&&this.delete(this.order[0]),this.cache[t]=n,this.appendOrder(t))}},{key:"delete",value:function(t){var n=this.cache[t];n&&(this.deleteCache(t),this.deleteOrder(t),this.destroy(n,t))}},{key:"deleteCache",value:function(t){delete this.cache[t]}},{key:"deleteOrder",value:function(t){var n=this.order.findIndex(function(i){return i===t});n>=0&&this.order.splice(n,1)}},{key:"appendOrder",value:function(t){this.order.push(t)}},{key:"defaultDestroy",value:function(t,n){return null}}]),e}();function Nf(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r*1}function gs(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r*1}function yu(e){if(e.length===0)return 0;for(var r=e[0]*1,t=1;t<e.length;t++)r+=e[t]*1;return r}function hp(e){if(e.length===0)throw new Error("mean requires at least one data point");return yu(e)/e.length}function wc(e){if(e.length===0)throw new Error("mean requires at least one data point");if(e.length<3)return e[0];e.sort();for(var r=e[0],t=NaN,n=0,i=1,a=1;a<e.length+1;a++)e[a]!==r?(i>n&&(n=i,t=r),i=1,r=e[a]):i++;return t*1}var Cc={min:gs,max:Nf,mean:hp,sum:yu,mode:wc};function Uf(e,r){return e.map(function(t){return t[r]})}function Js(e,r){return Cc[e](r)}var Zt=U(94693),Re=U(1378),F=U(88357),eu=U(22887),_e=U.n(eu);function Pl(e,r){r===void 0&&(r={});var t=Number(e[0]),n=Number(e[1]),i=Number(e[2]),a=Number(e[3]);if(e.length===6)throw new Error("@turf/bbox-polygon does not support BBox with 6 positions");var s=[t,n],l=[t,a],f=[i,a],d=[i,n];return dr([[s,d,f,l,s]],r.properties,{bbox:e,id:r.id})}var qa=U(11312),zs=U.n(qa),Ro=function(e){return e.Realtime="realtime",e.Overlap="overlap",e.Replace="replace",e}({}),_s=function(e){return e.Loading="Loading",e.Loaded="Loaded",e.Failure="Failure",e.Cancelled="Cancelled",e}({}),Dn=0,An=1,as=2;function os(e){e.forEach(function(r){r.isCurrent&&(r.isVisible=r.isLoaded)})}function xu(e){e.forEach(function(r){r.properties.state=Dn}),e.forEach(function(r){r.isCurrent&&!tu(r)&&bu(r)}),e.forEach(function(r){r.isVisible=!!(r.properties.state&as)})}function Ba(e){e.forEach(function(t){t.properties.state=Dn}),e.forEach(function(t){t.isCurrent&&tu(t)});var r=e.slice().sort(function(t,n){return t.z-n.z});r.forEach(function(t){t.isVisible=!!(t.properties.state&as),t.children.length&&(t.isVisible||t.properties.state&An)?t.children.forEach(function(n){n.properties.state=An}):t.isCurrent&&bu(t)})}function tu(e){for(;e;){if(e.isLoaded)return e.properties.state|=as,!0;e=e.parent}return!1}function bu(e){e.children.forEach(function(r){r.isLoaded?r.properties.state|=as:bu(r)})}var Eu,oa=256,mo=[-1/0,-1/0,1/0,1/0],Sh=.2,Ol=5,zf=(Eu={},(0,F.Z)(Eu,Ro.Realtime,os),(0,F.Z)(Eu,Ro.Overlap,xu),(0,F.Z)(Eu,Ro.Replace,Ba),Eu),cl=function(){};function ys(e,r,t){var n=Math.floor((e+180)/360*Math.pow(2,t)),i=Math.floor((1-Math.log(Math.tan(r*Math.PI/180)+1/Math.cos(r*Math.PI/180))/Math.PI)/2*Math.pow(2,t));return[n,i]}function ec(e,r,t){var n=e/Math.pow(2,t)*360-180,i=Math.PI-2*Math.PI*r/Math.pow(2,t),a=180/Math.PI*Math.atan(.5*(Math.exp(i)-Math.exp(-i)));return[n,a]}var Su=function(r,t,n){var i=ec(r,t,n),a=(0,yn.Z)(i,2),s=a[0],l=a[1],f=ec(r+1,t+1,n),d=(0,yn.Z)(f,2),y=d[0],b=d[1];return[s,b,y,l]};function Zf(e){var r=e.zoom,t=e.latLonBounds,n=e.maxZoom,i=n===void 0?1/0:n,a=e.minZoom,s=a===void 0?0:a,l=e.zoomOffset,f=l===void 0?0:l,d=e.extent,y=d===void 0?mo:d,b=Math.ceil(r)+f;if(Number.isFinite(s)&&b<s)return[];Number.isFinite(i)&&b>i&&(b=i);for(var T=(0,yn.Z)(t,4),M=T[0],P=T[1],k=T[2],H=T[3],q=[Math.max(M,y[0]),Math.max(P,y[1]),Math.min(k,y[2]),Math.min(H,y[3])],ae=[],Se=ys(q[0],q[1],b),ze=(0,yn.Z)(Se,2),it=ze[0],ut=ze[1],ot=ys(q[2],q[3],b),Ct=(0,yn.Z)(ot,2),Xt=Ct[0],Sr=Ct[1],_r=it;_r<=Xt;_r++)for(var Wr=Sr;Wr<=ut;Wr++)ae.push({x:_r,y:Wr,z:b});var Cn=(Xt+it)/2,wi=(ut+Sr)/2,ua=function(Xo,No){return Math.abs(Xo-Cn)+Math.abs(No-wi)};return ae.sort(function(co,Xo){return ua(co.x,co.y)-ua(Xo.x,Xo.y)}),ae}var Rc=function(r,t,n){var i=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!0,a=Math.pow(2,n),s=a-1,l=a,f=r,d=t;return i&&(f<0?f=f+l:f>s&&(f=f%l)),{warpX:f,warpY:d}};function sf(e){var r=Vf();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function Vf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var tc=function(e){(0,Le.Z)(t,e);var r=sf(t);function t(n){var i;(0,Q.Z)(this,t),i=r.call(this),(0,F.Z)((0,Re.Z)(i),"tileSize",256),(0,F.Z)((0,Re.Z)(i),"isVisible",!1),(0,F.Z)((0,Re.Z)(i),"isCurrent",!1),(0,F.Z)((0,Re.Z)(i),"isVisibleChange",!1),(0,F.Z)((0,Re.Z)(i),"loadedLayers",0),(0,F.Z)((0,Re.Z)(i),"isLayerLoaded",!1),(0,F.Z)((0,Re.Z)(i),"isLoad",!1),(0,F.Z)((0,Re.Z)(i),"isChildLoad",!1),(0,F.Z)((0,Re.Z)(i),"parent",null),(0,F.Z)((0,Re.Z)(i),"children",[]),(0,F.Z)((0,Re.Z)(i),"data",null),(0,F.Z)((0,Re.Z)(i),"properties",{}),(0,F.Z)((0,Re.Z)(i),"loadDataId",0);var a=n.x,s=n.y,l=n.z,f=n.tileSize,d=n.warp,y=d===void 0?!0:d;return i.x=a,i.y=s,i.z=l,i.warp=y||!0,i.tileSize=f,i}return(0,j.Z)(t,[{key:"isLoading",get:function(){return this.loadStatus===_s.Loading}},{key:"isLoaded",get:function(){return this.loadStatus===_s.Loaded}},{key:"isFailure",get:function(){return this.loadStatus===_s.Failure}},{key:"setTileLayerLoaded",value:function(){this.isLayerLoaded=!0}},{key:"isCancelled",get:function(){return this.loadStatus===_s.Cancelled}},{key:"isDone",get:function(){return[_s.Loaded,_s.Cancelled,_s.Failure].includes(this.loadStatus)}},{key:"bounds",get:function(){return Su(this.x,this.y,this.z)}},{key:"bboxPolygon",get:function(){var i=(0,yn.Z)(this.bounds,4),a=i[0],s=i[1],l=i[2],f=i[3],d=[(l-a)/2,(f-s)/2],y=Pl(this.bounds,{properties:{key:this.key,id:this.key,bbox:this.bounds,center:d,meta:`
      `.concat(this.key,`
      `)}});return y}},{key:"key",get:function(){var i="".concat(this.x,"_").concat(this.y,"_").concat(this.z);return i}},{key:"layerLoad",value:function(){this.loadedLayers++,this.emit("layerLoaded")}},{key:"loadData",value:function(){var n=(0,Zt.Z)(_e().mark(function a(s){var l,f,d,y,b,T,M,P,k,H,q,ae,Se,ze,it,ut,ot;return _e().wrap(function(Xt){for(;;)switch(Xt.prev=Xt.next){case 0:return l=s.getData,f=s.onLoad,d=s.onError,this.loadDataId++,y=this.loadDataId,this.isLoading&&this.abortLoad(),this.abortController=new AbortController,this.loadStatus=_s.Loading,b=null,Xt.prev=7,M=this.x,P=this.y,k=this.z,H=this.bounds,q=this.tileSize,ae=this.warp,Se=Rc(M,P,k,ae),ze=Se.warpX,it=Se.warpY,ut=this.abortController.signal,ot={x:ze,y:it,z:k,bounds:H,tileSize:q,signal:ut,warp:ae},Xt.next=14,l(ot,this);case 14:b=Xt.sent,Xt.next=20;break;case 17:Xt.prev=17,Xt.t0=Xt.catch(7),T=Xt.t0;case 20:if(y===this.loadDataId){Xt.next=22;break}return Xt.abrupt("return");case 22:if(!(this.isCancelled&&!b)){Xt.next=24;break}return Xt.abrupt("return");case 24:if(!(T||!b)){Xt.next=28;break}return this.loadStatus=_s.Failure,d(T,this),Xt.abrupt("return");case 28:this.loadStatus=_s.Loaded,this.data=b,f(this);case 31:case"end":return Xt.stop()}},a,this,[[7,17]])}));function i(a){return n.apply(this,arguments)}return i}()},{key:"reloadData",value:function(i){this.isLoading&&this.abortLoad(),this.loadData(i)}},{key:"abortLoad",value:function(){this.isLoaded||this.isCancelled||(this.loadStatus=_s.Cancelled,this.abortController.abort(),this.xhrCancel&&this.xhrCancel())}}]),t}(qa.EventEmitter),rc=function(r,t){var n=Ql(r),i=Zu(n,t),a=360*3-180,s=85.0511287798065,l=[Math.max(i[0][0],-a),Math.max(i[0][1],-s),Math.min(i[1][0],a),Math.min(i[1][1],s)];return l},Ah=function(r,t){var n=Ql(r),i=Ql(t),a=da(n,i);return a};function ss(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Au(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Au(e,r){if(e){if(typeof e=="string")return uf(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return uf(e,r)}}function uf(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function kl(e){var r=uu();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function uu(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Th=ui.throttle,ju=function(e){return e.TilesLoadStart="tiles-load-start",e.TileLoaded="tile-loaded",e.TileError="tile-error",e.TileUnload="tile-unload",e.TileUpdate="tile-update",e.TilesLoadFinished="tiles-load-finished",e}({}),jf=function(e){(0,Le.Z)(t,e);var r=kl(t);function t(n){var i;return(0,Q.Z)(this,t),i=r.call(this),(0,F.Z)((0,Re.Z)(i),"currentTiles",[]),(0,F.Z)((0,Re.Z)(i),"cacheTiles",new Map),(0,F.Z)((0,Re.Z)(i),"throttleUpdate",Th(function(a,s){i.update(a,s)},16)),(0,F.Z)((0,Re.Z)(i),"onTileLoad",function(a){i.emit(ju.TileLoaded,a),i.updateTileVisible(),i.loadFinished()}),(0,F.Z)((0,Re.Z)(i),"onTileError",function(a,s){i.emit(ju.TileError,{error:a,tile:s}),i.updateTileVisible(),i.loadFinished()}),(0,F.Z)((0,Re.Z)(i),"onTileUnload",function(a){i.emit(ju.TileUnload,a),i.loadFinished()}),i.options={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,extent:mo,getTileData:cl,warp:!0,updateStrategy:Ro.Replace},i.updateOptions(n),i}return(0,j.Z)(t,[{key:"isLoaded",get:function(){return this.currentTiles.every(function(i){return i.isDone})}},{key:"tiles",get:function(){var i=Array.from(this.cacheTiles.values()).sort(function(a,s){return a.z-s.z});return i}},{key:"updateOptions",value:function(i){var a=i.minZoom===void 0?this.options.minZoom:Math.ceil(i.minZoom),s=i.maxZoom===void 0?this.options.maxZoom:Math.floor(i.maxZoom);this.options=(0,W.Z)((0,W.Z)((0,W.Z)({},this.options),i),{},{minZoom:a,maxZoom:s})}},{key:"update",value:function(i,a){var s=this,l=Math.max(0,Math.ceil(i));if(!(this.lastViewStates&&this.lastViewStates.zoom===l&&Ah(this.lastViewStates.latLonBoundsBuffer,a))){var f=rc(a,Sh);this.lastViewStates={zoom:l,latLonBounds:a,latLonBoundsBuffer:f},this.currentZoom=l;var d=!1,y=this.getTileIndices(l,f).filter(function(b){return s.options.warp||b.x>=0&&b.x<Math.pow(2,l)});this.emit(ju.TilesLoadStart),this.currentTiles=y.map(function(b){var T=b.x,M=b.y,P=b.z,k=s.getTile(T,M,P);if(k){var H,q,ae=((H=k)===null||H===void 0?void 0:H.isFailure)||((q=k)===null||q===void 0?void 0:q.isCancelled);return ae&&k.loadData({getData:s.options.getTileData,onLoad:s.onTileLoad,onError:s.onTileError}),k}return k=s.createTile(T,M,P),d=!0,k}),d&&this.resizeCacheTiles(),this.updateTileVisible(),this.pruneRequests()}}},{key:"reloadAll",value:function(){var i=ss(this.cacheTiles),a;try{for(i.s();!(a=i.n()).done;){var s=(0,yn.Z)(a.value,2),l=s[0],f=s[1];if(!this.currentTiles.includes(f)){this.cacheTiles.delete(l),this.onTileUnload(f);return}this.onTileUnload(f),f.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError})}}catch(d){i.e(d)}finally{i.f()}}},{key:"reloadTileById",value:function(i,a,s){var l=this.cacheTiles.get("".concat(a,",").concat(s,",").concat(i));l&&(this.onTileUnload(l),l.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}))}},{key:"reloadTileByLnglat",value:function(i,a,s){var l=this.getTileByLngLat(i,a,s);l&&this.reloadTileById(l.z,l.x,l.y)}},{key:"reloadTileByExtent",value:function(i,a){var s=this,l=this.getTileIndices(a,i);l.forEach(function(f){s.reloadTileById(f.z,f.x,f.y)})}},{key:"pruneRequests",value:function(){var i=[],a=ss(this.cacheTiles.values()),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;l.isLoading&&!l.isCurrent&&!l.isVisible&&i.push(l)}}catch(d){a.e(d)}finally{a.f()}for(;i.length>0;){var f=i.shift();f.abortLoad()}}},{key:"getTileByLngLat",value:function(i,a,s){var l=this.options.zoomOffset,f=Math.ceil(s)+l,d=ys(i,a,f),y=this.tiles.filter(function(b){return b.key==="".concat(d[0],"_").concat(d[1],"_").concat(f)});return y[0]}},{key:"getTileExtent",value:function(i,a){return this.getTileIndices(a,i)}},{key:"getTileByZXY",value:function(i,a,s){var l=this.tiles.filter(function(f){return f.key==="".concat(a,"_").concat(s,"_").concat(i)});return l[0]}},{key:"clear",value:function(){var i=ss(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;s.isLoading?s.abortLoad():this.onTileUnload(s)}}catch(l){i.e(l)}finally{i.f()}this.lastViewStates=void 0,this.cacheTiles.clear(),this.currentTiles=[]}},{key:"destroy",value:function(){this.clear(),this.removeAllListeners()}},{key:"updateTileVisible",value:function(){var i=this.options.updateStrategy,a=new Map,s=ss(this.cacheTiles.values()),l;try{for(s.s();!(l=s.n()).done;){var f=l.value;a.set(f.key,f.isVisible),f.isCurrent=!1,f.isVisible=!1}}catch(P){s.e(P)}finally{s.f()}var d=ss(this.currentTiles),y;try{for(d.s();!(y=d.n()).done;){var b=y.value;b.isCurrent=!0,b.isVisible=!0}}catch(P){d.e(P)}finally{d.f()}var T=Array.from(this.cacheTiles.values());typeof i=="function"?i(T):zf[i](T);var M=!1;Array.from(this.cacheTiles.values()).forEach(function(P){P.isVisible!==a.get(P.key)?(P.isVisibleChange=!0,M=!0):P.isVisibleChange=!1}),M&&this.emit(ju.TileUpdate)}},{key:"getTileIndices",value:function(i,a){var s=this.options,l=s.tileSize,f=s.extent,d=s.zoomOffset,y=Math.floor(this.options.maxZoom),b=Math.ceil(this.options.minZoom),T=Zf({maxZoom:y,minZoom:b,zoomOffset:d,tileSize:l,zoom:i,latLonBounds:a,extent:f});return T}},{key:"getTileId",value:function(i,a,s){var l="".concat(i,",").concat(a,",").concat(s);return l}},{key:"loadFinished",value:function(){var i=!this.currentTiles.some(function(a){return!a.isDone});return i&&this.emit(ju.TilesLoadFinished),i}},{key:"getTile",value:function(i,a,s){var l=this.getTileId(i,a,s),f=this.cacheTiles.get(l);return f}},{key:"createTile",value:function(i,a,s){var l=this.getTileId(i,a,s),f=new tc({x:i,y:a,z:s,tileSize:this.options.tileSize,warp:this.options.warp});return this.cacheTiles.set(l,f),f.loadData({getData:this.options.getTileData,onLoad:this.onTileLoad,onError:this.onTileError}),f}},{key:"resizeCacheTiles",value:function(){var i=Ol*this.currentTiles.length,a=this.cacheTiles.size>i;if(a){var s=ss(this.cacheTiles),l;try{for(s.s();!(l=s.n()).done;){var f=(0,yn.Z)(l.value,2),d=f[0],y=f[1];if(!y.isVisible&&!this.currentTiles.includes(y)&&(this.cacheTiles.delete(d),this.onTileUnload(y)),this.cacheTiles.size<=i)break}}catch(b){s.e(b)}finally{s.f()}}this.rebuildTileTree()}},{key:"rebuildTileTree",value:function(){var i=ss(this.cacheTiles.values()),a;try{for(i.s();!(a=i.n()).done;){var s=a.value;s.parent=null,s.children.length=0}}catch(b){i.e(b)}finally{i.f()}var l=ss(this.cacheTiles.values()),f;try{for(l.s();!(f=l.n()).done;){var d=f.value,y=this.getNearestAncestor(d.x,d.y,d.z);d.parent=y,y!=null&&y.children&&y.children.push(d)}}catch(b){l.e(b)}finally{l.f()}}},{key:"getNearestAncestor",value:function(i,a,s){for(;s>this.options.minZoom;){i=Math.floor(i/2),a=Math.floor(a/2),s=s-1;var l=this.getTile(i,a,s);if(l)return l}return null}}]),t}(zs());function wh(e){return/(?=.*{box})(?=.*{z})(?=.*{x})(?=.*({y}|{-y}))/.test(e)}function h(e){var r=[],t=/\{([a-z])-([a-z])\}/.exec(e);if(t){var n=t[1].charCodeAt(0),i=t[2].charCodeAt(0),a;for(a=n;a<=i;++a)r.push(e.replace(t[0],String.fromCharCode(a)));return r}if(t=/\{(\d+)-(\d+)\}/.exec(e),t){for(var s=parseInt(t[2],10),l=parseInt(t[1],10);l<=s;l++)r.push(e.replace(t[0],l.toString()));return r}return r.push(e),r}function v(e,r){if(!e||!e.length)throw new Error("url is not allowed to be empty");var t=r.x,n=r.y,i=r.z,a=h(e),s=Math.abs(t+n)%a.length,l=ei(a[s])?"".concat(a[s],"/{z}/{x}/{y}"):a[s];return l.replace(/\{x\}/g,t.toString()).replace(/\{y\}/g,n.toString()).replace(/\{z\}/g,i.toString()).replace(/\{bbox\}/g,Su(t,n,i).join(",")).replace(/\{-y\}/g,(Math.pow(2,i)-n-1).toString())}function p(e,r){var t=r.x,n=r.y,i=r.z,a=r.layer,s=r.version,l=s===void 0?"1.0.0":s,f=r.style,d=f===void 0?"default":f,y=r.format,b=r.service,T=b===void 0?"WMTS":b,M=r.tileMatrixset,P="".concat(e,"&SERVICE=").concat(T,"&REQUEST=GetTile&VERSION=").concat(l,"&LAYER=").concat(a,"&STYLE=").concat(d,"&TILEMATRIXSET=").concat(M,"&FORMAT=").concat(y,"&TILECOL=").concat(t,"&TILEROW=").concat(n,"&TILEMATRIX=").concat(i);return P}function g(e,r){if(!e)throw new Error(r||"web worker helper assertion failed.")}var S={self:typeof self!="undefined"&&self,window:typeof window!="undefined"&&window,document:typeof document!="undefined"&&document},w=S.self||S.window||{},C=S.window||S.self||{},O=S.self||S.window||{},X=S.document||{},J=typeof importScripts=="function",me=typeof window!="undefined"&&typeof window.orientation!="undefined",ye=function(){function e(r,t){var n=this;this.name=r,this.workerThread=t,this.isRunning=!0,this.resolve=function(){},this.reject=function(){},this.result=new Promise(function(i,a){n.resolve=i,n.reject=a})}return e.prototype.postMessage=function(r,t){this.workerThread.postMessage({source:"Main thread",type:r,payload:t})},e.prototype.done=function(r){g(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.resolve(r)},e.prototype.error=function(r){g(this.isRunning,"WorkerJob isRunning false."),this.isRunning=!1,this.reject(r)},e}(),Ae=ye,Ve=new Map;function Ue(e){g(e.source&&!e.url||!e.source&&e.url);var r=Ve.get(e.source||e.url);return r||(e.url&&(r=lt(e.url),Ve.set(e.url,r)),e.source&&(r=Be(e.source),Ve.set(e.source,r))),g(r),r}function lt(e){if(!e.startsWith("http"))return e;var r=st(e);return Be(r)}function Be(e){var r=new Blob([e],{type:"application/javascript"});return URL.createObjectURL(r)}function st(e){return`try {
  importScripts('`+e+`');
} catch (error) {
  console.error(error);
  throw error;
}`}function xt(e,r,t){r===void 0&&(r=!0);var n=t||new Set;if(e){if(Ut(e))n.add(e);else if(Ut(e.buffer))n.add(e.buffer);else if(!ArrayBuffer.isView(e)){if(r&&typeof e=="object")for(var i in e)xt(e[i],r,n)}}return t===void 0?Array.from(n):[]}function Ut(e){return e?e instanceof ArrayBuffer||typeof MessagePort!="undefined"&&e instanceof MessagePort||typeof ImageBitmap!="undefined"&&e instanceof ImageBitmap||typeof OffscreenCanvas!="undefined"&&e instanceof OffscreenCanvas:!1}var ar=function(){},qt=function(){function e(r){this.terminated=!1,this.loadableURL="";var t=r.name,n=r.source,i=r.url;g(n||i),this.name=t,this.source=n,this.url=i,this.onMessage=ar,this.onError=function(a){return console.log(a)},this.worker=this.createBrowserWorker()}return e.isSupported=function(){return typeof Worker!="undefined"},e.prototype.destroy=function(){this.onMessage=ar,this.onError=ar,this.worker.terminate(),this.terminated=!0},Object.defineProperty(e.prototype,"isRunning",{get:function(){return!!this.onMessage},enumerable:!1,configurable:!0}),e.prototype.postMessage=function(r,t){t=t||xt(r),this.worker.postMessage(r,t)},e.prototype.getErrorFromErrorEvent=function(r){var t="Failed to load ";return t+="worker "+this.name+" from "+this.url+". ",r.message&&(t+=r.message+" in "),r.lineno&&(t+=":"+r.lineno+":"+r.colno),new Error(t)},e.prototype.createBrowserWorker=function(){var r=this;this.loadableURL=Ue({source:this.source,url:this.url});var t=new Worker(this.loadableURL,{name:this.name});return t.onmessage=function(n){n.data?r.onMessage(n.data):r.onError(new Error("No data received"))},t.onerror=function(n){r.onError(r.getErrorFromErrorEvent(n)),r.terminated=!0},t.onmessageerror=function(n){return console.error("worker "+r.name+", message error: "+n)},t},e}(),fr=qt,br=function(){return br=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},br.apply(this,arguments)},jr=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(y){try{d(n.next(y))}catch(b){s(b)}}function f(y){try{d(n.throw(y))}catch(b){s(b)}}function d(y){y.done?a(y.value):i(y.value).then(l,f)}d((n=n.apply(e,r||[])).next())})},Fr=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(y){return f([d,y])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(y){d=[6,y],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},hn=function(){function e(r){this.name="unnamed",this.maxConcurrency=1,this.maxMobileConcurrency=1,this.onDebug=function(){},this.reuseWorkers=!0,this.props={},this.jobQueue=[],this.idleQueue=[],this.count=0,this.isDestroyed=!1,this.source=r.source,this.url=r.url,this.setProps(r)}return e.prototype.destroy=function(){this.idleQueue.forEach(function(r){return r.destroy()}),this.isDestroyed=!0},e.prototype.setProps=function(r){this.props=br(br({},this.props),r),r.name!==void 0&&(this.name=r.name),r.maxConcurrency!==void 0&&(this.maxConcurrency=r.maxConcurrency),r.maxMobileConcurrency!==void 0&&(this.maxMobileConcurrency=r.maxMobileConcurrency),r.reuseWorkers!==void 0&&(this.reuseWorkers=r.reuseWorkers),r.onDebug!==void 0&&(this.onDebug=r.onDebug)},e.prototype.startJob=function(r,t,n){return t===void 0&&(t=function(i,a,s){return i.done(s)}),n===void 0&&(n=function(i,a){return i.error(a)}),jr(this,void 0,void 0,function(){var i,a=this;return Fr(this,function(s){switch(s.label){case 0:return i=new Promise(function(l){return a.jobQueue.push({name:r,onMessage:t,onError:n,onStart:l}),a}),this.startQueuedJob(),[4,i];case 1:return[2,s.sent()]}})})},e.prototype.startQueuedJob=function(){return jr(this,void 0,void 0,function(){var r,t,n;return Fr(this,function(i){switch(i.label){case 0:if(!this.jobQueue.length)return[2];if(r=this.getAvailableWorker(),!r)return[2];if(t=this.jobQueue.shift(),!t)return[3,4];this.onDebug({message:"Starting job",name:t.name,backlog:this.jobQueue.length,workerThread:r}),n=new Ae(t.name,r),r.onMessage=function(a){return t.onMessage(n,a.type,a.payload)},r.onError=function(a){return t.onError(n,a)},t.onStart(n),i.label=1;case 1:return i.trys.push([1,,3,4]),[4,n.result];case 2:return i.sent(),[3,4];case 3:return this.returnWorkerToQueue(r),[7];case 4:return[2]}})})},e.prototype.returnWorkerToQueue=function(r){var t=this.isDestroyed||!this.reuseWorkers||this.count>this.getMaxConcurrency();t?(r.destroy(),this.count--):this.idleQueue.push(r),this.isDestroyed||this.startQueuedJob()},e.prototype.getAvailableWorker=function(){if(this.idleQueue.length>0)return this.idleQueue.shift()||null;if(this.count<this.getMaxConcurrency()){this.count++;var r=this.name.toLowerCase()+" (#"+this.count+" of "+this.maxConcurrency+")";return new fr({name:r,source:this.source,url:this.url})}return null},e.prototype.getMaxConcurrency=function(){return me?this.maxMobileConcurrency:this.maxConcurrency},e}(),Un=hn,Ln=function(){return Ln=Object.assign||function(e){for(var r,t=1,n=arguments.length;t<n;t++){r=arguments[t];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(e[i]=r[i])}return e},Ln.apply(this,arguments)},zn=function(e){var r=typeof Symbol=="function"&&Symbol.iterator,t=r&&e[r],n=0;if(t)return t.call(e);if(e&&typeof e.length=="number")return{next:function(){return e&&n>=e.length&&(e=void 0),{value:e&&e[n++],done:!e}}};throw new TypeError(r?"Object is not iterable.":"Symbol.iterator is not defined.")},Ui={maxConcurrency:3,maxMobileConcurrency:1,onDebug:function(){},reuseWorkers:!0},gn=function(){function e(r){this.workerPools=new Map,this.props=Ln({},Ui),this.setProps(r),this.workerPools=new Map}return e.isSupported=function(){return fr.isSupported()},e.getWorkerFarm=function(r){return r===void 0&&(r={}),e.workerFarm=e.workerFarm||new e({}),e.workerFarm.setProps(r),e.workerFarm},e.prototype.destroy=function(){var r,t;try{for(var n=zn(this.workerPools.values()),i=n.next();!i.done;i=n.next()){var a=i.value;a.destroy()}}catch(s){r={error:s}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setProps=function(r){var t,n;this.props=Ln(Ln({},this.props),r);try{for(var i=zn(this.workerPools.values()),a=i.next();!a.done;a=i.next()){var s=a.value;s.setProps(this.getWorkerPoolProps())}}catch(l){t={error:l}}finally{try{a&&!a.done&&(n=i.return)&&n.call(i)}finally{if(t)throw t.error}}},e.prototype.getWorkerPool=function(r){var t=r.name,n=r.source,i=r.url,a=this.workerPools.get(t);return a||(a=new Un({name:t,source:n,url:i}),a.setProps(this.getWorkerPoolProps()),this.workerPools.set(t,a)),a},e.prototype.getWorkerPoolProps=function(){return{maxConcurrency:this.props.maxConcurrency,maxMobileConcurrency:this.props.maxMobileConcurrency,reuseWorkers:this.props.reuseWorkers,onDebug:this.props.onDebug}},e}(),ii=null,pi=new Map,ri=function(){function e(){}return Object.defineProperty(e,"onmessage",{set:function(r){self.onmessage=function(t){if(fi(t)){var n=t.data,i=n.type,a=n.payload;r(i,a)}}},enumerable:!1,configurable:!0}),e.addEventListener=function(r){var t=pi.get(r);t||(t=function(n){if(fi(n)){var i=n.data,a=i.type,s=i.payload;r(a,s)}}),self.addEventListener("message",t)},e.removeEventListener=function(r){var t=pi.get(r);pi.delete(r),self.removeEventListener("message",t)},e.postMessage=function(r,t){if(self){var n={source:"Worker thread",type:r,payload:t},i=xt(t);self.postMessage(n,i)}},e}(),Qn=null;function fi(e){var r=e.type,t=e.data;return r==="message"&&t&&typeof t.source=="string"&&t.source==="Main thread"}function Jn(e){return JSON.parse(Xn(e))}function Xn(e){var r=new Set;return JSON.stringify(e,function(t,n){if(typeof n=="object"&&n!==null){if(r.has(n))try{return JSON.parse(JSON.stringify(n))}catch(i){return}r.add(n)}return n})}function Mo(e){return""+e.name}function Ka(e,r){r===void 0&&(r={});var t=r[e.id]||{},n=e.name+".worker.js",i=t.workerUrl;return r._workerType==="test"&&(i=e.module+"/dist/"+n),i||(i="https://unpkg.com/"+e.module+"/dist/"+n),assert(i),i}var Io=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(y){try{d(n.next(y))}catch(b){s(b)}}function f(y){try{d(n.throw(y))}catch(b){s(b)}}function d(y){y.done?a(y.value):i(y.value).then(l,f)}d((n=n.apply(e,r||[])).next())})},go=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(y){return f([d,y])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(y){d=[6,y],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}};function Ha(e,r){return WorkerFarm.isSupported()?e.worker&&(r==null?void 0:r.worker):!1}function Qa(e,r,t,n){return t===void 0&&(t={}),n===void 0&&(n={}),Io(this,void 0,void 0,function(){var i,a,s,l,f,d,y,b;return go(this,function(T){switch(T.label){case 0:return i=getWorkerName(e),a=getWorkerURL(e,t),s=WorkerFarm.getWorkerFarm(t),l=s.getWorkerPool({name:i,url:a}),f=t.jobName||e.name,[4,l.startJob(f,xs.bind(null,n))];case 1:return d=T.sent(),y=removeNontransferableOptions(t),d.postMessage("process",{input:r,options:y}),[4,d.result];case 2:return b=T.sent(),[2,b.result]}})})}function xs(e,r,t,n){return Io(this,void 0,void 0,function(){var i,a,s,l,f,d,y;return go(this,function(b){switch(b.label){case 0:switch(i=t,i){case"done":return[3,1];case"error":return[3,2];case"process":return[3,3]}return[3,8];case 1:return r.done(n),[3,9];case 2:return r.error(new Error(n.error)),[3,9];case 3:a=n.id,s=n.input,l=n.options,b.label=4;case 4:return b.trys.push([4,6,,7]),e.process?[4,e.process(s,l)]:(r.postMessage("error",{id:a,error:"Worker not set up to process on main thread"}),[2]);case 5:return f=b.sent(),r.postMessage("done",{id:a,result:f}),[3,7];case 6:return d=b.sent(),y=d instanceof Error?d.message:"unknown error",r.postMessage("error",{id:a,error:y}),[3,7];case 7:return[3,9];case 8:console.warn("process-on-worker: unknown message "+t),b.label=9;case 9:return[2]}})})}var bs=function(){function e(){this._values=[],this._settlers=[],this._closed=!1}return e.prototype[Symbol.asyncIterator]=function(){return this},e.prototype.push=function(r){return this.enqueue(r)},e.prototype.enqueue=function(r){if(this._closed)throw new Error("Closed");if(this._settlers.length>0){if(this._values.length>0)throw new Error("Illegal internal state");var t=this._settlers.shift();r instanceof Error?t.reject(r):t.resolve({value:r})}else this._values.push(r)},e.prototype.close=function(){for(;this._settlers.length>0;){var r=this._settlers.shift();r.resolve({done:!0})}this._closed=!0},e.prototype.next=function(){var r=this;if(this._values.length>0){var t=this._values.shift();return t instanceof Error?Promise.reject(t):Promise.resolve({done:!1,value:t})}if(this._closed){if(this._settlers.length>0)throw new Error("Illegal internal state");return Promise.resolve({done:!0,value:void 0})}return new Promise(function(n,i){r._settlers.push({resolve:n,reject:i})})},e}(),fl=null,Es=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(y){try{d(n.next(y))}catch(b){s(b)}}function f(y){try{d(n.throw(y))}catch(b){s(b)}}function d(y){y.done?a(y.value):i(y.value).then(l,f)}d((n=n.apply(e,r||[])).next())})},lu=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(y){return f([d,y])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(y){d=[6,y],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},Zs=function(e){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var r=e[Symbol.asyncIterator],t;return r?r.call(e):(e=typeof __values=="function"?__values(e):e[Symbol.iterator](),t={},n("next"),n("throw"),n("return"),t[Symbol.asyncIterator]=function(){return this},t);function n(a){t[a]=e[a]&&function(s){return new Promise(function(l,f){s=e[a](s),i(l,f,s.done,s.value)})}}function i(a,s,l,f){Promise.resolve(f).then(function(d){a({value:d,done:l})},s)}},Mc=0,Hu,Tu;function nc(e,r){var t=this;if(typeof self!="undefined"){var n={process:hl};WorkerBody.onmessage=function(i,a){return Es(t,void 0,void 0,function(){var s,l,f,d,y,b,T,M,P,k,H;return lu(this,function(q){switch(q.label){case 0:switch(q.trys.push([0,19,,20]),s=i,s){case"process":return[3,1];case"process-in-batches":return[3,3];case"input-batch":return[3,16];case"input-done":return[3,17]}return[3,18];case 1:if(!e)throw new Error("Worker does not support atomic processing");return[4,e(a.input,a.options||{},n)];case 2:return l=q.sent(),WorkerBody.postMessage("done",{result:l}),[3,18];case 3:if(!r)throw new Error("Worker does not support batched processing");Hu=new AsyncQueue,Tu=a.options||{},f=r(Hu,Tu,n),q.label=4;case 4:q.trys.push([4,9,10,15]),d=Zs(f),q.label=5;case 5:return[4,d.next()];case 6:if(y=q.sent(),!!y.done)return[3,8];b=y.value,WorkerBody.postMessage("output-batch",{result:b}),q.label=7;case 7:return[3,5];case 8:return[3,15];case 9:return T=q.sent(),k={error:T},[3,15];case 10:return q.trys.push([10,,13,14]),y&&!y.done&&(H=d.return)?[4,H.call(d)]:[3,12];case 11:q.sent(),q.label=12;case 12:return[3,14];case 13:if(k)throw k.error;return[7];case 14:return[7];case 15:return WorkerBody.postMessage("done",{}),[3,18];case 16:return Hu.push(a.input),[3,18];case 17:return Hu.close(),[3,18];case 18:return[3,20];case 19:return M=q.sent(),P=M instanceof Error?M.message:"",WorkerBody.postMessage("error",{error:P}),[3,20];case 20:return[2]}})})}}}function hl(e,r){return r===void 0&&(r={}),new Promise(function(t,n){var i=Mc++,a=function(l,f){if(f.id===i)switch(l){case"done":WorkerBody.removeEventListener(a),t(f.result);break;case"error":WorkerBody.removeEventListener(a),n(f.error);break;default:}};WorkerBody.addEventListener(a);var s={id:i,input:e,options:r};WorkerBody.postMessage("process",s)})}var cu=function(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(y){try{d(n.next(y))}catch(b){s(b)}}function f(y){try{d(n.throw(y))}catch(b){s(b)}}function d(y){y.done?a(y.value):i(y.value).then(l,f)}d((n=n.apply(e,r||[])).next())})},pl=function(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(y){return f([d,y])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(y){d=[6,y],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}},Po={};function ao(e,r,t){return r===void 0&&(r=null),t===void 0&&(t={}),cu(this,void 0,void 0,function(){return pl(this,function(n){switch(n.label){case 0:return r&&(e=Is(e,r,t)),Po[e]=Po[e]||fu(e),[4,Po[e]];case 1:return[2,n.sent()]}})})}function Is(e,r,t){if(e.startsWith("http"))return e;var n=t.modules||{};return n[e]?n[e]:t.CDN?(assert(t.CDN.startsWith("http")),t.CDN+"/"+r+"/dist/libs/"+e):isWorker?"../src/libs/"+e:"modules/"+r+"/src/libs/"+e}function fu(e){return cu(this,void 0,void 0,function(){var r,t,n;return pl(this,function(i){switch(i.label){case 0:return e.endsWith("wasm")?[4,fetch(e)]:[3,3];case 1:return r=i.sent(),[4,r.arrayBuffer()];case 2:return[2,i.sent()];case 3:return isWorker?[2,importScripts(e)]:[4,fetch(e)];case 4:return t=i.sent(),[4,t.text()];case 5:return n=i.sent(),[2,wu(n,e)]}})})}function wu(e,r){if(isWorker)return eval.call(global,e),null;var t=document.createElement("script");t.id=r;try{t.appendChild(document.createTextNode(e))}catch(n){t.text=e}return document.body.appendChild(t),null}var Bi="0.0.3",Ko={id:"null",name:"null",module:"web-worker-helper",options:{}};function oo(e){var r=e.color;return!r||!r.length?[1,1,1,1]:r}function hu(e,r,t){return t.length===2?[t[0],t[1],0]:[t[0],t[1],t[2]]}function Ic(e){var r=e.filter;return r?[1]:[0]}function Wu(e,r){return[r]}var Ch=U(75734),Oo=U.n(Ch),kr=U(38015),Vs=kr.Ue(),Rh=kr.Ue(),ko=kr.Ue(),ru=kr.Ue(),Do=kr.Ue();function pp(e,r,t,n,i){kr.IH(e,t,n),kr.Fv(e,e),r=kr.al(-e[1],e[0]);var a=kr.al(-t[1],t[0]);return[i/kr.AK(r,a),r]}function ic(e,r){return kr.t8(e,-r[1],r[0])}function dl(e,r,t){return kr.lu(e,r,t),kr.Fv(e,e),e}function Zp(e,r){return e[0]===r[0]&&e[1]===r[1]}function ag(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var zv=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Q.Z)(this,e),(0,F.Z)(this,"lastFlip",-1),(0,F.Z)(this,"miter",kr.al(0,0)),(0,F.Z)(this,"started",!1),(0,F.Z)(this,"dash",!1),(0,F.Z)(this,"totalDistance",0),(0,F.Z)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,j.Z)(e,[{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var f,d,y,b=t[l-1];b.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var T=n[l-1],M=t[l];M.push((d=n[l][2])!==null&&d!==void 0?d:0);var P=n[l],k=l<t.length-1?[].concat((0,Jt.Z)(t[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,H=l<n.length-1?n[l+1]:null,q=this.segment_gaode2(i,s,b,M,k,T,P,H);s+=q}if(this.dash)for(var ae=0;ae<i.positions.length/6;ae++)i.positions[ae*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var f,d,y,b=t[l-1];b.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var T=n[l-1],M=t[l];M.push((d=n[l][2])!==null&&d!==void 0?d:0);var P=n[l],k=l<t.length-1?[].concat((0,Jt.Z)(t[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,H=l<n.length-1?n[l+1]:null,q=this.simpleSegment(i,s,b,M,k,T,P,H);s+=q}if(this.dash)for(var ae=0;ae<i.positions.length/6;ae++)i.positions[ae*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],d=s<t.length-1?t[s+1]:null,y=this.segment(n,a,l,f,d);a+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],d=s<t.length-1?t[s+1]:null,y=this.simpleSegment(n,a,l,f,d);a+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"segment_gaode2",value:function(t,n,i,a,s,l,f,d){var y=0,b=t.indices,T=t.positions,M=t.normals,P=this.cap==="square",k=this.join==="bevel",H=Va([f[0],f[1]]),q=Va([l[0],l[1]]);dl(ko,a,i);var ae=0;if(this.dash&&(ae=this.lineSegmentDistance(H,q),this.totalDistance+=ae),this.normal||(this.normal=kr.Ue(),ic(this.normal,ko)),!this.started)if(this.started=!0,P){var Se=kr.Ue(),ze=kr.Ue();kr.IH(Se,this.normal,ko),kr.IH(ze,this.normal,ko),M.push(ze[0],ze[1],0),M.push(Se[0],Se[1],0),T.push(i[0],i[1],i[2]|0,this.totalDistance-ae,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),T.push(i[0],i[1],i[2]|0,this.totalDistance-ae,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(T,M,i,this.normal,this.thickness,this.totalDistance-ae);if(b.push(n+0,n+1,n+2),s){Zp(a,s)&&kr.IH(s,a,kr.Fv(s,kr.$X(s,a,i))),dl(ru,s,a);var ot=pp(Do,kr.Ue(),ko,ru,this.thickness),Ct=(0,yn.Z)(ot,2),Xt=Ct[0],Sr=Ct[1],_r=kr.AK(Do,this.normal)<0?-1:1,Wr=k;if(!Wr&&this.join==="miter"){var Cn=Xt;Cn>this.miterLimit&&(Wr=!0)}Wr?(M.push(this.normal[0],this.normal[1],0),M.push(Sr[0],Sr[1],0),T.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*_r,a[2]|0),this.complex.indexes.push(this.currentIndex),T.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*_r,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b.push.apply(b,(0,Jt.Z)(this.lastFlip!==-_r?[n,n+2,n+3]:[n+2,n+1,n+3])),b.push(n+2,n+3,n+4),ic(Vs,ru),kr.JG(this.normal,Vs),M.push(this.normal[0],this.normal[1],0),T.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*_r,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,y+=3):(this.extrusions(T,M,a,Sr,Xt,this.totalDistance),b.push.apply(b,(0,Jt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_r=-1,kr.JG(this.normal,Sr),y+=2),this.lastFlip=_r}else{if(ic(this.normal,ko),P){var it=kr.Ue(),ut=kr.Ue();kr.lu(ut,ko,this.normal),kr.IH(it,ko,this.normal),M.push(ut[0],ut[1],0),M.push(it[0],it[1],0),T.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),T.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(T,M,a,this.normal,this.thickness,this.totalDistance);b.push.apply(b,(0,Jt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),y+=2}return y}},{key:"simpleSegment",value:function(t,n,i,a,s){var l=0,f=t.indices,d=t.positions,y=t.normals,b=Va([a[0],a[1]]),T=Va([i[0],i[1]]);dl(ko,b,T);var M=0;if(this.dash&&(M=this.lineSegmentDistance(b,T),this.totalDistance+=M),this.normal||(this.normal=kr.Ue(),ic(this.normal,ko)),this.started||(this.started=!0,this.extrusions(d,y,i,this.normal,this.thickness,this.totalDistance-M)),f.push(n+0,n+1,n+2),!s)ic(this.normal,ko),this.extrusions(d,y,a,this.normal,this.thickness,this.totalDistance),f.push.apply(f,(0,Jt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var P=Va([s[0],s[1]]);Zp(b,P)&&kr.IH(P,b,kr.Fv(P,kr.$X(P,b,T))),dl(ru,P,b);var k=pp(Do,kr.Ue(),ko,ru,this.thickness),H=(0,yn.Z)(k,2),q=H[0],ae=H[1],Se=kr.AK(Do,this.normal)<0?-1:1;this.extrusions(d,y,a,ae,q,this.totalDistance),f.push.apply(f,(0,Jt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Se=-1,kr.JG(this.normal,ae),l+=2,this.lastFlip=Se}return l}},{key:"segment",value:function(t,n,i,a,s){var l=0,f=t.indices,d=t.positions,y=t.normals,b=this.cap==="square",T=this.join==="bevel",M=Va([a[0],a[1]]),P=Va([i[0],i[1]]);dl(ko,M,P);var k=0;if(this.dash&&(k=this.lineSegmentDistance(M,P),this.totalDistance+=k),this.normal||(this.normal=kr.Ue(),ic(this.normal,ko)),!this.started)if(this.started=!0,b){var H=kr.Ue(),q=kr.Ue();kr.IH(H,this.normal,ko),kr.IH(q,this.normal,ko),y.push(q[0],q[1],0),y.push(H[0],H[1],0),d.push(i[0],i[1],i[2]|0,this.totalDistance-k,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),d.push(i[0],i[1],i[2]|0,this.totalDistance-k,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,y,i,this.normal,this.thickness,this.totalDistance-k);if(f.push(n+0,n+1,n+2),s){var ze=Va([s[0],s[1]]);Zp(M,ze)&&kr.IH(ze,M,kr.Fv(ze,kr.$X(ze,M,P))),dl(ru,ze,M);var it=pp(Do,kr.Ue(),ko,ru,this.thickness),ut=(0,yn.Z)(it,2),ot=ut[0],Ct=ut[1],Xt=kr.AK(Do,this.normal)<0?-1:1,Sr=T;if(!Sr&&this.join==="miter"){var _r=ot;_r>this.miterLimit&&(Sr=!0)}Sr?(y.push(this.normal[0],this.normal[1],0),y.push(Ct[0],Ct[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Xt,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Xt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,Jt.Z)(this.lastFlip!==-Xt?[n,n+2,n+3]:[n+2,n+1,n+3])),f.push(n+2,n+3,n+4),ic(Vs,ru),kr.JG(this.normal,Vs),y.push(this.normal[0],this.normal[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Xt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(d,y,a,Ct,ot,this.totalDistance),f.push.apply(f,(0,Jt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Xt=-1,kr.JG(this.normal,Ct),l+=2),this.lastFlip=Xt}else{if(ic(this.normal,ko),b){var ae=kr.Ue(),Se=kr.Ue();kr.lu(Se,ko,this.normal),kr.IH(ae,ko,this.normal),y.push(Se[0],Se[1],0),y.push(ae[0],ae[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,y,a,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,Jt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,s,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}();function Hf(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new zv({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var s=t;Array.isArray(s[0][0])||(s=[t]);for(var l=0;l<a.length;l++){var f=a[l],d=s[l];i.extrude_gaode2(f,d)}}else{var y=r;y[0]&&!Array.isArray(y[0][0])&&(y=[r]),y.forEach(function(T){i.extrude(T)})}var b=i.complex;return{vertices:b.positions,indices:b.indices,normals:b.normals,indexes:b.indexes,size:6}}function dp(e){var r=Qs(e.coordinates);return{vertices:[].concat((0,Jt.Z)(r),(0,Jt.Z)(r),(0,Jt.Z)(r),(0,Jt.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function Mh(e){var r=e.coordinates,t=Oo().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes,s=Oo()(n,a,i);return{indices:s,vertices:n,size:i}}var Dd=function(){var e=(0,Zt.Z)(_e().mark(function r(t){var n,i,a,s,l,f,d,y,b;return _e().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,s=t.iconMap,l={a_Color:oo,a_Position:hu,filter:Ic,a_vertexId:Wu,a_PickingColor:function(k){var H=k.id;return a?na(H):[0,0,0]},a_DistanceAndIndex:function(k,H,q,ae,Se,ze){return ze===void 0?[q[3],10]:[q[3],ze]},a_Total_Distance:function(k,H,q){return[q[5]]},a_Size:function(k){var H=k.size,q=H===void 0?1:H;return Array.isArray(q)?[q[0],q[1]]:[q,0]},a_Normal:function(k,H,q,ae,Se){return Se},a_Miter:function(k,H,q){return[q[4]]},a_iconMapUV:function(k){var H=k.texture,q=s[H]||{x:0,y:0},ae=q.x,Se=q.y;return[ae,Se]}},f={sizePerElement:0,elements:[]},d=0,y=[],b=3,i.forEach(function(P,k){var H=Hf(P),q=H.indices,ae=H.vertices,Se=H.normals,ze=H.size,it=H.indexes;q.forEach(function(Xt){y.push(Xt+d)}),b=ze;var ut=ae.length/ze;f.sizePerElement=b,f.elements.push({featureIdx:k,vertices:ae,normals:Se,offset:d}),d+=ut;for(var ot=function(Sr){var _r=(Se==null?void 0:Se.slice(Sr*3,Sr*3+3))||[],Wr=ae.slice(Sr*ze,Sr*ze+ze),Cn=0;it&&it[Sr]!==void 0&&(Cn=it[Sr]),n.forEach(function(wi){if(wi&&l[wi.name]){var ua;(ua=wi.buffer.data).push.apply(ua,(0,Jt.Z)(l[wi.name](P,k,Wr,Sr,_r,Cn)))}})},Ct=0;Ct<ut;Ct++)ot(Ct)}),M.abrupt("return",{descriptors:n,featureLayout:f,indices:y});case 8:case"end":return M.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Pc=function(){var e=(0,Zt.Z)(_e().mark(function r(t){var n,i,a,s,l,f,d,y,b;return _e().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,s=t.shape2d,l={a_Color:oo,a_Position:hu,filter:Ic,a_vertexId:Wu,a_PickingColor:function(k){var H=k.id;return a?na(H):[0,0,0]},a_Shape:function(k){var H=k.shape,q=H===void 0?2:H,ae=s.indexOf(q);return[ae]},a_Extrude:function(k,H,q,ae){var Se=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],ze=ae%4*3;return[Se[ze],Se[ze+1],Se[ze+2]]},a_Size:function(k){var H=k.size,q=H===void 0?5:H;return Array.isArray(q)?[q[0]]:[q]}},f={sizePerElement:0,elements:[]},d=0,y=[],b=3,i.forEach(function(P,k){var H=dp(P),q=H.indices,ae=H.vertices,Se=H.normals,ze=H.size,it=H.indexes;q.forEach(function(Xt){y.push(Xt+d)}),b=ze;var ut=ae.length/ze;f.sizePerElement=b,f.elements.push({featureIdx:k,vertices:ae,normals:Se,offset:d}),d+=ut;for(var ot=function(Sr){var _r=(Se==null?void 0:Se.slice(Sr*3,Sr*3+3))||[],Wr=ae.slice(Sr*ze,Sr*ze+ze),Cn=0;it&&it[Sr]!==void 0&&(Cn=it[Sr]),n.forEach(function(wi){if(wi&&l[wi.name]){var ua;(ua=wi.buffer.data).push.apply(ua,(0,Jt.Z)(l[wi.name](P,k,Wr,Sr,_r,Cn)))}})},Ct=0;Ct<ut;Ct++)ot(Ct)}),M.abrupt("return",{descriptors:n,featureLayout:f,indices:y});case 8:case"end":return M.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Ih=function(){var e=(0,Zt.Z)(_e().mark(function r(t){var n,i,a,s,l,f,d,y;return _e().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return n=t.descriptors,i=t.features,a=t.enablePicking,s={a_Color:oo,a_Position:hu,filter:Ic,a_vertexId:Wu,a_PickingColor:function(P){var k=P.id;return a?na(k):[0,0,0]}},l={sizePerElement:0,elements:[]},f=0,d=[],y=3,i.forEach(function(M,P){var k=Mh(M),H=k.indices,q=k.vertices,ae=k.normals,Se=k.size,ze=k.indexes;H.forEach(function(Ct){d.push(Ct+f)}),y=Se;var it=q.length/Se;l.sizePerElement=y,l.elements.push({featureIdx:P,vertices:q,normals:ae,offset:f}),f+=it;for(var ut=function(Xt){var Sr=(ae==null?void 0:ae.slice(Xt*3,Xt*3+3))||[],_r=q.slice(Xt*Se,Xt*Se+Se),Wr=0;ze&&ze[Xt]!==void 0&&(Wr=ze[Xt]),n.forEach(function(Cn){if(Cn&&s[Cn.name]){var wi;(wi=Cn.buffer.data).push.apply(wi,(0,Jt.Z)(s[Cn.name](M,P,_r,Xt,Sr,Wr)))}})},ot=0;ot<it;ot++)ut(ot)}),T.abrupt("return",{descriptors:n,featureLayout:l,indices:d});case 8:case"end":return T.stop()}},r)}));return function(t){return e.apply(this,arguments)}}(),Zv={pointFill:Pc,line:Dd,polygonFill:Ih},Ld=(0,W.Z)({},Zv);function og(e){return Vp.apply(this,arguments)}function Vp(){return Vp=_asyncToGenerator(_regeneratorRuntime.mark(function e(r){var t,n;return _regeneratorRuntime.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:if(t=r.workerType,n=r.data,!Ld[t]){a.next=3;break}return a.abrupt("return",Ld[t](n));case 3:return a.abrupt("return",Promise.reject(new Error('Worker with type "'.concat(t,'" non-existent.'))));case 4:case"end":return a.stop()}},e)})),Vp.apply(this,arguments)}var Bd=new Map;function Fd(e,r){Bd.set(e,r)}function jp(e){var r=Bd.get(e);return r}var Dl="l7-worker",vp=3,Oc=!0;function Hp(e){registerWorkerSource(Dl,e)}function Ja(){var e=getWorkerSource(Dl);if(!e)throw new Error("get worker failed by workerName: ".concat(Dl,"."));return e}function Wf(e,r){return Gf.apply(this,arguments)}function Gf(){return Gf=_asyncToGenerator(_regeneratorRuntime.mark(function e(r,t){var n,i,a,s,l;return _regeneratorRuntime.wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n=Ja(),i=WorkerFarm.getWorkerFarm({maxConcurrency:vp,reuseWorkers:Oc}),a=i.getWorkerPool({name:Dl,source:n}),d.next=5,a.startJob(Dl,function(y,b,T){return y.done(T)});case 5:return s=d.sent,s.postMessage("process",{input:{workerType:r,data:t}}),d.next=9,s.result;case 9:return l=d.sent,d.abrupt("return",l.result);case 11:case"end":return d.stop()}},e)})),Gf.apply(this,arguments)}function vl(e,r){return e==null?r:e}var lf=U(47903),kc=U.n(lf);function Xf(e,r){return e.map(function(t){return t[r]*1})}function $f(e){return e===void 0?!1:!Array.isArray(e)&&e.data!==void 0}function Dc(e){return Array.isArray(e)?e.length===0?!1:!!$f(e[0]):!1}function Lc(e){return Array.isArray(e)?e.length===0||typeof e[0]=="number":!1}function ac(e){var r=Object.isFrozen(e)?ui.cloneDeep(e):e;return kc()(r,!0),r}function Wp(e,r){var t=r.x,n=r.y,i=r.x1,a=r.y1,s=r.coordinates,l=r.geometry,f=[];if(!Array.isArray(e))return{dataArray:[]};if(l)return e.filter(function(q){return q[l]&&q[l].type&&q[l].coordinates&&q[l].coordinates.length>0}).forEach(function(q,ae){var Se=ac(q[l]);mt(Se,function(ze){var it=ts(ze),ut=(0,W.Z)((0,W.Z)({},q),{},{_id:ae,coordinates:it});f.push(ut)})}),{dataArray:f};for(var d=0;d<e.length;d++){var y=e[d],b=[];if(s){var T="Polygon";Array.isArray(s[0])||(T="Point"),Array.isArray(s[0])&&!Array.isArray(s[0][0])&&(T="LineString");var M=ac({type:T,coordinates:y[s]});b=M.coordinates}else if(t&&n&&i&&a){var P=[parseFloat(y[t]),parseFloat(y[n])],k=[parseFloat(y[i]),parseFloat(y[a])];b=[P,k]}else t&&n&&(b=[parseFloat(y[t]),parseFloat(y[n])]);var H=(0,W.Z)((0,W.Z)({},y),{},{_id:d,coordinates:b});f.push(H)}return{dataArray:f}}function oc(e,r){var t=Ot(e);return Wp(t,r)}var js=U(97382);function mp(e){for(var r=e.toString(),t=5381,n=r.length;n;)t=t*33^r.charCodeAt(--n);return t>>>0}function Gp(e,r){return r===void 0?null:(0,js.Z)(e.properties[r])*1==="number"?e.properties[r]*1:e.properties&&e.properties[r]?mp(e.properties[r]+"")%1000019:null}function Xp(e,r){var t=[],n={};return e.features?(e.features=e.features.filter(function(i){var a=i.geometry;return i!=null&&a&&a.type&&a.coordinates&&a.coordinates.length>0}),e=ac(e),e.features.length===0?{dataArray:[],featureKeys:n}:(mt(e,function(i,a){var s=Gp(i,r==null?void 0:r.featureId);s===null&&(s=a);var l=s,f=ts(i),d=(0,W.Z)((0,W.Z)({},i.properties),{},{coordinates:f,_id:l});t.push(d)}),{dataArray:t,featureKeys:n})):(e.features=[],{dataArray:[]})}function Ph(e,r,t,n){for(var i=n,a=t-r>>1,s=t-r,l,f=e[r],d=e[r+1],y=e[t],b=e[t+1],T=r+3;T<t;T+=3){var M=ml(e[T],e[T+1],f,d,y,b);if(M>i)l=T,i=M;else if(M===i){var P=Math.abs(T-a);P<s&&(l=T,s=P)}}i>n&&(l-r>3&&Ph(e,r,l,n),e[l+2]=i,t-l>3&&Ph(e,l,t,n))}function ml(e,r,t,n,i,a){var s=i-t,l=a-n;if(s!==0||l!==0){var f=((e-t)*s+(r-n)*l)/(s*s+l*l);f>1?(t=i,n=a):f>0&&(t+=s*f,n+=l*f)}return s=e-t,l=r-n,s*s+l*l}function Gu(e,r,t,n){var i={id:typeof e=="undefined"?null:e,type:r,geometry:t,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return Nd(i),i}function Nd(e){var r=e.geometry,t=e.type;if(t==="Point"||t==="MultiPoint"||t==="LineString")gp(e,r);else if(t==="Polygon"||t==="MultiLineString")for(var n=0;n<r.length;n++)gp(e,r[n]);else if(t==="MultiPolygon")for(n=0;n<r.length;n++)for(var i=0;i<r[n].length;i++)gp(e,r[n][i])}function gp(e,r){for(var t=0;t<r.length;t+=3)e.minX=Math.min(e.minX,r[t]),e.minY=Math.min(e.minY,r[t+1]),e.maxX=Math.max(e.maxX,r[t]),e.maxY=Math.max(e.maxY,r[t+1])}function Ud(e,r){var t=[];if(e.type==="FeatureCollection")for(var n=0;n<e.features.length;n++)Oh(t,e.features[n],r,n);else e.type==="Feature"?Oh(t,e,r):Oh(t,{geometry:e},r);return t}function Oh(e,r,t,n){if(r.geometry){var i=r.geometry.coordinates,a=r.geometry.type,s=Math.pow(t.tolerance/((1<<t.maxZoom)*t.extent),2),l=[],f=r.id;if(t.promoteId?f=r.properties[t.promoteId]:t.generateId&&(f=n||0),a==="Point")Bc(i,l);else if(a==="MultiPoint")for(var d=0;d<i.length;d++)Bc(i[d],l);else if(a==="LineString")$p(i,l,s,!1);else if(a==="MultiLineString")if(t.lineMetrics){for(d=0;d<i.length;d++)l=[],$p(i[d],l,s,!1),e.push(Gu(f,"LineString",l,r.properties));return}else Xu(i,l,s,!1);else if(a==="Polygon")Xu(i,l,s,!0);else if(a==="MultiPolygon")for(d=0;d<i.length;d++){var y=[];Xu(i[d],y,s,!0),l.push(y)}else if(a==="GeometryCollection"){for(d=0;d<r.geometry.geometries.length;d++)Oh(e,{id:f,geometry:r.geometry.geometries[d],properties:r.properties},t,n);return}else throw new Error("Input data is not a valid GeoJSON object.");e.push(Gu(f,a,l,r.properties))}}function Bc(e,r){r.push(_p(e[0])),r.push(Fc(e[1])),r.push(0)}function $p(e,r,t,n){for(var i,a,s=0,l=0;l<e.length;l++){var f=_p(e[l][0]),d=Fc(e[l][1]);r.push(f),r.push(d),r.push(0),l>0&&(n?s+=(i*d-f*a)/2:s+=Math.sqrt(Math.pow(f-i,2)+Math.pow(d-a,2))),i=f,a=d}var y=r.length-3;r[2]=1,Ph(r,0,y,t),r[y+2]=1,r.size=Math.abs(s),r.start=0,r.end=r.size}function Xu(e,r,t,n){for(var i=0;i<e.length;i++){var a=[];$p(e[i],a,t,n),r.push(a)}}function _p(e){return e/360+.5}function Fc(e){var r=Math.sin(e*Math.PI/180),t=.5-.25*Math.log((1+r)/(1-r))/Math.PI;return t<0?0:t>1?1:t}function Hs(e,r,t,n,i,a,s,l){if(t/=r,n/=r,a>=t&&s<n)return e;if(s<t||a>=n)return null;for(var f=[],d=0;d<e.length;d++){var y=e[d],b=y.geometry,T=y.type,M=i===0?y.minX:y.minY,P=i===0?y.maxX:y.maxY;if(M>=t&&P<n){f.push(y);continue}else if(P<t||M>=n)continue;var k=[];if(T==="Point"||T==="MultiPoint")zd(b,k,t,n,i);else if(T==="LineString")sc(b,k,t,n,i,!1,l.lineMetrics);else if(T==="MultiLineString")Yf(b,k,t,n,i,!1);else if(T==="Polygon")Yf(b,k,t,n,i,!0);else if(T==="MultiPolygon")for(var H=0;H<b.length;H++){var q=[];Yf(b[H],q,t,n,i,!0),q.length&&k.push(q)}if(k.length){if(l.lineMetrics&&T==="LineString"){for(H=0;H<k.length;H++)f.push(Gu(y.id,T,k[H],y.tags));continue}(T==="LineString"||T==="MultiLineString")&&(k.length===1?(T="LineString",k=k[0]):T="MultiLineString"),(T==="Point"||T==="MultiPoint")&&(T=k.length===3?"Point":"MultiPoint"),f.push(Gu(y.id,T,k,y.tags))}}return f.length?f:null}function zd(e,r,t,n,i){for(var a=0;a<e.length;a+=3){var s=e[a+i];s>=t&&s<=n&&(r.push(e[a]),r.push(e[a+1]),r.push(e[a+2]))}}function sc(e,r,t,n,i,a,s){for(var l=kh(e),f=i===0?Ss:Lo,d=e.start,y,b,T=0;T<e.length-3;T+=3){var M=e[T],P=e[T+1],k=e[T+2],H=e[T+3],q=e[T+4],ae=i===0?M:P,Se=i===0?H:q,ze=!1;s&&(y=Math.sqrt(Math.pow(M-H,2)+Math.pow(P-q,2))),ae<t?Se>t&&(b=f(l,M,P,H,q,t),s&&(l.start=d+y*b)):ae>n?Se<n&&(b=f(l,M,P,H,q,n),s&&(l.start=d+y*b)):us(l,M,P,k),Se<t&&ae>=t&&(b=f(l,M,P,H,q,t),ze=!0),Se>n&&ae<=n&&(b=f(l,M,P,H,q,n),ze=!0),!a&&ze&&(s&&(l.end=d+y*b),r.push(l),l=kh(e)),s&&(d+=y)}var it=e.length-3;M=e[it],P=e[it+1],k=e[it+2],ae=i===0?M:P,ae>=t&&ae<=n&&us(l,M,P,k),it=l.length-3,a&&it>=3&&(l[it]!==l[0]||l[it+1]!==l[1])&&us(l,l[0],l[1],l[2]),l.length&&r.push(l)}function kh(e){var r=[];return r.size=e.size,r.start=e.start,r.end=e.end,r}function Yf(e,r,t,n,i,a){for(var s=0;s<e.length;s++)sc(e[s],r,t,n,i,a,!1)}function us(e,r,t,n){e.push(r),e.push(t),e.push(n)}function Ss(e,r,t,n,i,a){var s=(a-r)/(n-r);return e.push(a),e.push(t+(i-t)*s),e.push(1),s}function Lo(e,r,t,n,i,a){var s=(a-t)/(i-t);return e.push(r+(n-r)*s),e.push(a),e.push(1),s}function pu(e,r){var t=r.buffer/r.extent,n=e,i=Hs(e,1,-1-t,t,0,-1,2,r),a=Hs(e,1,1-t,2+t,0,-1,2,r);return(i||a)&&(n=Hs(e,1,-t,1+t,0,-1,2,r)||[],i&&(n=Yp(i,1).concat(n)),a&&(n=n.concat(Yp(a,-1)))),n}function Yp(e,r){for(var t=[],n=0;n<e.length;n++){var i=e[n],a=i.type,s;if(a==="Point"||a==="MultiPoint"||a==="LineString")s=cf(i.geometry,r);else if(a==="MultiLineString"||a==="Polygon"){s=[];for(var l=0;l<i.geometry.length;l++)s.push(cf(i.geometry[l],r))}else if(a==="MultiPolygon")for(s=[],l=0;l<i.geometry.length;l++){for(var f=[],d=0;d<i.geometry[l].length;d++)f.push(cf(i.geometry[l][d],r));s.push(f)}t.push(Gu(i.id,a,s,i.tags))}return t}function cf(e,r){var t=[];t.size=e.size,e.start!==void 0&&(t.start=e.start,t.end=e.end);for(var n=0;n<e.length;n+=3)t.push(e[n]+r,e[n+1],e[n+2]);return t}function qp(e,r){if(e.transformed)return e;var t=1<<e.z,n=e.x,i=e.y,a,s,l;for(a=0;a<e.features.length;a++){var f=e.features[a],d=f.geometry,y=f.type;if(f.geometry=[],y===1)for(s=0;s<d.length;s+=2)f.geometry.push(Zd(d[s],d[s+1],r,t,n,i));else for(s=0;s<d.length;s++){var b=[];for(l=0;l<d[s].length;l+=2)b.push(Zd(d[s][l],d[s][l+1],r,t,n,i));f.geometry.push(b)}}return e.transformed=!0,e}function Zd(e,r,t,n,i,a){return[Math.round(t*(e*n-i)),Math.round(t*(r*n-a))]}function Vv(e,r,t,n,i){for(var a=r===i.maxZoom?0:i.tolerance/((1<<r)*i.extent),s={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:t,y:n,z:r,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},l=0;l<e.length;l++){s.numFeatures++,Vd(s,e[l],a,i);var f=e[l].minX,d=e[l].minY,y=e[l].maxX,b=e[l].maxY;f<s.minX&&(s.minX=f),d<s.minY&&(s.minY=d),y>s.maxX&&(s.maxX=y),b>s.maxY&&(s.maxY=b)}return s}function Vd(e,r,t,n){var i=r.geometry,a=r.type,s=[];if(a==="Point"||a==="MultiPoint")for(var l=0;l<i.length;l+=3)s.push(i[l]),s.push(i[l+1]),e.numPoints++,e.numSimplified++;else if(a==="LineString")Kp(s,i,e,t,!1,!1);else if(a==="MultiLineString"||a==="Polygon")for(l=0;l<i.length;l++)Kp(s,i[l],e,t,a==="Polygon",l===0);else if(a==="MultiPolygon")for(var f=0;f<i.length;f++){var d=i[f];for(l=0;l<d.length;l++)Kp(s,d[l],e,t,!0,l===0)}if(s.length){var y=r.tags||null;if(a==="LineString"&&n.lineMetrics){y={};for(var b in r.tags)y[b]=r.tags[b];y.mapbox_clip_start=i.start/i.size,y.mapbox_clip_end=i.end/i.size}var T={geometry:s,type:a==="Polygon"||a==="MultiPolygon"?3:a==="LineString"||a==="MultiLineString"?2:1,tags:y};r.id!==null&&(T.id=r.id),e.features.push(T)}}function Kp(e,r,t,n,i,a){var s=n*n;if(n>0&&r.size<(i?s:n)){t.numPoints+=r.length/3;return}for(var l=[],f=0;f<r.length;f+=3)(n===0||r[f+2]>s)&&(t.numSimplified++,l.push(r[f]),l.push(r[f+1])),t.numPoints++;i&&jd(l,a),e.push(l)}function jd(e,r){for(var t=0,n=0,i=e.length,a=i-2;n<i;a=n,n+=2)t+=(e[n]-e[a])*(e[n+1]+e[a+1]);if(t>0===r)for(n=0,i=e.length;n<i/2;n+=2){var s=e[n],l=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=s,e[i-1-n]=l}}function Ps(e,r){return new yp(e,r)}function yp(e,r){r=this.options=Qp(Object.create(this.options),r);var t=r.debug;if(t&&console.time("preprocess data"),r.maxZoom<0||r.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(r.promoteId&&r.generateId)throw new Error("promoteId and generateId cannot be used together.");var n=Ud(e,r);this.tiles={},this.tileCoords=[],t&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",r.indexMaxZoom,r.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=pu(n,r),n.length&&this.splitTile(n,0,0,0),t&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}yp.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},yp.prototype.splitTile=function(e,r,t,n,i,a,s){for(var l=[e,r,t,n],f=this.options,d=f.debug;l.length;){n=l.pop(),t=l.pop(),r=l.pop(),e=l.pop();var y=1<<r,b=xp(r,t,n),T=this.tiles[b];if(!T&&(d>1&&console.time("creation"),T=this.tiles[b]=Vv(e,r,t,n,f),this.tileCoords.push({z:r,x:t,y:n}),d)){d>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",r,t,n,T.numFeatures,T.numPoints,T.numSimplified),console.timeEnd("creation"));var M="z"+r;this.stats[M]=(this.stats[M]||0)+1,this.total++}if(T.source=e,i){if(r===f.maxZoom||r===i)continue;var P=1<<i-r;if(t!==Math.floor(a/P)||n!==Math.floor(s/P))continue}else if(r===f.indexMaxZoom||T.numPoints<=f.indexMaxPoints)continue;if(T.source=null,e.length!==0){d>1&&console.time("clipping");var k=.5*f.buffer/f.extent,H=.5-k,q=.5+k,ae=1+k,Se,ze,it,ut,ot,Ct;Se=ze=it=ut=null,ot=Hs(e,y,t-k,t+q,0,T.minX,T.maxX,f),Ct=Hs(e,y,t+H,t+ae,0,T.minX,T.maxX,f),e=null,ot&&(Se=Hs(ot,y,n-k,n+q,1,T.minY,T.maxY,f),ze=Hs(ot,y,n+H,n+ae,1,T.minY,T.maxY,f),ot=null),Ct&&(it=Hs(Ct,y,n-k,n+q,1,T.minY,T.maxY,f),ut=Hs(Ct,y,n+H,n+ae,1,T.minY,T.maxY,f),Ct=null),d>1&&console.timeEnd("clipping"),l.push(Se||[],r+1,t*2,n*2),l.push(ze||[],r+1,t*2,n*2+1),l.push(it||[],r+1,t*2+1,n*2),l.push(ut||[],r+1,t*2+1,n*2+1)}}},yp.prototype.getTile=function(e,r,t){var n=this.options,i=n.extent,a=n.debug;if(e<0||e>24)return null;var s=1<<e;r=(r%s+s)%s;var l=xp(e,r,t);if(this.tiles[l])return qp(this.tiles[l],i);a>1&&console.log("drilling down to z%d-%d-%d",e,r,t);for(var f=e,d=r,y=t,b;!b&&f>0;)f--,d=Math.floor(d/2),y=Math.floor(y/2),b=this.tiles[xp(f,d,y)];return!b||!b.source?null:(a>1&&console.log("found parent tile z%d-%d-%d",f,d,y),a>1&&console.time("drilling down"),this.splitTile(b.source,f,d,y,e,r,t),a>1&&console.timeEnd("drilling down"),this.tiles[l]?qp(this.tiles[l],i):null)};function xp(e,r,t){return((1<<e)*t+r)*32+e}function Qp(e,r){for(var t in r)e[t]=r[t];return e}var qf=function(){function e(r,t,n,i){(0,Q.Z)(this,e),(0,F.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=r}return(0,j.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];return n.features}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Jp={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0};function jv(e){for(var r=0,t=0,n=e.length,i=n-1,a,s;t<n;i=t++)a=e[t],s=e[i],r+=(s.x-a.x)*(a.y+s.y);return r}function Hv(e){var r=e.length;if(r<=1)return[e];for(var t=[],n,i,a=0;a<r;a++){var s=jv(e[a]);s!==0&&(i===void 0&&(i=s<0),i===s<0?(n&&t.push(n),n=[e[a]]):n.push(e[a]))}return n&&t.push(n),t}var Hd=["Unknown","Point","LineString","Polygon"];function Wd(e,r,t,n,i){var a=i.geometry,s=i.type,l=i.tags,f=i.id,d=e*Math.pow(2,n),y=e*r,b=e*t,T=Hd[s],M,P;function k(ae){for(var Se=0;Se<ae.length;Se++){var ze=ae[Se];if(ze[3])break;var it=180-(ze[1]+b)*360/d,ut=(ze[0]+y)*360/d-180,ot=360/Math.PI*Math.atan(Math.exp(it*Math.PI/180))-90;ae[Se]=[ut,ot,0,1]}}switch(s){case 1:var H=[];for(M=0;M<a.length;M++)H[M]=a[M][0];a=H,k(a);break;case 2:for(M=0;M<a.length;M++)k(a[M]);break;case 3:for(a=Hv(a),M=0;M<a.length;M++)for(P=0;P<a[M].length;P++)k(a[M][P]);break}a.length===1?a=a[0]:T="Multi"+T;var q={type:"Feature",geometry:{type:T,coordinates:a},properties:l,id:f,tileOrigin:[0,0],coord:""};return q}var G=function(){var e=(0,Zt.Z)(_e().mark(function r(t,n,i,a){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(f){var d=n.getTile(t.z,t.x,t.y),y=d?d.features.map(function(M){return Wd(a,i.x,i.y,i.z,M)}):[],b={layers:{defaultLayer:{features:y}}},T=new qf(b,t.x,t.y,t.z);f(T)}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function we(e){var r={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!0,debug:0};return e===void 0||typeof e.geojsonvtOptions=="undefined"?r:(0,W.Z)((0,W.Z)({},r),e.geojsonvtOptions)}function Ye(e,r){var t=we(r),n=t.extent||4096,i=Ps(e,t),a=function(f,d){return G(d,i,f,n)},s=(0,W.Z)((0,W.Z)((0,W.Z)({},Jp),r),{},{getTileData:a});return{data:e,dataArray:[],tilesetOptions:s,isTile:!0}}function Kt(e,r){var t=r.extent,n=t===void 0?[121.168,30.2828,121.384,30.4219]:t,i=r.requestParameters,a=i===void 0?{}:i,s=new Promise(function(f){e instanceof HTMLImageElement||Mf(e)?f([e]):vr(e,a,function(d){f(d)})}),l={originData:e,images:s,_id:1,dataArray:[{_id:0,coordinates:[[n[0],n[1]],[n[2],n[3]]]}]};return l}function vr(e,r,t){var n=[];if(typeof e=="string")Oa((0,W.Z)((0,W.Z)({},r),{},{url:e}),function(s,l){l&&(n.push(l),t(n))});else{var i=e.length,a=0;e.forEach(function(s){Oa((0,W.Z)((0,W.Z)({},r),{},{url:s}),function(l,f){a++,f&&n.push(f),a===i&&t(n)})})}return Kt}var er=function(){var e=(0,Zt.Z)(_e().mark(function r(t,n,i,a){var s,l;return _e().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return s={x:n.x,y:n.y,z:n.z},l=v(t,s),d.abrupt("return",new Promise(function(y){a?a(s,function(b,T){if(b||!T){var M={layers:{defaultLayer:{features:[]}}},P=new qf(M,n.x,n.y,n.z);y(P)}else{var k={layers:{defaultLayer:{features:T.features}}},H=new qf(k,n.x,n.y,n.z);y(H)}}):Qi((0,W.Z)((0,W.Z)({},i),{},{url:l}),function(b,T){if(b||!T){var M={layers:{defaultLayer:{features:[]}}},P=new qf(M,n.x,n.y,n.z);y(P)}else{var k=JSON.parse(T),H={layers:{defaultLayer:{features:k}}},q=new qf(H,n.x,n.y,n.z);y(q)}})}));case 3:case"end":return d.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}();function jt(e,r){var t=function(a,s){return er(e,s,r==null?void 0:r.requestParameters,r.getCustomData)},n=(0,W.Z)((0,W.Z)({},r),{},{getTileData:t});return{dataArray:[],tilesetOptions:n,isTile:!0}}var Br=U(99996),Pr=U(63713),Yr=U.n(Pr),Nr=function(){function e(r,t,n,i){(0,Q.Z)(this,e),(0,F.Z)(this,"vectorLayerCache",{}),this.x=t,this.y=n,this.z=i,this.vectorTile=new Br.VectorTile(new(Yr())(r))}return(0,j.Z)(e,[{key:"getTileData",value:function(t){if(!t||!this.vectorTile.layers[t])return[];if(this.vectorLayerCache[t])return this.vectorLayerCache[t];var n=this.vectorTile.layers[t];if(Array.isArray(n.features))return this.vectorLayerCache[t]=n.features,n.features;for(var i=[],a=0;a<n.length;a++){var s=n.feature(a),l=s.toGeoJSON(this.x,this.y,this.z);i.push((0,W.Z)((0,W.Z)({},l),{},{properties:(0,W.Z)({id:l.id},l.properties)}))}return this.vectorLayerCache[t]=i,i}},{key:"getFeatureById",value:function(){throw new Error("Method not implemented.")}}]),e}(),Hr={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},en=function(){var e=(0,Zt.Z)(_e().mark(function r(t,n,i,a,s){var l;return _e().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return l=v(t,n),d.abrupt("return",new Promise(function(y){if(s)s({x:i.x,y:i.y,z:i.z},function(T,M){if(T||!M)y(void 0);else{var P=new Nr(M,i.x,i.y,i.z);y(P)}});else{var b=Ei((0,W.Z)((0,W.Z)({},a),{},{url:l}),function(T,M){if(T||!M)y(void 0);else{var P=new Nr(M,i.x,i.y,i.z);y(P)}});i.xhrCancel=function(){return b.cancel()}}}));case 2:case"end":return d.stop()}},r)}));return function(t,n,i,a,s){return e.apply(this,arguments)}}();function Or(e,r){var t=Array.isArray(e)?e[0]:e,n=function(s,l){return en(t,s,l,r==null?void 0:r.requestParameters,r==null?void 0:r.getCustomData)},i=(0,W.Z)((0,W.Z)((0,W.Z)({},Hr),r),{},{getTileData:n});return{data:t,dataArray:[],tilesetOptions:i,isTile:!0}}function $r(e,r,t){switch(e){case"+":return r+t;case"-":return r-t;case"*":return r*t;case"/":return r/t;case"%":return r%t;case"^":return Math.pow(r,t);case"abs":return Math.abs(r);case"floor":return Math.floor(r);case"round":return Math.round(r);case"ceil":return Math.ceil(r);case"sin":return Math.sin(r);case"cos":return Math.cos(r);case"atan":return t===-1?Math.atan(r):Math.atan2(r,t);case"min":return Math.min(r,t);case"max":return Math.max(r,t);case"log10":return Math.log(r);case"log2":return Math.log2(r);default:return console.warn("Calculate symbol err! Return default 0"),0}}function Bt(e,r){for(var t=r[0],n=t.width,i=t.height,a=r.map(function(M){return M.rasterData}),s=n*i,l=[],f=JSON.stringify(e),d=0;d<s;d++){var y=JSON.parse(f),b=ur(y,a,d);if(typeof b=="number")l.push(b);else{var T=un(y);l.push(T)}}return l}function ur(e,r,t){if(e.length===2&&e[0]==="band"&&typeof e[1]=="number")try{return r[e[1]][t]}catch(n){return console.warn("Raster Data err!"),0}e.map(function(n,i){if(Array.isArray(n)&&n.length>0)switch(n[0]){case"band":try{e[i]=r[n[1]][t]}catch(a){console.warn("Raster Data err!"),e[i]=0}break;default:ur(n,r,t)}})}function Ur(e){var r=(0,yn.Z)(e,3),t=r[0],n=r[1],i=n===void 0?-1:n,a=r[2],s=a===void 0?-1:a;if(t===void 0)return console.warn("Express err!"),["+",0,0];var l=t.replace(/\s+/g,"");return[l,i,s]}function un(e){var r=Ur(e),t=r[0],n=r[1],i=r[2];return Array.isArray(n)&&(n=un(e[1])),Array.isArray(i)&&(i=un(e[2])),$r(t,n,i)}var Tr={nd:{type:"operation",expression:["/",["-",["band",1],["band",0]],["+",["band",1],["band",0]]]},rgb:{type:"function",method:pn}};function pn(e,r){for(var t=e[0].rasterData,n=e[1].rasterData,i=e[2].rasterData,a=[],s=(r==null?void 0:r.countCut)||[2,98],l=(0,yn.Z)(s,2),f=l[0],d=l[1],y=(r==null?void 0:r.RMinMax)||Mr(t,f,d),b=(r==null?void 0:r.GMinMax)||Mr(n,f,d),T=(r==null?void 0:r.BMinMax)||Mr(i,f,d),M=0;M<t.length;M++)a.push(Math.max(0,t[M]-y[0])),a.push(Math.max(0,n[M]-b[0])),a.push(Math.max(0,i[M]-T[0]));return{rasterData:a,rMinMax:y,gMinMax:b,bMinMax:T}}function Mr(e,r,t){var n=e.slice().sort(function(l,f){return l-f}),i=n.length,a=n[Math.ceil(i*r/100)],s=n[Math.ceil(i*t/100)];return[a,s]}function ln(e,r,t){return Ar.apply(this,arguments)}function Ar(){return Ar=(0,Zt.Z)(_e().mark(function e(r,t,n){var i,a,s,l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(r.length!==0){b.next=2;break}return b.abrupt("return",{rasterData:[0],width:1,heigh:1});case 2:return b.next=4,Promise.all(r.map(function(T){var M=T.data,P=T.bands,k=P===void 0?[0]:P;return t(M,k)}));case 4:i=b.sent,a=[],i.forEach(function(T){Array.isArray(T)?a.push.apply(a,(0,Jt.Z)(T)):a.push(T)}),s=a[0],l=s.width,f=s.height,b.t0=(0,js.Z)(n),b.next=b.t0==="function"?11:b.t0==="object"?13:15;break;case 11:return d=n(a),b.abrupt("break",16);case 13:return Array.isArray(n)?d={rasterData:Bt(n,a)}:d=on(n,a),b.abrupt("break",16);case 15:d={rasterData:a[0].rasterData};case 16:return b.abrupt("return",(0,W.Z)((0,W.Z)({},d),{},{width:l,height:f}));case 17:case"end":return b.stop()}},e)})),Ar.apply(this,arguments)}function on(e,r){var t=Tr[e.type];if(t.type==="function")return t.method(r,e==null?void 0:e.options);if(t.type==="operation")return e.type==="rgb"?jn(t.expression,r):{rasterData:Bt(t.expression,r)}}function jn(e,r){e.r===void 0&&console.warn("Channel R lost in Operation! Use band[0] to fill!"),e.g===void 0&&console.warn("Channel G lost in Operation! Use band[0] to fill!"),e.b===void 0&&console.warn("Channel B lost in Operation! Use band[0] to fill!");var t=Bt(e.r||["band",0],r),n=Bt(e.g||["band",0],r),i=Bt(e.b||["band",0],r);return[t,n,i]}function ai(e,r,t,n){return rn.apply(this,arguments)}function rn(){return rn=(0,Zt.Z)(_e().mark(function e(r,t,n,i){var a;return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,ln(r,t,n);case 2:a=l.sent,i(null,{data:a});case 4:case"end":return l.stop()}},e)})),rn.apply(this,arguments)}function Dr(e,r){var t=r.extent,n=r.width,i=r.height,a=r.min,s=r.max,l=r.format,f=r.operation,d,y,b;if(l===void 0||Lc(e))d=Array.from(e),y=n,b=i;else{var T=Array.isArray(e)?e:[e];d=ln(T,l,f)}var M={_id:1,dataArray:[{_id:1,data:d,width:y,height:b,min:a,max:s,coordinates:[[t[0],t[1]],[t[2],t[3]]]}]};return M}var yr=U(13351),tr=U(14156),Ti=U(67754),Je={IEventEmitter:Symbol.for("IEventEmitter"),ISceneService:Symbol.for("ISceneService"),IGlobalConfigService:Symbol.for("IGlobalConfigService"),ICameraService:Symbol.for("ICameraService"),ICoordinateSystemService:Symbol.for("ICoordinateSystemService"),ILayerService:Symbol.for("ILayerService"),IDebugService:Symbol.for("IDebugService"),ILayerMappingService:Symbol.for("ILayerMappingService"),ILayerStyleService:Symbol.for("ILayerStyleService"),IMapService:Symbol.for("IMapService"),IMarkerService:Symbol.for("IMarkerService"),IPopupService:Symbol.for("PopupService"),IFactoryMapService:Symbol.for("Factory<IMapService>"),IRendererService:Symbol.for("IRendererService"),IShaderModuleService:Symbol.for("IShaderModuleService"),IIconService:Symbol.for("IIconService"),IFontService:Symbol.for("IFontService"),IInteractionService:Symbol.for("IInteractionService"),IPickingService:Symbol.for("IPickingService"),IControlService:Symbol.for("IControlService"),IStyleAttributeService:Symbol.for("IStyleAttributeService"),ILayer:Symbol.for("ILayer"),ILayerPlugin:Symbol.for("ILayerPlugin"),INormalPass:Symbol.for("INormalPass"),IPostProcessor:Symbol.for("IPostProcessor"),IPostProcessingPass:Symbol.for("IPostProcessingPass"),IFactoryPostProcessingPass:Symbol.for("Factory<IPostProcessingPass>"),IFactoryNormalPass:Symbol.for("Factory<IFactoryNormalPass>"),IMultiPassRenderer:Symbol.for("IMultiPassRenderer"),SceneID:Symbol.for("SceneID"),MapConfig:Symbol.for("MapConfig")},_i=U(25865),si=U.n(_i);function Kn(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Yi(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Yi(e,r){if(e){if(typeof e=="string")return ho(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ho(e,r)}}function ho(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var po=30;function Ii(e){var r=e.characterSet,t=e.getFontWidth,n=e.fontHeight,i=e.buffer,a=e.maxCanvasWidth,s=e.mapping,l=s===void 0?{}:s,f=e.xOffset,d=f===void 0?0:f,y=e.yOffset,b=y===void 0?0:y,T=0,M=d;Array.from(r).forEach(function(k,H){if(!l[k]){var q=t(k,H);M+po>a&&(M=0,T++),l[k]={x:M,y:b+T*po,width:po,height:po,advance:q},M+=po}});var P=n+i*2;return{mapping:l,xOffset:M,yOffset:b+T*P,canvasHeight:yo(b+(T+1)*P)}}function _o(e,r,t){var n=0,i=0,a=0,s=[],l={},f=Kn(e),d;try{for(f.s();!(d=f.n()).done;){var y=d.value;if(!l[y.id]){var b=y.size;n+b+r>t&&(xa(l,s,i),n=0,i=a+i+r,a=0,s=[]),s.push({icon:y,xOffset:n}),n=n+b+r,a=Math.max(a,b)}}}catch(M){f.e(M)}finally{f.f()}s.length>0&&xa(l,s,i);var T=yo(a+i+r);return{mapping:l,canvasHeight:T}}function xa(e,r,t){var n=Kn(r),i;try{for(n.s();!(i=n.n()).done;){var a=i.value,s=a.icon,l=a.xOffset;e[s.id]=(0,W.Z)((0,W.Z)({},s),{},{x:l,y:t,image:s.image,width:s.width,height:s.height})}}catch(f){n.e(f)}finally{n.f()}}function yo(e){return Math.pow(2,Math.ceil(Math.log2(e)))}var xo,Wa;function Bo(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=As(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function As(e,r){if(e){if(typeof e=="string")return bo(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return bo(e,r)}}function bo(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function gi(e){var r=ls();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function ls(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ia=pe(),$n="sans-serif",Ri="normal",Gi=24,Eo=3,gl=.25,je=8,nr=1024,Gt=1,dn=1,yi=3,ma=null;function pe(){for(var e=[],r=32;r<128;r++)e.push(String.fromCharCode(r));return e}function Ie(e,r,t,n){e.font="".concat(n," ").concat(t,"px ").concat(r),e.fillStyle="black",e.textBaseline="middle"}function $e(e,r){for(var t=0;t<e.length;t++)r.data[4*t+3]=e[t]}var $t=(xo=(0,tr.b2)(),xo(Wa=function(e){(0,Le.Z)(t,e);var r=gi(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"fontAtlas",void 0),(0,F.Z)((0,Re.Z)(n),"iconFontMap",void 0),(0,F.Z)((0,Re.Z)(n),"iconFontGlyphs",{}),(0,F.Z)((0,Re.Z)(n),"fontOptions",void 0),(0,F.Z)((0,Re.Z)(n),"key",void 0),(0,F.Z)((0,Re.Z)(n),"cache",new Ff(yi)),n}return(0,j.Z)(t,[{key:"scale",get:function(){return dn}},{key:"canvas",get:function(){var i=this.cache.get(this.key);return i&&i.data}},{key:"mapping",get:function(){var i=this.cache.get(this.key);return i&&i.mapping||{}}},{key:"getCanvasByKey",value:function(i){var a=this.cache.get(i);return a&&a.data}},{key:"getMappingByKey",value:function(i){var a=this.cache.get(i);return a&&a.mapping||{}}},{key:"init",value:function(){this.cache.clear(),this.fontOptions={fontFamily:$n,fontWeight:Ri,characterSet:ia,fontSize:Gi,buffer:Eo,sdf:!0,cutoff:gl,radius:je,iconfont:!1},this.key="",this.iconFontMap=new Map}},{key:"addIconGlyphs",value:function(i){var a=this;i.forEach(function(s){a.iconFontGlyphs[s.name]=s.unicode})}},{key:"addIconFont",value:function(i,a){this.iconFontMap.set(i,a)}},{key:"getIconFontKey",value:function(i){return this.iconFontMap.get(i)||i}},{key:"getGlyph",value:function(i){return this.iconFontGlyphs[i]?String.fromCharCode(parseInt(this.iconFontGlyphs[i],16)):""}},{key:"setFontOptions",value:function(i){this.fontOptions=(0,W.Z)((0,W.Z)({},this.fontOptions),i),this.key=this.getKey();var a=this.getNewChars(this.key,this.fontOptions.characterSet),s=this.cache.get(this.key);if(!(s&&a.length===0)){var l=this.generateFontAtlas(this.key,a,s);this.fontAtlas=l,this.cache.set(this.key,l)}}},{key:"addFontFace",value:function(i,a){var s=this,l=document.createElement("style");l.type="text/css",l.innerText=`
        @font-face{
            font-family: '`.concat(i,`';
            src: url('`).concat(a,`') format('woff2'),
            url('`).concat(a,`') format('woff'),
            url('`).concat(a,`') format('truetype');
        }`),l.onload=function(){if(document.fonts)try{document.fonts.load("24px ".concat(i),"L7text"),document.fonts.ready.then(function(){s.emit("fontloaded",{fontFamily:i})})}catch(f){console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 document.fonts !"),console.warn("\u5F53\u524D\u73AF\u5883\u4E0D\u652F\u6301 iconfont !"),console.warn(f)}},document.getElementsByTagName("head")[0].appendChild(l)}},{key:"destroy",value:function(){this.cache.clear(),this.iconFontMap.clear()}},{key:"generateFontAtlas",value:function(i,a,s){var l=this.fontOptions,f=l.fontFamily,d=l.fontWeight,y=l.fontSize,b=l.buffer,T=l.sdf,M=l.radius,P=l.cutoff,k=l.iconfont,H=s&&s.data;H||(H=window.document.createElement("canvas"),H.width=nr);var q=H.getContext("2d",{willReadFrequently:!0});Ie(q,f,y,d);var ae=Ii((0,W.Z)({getFontWidth:function(Ys){return q.measureText(Ys).width},fontHeight:y*dn,buffer:b,characterSet:a,maxCanvasWidth:nr},s&&{mapping:s.mapping,xOffset:s.xOffset,yOffset:s.yOffset})),Se=ae.mapping,ze=ae.canvasHeight,it=ae.xOffset,ut=ae.yOffset,ot=q.getImageData(0,0,H.width,H.height);if(H.height=ze,q.putImageData(ot,0,0),Ie(q,f,y,d),T){var Ct=new(si())(y,b,M,P,f,d),Xt=q.getImageData(0,0,Ct.size,Ct.size),Sr=Bo(a),_r;try{for(Sr.s();!(_r=Sr.n()).done;){var Wr=_r.value;if(k){var Cn=String.fromCharCode(parseInt(Wr.replace("&#x","").replace(";",""),16)),wi=Ct.draw(Cn);$e(wi,Xt)}else $e(Ct.draw(Wr),Xt);q.putImageData(Xt,Se[Wr].x,Se[Wr].y)}}catch(No){Sr.e(No)}finally{Sr.f()}}else{var ua=Bo(a),co;try{for(ua.s();!(co=ua.n()).done;){var Xo=co.value;q.fillText(Xo,Se[Xo].x,Se[Xo].y+y*Gt)}}catch(No){ua.e(No)}finally{ua.f()}}return{xOffset:it,yOffset:ut,mapping:Se,data:H,width:H.width,height:H.height}}},{key:"getKey",value:function(){var i=this.fontOptions,a=i.fontFamily,s=i.fontWeight;return"".concat(a,"_").concat(s)}},{key:"getNewChars",value:function(i,a){var s=this.cache.get(i);if(!s)return a;var l=[],f=s.mapping,d=new Set(Object.keys(f)),y=new Set(a);return y.forEach(function(b){d.has(b)||l.push(b)}),l}}]),t}(qa.EventEmitter))||Wa),Vt,ct;function yt(e){var r=St();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function St(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var He=3,dt=1024,Me=64,gt=(Vt=(0,tr.b2)(),Vt(ct=function(e){(0,Le.Z)(t,e);var r=yt(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"canvasHeight",128),(0,F.Z)((0,Re.Z)(n),"texture",void 0),(0,F.Z)((0,Re.Z)(n),"canvas",void 0),(0,F.Z)((0,Re.Z)(n),"iconData",void 0),(0,F.Z)((0,Re.Z)(n),"iconMap",void 0),(0,F.Z)((0,Re.Z)(n),"ctx",void 0),(0,F.Z)((0,Re.Z)(n),"loadingImageCount",0),n}return(0,j.Z)(t,[{key:"isLoading",value:function(){return this.loadingImageCount===0}},{key:"init",value:function(){this.iconData=[],this.iconMap={},this.canvas=window.document.createElement("canvas"),this.canvas.width=128,this.canvas.height=128,this.ctx=this.canvas.getContext("2d")}},{key:"addImage",value:function(){var n=(0,Zt.Z)(_e().mark(function a(s,l){var f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return f=new Image,this.loadingImageCount++,this.hasImage(s)?console.warn("Image Id already exists"):this.iconData.push({id:s,size:Me}),this.updateIconMap(),b.next=6,this.loadImage(l);case 6:f=b.sent,d=this.iconData.find(function(T){return T.id===s}),d&&(d.image=f,d.width=f.width,d.height=f.height),this.update();case 10:case"end":return b.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"addImageMini",value:function(i,a,s){var l=this,f=s.getSceneConfig().canvas,d=f.createImage();if(this.loadingImageCount++,this.hasImage(i))throw new Error("Image Id already exists");this.iconData.push({id:i,size:Me}),this.updateIconMap(),this.loadImageMini(a,f).then(function(y){d=y;var b=l.iconData.find(function(T){return T.id===i});b&&(b.image=d,b.width=d.width,b.height=d.height),l.update()})}},{key:"getTexture",value:function(){return this.texture}},{key:"getIconMap",value:function(){return this.iconMap}},{key:"getCanvas",value:function(){return this.canvas}},{key:"hasImage",value:function(i){return this.iconMap.hasOwnProperty(i)}},{key:"removeImage",value:function(i){this.hasImage(i)&&(this.iconData=this.iconData.filter(function(a){return a.id!==i}),delete this.iconMap[i],this.update())}},{key:"destroy",value:function(){this.removeAllListeners("imageUpdate"),this.iconData=[],this.iconMap={}}},{key:"loadImage",value:function(i){return new Promise(function(a,s){if(i instanceof HTMLImageElement){a(i);return}var l=new Image;l.crossOrigin="anonymous",l.onload=function(){a(l)},l.onerror=function(){s(new Error("Could not load image at "+i))},l.src=i instanceof File?URL.createObjectURL(i):i})}},{key:"update",value:function(){this.updateIconMap(),this.updateIconAtlas(),this.loadingImageCount--,this.loadingImageCount===0&&this.emit("imageUpdate")}},{key:"updateIconAtlas",value:function(){var i=this;this.canvas.width=dt,this.canvas.height=this.canvasHeight,Object.keys(this.iconMap).forEach(function(a){var s=i.iconMap[a],l=s.x,f=s.y,d=s.image,y=s.width,b=y===void 0?64:y,T=s.height,M=T===void 0?64:T,P=Math.max(b,M),k=P/Me,H=M/k,q=b/k;d&&i.ctx.drawImage(d,l+(Me-q)/2,f+(Me-H)/2,q,H)})}},{key:"updateIconMap",value:function(){var i=_o(this.iconData,He,dt),a=i.mapping,s=i.canvasHeight;this.iconMap=a,this.canvasHeight=s}},{key:"loadImageMini",value:function(i,a){return new Promise(function(s,l){var f=a.createImage();f.crossOrigin="anonymous",f.onload=function(){s(f)},f.onerror=function(){l(new Error("Could not load image at "+i))},f.src=i})}}]),t}(qa.EventEmitter))||ct),It=U(39536),hr,Rr,Er=(hr=(0,tr.b2)(),hr(Rr=function(){function e(){(0,Q.Z)(this,e),(0,F.Z)(this,"viewport",void 0),(0,F.Z)(this,"overridedViewProjectionMatrix",void 0),(0,F.Z)(this,"jitteredViewProjectionMatrix",void 0),(0,F.Z)(this,"jitteredProjectionMatrix",void 0),(0,F.Z)(this,"viewMatrixInverse",void 0),(0,F.Z)(this,"cameraPosition",void 0)}return(0,j.Z)(e,[{key:"init",value:function(){}},{key:"update",value:function(t){this.viewport=t,this.viewMatrixInverse=It.create(),It.invert(this.viewMatrixInverse,t.getViewMatrix()),this.cameraPosition=[this.viewMatrixInverse[12],this.viewMatrixInverse[13],this.viewMatrixInverse[14]]}},{key:"getProjectionMatrix",value:function(){return this.jitteredProjectionMatrix||this.viewport.getProjectionMatrix()}},{key:"getModelMatrix",value:function(){return this.viewport.getModelMatrix()}},{key:"getViewMatrix",value:function(){return this.viewport.getViewMatrix()}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.getViewMatrixUncentered()}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.getViewProjectionMatrixUncentered()}},{key:"getViewProjectionMatrix",value:function(){return this.overridedViewProjectionMatrix||this.jitteredViewProjectionMatrix||this.viewport.getViewProjectionMatrix()}},{key:"getZoom",value:function(){return this.viewport.getZoom()}},{key:"getZoomScale",value:function(){return this.viewport.getZoomScale()}},{key:"getCenter",value:function(){var t=this.viewport.getCenter(),n=(0,yn.Z)(t,2),i=n[0],a=n[1];return[i,a]}},{key:"getFocalDistance",value:function(){return this.viewport.getFocalDistance()}},{key:"getCameraPosition",value:function(){return this.cameraPosition}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}},{key:"setViewProjectionMatrix",value:function(t){this.overridedViewProjectionMatrix=t}},{key:"jitterProjectionMatrix",value:function(t,n){var i=It.fromTranslation(It.create(),[t,n,0]);this.jitteredProjectionMatrix=It.multiply(It.create(),i,this.viewport.getProjectionMatrix()),this.jitteredViewProjectionMatrix=It.multiply(It.create(),this.jitteredProjectionMatrix,this.viewport.getViewMatrix())}},{key:"clearJitterProjectionMatrix",value:function(){this.jitteredProjectionMatrix=void 0,this.jitteredViewProjectionMatrix=void 0}}]),e}())||Rr),Cr=function(e){return e.TOPRIGHT="topright",e.TOPLEFT="topleft",e.BOTTOMRIGHT="bottomright",e.BOTTOMLEFT="bottomleft",e.TOPCENTER="topcenter",e.BOTTOMCENTER="bottomcenter",e.LEFTCENTER="leftcenter",e.RIGHTCENTER="rightcenter",e.LEFTTOP="lefttop",e.RIGHTTOP="righttop",e.LEFTBOTTOM="leftbottom",e.RIGHTBOTTOM="rightbottom",e}({}),On,En;function Tn(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Yn(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Yn(e,r){if(e){if(typeof e=="string")return ni(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ni(e,r)}}function ni(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var aa={topleft:"column",topright:"column",bottomright:"column",bottomleft:"column",leftcenter:"column",rightcenter:"column",topcenter:"row",bottomcenter:"row",lefttop:"row",righttop:"row",leftbottom:"row",rightbottom:"row"},Fo=(On=(0,tr.b2)(),On(En=function(){function e(){(0,Q.Z)(this,e),(0,F.Z)(this,"container",void 0),(0,F.Z)(this,"controlCorners",void 0),(0,F.Z)(this,"controlContainer",void 0),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"controls",[]),(0,F.Z)(this,"unAddControls",[])}return(0,j.Z)(e,[{key:"init",value:function(t,n){this.container=t.container,this.scene=n,this.mapsService=n.get(Je.IMapService),this.initControlPos()}},{key:"addControl",value:function(t,n){var i=n.get(Je.IMapService);i.map?(t.addTo(this.scene),this.controls.push(t)):this.unAddControls.push(t)}},{key:"getControlByName",value:function(t){return this.controls.find(function(n){return n.controlOption.name===t})}},{key:"removeControl",value:function(t){var n=this.controls.indexOf(t);return n>-1&&this.controls.splice(n,1),t.remove(),this}},{key:"addControls",value:function(){var t=this;this.unAddControls.forEach(function(n){n.addTo(t.scene),t.controls.push(n)}),this.unAddControls=[]}},{key:"destroy",value:function(){var t=Tn(this.controls),n;try{for(t.s();!(n=t.n()).done;){var i=n.value;i.remove()}}catch(a){t.e(a)}finally{t.f()}this.controls=[],this.clearControlPos()}},{key:"initControlPos",value:function(){var t=this.controlCorners={},n="l7-",i=this.controlContainer=$i("div",n+"control-container",this.container);function a(){var l=arguments.length>0&&arguments[0]!==void 0?arguments[0]:[],f=l.map(function(d){return n+d}).join(" ");t[l.filter(function(d){return!["row","column"].includes(d)}).join("")]=$i("div",f,i)}function s(l){var f=l.replace(/^(top|bottom|left|right|center)/,"$1-").split("-");return[].concat((0,Jt.Z)(f),[aa[l]])}Object.values(Cr).forEach(function(l){a(s(l))}),this.checkCornerOverlap()}},{key:"clearControlPos",value:function(){for(var t in this.controlCorners)this.controlCorners[t]&&Ci(this.controlCorners[t]);this.controlContainer&&Ci(this.controlContainer)}},{key:"checkCornerOverlap",value:function(){var t=this,n=window.MutationObserver;if(n)for(var i=function(){var f=s[a],d=f.match(/^(top|bottom)(left|right)$/);if(d){var y=(0,yn.Z)(d,3),b=y[1],T=y[2],M=t.controlCorners["".concat(b).concat(T)],P=new n(function(k){var H=(0,yn.Z)(k,1),q=H[0].target;M&&(M.style[b]=q.clientHeight+"px")});P.observe(t.controlCorners["".concat(T).concat(b)],{childList:!0,attributes:!0})}},a=0,s=Object.keys(this.controlCorners);a<s.length;a++)i()}}]),e}())||En),$u,bp,Yu=($u=(0,tr.b2)(),$u(bp=function(){function e(){(0,Q.Z)(this,e),(0,F.Z)(this,"container",void 0),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"markers",[]),(0,F.Z)(this,"markerLayers",[]),(0,F.Z)(this,"unAddMarkers",[]),(0,F.Z)(this,"unAddMarkerLayers",[])}return(0,j.Z)(e,[{key:"addMarkerLayer",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markerLayers.push(t),t.addTo(this.scene)):this.unAddMarkerLayers.push(t)}},{key:"removeMarkerLayer",value:function(t){t.destroy(),this.markerLayers.indexOf(t);var n=this.markerLayers.indexOf(t);n>-1&&this.markerLayers.splice(n,1)}},{key:"addMarker",value:function(t){this.mapsService.map&&this.mapsService.getMarkerContainer()?(this.markers.push(t),t.addTo(this.scene)):this.unAddMarkers.push(t)}},{key:"addMarkers",value:function(){var t=this;this.unAddMarkers.forEach(function(n){n.addTo(t.scene),t.markers.push(n)}),this.unAddMarkers=[]}},{key:"addMarkerLayers",value:function(){var t=this;this.unAddMarkerLayers.forEach(function(n){t.markerLayers.push(n),n.addTo(t.scene)}),this.unAddMarkers=[]}},{key:"removeMarker",value:function(t){t.remove(),this.markers.indexOf(t);var n=this.markers.indexOf(t);n>-1&&this.markers.splice(n,1)}},{key:"removeAllMarkers",value:function(){this.destroy()}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Je.IMapService)}},{key:"destroy",value:function(){this.markers.forEach(function(t){t.remove()}),this.markers=[],this.markerLayers.forEach(function(t){t.destroy()}),this.markerLayers=[]}},{key:"removeMakerLayerMarker",value:function(t){t.destroy()}}]),e}())||bp),ed,Ll,td=(ed=(0,tr.b2)(),ed(Ll=function(){function e(){(0,Q.Z)(this,e),(0,F.Z)(this,"scene",void 0),(0,F.Z)(this,"mapsService",void 0),(0,F.Z)(this,"popups",[]),(0,F.Z)(this,"unAddPopups",[])}return(0,j.Z)(e,[{key:"isMarkerReady",get:function(){return this.mapsService.map&&this.mapsService.getMarkerContainer()}},{key:"removePopup",value:function(t){t!=null&&t.isOpen()&&t.remove();var n=this.popups.indexOf(t);n>-1&&this.popups.splice(n,1);var i=this.unAddPopups.indexOf(t);i>-1&&this.unAddPopups.splice(i,1)}},{key:"destroy",value:function(){this.popups.forEach(function(t){return t.remove()})}},{key:"addPopup",value:function(t){var n=this;t&&t.getOptions().autoClose&&[].concat((0,Jt.Z)(this.popups),(0,Jt.Z)(this.unAddPopups)).forEach(function(i){i.getOptions().autoClose&&n.removePopup(i)}),this.isMarkerReady?(t.addTo(this.scene),this.popups.push(t)):this.unAddPopups.push(t),t.on("close",function(){n.removePopup(t)})}},{key:"initPopup",value:function(){var t=this;this.unAddPopups.length&&this.unAddPopups.forEach(function(n){t.addPopup(n),t.unAddPopups=[]})}},{key:"init",value:function(t){this.scene=t,this.mapsService=t.get(Je.IMapService)}}]),e}())||Ll),ff=function(e){return e.normal="normal",e.additive="additive",e.subtractive="subtractive",e.min="min",e.max="max",e.none="none",e}({}),Kf=function(e){return e.MULTIPLE="MULTIPLE",e.SINGLE="SINGLE",e}({}),rd=function(e){return e.AND="and",e.OR="or",e}({}),Qo=function(e){return e.INIT="init",e.UPDATE="update",e}({}),Dh={MapToken:"\u60A8\u6B63\u5728\u4F7F\u7528 Demo \u6D4B\u8BD5 Token, \u751F\u4EA7\u73AF\u5883\u52A1\u5FC5\u81EA\u884C\u6CE8\u518C Token \u786E\u4FDD\u670D\u52A1\u7A33\u5B9A \u9AD8\u5FB7\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://lbs.amap.com/api/javascript-api/guide/abc/prepare  Mapbox\u5730\u56FE\u7533\u8BF7\u5730\u5740 https://docs.mapbox.com/help/glossary/access-token/",SDK:"\u8BF7\u786E\u8BA4\u5F15\u5165\u4E86mapbox-gl api\u4E14\u5728L7\u4E4B\u524D\u5F15\u5165"},Wv=Dh,Lh,Gv,Zo=ui.merge,Ga={id:"map",logoPosition:"bottomleft",logoVisible:!0,antialias:!0,stencil:!0,preserveDrawingBuffer:!1,pickBufferScale:1,fitBoundsOptions:{animate:!1}},sg={colors:["rgb(103,0,31)","rgb(178,24,43)","rgb(214,96,77)","rgb(244,165,130)","rgb(253,219,199)","rgb(247,247,247)","rgb(209,229,240)","rgb(146,197,222)","rgb(67,147,195)","rgb(33,102,172)","rgb(5,48,97)"],size:10,shape:"circle",scales:{},shape2d:["circle","triangle","square","pentagon","hexagon","octogon","hexagram","rhombus","vesica"],shape3d:["cylinder","triangleColumn","hexagonColumn","squareColumn"],minZoom:-1,maxZoom:24,visible:!0,autoFit:!1,pickingBuffer:0,enablePropagation:!1,zIndex:0,blend:"normal",maskLayers:[],enableMask:!0,maskOperation:rd.AND,pickedFeatureID:-1,enableMultiPassRenderer:!1,enablePicking:!0,active:!1,activeColor:"#2f54eb",enableHighlight:!1,enableSelect:!1,highlightColor:"#2f54eb",activeMix:0,selectColor:"blue",selectMix:0,enableTAA:!1,jitterScale:1,enableLighting:!1,animateOption:{enable:!1,interval:.2,duration:4,trailLength:.15},forward:!0},ug=(Lh=(0,tr.b2)(),Lh(Gv=function(){function e(){(0,Q.Z)(this,e),(0,F.Z)(this,"sceneConfigCache",{}),(0,F.Z)(this,"layerConfigCache",{}),(0,F.Z)(this,"layerAttributeConfigCache",{})}return(0,j.Z)(e,[{key:"getSceneConfig",value:function(t){return this.sceneConfigCache[t]}},{key:"getSceneWarninfo",value:function(t){return Wv[t]}},{key:"setSceneConfig",value:function(t,n){this.sceneConfigCache[t]=(0,W.Z)((0,W.Z)({},Ga),n)}},{key:"getLayerConfig",value:function(t){return this.layerConfigCache[t]}},{key:"setLayerConfig",value:function(t,n,i){this.layerConfigCache[n]=(0,W.Z)({},Zo({},this.sceneConfigCache[t],sg,i))}},{key:"getAttributeConfig",value:function(t){return this.layerAttributeConfigCache[t]}},{key:"setAttributeConfig",value:function(t,n){this.layerAttributeConfigCache[t]=(0,W.Z)((0,W.Z)({},this.layerAttributeConfigCache[t]),n)}},{key:"clean",value:function(){this.sceneConfigCache={},this.layerConfigCache={}}}]),e}())||Gv);function ki(e,r,t,n){t&&Object.defineProperty(e,r,{enumerable:t.enumerable,configurable:t.configurable,writable:t.writable,value:t.initializer?t.initializer.call(n):void 0})}function Pi(e,r,t,n,i){var a={};return Object.keys(n).forEach(function(s){a[s]=n[s]}),a.enumerable=!!a.enumerable,a.configurable=!!a.configurable,("value"in a||a.initializer)&&(a.writable=!0),a=t.slice().reverse().reduce(function(s,l){return l(e,r,s)||s},a),i&&a.initializer!==void 0&&(a.value=a.initializer?a.initializer.call(i):void 0,a.initializer=void 0),a.initializer===void 0&&(Object.defineProperty(e,r,a),a=null),a}var Bh=U(49953),nd=Math.PI/180,Fh=512,Qf=4003e4;function Xv(e){var r=e.latitude,t=r===void 0?0:r,n=e.zoom,i=n===void 0?0:n,a=e.scale,s=e.highPrecision,l=s===void 0?!1:s,f=e.flipY,d=f===void 0?!1:f;a=a!==void 0?a:Math.pow(2,i);var y={},b=Fh*a,T=Math.cos(t*nd),M=b/360,P=M/T,k=b/Qf/T;if(y.pixelsPerMeter=[k,-k,k],y.metersPerPixel=[1/k,-1/k,1/k],y.pixelsPerDegree=[M,-P,k],y.degreesPerPixel=[1/M,-1/P,1/k],l){var H=nd*Math.tan(t*nd)/T,q=M*H/2,ae=b/Qf*H,Se=ae/P*k;y.pixelsPerDegree2=[0,-q,ae],y.pixelsPerMeter2=[Se,0,Se],d&&(y.pixelsPerDegree2[1]=-y.pixelsPerDegree2[1],y.pixelsPerMeter2[1]=-y.pixelsPerMeter2[1])}return d&&(y.pixelsPerMeter[1]=-y.pixelsPerMeter[1],y.metersPerPixel[1]=-y.metersPerPixel[1],y.pixelsPerDegree[1]=-y.pixelsPerDegree[1],y.degreesPerPixel[1]=-y.degreesPerPixel[1]),y}var eo=function(e){return e[e.LNGLAT=1]="LNGLAT",e[e.LNGLAT_OFFSET=2]="LNGLAT_OFFSET",e[e.VECTOR_TILE=3]="VECTOR_TILE",e[e.IDENTITY=4]="IDENTITY",e[e.P20=5]="P20",e[e.P20_OFFSET=6]="P20_OFFSET",e[e.METER_OFFSET=7]="METER_OFFSET",e[e.P20_2=8]="P20_2",e}({}),uc={CoordinateSystem:"u_CoordinateSystem",ViewportCenter:"u_ViewportCenter",ViewportCenterProjection:"u_ViewportCenterProjection",PixelsPerDegree:"u_PixelsPerDegree",PixelsPerDegree2:"u_PixelsPerDegree2",PixelsPerMeter:"u_PixelsPerMeter",Mvp:"u_Mvp"},Nc,id,ad,od,Nh,hf=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,0],lg=(Nc=(0,tr.b2)(),id=(0,tr.f3)(Je.ICameraService),Nc(ad=(od=function(){function e(){(0,Q.Z)(this,e),(0,F.Z)(this,"needRefresh",!0),ki(this,"cameraService",Nh,this),(0,F.Z)(this,"coordinateSystem",void 0),(0,F.Z)(this,"viewportCenter",void 0),(0,F.Z)(this,"viewportCenterProjection",void 0),(0,F.Z)(this,"pixelsPerDegree",void 0),(0,F.Z)(this,"pixelsPerDegree2",void 0),(0,F.Z)(this,"pixelsPerMeter",void 0)}return(0,j.Z)(e,[{key:"refresh",value:function(t){var n=this.cameraService.getZoom(),i=this.cameraService.getZoomScale(),a=t||this.cameraService.getCenter(),s=Xv({latitude:a[1],zoom:n}),l=s.pixelsPerMeter,f=s.pixelsPerDegree;this.viewportCenter=a,this.viewportCenterProjection=[0,0,0,0],this.pixelsPerMeter=l,this.pixelsPerDegree=f,this.pixelsPerDegree2=[0,0,0],this.coordinateSystem===eo.LNGLAT||this.coordinateSystem===eo.P20?this.cameraService.setViewProjectionMatrix(void 0):this.coordinateSystem===eo.LNGLAT_OFFSET?this.calculateLnglatOffset(a,n):this.coordinateSystem===eo.P20_OFFSET&&this.calculateLnglatOffset(a,n,i,!0),this.needRefresh=!1}},{key:"getCoordinateSystem",value:function(){return this.coordinateSystem}},{key:"setCoordinateSystem",value:function(t){this.coordinateSystem=t}},{key:"getViewportCenter",value:function(){return this.viewportCenter}},{key:"getViewportCenterProjection",value:function(){return this.viewportCenterProjection}},{key:"getPixelsPerDegree",value:function(){return this.pixelsPerDegree}},{key:"getPixelsPerDegree2",value:function(){return this.pixelsPerDegree2}},{key:"getPixelsPerMeter",value:function(){return this.pixelsPerMeter}},{key:"calculateLnglatOffset",value:function(t,n,i,a){var s=Xv({latitude:t[1],zoom:n,scale:i,flipY:a,highPrecision:!0}),l=s.pixelsPerMeter,f=s.pixelsPerDegree,d=s.pixelsPerDegree2,y=this.cameraService.getViewMatrix(),b=this.cameraService.getProjectionMatrix(),T=It.multiply([],b,y),M=this.cameraService.projectFlat([Math.fround(t[0]),Math.fround(t[1])],Math.pow(2,n));this.viewportCenterProjection=Bh.fF([],[M[0],M[1],0,1],T),y=this.cameraService.getViewMatrixUncentered()||y,T=It.multiply([],b,y),T=It.multiply([],T,hf),this.cameraService.setViewProjectionMatrix(T),this.pixelsPerMeter=l,this.pixelsPerDegree=f,this.pixelsPerDegree2=d}}]),e}(),Nh=Pi(od.prototype,"cameraService",[id],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),od))||ad),$v,cg;function cs(e){var r=Jf();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function Jf(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fg=($v=(0,tr.b2)(),$v(cg=function(e){(0,Le.Z)(t,e);var r=cs(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"renderMap",new Map),(0,F.Z)((0,Re.Z)(n),"enable",!1),(0,F.Z)((0,Re.Z)(n),"renderEnable",!1),(0,F.Z)((0,Re.Z)(n),"cacheLogs",{}),n}return(0,j.Z)(t,[{key:"setEnable",value:function(i){this.enable=!!i}},{key:"log",value:function(i,a){var s=this;if(this.enable){var l=i.split("."),f=null;l.forEach(function(d,y){f!==null?(f[d]||(f[d]={}),y!==l.length-1&&(f=f[d])):(s.cacheLogs[d]||(s.cacheLogs[d]={}),y!==l.length-1&&(f=s.cacheLogs[d])),y===l.length-1&&(f[d]=(0,W.Z)((0,W.Z)({time:Date.now()},f[d]),a))})}}},{key:"getLog",value:function(i){var a=this;switch((0,js.Z)(i)){case"string":return this.cacheLogs[i];case"object":return i.map(function(s){return a.cacheLogs[s]}).filter(function(s){return s!==void 0});case"undefined":return this.cacheLogs}}},{key:"removeLog",value:function(i){delete this.cacheLogs[i]}},{key:"generateRenderUid",value:function(){return this.renderEnable?Co():""}},{key:"renderDebug",value:function(i){this.renderEnable=i}},{key:"renderStart",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i)||{};this.renderMap.set(i,(0,W.Z)((0,W.Z)({},a),{},{renderUid:i,renderStart:Date.now()}))}}},{key:"renderEnd",value:function(i){if(!(!this.renderEnable||!this.enable)){var a=this.renderMap.get(i);if(a){var s=a.renderStart,l=Date.now();this.emit("renderEnd",(0,W.Z)((0,W.Z)({},a),{},{renderEnd:l,renderDuration:l-s})),this.renderMap.delete(i)}}}},{key:"destroy",value:function(){this.cacheLogs=null,this.renderMap.clear()}}]),t}(qa.EventEmitter))||cg),o=U(11553),u=U.n(o),c=function(e){return e.Hover="hover",e.Click="click",e.Select="select",e.Active="active",e.Drag="drag",e}({}),m,x,E,A,R;function L(e){var r=V();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function V(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Y={panstart:"dragstart",panmove:"dragging",panend:"dragend",pancancel:"dragcancel"},K=(m=(0,tr.b2)(),x=(0,tr.f3)(Je.IMapService),m(E=(A=function(e){(0,Le.Z)(t,e);var r=L(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"indragging",!1),ki((0,Re.Z)(n),"mapService",R,(0,Re.Z)(n)),(0,F.Z)((0,Re.Z)(n),"hammertime",void 0),(0,F.Z)((0,Re.Z)(n),"lastClickTime",0),(0,F.Z)((0,Re.Z)(n),"lastClickXY",[-1,-1]),(0,F.Z)((0,Re.Z)(n),"clickTimer",void 0),(0,F.Z)((0,Re.Z)(n),"$containter",void 0),(0,F.Z)((0,Re.Z)(n),"onDrag",function(l){var f=n.interactionEvent(l);f.type=Y[f.type],f.type==="dragging"?n.indragging=!0:n.indragging=!1,n.emit(c.Drag,f)}),(0,F.Z)((0,Re.Z)(n),"onHammer",function(l){l.srcEvent.stopPropagation();var f=n.interactionEvent(l);n.emit(c.Hover,f)}),(0,F.Z)((0,Re.Z)(n),"onTouch",function(l){var f=l.touches[0];n.onHover({x:f.pageX,y:f.pageY,type:"touch"})}),(0,F.Z)((0,Re.Z)(n),"onHover",function(l){var f=l.clientX,d=l.clientY,y=f,b=d,T=l.type,M=n.mapService.getMapContainer();if(M){var P=M.getBoundingClientRect(),k=P.top,H=P.left;y=y-H-M.clientLeft,b=b-k-M.clientTop}var q=n.mapService.containerToLngLat([y,b]);if(T==="click"){n.isDoubleTap(y,b,q);return}if(T==="touch"){n.isDoubleTap(y,b,q);return}T!=="click"&&T!=="dblclick"&&n.emit(c.Hover,{x:y,y:b,lngLat:q,type:T,target:l})}),n}return(0,j.Z)(t,[{key:"init",value:function(){this.addEventListenerOnMap(),this.$containter=this.mapService.getMapContainer()}},{key:"destroy",value:function(){this.hammertime&&this.hammertime.destroy(),this.removeEventListenerOnMap(),this.off(c.Hover)}},{key:"triggerHover",value:function(i){var a=i.x,s=i.y;this.emit(c.Hover,{x:a,y:s})}},{key:"triggerSelect",value:function(i){this.emit(c.Select,{featureId:i})}},{key:"triggerActive",value:function(i){this.emit(c.Active,{featureId:i})}},{key:"handleMiniEvent",value:function(i){this.onHover({clientX:i.touches[0].pageX,clientY:i.touches[0].pageY,type:"touch"})}},{key:"addEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();if(i){var a=new(u()).Manager(i);a.add(new(u()).Tap({event:"dblclick",taps:2})),a.add(new(u()).Tap({event:"click"})),a.add(new(u()).Pan({threshold:0,pointers:0})),a.add(new(u()).Press({})),a.on("dblclick click",this.onHammer),a.on("panstart panmove panend pancancel",this.onDrag),i.addEventListener("mousemove",this.onHover),i.addEventListener("mousedown",this.onHover,!0),i.addEventListener("mouseup",this.onHover),i.addEventListener("contextmenu",this.onHover),this.hammertime=a}}},{key:"removeEventListenerOnMap",value:function(){var i=this.mapService.getMapContainer();i&&(i.removeEventListener("mousemove",this.onHover),this.hammertime.off("dblclick click",this.onHammer),this.hammertime.off("panstart panmove panend pancancel",this.onDrag),i.removeEventListener("mousedown",this.onHover),i.removeEventListener("mouseup",this.onHover),i.removeEventListener("contextmenu",this.onHover))}},{key:"interactionEvent",value:function(i){var a=i.type,s=i.pointerType,l,f;s==="touch"?(f=Math.floor(i.pointers[0].clientY),l=Math.floor(i.pointers[0].clientX)):(f=Math.floor(i.srcEvent.y),l=Math.floor(i.srcEvent.x));var d=this.mapService.getMapContainer();if(d){var y=d.getBoundingClientRect(),b=y.top,T=y.left;l-=T,f-=b}var M=this.mapService.containerToLngLat([l,f]);return{x:l,y:f,lngLat:M,type:a,target:i.srcEvent}}},{key:"isDoubleTap",value:function(i,a,s){var l=this,f=new Date().getTime(),d="click";f-this.lastClickTime<400&&Math.abs(this.lastClickXY[0]-i)<10&&Math.abs(this.lastClickXY[1]-a)<10?(this.lastClickTime=0,this.lastClickXY=[-1,-1],this.clickTimer&&clearTimeout(this.clickTimer),d="dblclick",this.emit(c.Hover,{x:i,y:a,lngLat:s,type:d})):(this.lastClickTime=f,this.lastClickXY=[i,a],this.clickTimer=setTimeout(function(){d="click",l.emit(c.Hover,{x:i,y:a,lngLat:s,type:d})},400))}}]),t}(zs()),R=Pi(A.prototype,"mapService",[x],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),A))||E),le=0;function de(e){var r=e;if(typeof e=="string"&&(r=document.getElementById(e)),r){var t=document.createElement("div");return t.style.cssText+=`
      position: absolute;
      z-index:2;
      height: 100%;
      width: 100%;
      pointer-events: none;
    `,t.id="l7-scene-".concat(le++),t.classList.add("l7-scene"),r.appendChild(t),t}return null}function Ne(e){var r,t=!0;if((e==null||(r=e.target)===null||r===void 0?void 0:r.target)instanceof HTMLElement)for(var n,i=e==null||(n=e.target)===null||n===void 0?void 0:n.target;i;){var a,s=Array.from(i.classList);if(s.includes("l7-marker")||s.includes("l7-popup")){t=!1;break}i=(a=i)===null||a===void 0?void 0:a.parentElement}return t}var I=function(e){return e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.CULL_FACE=2884]="CULL_FACE",e[e.BLEND=3042]="BLEND",e[e.DITHER=3024]="DITHER",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.RED=6403]="RED",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.TEXTURE1=33985]="TEXTURE1",e[e.TEXTURE2=33986]="TEXTURE2",e[e.TEXTURE3=33987]="TEXTURE3",e[e.TEXTURE4=33988]="TEXTURE4",e[e.TEXTURE5=33989]="TEXTURE5",e[e.TEXTURE6=33990]="TEXTURE6",e[e.TEXTURE7=33991]="TEXTURE7",e[e.TEXTURE8=33992]="TEXTURE8",e[e.TEXTURE9=33993]="TEXTURE9",e[e.TEXTURE10=33994]="TEXTURE10",e[e.TEXTURE11=33995]="TEXTURE11",e[e.TEXTURE12=33996]="TEXTURE12",e[e.TEXTURE13=33997]="TEXTURE13",e[e.TEXTURE14=33998]="TEXTURE14",e[e.TEXTURE15=33999]="TEXTURE15",e[e.TEXTURE16=34e3]="TEXTURE16",e[e.TEXTURE17=34001]="TEXTURE17",e[e.TEXTURE18=34002]="TEXTURE18",e[e.TEXTURE19=34003]="TEXTURE19",e[e.TEXTURE20=34004]="TEXTURE20",e[e.TEXTURE21=34005]="TEXTURE21",e[e.TEXTURE22=34006]="TEXTURE22",e[e.TEXTURE23=34007]="TEXTURE23",e[e.TEXTURE24=34008]="TEXTURE24",e[e.TEXTURE25=34009]="TEXTURE25",e[e.TEXTURE26=34010]="TEXTURE26",e[e.TEXTURE27=34011]="TEXTURE27",e[e.TEXTURE28=34012]="TEXTURE28",e[e.TEXTURE29=34013]="TEXTURE29",e[e.TEXTURE30=34014]="TEXTURE30",e[e.TEXTURE31=34015]="TEXTURE31",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e}({}),ft=function(e){return e[e.SAMPLED=0]="SAMPLED",e[e.RENDER_TARGET=1]="RENDER_TARGET",e}({}),tt,Rt,zt,ir,or,mr,Zr,qr,Bn,vn,Zn,mn,xi,ti=(tt=(0,tr.b2)(),Rt=(0,tr.f3)(Je.IMapService),zt=(0,tr.f3)(Je.IRendererService),ir=(0,tr.f3)(Je.IGlobalConfigService),or=(0,tr.f3)(Je.IInteractionService),mr=(0,tr.f3)(Je.ILayerService),tt(Zr=(qr=function(){function e(){var r=this;(0,Q.Z)(this,e),(0,F.Z)(this,"pickedColors",void 0),(0,F.Z)(this,"pickedTileLayers",[]),ki(this,"mapService",Bn,this),ki(this,"rendererService",vn,this),ki(this,"configService",Zn,this),ki(this,"interactionService",mn,this),ki(this,"layerService",xi,this),(0,F.Z)(this,"pickingFBO",void 0),(0,F.Z)(this,"width",0),(0,F.Z)(this,"height",0),(0,F.Z)(this,"alreadyInPicking",!1),(0,F.Z)(this,"pickBufferScale",1),(0,F.Z)(this,"pickFromPickingFBO",function(t,n){var i=n.x,a=n.y,s=n.lngLat,l=n.type,f=n.target,d=!1,y=r.rendererService,b=y.readPixels,T=y.getContainer,M=r.getContainerSize(T()),P=M.width,k=M.height;P*=sa,k*=sa;var H=t.getLayerConfig(),q=H.enableHighlight,ae=H.enableSelect,Se=i*sa,ze=a*sa;if(Se>P-1*sa||Se<0||ze>k-1*sa||ze<0)return!1;var it=b({x:Math.floor(Se/r.pickBufferScale),y:Math.floor((k-(a+1)*sa)/r.pickBufferScale),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:r.pickingFBO});if(r.pickedColors=it,it[0]!==0||it[1]!==0||it[2]!==0){var ut=ka(it),ot=t.layerPickService.getFeatureById(ut);ut!==t.getCurrentPickId()&&l==="mousemove"&&(l="mouseenter");var Ct={x:i,y:a,type:l,lngLat:s,featureId:ut,feature:ot,target:f};ot&&(d=!0,t.setCurrentPickId(ut),r.triggerHoverOnLayer(t,Ct))}else{var Xt={x:i,y:a,lngLat:s,type:t.getCurrentPickId()!==null&&l==="mousemove"?"mouseout":"un"+l,featureId:null,target:f,feature:null};r.triggerHoverOnLayer(t,(0,W.Z)((0,W.Z)({},Xt),{},{type:"unpick"})),r.triggerHoverOnLayer(t,Xt),t.setCurrentPickId(null)}if(q&&t.layerPickService.highlightPickedFeature(it),ae&&l==="click"&&(it==null?void 0:it.toString())!==[0,0,0,0].toString()){var Sr=ka(it);t.getCurrentSelectedId()===null||Sr!==t.getCurrentSelectedId()?(t.layerPickService.selectFeature(it),t.setCurrentSelectedId(Sr)):(t.layerPickService.selectFeature(new Uint8Array([0,0,0,0])),t.setCurrentSelectedId(null))}return d})}return(0,j.Z)(e,[{key:"init",value:function(t){var n=this.rendererService,i=n.createTexture2D,a=n.createFramebuffer,s=n.getContainer,l=this.getContainerSize(s()),f=l.width,d=l.height;f*=sa,d*=sa,this.pickBufferScale=this.configService.getSceneConfig(t).pickBufferScale||1,f=Math.round(f/this.pickBufferScale),d=Math.round(d/this.pickBufferScale),this.pickingFBO=a({color:i({width:f,height:d,wrapS:I.CLAMP_TO_EDGE,wrapT:I.CLAMP_TO_EDGE,usage:ft.RENDER_TARGET}),depth:!0,width:f,height:d}),this.interactionService.on(c.Hover,this.pickingAllLayer.bind(this))}},{key:"boxPickLayer",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i,a,s){var l=this,f,d,y;return _e().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:f=this.rendererService,d=f.useFramebuffer,y=f.clear,this.resizePickingFBO(),d(this.pickingFBO,function(){y({framebuffer:l.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),i.hooks.beforePickingEncode.call(),i.renderModels({ispick:!0}),i.hooks.afterPickingEncode.call();var M=l.pickBox(i,a);s(M)});case 3:case"end":return T.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"pickBox",value:function(t,n){var i=this,a=n.map(function(Sr){var _r=Sr<0?0:Sr;return Math.floor(_r*sa/i.pickBufferScale)}),s=(0,yn.Z)(a,4),l=s[0],f=s[1],d=s[2],y=s[3],b=this.rendererService,T=b.readPixels,M=b.getContainer,P=this.getContainerSize(M()),k=P.width,H=P.height;if(k*=sa,H*=sa,l>(k-1)*sa/this.pickBufferScale||d<0||f>(H-1)*sa/this.pickBufferScale||y<0)return[];for(var q=Math.min(k/this.pickBufferScale,d)-l,ae=Math.min(H/this.pickBufferScale,y)-f,Se=T({x:l,y:Math.floor(H/this.pickBufferScale-(y+1)),width:q,height:ae,data:new Uint8Array(q*ae*4),framebuffer:this.pickingFBO}),ze=[],it={},ut=0;ut<Se.length/4;ut=ut+1){var ot=Se.slice(ut*4,ut*4+4),Ct=ka(ot);if(Ct!==-1&&!it[Ct]){var Xt=t.layerPickService.getFeatureById(Ct);ze.push((0,W.Z)((0,W.Z)({},Xt),{},{pickedFeatureIdx:Ct})),it[Ct]=!0}}return ze}},{key:"handleCursor",value:function(t,n){var i=t.getLayerConfig(),a=i.cursor,s=a===void 0?"":a,l=i.cursorEnabled;if(l){var f=this.mapService.version,d=f==="GAODE2.x"?this.mapService.getMapContainer():this.mapService.getMarkerContainer(),y=d==null?void 0:d.style.getPropertyValue("cursor");n==="unmousemove"&&y!==""?d==null||d.style.setProperty("cursor",""):n==="mousemove"&&(d==null||d.style.setProperty("cursor",s))}}},{key:"destroy",value:function(){this.pickingFBO.destroy(),this.pickingFBO=null}},{key:"getContainerSize",value:function(t){return t.getContext?{width:t.width/sa,height:t.height/sa}:t.getBoundingClientRect()}},{key:"pickingAllLayer",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i){return _e().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!(!this.layerService.needPick(i.type)||!this.isPickingAllLayer())){s.next=2;break}return s.abrupt("return");case 2:return this.alreadyInPicking=!0,s.next=5,this.pickingLayers(i);case 5:this.layerService.renderLayers(),this.alreadyInPicking=!1;case 7:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"isPickingAllLayer",value:function(){return!(this.alreadyInPicking||this.layerService.alreadyInRendering||this.interactionService.indragging||!this.layerService.getShaderPickStat())}},{key:"resizePickingFBO",value:function(){var t=this.rendererService.getContainer,n=this.getContainerSize(t()),i=n.width,a=n.height;i*=sa,a*=sa,(this.width!==i||this.height!==a)&&(this.pickingFBO.resize({width:Math.round(i/this.pickBufferScale),height:Math.round(a/this.pickBufferScale)}),this.width=i,this.height=a)}},{key:"pickingLayers",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i){var a=this,s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:s=this.rendererService.clear,this.resizePickingFBO(),this.rendererService.useFramebuffer(this.pickingFBO,function(){var d=a.layerService.getRenderList();d.filter(function(y){return y.needPick(i.type)}).reverse().some(function(y){s({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1}),y.layerPickService.pickRender(i);var b=a.pickFromPickingFBO(y,i);return a.layerService.pickedLayerId=b?+y.id:-1,b&&!y.getLayerConfig().enablePropagation})});case 3:case"end":return f.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"triggerHoverOnLayer",value:function(t,n){Ne(n)&&(this.handleCursor(t,n.type),t.emit(n.type,n))}}]),e}(),Bn=Pi(qr.prototype,"mapService",[Rt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),vn=Pi(qr.prototype,"rendererService",[zt],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Zn=Pi(qr.prototype,"configService",[ir],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),mn=Pi(qr.prototype,"interactionService",[or],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xi=Pi(qr.prototype,"layerService",[mr],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),qr))||Zr),Rn=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;(0,Q.Z)(this,e),(0,F.Z)(this,"autoStart",void 0),(0,F.Z)(this,"startTime",0),(0,F.Z)(this,"oldTime",0),(0,F.Z)(this,"running",!1),(0,F.Z)(this,"elapsedTime",0),this.autoStart=r}return(0,j.Z)(e,[{key:"start",value:function(){this.startTime=(typeof performance=="undefined"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0}},{key:"stop",value:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1}},{key:"getElapsedTime",value:function(){return this.getDelta(),this.elapsedTime}},{key:"getDelta",value:function(){var t=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var n=(typeof performance=="undefined"?Date:performance).now();t=(n-this.oldTime)/1e3,this.oldTime=n,this.elapsedTime+=t}return t}}]),e}(),Mi,mi,Hi,Hn,ea,ba,so,to,Fa;function Xa(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Jo(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Jo(e,r){if(e){if(typeof e=="string")return Vo(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Vo(e,r)}}function Vo(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Ws(e){var r=fs();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function fs(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Os=ui.throttle,So=(Mi=(0,tr.b2)(),mi=(0,tr.f3)(Je.IRendererService),Hi=(0,tr.f3)(Je.IMapService),Hn=(0,tr.f3)(Je.IDebugService),Mi(ea=(ba=function(e){(0,Le.Z)(t,e);var r=Ws(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"pickedLayerId",-1),(0,F.Z)((0,Re.Z)(n),"clock",new Rn),(0,F.Z)((0,Re.Z)(n),"alreadyInRendering",!1),(0,F.Z)((0,Re.Z)(n),"layers",[]),(0,F.Z)((0,Re.Z)(n),"layerList",[]),(0,F.Z)((0,Re.Z)(n),"layerRenderID",void 0),(0,F.Z)((0,Re.Z)(n),"sceneInited",!1),(0,F.Z)((0,Re.Z)(n),"animateInstanceCount",0),(0,F.Z)((0,Re.Z)(n),"shaderPicking",!0),(0,F.Z)((0,Re.Z)(n),"enableRender",!0),ki((0,Re.Z)(n),"renderService",so,(0,Re.Z)(n)),ki((0,Re.Z)(n),"mapService",to,(0,Re.Z)(n)),ki((0,Re.Z)(n),"debugService",Fa,(0,Re.Z)(n)),(0,F.Z)((0,Re.Z)(n),"reRender",Os(function(){n.renderLayers()},32)),(0,F.Z)((0,Re.Z)(n),"throttleRenderLayers",Os(function(){n.renderLayers()},16)),n}return(0,j.Z)(t,[{key:"needPick",value:function(i){return this.layerList.some(function(a){return a.needPick(i)})}},{key:"add",value:function(i){var a=this;this.layers.push(i),this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"addMask",value:function(i){var a=this;this.sceneInited&&i.init().then(function(){a.renderLayers()})}},{key:"initLayers",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s=this;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:this.sceneInited=!0,this.layers.forEach(function(){var d=(0,Zt.Z)(_e().mark(function y(b){return _e().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(b.startInit){M.next=4;break}return M.next=3,b.init();case 3:s.updateLayerRenderList();case 4:case"end":return M.stop()}},y)}));return function(y){return d.apply(this,arguments)}}());case 2:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSceneInited",value:function(){return this.sceneInited}},{key:"getRenderList",value:function(){return this.layerList}},{key:"getLayers",value:function(){return this.layers}},{key:"getLayer",value:function(i){return this.layers.find(function(a){return a.id===i})}},{key:"getLayerByName",value:function(i){return this.layers.find(function(a){return a.name===i})}},{key:"remove",value:function(){var n=(0,Zt.Z)(_e().mark(function a(s,l){var f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:l?(f=l.layerChildren.indexOf(s),f>-1&&l.layerChildren.splice(f,1)):(d=this.layers.indexOf(s),d>-1&&this.layers.splice(d,1)),s.destroy(),this.reRender(),this.emit("layerChange",this.layers);case 4:case"end":return b.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"removeAllLayers",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:this.destroy(),this.reRender();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setEnableRender",value:function(i){this.enableRender=i}},{key:"renderLayers",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y,b,T,M,P;return _e().wrap(function(H){for(;;)switch(H.prev=H.next){case 0:if(!(this.alreadyInRendering||!this.enableRender)){H.next=2;break}return H.abrupt("return");case 2:this.updateLayerRenderList(),s=this.debugService.generateRenderUid(),this.debugService.renderStart(s),this.alreadyInRendering=!0,this.clear(),l=Xa(this.layerList);try{for(l.s();!(f=l.n()).done;)d=f.value,d.prerender()}catch(q){l.e(q)}finally{l.f()}this.renderService.beginFrame(),y=Xa(this.layerList),H.prev=11,y.s();case 13:if((b=y.n()).done){H.next=25;break}if(T=b.value,M=T.getLayerConfig(),P=M.enableMask,T.masks.filter(function(q){return q.inited}).length>0&&P&&this.renderMask(T.masks),!T.getLayerConfig().enableMultiPassRenderer){H.next=22;break}return H.next=20,T.renderMultiPass();case 20:H.next=23;break;case 22:T.render();case 23:H.next=13;break;case 25:H.next=30;break;case 27:H.prev=27,H.t0=H.catch(11),y.e(H.t0);case 30:return H.prev=30,y.f(),H.finish(30);case 33:this.renderService.endFrame(),this.debugService.renderEnd(s),this.alreadyInRendering=!1;case 36:case"end":return H.stop()}},a,this,[[11,27,30,33]])}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMask",value:function(i){var a=0;this.renderService.clear({stencil:0,depth:1,framebuffer:null});var s=i.length>1?Kf.MULTIPLE:Kf.SINGLE,l=Xa(i),f;try{for(l.s();!(f=l.n()).done;){var d=f.value;d.render({isStencil:!0,stencilType:s,stencilIndex:a++})}}catch(y){l.e(y)}finally{l.f()}}},{key:"beforeRenderData",value:function(){var n=(0,Zt.Z)(_e().mark(function a(s){var l;return _e().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,s.hooks.beforeRenderData.promise();case 2:l=d.sent,l&&this.renderLayers();case 4:case"end":return d.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderTileLayerMask",value:function(i){var a=0,s=i.getLayerConfig(),l=s.enableMask,f=l===void 0?!0:l,d=i.tileMask?1:0,y=i.masks.filter(function(k){return k.inited});d=d+(f?y.length:1);var b=d>1?Kf.MULTIPLE:Kf.SINGLE;if((i.tileMask||y.length&&f)&&this.renderService.clear({stencil:0,depth:1,framebuffer:null}),y.length&&f){var T=Xa(y),M;try{for(T.s();!(M=T.n()).done;){var P=M.value;P.render({isStencil:!0,stencilType:b,stencilIndex:a++})}}catch(k){T.e(k)}finally{T.f()}}i.tileMask&&i.tileMask.render({isStencil:!0,stencilType:b,stencilIndex:a++,stencilOperation:rd.OR})}},{key:"renderTileLayer",value:function(){var n=(0,Zt.Z)(_e().mark(function a(s){return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.renderTileLayerMask(s),!s.getLayerConfig().enableMultiPassRenderer){f.next=6;break}return f.next=4,s.renderMultiPass();case 4:f.next=8;break;case 6:return f.next=8,s.render();case 8:case"end":return f.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateLayerRenderList",value:function(){var i=this;this.layerList=[],this.layers.filter(function(a){return a.inited}).filter(function(a){return a.isVisible()}).sort(function(a,s){return a.zIndex-s.zIndex}).forEach(function(a){i.layerList.push(a)})}},{key:"destroy",value:function(){this.layers.forEach(function(i){i.destroy()}),this.layers=[],this.layerList=[],this.emit("layerChange",this.layers)}},{key:"startAnimate",value:function(){this.animateInstanceCount++===0&&(this.clock.start(),this.runRender())}},{key:"stopAnimate",value:function(){--this.animateInstanceCount===0&&(this.stopRender(),this.clock.stop())}},{key:"getOESTextureFloat",value:function(){return this.renderService.extensionObject.OES_texture_float}},{key:"enableShaderPick",value:function(){this.shaderPicking=!0}},{key:"disableShaderPick",value:function(){this.shaderPicking=!1}},{key:"getShaderPickStat",value:function(){return this.shaderPicking}},{key:"clear",value:function(){var i=vi(this.mapService.bgColor);this.renderService.clear({color:i,depth:1,stencil:0,framebuffer:null})}},{key:"runRender",value:function(){this.renderLayers(),this.layerRenderID=window.requestAnimationFrame(this.runRender.bind(this))}},{key:"stopRender",value:function(){window.cancelAnimationFrame(this.layerRenderID)}}]),t}(qa.EventEmitter),so=Pi(ba.prototype,"renderService",[mi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),to=Pi(ba.prototype,"mapService",[Hi],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fa=Pi(ba.prototype,"debugService",[Hn],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ba))||ea),Ea=U(56929),Fi=ui.isNil,Sa=function(){function e(r){var t=this;(0,Q.Z)(this,e),(0,F.Z)(this,"name",void 0),(0,F.Z)(this,"type",void 0),(0,F.Z)(this,"scale",void 0),(0,F.Z)(this,"descriptor",void 0),(0,F.Z)(this,"featureBufferLayout",[]),(0,F.Z)(this,"needRescale",!1),(0,F.Z)(this,"needRemapping",!1),(0,F.Z)(this,"needRegenerateVertices",!1),(0,F.Z)(this,"featureRange",{startIndex:0,endIndex:1/0}),(0,F.Z)(this,"vertexAttribute",void 0),(0,F.Z)(this,"defaultCallback",function(n){if(n.length===0){var i;return((i=t.scale)===null||i===void 0?void 0:i.defaultValues)||[]}return n.map(function(a,s){var l,f=(l=t.scale)===null||l===void 0?void 0:l.scalers[s].func,d=f(a);return d})}),this.setProps(r)}return(0,j.Z)(e,[{key:"setProps",value:function(t){Object.assign(this,t)}},{key:"mapping",value:function(t){var n;if((n=this.scale)!==null&&n!==void 0&&n.callback){var i,a=(i=this.scale)===null||i===void 0?void 0:i.callback.apply(i,(0,Jt.Z)(t));if(!Fi(a))return[a]}return this.defaultCallback(t)}},{key:"resetDescriptor",value:function(){this.descriptor&&(this.descriptor.buffer.data=[])}}]),e}(),pa=["buffer","update","name"],qi=["buffer","update","name"],hs,Ts,Da,Ao,ps,ta,Uc=(hs={},(0,F.Z)(hs,I.FLOAT,4),(0,F.Z)(hs,I.UNSIGNED_BYTE,1),(0,F.Z)(hs,I.UNSIGNED_SHORT,2),hs),qu=(Ts=(0,tr.b2)(),Da=(0,tr.f3)(Je.IRendererService),Ts(Ao=(ps=function(){function e(){(0,Q.Z)(this,e),(0,F.Z)(this,"attributesAndIndices",void 0),ki(this,"rendererService",ta,this),(0,F.Z)(this,"attributes",[]),(0,F.Z)(this,"triangulation",void 0),(0,F.Z)(this,"featureLayout",{sizePerElement:0,elements:[]})}return(0,j.Z)(e,[{key:"registerStyleAttribute",value:function(t){var n=this.getLayerStyleAttribute(t.name||"");return n?n.setProps(t):(n=new Sa(t),this.attributes.push(n)),n}},{key:"unRegisterStyleAttribute",value:function(t){var n=this.attributes.findIndex(function(i){return i.name===t});n>-1&&this.attributes.splice(n,1)}},{key:"updateScaleAttribute",value:function(t){this.attributes.forEach(function(n){var i,a=n.name,s=(i=n.scale)===null||i===void 0?void 0:i.field;(t[a]||s&&t[s])&&(n.needRescale=!0,n.needRemapping=!0,n.needRegenerateVertices=!0)})}},{key:"updateStyleAttribute",value:function(t,n,i){var a=this.getLayerStyleAttribute(t);a||(a=this.registerStyleAttribute((0,W.Z)((0,W.Z)({},n),{},{name:t})));var s=n.scale;s&&a&&(a.scale=s,a.needRescale=!0,a.needRemapping=!0,a.needRegenerateVertices=!0,i&&i.featureRange&&(a.featureRange=i.featureRange))}},{key:"getLayerStyleAttributes",value:function(){return this.attributes}},{key:"getLayerStyleAttribute",value:function(t){return this.attributes.find(function(n){return n.name===t})}},{key:"getLayerAttributeScale",value:function(t){var n,i=this.getLayerStyleAttribute(t),a=i==null||(n=i.scale)===null||n===void 0?void 0:n.scalers;return a&&a[0]?a[0].func:null}},{key:"updateAttributeByFeatureRange",value:function(t,n){var i=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,a=arguments.length>3?arguments[3]:void 0,s=arguments.length>4?arguments[4]:void 0,l=this.attributes.find(function(it){return it.name===t});if(l&&l.descriptor){var f=l.descriptor,d=f.update,y=f.buffer,b=f.size,T=b===void 0?0:b,M=Uc[y.type||I.FLOAT];if(d){var P=this.featureLayout,k=P.elements,H=P.sizePerElement,q=k.slice(i,a);if(!q.length)return;var ae=q[0].offset,Se=ae*T*M,ze=q.map(function(it,ut){for(var ot=it.featureIdx,Ct=it.vertices,Xt=it.normals,Sr=Ct.length/H,_r=[],Wr=0;Wr<Sr;Wr++){var Cn=Xt?Xt.slice(Wr*3,Wr*3+3):[];_r.push.apply(_r,(0,Jt.Z)(d(n[ot],ot,Ct.slice(Wr*H,Wr*H+H),ut,Cn)))}return _r}).flat();l.vertexAttribute.updateBuffer({data:ze,offset:Se}),s==null||s.emit("legend:".concat(t),{type:t,attr:l})}}}},{key:"createAttributesAndIndices",value:function(t,n,i){var a=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var s=this.attributes.map(function(q){return q.resetDescriptor(),q.descriptor}),l=0,f=0,d=[],y=3;t.forEach(function(q,ae){var Se=a.triangulation(q,i),ze=Se.indices,it=Se.vertices,ut=Se.normals,ot=Se.size,Ct=Se.indexes,Xt=Se.count;typeof Xt=="number"&&(f+=Xt),ze.forEach(function(Cn){d.push(Cn+l)}),y=ot;var Sr=it.length/ot;a.featureLayout.sizePerElement=y,a.featureLayout.elements.push({featureIdx:ae,vertices:it,normals:ut,offset:l}),l+=Sr;for(var _r=function(wi){var ua=(ut==null?void 0:ut.slice(wi*3,wi*3+3))||[],co=it.slice(wi*ot,wi*ot+ot),Xo=0;Ct&&Ct[wi]!==void 0&&(Xo=Ct[wi]),s.forEach(function(No,Ys){if(No&&No.update){var bl;(bl=No.buffer.data).push.apply(bl,(0,Jt.Z)(No.update(q,ae,co,wi,ua,Xo)))}})},Wr=0;Wr<Sr;Wr++)_r(Wr)});var b=this.rendererService,T=b.createAttribute,M=b.createBuffer,P=b.createElements,k={};s.forEach(function(q,ae){if(q){var Se=q.buffer,ze=q.update,it=q.name,ut=(0,Ea.Z)(q,pa),ot=T((0,W.Z)({buffer:M(Se)},ut));k[q.name||""]=ot,a.attributes[ae].vertexAttribute=ot}});var H=P({data:d,type:I.UNSIGNED_INT,count:d.length});return this.attributesAndIndices={attributes:k,elements:H,count:f},this.attributesAndIndices}},{key:"createAttributes",value:function(t,n){var i=this;this.featureLayout={sizePerElement:0,elements:[]},n&&(this.triangulation=n);var a=this.attributes.map(function(M){return M.resetDescriptor(),M.descriptor}),s=0,l=[],f=3;t.forEach(function(M,P){var k=i.triangulation(M),H=k.indices,q=k.vertices,ae=k.normals,Se=k.size,ze=k.indexes;H.forEach(function(Ct){l.push(Ct+s)}),f=Se;var it=q.length/Se;i.featureLayout.sizePerElement=f,i.featureLayout.elements.push({featureIdx:P,vertices:q,normals:ae,offset:s}),s+=it;for(var ut=function(Xt){var Sr=(ae==null?void 0:ae.slice(Xt*3,Xt*3+3))||[],_r=q.slice(Xt*Se,Xt*Se+Se),Wr=0;ze&&ze[Xt]!==void 0&&(Wr=ze[Xt]),a.forEach(function(Cn,wi){if(Cn&&Cn.update){var ua;(ua=Cn.buffer.data).push.apply(ua,(0,Jt.Z)(Cn.update(M,P,_r,Xt,Sr,Wr)))}})},ot=0;ot<it;ot++)ut(ot)});var d=this.rendererService,y=d.createAttribute,b=d.createBuffer,T={};return a.forEach(function(M,P){if(M){var k=M.buffer,H=M.update,q=M.name,ae=(0,Ea.Z)(M,qi),Se=y((0,W.Z)({buffer:b(k)},ae));T[M.name||""]=Se,i.attributes[P].vertexAttribute=Se}}),{attributes:T}}},{key:"clearAllAttributes",value:function(){var t;this.attributes.forEach(function(n){n.vertexAttribute&&n.vertexAttribute.destroy()}),(t=this.attributesAndIndices)===null||t===void 0||t.elements.destroy(),this.attributes=[]}}]),e}(),ta=Pi(ps.prototype,"rendererService",[Da],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),ps))||Ao),Bl=U(14224);function uo(e,r,t,n){function i(a){return a instanceof t?a:new t(function(s){s(a)})}return new(t||(t=Promise))(function(a,s){function l(y){try{d(n.next(y))}catch(b){s(b)}}function f(y){try{d(n.throw(y))}catch(b){s(b)}}function d(y){y.done?a(y.value):i(y.value).then(l,f)}d((n=n.apply(e,r||[])).next())})}function Fl(e,r){var t={label:0,sent:function(){if(a[0]&1)throw a[1];return a[1]},trys:[],ops:[]},n,i,a,s;return s={next:l(0),throw:l(1),return:l(2)},typeof Symbol=="function"&&(s[Symbol.iterator]=function(){return this}),s;function l(d){return function(y){return f([d,y])}}function f(d){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(a=d[0]&2?i.return:d[0]?i.throw||((a=i.return)&&a.call(i),0):i.next)&&!(a=a.call(i,d[1])).done)return a;switch(i=0,a&&(d=[d[0]&2,a.value]),d[0]){case 0:case 1:a=d;break;case 4:return t.label++,{value:d[1],done:!1};case 5:t.label++,i=d[1],d=[0];continue;case 7:d=t.ops.pop(),t.trys.pop();continue;default:if(a=t.trys,!(a=a.length>0&&a[a.length-1])&&(d[0]===6||d[0]===2)){t=0;continue}if(d[0]===3&&(!a||d[1]>a[0]&&d[1]<a[3])){t.label=d[1];break}if(d[0]===6&&t.label<a[1]){t.label=a[1],a=d;break}if(a&&t.label<a[2]){t.label=a[2],t.ops.push(d);break}a[2]&&t.ops.pop(),t.trys.pop();continue}d=r.call(e,t)}catch(y){d=[6,y],i=0}finally{n=a=0}if(d[0]&5)throw d[1];return{value:d[0]?d[1]:void 0,done:!0}}}function Cu(e,r){var t=typeof Symbol=="function"&&e[Symbol.iterator];if(!t)return e;var n=t.call(e),i,a=[],s;try{for(;(r===void 0||r-- >0)&&!(i=n.next()).done;)a.push(i.value)}catch(l){s={error:l}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(s)throw s.error}}return a}function pf(e,r,t){if(t||arguments.length===2)for(var n=0,i=r.length,a;n<i;n++)(a||!(n in r))&&(a||(a=Array.prototype.slice.call(r,0,n)),a[n]=r[n]);return e.concat(a||Array.prototype.slice.call(r))}function df(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var eh={exports:{}},Nl={exports:{}},zc={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return n&&typeof n.length=="number"&&n.length>=0&&n.length%1===0}e.exports=r.default})(zc,zc.exports);var nu={},th={exports:{}},Uh={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return function(){for(var n=[],i=arguments.length;i--;)n[i]=arguments[i];var a=n.pop();return t.call(this,n,a)}},e.exports=r.default})(Uh,Uh.exports);var lc={};Object.defineProperty(lc,"__esModule",{value:!0}),lc.fallback=zh,lc.wrap=mf;var Gd=lc.hasQueueMicrotask=typeof queueMicrotask=="function"&&queueMicrotask,vf=lc.hasSetImmediate=typeof setImmediate=="function"&&setImmediate,sd=lc.hasNextTick=typeof Bl=="object"&&typeof Bl.nextTick=="function";function zh(e){setTimeout(e,0)}function mf(e){return function(r){for(var t=[],n=arguments.length-1;n-- >0;)t[n]=arguments[n+1];return e(function(){return r.apply(void 0,t)})}}var Zc;Gd?Zc=queueMicrotask:vf?Zc=setImmediate:sd?Zc=Bl.nextTick:Zc=zh,lc.default=mf(Zc),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=f;var t=Uh.exports,n=l(t),i=lc,a=l(i),s=nu;function l(b){return b&&b.__esModule?b:{default:b}}function f(b){return(0,s.isAsync)(b)?function(){for(var T=[],M=arguments.length;M--;)T[M]=arguments[M];var P=T.pop(),k=b.apply(this,T);return d(k,P)}:(0,n.default)(function(T,M){var P;try{P=b.apply(this,T)}catch(k){return M(k)}if(P&&typeof P.then=="function")return d(P,M);M(null,P)})}function d(b,T){return b.then(function(M){y(T,null,M)},function(M){y(T,M&&M.message?M:new Error(M))})}function y(b,T,M){try{b(T,M)}catch(P){(0,a.default)(function(k){throw k},P)}}e.exports=r.default}(th,th.exports),Object.defineProperty(nu,"__esModule",{value:!0}),nu.isAsyncIterable=nu.isAsyncGenerator=nu.isAsync=void 0;var Xd=th.exports,$d=ud(Xd);function ud(e){return e&&e.__esModule?e:{default:e}}function Ep(e){return e[Symbol.toStringTag]==="AsyncFunction"}function Yd(e){return e[Symbol.toStringTag]==="AsyncGenerator"}function ld(e){return typeof e[Symbol.asyncIterator]=="function"}function cd(e){if(typeof e!="function")throw new Error("expected a function");return Ep(e)?(0,$d.default)(e):e}nu.default=cd,nu.isAsync=Ep,nu.isAsyncGenerator=Yd,nu.isAsyncIterable=ld;var cc={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n,i){if(i===void 0&&(i=n.length),!i)throw new Error("arity is undefined");function a(){for(var s=this,l=[],f=arguments.length;f--;)l[f]=arguments[f];return typeof l[i-1]=="function"?n.apply(this,l):new Promise(function(d,y){l[i-1]=function(b){for(var T=[],M=arguments.length-1;M-- >0;)T[M]=arguments[M+1];if(b)return y(b);d(T.length>1?T:T[0])},n.apply(s,l)})}return a}e.exports=r.default})(cc,cc.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=zc.exports,n=f(t),i=nu,a=f(i),s=cc.exports,l=f(s);function f(d){return d&&d.__esModule?d:{default:d}}r.default=(0,l.default)(function(d,y,b){var T=(0,n.default)(y)?[]:{};d(y,function(M,P,k){(0,a.default)(M)(function(H){for(var q,ae=[],Se=arguments.length-1;Se-- >0;)ae[Se]=arguments[Se+1];ae.length<2&&(q=ae,ae=q[0]),T[P]=ae,k(H)})},function(M){return b(M,T)})},3),e.exports=r.default}(Nl,Nl.exports);var Sp={exports:{}},gf={exports:{}},Ap={exports:{}},Vc={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){function i(){for(var a=[],s=arguments.length;s--;)a[s]=arguments[s];if(n!==null){var l=n;n=null,l.apply(this,a)}}return Object.assign(i,n),i}e.exports=r.default})(Vc,Vc.exports);var Zh={exports:{}},_f={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=function(t){return t[Symbol.iterator]&&t[Symbol.iterator]()},e.exports=r.default})(_f,_f.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=y;var t=zc.exports,n=s(t),i=_f.exports,a=s(i);function s(b){return b&&b.__esModule?b:{default:b}}function l(b){var T=-1,M=b.length;return function(){return++T<M?{value:b[T],key:T}:null}}function f(b){var T=-1;return function(){var P=b.next();return P.done?null:(T++,{value:P.value,key:T})}}function d(b){var T=b?Object.keys(b):[],M=-1,P=T.length;return function k(){var H=T[++M];return H==="__proto__"?k():M<P?{value:b[H],key:H}:null}}function y(b){if((0,n.default)(b))return l(b);var T=(0,a.default)(b);return T?f(T):d(b)}e.exports=r.default}(Zh,Zh.exports);var yf={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=t;function t(n){return function(){for(var i=[],a=arguments.length;a--;)i[a]=arguments[a];if(n===null)throw new Error("Callback was already called.");var s=n;n=null,s.apply(this,i)}}e.exports=r.default})(yf,yf.exports);var rh={exports:{}},Vh={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t={};r.default=t,e.exports=r.default})(Vh,Vh.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=a;var t=Vh.exports,n=i(t);function i(s){return s&&s.__esModule?s:{default:s}}function a(s,l,f,d){var y=!1,b=!1,T=!1,M=0,P=0;function k(){M>=l||T||y||(T=!0,s.next().then(function(ae){var Se=ae.value,ze=ae.done;if(!(b||y)){if(T=!1,ze){y=!0,M<=0&&d(null);return}M++,f(Se,P,H),P++,k()}}).catch(q))}function H(ae,Se){if(M-=1,!b){if(ae)return q(ae);if(ae===!1){y=!0,b=!0;return}if(Se===n.default||y&&M<=0)return y=!0,d(null);k()}}function q(ae){b||(T=!1,y=!0,d(ae))}k()}e.exports=r.default}(rh,rh.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=Vc.exports,n=M(t),i=Zh.exports,a=M(i),s=yf.exports,l=M(s),f=nu,d=rh.exports,y=M(d),b=Vh.exports,T=M(b);function M(P){return P&&P.__esModule?P:{default:P}}r.default=function(P){return function(k,H,q){if(q=(0,n.default)(q),P<=0)throw new RangeError("concurrency limit cannot be less than 1");if(!k)return q(null);if((0,f.isAsyncGenerator)(k))return(0,y.default)(k,P,H,q);if((0,f.isAsyncIterable)(k))return(0,y.default)(k[Symbol.asyncIterator](),P,H,q);var ae=(0,a.default)(k),Se=!1,ze=!1,it=0,ut=!1;function ot(Xt,Sr){if(!ze)if(it-=1,Xt)Se=!0,q(Xt);else if(Xt===!1)Se=!0,ze=!0;else{if(Sr===T.default||Se&&it<=0)return Se=!0,q(null);ut||Ct()}}function Ct(){for(ut=!0;it<P&&!Se;){var Xt=ae();if(Xt===null){Se=!0,it<=0&&q(null);return}it+=1,H(Xt.value,Xt.key,(0,l.default)(ot))}ut=!1}Ct()}},e.exports=r.default}(Ap,Ap.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=Ap.exports,n=f(t),i=nu,a=f(i),s=cc.exports,l=f(s);function f(y){return y&&y.__esModule?y:{default:y}}function d(y,b,T,M){return(0,n.default)(b)(y,(0,a.default)(T),M)}r.default=(0,l.default)(d,4),e.exports=r.default}(gf,gf.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=gf.exports,n=s(t),i=cc.exports,a=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,d,y){return(0,n.default)(f,1,d,y)}r.default=(0,a.default)(l,3),e.exports=r.default}(Sp,Sp.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=l;var t=Nl.exports,n=s(t),i=Sp.exports,a=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,d){return(0,n.default)(a.default,f,d)}e.exports=r.default}(eh,eh.exports);var fd=df(eh.exports),Ul=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.call=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,fd(this.tasks)},e.prototype.tap=function(r,t){var n=this;this.tasks.push(function(i){t.apply(void 0,pf([],Cu(n.args),!1)),i(null,r)})},e}(),qd={exports:{}},hd={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=zc.exports,n=H(t),i=Vh.exports,a=H(i),s=gf.exports,l=H(s),f=Vc.exports,d=H(f),y=yf.exports,b=H(y),T=nu,M=H(T),P=cc.exports,k=H(P);function H(ze){return ze&&ze.__esModule?ze:{default:ze}}function q(ze,it,ut){ut=(0,d.default)(ut);var ot=0,Ct=0,Xt=ze.length,Sr=!1;Xt===0&&ut(null);function _r(Wr,Cn){Wr===!1&&(Sr=!0),Sr!==!0&&(Wr?ut(Wr):(++Ct===Xt||Cn===a.default)&&ut(null))}for(;ot<Xt;ot++)it(ze[ot],ot,(0,b.default)(_r))}function ae(ze,it,ut){return(0,l.default)(ze,1/0,it,ut)}function Se(ze,it,ut){var ot=(0,n.default)(ze)?q:ae;return ot(ze,(0,M.default)(it),ut)}r.default=(0,k.default)(Se,3),e.exports=r.default})(hd,hd.exports),function(e,r){Object.defineProperty(r,"__esModule",{value:!0}),r.default=l;var t=hd.exports,n=s(t),i=Nl.exports,a=s(i);function s(f){return f&&f.__esModule?f:{default:f}}function l(f,d){return(0,a.default)(n.default,f,d)}e.exports=r.default}(qd,qd.exports);var w0=df(qd.exports),Kd=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return w0(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return uo(n,void 0,void 0,function(){return Fl(this,function(a){switch(a.label){case 0:return[4,t()];case 1:return a.sent(),i(null,r),[2]}})})})},e}(),lo={exports:{}};(function(e,r){Object.defineProperty(r,"__esModule",{value:!0});var t=Vc.exports,n=y(t),i=yf.exports,a=y(i),s=nu,l=y(s),f=cc.exports,d=y(f);function y(T){return T&&T.__esModule?T:{default:T}}function b(T,M){if(M=(0,n.default)(M),!Array.isArray(T))return M(new Error("First argument to waterfall must be an array of functions"));if(!T.length)return M();var P=0;function k(q){var ae=(0,l.default)(T[P++]);ae.apply(void 0,q.concat([(0,a.default)(H)]))}function H(q){for(var ae=[],Se=arguments.length-1;Se-- >0;)ae[Se]=arguments[Se+1];if(q!==!1){if(q||P===T.length)return M.apply(void 0,[q].concat(ae));k(ae)}}k([])}r.default=(0,d.default)(b),e.exports=r.default})(lo,lo.exports);var zl=df(lo.exports),Z_=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return zl(this.tasks)},e.prototype.tap=function(r,t){this.tasks.length===0?this.tasks.push(function(n){var i=t();n(i?null:!1,i)}):this.tasks.push(function(n,i){var a=t.apply(void 0,pf([],Cu(n),!1));i(a?null:!1,r)})},e}(),xf=function(){function e(){this.tasks=[]}return e.prototype.call=function(){return fd(this.tasks)},e.prototype.tap=function(r,t){this.tasks.push(function(n){var i=t();n(i,r)})},e}(),Yv=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,fd(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return uo(n,void 0,void 0,function(){return Fl(this,function(a){switch(a.label){case 0:return[4,t.apply(void 0,pf([],Cu(this.args),!1))];case 1:return a.sent(),i(null,r),[2]}})})})},e}(),hg=function(){function e(){this.args=[],this.tasks=[]}return e.prototype.promise=function(){for(var r=arguments,t=[],n=0;n<arguments.length;n++)t[n]=r[n];return this.args=t,fd(this.tasks)},e.prototype.tapPromise=function(r,t){var n=this;this.tasks.push(function(i){return uo(n,void 0,void 0,function(){var a;return Fl(this,function(s){switch(s.label){case 0:return[4,t.apply(void 0,pf([],Cu(this.args),!1))];case 1:return a=s.sent(),i(a,r),[2]}})})})},e}(),Qd=function(){function e(){this.tasks=[]}return e.prototype.promise=function(){return zl(this.tasks)},e.prototype.tapPromise=function(r,t){this.tasks.length===0?this.tasks.push(function(n){t().then(function(i){n(null,i)})}):this.tasks.push(function(n,i){t(n).then(function(a){i(null,a)})})},e}(),fc=U(31204),Jd=U.n(fc),Tp,pd,dd,ev,qv,wp,Kv,Qv,Jv,em,tm,Ru,vd,rm,hc,pg,nm,nh,jo,jh,Hh,Wh,im,am,om,sm,tv,rv,jc,um,nv,iv,lm,av,cm;function dg(e){var r=fm();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function fm(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vg=(Tp=(0,tr.b2)(),pd=(0,tr.f3)(Je.SceneID),dd=(0,tr.f3)(Je.IIconService),ev=(0,tr.f3)(Je.IFontService),qv=(0,tr.f3)(Je.IControlService),wp=(0,tr.f3)(Je.IGlobalConfigService),Kv=(0,tr.f3)(Je.IMapService),Qv=(0,tr.f3)(Je.ICoordinateSystemService),Jv=(0,tr.f3)(Je.IRendererService),em=(0,tr.f3)(Je.ILayerService),tm=(0,tr.f3)(Je.IDebugService),Ru=(0,tr.f3)(Je.ICameraService),vd=(0,tr.f3)(Je.IInteractionService),rm=(0,tr.f3)(Je.IPickingService),hc=(0,tr.f3)(Je.IShaderModuleService),pg=(0,tr.f3)(Je.IMarkerService),nm=(0,tr.f3)(Je.IPopupService),Tp(nh=(jo=function(e){(0,Le.Z)(t,e);var r=dg(t);function t(){var n;return(0,Q.Z)(this,t),n=r.call(this),(0,F.Z)((0,Re.Z)(n),"destroyed",!1),(0,F.Z)((0,Re.Z)(n),"loaded",!1),ki((0,Re.Z)(n),"id",jh,(0,Re.Z)(n)),ki((0,Re.Z)(n),"iconService",Hh,(0,Re.Z)(n)),ki((0,Re.Z)(n),"fontService",Wh,(0,Re.Z)(n)),ki((0,Re.Z)(n),"controlService",im,(0,Re.Z)(n)),ki((0,Re.Z)(n),"configService",am,(0,Re.Z)(n)),ki((0,Re.Z)(n),"map",om,(0,Re.Z)(n)),ki((0,Re.Z)(n),"coordinateSystemService",sm,(0,Re.Z)(n)),ki((0,Re.Z)(n),"rendererService",tv,(0,Re.Z)(n)),ki((0,Re.Z)(n),"layerService",rv,(0,Re.Z)(n)),ki((0,Re.Z)(n),"debugService",jc,(0,Re.Z)(n)),ki((0,Re.Z)(n),"cameraService",um,(0,Re.Z)(n)),ki((0,Re.Z)(n),"interactionService",nv,(0,Re.Z)(n)),ki((0,Re.Z)(n),"pickingService",iv,(0,Re.Z)(n)),ki((0,Re.Z)(n),"shaderModuleService",lm,(0,Re.Z)(n)),ki((0,Re.Z)(n),"markerService",av,(0,Re.Z)(n)),ki((0,Re.Z)(n),"popupService",cm,(0,Re.Z)(n)),(0,F.Z)((0,Re.Z)(n),"inited",!1),(0,F.Z)((0,Re.Z)(n),"initPromise",void 0),(0,F.Z)((0,Re.Z)(n),"rendering",!1),(0,F.Z)((0,Re.Z)(n),"$container",void 0),(0,F.Z)((0,Re.Z)(n),"canvas",void 0),(0,F.Z)((0,Re.Z)(n),"markerContainer",void 0),(0,F.Z)((0,Re.Z)(n),"hooks",void 0),(0,F.Z)((0,Re.Z)(n),"handleWindowResized",function(){n.emit("resize"),n.$container&&(n.initContainer(),Cl(),n.coordinateSystemService.needRefresh=!0,n.render())}),(0,F.Z)((0,Re.Z)(n),"handleMapCameraChanged",function(i){n.cameraService.update(i),n.render()}),n.hooks={init:new Yv},n}return(0,j.Z)(t,[{key:"init",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Zt.Z)(_e().mark(function s(){return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return a.debugService.log("map.mapInitStart",{type:a.map.version}),f.next=3,new Promise(function(d){a.map.onCameraChanged(function(y){a.cameraService.init(),a.cameraService.update(y),d()}),a.map.init()});case 3:a.map.onCameraChanged(a.handleMapCameraChanged),a.map.addMarkerContainer(),a.markerService.addMarkers(),a.markerService.addMarkerLayers(),a.popupService.initPopup(),a.interactionService.init(),a.interactionService.on(c.Drag,a.addSceneEvent.bind(a));case 10:case"end":return f.stop()}},s)}))),this.hooks.init.tapPromise("initRenderer",(0,Zt.Z)(_e().mark(function s(){var l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(f=((l=a.map)===null||l===void 0?void 0:l.getOverlayContainer())||void 0,f?a.$container=f:a.$container=de(a.configService.getSceneConfig(a.id).id||""),!a.$container){b.next=13;break}return a.canvas=$i("canvas","",a.$container),a.setCanvas(),b.next=7,a.rendererService.init(a.canvas,a.configService.getSceneConfig(a.id),i.gl);case 7:a.registerContextLost(),a.initContainer(),Jd()(a.$container,a.handleWindowResized),window.matchMedia&&((d=window.matchMedia("screen and (-webkit-min-device-pixel-ratio: 1.5)"))===null||d===void 0||d.addListener(a.handleWindowResized)),b.next=14;break;case 13:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 14:a.pickingService.init(a.id);case 15:case"end":return b.stop()}},s)}))),this.render()}},{key:"registerContextLost",value:function(){var i=this,a=this.rendererService.getCanvas();a&&a.addEventListener("webglcontextlost",function(){return i.emit("webglcontextlost")})}},{key:"initMiniScene",value:function(i){var a=this;this.configService.setSceneConfig(this.id,i),this.shaderModuleService.registerBuiltinModules(),this.iconService.init(),this.iconService.on("imageUpdate",function(){return a.render()}),this.fontService.init(),this.hooks.init.tapPromise("initMap",(0,Zt.Z)(_e().mark(function s(){return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,new Promise(function(d){a.map.onCameraChanged(function(y){a.cameraService.init(),a.cameraService.update(y),a.map.version!=="GAODE2.x"&&d()}),a.map.initMiniMap()});case 2:a.map.onCameraChanged(a.handleMapCameraChanged),a.interactionService.init(),a.interactionService.on(c.Drag,a.addSceneEvent.bind(a));case 5:case"end":return f.stop()}},s)}))),this.hooks.init.tapPromise("initRenderer",(0,Zt.Z)(_e().mark(function s(){var l;return _e().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(l=i.canvas,a.$container=l||null,!a.$container){d.next=7;break}return d.next=5,a.rendererService.init(i.canvas,a.configService.getSceneConfig(a.id),void 0);case 5:d.next=8;break;case 7:console.error("\u5BB9\u5668 id \u4E0D\u5B58\u5728");case 8:a.pickingService.init(a.id);case 9:case"end":return d.stop()}},s)}))),this.initPromise=this.hooks.init.promise(),this.render()}},{key:"addLayer",value:function(i){this.layerService.sceneService=this,this.layerService.add(i)}},{key:"addMask",value:function(i){this.layerService.sceneService=this,this.layerService.addMask(i)}},{key:"render",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.rendering||this.destroyed)){l.next=2;break}return l.abrupt("return");case 2:if(this.rendering=!0,this.inited){l.next=16;break}return l.next=6,this.hooks.init.promise();case 6:return this.destroyed&&this.destroy(),l.next=9,this.layerService.initLayers();case 9:this.layerService.renderLayers(),this.controlService.addControls(),this.loaded=!0,this.emit("loaded"),this.inited=!0,l.next=20;break;case 16:return l.next=18,this.layerService.initLayers();case 18:return l.next=20,this.layerService.renderLayers();case 20:this.rendering=!1;case 21:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addFontFace",value:function(i,a){this.fontService.addFontFace(i,a)}},{key:"getSceneContainer",value:function(){return this.$container}},{key:"exportPng",value:function(){var n=(0,Zt.Z)(_e().mark(function a(s){var l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return f=(l=this.$container)===null||l===void 0?void 0:l.getElementsByTagName("canvas")[0],b.next=3,this.render();case 3:return d=s==="jpg"?f==null?void 0:f.toDataURL("image/jpeg"):f==null?void 0:f.toDataURL("image/png"),b.abrupt("return",d);case 5:case"end":return b.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"getSceneConfig",value:function(){return this.configService.getSceneConfig(this.id)}},{key:"getPointSizeRange",value:function(){return this.rendererService.getPointSizeRange()}},{key:"addMarkerContainer",value:function(){var i=this.$container.parentElement;i!==null&&(this.markerContainer=$i("div","l7-marker-container",i))}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"destroy",value:function(){var i=this,a;if(!this.inited){this.destroyed=!0;return}if((0,fc.unbind)(this.$container,this.handleWindowResized),window.matchMedia){var s;(s=window.matchMedia("screen and (min-resolution: 2dppx)"))===null||s===void 0||s.removeListener(this.handleWindowResized)}this.pickingService.destroy(),this.layerService.destroy(),this.interactionService.destroy(),this.controlService.destroy(),this.markerService.destroy(),this.fontService.destroy(),this.iconService.destroy(),this.removeAllListeners(),this.inited=!1,this.map.destroy(),setTimeout(function(){var l;(l=i.$container)===null||l===void 0||l.removeChild(i.canvas),i.canvas=null,i.rendererService.destroy()}),(a=this.$container)===null||a===void 0||(a=a.parentNode)===null||a===void 0||a.removeChild(this.$container),this.emit("destroy")}},{key:"initContainer",value:function(){var i,a,s=sa,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,f=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,d=this.canvas;d&&(d.width=l*s,d.height=f*s),this.rendererService.viewport({x:0,y:0,width:s*l,height:s*f})}},{key:"setCanvas",value:function(){var i,a,s=sa,l=((i=this.$container)===null||i===void 0?void 0:i.clientWidth)||400,f=((a=this.$container)===null||a===void 0?void 0:a.clientHeight)||300,d=this.canvas;d.width=l*s,d.height=f*s,d.style.width="100%",d.style.height="100%"}},{key:"addSceneEvent",value:function(i){this.emit(i.type,i)}}]),t}(qa.EventEmitter),jh=Pi(jo.prototype,"id",[pd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Hh=Pi(jo.prototype,"iconService",[dd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Wh=Pi(jo.prototype,"fontService",[ev],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),im=Pi(jo.prototype,"controlService",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),am=Pi(jo.prototype,"configService",[wp],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),om=Pi(jo.prototype,"map",[Kv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),sm=Pi(jo.prototype,"coordinateSystemService",[Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),tv=Pi(jo.prototype,"rendererService",[Jv],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),rv=Pi(jo.prototype,"layerService",[em],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jc=Pi(jo.prototype,"debugService",[tm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),um=Pi(jo.prototype,"cameraService",[Ru],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),nv=Pi(jo.prototype,"interactionService",[vd],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),iv=Pi(jo.prototype,"pickingService",[rm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lm=Pi(jo.prototype,"shaderModuleService",[hc],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),av=Pi(jo.prototype,"markerService",[pg],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cm=Pi(jo.prototype,"popupService",[nm],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),jo))||nh);function md(e){var r=0;switch(e){case"vec2":case"ivec2":r=2;break;case"vec3":case"ivec3":r=3;break;case"vec4":case"ivec4":case"mat2":r=4;break;case"mat3":r=9;break;case"mat4":r=16;break;default:}return r}var hm=/uniform\s+(bool|float|int|vec2|vec3|vec4|ivec2|ivec3|ivec4|mat2|mat3|mat4|sampler2D|samplerCube)\s+([\s\S]*?);/g;function gd(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t={};return e=e.replace(hm,function(n,i,a){var s=a.split(":"),l=s[0].trim(),f="";switch(s.length>1&&(f=s[1].trim()),i){case"bool":f=f==="true";break;case"float":case"int":f=Number(f);break;case"vec2":case"vec3":case"vec4":case"ivec2":case"ivec3":case"ivec4":case"mat2":case"mat3":case"mat4":f?f=f.replace("[","").replace("]","").split(",").reduce(function(d,y){return d.push(Number(y.trim())),d},[]):f=new Array(md(i)).fill(0);break;default:}return t[l]=f,"".concat(r?"uniform ":"").concat(i," ").concat(l,`;
`)}),{content:e,uniforms:t}}function pm(e){var r=gd(e,!0),t=r.content,n=r.uniforms;return t=t.replace(/(\s*uniform\s*.*\s*){((?:\s*.*\s*)*?)};/g,function(i,a,s){s=s.trim().replace(/^.*$/gm,function(y){return"uniform ".concat(y)});var l=gd(s),f=l.content,d=l.uniforms;return Object.assign(n,d),"".concat(a,`{
`).concat(f,`
};`)}),{content:t,uniforms:n}}function dm(e){var r={};return e.replace(hm,function(t,n,i){var a=i.trim();return r[a]?"":(r[a]=!0,"uniform ".concat(n," ").concat(a,`;
`))})}var mg,gg,C0=ui.uniq,_g="#define PI 3.14159265359",R0=`#define SHIFT_RIGHT17 1.0 / 131072.0
#define SHIFT_RIGHT18 1.0 / 262144.0
#define SHIFT_RIGHT19 1.0 / 524288.0
#define SHIFT_RIGHT20 1.0 / 1048576.0
#define SHIFT_RIGHT21 1.0 / 2097152.0
#define SHIFT_RIGHT22 1.0 / 4194304.0
#define SHIFT_RIGHT23 1.0 / 8388608.0
#define SHIFT_RIGHT24 1.0 / 16777216.0

#define SHIFT_LEFT17 131072.0
#define SHIFT_LEFT18 262144.0
#define SHIFT_LEFT19 524288.0
#define SHIFT_LEFT20 1048576.0
#define SHIFT_LEFT21 2097152.0
#define SHIFT_LEFT22 4194304.0
#define SHIFT_LEFT23 8388608.0
#define SHIFT_LEFT24 16777216.0

vec2 unpack_float(float packedValue) {
  int packedIntValue = int(packedValue);
  int v0 = packedIntValue / 256;
  return vec2(v0, packedIntValue - v0 * 256);
}

vec4 decode_color(vec2 encodedColor) {
  return vec4(
    unpack_float(encodedColor[0]) / 255.0,
    unpack_float(encodedColor[1]) / 255.0
  );
}
`,yg=`layout(std140) uniform SceneUniforms {
  mat4 u_ViewMatrix;
  mat4 u_ProjectionMatrix;
  mat4 u_ViewProjectionMatrix;
  mat4 u_ModelMatrix;
  vec4 u_ViewportCenterProjection;
  vec3 u_PixelsPerDegree;
  float u_Zoom;
  vec3 u_PixelsPerDegree2;
  float u_ZoomScale;
  vec3 u_PixelsPerMeter;
  float u_CoordinateSystem;
  vec3 u_CameraPosition;
  float u_DevicePixelRatio;
  vec2 u_ViewportCenter;
  vec2 u_ViewportSize;
  float u_FocalDistance;
};

layout(std140) uniform LayerUniforms {
  mat4 u_Mvp;
  vec2 u_sceneCenterMercator;
};
`,xg=`layout(std140) uniform PickingUniforms {
  vec4 u_HighlightColor;
  vec4 u_SelectColor;
  vec3 u_PickingColor;
  float u_PickingStage;
  vec3 u_CurrentSelectedId;
  float u_PickingThreshold;
  float u_PickingBuffer;
  float u_shaderPick;
  float u_EnableSelect;
  float u_activeMix;
};`,M0=`#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


float calc_lighting(vec4 pos) {

    vec3 worldPos = vec3(pos * u_ModelMatrix);

    vec3 worldNormal = a_Normal;
      // //cal light weight
    vec3 viewDir = normalize(u_CameraPosition - worldPos);

    vec3 lightDir = normalize(vec3(1, -10.5, 12));

    vec3 halfDir = normalize(viewDir+lightDir);
      // //lambert
    float lambert = dot(worldNormal, lightDir);
        //specular
    float specular = pow(max(0.0, dot(worldNormal, halfDir)), 32.0);
        //sum to light weight
    float lightWeight = ambientRatio + diffuseRatio * lambert + specularRatio * specular;

    return lightWeight;
}
`,Hc=`// Blinn-Phong model
// apply lighting in vertex shader instead of fragment shader
// @see https://learnopengl.com/Advanced-Lighting/Advanced-Lighting
uniform float u_Ambient : 1.0;
uniform float u_Diffuse : 1.0;
uniform float u_Specular : 1.0;
uniform int u_NumOfDirectionalLights : 1;
uniform int u_NumOfSpotLights : 0;

#define SHININESS 32.0
#define MAX_NUM_OF_DIRECTIONAL_LIGHTS 3
#define MAX_NUM_OF_SPOT_LIGHTS 3

struct DirectionalLight {
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
};

struct SpotLight {
  vec3 position;
  vec3 direction;
  vec3 ambient;
  vec3 diffuse;
  vec3 specular;
  float constant;
  float linear;
  float quadratic;
  float angle;
  float blur;
  float exponent;
};

uniform DirectionalLight u_DirectionalLights[MAX_NUM_OF_DIRECTIONAL_LIGHTS];
uniform SpotLight u_SpotLights[MAX_NUM_OF_SPOT_LIGHTS];

vec3 calc_directional_light(DirectionalLight light, vec3 normal, vec3 viewDir) {
  vec3 lightDir = normalize(light.direction);
  // diffuse shading
  float diff = max(dot(normal, lightDir), 0.0);
  // Blinn-Phong specular shading
  vec3 halfwayDir = normalize(lightDir + viewDir);
  float spec = pow(max(dot(normal, halfwayDir), 0.0), SHININESS);

  vec3 ambient = light.ambient * u_Ambient;
  vec3 diffuse = light.diffuse * diff * u_Diffuse;
  vec3 specular = light.specular * spec * u_Specular;

  return ambient + diffuse + specular;
}


vec3 calc_lighting(vec3 position, vec3 normal, vec3 viewDir) {
  vec3 weight = vec3(0.0);
  for (int i = 0; i < MAX_NUM_OF_DIRECTIONAL_LIGHTS; i++) {
    if (i >= u_NumOfDirectionalLights) {
      break;
    }
    weight += calc_directional_light(u_DirectionalLights[i], normal, viewDir);
  }
  return weight;
}
`,ov=`
in vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define HIGHLIGHT 1.0
#define SELECT 2.0

/*
 * Returns highlight color if this item is selected.
 */
vec4 filterHighlightColor(vec4 color, float weight) {
  // float selected = v_PickingResult.a;
  bool selected = bool(v_PickingResult.a);

  // if (selected == SELECT) {
  if (selected) {
  //   // \u70B9\u51FB\u9009\u4E2D\u72B6\u6001
  //   vec4 selectColor = u_SelectColor * COLOR_SCALE;
  //   return selectColor;
  // } else if (selected == HIGHLIGHT) {
  //   // hover \u9AD8\u4EAE\u72B6\u6001
    vec4 highLightColor = u_HighlightColor * COLOR_SCALE;

    float highLightAlpha = highLightColor.a;
    float highLightRatio = highLightAlpha / (highLightAlpha + color.a * (1.0 - highLightAlpha));

    vec3 resultRGB = mix(color.rgb, highLightColor.rgb, highLightRatio);
    return vec4(mix(resultRGB * weight, color.rgb, u_activeMix), color.a);
  } else {
    return color;
  }
}

/*
 * Returns picking color if picking enabled else unmodified argument.
 */
vec4 filterPickingColor(vec4 color) {
  vec3 pickingColor = v_PickingResult.rgb;
  if (u_PickingStage == PICKING_ENCODE && length(pickingColor) < 0.001) {
    discard;
  }
  return u_PickingStage == PICKING_ENCODE ? vec4(pickingColor, step(0.001,color.a)): color;
}

/*
 * Returns picking color if picking is enabled if not
 * highlight color if this item is selected, otherwise unmodified argument.
 */
vec4 filterColor(vec4 color) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, 1.0));
  }
  
}

vec4 filterColorAlpha(vec4 color, float alpha) {
  // \u8FC7\u6EE4\u591A\u4F59\u7684 shader \u8BA1\u7B97
  // return color;
  if(u_shaderPick < 0.5) {
    return color; // \u6682\u65F6\u53BB\u9664 \u76F4\u63A5\u53D6\u6D88\u8BA1\u7B97\u5728\u9009\u4E2D\u65F6\u62D6\u62FD\u5730\u56FE\u4F1A\u6709\u95EE\u9898
  } else {
    return filterPickingColor(filterHighlightColor(color, alpha));
  }
}

`,bg=`layout(location = 3) in vec3 a_PickingColor;
out vec4 v_PickingResult;

#pragma include "picking_uniforms"

#define PICKING_NONE 0.0
#define PICKING_ENCODE 1.0
#define PICKING_HIGHLIGHT 2.0
#define COLOR_SCALE 1. / 255.

#define NORMAL 0.0
#define HIGHLIGHT 1.0
#define SELECT 2.0

bool isVertexPicked(vec3 vertexColor) {
  return distance(vertexColor,u_PickingColor.rgb) < 0.01;
}

// \u5224\u65AD\u5F53\u524D\u70B9\u662F\u5426\u5DF2\u7ECF\u88AB select \u9009\u4E2D
bool isVertexSelected(vec3 vertexColor) {
  return distance(vertexColor,u_CurrentSelectedId.rgb) < 0.01;
}

void setPickingColor(vec3 pickingColor) {
  if(u_shaderPick < 0.5) {
    return;
  }
  // compares only in highlight stage

  v_PickingResult.a = float((u_PickingStage == PICKING_HIGHLIGHT) && isVertexPicked(pickingColor));

  // Stores the picking color so that the fragment shader can render it during picking
  v_PickingResult.rgb = pickingColor * COLOR_SCALE;
}

float setPickingSize(float x) {
   return u_PickingStage == PICKING_ENCODE ? x + u_PickingBuffer : x;
}

float setPickingOrder(float z) {
   bool selected = bool(v_PickingResult.a);
   return selected ? z + 1. : 0.;
}
`,_d=`
#define E 2.718281828459045
vec2 ProjectFlat(vec2 lnglat){
  float maxs=85.0511287798;
  float lat=max(min(maxs,lnglat.y),-maxs);
  float scale= 268435456.;
  float d=PI/180.;
  float x=lnglat.x*d;
  float y=lat*d;
  y=log(tan((PI/4.)+(y/2.)));

  float a=.5/PI,
  b=.5,
  c=-.5/PI;
  d=.5;
  x=scale*(a*x+b);
  y=scale*(c*y+d);
  return vec2(x,y);
}

vec2 unProjectFlat(vec2 px){
  float a=.5/PI;
  float b=.5;
  float c=-.5/PI;
  float d=.5;
  float scale = 268435456.;
  float x=(px.x/scale-b)/a;
  float y=(px.y/scale-d)/c;
  y=(atan(pow(E,y))-(PI/4.))*2.;
  d=PI/180.;
  float lat=y/d;
  float lng=x/d;
  return vec2(lng,lat);
}

float pixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}

// gaode2.0
vec2 customProject(vec2 lnglat) { // \u7ECF\u7EAC\u5EA6 => \u5E73\u9762\u5750\u6807
  float t = lnglat.x;
  float e = lnglat.y;
  float Sm = 180.0 / PI;
  float Tm = 6378137.0;
  float Rm = PI / 180.0;
  float r = 85.0511287798;
  e = max(min(r, e), -r);
  t *= Rm;
  e *= Rm;
  e = log(tan(PI / 4.0 + e / 2.0));
  return vec2(t * Tm, e * Tm);
}

vec2 unProjCustomCoord(vec2 point) { // \u5E73\u9762\u5750\u6807 => \u7ECF\u7EAC\u5EA6
  float Sm = 57.29577951308232; //180 / Math.PI
  float Tm = 6378137.0;
  float t = point.x;
  float e = point.y;
  return vec2(t / Tm * Sm, (2.0 * atan(exp(e / Tm)) - PI / 2.0) * Sm);
}


float customPixelDistance(vec2 from, vec2 to) {
 vec2 a1 = ProjectFlat(from);
 vec2 b1 = ProjectFlat(to);
 return distance(a1, b1);
}`,vm=`#define TILE_SIZE 512.0
#define PI 3.1415926536
#define WORLD_SCALE TILE_SIZE / (PI * 2.0)
#define EARTH_CIRCUMFERENCE 40.03e6

#define COORDINATE_SYSTEM_LNGLAT 1.0        // mapbox
#define COORDINATE_SYSTEM_LNGLAT_OFFSET 2.0 // mapbox offset
#define COORDINATE_SYSTEM_VECTOR_TILE 3.0
#define COORDINATE_SYSTEM_IDENTITY 4.0
#define COORDINATE_SYSTEM_P20 5.0           // amap
#define COORDINATE_SYSTEM_P20_OFFSET 6.0    // amap offset
#define COORDINATE_SYSTEM_METER_OFFSET 7.0

#define COORDINATE_SYSTEM_P20_2 8.0         // amap2.0
#pragma include "scene_uniforms"


// web mercator coords -> world coords
vec2 project_mercator(vec2 lnglat) {
   if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return lnglat;
  }
  float x = lnglat.x;
  return vec2(
    radians(x) + PI,
    PI - log(tan(PI * 0.25 + radians(lnglat.y) * 0.5))
  );
}

float project_scale(float meters) {
  return meters * u_PixelsPerMeter.z;
}


// offset coords -> world coords
vec4 project_offset(vec4 offset) {
  float dy = offset.y;
  dy = clamp(dy, -1., 1.);
  vec3 pixels_per_unit = u_PixelsPerDegree + u_PixelsPerDegree2 * dy;
  return vec4(offset.xyz * pixels_per_unit, offset.w);
}

vec3 project_normal(vec3 normal) {
  vec4 normal_modelspace = u_ModelMatrix * vec4(normal, 0.0);
  return normalize(normal_modelspace.xyz * u_PixelsPerMeter);
}

vec3 project_offset_normal(vec3 vector) {
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01
    || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // normals generated by the polygon tesselator are in lnglat offsets instead of meters
    return normalize(vector * u_PixelsPerDegree);
  }
  return project_normal(vector);
}
// || u_CoordinateSystem < COORDINATE_SYSTEM_P20_OFFSET + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_P20_OFFSET - 0.01
// reverse Y
vec3 reverse_offset_normal(vec3 vector) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 ||u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET ) {
    return vector * vec3(1.0, -1.0, 1.0);
  }

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.0
    return vector;
  }
  return vector;
}

vec4 project_mvt_offset_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return project_offset(vec4(0.0, 0.0, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  return position;
}

vec4 project_position(vec4 position) {
  float a = COORDINATE_SYSTEM_LNGLAT_OFFSET;
  float b = COORDINATE_SYSTEM_P20_OFFSET;
  float c = COORDINATE_SYSTEM_LNGLAT;
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET
    || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    float X = position.x - u_ViewportCenter.x;
    float Y = position.y - u_ViewportCenter.y;
    return project_offset(vec4(X, Y, position.z, position.w));
  }
  if (u_CoordinateSystem < COORDINATE_SYSTEM_LNGLAT + 0.01 && u_CoordinateSystem >COORDINATE_SYSTEM_LNGLAT - 0.01) {
    return vec4(
      project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale,
      project_scale(position.z),
      position.w
    );
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return vec4(
      (project_mercator(position.xy) * WORLD_SCALE * u_ZoomScale - vec2(215440491., 106744817.)) * vec2(1., -1.),
      project_scale(position.z),
      position.w
    );
  }

  // if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
 

  //    return vec4(
  //     position.xy,
  //     project_scale(position.z),
  //     position.w);
  // }
  return position;

  // TODO: \u74E6\u7247\u5750\u6807\u7CFB & \u5E38\u89C4\u4E16\u754C\u5750\u6807\u7CFB
}
vec2 project_pixel_size_to_clipspace(vec2 pixels) {
  vec2 offset = pixels / u_ViewportSize * u_DevicePixelRatio * 2.0;
  return offset * u_FocalDistance;
}



float project_pixel_allmap(float pixel) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT) {
    return pixel * pow(2.0, u_Zoom);
  }
  return pixel * u_FocalDistance ;
}

// \u9002\u914D\u7EB9\u7406\u8D34\u56FE\u7684\u7B49\u50CF\u7D20\u5927\u5C0F
float project_pixel_texture(float pixel) {
  // mapbox zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    return pixel * pow(0.5, u_Zoom) * u_FocalDistance ;
  }

  // amap2 zoom > 12
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }

  // amap zoom > 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    return pixel * pow(0.5, u_Zoom)* u_FocalDistance ;
  }

  // amap zoom < 12
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20) {
    return pixel * pow(2.0, (20.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * 2.0 *  u_FocalDistance;;
}

// \u5728\u4E0D\u8BBA\u4EC0\u4E48\u5E95\u56FE\u4E0B\u9700\u8981\u7EDF\u4E00\u5904\u7406\u7684\u65F6\u5019\u4F7F\u7528
float project_float_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // mapbox P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom))  * u_FocalDistance ;
  }
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom));
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))* u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}

// Project meter into the unit of pixel which used in the camera world space
float project_float_meter(float meter) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Since the zoom level uniform is updated by mapservice and it's alread been subtracted by 1
    // Not sure if we are supposed to do that again
   return meter;
  } else  {
    return project_float_pixel(meter);
  }

  // TODO: change the following code to make adaptations for amap
  return u_FocalDistance * TILE_SIZE * pow(2.0, u_Zoom) * meter / EARTH_CIRCUMFERENCE;
}

float project_pixel(float pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // amap P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // amap2 P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * u_FocalDistance;
}
vec2 project_pixel(vec2 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) * u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom)) * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}
vec3 project_pixel(vec3 pixel) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
    // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
    return pixel * pow(2.0, (19.0 - u_Zoom)) *  u_FocalDistance ;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return pixel * pow(2.0, (19.0 - 3.0 - u_Zoom))  * u_FocalDistance ;
  }
  return pixel * -1. * u_FocalDistance;
}

vec4 project_common_position_to_clipspace(vec4 position, mat4 viewProjectionMatrix, vec4 center) {
  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
    position.w *= u_PixelsPerMeter.z;
  }

  return viewProjectionMatrix * position + center;
}

// Projects from common space coordinates to clip space
vec4 project_common_position_to_clipspace(vec4 position) {
  return project_common_position_to_clipspace(
    position,
    u_ViewProjectionMatrix,
    u_ViewportCenterProjection
  );
}

vec4 unproject_clipspace_to_position(vec4 clipspacePos, mat4 u_InverseViewProjectionMatrix) {
  vec4 pos = u_InverseViewProjectionMatrix * (clipspacePos - u_ViewportCenterProjection);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_METER_OFFSET ||
    u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    // Needs to be divided with project_uCommonUnitsPerMeter
     pos.w = pos.w / u_PixelsPerMeter.z;
  }
  return pos;
}


bool isEqual( float a,  float b) {
    return  a< b + 0.001 && a > b - 0.001;
}

// \u652F\u6301 GaodeV2\u3001Mapbox
vec4 project_common_position_to_clipspace_v2(vec4 position) {
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    return u_Mvp * position;
  } else {
    return project_common_position_to_clipspace(position);
  }
}
`,n2=`vec2 rotate_matrix(vec2 v, float a) {
    float b = a / 180.0 * 3.1415926535897932384626433832795;
    float s = sin(b);
    float c = cos(b);
    mat2 m = mat2(c, s, -s, c);
    return m * v;
}`,i2=`/**
 * 2D signed distance field functions
 * @see http://www.iquilezles.org/www/articles/distfunctions2d/distfunctions2d.htm
 */

float ndot(vec2 a, vec2 b ) { return a.x*b.x - a.y*b.y; }

float sdCircle(vec2 p, float r) {
  return length(p) - r;
}

float sdEquilateralTriangle(vec2 p) {
  float k = sqrt(3.0);
  p.x = abs(p.x) - 1.0;
  p.y = p.y + 1.0/k;
  if( p.x + k*p.y > 0.0 ) p = vec2(p.x-k*p.y,-k*p.x-p.y)/2.0;
  p.x -= clamp( p.x, -2.0, 0.0 );
  return -length(p)*sign(p.y);
}

float sdBox(vec2 p, vec2 b) {
  vec2 d = abs(p)-b;
  return length(max(d,vec2(0))) + min(max(d.x,d.y),0.0);
}

float sdPentagon(vec2 p, float r) {
  vec3 k = vec3(0.809016994,0.587785252,0.726542528);
  p.x = abs(p.x);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= vec2(clamp(p.x,-r*k.z,r*k.z),r);
  return length(p)*sign(p.y);
}

float sdHexagon(vec2 p, float r) {
  vec3 k = vec3(-0.866025404,0.5,0.577350269);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdOctogon(vec2 p, float r) {
  vec3 k = vec3(-0.9238795325, 0.3826834323, 0.4142135623 );
  p = abs(p);
  p -= 2.0*min(dot(vec2( k.x,k.y),p),0.0)*vec2( k.x,k.y);
  p -= 2.0*min(dot(vec2(-k.x,k.y),p),0.0)*vec2(-k.x,k.y);
  p -= vec2(clamp(p.x, -k.z*r, k.z*r), r);
  return length(p)*sign(p.y);
}

float sdHexagram(vec2 p, float r) {
  vec4 k=vec4(-0.5,0.8660254038,0.5773502692,1.7320508076);
  p = abs(p);
  p -= 2.0*min(dot(k.xy,p),0.0)*k.xy;
  p -= 2.0*min(dot(k.yx,p),0.0)*k.yx;
  p -= vec2(clamp(p.x,r*k.z,r*k.w),r);
  return length(p)*sign(p.y);
}

float sdRhombus(vec2 p, vec2 b) {
  vec2 q = abs(p);
  float h = clamp((-2.0*ndot(q,b)+ndot(b,b))/dot(b,b),-1.0,1.0);
  float d = length( q - 0.5*b*vec2(1.0-h,1.0+h) );
  return d * sign( q.x*b.y + q.y*b.x - b.x*b.y );
}

float sdVesica(vec2 p, float r, float d) {
  p = abs(p);
  float b = sqrt(r*r-d*d); // can delay this sqrt
  return ((p.y-b)*d>p.x*b)
          ? length(p-vec2(0.0,b))
          : length(p-vec2(-d,0.0))-r;
}
`,V_=/precision\s+(high|low|medium)p\s+float/,j_=`#ifdef GL_FRAGMENT_PRECISION_HIGH
 precision highp float;
 #else
 precision mediump float;
#endif
`,a2=/#pragma include (["^+"]?["[a-zA-Z_0-9](.*)"]*?)/g,o2=/void\s+main\s*\([^)]*\)\s*\{\n?/,OB=/}\n?[^{}]*$/,s2=(mg=(0,tr.b2)(),mg(gg=function(){function e(){(0,Q.Z)(this,e),(0,F.Z)(this,"moduleCache",{}),(0,F.Z)(this,"rawContentCache",{})}return(0,j.Z)(e,[{key:"registerBuiltinModules",value:function(){this.destroy(),this.registerModule("common",{vs:_g,fs:_g}),this.registerModule("decode",{vs:R0,fs:""}),this.registerModule("scene_uniforms",{vs:yg,fs:yg}),this.registerModule("picking_uniforms",{vs:xg,fs:xg}),this.registerModule("projection",{vs:vm,fs:vm}),this.registerModule("project",{vs:_d,fs:""}),this.registerModule("sdf_2d",{vs:"",fs:i2}),this.registerModule("lighting",{vs:Hc,fs:""}),this.registerModule("light",{vs:M0,fs:""}),this.registerModule("picking",{vs:bg,fs:ov}),this.registerModule("rotation_2d",{vs:n2,fs:""})}},{key:"registerModule",value:function(t,n){n.vs=n.vs.replace(/\r\n/g,`
`),n.fs=n.fs.replace(/\r\n/g,`
`);var i=n.vs,a=n.fs,s=n.uniforms,l=n.inject,f=pm(i),d=f.content,y=f.uniforms,b=pm(a),T=b.content,M=b.uniforms;this.rawContentCache[t]={fs:T,inject:l,uniforms:(0,W.Z)((0,W.Z)((0,W.Z)({},y),M),s),vs:d}}},{key:"destroy",value:function(){this.moduleCache={},this.rawContentCache={}}},{key:"getModule",value:function(t){var n=this,i=this.rawContentCache[t].vs,a=this.rawContentCache[t].fs,s=this.rawContentCache[t].inject,l={};s!=null&&s["vs:#decl"]&&(i=(s==null?void 0:s["vs:#decl"])+i,l=pm(s==null?void 0:s["vs:#decl"]).uniforms),s!=null&&s["vs:#main-start"]&&(i=i.replace(o2,function(q){return q+(s==null?void 0:s["vs:#main-start"])})),s!=null&&s["fs:#decl"]&&(a=(s==null?void 0:s["fs:#decl"])+a);var f=this.processModule(i,[],"vs"),d=f.content,y=f.includeList,b=this.processModule(a,[],"fs"),T=b.content,M=b.includeList,P="",k=C0(y.concat(M).concat(t)).reduce(function(q,ae){return(0,W.Z)((0,W.Z)({},q),n.rawContentCache[ae].uniforms)},(0,W.Z)({},l));V_.test(T)||(P=P+j_),P=P+T;var H="";return V_.test(d)||(H=H+j_),H=H+d,this.moduleCache[t]={fs:P.trim(),uniforms:k,vs:H.trim()},this.moduleCache[t]}},{key:"processModule",value:function(t,n,i){var a=this,s=t.replace(a2,function(l,f){var d=f.split(" "),y=d[0].replace(/"/g,"");if(n.indexOf(y)>-1)return"";var b=a.rawContentCache[y][i];n.push(y);var T=a.processModule(b,n,i),M=T.content;return M});return{content:s,includeList:n}}},{key:"injectDefines",value:function(t){var n=Object.keys(t).reduce(function(i,a){return i+"#define ".concat(a.toUpperCase()," ").concat(t[a],`;
`)},`
`);return n}}]),e}())||gg);function u2(e,r){for(;!Object.prototype.hasOwnProperty.call(e,r)&&(e=(0,Ee.Z)(e),e!==null););return e}function Ra(){return typeof Reflect!="undefined"&&Reflect.get?Ra=Reflect.get.bind():Ra=function(r,t,n){var i=u2(r,t);if(i){var a=Object.getOwnPropertyDescriptor(i,t);return a.get?a.get.call(arguments.length<3?r:n):a.value}},Ra.apply(this,arguments)}var sv=function(e){return e.Normal="normal",e.PostProcessing="post-processing",e}({}),H_,W_,Eg=(H_=(0,tr.b2)(),H_(W_=function(){function e(){(0,Q.Z)(this,e),(0,F.Z)(this,"shaderModuleService",void 0),(0,F.Z)(this,"rendererService",void 0),(0,F.Z)(this,"cameraService",void 0),(0,F.Z)(this,"mapService",void 0),(0,F.Z)(this,"interactionService",void 0),(0,F.Z)(this,"layerService",void 0),(0,F.Z)(this,"config",void 0)}return(0,j.Z)(e,[{key:"getName",value:function(){return""}},{key:"getType",value:function(){return sv.Normal}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Je.IRendererService),this.cameraService=t.getContainer().get(Je.ICameraService),this.mapService=t.getContainer().get(Je.IMapService),this.interactionService=t.getContainer().get(Je.IInteractionService),this.layerService=t.getContainer().get(Je.ILayerService),this.shaderModuleService=t.getContainer().get(Je.IShaderModuleService)}},{key:"render",value:function(t){}}]),e}())||W_),G_,X_;function l2(e){var r=c2();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function c2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f2=(G_=(0,tr.b2)(),G_(X_=function(e){(0,Le.Z)(t,e);var r=l2(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getName",value:function(){return"clear"}},{key:"init",value:function(i,a){Ra((0,Ee.Z)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(){this.rendererService.clear({color:[0,0,0,0],depth:1,framebuffer:null})}}]),t}(Eg))||X_),$_,Y_,q_,I0,K_;function h2(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=p2(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function p2(e,r){if(e){if(typeof e=="string")return Q_(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Q_(e,r)}}function Q_(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var d2=($_=(0,tr.b2)(),Y_=(0,tr.f3)(Je.IPostProcessor),$_(q_=(I0=function(){function e(){(0,Q.Z)(this,e),(0,F.Z)(this,"passes",[]),ki(this,"postProcessor",K_,this),(0,F.Z)(this,"layer",void 0),(0,F.Z)(this,"renderFlag",void 0),(0,F.Z)(this,"width",0),(0,F.Z)(this,"height",0)}return(0,j.Z)(e,[{key:"setLayer",value:function(t){this.layer=t}},{key:"setRenderFlag",value:function(t){this.renderFlag=t}},{key:"getRenderFlag",value:function(){return this.renderFlag}},{key:"getPostProcessor",value:function(){return this.postProcessor}},{key:"render",value:function(){var r=(0,Zt.Z)(_e().mark(function n(){var i,a,s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:i=h2(this.passes),f.prev=1,i.s();case 3:if((a=i.n()).done){f.next=9;break}return s=a.value,f.next=7,s.render(this.layer);case 7:f.next=3;break;case 9:f.next=14;break;case 11:f.prev=11,f.t0=f.catch(1),i.e(f.t0);case 14:return f.prev=14,i.f(),f.finish(14);case 17:return f.next=19,this.postProcessor.render(this.layer);case 19:case"end":return f.stop()}},n,this,[[1,11,14,17]])}));function t(){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){(this.width!==t||this.height!==n)&&(this.postProcessor.resize(t,n),this.width=t,this.height=n)}},{key:"add",value:function(t,n){t.getType()===sv.PostProcessing?this.postProcessor.add(t,this.layer,n):(t.init(this.layer,n),this.passes.push(t))}},{key:"insert",value:function(t,n,i){t.init(this.layer,n),this.passes.splice(i,0,t)}},{key:"destroy",value:function(){this.passes.length=0}}]),e}(),K_=Pi(I0.prototype,"postProcessor",[Y_],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),I0))||q_),J_,ey;function v2(e){var r=m2();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function m2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g2=(J_=(0,tr.b2)(),J_(ey=function(e){(0,Le.Z)(t,e);var r=v2(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"pickingFBO",void 0),(0,F.Z)((0,Re.Z)(n),"layer",void 0),(0,F.Z)((0,Re.Z)(n),"width",0),(0,F.Z)((0,Re.Z)(n),"height",0),(0,F.Z)((0,Re.Z)(n),"alreadyInRendering",!1),(0,F.Z)((0,Re.Z)(n),"pickFromPickingFBO",function(l){var f=l.x,d=l.y,y=l.lngLat,b=l.type;if(!(!n.layer.isVisible()||!n.layer.needPick(b))){var T=n.rendererService,M=T.getViewportSize,P=T.readPixels,k=T.useFramebuffer,H=M(),q=H.width,ae=H.height,Se=n.layer.getLayerConfig(),ze=Se.enableHighlight,it=Se.enableSelect,ut=f*sa,ot=d*sa;if(!(ut>q||ut<0||ot>ae||ot<0)){var Ct;k(n.pickingFBO,function(){var Xt;if(Ct=P({x:Math.round(ut),y:Math.round(ae-(d+1)*sa),width:1,height:1,data:new Uint8Array(1*1*4),framebuffer:n.pickingFBO}),Ct[0]!==0||Ct[1]!==0||Ct[2]!==0){var Sr=ka(Ct),_r=n.layer.getSource().getFeatureById(Sr),Wr={x:f,y:d,type:b,lngLat:y,featureId:Sr,feature:_r};_r&&(n.layer.setCurrentPickId(Sr),n.triggerHoverOnLayer(Wr))}else{var Cn={x:f,y:d,lngLat:y,type:n.layer.getCurrentPickId()===null?"un"+b:"mouseout",featureId:null,feature:null};n.triggerHoverOnLayer((0,W.Z)((0,W.Z)({},Cn),{},{type:"unpick"})),n.triggerHoverOnLayer(Cn),n.layer.setCurrentPickId(null)}ze&&n.highlightPickedFeature(Ct),it&&b==="click"&&((Xt=Ct)===null||Xt===void 0?void 0:Xt.toString())!==[0,0,0,0].toString()&&n.selectFeature(Ct)})}}}),n}return(0,j.Z)(t,[{key:"getType",value:function(){return sv.Normal}},{key:"getName",value:function(){return"pixelPicking"}},{key:"init",value:function(i,a){Ra((0,Ee.Z)(t.prototype),"init",this).call(this,i,a),this.layer=i;var s=this.rendererService,l=s.createTexture2D,f=s.createFramebuffer,d=s.getViewportSize,y=d(),b=y.width,T=y.height;this.pickingFBO=f({color:l({width:b,height:T,wrapS:I.CLAMP_TO_EDGE,wrapT:I.CLAMP_TO_EDGE})}),this.interactionService.on(c.Hover,this.pickFromPickingFBO),this.interactionService.on(c.Select,this.selectFeatureHandle.bind(this)),this.interactionService.on(c.Active,this.highlightFeatureHandle.bind(this))}},{key:"render",value:function(i){var a=this;if(!this.alreadyInRendering){var s=this.rendererService,l=s.getViewportSize,f=s.useFramebuffer,d=s.clear,y=l(),b=y.width,T=y.height;this.alreadyInRendering=!0,(this.width!==b||this.height!==T)&&(this.pickingFBO.resize({width:b,height:T}),this.width=b,this.height=T),f(this.pickingFBO,function(){d({framebuffer:a.pickingFBO,color:[0,0,0,0],stencil:0,depth:1});var M=a.layer.multiPassRenderer.getRenderFlag();a.layer.multiPassRenderer.setRenderFlag(!1),i.hooks.beforePickingEncode.call(),i.render(),i.hooks.afterPickingEncode.call(),a.layer.multiPassRenderer.setRenderFlag(M),a.alreadyInRendering=!1})}}},{key:"triggerHoverOnLayer",value:function(i){this.layer.emit(i.type,i)}},{key:"highlightPickedFeature",value:function(i){var a=(0,yn.Z)(i,3),s=a[0],l=a[1],f=a[2];this.layer.hooks.beforeHighlight.call([s,l,f]),this.layerService.renderLayers()}},{key:"selectFeature",value:function(i){var a=(0,yn.Z)(i,3),s=a[0],l=a[1],f=a[2];this.layer.hooks.beforeSelect.call([s,l,f]),this.layerService.renderLayers()}},{key:"selectFeatureHandle",value:function(i){var a=i.featureId,s=na(a);this.selectFeature(new Uint8Array(s))}},{key:"highlightFeatureHandle",value:function(i){var a=i.featureId,s=na(a);this.highlightPickedFeature(new Uint8Array(s))}}]),t}(Eg))||ey),ty,ry,ny,P0,iy,_2=ui.camelCase,y2=ui.isNil,x2=ui.upperFirst,b2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,Gh=(ty=(0,tr.b2)(),ry=(0,tr.f3)(Je.IShaderModuleService),ty(ny=(P0=function(){function e(){(0,Q.Z)(this,e),ki(this,"shaderModuleService",iy,this),(0,F.Z)(this,"rendererService",void 0),(0,F.Z)(this,"config",void 0),(0,F.Z)(this,"quad",b2),(0,F.Z)(this,"enabled",!0),(0,F.Z)(this,"renderToScreen",!1),(0,F.Z)(this,"model",void 0),(0,F.Z)(this,"name",void 0),(0,F.Z)(this,"optionsToUpdate",{})}return(0,j.Z)(e,[{key:"getName",value:function(){return this.name}},{key:"setName",value:function(t){this.name=t}},{key:"getType",value:function(){return sv.PostProcessing}},{key:"init",value:function(t,n){this.config=n,this.rendererService=t.getContainer().get(Je.IRendererService),this.shaderModuleService=t.getContainer().get(Je.IShaderModuleService);var i=this.rendererService,a=i.createAttribute,s=i.createBuffer,l=i.createModel,f=this.setupShaders(),d=f.vs,y=f.fs,b=f.uniforms;this.model=l({vs:d,fs:y,attributes:{a_Position:a({buffer:s({data:[-4,-4,4,-4,0,4],type:I.FLOAT}),size:2})},uniforms:(0,W.Z)((0,W.Z)({u_Texture:null},b),this.config&&this.convertOptionsToUniforms(this.config)),depth:{enable:!1},count:3,blend:{enable:this.getName()==="copy"}})}},{key:"render",value:function(t,n){var i=this,a=t.multiPassRenderer.getPostProcessor(),s=this.rendererService,l=s.useFramebuffer,f=s.getViewportSize,d=s.clear,y=f(),b=y.width,T=y.height;l(this.renderToScreen?null:a.getWriteFBO(),function(){d({framebuffer:a.getWriteFBO(),color:[0,0,0,0],depth:1,stencil:0});var M=(0,W.Z)({u_BloomFinal:0,u_Texture:a.getReadFBO(),u_ViewportSize:[b,T]},i.convertOptionsToUniforms(i.optionsToUpdate));n&&(M.u_BloomFinal=1,M.u_Texture2=n),i.model.draw({uniforms:M})})}},{key:"isEnabled",value:function(){return this.enabled}},{key:"setEnabled",value:function(t){this.enabled=t}},{key:"setRenderToScreen",value:function(t){this.renderToScreen=t}},{key:"updateOptions",value:function(t){this.optionsToUpdate=(0,W.Z)((0,W.Z)({},this.optionsToUpdate),t)}},{key:"setupShaders",value:function(){throw new Error("Method not implemented.")}},{key:"convertOptionsToUniforms",value:function(t){var n={};return Object.keys(t).forEach(function(i){y2(t[i])||(n["u_".concat(x2(_2(i)))]=t[i])}),n}}]),e}(),iy=Pi(P0.prototype,"shaderModuleService",[ry],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),P0))||ny),ay,oy;function E2(e){var r=S2();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function S2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A2=`varying vec2 v_UV;

uniform float u_BloomFinal: 0.0;
uniform sampler2D u_Texture;
uniform sampler2D u_Texture2;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_radius: 5.0;
uniform float u_intensity: 0.3;
uniform float u_baseRadio: 0.5;

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

float luminance(vec4 color) {
  return  0.2125 * color.r + 0.7154 * color.g + 0.0721 * color.b;
}

void main() {
  // vec4 baseColor = texture2D(u_Texture, v_UV);

  float r = sqrt(u_radius);

  vec4 c1 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(u_radius, 0.0));
  // c1 *= luminance(c1);
  vec4 c2 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(0.0, u_radius));
  // c2 *= luminance(c2);
  vec4 c3 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, r));
  // c3 *= luminance(c3);
  vec4 c4 = blur9(u_Texture, v_UV, u_ViewportSize, vec2(r, -r));
  // c4 *= luminance(c4);
  vec4 inbloomColor = (c1 + c2 + c3 + c4) * 0.25;

  // float lum = luminance(inbloomColor);
  // inbloomColor.rgb *= lum;

  if(u_BloomFinal > 0.0) {
    vec4 baseColor = texture2D(u_Texture2, v_UV);
    float baselum = luminance(baseColor);
    gl_FragColor = mix(inbloomColor, baseColor, u_baseRadio);
    if(baselum <= 0.2) {
      gl_FragColor = inbloomColor * u_intensity;
    }
  } else {
    gl_FragColor = inbloomColor;
  }
}`,T2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,O0=ui.isNil,w2=(ay=(0,tr.b2)(),ay(oy=function(e){(0,Le.Z)(t,e);var r=E2(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:T2,fs:A2});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,y=f.height;return{vs:a,fs:s,uniforms:(0,W.Z)((0,W.Z)({},l),{},{u_ViewportSize:[d,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return O0(i.bloomRadius)||(a.u_radius=i.bloomRadius),O0(i.bloomIntensity)||(a.u_intensity=i.bloomIntensity),O0(i.bloomBaseRadio)||(a.u_baseRadio=i.bloomBaseRadio),a}}]),t}(Gh))||oy),sy,uy;function C2(e){var r=R2();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function R2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var M2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,I2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,P2=ui.isNil,O2=(sy=(0,tr.b2)(),sy(uy=function(e){(0,Le.Z)(t,e);var r=C2(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:I2,fs:M2});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,y=f.height;return{vs:a,fs:s,uniforms:(0,W.Z)((0,W.Z)({},l),{},{u_ViewportSize:[d,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return P2(i.blurRadius)||(a.u_BlurDir=[i.blurRadius,0]),a}}]),t}(Gh))||uy),ly,cy;function k2(e){var r=D2();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function D2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var L2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_BlurDir: [1.0, 0.0];

// https://github.com/Jam3/glsl-fast-gaussian-blur/blob/master/9.glsl
vec4 blur9(sampler2D image, vec2 uv, vec2 resolution, vec2 direction) {
  vec4 color = vec4(0.0);
  vec2 off1 = vec2(1.3846153846) * direction;
  vec2 off2 = vec2(3.2307692308) * direction;
  color += texture2D(image, uv) * 0.2270270270;
  color += texture2D(image, uv + (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv - (off1 / resolution)) * 0.3162162162;
  color += texture2D(image, uv + (off2 / resolution)) * 0.0702702703;
  color += texture2D(image, uv - (off2 / resolution)) * 0.0702702703;
  return color;
}

void main() {
  gl_FragColor = blur9(u_Texture, v_UV, u_ViewportSize, u_BlurDir);
}`,B2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,F2=ui.isNil,N2=(ly=(0,tr.b2)(),ly(cy=function(e){(0,Le.Z)(t,e);var r=k2(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("blur-pass",{vs:B2,fs:L2});var i=this.shaderModuleService.getModule("blur-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,y=f.height;return{vs:a,fs:s,uniforms:(0,W.Z)((0,W.Z)({},l),{},{u_ViewportSize:[d,y]})}}},{key:"convertOptionsToUniforms",value:function(i){var a={};return F2(i.blurRadius)||(a.u_BlurDir=[0,i.blurRadius]),a}}]),t}(Gh))||cy),fy,hy;function U2(e){var r=z2();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function z2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Z2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Angle : 0;
uniform float u_Size : 8;

#pragma include "common"

float scale = PI / u_Size;

float pattern(float u_Angle, vec2 texSize, vec2 texCoord) {
  float s = sin(u_Angle), c = cos(u_Angle);
  vec2 tex = texCoord * texSize - u_Center * texSize;
  vec2 point = vec2(
    c * tex.x - s * tex.y,
    s * tex.x + c * tex.y
  ) * scale;
  return (sin(point.x) * sin(point.y)) * 4.0;
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/colorhalftone.js
vec4 colorHalftone_filterColor(vec4 color, vec2 texSize, vec2 texCoord) {
  vec3 cmy = 1.0 - color.rgb;
  float k = min(cmy.x, min(cmy.y, cmy.z));
  cmy = (cmy - k) / (1.0 - k);
  cmy = clamp(
    cmy * 10.0 - 3.0 + vec3(
      pattern(u_Angle + 0.26179, texSize, texCoord),
      pattern(u_Angle + 1.30899, texSize, texCoord),
      pattern(u_Angle, texSize, texCoord)
    ),
    0.0,
    1.0
  );
  k = clamp(k * 10.0 - 5.0 + pattern(u_Angle + 0.78539, texSize, texCoord), 0.0, 1.0);
  return vec4(1.0 - cmy - k, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = colorHalftone_filterColor(gl_FragColor, u_ViewportSize, v_UV);
}`,V2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,j2=(fy=(0,tr.b2)(),fy(hy=function(e){(0,Le.Z)(t,e);var r=U2(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("colorhalftone-pass",{vs:V2,fs:Z2});var i=this.shaderModuleService.getModule("colorhalftone-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,y=f.height;return{vs:a,fs:s,uniforms:(0,W.Z)((0,W.Z)({},l),{},{u_ViewportSize:[d,y]})}}}]),t}(Gh))||hy),py,dy;function H2(e){var r=W2();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function W2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var G2=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,X2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,$2=(py=(0,tr.b2)(),py(dy=function(e){(0,Le.Z)(t,e);var r=H2(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("copy-pass",{vs:X2,fs:G2}),this.shaderModuleService.getModule("copy-pass")}}]),t}(Gh))||dy),vy,gy;function Y2(e){var r=q2();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function q2(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var K2=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform vec2 u_Center : [0.5, 0.5];
uniform float u_Scale : 10;

// https://github.com/evanw/glfx.js/blob/master/src/filters/fun/hexagonalpixelate.js
vec4 hexagonalPixelate_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 tex = (texCoord * texSize - u_Center * texSize) / u_Scale;
  tex.y /= 0.866025404;
  tex.x -= tex.y * 0.5;
  vec2 a;
  if (tex.x + tex.y - floor(tex.x) - floor(tex.y) < 1.0) {
    a = vec2(floor(tex.x), floor(tex.y));
  }
  else a = vec2(ceil(tex.x), ceil(tex.y));
  vec2 b = vec2(ceil(tex.x), floor(tex.y));
  vec2 c = vec2(floor(tex.x), ceil(tex.y));
  vec3 TEX = vec3(tex.x, tex.y, 1.0 - tex.x - tex.y);
  vec3 A = vec3(a.x, a.y, 1.0 - a.x - a.y);
  vec3 B = vec3(b.x, b.y, 1.0 - b.x - b.y);
  vec3 C = vec3(c.x, c.y, 1.0 - c.x - c.y);
  float alen = length(TEX - A);
  float blen = length(TEX - B);
  float clen = length(TEX - C);
  vec2 choice;
  if (alen < blen) {
    if (alen < clen) choice = a;
    else choice = c;
  } else {
    if (blen < clen) choice = b;
    else choice = c;
  }
  choice.x += choice.y * 0.5;
  choice.y *= 0.866025404;
  choice *= u_Scale / texSize;
  return texture2D(texture, choice + u_Center);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = hexagonalPixelate_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,Q2=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,J2=(vy=(0,tr.b2)(),vy(gy=function(e){(0,Le.Z)(t,e);var r=Y2(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("hexagonalpixelate-pass",{vs:Q2,fs:K2});var i=this.shaderModuleService.getModule("hexagonalpixelate-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,y=f.height;return{vs:a,fs:s,uniforms:(0,W.Z)((0,W.Z)({},l),{},{u_ViewportSize:[d,y]})}}}]),t}(Gh))||gy),_y,yy;function eA(e){var r=tA();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function tA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rA=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform vec2 u_ViewportSize: [1.0, 1.0];
uniform float u_Strength : 0.6;

vec4 ink_sampleColor(sampler2D texture, vec2 texSize, vec2 texCoord) {
  vec2 dx = vec2(1.0 / texSize.x, 0.0);
  vec2 dy = vec2(0.0, 1.0 / texSize.y);
  vec4 color = texture2D(texture, texCoord);
  float bigTotal = 0.0;
  float smallTotal = 0.0;
  vec3 bigAverage = vec3(0.0);
  vec3 smallAverage = vec3(0.0);
  for (float x = -2.0; x <= 2.0; x += 1.0) {
    for (float y = -2.0; y <= 2.0; y += 1.0) {
      vec3 sample = texture2D(texture, texCoord + dx * x + dy * y).rgb;
      bigAverage += sample;
      bigTotal += 1.0;
      if (abs(x) + abs(y) < 2.0) {
        smallAverage += sample;
        smallTotal += 1.0;
      }
    }
  }
  vec3 edge = max(vec3(0.0), bigAverage / bigTotal - smallAverage / smallTotal);
  float power = u_Strength * u_Strength * u_Strength * u_Strength * u_Strength;
  return vec4(color.rgb - dot(edge, edge) * power * 100000.0, color.a);
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = ink_sampleColor(u_Texture, u_ViewportSize, v_UV);
}`,nA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,iA=(_y=(0,tr.b2)(),_y(yy=function(e){(0,Le.Z)(t,e);var r=eA(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){this.shaderModuleService.registerModule("ink-pass",{vs:nA,fs:rA});var i=this.shaderModuleService.getModule("ink-pass"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService.getViewportSize(),d=f.width,y=f.height;return{vs:a,fs:s,uniforms:(0,W.Z)((0,W.Z)({},l),{},{u_ViewportSize:[d,y]})}}}]),t}(Gh))||yy),xy,by;function aA(e){var r=oA();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function oA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var sA=`varying vec2 v_UV;

uniform sampler2D u_Texture;
uniform float u_Amount : 0.5;

float rand(vec2 co) {
  return fract(sin(dot(co.xy ,vec2(12.9898,78.233))) * 43758.5453);
}

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/noise.js
vec4 noise_filterColor(vec4 color, vec2 texCoord) {
  float diff = (rand(texCoord) - 0.5) * u_Amount;
  color.r += diff;
  color.g += diff;
  color.b += diff;
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = noise_filterColor(gl_FragColor, v_UV);
}`,uA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,lA=(xy=(0,tr.b2)(),xy(by=function(e){(0,Le.Z)(t,e);var r=aA(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("noise-pass",{vs:uA,fs:sA}),this.shaderModuleService.getModule("noise-pass")}}]),t}(Gh))||by),Ey,Sy;function cA(e){var r=fA();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function fA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`,pA=`varying vec2 v_UV;

uniform sampler2D u_Texture;

uniform float u_Amount : 0.5;

// https://github.com/evanw/glfx.js/blob/master/src/filters/adjust/sepia.js
vec4 sepia_filterColor(vec4 color) {
  float r = color.r;
  float g = color.g;
  float b = color.b;
  color.r =
    min(1.0, (r * (1.0 - (0.607 * u_Amount))) + (g * (0.769 * u_Amount)) + (b * (0.189 * u_Amount)));
  color.g = min(1.0, (r * 0.349 * u_Amount) + (g * (1.0 - (0.314 * u_Amount))) + (b * 0.168 * u_Amount));
  color.b = min(1.0, (r * 0.272 * u_Amount) + (g * 0.534 * u_Amount) + (b * (1.0 - (0.869 * u_Amount))));
  return color;
}

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
  gl_FragColor = sepia_filterColor(gl_FragColor);
}`,dA=(Ey=(0,tr.b2)(),Ey(Sy=function(e){(0,Le.Z)(t,e);var r=cA(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"setupShaders",value:function(){return this.shaderModuleService.registerModule("sepia-pass",{vs:hA,fs:pA}),this.shaderModuleService.getModule("sepia-pass")}}]),t}(Gh))||Sy),Ay,Ty,wy,Cy,uv,Ry,vA=(Ay=(0,tr.b2)(),Ty=(0,tr.f3)(Je.IRendererService),wy=(0,tr.zY)(),Ay(Cy=(uv=function(){function e(){(0,Q.Z)(this,e),ki(this,"rendererService",Ry,this),(0,F.Z)(this,"passes",[]),(0,F.Z)(this,"readFBO",void 0),(0,F.Z)(this,"writeFBO",void 0)}return(0,j.Z)(e,[{key:"getReadFBO",value:function(){return this.readFBO}},{key:"getWriteFBO",value:function(){return this.writeFBO}},{key:"getCurrentFBOTex",value:function(){var t=this.rendererService,n=t.getViewportSize,i=t.createTexture2D,a=n(),s=a.width,l=a.height;return i({x:0,y:0,width:s,height:l,copy:!0})}},{key:"getReadFBOTex",value:function(){var t=this,n=this.rendererService.useFramebuffer;return new Promise(function(i){n(t.readFBO,(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:i(t.getCurrentFBOTex());case 1:case"end":return l.stop()}},a)})))})}},{key:"renderBloomPass",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i,a){var s,l;return _e().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.getReadFBOTex();case 2:s=d.sent,l=0;case 4:if(!(l<4)){d.next=11;break}return d.next=7,a.render(i,s);case 7:this.swap(),l++,d.next=4;break;case 11:case"end":return d.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i){var a,s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:a=0;case 1:if(!(a<this.passes.length)){f.next=15;break}if(s=this.passes[a],s.setRenderToScreen(this.isLastEnabledPass(a)),s.getName()!=="bloom"){f.next=9;break}return f.next=7,this.renderBloomPass(i,s);case 7:f.next=12;break;case 9:return f.next=11,s.render(i);case 11:a!==this.passes.length-1&&this.swap();case 12:a++,f.next=1;break;case 15:case"end":return f.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"resize",value:function(t,n){this.readFBO.resize({width:t,height:n}),this.writeFBO.resize({width:t,height:n})}},{key:"add",value:function(t,n,i){t.init(n,i),this.passes.push(t)}},{key:"insert",value:function(t,n,i,a){t.init(i,a),this.passes.splice(n,0,t)}},{key:"getPostProcessingPassByName",value:function(t){return this.passes.find(function(n){return n.getName()===t})}},{key:"init",value:function(){var t=this.rendererService,n=t.createFramebuffer,i=t.createTexture2D;this.readFBO=n({color:i({width:1,height:1,wrapS:I.CLAMP_TO_EDGE,wrapT:I.CLAMP_TO_EDGE})}),this.writeFBO=n({color:i({width:1,height:1,wrapS:I.CLAMP_TO_EDGE,wrapT:I.CLAMP_TO_EDGE})})}},{key:"isLastEnabledPass",value:function(t){for(var n=t+1;n<this.passes.length;n++)if(this.passes[n].isEnabled())return!1;return!0}},{key:"swap",value:function(){var t=this.readFBO;this.readFBO=this.writeFBO,this.writeFBO=t}}]),e}(),Ry=Pi(uv.prototype,"rendererService",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Pi(uv.prototype,"init",[wy],Object.getOwnPropertyDescriptor(uv.prototype,"init"),uv.prototype),uv))||Cy),My,Iy;function mA(e){var r=gA();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function gA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _A=(My=(0,tr.b2)(),My(Iy=function(e){(0,Le.Z)(t,e);var r=mA(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getType",value:function(){return sv.Normal}},{key:"getName",value:function(){return"render"}},{key:"init",value:function(i,a){Ra((0,Ee.Z)(t.prototype),"init",this).call(this,i,a)}},{key:"render",value:function(i){var a=this.rendererService,s=a.useFramebuffer,l=a.clear,f=i.multiPassRenderer.getPostProcessor().getReadFBO();s(f,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:f}),i.multiPassRenderer.setRenderFlag(!1),i.models.forEach(function(d){d.draw({uniforms:i.layerModel.getUninforms()})}),i.multiPassRenderer.setRenderFlag(!0)})}}]),t}(Eg))||Iy),Py,Oy,ky,k0,Dy;function yA(e){var r=xA();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function xA(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bA=`uniform float u_opacity : 1.0;
uniform float u_MixRatio : 0.5;

uniform sampler2D u_Diffuse1;
uniform sampler2D u_Diffuse2;

varying vec2 v_UV;

void main() {
  vec4 texel1 = texture2D(u_Diffuse1, v_UV);
  vec4 texel2 = texture2D(u_Diffuse2, v_UV);
  gl_FragColor = u_opacity * mix(texel1, texel2, u_MixRatio);
}
`,Ly=`varying vec2 v_UV;

uniform sampler2D u_Texture;

void main() {
  gl_FragColor = vec4(texture2D(u_Texture, v_UV));
}`,EA=`attribute vec2 a_Position;

varying vec2 v_UV;

void main() {
  v_UV = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);
}`;function By(e,r){for(var t=0,n=1/r,i=e;i>0;)t=t+n*(i%r),i=Math.floor(i/r),n=n/r;return t}var SA=1,AA=(Py=(0,tr.b2)(),Oy=(0,tr.f3)(Je.IShaderModuleService),Py(ky=(k0=function(e){(0,Le.Z)(t,e);var r=yA(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),ki((0,Re.Z)(n),"shaderModuleService",Dy,(0,Re.Z)(n)),(0,F.Z)((0,Re.Z)(n),"haltonSequence",[]),(0,F.Z)((0,Re.Z)(n),"accumulatingId",0),(0,F.Z)((0,Re.Z)(n),"frame",0),(0,F.Z)((0,Re.Z)(n),"timer",void 0),(0,F.Z)((0,Re.Z)(n),"sampleRenderTarget",void 0),(0,F.Z)((0,Re.Z)(n),"prevRenderTarget",void 0),(0,F.Z)((0,Re.Z)(n),"outputRenderTarget",void 0),(0,F.Z)((0,Re.Z)(n),"copyRenderTarget",void 0),(0,F.Z)((0,Re.Z)(n),"blendModel",void 0),(0,F.Z)((0,Re.Z)(n),"outputModel",void 0),(0,F.Z)((0,Re.Z)(n),"copyModel",void 0),n}return(0,j.Z)(t,[{key:"getType",value:function(){return sv.Normal}},{key:"getName",value:function(){return"taa"}},{key:"init",value:function(i,a){Ra((0,Ee.Z)(t.prototype),"init",this).call(this,i,a);var s=this.rendererService,l=s.createFramebuffer,f=s.createTexture2D;this.sampleRenderTarget=l({color:f({width:1,height:1,wrapS:I.CLAMP_TO_EDGE,wrapT:I.CLAMP_TO_EDGE})}),this.prevRenderTarget=l({color:f({width:1,height:1,wrapS:I.CLAMP_TO_EDGE,wrapT:I.CLAMP_TO_EDGE})}),this.outputRenderTarget=l({color:f({width:1,height:1,wrapS:I.CLAMP_TO_EDGE,wrapT:I.CLAMP_TO_EDGE})}),this.copyRenderTarget=l({color:f({width:1,height:1,wrapS:I.CLAMP_TO_EDGE,wrapT:I.CLAMP_TO_EDGE})});for(var d=0;d<30;d++)this.haltonSequence.push([By(d,2),By(d,3)]);this.blendModel=this.createTriangleModel("blend-pass",bA),this.outputModel=this.createTriangleModel("copy-pass",Ly,{blend:{enable:!0,func:{srcRGB:I.ONE,dstRGB:I.ONE_MINUS_SRC_ALPHA,srcAlpha:I.ONE,dstAlpha:I.ONE_MINUS_SRC_ALPHA},equation:{rgb:I.FUNC_ADD,alpha:I.FUNC_ADD}}}),this.copyModel=this.createTriangleModel("copy-pass",Ly)}},{key:"render",value:function(i){var a=this,s=this.rendererService,l=s.clear,f=s.getViewportSize,d=s.useFramebuffer,y=f(),b=y.width,T=y.height;this.sampleRenderTarget.resize({width:b,height:T}),this.prevRenderTarget.resize({width:b,height:T}),this.outputRenderTarget.resize({width:b,height:T}),this.copyRenderTarget.resize({width:b,height:T}),this.resetFrame(),this.stopAccumulating();var M=i.multiPassRenderer.getPostProcessor().getReadFBO();d(M,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:M}),i.multiPassRenderer.setRenderFlag(!1),i.render(),i.multiPassRenderer.setRenderFlag(!0)});var P=function k(H){!a.accumulatingId||H!==a.accumulatingId||a.isFinished()||(a.doRender(i),window.requestAnimationFrame(function(){k(H)}))};this.accumulatingId=SA++,this.timer=window.setTimeout(function(){P(a.accumulatingId)},50)}},{key:"doRender",value:function(i){var a=this,s=this.rendererService,l=s.clear,f=s.getViewportSize,d=s.useFramebuffer,y=f(),b=y.width,T=y.height,M=i.getLayerConfig(),P=M.jitterScale,k=P===void 0?1:P,H=this.haltonSequence[this.frame%this.haltonSequence.length];this.cameraService.jitterProjectionMatrix((H[0]*2-1)/b*k,(H[1]*2-1)/T*k),i.multiPassRenderer.setRenderFlag(!1),i.hooks.beforeRender.call(),d(this.sampleRenderTarget,function(){l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:a.sampleRenderTarget}),i.render()}),i.hooks.afterRender.call(),i.multiPassRenderer.setRenderFlag(!0);var q=i.getLayerConfig();d(this.outputRenderTarget,function(){a.blendModel.draw({uniforms:{u_opacity:q.opacity||1,u_MixRatio:a.frame===0?1:.9,u_Diffuse1:a.sampleRenderTarget,u_Diffuse2:a.frame===0?i.multiPassRenderer.getPostProcessor().getReadFBO():a.prevRenderTarget}})}),this.frame===0&&l({color:[0,0,0,0],depth:1,stencil:0,framebuffer:this.copyRenderTarget}),this.frame>=1&&(d(this.copyRenderTarget,function(){a.outputModel.draw({uniforms:{u_Texture:a.outputRenderTarget}})}),d(i.multiPassRenderer.getPostProcessor().getReadFBO(),function(){a.copyModel.draw({uniforms:{u_Texture:a.copyRenderTarget}})}),i.multiPassRenderer.getPostProcessor().render(i));var ae=this.prevRenderTarget;this.prevRenderTarget=this.outputRenderTarget,this.outputRenderTarget=ae,this.frame++,this.cameraService.clearJitterProjectionMatrix()}},{key:"isFinished",value:function(){return this.frame>=this.haltonSequence.length}},{key:"resetFrame",value:function(){this.frame=0}},{key:"stopAccumulating",value:function(){this.accumulatingId=0,window.clearTimeout(this.timer)}},{key:"createTriangleModel",value:function(i,a,s){this.shaderModuleService.registerModule(i,{vs:EA,fs:a});var l=this.shaderModuleService.getModule(i),f=l.vs,d=l.fs,y=l.uniforms,b=this.rendererService,T=b.createAttribute,M=b.createBuffer,P=b.createModel;return P((0,W.Z)({vs:f,fs:d,attributes:{a_Position:T({buffer:M({data:[-4,-4,4,-4,0,4],type:I.FLOAT}),size:2})},uniforms:(0,W.Z)({},y),depth:{enable:!1},count:3},s))}}]),t}(Eg),Dy=Pi(k0.prototype,"shaderModuleService",[Oy],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),k0))||ky),mm=new tr.W2;mm.bind(Je.IGlobalConfigService).to(ug).inSingletonScope(),(0,tr.GW)((0,tr.b2)(),qa.EventEmitter),mm.bind(Je.IEventEmitter).to(qa.EventEmitter);var Fy=(0,Ti.Z)(mm,!1),D0=function(r){var t=Fy.lazyInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},kB=function(r){var t=Fy.lazyMultiInject(r);return function(n,i,a){t.call(this,n,i),a&&(a.initializer=function(){return n[i]})}},Zl=mm,TA=0;function wA(){var e=new tr.W2;return e.parent=mm,e.bind(Je.SceneID).toConstantValue("".concat(TA++)),e.bind(Je.IShaderModuleService).to(s2).inSingletonScope(),e.bind(Je.ILayerService).to(So).inSingletonScope(),e.bind(Je.IDebugService).to(fg).inSingletonScope(),e.bind(Je.ISceneService).to(vg).inSingletonScope(),e.bind(Je.ICameraService).to(Er).inSingletonScope(),e.bind(Je.ICoordinateSystemService).to(lg).inSingletonScope(),e.bind(Je.IInteractionService).to(K).inSingletonScope(),e.bind(Je.IPickingService).to(ti).inSingletonScope(),e.bind(Je.IControlService).to(Fo).inSingletonScope(),e.bind(Je.IMarkerService).to(Yu).inSingletonScope(),e.bind(Je.IIconService).to(gt).inSingletonScope(),e.bind(Je.IFontService).to($t).inSingletonScope(),e.bind(Je.IPopupService).to(td).inSingletonScope(),e.bind(Je.INormalPass).to(f2).whenTargetNamed("clear"),e.bind(Je.INormalPass).to(g2).whenTargetNamed("pixelPicking"),e.bind(Je.INormalPass).to(_A).whenTargetNamed("render"),e.bind(Je.INormalPass).to(AA).whenTargetNamed("taa"),e.bind(Je.IFactoryNormalPass).toFactory(function(r){return function(t){return r.container.getNamed(Je.INormalPass,t)}}),e.bind(Je.IPostProcessingPass).to($2).whenTargetNamed("copy"),e.bind(Je.IPostProcessingPass).to(w2).whenTargetNamed("bloom"),e.bind(Je.IPostProcessingPass).to(O2).whenTargetNamed("blurH"),e.bind(Je.IPostProcessingPass).to(N2).whenTargetNamed("blurV"),e.bind(Je.IPostProcessingPass).to(lA).whenTargetNamed("noise"),e.bind(Je.IPostProcessingPass).to(dA).whenTargetNamed("sepia"),e.bind(Je.IPostProcessingPass).to(j2).whenTargetNamed("colorHalftone"),e.bind(Je.IPostProcessingPass).to(J2).whenTargetNamed("hexagonalPixelate"),e.bind(Je.IPostProcessingPass).to(iA).whenTargetNamed("ink"),e.bind(Je.IFactoryPostProcessingPass).toFactory(function(r){return function(t){var n=r.container.getNamed(Je.IPostProcessingPass,t);return n.setName(t),n}}),e}function gm(e){var r=new tr.W2;return r.parent=e,r.bind(Je.IStyleAttributeService).to(qu).inSingletonScope(),r.bind(Je.IMultiPassRenderer).to(d2).inSingletonScope(),r.bind(Je.IPostProcessor).to(vA).inSingletonScope(),r}var CA=null;function DB(e){return CA.indexOf(e)}var Ny=ui.clamp,RA=2,LB=4,MA=64,BB=128,IA=256,PA=512,FB=8192,NB=16384,UB=32768,OA=null,Uy=131072,zB=262144,kA=524288,ZB=1048576,DA=2097152,VB=4194304,LA=8388608,BA=16777216,FA=null;function Sg(e,r){return e=Ny(Math.floor(e),0,255),r=Ny(Math.floor(r),0,255),256*e+r}function jB(e){var r=e.color,t=e.radius,n=e.tileX,i=e.tileY,a=e.shape,s=e.opacity,l=e.stroke,f=e.strokeWidth,d=e.strokeOpacity,y=[],b=[],T=[],M=[Sg(r[0],r[1]),Sg(r[2],r[3])],P=[Sg(l[0],l[1]),Sg(l[2],l[3])];return[[-1,-1],[1,-1],[1,1],[-1,1]].forEach(function(k){var H=_slicedToArray(k,2),q=H[0],ae=H[1];y.push([].concat(M,[(q+1)*LA+(ae+1)*DA+getShapeIndex(a)*Uy+t,(n+512)*kA+(i+512)*MA])),b.push([].concat(P,[f,d])),T.push([s,0,0,0])}),{packedBuffer:y,packedBuffer2:b,packedBuffer3:T}}function HB(e,r){if(e===0&&!r)return 0;if(e===1&&r)return 4294967295;var t=r?1:0,n=Math.floor(e*127);return n*FA+t*BA+n*Uy+t*OA+n*PA+t*IA+n*RA+t}var yd={ProjectionMatrix:"u_ProjectionMatrix",ViewMatrix:"u_ViewMatrix",ViewProjectionMatrix:"u_ViewProjectionMatrix",Zoom:"u_Zoom",ZoomScale:"u_ZoomScale",FocalDistance:"u_FocalDistance",CameraPosition:"u_CameraPosition"},ks={MapInitStart:"mapInitStart",LayerInitStart:"layerInitStart",LayerInitEnd:"layerInitEnd",SourceInitStart:"sourceInitStart",SourceInitEnd:"sourceInitEnd",ScaleInitStart:"scaleInitStart",ScaleInitEnd:"scaleInitEnd",MappingStart:"mappingStart",MappingEnd:"mappingEnd",BuildModelStart:"buildModelStart",BuildModelEnd:"buildModelEnd"},$a=function(e){return e.LINEAR="linear",e.SEQUENTIAL="sequential",e.POWER="power",e.LOG="log",e.IDENTITY="identity",e.TIME="time",e.QUANTILE="quantile",e.QUANTIZE="quantize",e.THRESHOLD="threshold",e.CAT="cat",e.DIVERGING="diverging",e}({}),lv=function(e){return e.CONSTANT="constant",e.VARIABLE="variable",e}({}),Mn=function(e){return e[e.Attribute=0]="Attribute",e[e.InstancedAttribute=1]="InstancedAttribute",e[e.Uniform=2]="Uniform",e}({}),NA=["mapload","mapchange","mapAfterFrameChange"],Ag=["loaded","fontloaded","maploaded","resize","destroy","dragstart","dragging","dragend","dragcancel"],Mu=function(e){return e.IMAGE="image",e.CUSTOMIMAGE="customImage",e.ARRAYBUFFER="arraybuffer",e.RGB="rgb",e.TERRAINRGB="terrainRGB",e.CUSTOMRGB="customRGB",e.CUSTOMARRAYBUFFER="customArrayBuffer",e.CUSTOMTERRAINRGB="customTerrainRGB",e}({}),UA=function(){var e=(0,Zt.Z)(_e().mark(function r(t,n,i,a){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",new Promise(function(f,d){n({x:t.x,y:t.y,z:t.z},function(y,b){if(y||b.length===0){d(y);return}b&&ai([{data:b,bands:[0]}],i,a,function(T,M){T?d(T):M&&f(M)})})}));case 1:case"end":return l.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}(),zA=function(){var e=(0,Zt.Z)(_e().mark(function r(t,n){return _e().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",new Promise(function(s,l){n({x:t.x,y:t.y,z:t.z},function(f,d){if(f||!d){l(f);return}d instanceof ArrayBuffer?vu(d,function(y,b){y&&l(y),s(b)}):d instanceof HTMLImageElement?s(d):l(f)})}));case 1:case"end":return a.stop()}},r)}));return function(t,n){return e.apply(this,arguments)}}();function ZA(e,r){return Array.isArray(e)?typeof e[0]=="string"?e.map(function(t){return v(t,r)}):e.map(function(t){return{url:v(t.url,r),bands:t.bands||[0]}}):v(e,r)}function VA(e){return typeof e=="string"?[{url:e,bands:[0]}]:typeof e[0]=="string"?e.map(function(r){return{url:r,bands:[0]}}):e}function zy(e,r){e.xhrCancel=function(){r.map(function(t){t.abort()})}}var jA=function(){var e=(0,Zt.Z)(_e().mark(function r(t,n,i,a,s){var l,f,d,y,b,T;return _e().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:if(l=VA(n.url),!(l.length>1)){P.next=15;break}return P.next=4,HA(l,n);case 4:if(f=P.sent,d=f.rasterFiles,y=f.xhrList,b=f.errList,zy(t,y),!(b.length>0)){P.next=12;break}return i(b,null),P.abrupt("return");case 12:ai(d,a,s,i),P.next=17;break;case 15:T=Ei(n,function(k,H){if(k)i(k);else if(H){var q=[{data:H,bands:l[0].bands}];ai(q,a,s,i)}}),zy(t,[T]);case 17:case"end":return P.stop()}},r)}));return function(t,n,i,a,s){return e.apply(this,arguments)}}();function HA(e,r){return L0.apply(this,arguments)}function L0(){return L0=(0,Zt.Z)(_e().mark(function e(r,t){var n,i,a,s,l,f,d,y,b,T,M;return _e().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:n=[],i=[],a=[],s=0;case 4:if(!(s<r.length)){k.next=20;break}return l=r[s],f=(0,W.Z)((0,W.Z)({},t),{},{url:l.url}),d=l.bands,k.next=10,Vi((0,W.Z)((0,W.Z)({},f),{},{type:"arrayBuffer"}));case 10:y=k.sent,b=y.err,T=y.data,M=y.xhr,b&&a.push(b),i.push(M),n.push({data:T,bands:d});case 17:s++,k.next=4;break;case 20:return k.abrupt("return",{rasterFiles:n,xhrList:i,errList:a});case 21:case"end":return k.stop()}},e)})),L0.apply(this,arguments)}var WA=function(){var e=(0,Zt.Z)(_e().mark(function r(t,n,i,a,s){var l;return _e().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return l={url:ZA(t,n)},d.abrupt("return",new Promise(function(y,b){jA(i,l,function(T,M){T?b(T):M&&y(M)},a,s)}));case 2:case"end":return d.stop()}},r)}));return function(t,n,i,a,s){return e.apply(this,arguments)}}(),Zy=function(){var e=(0,Zt.Z)(_e().mark(function r(t,n,i,a){var s,l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return l=Array.isArray(t)?t[0]:t,a.wmtsOptions?(f=(a==null?void 0:a.getURLFromTemplate)||p,s=f(l,(0,W.Z)((0,W.Z)({},n),a.wmtsOptions))):(d=(a==null?void 0:a.getURLFromTemplate)||v,s=d(l,n)),b.abrupt("return",new Promise(function(T,M){var P,k=Oa({url:s,type:(a==null||(P=a.requestParameters)===null||P===void 0?void 0:P.type)||"arrayBuffer"},function(H,q){H?M(H):q&&T(q)},a.transformResponse);i.xhrCancel=function(){return k.cancel()}}));case 3:case"end":return b.stop()}},r)}));return function(t,n,i,a){return e.apply(this,arguments)}}(),Vy=function(){return{rasterData:new Uint8Array([0]),width:1,height:1}},GA={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0,warp:!0},WB=[Mu.ARRAYBUFFER,Mu.RGB];function XA(e){return!!(Array.isArray(e)&&e.length===0||!Array.isArray(e)&&typeof e!="string")}function $A(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(XA(e))throw new Error("tile server url is error");var t=(r==null?void 0:r.dataType)||Mu.IMAGE;t===Mu.RGB&&(t=Mu.ARRAYBUFFER);var n=function(s,l){switch(t){case Mu.IMAGE:return Zy(e,s,l,r);case Mu.CUSTOMIMAGE:case Mu.CUSTOMTERRAINRGB:return zA(l,r==null?void 0:r.getCustomData);case Mu.ARRAYBUFFER:return WA(e,s,l,(r==null?void 0:r.format)||Vy,r==null?void 0:r.operation);case Mu.CUSTOMARRAYBUFFER:case Mu.CUSTOMRGB:return UA(l,r==null?void 0:r.getCustomData,(r==null?void 0:r.format)||Vy,r==null?void 0:r.operation);default:return Zy(e,s,l,r)}},i=(0,W.Z)((0,W.Z)((0,W.Z)({},GA),r),{},{getTileData:n});return{data:e,dataArray:[],tilesetOptions:i,isTile:!0}}var YA=["extent","min","max","width","height","format","operation"];function qA(e,r){var t=r.extent,n=r.min,i=r.max,a=r.width,s=r.height,l=r.format,f=r.operation,d=(0,Ea.Z)(r,YA),y;if(l===void 0||Lc(e))y=Array.from(e);else{var b=Array.isArray(e)?e:[e];y=ln(b,l,f)}var T={_id:1,dataArray:[(0,W.Z)((0,W.Z)({_id:1,data:y,width:a,height:s},d),{},{min:n,max:i,coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return T}var KA={tileSize:256,minZoom:0,maxZoom:1/0,zoomOffset:0},QA=function(){var e=(0,Zt.Z)(_e().mark(function r(t){return _e().wrap(function(i){for(;;)switch(i.prev=i.next){case 0:return i.abrupt("return",new Promise(function(a){var s=(0,yn.Z)(t.bounds,4),l=s[0],f=s[1],d=s[2],y=s[3],b={layers:{testTile:{features:[{type:"Feature",properties:{key:t.x+"/"+t.y+"/"+t.z,x:(l+d)/2,y:(f+y)/2},geometry:{type:"LineString",coordinates:[[d,y],[d,f],[l,f],[l,f]]}}]}}};a(b)}));case 1:case"end":return i.stop()}},r)}));return function(t){return e.apply(this,arguments)}}();function JA(e,r){var t=function(a){return QA(a)},n=(0,W.Z)((0,W.Z)((0,W.Z)({},KA),r),{},{getTileData:t});return{data:e,dataArray:[],tilesetOptions:n,isTile:!0}}var eT=["extent","width","height"];function tT(e,r){var t=r.extent,n=r.width,i=r.height,a=(0,Ea.Z)(r,eT);e.length<3&&console.warn("RGB\u89E3\u6790\u9700\u8981\u4E09\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");for(var s=a.bands||[0,1,2],l=(0,yn.Z)(s,3),f=l[0],d=l[1],y=l[2],b=[e[f],e[d],e[y]],T=[],M=(a==null?void 0:a.countCut)||[2,98],P=(0,yn.Z)(M,2),k=P[0],H=P[1],q=(a==null?void 0:a.RMinMax)||Mr(b[0],k,H),ae=(a==null?void 0:a.GMinMax)||Mr(b[1],k,H),Se=(a==null?void 0:a.BMinMax)||Mr(b[2],k,H),ze=0;ze<b[0].length;ze++)T.push(Math.max(0,b[0][ze]-q[0])),T.push(Math.max(0,b[1][ze]-ae[0])),T.push(Math.max(0,b[2][ze]-Se[0]));var it={_id:1,dataArray:[(0,W.Z)((0,W.Z)({_id:1,data:T,width:n,height:i,rMinMax:q,gMinMax:ae,bMinMax:Se},a),{},{coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return it}var rT=["extent","width","height"];function nT(e,r){var t=r.extent,n=r.width,i=r.height,a=(0,Ea.Z)(r,rT);e.length<2&&console.warn("RGB\u89E3\u6790\u9700\u89812\u4E2A\u6CE2\u6BB5\u7684\u6570\u636E");for(var s=a.bands||[0,1],l=(0,yn.Z)(s,2),f=l[0],d=l[1],y=[e[f],e[d]],b=[],T=0;T<y[0].length;T++)b.push((y[1][T]-y[0][T])/(y[1][T]+y[0][T]));var M={_id:1,dataArray:[(0,W.Z)((0,W.Z)({_id:1,data:b,width:n,height:i},a),{},{coordinates:[[t[0],t[1]],[t[2],t[3]]]})]};return M}var iT=U(48096),aT=U.n(iT);function jy(e,r){var t=r.radius,n=t===void 0?40:t,i=r.maxZoom,a=i===void 0?18:i,s=r.minZoom,l=s===void 0?0:s,f=r.zoom,d=f===void 0?2:f;if(e.pointIndex){var y=e.pointIndex.getClusters(e.extent,Math.floor(d));return e.dataArray=oT(y),e}var b=new(aT())({radius:n,minZoom:l,maxZoom:a}),T={type:"FeatureCollection",features:[]};return T.features=e.dataArray.map(function(M){return{type:"Feature",geometry:{type:"Point",coordinates:M.coordinates},properties:(0,W.Z)({},M)}}),b.load(T.features),b}function oT(e){return e.map(function(r,t){return(0,W.Z)({coordinates:r.geometry.coordinates,_id:t+1},r.properties)})}function sT(e){if(e.length===0)throw new Error("max requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]>r&&(r=e[t]);return r}function uT(e){if(e.length===0)throw new Error("min requires at least one data point");for(var r=e[0],t=1;t<e.length;t++)e[t]<r&&(r=e[t]);return r}function Hy(e){if(e.length===0)return 0;for(var r=e[0],t=0,n,i=1;i<e.length;i++)n=r+e[i]*1,Math.abs(r)>=Math.abs(e[i])?t+=r-n+e[i]:t+=e[i]-n+r,r=n;return r+t*1}function lT(e){if(e.length===0)throw new Error("mean requires at least one data point");return Hy(e)/e.length}var cT={min:uT,max:sT,mean:lT,sum:Hy};function fT(e){var r=hT();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function hT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var pT=ui.cloneDeep,Wy=ui.isFunction,dT=ui.isString,vT=ui.mergeWith;function mT(e,r){if(Array.isArray(r))return r}var gT=function(e){(0,Le.Z)(t,e);var r=fT(t);function t(n,i){var a;return(0,Q.Z)(this,t),a=r.call(this),(0,F.Z)((0,Re.Z)(a),"type","source"),(0,F.Z)((0,Re.Z)(a),"isTile",!1),(0,F.Z)((0,Re.Z)(a),"inited",!1),(0,F.Z)((0,Re.Z)(a),"hooks",{init:new Ul}),(0,F.Z)((0,Re.Z)(a),"parser",{type:"geojson"}),(0,F.Z)((0,Re.Z)(a),"transforms",[]),(0,F.Z)((0,Re.Z)(a),"cluster",!1),(0,F.Z)((0,Re.Z)(a),"clusterOptions",{enable:!1,radius:40,maxZoom:20,zoom:-99,method:"count"}),(0,F.Z)((0,Re.Z)(a),"invalidExtent",!1),(0,F.Z)((0,Re.Z)(a),"dataArrayChanged",!1),(0,F.Z)((0,Re.Z)(a),"cfg",{autoRender:!0}),a.originData=n,a.initCfg(i),a.init().then(function(){a.inited=!0,a.emit("update",{type:"inited"})}),a}return(0,j.Z)(t,[{key:"getSourceCfg",value:function(){return this.cfg}},{key:"getClusters",value:function(i){return this.clusterIndex.getClusters(this.caculClusterExtent(2),i)}},{key:"getClustersLeaves",value:function(i){return this.clusterIndex.getLeaves(i,1/0)}},{key:"getParserType",value:function(){return this.parser.type}},{key:"updateClusterData",value:function(i){var a=this,s=this.clusterOptions,l=s.method,f=l===void 0?"sum":l,d=s.field,y=this.clusterIndex.getClusters(this.caculClusterExtent(2),Math.floor(i));this.clusterOptions.zoom=i,y.forEach(function(b){b.id||(b.properties.point_count=1)}),(d||Wy(f))&&(y=y.map(function(b){var T=b.id;if(T){var M=a.clusterIndex.getLeaves(T,1/0),P=M.map(function(q){return q.properties}),k;if(dT(f)&&d){var H=Xf(P,d);k=cT[f](H)}Wy(f)&&(k=f(P)),b.properties.stat=k}else b.properties.point_count=1;return b})),this.data=he("geojson")({type:"FeatureCollection",features:y}),this.executeTrans()}},{key:"getFeatureById",value:function(i){var a=this.parser,s=a.type,l=s===void 0?"geojson":s,f=a.geometry;if(l==="geojson"&&!this.cluster){var d=i<this.originData.features.length?this.originData.features[i]:"null",y=pT(d);if(y!=null&&y.properties&&(this.transforms.length!==0||this.dataArrayChanged)){var b=this.data.dataArray.find(function(T){return T._id===i});y.properties=b}return y}else return l==="json"&&f?this.data.dataArray.find(function(T){return T._id===i}):i<this.data.dataArray.length?this.data.dataArray[i]:"null"}},{key:"updateFeaturePropertiesById",value:function(i,a){this.data.dataArray=this.data.dataArray.map(function(s){return s._id===i?(0,W.Z)((0,W.Z)({},s),a):s}),this.dataArrayChanged=!0,this.emit("update",{type:"update"})}},{key:"getFeatureId",value:function(i,a){var s=this.data.dataArray.find(function(l){return l[i]===a});return s==null?void 0:s._id}},{key:"setData",value:function(i,a){var s=this;this.originData=i,this.dataArrayChanged=!1,this.initCfg(a),this.init().then(function(){s.emit("update",{type:"update"})})}},{key:"reloadAllTile",value:function(){var i;(i=this.tileset)===null||i===void 0||i.reloadAll()}},{key:"reloadTilebyId",value:function(i,a,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileById(i,a,s)}},{key:"reloadTileByLnglat",value:function(i,a,s){var l;(l=this.tileset)===null||l===void 0||l.reloadTileByLnglat(i,a,s)}},{key:"getTileExtent",value:function(i,a){var s;return(s=this.tileset)===null||s===void 0?void 0:s.getTileExtent(i,a)}},{key:"getTileByZXY",value:function(i,a,s){var l;return(l=this.tileset)===null||l===void 0?void 0:l.getTileByZXY(i,a,s)}},{key:"reloadTileByExtent",value:function(i,a){var s;(s=this.tileset)===null||s===void 0||s.reloadTileByExtent(i,a)}},{key:"destroy",value:function(){var i;this.removeAllListeners(),this.originData=null,this.clusterIndex=null,this.data=null,(i=this.tileset)===null||i===void 0||i.destroy()}},{key:"processData",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s=this;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.abrupt("return",new Promise(function(d,y){try{s.excuteParser(),s.initCluster(),s.executeTrans(),d({})}catch(b){y(b)}}));case 1:case"end":return f.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"initCfg",value:function(i){this.cfg=vT(this.cfg,i,mT);var a=this.cfg;a&&(a.parser&&(this.parser=a.parser),a.transforms&&(this.transforms=a.transforms),this.cluster=a.cluster||!1,a.clusterOptions&&(this.cluster=!0,this.clusterOptions=(0,W.Z)((0,W.Z)({},this.clusterOptions),a.clusterOptions)))}},{key:"init",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.inited=!1,l.next=3,this.processData();case 3:this.inited=!0;case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"excuteParser",value:function(){var i=this.parser,a=i.type||"geojson",s=he(a);this.data=s(this.originData,i),this.tileset=this.initTileset(),!i.cancelExtent&&(this.extent=zu(this.data.dataArray),this.setCenter(this.extent),this.invalidExtent=this.extent[0]===this.extent[2]||this.extent[1]===this.extent[3])}},{key:"setCenter",value:function(i){this.center=[(i[0]+i[2])/2,(i[1]+i[3])/2],(isNaN(this.center[0])||isNaN(this.center[1]))&&(this.center=[108.92361111111111,34.54083333333333])}},{key:"initTileset",value:function(){var i=this.data.tilesetOptions;if(i){if(this.isTile=!0,this.tileset)return this.tileset.updateOptions(i),this.tileset;var a=new jf((0,W.Z)({},i));return a}}},{key:"executeTrans",value:function(){var i=this,a=this.transforms;a.forEach(function(s){var l=s.type,f=Ge(l)(i.data,s);Object.assign(i.data,f)})}},{key:"initCluster",value:function(){if(this.cluster){var i=this.clusterOptions||{};this.clusterIndex=jy(this.data,i)}}},{key:"caculClusterExtent",value:function(i){var a=[[-1/0,-1/0],[1/0,1/0]];return this.invalidExtent||(a=Zu(Ql(this.extent),i)),a[0].concat(a[1])}}]),t}(qa.EventEmitter);function _T(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.filter(t)),e}function Gy(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=yT(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function yT(e,r){if(e){if(typeof e=="string")return Xy(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Xy(e,r)}}function Xy(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var B0=6378e3;function xT(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=i/(2*Math.PI*B0)*(256<<20)/2,s=bT(t,i),l=s.gridHash,f=s.gridOffset,d=TT(l,f,r);return{yOffset:a,xOffset:a,radius:a,type:"grid",dataArray:d}}function bT(e,r){var t=1/0,n=-1/0,i,a=Gy(e),s;try{for(a.s();!(s=a.n()).done;){var l=s.value;i=l.coordinates[1],Number.isFinite(i)&&(t=i<t?i:t,n=i>n?i:n)}}catch(Se){a.e(Se)}finally{a.f()}var f=(t+n)/2,d=ET(r,f);if(d.xOffset<=0||d.yOffset<=0)return{gridHash:{},gridOffset:d};var y={},b=Gy(e),T;try{for(b.s();!(T=b.n()).done;){var M=T.value,P=M.coordinates[1],k=M.coordinates[0];if(Number.isFinite(P)&&Number.isFinite(k)){var H=Math.floor((P+90)/d.yOffset),q=Math.floor((k+180)/d.xOffset),ae="".concat(H,"-").concat(q);y[ae]=y[ae]||{count:0,points:[]},y[ae].count+=1,y[ae].points.push(M)}}}catch(Se){b.e(Se)}finally{b.f()}return{gridHash:y,gridOffset:d}}function ET(e,r){var t=ST(e),n=AT(r,e);return{yOffset:t,xOffset:n}}function ST(e){return e/B0*(180/Math.PI)}function AT(e,r){return r/B0*(180/Math.PI)/Math.cos(e*Math.PI/180)}function TT(e,r,t){return Object.keys(e).reduce(function(n,i,a){var s=i.split("-"),l=parseInt(s[0],10),f=parseInt(s[1],10),d={};if(t.field&&t.method){var y=Uf(e[i].points,t.field);d[t.method]=Cc[t.method](y)}return Object.assign(d,{_id:a,coordinates:Va([-180+r.xOffset*(f+.5),-90+r.yOffset*(l+.5)]),rawData:e[i].points,count:e[i].count}),n.push(d),n},[])}var cv=Math.PI/3,wT=[0,cv,2*cv,3*cv,4*cv,5*cv];function CT(e){return e[0]}function RT(e){return e[1]}function MT(){var e=0,r=0,t=1,n=1,i=CT,a=RT,s,l,f;function d(b){var T={},M=[],P,k=b.length;for(P=0;P<k;++P)if(!(isNaN(q=+i.call(null,H=b[P],P,b))||isNaN(ae=+a.call(null,H,P,b)))){var H,q,ae,Se=Math.round(ae=ae/f),ze=Math.round(q=q/l-(Se&1)/2),it=ae-Se;if(Math.abs(it)*3>1){var ut=q-ze,ot=ze+(q<ze?-1:1)/2,Ct=Se+(ae<Se?-1:1),Xt=q-ot,Sr=ae-Ct;ut*ut+it*it>Xt*Xt+Sr*Sr&&(ze=ot+(Se&1?1:-1)/2,Se=Ct)}var _r=ze+"-"+Se,Wr=T[_r];Wr?Wr.push(H):(M.push(Wr=T[_r]=[H]),Wr.x=(ze+(Se&1)/2)*l,Wr.y=Se*f)}return M}function y(b){var T=0,M=0;return wT.map(function(P){var k=Math.sin(P)*b,H=-Math.cos(P)*b,q=k-T,ae=H-M;return T=k,M=H,[q,ae]})}return d.hexagon=function(b){return"m"+y(b==null?s:+b).join("l")+"z"},d.centers=function(){for(var b=[],T=Math.round(r/f),M=Math.round(e/l),P=T*f;P<n+s;P+=f,++T)for(var k=M*l+(T&1)*l/2;k<t+l/2;k+=l)b.push([k,P]);return b},d.mesh=function(){var b=y(s).slice(0,4).join("l");return d.centers().map(function(T){return"M"+T+"m"+b}).join("")},d.x=function(b){return arguments.length?(i=b,d):i},d.y=function(b){return arguments.length?(a=b,d):a},d.radius=function(b){return arguments.length?(s=+b,l=s*2*Math.sin(cv),f=s*1.5,d):s},d.size=function(b){return arguments.length?(e=r=0,t=+b[0],n=+b[1],d):[t-e,n-r]},d.extent=function(b){return arguments.length?(e=+b[0][0],r=+b[0][1],t=+b[1][0],n=+b[1][1],d):[[e,r],[t,n]]},d.radius(1)}var IT=6378e3;function PT(e,r){var t=e.dataArray,n=r.size,i=n===void 0?10:n,a=r.method,s=a===void 0?"sum":a,l=i/(2*Math.PI*IT)*(256<<20)/2,f=t.map(function(T){var M=Va(T.coordinates),P=(0,yn.Z)(M,2),k=P[0],H=P[1];return(0,W.Z)((0,W.Z)({},T),{},{coordinates:[k,H]})}),d=MT().radius(l).x(function(T){return T.coordinates[0]}).y(function(T){return T.coordinates[1]}),y=d(f),b={dataArray:y.map(function(T,M){var P;if(r.field&&s){var k=Uf(T,r.field);T[s]=Cc[s](k)}return P={},(0,F.Z)(P,r.method,T[s]),(0,F.Z)(P,"count",T.length),(0,F.Z)(P,"rawData",T),(0,F.Z)(P,"coordinates",[T.x,T.y]),(0,F.Z)(P,"_id",M),P}),radius:l,xOffset:l,yOffset:l,type:"hexagon"};return b}function OT(e,r){var t=r.sourceField,n=r.targetField,i=r.data,a={};return i.forEach(function(s){a[s[t]]=s}),e.dataArray=e.dataArray.map(function(s){var l=s[n];return(0,W.Z)((0,W.Z)({},s),a[l])}),e}function kT(e,r){var t=r.callback;return t&&(e.dataArray=e.dataArray.map(t)),e}ce("rasterTile",$A),ce("mvt",Or),ce("geojsonvt",Ye),ce("testTile",JA),ce("geojson",Xp),ce("jsonTile",jt),ce("image",Kt),ce("csv",oc),ce("json",Wp),ce("raster",Dr),ce("rasterRgb",qA),ce("rgb",tT),ce("ndi",nT),oe("cluster",jy),oe("filter",_T),oe("join",OT),oe("map",kT),oe("grid",xT),oe("hexagon",PT);var $y=gT;function DT(e){var r=LT();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function LT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var BT=function(e){(0,Le.Z)(t,e);var r=DT(t);function t(n){var i;return(0,Q.Z)(this,t),i=r.call(this),(0,F.Z)((0,Re.Z)(i),"added",!1),(0,F.Z)((0,Re.Z)(i),"eventHandle",function(a){i.polyfillEvent(a),i.emit(a.type,{target:a,data:i.markerOption.extData,lngLat:i.lngLat})}),i.markerOption=(0,W.Z)((0,W.Z)({},i.getDefault()),n),_h(["update","onMove","onMapClick"],(0,Re.Z)(i)),i.init(),i}return(0,j.Z)(t,[{key:"getMarkerLayerContainerSize",value:function(){}},{key:"getDefault",value:function(){return{element:void 0,anchor:ca.BOTTOM,offsets:[0,0],color:"#5B8FF9",draggable:!1}}},{key:"addTo",value:function(i){this.scene=i,this.mapsService=i.get(Je.IMapService),this.sceneSerive=i.get(Je.ISceneService);var a=this.markerOption.element;return this.mapsService.getMarkerContainer().appendChild(a),this.registerMarkerEvent(a),this.mapsService.on("camerachange",this.update),this.update(),this.added=!0,this.emit("added"),this}},{key:"remove",value:function(){this.mapsService&&(this.mapsService.off("click",this.onMapClick),this.mapsService.off("move",this.update),this.mapsService.off("moveend",this.update),this.mapsService.off("camerachange",this.update)),this.unRegisterMarkerEvent(),this.removeAllListeners();var i=this.markerOption.element;return i&&Ci(i),this.popup&&this.popup.remove(),this}},{key:"setLnglat",value:function(i){return this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.popup&&this.popup.setLnglat(this.lngLat),this.update(),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"getElement",value:function(){return this.markerOption.element}},{key:"setElement",value:function(i){var a=this;if(!this.added)return this.once("added",function(){a.setElement(i)}),this;var s=this.markerOption.element;return s&&Ci(s),this.markerOption.element=i,this.init(),this.mapsService.getMarkerContainer().appendChild(i),this.registerMarkerEvent(i),this.update(),this}},{key:"openPopup",value:function(){var i=this;if(!this.added)return this.once("added",function(){i.openPopup()}),this;var a=this.popup;return a?(a.isOpen()||a.addTo(this.scene),this):this}},{key:"closePopup",value:function(){var i=this;this.added||this.once("added",function(){i.closePopup()});var a=this.popup;return a&&a.remove(),this}},{key:"setPopup",value:function(i){return this.popup=i,this.lngLat&&this.popup.setLnglat(this.lngLat),this}},{key:"togglePopup",value:function(){var i=this.popup;if(i)i.isOpen()?i.remove():i.addTo(this.scene);else return this;return this}},{key:"getPopup",value:function(){return this.popup}},{key:"getOffset",value:function(){return this.markerOption.offsets}},{key:"setDraggable",value:function(i){throw new Error("Method not implemented.")}},{key:"isDraggable",value:function(){return this.markerOption.draggable}},{key:"getExtData",value:function(){return this.markerOption.extData}},{key:"setExtData",value:function(i){this.markerOption.extData=i}},{key:"update",value:function(){if(this.mapsService){var i=this.markerOption,a=i.element,s=i.anchor;this.updatePosition(),gu(a,"".concat(wa[s]))}}},{key:"onMapClick",value:function(i){var a=this.markerOption.element;this.popup&&a&&this.togglePopup()}},{key:"getCurrentContainerSize",value:function(){var i=this.mapsService.getContainer();return{containerHeight:(i==null?void 0:i.scrollHeight)||0,containerWidth:(i==null?void 0:i.scrollWidth)||0,bounds:this.mapsService.getBounds()}}},{key:"updatePosition",value:function(){if(this.mapsService){var i=this.markerOption,a=i.element,s=i.offsets,l=this.lngLat,f=l.lng,d=l.lat,y=this.mapsService.lngLatToContainer([f,d]);if(a){a.style.display="block",a.style.whiteSpace="nowrap";var b=this.getMarkerLayerContainerSize()||this.getCurrentContainerSize(),T=b.containerHeight,M=b.containerWidth,P=b.bounds;if(!P)return;if(Math.abs(P[0][0])>180||Math.abs(P[1][0])>180){if(y.x>M){var k=this.mapsService.lngLatToContainer([f-360,d]);y.x=k.x}if(y.x<0){var H=this.mapsService.lngLatToContainer([f+360,d]);y.x=H.x}}(y.x>M||y.x<0||y.y>T||y.y<0)&&(a.style.display="none"),a.style.left=y.x+s[0]+"px",a.style.top=y.y-s[1]+"px"}}}},{key:"init",value:function(){var i=this,a=this.markerOption.element,s=this.markerOption,l=s.color,f=s.anchor;if(!a){this.defaultMarker=!0,a=$i("div"),this.markerOption.element=a;var d=document.createElementNS("http://www.w3.org/2000/svg","svg");d.setAttributeNS(null,"display","block"),d.setAttributeNS(null,"height","48px"),d.setAttributeNS(null,"width","48px"),d.setAttributeNS(null,"viewBox","0 0 1024 1024");var y=document.createElementNS("http://www.w3.org/2000/svg","path");y.setAttributeNS(null,"d","M512 490.666667C453.12 490.666667 405.333333 442.88 405.333333 384 405.333333 325.12 453.12 277.333333 512 277.333333 570.88 277.333333 618.666667 325.12 618.666667 384 618.666667 442.88 570.88 490.666667 512 490.666667M512 85.333333C346.88 85.333333 213.333333 218.88 213.333333 384 213.333333 608 512 938.666667 512 938.666667 512 938.666667 810.666667 608 810.666667 384 810.666667 218.88 677.12 85.333333 512 85.333333Z"),y.setAttributeNS(null,"fill",l),d.appendChild(y),a.appendChild(d)}ou(a,"l7-marker"),Object.keys(this.markerOption.style||{}).forEach(function(b){var T,M,P=((T=i.markerOption)===null||T===void 0?void 0:T.style)&&((M=i.markerOption)===null||M===void 0?void 0:M.style[b]);a&&(a.style[b]=P)}),Gl(a,f,"marker")}},{key:"registerMarkerEvent",value:function(i){i.addEventListener("click",this.onMapClick),i.addEventListener("mousemove",this.eventHandle),i.addEventListener("click",this.eventHandle),i.addEventListener("mousedown",this.eventHandle),i.addEventListener("mouseup",this.eventHandle),i.addEventListener("dblclick",this.eventHandle),i.addEventListener("contextmenu",this.eventHandle),i.addEventListener("mouseover",this.eventHandle),i.addEventListener("mouseout",this.eventHandle),i.addEventListener("touchstart",this.eventHandle),i.addEventListener("touchend",this.eventHandle)}},{key:"unRegisterMarkerEvent",value:function(){var i=this.getElement();i.removeEventListener("click",this.onMapClick),i.removeEventListener("mousemove",this.eventHandle),i.removeEventListener("click",this.eventHandle),i.removeEventListener("mousedown",this.eventHandle),i.removeEventListener("mouseup",this.eventHandle),i.removeEventListener("dblclick",this.eventHandle),i.removeEventListener("contextmenu",this.eventHandle),i.removeEventListener("mouseover",this.eventHandle),i.removeEventListener("mouseout",this.eventHandle),i.removeEventListener("touchstart",this.eventHandle),i.removeEventListener("touchend",this.eventHandle)}},{key:"polyfillEvent",value:function(i){!this.mapsService||this.mapsService.version!=="GAODE2.x"||Yl()||(i.type==="touchstart"&&(this.touchStartTime=Date.now()),i.type==="touchend"&&Date.now()-this.touchStartTime<300&&this.emit("click",{target:i,data:this.markerOption.extData,lngLat:this.lngLat}))}},{key:"addDragHandler",value:function(i){return null}},{key:"onUp",value:function(i){throw new Error("Method not implemented.")}}]),t}(qa.EventEmitter);function GB(e){var r=FT();return function(){var n=_getPrototypeOf(e),i;if(r){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function FT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var XB=ui.merge,$B=null,YB=U(95460);function NT(e){var r=UT();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function UT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var fv=function(e){(0,Le.Z)(t,e);var r=NT(t);function t(n){var i;return(0,Q.Z)(this,t),i=r.call(this),t.controlCount++,i.controlOption=(0,W.Z)((0,W.Z)({},i.getDefault(n)),n||{}),i}return(0,j.Z)(t,[{key:"getOptions",value:function(){return this.controlOption}},{key:"setOptions",value:function(i){var a=this.getDefault(i);Object.entries(i).forEach(function(s){var l=(0,yn.Z)(s,2),f=l[0],d=l[1];d===void 0&&(i[f]=a[f])}),"position"in i&&this.setPosition(i.position),"className"in i&&this.setClassName(i.className),"style"in i&&this.setStyle(i.style),this.controlOption=(0,W.Z)((0,W.Z)({},this.controlOption),i)}},{key:"addTo",value:function(i){this.mapsService=i.get(Je.IMapService),this.renderService=i.get(Je.IRendererService),this.layerService=i.get(Je.ILayerService),this.controlService=i.get(Je.IControlService),this.configService=i.get(Je.IGlobalConfigService),this.scene=i.get(Je.ISceneService),this.sceneContainer=i,this.isShow=!0,this.container=this.onAdd(),ou(this.container,"l7-control");var a=this.controlOption,s=a.className,l=a.style;return s&&this.setClassName(s),l&&this.setStyle(l),this.insertContainer(),this.emit("add",this),this}},{key:"remove",value:function(){if(!this.mapsService)return this;Ci(this.container),this.onRemove(),this.emit("remove",this)}},{key:"onAdd",value:function(){return $i("div")}},{key:"onRemove",value:function(){}},{key:"show",value:function(){var i=this.container;mu(i,"l7-control--hide"),this.isShow=!0,this.emit("show",this)}},{key:"hide",value:function(){var i=this.container;ou(i,"l7-control--hide"),this.isShow=!1,this.emit("hide",this)}},{key:"getDefault",value:function(i){return{position:Cr.TOPRIGHT,name:"".concat(t.controlCount)}}},{key:"getContainer",value:function(){return this.container}},{key:"getIsShow",value:function(){return this.isShow}},{key:"_refocusOnMap",value:function(i){if(this.mapsService&&i&&i.screenX>0&&i.screenY>0){var a=this.mapsService.getContainer();a!==null&&a.focus()}}},{key:"setPosition",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:Cr.TOPLEFT,a=this.controlService;return a&&a.removeControl(this),this.controlOption.position=i,a&&a.addControl(this,this.sceneContainer),this}},{key:"setClassName",value:function(i){var a=this.container,s=this.controlOption.className;s&&mu(a,s),i&&ou(a,i)}},{key:"setStyle",value:function(i){var a=this.container;i?a.setAttribute("style",i):a.removeAttribute("style")}},{key:"insertContainer",value:function(){var i=this.controlOption.position,a=this.container;if(i instanceof Element)i.appendChild(a);else{var s=this.controlService.controlCorners[i];["bottomleft","bottomright","righttop","rightbottom"].includes(i)?s.insertBefore(a,s.firstChild):s.appendChild(a)}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(s){return s in i})}}]),t}(zs());(0,F.Z)(fv,"controlCount",0);function zT(e){var r=ZT();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function ZT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Tg=function(e){(0,Le.Z)(t,e);var r=zT(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"isDisable",!1),n}return(0,j.Z)(t,[{key:"setIsDisable",value:function(i){if(this.isDisable=i,i){var a;(a=this.button)===null||a===void 0||a.setAttribute("disabled","true")}else{var s;(s=this.button)===null||s===void 0||s.removeAttribute("disabled")}}},{key:"createButton",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"";return $i("button","l7-button-control ".concat(i))}},{key:"onAdd",value:function(){this.button=this.createButton(),this.isDisable=!1;var i=this.controlOption,a=i.title,s=i.btnText,l=i.btnIcon;return this.setBtnTitle(a),this.setBtnText(s),this.setBtnIcon(l),this.button}},{key:"onRemove",value:function(){this.button=this.buttonIcon=this.buttonText=void 0,this.isDisable=!1}},{key:"setOptions",value:function(i){var a=i.title,s=i.btnText,l=i.btnIcon;this.checkUpdateOption(i,["title"])&&this.setBtnTitle(a),this.checkUpdateOption(i,["btnIcon"])&&this.setBtnIcon(l),this.checkUpdateOption(i,["btnText"])&&this.setBtnText(s),Ra((0,Ee.Z)(t.prototype),"setOptions",this).call(this,i)}},{key:"setBtnTitle",value:function(i){var a;(a=this.button)===null||a===void 0||a.setAttribute("title",i!=null?i:"")}},{key:"setBtnIcon",value:function(i){if(this.buttonIcon&&Ci(this.buttonIcon),i){var a,s=(a=this.button)===null||a===void 0?void 0:a.firstChild;if(s){var l;(l=this.button)===null||l===void 0||l.insertBefore(i,s)}else{var f;(f=this.button)===null||f===void 0||f.appendChild(i)}this.buttonIcon=i}}},{key:"setBtnText",value:function(i){if(this.button)if(mu(this.button,"l7-button-control--row"),mu(this.button,"l7-button-control--column"),i){var a=this.buttonText;if(!a){var s;a=$i("div","l7-button-control__text"),(s=this.button)===null||s===void 0||s.appendChild(a),this.buttonText=a}a.innerText=i,ou(this.button,this.controlOption.vertical?"l7-button-control--column":"l7-button-control--row")}else!i&&this.buttonText&&(Ci(this.buttonText),this.buttonText=void 0)}}]),t}(fv);function VT(e){var r=jT();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function jT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Yy=function(e){(0,Le.Z)(t,e);var r=VT(t);function t(n,i){var a;return(0,Q.Z)(this,t),a=r.call(this),(0,F.Z)((0,Re.Z)(a),"isShow",!1),(0,F.Z)((0,Re.Z)(a),"timeout",null),(0,F.Z)((0,Re.Z)(a),"show",function(){return a.isShow||!a.contentDOM.innerHTML||(a.resetPopperPosition(),mu(a.popperDOM,"l7-popper-hide"),a.isShow=!0,a.option.unique&&t.conflictPopperList.forEach(function(s){s!==(0,Re.Z)(a)&&s.isShow&&s.hide()}),a.emit("show"),window.addEventListener("pointerdown",a.onPopperUnClick)),(0,Re.Z)(a)}),(0,F.Z)((0,Re.Z)(a),"hide",function(){return a.isShow&&(ou(a.popperDOM,"l7-popper-hide"),a.isShow=!1,a.emit("hide"),window.removeEventListener("pointerdown",a.onPopperUnClick)),(0,Re.Z)(a)}),(0,F.Z)((0,Re.Z)(a),"setHideTimeout",function(){a.timeout||(a.timeout=window.setTimeout(function(){a.isShow&&(a.hide(),a.timeout=null)},300))}),(0,F.Z)((0,Re.Z)(a),"clearHideTimeout",function(){a.timeout&&(window.clearTimeout(a.timeout),a.timeout=null)}),(0,F.Z)((0,Re.Z)(a),"onBtnClick",function(){a.isShow?a.hide():a.show()}),(0,F.Z)((0,Re.Z)(a),"onPopperUnClick",function(s){Kc(s.target,[".l7-button-control",".l7-popper-content"])||a.hide()}),(0,F.Z)((0,Re.Z)(a),"onBtnMouseLeave",function(){a.setHideTimeout()}),(0,F.Z)((0,Re.Z)(a),"onBtnMouseMove",function(){a.clearHideTimeout(),!a.isShow&&a.show()}),a.button=n,a.option=i,a.init(),i.unique&&t.conflictPopperList.push((0,Re.Z)(a)),a}return(0,j.Z)(t,[{key:"buttonRect",get:function(){return this.button.getBoundingClientRect()}},{key:"getPopperDOM",value:function(){return this.popperDOM}},{key:"getIsShow",value:function(){return this.isShow}},{key:"getContent",value:function(){return this.content}},{key:"setContent",value:function(i){typeof i=="string"?this.contentDOM.innerHTML=i:i instanceof HTMLElement&&(Ml(this.contentDOM),this.contentDOM.appendChild(i)),this.content=i}},{key:"init",value:function(){var i=this.option.trigger;this.popperDOM=this.createPopper(),i==="click"?this.button.addEventListener("click",this.onBtnClick):(this.button.addEventListener("mousemove",this.onBtnMouseMove),this.button.addEventListener("mouseleave",this.onBtnMouseLeave),this.popperDOM.addEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.addEventListener("mouseleave",this.onBtnMouseLeave))}},{key:"destroy",value:function(){this.button.removeEventListener("click",this.onBtnClick),this.button.removeEventListener("mousemove",this.onBtnMouseMove),this.button.removeEventListener("mousemove",this.onBtnMouseLeave),this.popperDOM.removeEventListener("mousemove",this.onBtnMouseMove),this.popperDOM.removeEventListener("mouseleave",this.onBtnMouseLeave),Ci(this.popperDOM)}},{key:"resetPopperPosition",value:function(){var i={},a=this.option,s=a.container,l=a.offset,f=l===void 0?[0,0]:l,d=a.placement,y=(0,yn.Z)(f,2),b=y[0],T=y[1],M=this.button.getBoundingClientRect(),P=s.getBoundingClientRect(),k=qc(M,P),H=k.left,q=k.right,ae=k.top,Se=k.bottom,ze=!1,it=!1;/^(left|right)/.test(d)?(d.includes("left")?i.right="".concat(M.width+q,"px"):d.includes("right")&&(i.left="".concat(M.width+H,"px")),d.includes("start")?i.top="".concat(ae,"px"):d.includes("end")?i.bottom="".concat(Se,"px"):(i.top="".concat(ae+M.height/2,"px"),it=!0,i.transform="translate(".concat(b,"px, calc(").concat(T,"px - 50%))"))):/^(top|bottom)/.test(d)&&(d.includes("top")?i.bottom="".concat(M.height+Se,"px"):d.includes("bottom")&&(i.top="".concat(M.height+ae,"px")),d.includes("start")?i.left="".concat(H,"px"):d.includes("end")?i.right="".concat(q,"px"):(i.left="".concat(H+M.width/2,"px"),ze=!0,i.transform="translate(calc(".concat(b,"px - 50%), ").concat(T,"px)"))),i.transform="translate(calc(".concat(b,"px - ").concat(ze?"50%":"0%","), calc(").concat(T,"px - ").concat(it?"50%":"0%",")");var ut=d.split("-");ut.length&&ou(this.popperDOM,ut.map(function(ot){return"l7-popper-".concat(ot)}).join(" ")),xc(this.popperDOM,gh(i))}},{key:"createPopper",value:function(){var i=this.option,a=i.container,s=i.className,l=s===void 0?"":s,f=i.content,d=$i("div","l7-popper l7-popper-hide ".concat(l)),y=$i("div","l7-popper-content"),b=$i("div","l7-popper-arrow");return d.appendChild(y),d.appendChild(b),a.appendChild(d),this.popperDOM=d,this.contentDOM=y,f&&this.setContent(f),d}}]),t}(qa.EventEmitter);(0,F.Z)(Yy,"conflictPopperList",[]);function HT(e){var r=WT();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function WT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GT={topleft:"right-start",topcenter:"bottom",topright:"left-start",bottomleft:"right-end",bottomcenter:"top",bottomright:"left-end",lefttop:"bottom-start",leftcenter:"right",leftbottom:"top-start",righttop:"bottom-end",rightcenter:"left",rightbottom:"top-end"},XT=function(e){(0,Le.Z)(t,e);var r=HT(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getPopper",value:function(){return this.popper}},{key:"hide",value:function(){this.popper.hide(),Ra((0,Ee.Z)(t.prototype),"hide",this).call(this)}},{key:"getDefault",value:function(i){var a,s=Ra((0,Ee.Z)(t.prototype),"getDefault",this).call(this,i),l=(a=i==null?void 0:i.position)!==null&&a!==void 0?a:s.position;return(0,W.Z)((0,W.Z)({},Ra((0,Ee.Z)(t.prototype),"getDefault",this).call(this,i)),{},{popperPlacement:l instanceof Element?"bottom":GT[l],popperTrigger:"click"})}},{key:"onAdd",value:function(){var i=Ra((0,Ee.Z)(t.prototype),"onAdd",this).call(this);return this.initPopper(),i}},{key:"onRemove",value:function(){this.popper.destroy()}},{key:"initPopper",value:function(){var i=this,a=this.controlOption,s=a.popperClassName,l=a.popperPlacement,f=a.popperTrigger,d=this.mapsService.getMapContainer();return this.popper=new Yy(this.button,{className:s,placement:l,trigger:f,container:d,unique:!0}),this.popper.on("show",function(){i.emit("popperShow",i)}).on("hide",function(){i.emit("popperHide",i)}),this.popper}},{key:"setOptions",value:function(i){if(Ra((0,Ee.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["popperPlacement","popperTrigger","popperClassName"])){var a=this.popper.getContent();this.popper.destroy(),this.initPopper(),this.popper.setContent(a)}}}]),t}(Tg);function $T(e){var r=YT();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function YT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var xd=function(e){return e.ActiveOptionClassName="l7-select-control-item-active",e.OptionValueAttrKey="data-option-value",e.OptionIndexAttrKey="data-option-index",e}(xd||{}),qy=function(e){(0,Le.Z)(t,e);var r=$T(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"selectValue",[]),(0,F.Z)((0,Re.Z)(n),"createNormalOption",function(l){var f=n.selectValue.includes(l.value),d=$i("div","l7-select-control-item ".concat(f?xd.ActiveOptionClassName:""));n.getIsMultiple()?d.appendChild(n.createCheckbox(f)):d.appendChild(n.createRadio(f)),l.icon&&d.appendChild(l.icon);var y=$i("span");return y.innerText=l.text,d.appendChild(y),d}),(0,F.Z)((0,Re.Z)(n),"onItemClick",function(l){if(n.getIsMultiple()){var f=n.selectValue.findIndex(function(d){return d===l.value});f>-1?n.selectValue.splice(f,1):n.selectValue=[].concat((0,Jt.Z)(n.selectValue),[l.value])}else n.selectValue=[l.value];n.setSelectValue(n.selectValue)}),n}return(0,j.Z)(t,[{key:"setOptions",value:function(i){Ra((0,Ee.Z)(t.prototype),"setOptions",this).call(this,i);var a=i.options;a&&this.popper.setContent(this.getPopperContent(a))}},{key:"onAdd",value:function(){var i=Ra((0,Ee.Z)(t.prototype),"onAdd",this).call(this),a=this.controlOption.defaultValue;return a&&(this.selectValue=this.transSelectValue(a)),this.popper.setContent(this.getPopperContent(this.controlOption.options)),i}},{key:"getSelectValue",value:function(){return this.getIsMultiple()?this.selectValue:this.selectValue[0]}},{key:"setSelectValue",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!0,s=this.transSelectValue(i);this.optionDOMList.forEach(function(l){var f=l.getAttribute(xd.OptionValueAttrKey),d=l.querySelector("input[type=checkbox]"),y=l.querySelector("input[type=radio]"),b=s.includes(f),T=function(P,k){vh(l,xd.ActiveOptionClassName,k),P&&fa(P,k)};T(d,b),T(y,b)}),this.selectValue=s,a&&this.emit("selectChange",this.getIsMultiple()?s:s[0])}},{key:"getIsMultiple",value:function(){return!1}},{key:"getPopperContent",value:function(i){var a=this,s=this.isImageOptions(),l=$i("div",s?"l7-select-control--image":"l7-select-control--normal");this.getIsMultiple()&&ou(l,"l7-select-control--multiple");var f=i.map(function(d,y){var b=s?a.createImageOption(d):a.createNormalOption(d);return b.setAttribute(xd.OptionValueAttrKey,d.value),b.setAttribute(xd.OptionIndexAttrKey,window.String(y)),b.addEventListener("click",a.onItemClick.bind(a,d)),b});return l.append.apply(l,(0,Jt.Z)(f)),this.optionDOMList=f,l}},{key:"createImageOption",value:function(i){var a=this.selectValue.includes(i.value),s=$i("div","l7-select-control-item ".concat(a?xd.ActiveOptionClassName:"")),l=$i("img");l.setAttribute("src",i.img),op(l),s.appendChild(l);var f=$i("div","l7-select-control-item-row");this.getIsMultiple()&&s.appendChild(this.createCheckbox(a));var d=$i("span");return d.innerText=i.text,f.appendChild(d),s.appendChild(f),s}},{key:"createCheckbox",value:function(i){var a=$i("input");return a.setAttribute("type","checkbox"),i&&fa(a,!0),a}},{key:"createRadio",value:function(i){var a=$i("input");return a.setAttribute("type","radio"),i&&fa(a,!0),a}},{key:"isImageOptions",value:function(){return!!this.controlOption.options.find(function(i){return i.img})}},{key:"transSelectValue",value:function(i){return Array.isArray(i)?i:[i]}}]),t}(XT),Xh=function(r){var t=document.createElementNS("http://www.w3.org/2000/svg","svg");t.classList.add("l7-iconfont"),t.setAttribute("aria-hidden","true");var n=document.createElementNS("http://www.w3.org/2000/svg","use");return n.setAttributeNS("http://www.w3.org/1999/xlink","href","#".concat(r)),t.appendChild(n),t};function qT(e){var r=KT();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function KT(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QT=function(e){(0,Le.Z)(t,e);var r=qT(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"onClick",(0,Zt.Z)(_e().mark(function l(){var f;return _e().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(f=n.controlOption.onExport,y.t0=f==null,y.t0){y.next=8;break}return y.t1=f,y.next=6,n.getImage();case 6:y.t2=y.sent,(0,y.t1)(y.t2);case 8:case"end":return y.stop()}},l)}))),(0,F.Z)((0,Re.Z)(n),"mergeImage",(0,Zt.Z)(_e().mark(function l(){var f,d,y,b,T,M,P,k,H,q,ae,Se,ze,it,ut=arguments;return _e().wrap(function(Ct){for(;;)switch(Ct.prev=Ct.next){case 0:for(y=n.controlOption.imageType,b=(f=(d=n.mapsService.getContainer())===null||d===void 0?void 0:d.getBoundingClientRect())!==null&&f!==void 0?f:{},T=b.width,M=T===void 0?0:T,P=b.height,k=P===void 0?0:P,H=document.createElement("canvas"),H.width=M,H.height=k,q=H.getContext("2d"),ae=ut.length,Se=new Array(ae),ze=0;ze<ae;ze++)Se[ze]=ut[ze];return Ct.next=9,Promise.all(Se.map(function(Xt){return new Promise(function(Sr){var _r=new Image;_r.onload=function(){Sr(_r)},_r.src=Xt})}));case 9:return it=Ct.sent,it.forEach(function(Xt){q==null||q.drawImage(Xt,0,0,M,k)}),Ct.abrupt("return",H.toDataURL("image/".concat(y)));case 12:case"end":return Ct.stop()}},l)}))),n}return(0,j.Z)(t,[{key:"onAdd",value:function(){var i=Ra((0,Ee.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}},{key:"getDefault",value:function(i){return(0,W.Z)((0,W.Z)({},Ra((0,Ee.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5BFC\u51FA\u56FE\u7247",btnIcon:Xh("l7-icon-export-picture"),imageType:"png"})}},{key:"getImage",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l;return _e().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return d.next=2,this.mapsService.exportMap("png");case 2:return s=d.sent,d.next=5,this.scene.exportPng("png");case 5:return l=d.sent,d.abrupt("return",this.mergeImage.apply(this,(0,Jt.Z)([s,l].filter(function(y){return y}))));case 7:case"end":return d.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Tg);function JT(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=ew(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function ew(e,r){if(e){if(typeof e=="string")return Ky(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return Ky(e,r)}}function Ky(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var Qy=[["requestFullscreen","exitFullscreen","fullscreenElement","fullscreenEnabled","fullscreenchange","fullscreenerror"],["webkitRequestFullscreen","webkitExitFullscreen","webkitFullscreenElement","webkitFullscreenEnabled","webkitfullscreenchange","webkitfullscreenerror"],["webkitRequestFullScreen","webkitCancelFullScreen","webkitCurrentFullScreenElement","webkitCancelFullScreen","webkitfullscreenchange","webkitfullscreenerror"],["mozRequestFullScreen","mozCancelFullScreen","mozFullScreenElement","mozFullScreenEnabled","mozfullscreenchange","mozfullscreenerror"],["msRequestFullscreen","msExitFullscreen","msFullscreenElement","msFullscreenEnabled","MSFullscreenChange","MSFullscreenError"]],$h=function(){if(typeof document=="undefined")return!1;for(var e=Qy[0],r={},t=0,n=Qy;t<n.length;t++){var i=n[t],a=i==null?void 0:i[1];if(a in document){var s=JT(i.entries()),l;try{for(s.s();!(l=s.n()).done;){var f=(0,yn.Z)(l.value,2),d=f[0],y=f[1];r[e[d]]=y}}catch(b){s.e(b)}finally{s.f()}return r}}return!1}(),Jy={change:$h.fullscreenchange,error:$h.fullscreenerror},pc={request:function(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:document.documentElement,t=arguments.length>1?arguments[1]:void 0;return new Promise(function(n,i){var a=function l(){pc.off("change",l),n()};pc.on("change",a);var s=r[$h.requestFullscreen](t);s instanceof Promise&&s.then(a).catch(i)})},exit:function(){return new Promise(function(r,t){if(!pc.isFullscreen){r();return}var n=function a(){pc.off("change",a),r()};pc.on("change",n);var i=document[$h.exitFullscreen]();i instanceof Promise&&i.then(n).catch(t)})},toggle:function(r,t){return pc.isFullscreen?pc.exit():pc.request(r,t)},onchange:function(r){pc.on("change",r)},onerror:function(r){pc.on("error",r)},on:function(r,t){var n=Jy[r];n&&document.addEventListener(n,t,!1)},off:function(r,t){var n=Jy[r];n&&document.removeEventListener(n,t,!1)},raw:$h};Object.defineProperties(pc,{isFullscreen:{get:function(){return!!document[$h.fullscreenElement]}},element:{enumerable:!0,get:function(){var r;return(r=document[$h.fullscreenElement])!==null&&r!==void 0?r:void 0}},isEnabled:{enumerable:!0,get:function(){return!!document[$h.fullscreenEnabled]}}}),$h||(pc={isEnabled:!1});var F0=pc;function tw(e){var r=rw();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function rw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nw=function(e){(0,Le.Z)(t,e);var r=tw(t);function t(n){var i;return(0,Q.Z)(this,t),i=r.call(this,n),(0,F.Z)((0,Re.Z)(i),"isFullscreen",!1),(0,F.Z)((0,Re.Z)(i),"toggleFullscreen",(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!F0.isEnabled){l.next=3;break}return l.next=3,F0.toggle(i.mapContainer);case 3:case"end":return l.stop()}},a)}))),(0,F.Z)((0,Re.Z)(i),"onClick",function(){i.toggleFullscreen()}),(0,F.Z)((0,Re.Z)(i),"onFullscreenChange",function(){i.isFullscreen=!!document.fullscreenElement;var a=i.controlOption,s=a.btnText,l=a.btnIcon,f=a.title,d=a.exitBtnText,y=a.exitBtnIcon,b=a.exitTitle;i.isFullscreen?(i.setBtnTitle(b),i.setBtnText(d),i.setBtnIcon(y)):(i.setBtnTitle(f),i.setBtnText(s),i.setBtnIcon(l)),i.emit("fullscreenChange",i.isFullscreen)}),F0.isEnabled||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u5BF9\u5730\u56FE\u5168\u5C4F\u5316"),i}return(0,j.Z)(t,[{key:"setOptions",value:function(i){var a=i.exitBtnText,s=i.exitBtnIcon,l=i.exitTitle;this.isFullscreen&&(this.checkUpdateOption(i,["exitBtnIcon"])&&this.setBtnIcon(s),this.checkUpdateOption(i,["exitBtnText"])&&this.setBtnText(a),this.checkUpdateOption(i,["exitTitle"])&&this.setBtnTitle(l)),Ra((0,Ee.Z)(t.prototype),"setOptions",this).call(this,i)}},{key:"onAdd",value:function(){var i=Ra((0,Ee.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),this.mapContainer=Bs(this.scene.getSceneConfig().id),this.mapContainer.addEventListener("fullscreenchange",this.onFullscreenChange),i}},{key:"onRemove",value:function(){Ra((0,Ee.Z)(t.prototype),"onRemove",this).call(this),this.mapContainer.removeEventListener("fullscreenchange",this.onFullscreenChange)}},{key:"getDefault",value:function(i){return(0,W.Z)((0,W.Z)({},Ra((0,Ee.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5168\u5C4F",btnIcon:Xh("l7-icon-fullscreen"),exitTitle:"\u9000\u51FA\u5168\u5C4F",exitBtnIcon:Xh("l7-icon-exit-fullscreen")})}}]),t}(Tg);function iw(e){var r=aw();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function aw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var ow=function(e){(0,Le.Z)(t,e);var r=iw(t);function t(n){var i;return(0,Q.Z)(this,t),i=r.call(this,n),(0,F.Z)((0,Re.Z)(i),"getGeoLocation",function(){return new Promise(function(a,s){window.navigator.geolocation.getCurrentPosition(function(l){var f=l.coords,d=f!=null?f:{},y=d.longitude,b=d.latitude;!isNaN(y)&&!isNaN(b)?a([y,b]):s()},function(l){s(l)})})}),(0,F.Z)((0,Re.Z)(i),"onClick",(0,Zt.Z)(_e().mark(function a(){var s,l,f;return _e().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(window.navigator.geolocation){y.next=2;break}return y.abrupt("return");case 2:return s=i.controlOption.transform,y.next=5,i.getGeoLocation();case 5:if(l=y.sent,f=i.mapsService.getZoom(),y.t0=i.mapsService,y.t1=f>15?f:15,!s){y.next=15;break}return y.next=12,s(l);case 12:y.t2=y.sent,y.next=16;break;case 15:y.t2=l;case 16:y.t3=y.t2,y.t0.setZoomAndCenter.call(y.t0,y.t1,y.t3);case 18:case"end":return y.stop()}},a)}))),window.navigator.geolocation||console.warn("\u5F53\u524D\u6D4F\u89C8\u5668\u73AF\u5883\u4E0D\u652F\u6301\u83B7\u53D6\u5730\u7406\u5B9A\u4F4D"),i}return(0,j.Z)(t,[{key:"getDefault",value:function(i){return(0,W.Z)((0,W.Z)({},Ra((0,Ee.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5B9A\u4F4D",btnIcon:Xh("l7-icon-reposition")})}},{key:"onAdd",value:function(){var i=Ra((0,Ee.Z)(t.prototype),"onAdd",this).call(this);return i.addEventListener("click",this.onClick),i}}]),t}(Tg);function sw(e){var r=uw();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function uw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function e1(e){return Object.keys(e!=null?e:{}).every(function(r){return["layer","name","img"].includes(r)})}var t1=function(e){(0,Le.Z)(t,e);var r=sw(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"onLayerChange",function(){var l;(l=n.controlOption.layers)!==null&&l!==void 0&&l.length||(n.selectValue=n.getLayerVisible(),n.setOptions({options:n.getLayerOptions()}))}),(0,F.Z)((0,Re.Z)(n),"onLayerVisibleChane",function(){n.setSelectValue(n.getLayerVisible())}),(0,F.Z)((0,Re.Z)(n),"onSelectChange",function(){n.layers.forEach(function(l){var f=n.selectValue.includes(l.name),d=l.isVisible();f&&!d&&l.show(),!f&&d&&l.hide()})}),n}return(0,j.Z)(t,[{key:"layers",get:function(){var i=this.layerService,a=this.controlOption.layers;if(Array.isArray(a)&&a.length){var s=[];return a.forEach(function(l){if(l instanceof Object&&(e1(l)?s.push(l.layer):s.push(l)),typeof l=="string"){var f=i.getLayer(l)||i.getLayerByName(l);f&&s.push(f)}}),s}return i.getLayers()||[]}},{key:"getDefault",value:function(i){var a;return(0,W.Z)((0,W.Z)({},Ra((0,Ee.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u56FE\u5C42\u63A7\u5236",btnIcon:Xh("l7-icon-layer"),options:[],multiple:(a=i==null?void 0:i.multiple)!==null&&a!==void 0?a:!0})}},{key:"getLayerVisible",value:function(){return this.layers.filter(function(i){return i.isVisible()}).map(function(i){return i.name})}},{key:"getLayerOptions",value:function(){var i=this,a=this.controlOption.layers,s=a==null?void 0:a.every(function(l){return l.img});return a?a==null?void 0:a.map(function(l){if(e1(l))return{text:l.name||l.layer.name,value:l.layer.name,img:s?l.img:void 0};if(typeof l=="string"){var f=i.layerService.getLayer(l)||i.layerService.getLayerByName(l);return{text:f==null?void 0:f.name,value:f==null?void 0:f.name}}return{text:l.name,value:l.name}}):this.layers.map(function(l){return{text:l.name,value:l.name}})}},{key:"setOptions",value:function(i){var a=this.checkUpdateOption(i,["layers","multiple"]);Ra((0,Ee.Z)(t.prototype),"setOptions",this).call(this,i),a&&(this.controlOption.multiple===!1&&this.handleSingleSelectionMode(),this.selectValue=this.getLayerVisible(),this.controlOption.options=this.getLayerOptions(),this.popper.setContent(this.getPopperContent(this.controlOption.options)))}},{key:"handleSingleSelectionMode",value:function(){this.layers.forEach(function(i,a){a===0?i.show():i.hide()})}},{key:"onAdd",value:function(){var i;return this.controlOption.multiple===!1&&this.handleSingleSelectionMode(),(i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getLayerOptions()),this.controlOption.defaultValue||(this.controlOption.defaultValue=this.getLayerVisible()),this.on("selectChange",this.onSelectChange),this.layerService.on("layerChange",this.onLayerChange),Ra((0,Ee.Z)(t.prototype),"onAdd",this).call(this)}},{key:"onRemove",value:function(){this.off("selectChange",this.onSelectChange),this.layerService.off("layerChange",this.onLayerChange)}},{key:"getIsMultiple",value:function(){return this.controlOption.multiple}}]),t}(qy);function lw(e){var r=cw();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function cw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r1=function(e){(0,Le.Z)(t,e);var r=lw(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getDefault",value:function(){return{position:Cr.BOTTOMLEFT,name:"logo",href:"https://l7.antv.antgroup.com/",img:"https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*GRb1TKp4HcMAAAAAAAAAAAAAARQnAQ"}}},{key:"onAdd",value:function(){var i=$i("div","l7-control-logo");return this.setLogoContent(i),i}},{key:"onRemove",value:function(){return null}},{key:"setOptions",value:function(i){Ra((0,Ee.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["img","href"])&&(Ml(this.container),this.setLogoContent(this.container))}},{key:"setLogoContent",value:function(i){var a=this.controlOption,s=a.href,l=a.img,f=$i("img");if(f.setAttribute("src",l),f.setAttribute("aria-label","AntV logo"),op(f),s){var d=$i("a","l7-control-logo-link");d.target="_blank",d.href=s,d.rel="noopener nofollow",d.setAttribute("rel","noopener nofollow"),d.appendChild(f),i.appendChild(d)}else i.appendChild(f)}}]),t}(fv),fw={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*qdFDSbvIalgAAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u6708\u5149\u94F6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d-vcRLzu8WIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u5E7B\u5F71\u9ED1",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*HMbRTI3XnpIAAAAAAAAAAAAADmJ7AQ/original"},fresh:{text:"\u8349\u8272\u9752",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kqaGQ5kjSiAAAAAAAAAAAAAADmJ7AQ/original"},grey:{text:"\u96C5\u58EB\u7070",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*XegrTpZIbqAAAAAAAAAAAAAADmJ7AQ/original"},graffiti:{text:"\u6D82\u9E26",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*G5g9SZ_Jg4cAAAAAAAAAAAAADmJ7AQ/original"},macaron:{text:"\u9A6C\u5361\u9F99",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*irVvQbDpQMwAAAAAAAAAAAAADmJ7AQ/original"},darkblue:{text:"\u6781\u591C\u84DD",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*lKRzQYB4iR0AAAAAAAAAAAAADmJ7AQ/original"},wine:{text:"\u9171\u7C7D",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*orY0T7QL-lwAAAAAAAAAAAAADmJ7AQ/original"}},hw={normal:{text:"\u6807\u51C6",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*kIyZTok4Uk0AAAAAAAAAAAAADmJ7AQ/original"},light:{text:"\u4EAE",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*Z3JRQKDI-cIAAAAAAAAAAAAADmJ7AQ/original"},dark:{text:"\u6697",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*d7HCQbfmyaoAAAAAAAAAAAAADmJ7AQ/original"},satellite:{text:"\u536B\u661F",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*TytUT6pS9okAAAAAAAAAAAAADmJ7AQ/original"},outdoors:{text:"\u6237\u5916",img:"https://mdn.alipayobjects.com/huamei_qa8qxu/afts/img/A*hWwFSYJEFWsAAAAAAAAAAAAADmJ7AQ/original"}};function pw(e){var r=dw();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function dw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var vw=function(e){(0,Le.Z)(t,e);var r=pw(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"onMapThemeChange",function(){n.mapsService.setMapStyle(n.selectValue[0])}),n}return(0,j.Z)(t,[{key:"getDefault",value:function(i){return(0,W.Z)((0,W.Z)({},Ra((0,Ee.Z)(t.prototype),"getDefault",this).call(this,i)),{},{title:"\u5730\u56FE\u6837\u5F0F",btnIcon:Xh("l7-icon-color"),options:[]})}},{key:"getStyleOptions",value:function(){var i=this.mapsService.getType()==="mapbox"?hw:fw;return Object.entries(this.mapsService.getMapStyleConfig()).filter(function(a){var s=(0,yn.Z)(a,2),l=s[0],f=s[1];return typeof f=="string"&&l!=="blank"}).map(function(a){var s,l=(0,yn.Z)(a,2),f=l[0],d=l[1],y=(s=i[f])!==null&&s!==void 0?s:{},b=y.text,T=y.img;return{text:b!=null?b:f,value:d,img:T,key:f}})}},{key:"getMapStyle",value:function(){return this.mapsService.getMapStyle()}},{key:"onAdd",value:function(){var i,a=this;if((i=this.controlOption.options)!==null&&i!==void 0&&i.length||(this.controlOption.options=this.getStyleOptions()),this.controlOption.defaultValue){var s,l,f=this.controlOption.defaultValue;this.controlOption.defaultValue=(s=(l=this.controlOption.options.find(function(y){return y.key===f}))===null||l===void 0?void 0:l.value)!==null&&s!==void 0?s:f}else{var d=this.getMapStyle();d?this.controlOption.defaultValue=d:this.mapsService.map.once("styledata",function(){var y=a.mapsService.getMapStyle();a.controlOption.defaultValue=y,a.setSelectValue(y,!1)})}return this.on("selectChange",this.onMapThemeChange),Ra((0,Ee.Z)(t.prototype),"onAdd",this).call(this)}},{key:"getIsMultiple",value:function(){return!1}}]),t}(qy);function mw(e){var r=gw();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function gw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var _w=function(e){(0,Le.Z)(t,e);var r=mw(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"location",[0,0]),(0,F.Z)((0,Re.Z)(n),"onMouseMove",function(l){var f=n.location,d=l.lngLat||l.lnglat,y=n.controlOption.transform;d&&(f=[d.lng,d.lat]),n.location=f,y&&(f=y(f)),n.insertLocation2HTML(f),n.emit("locationChange",f)}),n}return(0,j.Z)(t,[{key:"getLocation",value:function(){return this.location}},{key:"getDefault",value:function(i){return(0,W.Z)((0,W.Z)({},Ra((0,Ee.Z)(t.prototype),"getDefault",this).call(this,i)),{},{position:Cr.BOTTOMLEFT,transform:function(s){var l=(0,yn.Z)(s,2),f=l[0],d=l[1];return[+(+f).toFixed(6),+(+d).toFixed(6)]}})}},{key:"onAdd",value:function(){var i=$i("div","l7-control-mouse-location");return i.innerHTML="&nbsp;",this.mapsService.on("mousemove",this.onMouseMove),i}},{key:"onRemove",value:function(){this.mapsService.off("mousemove",this.onMouseMove)}},{key:"insertLocation2HTML",value:function(i){this.container.innerText=i.join(", ")}}]),t}(fv);function yw(e){var r=xw();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function xw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bw=function(e){(0,Le.Z)(t,e);var r=yw(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"update",function(){var l=n.mapsService,f=n.controlOption.maxWidth,d=l.getSize()[1]/2,y=l.containerToLngLat([0,d]),b=l.containerToLngLat([f,d]),T=Kl([y.lng,y.lat],[b.lng,b.lat]);n.updateScales(T)}),n}return(0,j.Z)(t,[{key:"getDefault",value:function(i){return(0,W.Z)((0,W.Z)({},Ra((0,Ee.Z)(t.prototype),"getDefault",this).call(this,i)),{},{name:"scale",position:Cr.BOTTOMLEFT,maxWidth:100,metric:!0,updateWhenIdle:!1,imperial:!1,lockWidth:!0})}},{key:"onAdd",value:function(){var i="l7-control-scale",a=$i("div",i);this.resetScaleLines(a);var s=this.controlOption.updateWhenIdle;return this.mapsService.on(s?"moveend":"mapmove",this.update),this.mapsService.on(s?"zoomend":"zoomchange",this.update),a}},{key:"onRemove",value:function(){var i=this.controlOption.updateWhenIdle;this.mapsService.off(i?"zoomend":"zoomchange",this.update),this.mapsService.off(i?"moveend":"mapmove",this.update)}},{key:"setOptions",value:function(i){Ra((0,Ee.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["lockWidth","maxWidth","metric","updateWhenIdle","imperial"])&&this.resetScaleLines(this.container)}},{key:"updateScales",value:function(i){var a=this.controlOption,s=a.metric,l=a.imperial;s&&i&&this.updateMetric(i),l&&i&&this.updateImperial(i)}},{key:"resetScaleLines",value:function(i){Ml(i);var a=this.controlOption,s=a.metric,l=a.imperial,f=a.maxWidth,d=a.lockWidth;d&&xc(i,"width: ".concat(f,"px")),s&&(this.mScale=$i("div","l7-control-scale-line",i)),l&&(this.iScale=$i("div","l7-control-scale-line",i)),this.update()}},{key:"updateScale",value:function(i,a,s){var l=this.controlOption.maxWidth;i.style.width=Math.round(l*s)+"px",i.innerHTML=a}},{key:"getRoundNum",value:function(i){var a=Math.pow(10,(Math.floor(i)+"").length-1),s=i/a;return s=s>=10?10:s>=5?5:s>=3?3:s>=2?2:1,a*s}},{key:"updateMetric",value:function(i){var a=this.getRoundNum(i),s=a<1e3?a+" m":a/1e3+" km";this.updateScale(this.mScale,s,a/i)}},{key:"updateImperial",value:function(i){var a=i*3.2808399,s,l,f;a>5280?(s=a/5280,l=this.getRoundNum(s),this.updateScale(this.iScale,l+" mi",l/s)):(f=this.getRoundNum(a),this.updateScale(this.iScale,f+" ft",f/a))}}]),t}(fv),Cp,n1=(Cp={},(0,F.Z)(Cp,ff.additive,{enable:!0,func:{srcRGB:I.ONE,dstRGB:I.ONE,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(Cp,ff.none,{enable:!1}),(0,F.Z)(Cp,ff.normal,{enable:!0,func:{srcRGB:I.SRC_ALPHA,dstRGB:I.ONE_MINUS_SRC_ALPHA,srcAlpha:1,dstAlpha:1}}),(0,F.Z)(Cp,ff.subtractive,{enable:!0,func:{srcRGB:I.ONE,dstRGB:I.ONE,srcAlpha:I.ZERO,dstAlpha:I.ONE_MINUS_SRC_COLOR},equation:{rgb:I.FUNC_SUBTRACT,alpha:I.FUNC_SUBTRACT}}),(0,F.Z)(Cp,ff.max,{enable:!0,func:{srcRGB:I.ONE,dstRGB:I.ONE},equation:{rgb:I.MAX_EXT}}),(0,F.Z)(Cp,ff.min,{enable:!0,func:{srcRGB:I.ONE,dstRGB:I.ONE},equation:{rgb:I.MIN_EXT}}),Cp);function i1(e){return e.map(function(r){return typeof r=="string"&&(r=[r,{}]),r})}function a1(e,r,t,n){var i=e.multiPassRenderer,a=e.getLayerConfig(),s=a.enableTAA;return s?i.add(n("taa")):i.add(n("render")),i1(r).forEach(function(l){var f=(0,yn.Z)(l,2),d=f[0],y=f[1];i.add(t(d),y)}),i.add(t("copy")),i}var Ew=function(){function e(r){(0,Q.Z)(this,e),this.layer=r}return(0,j.Z)(e,[{key:"pickRender",value:function(t){var n=this.layer.getContainer(),i=n.get(Je.ILayerService),a=this.layer;if(a.tileLayer)return a.tileLayer.pickRender(t);a.hooks.beforePickingEncode.call(),i.renderTileLayerMask(a),a.renderModels({ispick:!0}),a.hooks.afterPickingEncode.call()}},{key:"pick",value:function(t,n){var i=this.layer.getContainer(),a=i.get(Je.IPickingService);return t.type==="RasterLayer"?this.pickRasterLayer(t,n):(this.pickRender(n),a.pickFromPickingFBO(t,n))}},{key:"pickRasterLayer",value:function(t,n,i){var a=this.layer.getContainer(),s=a.get(Je.IPickingService),l=a.get(Je.IMapService),f=this.layer.getSource().extent,d=Il(n.lngLat,f),y={x:n.x,y:n.y,type:n.type,lngLat:n.lngLat,target:n,rasterValue:null},b=i||t;if(d){var T=this.readRasterValue(t,f,l,n.x,n.y);return y.rasterValue=T,s.triggerHoverOnLayer(b,y),!0}else return y.type=n.type==="mousemove"?"mouseout":"un"+n.type,s.triggerHoverOnLayer(b,(0,W.Z)((0,W.Z)({},y),{},{type:"unpick"})),s.triggerHoverOnLayer(b,y),!1}},{key:"readRasterValue",value:function(t,n,i,a,s){var l=t.getSource().data.dataArray[0],f=(0,yn.Z)(n,4),d=f[0],y=d===void 0?0:d,b=f[1],T=b===void 0?0:b,M=f[2],P=M===void 0?10:M,k=f[3],H=k===void 0?-10:k,q=i.lngLatToContainer([y,T]),ae=i.lngLatToContainer([P,H]),Se=ae.x-q.x,ze=q.y-ae.y,it=[(a-q.x)/Se,(s-ae.y)/ze],ut=l.width||1,ot=l.height||1,Ct=Math.floor(it[0]*ut),Xt=Math.floor(it[1]*ot),Sr=Math.max(0,Xt-1)*ut+Ct,_r=l.data[Sr];return _r}},{key:"selectFeature",value:function(t){var n=this.layer,i=(0,yn.Z)(t,3),a=i[0],s=i[1],l=i[2];n.hooks.beforeSelect.call([a,s,l])}},{key:"highlightPickedFeature",value:function(t){var n=(0,yn.Z)(t,3),i=n[0],a=n[1],s=n[2];this.layer.hooks.beforeHighlight.call([i,a,s])}},{key:"getFeatureById",value:function(t){return this.layer.getSource().getFeatureById(t)}}]),e}(),Sw=function(){function e(r){(0,Q.Z)(this,e),this.layer=r;var t=this.layer.getContainer();this.rendererService=t.get(Je.IRendererService)}return(0,j.Z)(e,[{key:"getColorTexture",value:function(t,n){var i=this.getTextureKey(t,n);return this.key===i?this.colorTexture:(this.createColorTexture(t,n),this.key=i,this.colorTexture)}},{key:"createColorTexture",value:function(t,n){var i=this.rendererService.createTexture2D,a=this.getColorRampBar(t,n),s=i({data:new Uint8Array(a.data),width:a.width,height:a.height,flipY:!1});return this.colorTexture=s,s}},{key:"setColorTexture",value:function(t,n,i){this.key=this.getTextureKey(n,i),this.colorTexture=t}},{key:"destroy",value:function(){var t;(t=this.colorTexture)===null||t===void 0||t.destroy()}},{key:"getColorRampBar",value:function(t,n){switch(t.type){case"cat":return ns(t);case"quantize":return $o(t);case"custom":return Du(t,n);case"linear":return la(t,n);default:return zo(t)}}},{key:"getTextureKey",value:function(t,n){var i;return"".concat(t.colors.join("_"),"_").concat(t==null||(i=t.positions)===null||i===void 0?void 0:i.join("_"),"_").concat(t.type,"_").concat(n==null?void 0:n.join("_"))}}]),e}(),Aw=["passes"],Tw=["moduleName","vertexShader","fragmentShader","inject","triangulation","styleOption"],o1,N0,s1;function ww(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=Cw(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function Cw(e,r){if(e){if(typeof e=="string")return u1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return u1(e,r)}}function u1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function Rw(e){var r=Mw();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function Mw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var U0=ui.isEqual,l1=ui.isFunction,c1=ui.isNumber,Iu=ui.isObject,Iw=ui.isPlainObject,Pw=ui.isUndefined,f1=0,Rp=(o1=D0(Je.IGlobalConfigService),N0=function(e){(0,Le.Z)(t,e);var r=Rw(t);function t(){var n,i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return(0,Q.Z)(this,t),n=r.call(this),(0,F.Z)((0,Re.Z)(n),"id","".concat(f1++)),(0,F.Z)((0,Re.Z)(n),"name","".concat(f1)),(0,F.Z)((0,Re.Z)(n),"visible",!0),(0,F.Z)((0,Re.Z)(n),"zIndex",0),(0,F.Z)((0,Re.Z)(n),"inited",!1),(0,F.Z)((0,Re.Z)(n),"layerModelNeedUpdate",!1),(0,F.Z)((0,Re.Z)(n),"pickedFeatureID",null),(0,F.Z)((0,Re.Z)(n),"selectedFeatureID",null),(0,F.Z)((0,Re.Z)(n),"styleNeedUpdate",!1),(0,F.Z)((0,Re.Z)(n),"forceRender",!1),(0,F.Z)((0,Re.Z)(n),"clusterZoom",0),(0,F.Z)((0,Re.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json"}}}),(0,F.Z)((0,Re.Z)(n),"dataState",{dataSourceNeedUpdate:!1,dataMappingNeedUpdate:!1,filterNeedUpdate:!1,featureScaleNeedUpdate:!1,StyleAttrNeedUpdate:!1}),(0,F.Z)((0,Re.Z)(n),"hooks",{init:new hg,afterInit:new xf,beforeRender:new xf,beforeRenderData:new Qd,afterRender:new Ul,beforePickingEncode:new Ul,afterPickingEncode:new Ul,beforeHighlight:new Ul(["pickedColor"]),afterHighlight:new Ul,beforeSelect:new Ul(["pickedColor"]),afterSelect:new Ul,beforeDestroy:new Ul,afterDestroy:new Ul}),(0,F.Z)((0,Re.Z)(n),"models",[]),(0,F.Z)((0,Re.Z)(n),"startInit",!1),(0,F.Z)((0,Re.Z)(n),"layerChildren",[]),(0,F.Z)((0,Re.Z)(n),"masks",[]),ki((0,Re.Z)(n),"configService",s1,(0,Re.Z)(n)),(0,F.Z)((0,Re.Z)(n),"animateOptions",{enable:!1}),(0,F.Z)((0,Re.Z)(n),"currentPickId",null),(0,F.Z)((0,Re.Z)(n),"encodeStyleAttribute",{}),(0,F.Z)((0,Re.Z)(n),"enableShaderEncodeStyles",[]),(0,F.Z)((0,Re.Z)(n),"enableDataEncodeStyles",[]),(0,F.Z)((0,Re.Z)(n),"enablg",[]),(0,F.Z)((0,Re.Z)(n),"pendingStyleAttributes",[]),(0,F.Z)((0,Re.Z)(n),"scaleOptions",{}),(0,F.Z)((0,Re.Z)(n),"animateStatus",!1),(0,F.Z)((0,Re.Z)(n),"isDestroyed",!1),(0,F.Z)((0,Re.Z)(n),"uniformBuffers",[]),(0,F.Z)((0,Re.Z)(n),"encodeDataLength",0),(0,F.Z)((0,Re.Z)(n),"sourceEvent",function(){n.dataState.dataSourceNeedUpdate=!0;var a=n.getLayerConfig();a&&a.autoFit&&n.fitBounds(a.fitBoundsOptions);var s=n.layerSource.getSourceCfg().autoRender;s&&setTimeout(function(){n.reRender()},10)}),n.name=i.name||n.id,n.zIndex=i.zIndex||0,n.rawConfig=i,n}return(0,j.Z)(t,[{key:"addMask",value:function(i){this.masks.push(i),this.updateLayerConfig({maskLayers:this.masks}),this.enableMask()}},{key:"removeMask",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),this.updateLayerConfig({maskLayers:this.masks})}},{key:"disableMask",value:function(){this.updateLayerConfig({enableMask:!1})}},{key:"enableMask",value:function(){this.updateLayerConfig({enableMask:!0})}},{key:"addMaskLayer",value:function(i){this.masks.push(i)}},{key:"removeMaskLayer",value:function(i){var a=this.masks.indexOf(i);a>-1&&this.masks.splice(a,1),i.destroy()}},{key:"getAttribute",value:function(i){return this.styleAttributeService.getLayerStyleAttribute(i)}},{key:"getLayerConfig",value:function(){return this.configService.getLayerConfig(this.id)}},{key:"updateLayerConfig",value:function(i){var a=this;if(Object.keys(i).map(function(l){l in a.rawConfig&&(a.rawConfig[l]=i[l])}),!this.startInit)this.needUpdateConfig=(0,W.Z)((0,W.Z)({},this.needUpdateConfig),i);else{var s=this.container.get(Je.SceneID);this.configService.setLayerConfig(s,this.id,(0,W.Z)((0,W.Z)((0,W.Z)({},this.configService.getLayerConfig(this.id)),this.needUpdateConfig),i)),this.needUpdateConfig={}}}},{key:"setContainer",value:function(i,a){this.container=i,this.sceneContainer=a}},{key:"getContainer",value:function(){return this.container}},{key:"addPlugin",value:function(i){return this.plugins.push(i),this}},{key:"init",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s=this,l,f,d,y,b,T,M;return _e().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:l=this.container.get(Je.SceneID),this.startInit=!0,this.configService.setLayerConfig(l,this.id,this.rawConfig),this.layerType=this.rawConfig.layerType,this.iconService=this.container.get(Je.IIconService),this.fontService=this.container.get(Je.IFontService),this.rendererService=this.container.get(Je.IRendererService),this.layerService=this.container.get(Je.ILayerService),this.debugService=this.container.get(Je.IDebugService),this.interactionService=this.container.get(Je.IInteractionService),this.pickingService=this.container.get(Je.IPickingService),this.mapService=this.container.get(Je.IMapService),f=this.getLayerConfig(),d=f.enableMultiPassRenderer,y=f.passes,d&&y!==null&&y!==void 0&&y.length&&y.length>0&&this.mapService.on("mapAfterFrameChange",function(){s.renderLayers()}),this.cameraService=this.container.get(Je.ICameraService),this.coordinateService=this.container.get(Je.ICoordinateSystemService),this.shaderModuleService=this.container.get(Je.IShaderModuleService),this.postProcessingPassFactory=this.container.get(Je.IFactoryPostProcessingPass),this.normalPassFactory=this.container.get(Je.IFactoryNormalPass),this.styleAttributeService=this.container.get(Je.IStyleAttributeService),d&&(this.multiPassRenderer=this.container.get(Je.IMultiPassRenderer),this.multiPassRenderer.setLayer(this)),this.pendingStyleAttributes.forEach(function(H){var q=H.attributeName,ae=H.attributeField,Se=H.attributeValues,ze=H.updateOptions;s.styleAttributeService.updateStyleAttribute(q,{scale:(0,W.Z)({field:ae},s.splitValuesAndCallbackInAttribute(Se,ae?void 0:s.getLayerConfig()[q]))},ze)}),this.pendingStyleAttributes=[],this.plugins=this.container.getAll(Je.ILayerPlugin),b=ww(this.plugins);try{for(b.s();!(T=b.n()).done;)M=T.value,M.apply(this,{rendererService:this.rendererService,mapService:this.mapService,styleAttributeService:this.styleAttributeService,normalPassFactory:this.normalPassFactory,postProcessingPassFactory:this.postProcessingPassFactory})}catch(H){b.e(H)}finally{b.f()}return this.layerPickService=new Ew(this),this.textureService=new Sw(this),this.log(ks.LayerInitStart),k.next=31,this.hooks.init.promise();case 31:this.log(ks.LayerInitEnd),this.inited=!0,this.emit("inited",{target:this,type:"inited"}),this.emit("add",{target:this,type:"add"}),this.hooks.afterInit.call();case 36:case"end":return k.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"log",value:function(i){var a,s=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"init";if(!(this.tileLayer||this.isTileLayer)){var l="".concat(this.id,".").concat(s,".").concat(i),f={id:this.id,type:this.type};(a=this.debugService)===null||a===void 0||a.log(l,f)}}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models.map(function(a){a.updateAttributesAndElements(i.attributes,i.elements)}):console.warn("data error")}},{key:"setLayerPickService",value:function(i){this.layerPickService=i}},{key:"prepareBuildModel",value:function(){Object.keys(this.needUpdateConfig||{}).length!==0&&this.updateLayerConfig({});var i=this.getLayerConfig(),a=i.animateOption;a!=null&&a.enable&&(this.layerService.startAnimate(),this.animateStatus=!0)}},{key:"color",value:function(i,a,s){return this.updateStyleAttribute("color",i,a,s),this}},{key:"texture",value:function(i,a,s){return this.updateStyleAttribute("texture",i,a,s),this}},{key:"rotate",value:function(i,a,s){return this.updateStyleAttribute("rotate",i,a,s),this}},{key:"size",value:function(i,a,s){return this.updateStyleAttribute("size",i,a,s),this}},{key:"filter",value:function(i,a,s){var l=this.updateStyleAttribute("filter",i,a,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"shape",value:function(i,a,s){this.shapeOption={field:i,values:a};var l=this.updateStyleAttribute("shape",i,a,s);return this.dataState.dataSourceNeedUpdate=l&&this.inited,this}},{key:"label",value:function(i,a,s){return this.pendingStyleAttributes.push({attributeName:"label",attributeField:i,attributeValues:a,updateOptions:s}),this}},{key:"animate",value:function(i){var a={};return Iu(i)?(a.enable=!0,a=(0,W.Z)((0,W.Z)({},a),i)):a.enable=i,this.updateLayerConfig({animateOption:a}),this}},{key:"source",value:function(i,a){return(i==null?void 0:i.type)==="source"?(this.setSource(i),this):(this.sourceOption={data:i,options:a},this.clusterZoom=0,this)}},{key:"setData",value:function(i,a){var s=this;return this.inited?(this.log(ks.SourceInitStart,Qo.UPDATE),this.layerSource.setData(i,a),this.log(ks.SourceInitEnd,Qo.UPDATE)):this.on("inited",function(){s.log(ks.SourceInitStart,Qo.UPDATE);var l=s.getSource();l?s.layerSource.setData(i,a):s.source(new $y(i,a)),s.layerSource.once("update",function(){s.log(ks.SourceInitEnd,Qo.UPDATE)})}),this}},{key:"style",value:function(i){var a=this,s=i.passes,l=(0,Ea.Z)(i,Aw);s&&i1(s).forEach(function(d){var y=a.multiPassRenderer.getPostProcessor().getPostProcessingPassByName(d[0]);y&&y.updateOptions(d[1])}),l.borderColor&&(l.stroke=l.borderColor),l.borderWidth&&(l.strokeWidth=l.borderWidth);var f=l;return Object.keys(l).forEach(function(d){var y=l[d];Array.isArray(y)&&y.length===2&&!c1(y[0])&&!c1(y[1])&&(f[d]={field:y[0],value:y[1]})}),this.encodeStyle(f),this.updateLayerConfig(f),this}},{key:"encodeStyle",value:function(i){var a=this;Object.keys(i).forEach(function(s){[].concat((0,Jt.Z)(a.enableShaderEncodeStyles),(0,Jt.Z)(a.enableDataEncodeStyles)).includes(s)&&Iw(i[s])&&(i[s].field||i[s].value)&&!U0(a.encodeStyleAttribute[s],i[s])?(a.encodeStyleAttribute[s]=i[s],a.updateStyleAttribute(s,i[s].field,i[s].value),a.inited&&(a.dataState.dataMappingNeedUpdate=!0)):a.encodeStyleAttribute[s]&&(delete a.encodeStyleAttribute[s],a.dataState.dataSourceNeedUpdate=!0)})}},{key:"scale",value:function(i,a){var s=(0,W.Z)({},this.scaleOptions);if(Iu(i)?this.scaleOptions=(0,W.Z)((0,W.Z)({},this.scaleOptions),i):this.scaleOptions[i]=a,this.styleAttributeService&&!U0(s,this.scaleOptions)){var l=Iu(i)?i:(0,F.Z)({},i,a);this.styleAttributeService.updateScaleAttribute(l)}return this}},{key:"renderLayers",value:function(){this.rendering=!0,this.layerService.reRender(),this.rendering=!1}},{key:"prerender",value:function(){}},{key:"render",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.tileLayer?(this.tileLayer.render(),this):(this.layerService.beforeRenderData(this),this.encodeDataLength<=0&&!this.forceRender?this:(this.renderModels(i),this))}},{key:"renderMultiPass",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:if(!(this.encodeDataLength<=0&&!this.forceRender)){l.next=2;break}return l.abrupt("return");case 2:if(!(this.multiPassRenderer&&this.multiPassRenderer.getRenderFlag())){l.next=7;break}return l.next=5,this.multiPassRenderer.render();case 5:l.next=8;break;case 7:this.multiPassRenderer?this.renderModels():this.renderModels();case 8:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"active",value:function(i){var a={};return a.enableHighlight=Iu(i)?!0:i,Iu(i)?(a.enableHighlight=!0,i.color&&(a.highlightColor=i.color),i.mix&&(a.activeMix=i.mix)):a.enableHighlight=!!i,this.updateLayerConfig(a),this}},{key:"setActive",value:function(i,a){var s=this;if(Iu(i)){var l=i.x,f=l===void 0?0:l,d=i.y,y=d===void 0?0:d;this.updateLayerConfig({highlightColor:Iu(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Iu(a)?a.mix:this.getLayerConfig().activeMix}),this.pick({x:f,y})}else this.updateLayerConfig({pickedFeatureID:i,highlightColor:Iu(a)?a.color:this.getLayerConfig().highlightColor,activeMix:Iu(a)?a.mix:this.getLayerConfig().activeMix}),this.hooks.beforeHighlight.call(na(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"select",value:function(i){var a={};return a.enableSelect=Iu(i)?!0:i,Iu(i)?(a.enableSelect=!0,i.color&&(a.selectColor=i.color),i.mix&&(a.selectMix=i.mix)):a.enableSelect=!!i,this.updateLayerConfig(a),this}},{key:"setSelect",value:function(i,a){var s=this;if(Iu(i)){var l=i.x,f=l===void 0?0:l,d=i.y,y=d===void 0?0:d;this.updateLayerConfig({selectColor:Iu(a)?a.color:this.getLayerConfig().selectColor,selectMix:Iu(a)?a.mix:this.getLayerConfig().selectMix}),this.pick({x:f,y})}else this.updateLayerConfig({pickedFeatureID:i,selectColor:Iu(a)?a.color:this.getLayerConfig().selectColor,selectMix:Iu(a)?a.mix:this.getLayerConfig().selectMix}),this.hooks.beforeSelect.call(na(i)).then(function(){setTimeout(function(){s.reRender()},1)})}},{key:"setBlend",value:function(i){return this.updateLayerConfig({blend:i}),this.reRender(),this}},{key:"show",value:function(){return this.updateLayerConfig({visible:!0}),this.reRender(),this.emit("show"),this}},{key:"hide",value:function(){return this.updateLayerConfig({visible:!1}),this.reRender(),this.emit("hide"),this}},{key:"setIndex",value:function(i){return this.zIndex=i,this.layerService.updateLayerRenderList(),this.layerService.renderLayers(),this}},{key:"setCurrentPickId",value:function(i){this.currentPickId=i}},{key:"getCurrentPickId",value:function(){return this.currentPickId}},{key:"setCurrentSelectedId",value:function(i){this.selectedFeatureID=i}},{key:"getCurrentSelectedId",value:function(){return this.selectedFeatureID}},{key:"isVisible",value:function(){var i=this.mapService.getZoom(),a=this.getLayerConfig(),s=a.visible,l=a.minZoom,f=l===void 0?-1/0:l,d=a.maxZoom,y=d===void 0?1/0:d;return!!s&&i>=f&&i<y}},{key:"setMultiPass",value:function(i,a){if(this.updateLayerConfig({enableMultiPassRenderer:i}),a&&this.updateLayerConfig({passes:a}),i){var s=this.getLayerConfig(),l=s.passes,f=l===void 0?[]:l;this.multiPassRenderer=a1(this,f,this.postProcessingPassFactory,this.normalPassFactory),this.multiPassRenderer.setRenderFlag(!0);var d=this.rendererService.getViewportSize(),y=d.width,b=d.height;this.multiPassRenderer.resize(y,b)}return this}},{key:"setMinZoom",value:function(i){return this.updateLayerConfig({minZoom:i}),this}},{key:"getMinZoom",value:function(){var i=this.getLayerConfig(),a=i.minZoom;return a}},{key:"getMaxZoom",value:function(){var i=this.getLayerConfig(),a=i.maxZoom;return a}},{key:"get",value:function(i){var a=this.getLayerConfig();return a[i]}},{key:"setMaxZoom",value:function(i){return this.updateLayerConfig({maxZoom:i}),this}},{key:"setAutoFit",value:function(i){return this.updateLayerConfig({autoFit:i}),this}},{key:"fitBounds",value:function(i){if(!this.inited)return this.updateLayerConfig({autoFit:!0}),this;var a=this.getSource(),s=a.extent,l=s.some(function(f){return Math.abs(f)===1/0});return l?this:(this.mapService.fitBounds([[s[0],s[1]],[s[2],s[3]]],i),this)}},{key:"destroy",value:function(){var i,a,s,l,f,d=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;if(!this.isDestroyed){(i=this.layerModel)===null||i===void 0||i.uniformBuffers.forEach(function(T){T.destroy()}),this.layerChildren.map(function(T){return T.destroy(!1)}),this.layerChildren=[];var y=this.getLayerConfig(),b=y.maskfence;b&&(this.masks.map(function(T){return T.destroy(!1)}),this.masks=[]),this.hooks.beforeDestroy.call(),this.layerSource.off("update",this.sourceEvent),(a=this.multiPassRenderer)===null||a===void 0||a.destroy(),this.textureService.destroy(),this.styleAttributeService.clearAllAttributes(),this.hooks.afterDestroy.call(),(s=this.layerModel)===null||s===void 0||s.clearModels(d),(l=this.tileLayer)===null||l===void 0||l.destroy(),this.models=[],(f=this.debugService)===null||f===void 0||f.removeLog(this.id),this.emit("remove",{target:this,type:"remove"}),this.emit("destroy",{target:this,type:"destroy"}),this.removeAllListeners(),this.isDestroyed=!0}}},{key:"clear",value:function(){this.styleAttributeService.clearAllAttributes()}},{key:"clearModels",value:function(){var i;this.models.forEach(function(a){return a.destroy()}),(i=this.layerModel)===null||i===void 0||i.clearModels(),this.models=[]}},{key:"isDirty",value:function(){return!!(this.styleAttributeService.getLayerStyleAttributes()||[]).filter(function(i){return i.needRescale||i.needRemapping||i.needRegenerateVertices}).length}},{key:"setSource",value:function(i){var a=this;if(this.layerSource&&this.layerSource.off("update",this.sourceEvent),this.layerSource=i,this.clusterZoom=0,this.inited&&this.layerSource.cluster){var s=this.mapService.getZoom();this.layerSource.updateClusterData(s)}this.layerSource.inited&&this.sourceEvent(),this.layerSource.on("update",function(l){var f=l.type;if(a.coordCenter===void 0){var d,y=a.layerSource.center;a.coordCenter=y,(d=a.mapService)!==null&&d!==void 0&&d.setCoordCenter&&a.mapService.setCoordCenter(y)}if(f==="update"){if(a.tileLayer){a.tileLayer.reload();return}a.sourceEvent()}})}},{key:"getSource",value:function(){return this.layerSource}},{key:"getScaleOptions",value:function(){return this.scaleOptions}},{key:"setEncodedData",value:function(i){this.encodedData=i,this.encodeDataLength=i.length}},{key:"getEncodedData",value:function(){return this.encodedData}},{key:"getScale",value:function(i){return this.styleAttributeService.getLayerAttributeScale(i)}},{key:"getLegend",value:function(i){var a,s,l,f=this.styleAttributeService.getLayerStyleAttribute(i),d=(f==null||(a=f.scale)===null||a===void 0?void 0:a.scalers)||[];return{type:(s=d[0].option)===null||s===void 0?void 0:s.type,field:f==null||(l=f.scale)===null||l===void 0?void 0:l.field,items:this.getLegendItems(i)}}},{key:"getLegendItems",value:function(i){var a=this.styleAttributeService.getLayerAttributeScale(i);if(!a)return[];if(a.invertExtent){var s=a.range().map(function(d){return(0,F.Z)({value:a.invertExtent(d)},i,d)});return s}else if(a.ticks){var l=a.ticks().map(function(d){return(0,F.Z)({value:d},i,a(d))});return l}else if(a!=null&&a.domain){var f=a.domain().filter(function(d){return!Pw(d)}).map(function(d){return(0,F.Z)({value:d},i,a(d))});return f}return[]}},{key:"pick",value:function(i){var a=i.x,s=i.y;this.interactionService.triggerHover({x:a,y:s})}},{key:"boxSelect",value:function(i,a){this.pickingService.boxPickLayer(this,i,a)}},{key:"buildLayerModel",value:function(){var n=(0,Zt.Z)(_e().mark(function a(s){var l=this,f,d,y,b,T,M,P,k,H,q,ae,Se;return _e().wrap(function(it){for(;;)switch(it.prev=it.next){case 0:return f=s.moduleName,d=s.vertexShader,y=s.fragmentShader,b=s.inject,T=s.triangulation,M=s.styleOption,P=(0,Ea.Z)(s,Tw),this.shaderModuleService.registerModule(f,{vs:d,fs:y,inject:b}),k=this.shaderModuleService.getModule(f),H=k.vs,q=k.fs,ae=k.uniforms,Se=this.rendererService.createModel,it.abrupt("return",new Promise(function(ut){var ot=l.styleAttributeService.createAttributesAndIndices(l.encodedData,T,M),Ct=ot.attributes,Xt=ot.elements,Sr=ot.count,_r=(0,W.Z)({attributes:Ct,uniforms:ae,fs:q,vs:H,elements:Xt,blend:n1[ff.normal],uniformBuffers:[].concat((0,Jt.Z)(l.layerModel.uniformBuffers),(0,Jt.Z)(l.rendererService.uniformBuffers),[l.getLayerUniformBuffer(),l.getPickingUniformBuffer()]),textures:l.layerModel.textures},P);Sr&&(_r.count=Sr);var Wr=Se(_r);ut(Wr)}));case 5:case"end":return it.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"createAttributes",value:function(i){var a=i.triangulation,s=this.styleAttributeService.createAttributes(this.encodedData,a),l=s.attributes;return l}},{key:"getTime",value:function(){return this.layerService.clock.getDelta()}},{key:"setAnimateStartTime",value:function(){this.animateStartTime=this.layerService.clock.getElapsedTime()}},{key:"stopAnimate",value:function(){this.animateStatus&&(this.layerService.stopAnimate(),this.animateStatus=!1,this.updateLayerConfig({animateOption:{enable:!1}}))}},{key:"getLayerAnimateTime",value:function(){return this.layerService.clock.getElapsedTime()-this.animateStartTime}},{key:"needPick",value:function(i){var a=this.getLayerConfig(),s=a.enableHighlight,l=s===void 0?!0:s,f=a.enableSelect,d=f===void 0?!0:f,y=this.eventNames().indexOf(i)!==-1||this.eventNames().indexOf("un"+i)!==-1;return(i==="click"||i==="dblclick")&&d&&(y=!0),i==="mousemove"&&(l||this.eventNames().indexOf("mouseenter")!==-1||this.eventNames().indexOf("unmousemove")!==-1||this.eventNames().indexOf("mouseout")!==-1)&&(y=!0),this.isVisible()&&y}},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return l.stop()}},a)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"renderMulPass",value:function(){var n=(0,Zt.Z)(_e().mark(function a(s){return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,s.render();case 2:case"end":return f.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return this.encodeDataLength<=0&&!this.forceRender?(this.clearModels(),this):(this.hooks.beforeRender.call(),this.models.forEach(function(s){s.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a),textures:i.layerModel.textures},(a==null?void 0:a.ispick)||!1)}),this.hooks.afterRender.call(),this)}},{key:"updateStyleAttribute",value:function(i,a,s,l){var f=this.configService.getAttributeConfig(this.id)||{};return U0(f[i],{field:a,values:s})?!1:(["color","size","texture","rotate","filter","label","shape"].indexOf(i)!==-1&&this.configService.setAttributeConfig(this.id,(0,F.Z)({},i,{field:a,values:s})),this.startInit?this.styleAttributeService.updateStyleAttribute(i,{scale:(0,W.Z)({field:a},this.splitValuesAndCallbackInAttribute(s,this.getLayerConfig()[a]))},l):this.pendingStyleAttributes.push({attributeName:i,attributeField:a,attributeValues:s,updateOptions:l}),!0)}},{key:"getLayerAttributeConfig",value:function(){return this.configService.getAttributeConfig(this.id)}},{key:"getShaderPickStat",value:function(){return this.layerService.getShaderPickStat()}},{key:"setEarthTime",value:function(i){console.warn("empty fn")}},{key:"processData",value:function(i){return i}},{key:"getModelType",value:function(){throw new Error("Method not implemented.")}},{key:"getDefaultConfig",value:function(){return{}}},{key:"initLayerModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l;return _e().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return this.models.forEach(function(y){return y.destroy()}),this.models=[],this.uniformBuffers.forEach(function(y){y.destroy()}),this.uniformBuffers=[],s=this.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0}),this.uniformBuffers.push(s),l=this.rendererService.createBuffer({data:new Float32Array(20).fill(0),isUBO:!0}),this.uniformBuffers.push(l),d.next=10,this.layerModel.initModels();case 10:this.models=d.sent;case 11:case"end":return d.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getLayerUniformBuffer",value:function(){return this.uniformBuffers[0]}},{key:"getPickingUniformBuffer",value:function(){return this.uniformBuffers[1]}},{key:"reRender",value:function(){this.inited&&this.layerService.reRender()}},{key:"splitValuesAndCallbackInAttribute",value:function(i){return{values:l1(i)?void 0:i,callback:l1(i)?i:void 0}}}]),t}(qa.EventEmitter),s1=Pi(N0.prototype,"configService",[o1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),N0);function Ow(e,r){return{enable:e,mask:255,func:{cmp:I.EQUAL,ref:r?1:0,mask:1}}}function h1(e){return e.maskOperation===rd.OR?{enable:!0,mask:255,func:{cmp:I.ALWAYS,ref:1,mask:255},opFront:{fail:I.KEEP,zfail:I.REPLACE,zpass:I.REPLACE}}:{enable:!0,mask:255,func:{cmp:e.stencilType===Kf.SINGLE||e.stencilIndex===0?I.ALWAYS:I.LESS,ref:e.stencilType===Kf.SINGLE?1:e.stencilIndex===0?2:1,mask:255},opFront:{fail:I.KEEP,zfail:I.REPLACE,zpass:I.REPLACE}}}var qn=function(e){return e[e.POSITION=0]="POSITION",e[e.COLOR=1]="COLOR",e[e.VERTEX_ID=2]="VERTEX_ID",e[e.PICKING_COLOR=3]="PICKING_COLOR",e[e.STROKE=4]="STROKE",e[e.OPACITY=5]="OPACITY",e[e.OFFSETS=6]="OFFSETS",e[e.ROTATION=7]="ROTATION",e[e.EXTRUSION_BASE=8]="EXTRUSION_BASE",e[e.SIZE=9]="SIZE",e[e.SHAPE=10]="SHAPE",e[e.EXTRUDE=11]="EXTRUDE",e[e.MAX=12]="MAX",e[e.NORMAL=13]="NORMAL",e[e.UV=14]="UV",e[e.LINEAR=15]="LINEAR",e}({});function kw(e){switch(e){case"rotation":return{name:"Rotation",type:Mn.Attribute,descriptor:{name:"a_Rotation",shaderLocation:qn.ROTATION,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(t){var n=t.rotation,i=n===void 0?0:n;return Array.isArray(i)?[i[0]]:[i]}}};case"stroke":return{name:"stroke",type:Mn.Attribute,descriptor:{name:"a_Stroke",shaderLocation:qn.STROKE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:4,update:function(t){var n=t.stroke,i=n===void 0?[1,1,1,1]:n;return i}}};case"opacity":return{name:"opacity",type:Mn.Attribute,descriptor:{name:"a_Opacity",shaderLocation:qn.OPACITY,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(t){var n=t.opacity,i=n===void 0?1:n;return[i]}}};case"extrusionBase":return{name:"extrusionBase",type:Mn.Attribute,descriptor:{name:"a_ExtrusionBase",shaderLocation:qn.EXTRUSION_BASE,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(t){var n=t.extrusionBase,i=n===void 0?0:n;return[i]}}};case"offsets":return{name:"offsets",type:Mn.Attribute,descriptor:{name:"a_Offsets",shaderLocation:qn.OFFSETS,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(t){var n=t.offsets;return n}}};case"thetaOffset":return{name:"thetaOffset",type:Mn.Attribute,descriptor:{name:"a_ThetaOffset",shaderLocation:15,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(t){var n=t.thetaOffset,i=n===void 0?1:n;return[i]}}};default:return}}var Dw={opacity:1,stroke:[1,0,0,1],offsets:[0,0],rotation:0,extrusionBase:0,strokeOpacity:1,thetaOffset:.314},wg={opacity:"float",stroke:"vec4",offsets:"vec2",textOffset:"vec2",rotation:"float",extrusionBase:"float",strokeOpacity:"float",thetaOffset:"float"};function qB(e){var r="";return Object.keys(e).forEach(function(t){var n=e[t];Array.isArray(n)?r+="vec".concat(n.length," ").concat(t,`;
`):r+="flot ".concat(t,`;
`)}),r}function p1(e){return Math.max(Math.ceil(e/4)*4,4)}var d1,z0,v1,Z0={opacity:qn.OPACITY,stroke:qn.STROKE,offsets:qn.OFFSETS,rotation:qn.ROTATION,extrusionBase:qn.EXTRUSION_BASE,thetaOffset:15},Na=(d1=D0(Je.IGlobalConfigService),z0=function(){function e(r){(0,Q.Z)(this,e),(0,F.Z)(this,"uniformBuffers",[]),(0,F.Z)(this,"textures",[]),(0,F.Z)(this,"preStyleAttribute",{}),(0,F.Z)(this,"encodeStyleAttribute",{}),ki(this,"configService",v1,this),this.layer=r,this.rendererService=r.getContainer().get(Je.IRendererService),this.pickingService=r.getContainer().get(Je.IPickingService),this.shaderModuleService=r.getContainer().get(Je.IShaderModuleService),this.styleAttributeService=r.getContainer().get(Je.IStyleAttributeService),this.mapService=r.getContainer().get(Je.IMapService),this.iconService=r.getContainer().get(Je.IIconService),this.fontService=r.getContainer().get(Je.IFontService),this.cameraService=r.getContainer().get(Je.ICameraService),this.layerService=r.getContainer().get(Je.ILayerService),this.registerStyleAttribute(),this.registerBuiltinAttributes(),this.startModelAnimate();var t=this.rendererService.createTexture2D;this.createTexture2D=t}return(0,j.Z)(e,[{key:"getBlend",value:function(){var t=this.layer.getLayerConfig(),n=t.blend,i=n===void 0?"normal":n;return n1[ff[i]]}},{key:"getStencil",value:function(t){var n=this.layer.getLayerConfig(),i=n.mask,a=i===void 0?!1:i,s=n.maskInside,l=s===void 0?!0:s,f=n.enableMask,d=n.maskOperation,y=d===void 0?rd.AND:d;if(this.layer.type==="MaskLayer")return h1({isStencil:!0,stencilType:Kf.SINGLE});if(t.isStencil)return h1((0,W.Z)((0,W.Z)({},t),{},{maskOperation:y}));var b=a||f&&this.layer.masks.length!==0||this.layer.tileMask!==void 0;return Ow(b,l)}},{key:"getDefaultStyle",value:function(){return{}}},{key:"getUninforms",value:function(){var t=this.getCommonUniformsInfo(),n=this.getUniformsBufferInfo(this.getStyleAttribute());this.updateStyleUnifoms();var i=(0,W.Z)((0,W.Z)({},n.uniformsOption),t.uniformsOption);return!this.rendererService.hasOwnProperty("device")&&this.textures&&this.textures.length===1&&(i.u_texture=this.textures[0]),i}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"needUpdate",value:function(){var r=(0,Zt.Z)(_e().mark(function n(){return _e().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.abrupt("return",!1);case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"buildModels",value:function(){var r=(0,Zt.Z)(_e().mark(function n(){return _e().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"initModels",value:function(){var r=(0,Zt.Z)(_e().mark(function n(){return _e().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:throw new Error("Method not implemented.");case 1:case"end":return a.stop()}},n)}));function t(){return r.apply(this,arguments)}return t}()},{key:"clearModels",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0}},{key:"getAttribute",value:function(){throw new Error("Method not implemented.")}},{key:"prerender",value:function(){}},{key:"render",value:function(t){throw new Error("Method not implemented.")}},{key:"registerBuiltinAttributes",value:function(){throw new Error("Method not implemented.")}},{key:"animateOption2Array",value:function(t){return[t.enable?0:1,t.duration||4,t.interval||.2,t.trailLength||.1]}},{key:"startModelAnimate",value:function(){var t=this.layer.getLayerConfig(),n=t.animateOption;n.enable&&this.layer.setAnimateStartTime()}},{key:"getInject",value:function(){var t=this.layer.encodeStyleAttribute,n="",i=[];this.layer.enableShaderEncodeStyles.forEach(function(l){t[l]?n+="#define USE_ATTRIBUTE_".concat(l.toUpperCase(),` 0.0; 

`):i.push("  ".concat(wg[l]," u_").concat(l,";"));var f=Z0[l];!f&&l==="THETA_OFFSET"&&(f=15),n+=`
          #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
          layout(location = `).concat(Z0[l],") in ").concat(wg[l]," a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
        #endif

        `)});var a=i.length?`
layout(std140) uniform AttributeUniforms {
`.concat(i.join(`
`),`
};
    `):"";n+=a;var s="";return this.layer.enableShaderEncodeStyles.forEach(function(l){s+=`

    #ifdef USE_ATTRIBUTE_`.concat(l.toUpperCase(),`
      `).concat(wg[l]," ").concat(l,"  = a_").concat(l.charAt(0).toUpperCase()+l.slice(1),`;
    #else
      `).concat(wg[l]," ").concat(l," = u_").concat(l,`;
    #endif

    `)}),{"vs:#decl":n,"fs:#decl":a,"vs:#main-start":s}}},{key:"getStyleAttribute",value:function(){var t=this,n={};return this.layer.enableShaderEncodeStyles.forEach(function(i){if(!t.layer.encodeStyleAttribute[i]){var a=t.layer.getLayerConfig()[i],s=typeof a=="undefined"?Dw[i]:a;i==="stroke"&&(s=vi(s)),n["u_"+i]=s}}),n}},{key:"registerStyleAttribute",value:function(){var t=this;Object.keys(this.layer.encodeStyleAttribute).forEach(function(n){var i=kw(n);i&&(t.styleAttributeService.registerStyleAttribute(i),i.descriptor&&(i.descriptor.shaderLocation=Z0[n]))})}},{key:"updateEncodeAttribute",value:function(t,n){this.encodeStyleAttribute[t]=n}},{key:"initUniformsBuffer",value:function(){var t=this.getUniformsBufferInfo(this.getStyleAttribute()),n=this.getCommonUniformsInfo();t.uniformsLength!==0&&(this.attributeUnifoms=this.rendererService.createBuffer({data:new Float32Array(p1(t.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.attributeUnifoms)),n.uniformsLength!==0&&(this.commonUnifoms=this.rendererService.createBuffer({data:new Float32Array(p1(n.uniformsLength)).fill(0),isUBO:!0}),this.uniformBuffers.push(this.commonUnifoms))}},{key:"getUniformsBufferInfo",value:function(t){var n=0,i=[];return Object.values(t).forEach(function(a){Array.isArray(a)?(i.push.apply(i,(0,Jt.Z)(a)),n+=a.length):typeof a=="number"?(i.push(a),n+=1):typeof a=="boolean"&&(i.push(Number(a)),n+=1)}),{uniformsOption:t,uniformsLength:n,uniformsArray:i}}},{key:"getCommonUniformsInfo",value:function(){return{uniformsLength:0,uniformsArray:[],uniformsOption:{}}}},{key:"updateStyleUnifoms",value:function(){var t,n,i=this.getUniformsBufferInfo(this.getStyleAttribute()),a=i.uniformsArray,s=this.getCommonUniformsInfo(),l=s.uniformsArray;(t=this.attributeUnifoms)===null||t===void 0||t.subData({offset:0,data:new Uint8Array(new Float32Array(a).buffer)}),(n=this.commonUnifoms)===null||n===void 0||n.subData({offset:0,data:new Uint8Array(new Float32Array(l).buffer)})}}]),e}(),v1=Pi(z0.prototype,"configService",[d1],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),z0),m1=100,KB=36,QB=40;function g1(e){return e/180*Math.acos(-1)}function _1(e){var r=g1(e[0])+Math.PI/2,t=g1(e[1]),n=m1+Math.random()*.4,i=n*Math.cos(t)*Math.cos(r),a=n*Math.cos(t)*Math.sin(r),s=n*Math.sin(t);return[a,s,i]}function JB(e,r){var t=mat4.create(),n=mat4.create(),i=vec3.fromValues(0,1,0),a=vec3.fromValues(0,0,0);r=r||{},e=typeof e!="undefined"?e:1;for(var s=typeof r.segments!="undefined"?r.segments:32,l=2+s,f=2*l,d=[],y=[],b=[],T=[],M=[],P=[],k=0;k<=l;k++){for(var H=k/l,q=H*Math.PI,ae=0;ae<=f;ae++){var Se=ae/f,ze=Se*Math.PI*2;mat4.identity(n),mat4.rotateZ(n,n,-q),mat4.identity(t),mat4.rotateY(t,t,ze),vec3.transformMat4(a,i,n),vec3.transformMat4(a,a,t),vec3.scale(a,a,-e),b.push(a.slice()),T.push.apply(T,_toConsumableArray(a.slice())),vec3.normalize(a,a),M.push.apply(M,_toConsumableArray(a.slice())),P.push([Se,1-H]),T.push(Se,1-H)}if(k>0)for(var it=b.length,ut=it-2*(f+1);ut+f+2<it;ut++)d.push([ut,ut+1,ut+f+1]),y.push(ut,ut+1,ut+f+1),d.push([ut+f+1,ut+1,ut+f+2]),y.push(ut+f+1,ut+1,ut+f+2)}return{cells:d,positions:b,uvs:P,positionsArr:T,indicesArr:y,normalArr:M}}var Cg=kr.Ue(),eF=kr.Ue(),Gs=kr.Ue(),Mp=kr.Ue(),hv=kr.Ue();function V0(e,r,t,n,i){kr.IH(e,t,n),kr.Fv(e,e),r=kr.al(-e[1],e[0]);var a=kr.al(-t[1],t[0]);return[i/kr.AK(r,a),r]}function Ip(e,r){return kr.t8(e,-r[1],r[0])}function pv(e,r,t){return kr.lu(e,r,t),kr.Fv(e,e),e}function j0(e,r){return e[0]===r[0]&&e[1]===r[1]}function tF(e){for(var r=new Map,t=0;t<e.length;t++){var n=e[0].toString()+"-"+e[1].toString();r.get(n)?(e.splice(t,1),t++):r.set(n,n)}return e}var Lw=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};(0,Q.Z)(this,e),(0,F.Z)(this,"lastFlip",-1),(0,F.Z)(this,"miter",kr.al(0,0)),(0,F.Z)(this,"started",!1),(0,F.Z)(this,"dash",!1),(0,F.Z)(this,"totalDistance",0),(0,F.Z)(this,"currentIndex",0),this.join=r.join||"miter",this.cap=r.cap||"butt",this.miterLimit=r.miterLimit||10,this.thickness=r.thickness||1,this.dash=r.dash||!1,this.complex={positions:[],indices:[],normals:[],startIndex:0,indexes:[]}}return(0,j.Z)(e,[{key:"simpleExtrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],d=s<t.length-1?t[s+1]:null,y=this.simpleSegment(n,a,l,f,d);a+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleExtrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var f,d,y,b=t[l-1];b.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var T=n[l-1],M=t[l];M.push((d=n[l][2])!==null&&d!==void 0?d:0);var P=n[l],k=l<t.length-1?[].concat((0,Jt.Z)(t[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,H=l<n.length-1?n[l+1]:null,q=this.simpleSegment(i,s,b,M,k,T,P,H);s+=q}if(this.dash)for(var ae=0;ae<i.positions.length/6;ae++)i.positions[ae*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude_gaode2",value:function(t,n){var i=this.complex;if(t.length<=1)return i;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var a=t.length,s=i.startIndex,l=1;l<a;l++){var f,d,y,b=t[l-1];b.push((f=n[l-1][2])!==null&&f!==void 0?f:0);var T=n[l-1],M=t[l];M.push((d=n[l][2])!==null&&d!==void 0?d:0);var P=n[l],k=l<t.length-1?[].concat((0,Jt.Z)(t[l+1]),[(y=n[l+1][2])!==null&&y!==void 0?y:0]):null,H=l<n.length-1?n[l+1]:null,q=this.segment_gaode2(i,s,b,M,k,T,P,H);s+=q}if(this.dash)for(var ae=0;ae<i.positions.length/6;ae++)i.positions[ae*6+5]=this.totalDistance;return i.startIndex=i.positions.length/6,i}},{key:"extrude",value:function(t){var n=this.complex;if(t.length<=1)return n;this.lastFlip=-1,this.started=!1,this.normal=null,this.totalDistance=0;for(var i=t.length,a=n.startIndex,s=1;s<i;s++){var l=t[s-1],f=t[s],d=s<t.length-1?t[s+1]:null,y=this.segment(n,a,l,f,d);a+=y}if(this.dash)for(var b=0;b<n.positions.length/6;b++)n.positions[b*6+5]=this.totalDistance;return n.startIndex=n.positions.length/6,n}},{key:"simpleSegment",value:function(t,n,i,a,s){var l=0,f=t.indices,d=t.positions,y=t.normals,b=Va([a[0],a[1]]),T=Va([i[0],i[1]]);pv(Gs,b,T);var M=0;if(this.dash&&(M=this.lineSegmentDistance(b,T),this.totalDistance+=M),this.normal||(this.normal=kr.Ue(),Ip(this.normal,Gs)),this.started||(this.started=!0,this.extrusions(d,y,i,this.normal,this.thickness,this.totalDistance-M)),f.push(n+0,n+1,n+2),!s)Ip(this.normal,Gs),this.extrusions(d,y,a,this.normal,this.thickness,this.totalDistance),f.push.apply(f,(0,Jt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2;else{var P=Va([s[0],s[1]]);j0(b,P)&&kr.IH(P,b,kr.Fv(P,kr.$X(P,b,T))),pv(Mp,P,b);var k=V0(hv,kr.Ue(),Gs,Mp,this.thickness),H=(0,yn.Z)(k,2),q=H[0],ae=H[1],Se=kr.AK(hv,this.normal)<0?-1:1;this.extrusions(d,y,a,ae,q,this.totalDistance),f.push.apply(f,(0,Jt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Se=-1,kr.JG(this.normal,ae),l+=2,this.lastFlip=Se}return l}},{key:"segment_gaode2",value:function(t,n,i,a,s,l,f,d){var y=0,b=t.indices,T=t.positions,M=t.normals,P=this.cap==="square",k=this.join==="bevel",H=Va([f[0],f[1]]),q=Va([l[0],l[1]]);pv(Gs,a,i);var ae=0;if(this.dash&&(ae=this.lineSegmentDistance(H,q),this.totalDistance+=ae),this.normal||(this.normal=kr.Ue(),Ip(this.normal,Gs)),!this.started)if(this.started=!0,P){var Se=kr.Ue(),ze=kr.Ue();kr.IH(Se,this.normal,Gs),kr.IH(ze,this.normal,Gs),M.push(ze[0],ze[1],0),M.push(Se[0],Se[1],0),T.push(i[0],i[1],i[2]|0,this.totalDistance-ae,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),T.push(i[0],i[1],i[2]|0,this.totalDistance-ae,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(T,M,i,this.normal,this.thickness,this.totalDistance-ae);if(b.push(n+0,n+1,n+2),s){j0(a,s)&&kr.IH(s,a,kr.Fv(s,kr.$X(s,a,i))),pv(Mp,s,a);var ot=V0(hv,kr.Ue(),Gs,Mp,this.thickness),Ct=(0,yn.Z)(ot,2),Xt=Ct[0],Sr=Ct[1],_r=kr.AK(hv,this.normal)<0?-1:1,Wr=k;if(!Wr&&this.join==="miter"){var Cn=Xt;Cn>this.miterLimit&&(Wr=!0)}Wr?(M.push(this.normal[0],this.normal[1],0),M.push(Sr[0],Sr[1],0),T.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*_r,a[2]|0),this.complex.indexes.push(this.currentIndex),T.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*_r,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,b.push.apply(b,(0,Jt.Z)(this.lastFlip!==-_r?[n,n+2,n+3]:[n+2,n+1,n+3])),b.push(n+2,n+3,n+4),Ip(Cg,Mp),kr.JG(this.normal,Cg),M.push(this.normal[0],this.normal[1],0),T.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*_r,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,y+=3):(this.extrusions(T,M,a,Sr,Xt,this.totalDistance),b.push.apply(b,(0,Jt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),_r=-1,kr.JG(this.normal,Sr),y+=2),this.lastFlip=_r}else{if(Ip(this.normal,Gs),P){var it=kr.Ue(),ut=kr.Ue();kr.lu(ut,Gs,this.normal),kr.IH(it,Gs,this.normal),M.push(ut[0],ut[1],0),M.push(it[0],it[1],0),T.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),T.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(T,M,a,this.normal,this.thickness,this.totalDistance);b.push.apply(b,(0,Jt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),y+=2}return y}},{key:"segment",value:function(t,n,i,a,s){var l=0,f=t.indices,d=t.positions,y=t.normals,b=this.cap==="square",T=this.join==="bevel",M=Va([a[0],a[1]]),P=Va([i[0],i[1]]);pv(Gs,M,P);var k=0;if(this.dash&&(k=this.lineSegmentDistance(M,P),this.totalDistance+=k),this.normal||(this.normal=kr.Ue(),Ip(this.normal,Gs)),!this.started)if(this.started=!0,b){var H=kr.Ue(),q=kr.Ue();kr.IH(H,this.normal,Gs),kr.IH(q,this.normal,Gs),y.push(q[0],q[1],0),y.push(H[0],H[1],0),d.push(i[0],i[1],i[2]|0,this.totalDistance-k,-this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),d.push(i[0],i[1],i[2]|0,this.totalDistance-k,this.thickness,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,y,i,this.normal,this.thickness,this.totalDistance-k);if(f.push(n+0,n+1,n+2),s){var ze=Va([s[0],s[1]]);j0(M,ze)&&kr.IH(ze,M,kr.Fv(ze,kr.$X(ze,M,P))),pv(Mp,ze,M);var it=V0(hv,kr.Ue(),Gs,Mp,this.thickness),ut=(0,yn.Z)(it,2),ot=ut[0],Ct=ut[1],Xt=kr.AK(hv,this.normal)<0?-1:1,Sr=T;if(!Sr&&this.join==="miter"){var _r=ot;_r>this.miterLimit&&(Sr=!0)}Sr?(y.push(this.normal[0],this.normal[1],0),y.push(Ct[0],Ct[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Xt,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness*Xt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,f.push.apply(f,(0,Jt.Z)(this.lastFlip!==-Xt?[n,n+2,n+3]:[n+2,n+1,n+3])),f.push(n+2,n+3,n+4),Ip(Cg,Mp),kr.JG(this.normal,Cg),y.push(this.normal[0],this.normal[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,-this.thickness*Xt,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++,l+=3):(this.extrusions(d,y,a,Ct,ot,this.totalDistance),f.push.apply(f,(0,Jt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),Xt=-1,kr.JG(this.normal,Ct),l+=2),this.lastFlip=Xt}else{if(Ip(this.normal,Gs),b){var ae=kr.Ue(),Se=kr.Ue();kr.lu(Se,Gs,this.normal),kr.IH(ae,Gs,this.normal),y.push(Se[0],Se[1],0),y.push(ae[0],ae[1],0),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),d.push(a[0],a[1],a[2]|0,this.totalDistance,this.thickness,a[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}else this.extrusions(d,y,a,this.normal,this.thickness,this.totalDistance);f.push.apply(f,(0,Jt.Z)(this.lastFlip===1?[n,n+2,n+3]:[n+2,n+1,n+3])),l+=2}return l}},{key:"extrusions",value:function(t,n,i,a,s,l){n.push(a[0],a[1],0),n.push(a[0],a[1],0),t.push(i[0],i[1],i[2]|0,l,-s,i[2]|0),this.complex.indexes.push(this.currentIndex),t.push(i[0],i[1],i[2]|0,l,s,i[2]|0),this.complex.indexes.push(this.currentIndex),this.currentIndex++}},{key:"lineSegmentDistance",value:function(t,n){var i=n[0]-t[0],a=n[1]-t[1];return Math.sqrt(i*i+a*a)}}]),e}(),La=U(54442);function Bw(e){var r=e[0][0],t=e[0][e[0].length-1];r[0]===t[0]&&r[1]===t[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var n=e[0].length,i=Oo().flatten(e),a=i.vertices,s=i.dimensions,l=[],f=[],d=0;d<a.length/s;d++)s===2?l.push(a[d*2],a[d*2+1],1):l.push(a[d*3],a[d*3+1],1);var y=Oo()(i.vertices,i.holes,i.dimensions);f.push.apply(f,(0,Jt.Z)(y));for(var b=function(){var P=i.vertices.slice(T*s,(T+1)*s),k=i.vertices.slice((T+1)*s,(T+2)*s);k.length===0&&(k=i.vertices.slice(0,s));var H=l.length/3;l.push(P[0],P[1],1,k[0],k[1],1,P[0],P[1],0,k[0],k[1],0),f.push.apply(f,(0,Jt.Z)([0,2,1,2,3,1].map(function(q){return q+H})))},T=0;T<n;T++)b();return{positions:l,index:f}}function Fw(e){var r=Oo().flatten(e),t=Oo()(r.vertices,r.holes,r.dimensions);return{positions:r.vertices,index:t}}function y1(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1,t=e[0][0],n=e[0][e[0].length-1];t[0]===n[0]&&t[1]===n[1]&&(e[0]=e[0].slice(0,e[0].length-1));for(var i=e[0].length,a=Oo().flatten(e),s=a.vertices,l=a.dimensions,f=[],d=[],y=[],b=0;b<s.length/l;b++)f.push(s[b*l],s[b*l+1],1,-1,-1),y.push(0,0,1);var T=Oo()(a.vertices,a.holes,a.dimensions);d.push.apply(d,(0,Jt.Z)(T));for(var M=function(){var H=a.vertices.slice(P*l,(P+1)*l),q=a.vertices.slice((P+1)*l,(P+2)*l);q.length===0&&(q=a.vertices.slice(0,l));var ae=f.length/5;f.push(H[0],H[1],1,0,0,q[0],q[1],1,.1,0,H[0],H[1],0,0,.8,q[0],q[1],0,.1,.8);var Se=Nw([q[0],q[1],1],[H[0],H[1],0],[H[0],H[1],1],r);y.push.apply(y,(0,Jt.Z)(Se).concat((0,Jt.Z)(Se),(0,Jt.Z)(Se),(0,Jt.Z)(Se))),d.push.apply(d,(0,Jt.Z)([1,2,0,3,2,1].map(function(ze){return ze+ae})))},P=0;P<i;P++)M();return{positions:f,index:d,normals:y}}function Nw(e,r,t){var n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=La.create(),a=La.create(),s=La.create();n&&(e=xh(e),r=xh(r),t=xh(t));var l=La.fromValues.apply(La,(0,Jt.Z)(e)),f=La.fromValues.apply(La,(0,Jt.Z)(r)),d=La.fromValues.apply(La,(0,Jt.Z)(t));La.sub(i,d,f),La.sub(a,l,f),La.cross(s,i,a);var y=La.create();return La.normalize(y,s),y}var Wc,_m=function(e){return e.CYLINDER="cylinder",e.SQUARECOLUMN="squareColumn",e.TRIANGLECOLUMN="triangleColumn",e.HEXAGONCOLUMN="hexagonColumn",e.PENTAGONCOLUMN="pentagonColumn",e}({}),ym=function(e){return e.CIRCLE="circle",e.SQUARE="square",e.TRIANGLE="triangle",e.HEXAGON="hexagon",e.PENTAGON="pentagon",e}({});function xm(e){for(var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=Math.PI*2/e,n=[],i=0;i<e;i++)n.push(t*i+r*Math.PI/12);var a=n.map(function(s){var l=Math.sin(s+Math.PI/4),f=Math.cos(s+Math.PI/4);return[l,f,0]});return a}function H0(){return xm(30)}function x1(){return xm(4)}function b1(){return xm(3)}function E1(){return xm(6,1)}function S1(){return xm(5)}var dv=(Wc={},(0,F.Z)(Wc,ym.CIRCLE,H0),(0,F.Z)(Wc,ym.HEXAGON,E1),(0,F.Z)(Wc,ym.TRIANGLE,b1),(0,F.Z)(Wc,ym.SQUARE,x1),(0,F.Z)(Wc,ym.PENTAGON,S1),(0,F.Z)(Wc,_m.CYLINDER,H0),(0,F.Z)(Wc,_m.HEXAGONCOLUMN,E1),(0,F.Z)(Wc,_m.TRIANGLECOLUMN,b1),(0,F.Z)(Wc,_m.SQUARECOLUMN,x1),(0,F.Z)(Wc,_m.PENTAGONCOLUMN,S1),Wc),Rg={};function Mg(e){var r=Qs(e.coordinates);return{vertices:[].concat((0,Jt.Z)(r),(0,Jt.Z)(r),(0,Jt.Z)(r),(0,Jt.Z)(r)),indices:[0,1,2,2,3,0],size:r.length}}function A1(e){var r=Qs(e.coordinates),t=_1(r);return{vertices:[].concat((0,Jt.Z)(t),(0,Jt.Z)(t),(0,Jt.Z)(t),(0,Jt.Z)(t)),indices:[0,1,2,2,3,0],size:t.length}}function W0(e){var r=e.shape,t=Gw(r,!1),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function Uw(e){var r=Qs(e.coordinates);return{vertices:(0,Jt.Z)(r),indices:[0],size:r.length}}function zw(e){var r=e.coordinates,t=e.originCoordinates,n=e.version,i=new Lw({dash:!0,join:"bevel"});if(n==="GAODE2.x"){var a=r;Array.isArray(a[0][0])||(a=[r]);var s=t;Array.isArray(s[0][0])||(s=[t]);for(var l=0;l<a.length;l++){var f=a[l],d=s[l];i.extrude_gaode2(f,d)}}else{var y=r;y[0]&&!Array.isArray(y[0][0])&&(y=[r]),y.forEach(function(T){i.extrude(T)})}var b=i.complex;return{vertices:b.positions,indices:b.indices,normals:b.normals,indexes:b.indexes,size:6}}function rF(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat(_toConsumableArray(r),[1,2,-3],_toConsumableArray(r),[1,1,-3],_toConsumableArray(r),[0,1,0],_toConsumableArray(r),[0,0,0],_toConsumableArray(r),[1,0,0],_toConsumableArray(r),[1,2,-3],_toConsumableArray(r),[1,1,-3],_toConsumableArray(r),[0,1,0],_toConsumableArray(r),[0,0,0],_toConsumableArray(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function Zw(e){var r=e.coordinates,t=e.originCoordinates,n=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],normals:[],size:6,count:0};var i=Vw(r,t),a=i.results,s=i.totalDistance;return a.map(function(l){n.push(l[0],l[1],l[2],l[3],0,s)}),{vertices:n,indices:[],normals:[],size:6,count:a.length}}function nF(e){var r=e.coordinates,t=[];if(!Array.isArray(r[0]))return{vertices:[],indices:[],size:4,count:0};var n=jw(r),i=n.results;return i.map(function(a){t.push(a[0],a[1],a[2],a[3])}),{vertices:t,indices:[],size:4,count:i.length}}function T1(e,r){var t=r[0]-e[0],n=r[1]-e[1];return Math.sqrt(t*t+n*n)}function vv(e,r){return e.length<3&&e.push(0),r!==void 0&&e.push(r),e}function Vw(e,r){var t=e,n=r||e;Array.isArray(t)&&Array.isArray(t[0])&&Array.isArray(t[0][0])&&(t=r.flat(),n=r.flat());var i=0;if(t.length<2)return{results:t,totalDistance:0};var a=[],s=vv(t[0],i);a.push(s);for(var l=1;l<t.length-1;l++){var f=T1(Va(n[l-1]),Va(n[l]));i+=f;var d=vv(t[l],i);a.push(d),a.push(d)}var y=T1(Va(n[n.length-2]),Va(n[n.length-1]));return i+=y,a.push(vv(t[t.length-1],i)),{results:a,totalDistance:i}}function jw(e){if(e.length<2)return{results:e};var r=[],t=vv(e[0]);r.push(t);for(var n=1;n<e.length-1;n++){var i=vv(e[n]);r.push(i),r.push(i)}return r.push(vv(e[e.length-1])),{results:r}}function G0(e){var r=e.coordinates,t=Oo().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:Oo()(n,a,i),vertices:n,size:i}}function Hw(e){var r=e.coordinates,t=Oo().flatten(r),n=t.vertices,i=t.dimensions,a=t.holes;return{indices:Oo()(n,a,i),vertices:Ww(n),size:i+4}}function Ww(e){for(var r=[],t=fp(e),n=t.center,i=t.radius,a=0;a<e.length;a+=2){var s=e[a],l=e[a+1];r.push.apply(r,[s,l,0].concat((0,Jt.Z)(n),[i]))}return r}function X0(e){var r=e.coordinates,t=y1(r,!0),n=t.positions,i=t.index,a=t.normals;return{vertices:n,indices:i,normals:a,size:5}}function w1(e){var r=e.shape,t=$w(r),n=t.positions,i=t.index;return{vertices:n,indices:i,size:3}}function Ig(e){var r=e.coordinates,t=[].concat((0,Jt.Z)(r[0]),[0,0,1,r[1][0],r[0][1],0,1,1],(0,Jt.Z)(r[1]),[0,1,0],(0,Jt.Z)(r[0]),[0,0,1],(0,Jt.Z)(r[1]),[0,1,0,r[0][0],r[1][1],0,0,0]),n=[0,1,2,3,4,5];return{vertices:t,indices:n,size:5}}function $0(e,r){for(var t=r.segmentNumber,n=t===void 0?30:t,i=e.coordinates,a=[],s=[],l=function(y){a.push(y,1,y,i[0][0],i[0][1],i[1][0],i[1][1],y,-1,y,i[0][0],i[0][1],i[1][0],i[1][1]),y!==n-1&&s.push.apply(s,(0,Jt.Z)([0,1,2,1,3,2].map(function(b){return y*2+b})))},f=0;f<n;f++)l(f);return{vertices:a,indices:s,size:7}}function C1(e){var r=e.coordinates;r.length===2&&r.push(0);var t=Pg(-1,1),n=Pg(1,1),i=Pg(-1,-1),a=Pg(1,-1),s=[].concat((0,Jt.Z)(r),(0,Jt.Z)(t),(0,Jt.Z)(r),(0,Jt.Z)(i),(0,Jt.Z)(r),(0,Jt.Z)(a),(0,Jt.Z)(r),(0,Jt.Z)(n)),l=[0,1,2,3,0,2];return{vertices:s,indices:l,size:5}}function Gw(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:!1;if(Rg&&Rg[e])return Rg[e];var t=dv[e]?dv[e]():dv.cylinder(),n=y1([t],r);return Rg[e]=n,n}function iF(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:3,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:!1,i=new Float32Array(e.length/t*3),a,s,l,f=vec3.create(),d=vec3.create(),y=vec3.create(),b=0,T=r.length;b<T;b+=3){a=r[b+0]*3,s=r[b+1]*3,l=r[b+2]*3;var M=[e[a],e[a+1]],P=[e[s],e[s+1]],k=[e[l],e[l+1]];n&&(M=lngLatToMeters(M),P=lngLatToMeters(P),k=lngLatToMeters(k));var H=M,q=_slicedToArray(H,2),ae=q[0],Se=q[1],ze=vec3.fromValues(ae,Se,e[a+2]),it=P,ut=_slicedToArray(it,2),ot=ut[0],Ct=ut[1],Xt=vec3.fromValues(ot,Ct,e[s+2]),Sr=k,_r=_slicedToArray(Sr,2),Wr=_r[0],Cn=_r[1],wi=vec3.fromValues(Wr,Cn,e[l+2]);vec3.sub(f,wi,Xt),vec3.sub(d,ze,Xt),vec3.cross(y,f,d),i[a]+=f[0],i[a+1]+=f[1],i[a+2]+=f[2],i[s]+=f[0],i[s+1]+=f[1],i[s+2]+=f[2],i[l]+=f[0],i[l+1]+=f[1],i[l+2]+=f[2]}return Xw(i),i}function Xw(e){for(var r=0,t=e.length;r<t;r+=3){var n=vec3.fromValues(e[r],e[r+1],e[r+2]),i=vec3.create();vec3.normalize(i,n),e.set(i,r)}}function aF(e){var r=e[0][0],t=e[0][e[0].length-1];return r[0]===t[0]&&r[1]===t[1]}function $w(e){var r=["cylinder","triangleColumn","hexagonColumn","squareColumn"],t=dv[e]?dv[e]():dv.circle(),n=r.indexOf(e)===-1?Fw([t]):Bw([t]);return n}function Pg(e,r){var t=(e+1)/2,n=(r+1)/2;return[t,n]}function oF(){var e=primitiveSphere(EARTH_RADIUS,{segments:EARTH_SEGMENTS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function sF(){var e=primitiveSphere(EARTH_RADIUS+EARTH_RADIUS_OUTER,{segments:EARTH_SEGMENTS}),r=e.positionsArr,t=e.indicesArr,n=e.normalArr;return{vertices:r,indices:t,size:5,normals:n}}function Yw(e){var r=qw();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function qw(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Kw=`precision highp float;
layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
in vec4 v_Color;
in vec2 v_texCoord;
in float v_worldDis;
out vec4 outputColor;

#pragma include "picking"
#pragma include "scene_uniforms"

vec3 getWindowColor(float n, float hot, vec3 brightColor, vec3 darkColor) {
    float s = step(hot, n);
    vec3 color = mix(brightColor,vec3(0.9,0.9,1.0),n);

    return mix(darkColor, color, s);
}
float random (vec2 st) {
    return fract(sin(dot(st.xy, vec2(12.9898,78.233)))* 43758.5453123);
}

float LinearizeDepth()
{
    float z = gl_FragCoord.z * 2.0 - 1.0;
    return (2.0 * u_near * u_far) / (u_far + u_near - z * (u_far - u_near));
}

vec3 fog(vec3 color, vec3 fogColor, float depth){
    float fogFactor=clamp(depth,0.0,1.0);
    vec3 output_color=mix(fogColor,color,fogFactor);
    return output_color;
}

float sdRect(vec2 p, vec2 sz) {
  vec2 d = abs(p) - sz;
  float outside = length(max(d, 0.));
  float inside = min(max(d.x, d.y), 0.);
  return outside + inside;
}

void main() {
  outputColor = v_Color;
  vec3 baseColor = u_baseColor.xyz;
  vec3 brightColor = u_brightColor.xyz;
  vec3 windowColor = u_windowColor.xyz;
  float targetColId = 5.;
  float depth = 1.0 - LinearizeDepth() / u_far * u_Zoom;
  vec3 fogColor = vec3(23.0/255.0,31.0/255.0,51.0/255.0);
  if(v_texCoord.x < 0.) { //\u9876\u90E8\u989C\u8272
       vec3 foggedColor = fog(baseColor.xyz + vec3(0.12*0.9,0.2*0.9,0.3*0.9),fogColor,depth);
       outputColor = vec4( foggedColor, v_Color.w);
  }else { // \u4FA7\u9762\u989C\u8272
        vec2 st = v_texCoord;
        vec2  UvScale = v_texCoord;
        float tStep = min(0.08,max(0.05* (18.0-u_Zoom),0.02));
        float tStart = 0.25 * tStep;
        float tEnd = 0.75 * tStep;
        float u = mod(UvScale.x, tStep);
        float v = mod(UvScale.y, tStep);
        float ux = floor(UvScale.x/tStep);
        float uy = floor(UvScale.y/tStep);
        float n = random(vec2(ux,uy));
        float lightP = u_time;
        float head = 1.0- step(0.005,st.y);
        /*step3*/
        // \u5C06\u7A97\u6237\u989C\u8272\u548C\u5899\u9762\u989C\u8272\u533A\u522B\u5F00\u6765
        float sU = step(tStart, u) - step(tEnd, u);
        float sV = step(tStart, v) - step(tEnd, v);
        vec2 windowSize = vec2(abs(tEnd-tStart),abs(tEnd-tStart));
        float dist = sdRect(vec2(u,v), windowSize);
        float s = sU * sV;

        float curColId = floor(UvScale.x / tStep);
        float sCol = step(targetColId - 0.2, curColId) - step(targetColId + 0.2, curColId);

        float mLightP = mod(lightP, 2.);
        float sRow = step(mLightP - 0.2, st.y) - step(mLightP, st.y);
        if(ux == targetColId){
            n =0.;
        }
        float timeP = min(0.75, abs ( sin(u_time/3.0) ) );
        float hot = smoothstep(1.0,0.0,timeP);
        vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), s);
        //vec3 color = mix(baseColor, getWindowColor(n,hot,brightColor,windowColor), 1.0);
        float sFinal = s * sCol * sRow;
        color += mix(baseColor, brightColor, sFinal*n);
        if (st.y<0.01){
        color = baseColor;
         }
        if(head ==1.0) { // \u9876\u90E8\u4EAE\u7EBF
            color = brightColor;
        }
        color = color * v_Color.rgb;

        vec3 foggedColor = fog(color,fogColor,depth);

        outputColor = vec4(foggedColor,1.0);
  }


  if(u_circleSweep > 0.0 && v_worldDis < u_cityMinSize) {
    float r = fract(((v_worldDis/u_cityMinSize) - u_time * u_circleSweepSpeed) * 2.0);
    outputColor.rgb += r * r * u_circleSweepColor.rgb;
  }
   
  outputColor.a *= u_opacity;
  outputColor = filterColor(outputColor);
}
`,Qw=`precision highp float;

#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec2 a_Uv;

out vec2 v_texCoord;
out vec4 v_Color;
out float v_worldDis;

layout(std140) uniform commonUniforms {
  vec4 u_baseColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_brightColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_windowColor : [ 1.0, 0, 0, 1.0 ];
  vec4 u_circleSweepColor;
  vec2 u_cityCenter;
  float u_circleSweep;
  float u_cityMinSize;
  float u_circleSweepSpeed;
  float u_opacity: 1.0;
  float u_near : 0;
  float u_far : 1;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"


void main() {
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

   v_texCoord = a_Uv;

  if(u_circleSweep > 0.0) {
     vec2 lnglatscale = vec2(0.0);
    if(u_CoordinateSystem != COORDINATE_SYSTEM_P20_2) {
      lnglatscale = (a_Position.xy - u_cityCenter) * vec2(0.0, 0.135);
    }
    v_worldDis = length(a_Position.xy + lnglatscale - u_cityCenter);
  }
 
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }

  float lightWeight = calc_lighting(pos);
  // v_Color = a_Color;
  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w);

  setPickingColor(a_PickingColor);
}
`,Jw=function(e){(0,Le.Z)(t,e);var r=Yw(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.baseColor,f=l===void 0?"rgb(16,16,16)":l,d=i.brightColor,y=d===void 0?"rgb(255,176,38)":d,b=i.windowColor,T=b===void 0?"rgb(30,60,89)":b,M=i.time,P=M===void 0?0:M,k=i.sweep,H=k===void 0?{enable:!1,sweepRadius:1,sweepColor:"rgb(255, 255, 255)",sweepSpeed:.4,sweepCenter:this.cityCenter}:k,q={u_baseColor:vi(f),u_brightColor:vi(y),u_windowColor:vi(T),u_circleSweepColor:[].concat((0,Jt.Z)(vi(H.sweepColor).slice(0,3)),[1]),u_cityCenter:H.sweepCenter||this.cityCenter,u_circleSweep:H.enable?1:0,u_cityMinSize:this.cityMinSize*H.sweepRadius,u_circleSweepSpeed:H.sweepSpeed,u_opacity:s,u_near:0,u_far:1,u_time:this.layer.getLayerAnimateTime()||P},ae=this.getUniformsBufferInfo(q);return ae}},{key:"calCityGeo",value:function(){var i=(0,yn.Z)(this.layer.getSource().extent,4),a=i[0],s=i[1],l=i[2],f=i[3];if(this.mapService.version==="GAODE2.x"){this.cityCenter=this.mapService.lngLatToCoord([(l+a)/2,(f+s)/2]);var d=this.mapService.lngLatToCoord([l,f]),y=this.mapService.lngLatToCoord([a,s]);this.cityMinSize=Math.sqrt(Math.pow(d[0]-y[0],2)+Math.pow(d[1]-y[1],2))/4}else{var b=l-a,T=f-s;this.cityCenter=[(l+a)/2,(f+s)/2],this.cityMinSize=Math.sqrt(Math.pow(b,2)+Math.pow(T,2))/4}}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.calCityGeo(),this.initUniformsBuffer(),this.startModelAnimate(),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"cityBuilding",vertexShader:Qw,fragmentShader:Kw,triangulation:X0,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:I.BACK}});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Mn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Mn.Attribute,descriptor:{name:"a_Uv",shaderLocation:qn.UV,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Na);function eC(e){var r=tC();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function tC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rC=function(e){(0,Le.Z)(t,e);var r=eC(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"type","CityBuildingLayer"),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.layerModel=new Jw(this),l.next=3,this.initLayerModels();case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"setLight",value:function(i){this.updateLayerConfig({time:i})}},{key:"getModelType",value:function(){return"citybuilding"}}]),t}(Rp);function nC(e){var r=iC();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function iC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aC=`layout(location = 0) in vec3 a_Position;\r
layout(location = 1) in vec4 a_Color;\r
layout(location = 10) in vec3 a_Pos;\r
\r
layout(std140) uniform commonUniforms {\r
    vec2 u_radius;\r
    float u_opacity;\r
    float u_coverage;\r
    float u_angle;\r
};\r
\r
\r
out vec4 v_color;\r
\r
\r
#pragma include "projection"\r
#pragma include "project"\r
#pragma include "picking"\r
\r
void main() {\r
  v_color = a_Color;\r
  v_color.a *= u_opacity;\r
\r
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));\r
  vec2 offset = a_Position.xy * u_radius * rotationMatrix * u_coverage ;\r
  // vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
  // gl_Position = project_common_position_to_clipspace(project_pos);\r
\r
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x\r
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807\r
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));\r
    gl_Position = u_Mvp * (project_pos);\r
  } else {\r
     vec2 lnglat = unProjectFlat(a_Pos.xy + offset);\r
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));\r
    gl_Position = project_common_position_to_clipspace(project_pos);\r
  }\r
\r
  setPickingColor(a_PickingColor);\r
}\r
`,oC=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,sC=function(e){(0,Le.Z)(t,e);var r=nC(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,W.Z)((0,W.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,f={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},d=this.getUniformsBufferInfo(f);return d}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid",vertexShader:aC,fragmentShader:oC,triangulation:w1,primitive:I.TRIANGLES,depth:{enable:!1}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Mn.Attribute,descriptor:{shaderLocation:10,name:"a_Pos",buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(Na);function uC(e){var r=lC();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function lC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in vec3 a_Pos;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"
#pragma include "light"
#pragma include "picking"


void main() {
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));


  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
 
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u7ECF\u7EAC\u5EA6
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator; // \u5C06\u7ECF\u7EAC\u5EA6\u8F6C\u6362\u4E3A\u9AD8\u5FB72.0\u9700\u8981\u7684\u5E73\u9762\u5750\u6807
    vec4 project_pos = project_position(vec4(customLnglat, a_Position.z * a_Size, 1.0));

    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w * u_opacity);
  
    gl_Position = u_Mvp * vec4(customLnglat , a_Position.z * a_Size, 1.0);
  } else {
    vec2 lnglat = unProjectFlat(a_Pos.xy + offset); // \u5B9E\u9645\u7684\u7ECF\u7EAC\u5EA6
    vec4 project_pos = project_position(vec4(lnglat, a_Position.z * a_Size, 1.0));
    
    float lightWeight = calc_lighting(project_pos);
    v_color =vec4(a_Color.rgb*lightWeight, a_Color.w);
    
    gl_Position = project_common_position_to_clipspace(project_pos);
  }



  setPickingColor(a_PickingColor);
}
`,fC=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,hC=function(e){(0,Le.Z)(t,e);var r=uC(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,W.Z)((0,W.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,f={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},d=this.getUniformsBufferInfo(f);return d}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"heatmapGrid3d",vertexShader:cC,fragmentShader:fC,triangulation:W0,primitive:I.TRIANGLES,depth:{enable:!0}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{shaderLocation:qn.SIZE,name:"a_Size",buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(a){var s=a.size;return Array.isArray(s)?[s[0]]:[s]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Mn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Mn.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(Na),uF=U(18041);function pC(e,r){for(var t=[],n=[],i=[],a=e+1,s=r+1,l=e/2,f=r/2,d=0;d<s;d++)for(var y=d-f,b=0;b<a;b++){var T=b-l;n.push(T/l,-y/f,0),i.push(b/e),i.push(1-d/r)}for(var M=0;M<r;M++)for(var P=0;P<e;P++){var k=P+a*M,H=P+a*(M+1),q=P+1+a*(M+1),ae=P+1+a*M;t.push(k,H,ae),t.push(H,q,ae)}return{vertices:n,indices:t,uvs:i}}var R1,M1;function dC(e){var r=vC();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function vC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mC=`layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;
in float v_intensity;
out vec4 outputColor;

void main(){
   
    float intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
    vec4 color = texture(SAMPLER_2D(u_colorTexture),vec2(intensity, 0));
    outputColor = color;
    // gl_FragColor.a = color.a * smoothstep(0.1,0.2,intensity)* u_opacity;
   outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,gC=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  mat4 u_ViewProjectionMatrixUncentered;
  mat4 u_InverseViewProjectionMatrix;
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

out vec2 v_texCoord;
out float v_intensity;

vec2 toBezier(float t, vec2 P0, vec2 P1, vec2 P2, vec2 P3) {
    float t2 = t * t;
    float one_minus_t = 1.0 - t;
    float one_minus_t2 = one_minus_t * one_minus_t;
    return (P0 * one_minus_t2 * one_minus_t + P1 * 3.0 * t * one_minus_t2 + P2 * 3.0 * t2 * one_minus_t + P3 * t2 * t);
}
vec2 toBezier(float t, vec4 p){
    return toBezier(t, vec2(0.0, 0.0), vec2(p.x, p.y), vec2(p.z, p.w), vec2(1.0, 1.0));
}

#pragma include "projection"
#pragma include "project"

void main() {
  v_texCoord = a_Uv;

  vec2 pos = a_Uv * vec2(2.0) - vec2(1.0); // \u5C06\u539F\u672C 0 -> 1 \u7684 uv \u8F6C\u6362\u4E3A -1 -> 1 \u7684\u6807\u51C6\u5750\u6807\u7A7A\u95F4\uFF08NDC\uFF09

  vec4 p1 = vec4(pos, 0.0, 1.0); // x/y \u5E73\u9762\u4E0A\u7684\u70B9\uFF08z == 0\uFF09\u53EF\u4EE5\u8BA4\u4E3A\u662F\u4E09\u7EF4\u4E0A\u7684\u70B9\u88AB\u6295\u5F71\u5230\u5E73\u9762\u540E\u7684\u70B9
	vec4 p2 = vec4(pos, 1.0, 1.0); // \u5E73\u884C\u4E8Ex/y\u5E73\u9762\u3001z==1 \u7684\u5E73\u9762\u4E0A\u7684\u70B9

	vec4 inverseP1 = u_InverseViewProjectionMatrix * p1; // \u6839\u636E\u89C6\u56FE\u6295\u5F71\u77E9\u9635\u7684\u9006\u77E9\u9635\u5E73\u9762\u4E0A\u7684\u53CD\u7B97\u51FA\u4E09\u7EF4\u7A7A\u95F4\u4E2D\u7684\u70B9\uFF08p1\u5E73\u9762\u4E0A\u7684\u70B9\uFF09
	vec4 inverseP2 = u_InverseViewProjectionMatrix * p2;

  inverseP1 = inverseP1 / inverseP1.w; // \u5F52\u4E00\u5316\u64CD\u4F5C\uFF08\u5F52\u4E00\u5316\u540E\u4E3A\u4E16\u754C\u5750\u6807\uFF09
	inverseP2 = inverseP2 / inverseP2.w;

	float zPos = (0.0 - inverseP1.z) / (inverseP2.z - inverseP1.z); // ??
	vec4 position = inverseP1 + zPos * (inverseP2 - inverseP1);

  vec4 b= vec4(0.5000, 0.0, 1.0, 0.5000);
  float fh;

  v_intensity = texture(SAMPLER_2D(u_texture), v_texCoord).r;
  fh = toBezier(v_intensity, b).y;
  gl_Position = u_ViewProjectionMatrixUncentered * vec4(position.xy, fh * project_pixel(50.), 1.0);
 
}
`,_C=`uniform sampler2D u_texture;        // \u70ED\u529B\u5F3A\u5EA6\u56FE
uniform sampler2D u_colorTexture;   // \u6839\u636E\u5F3A\u5EA6\u5206\u5E03\u7684\u8272\u5E26

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};
in vec2 v_texCoord;
out vec4 outputColor;

#pragma include "scene_uniforms"

float getBlurIndusty() {
    float vW = 2.0/ u_ViewportSize.x;
    float vH = 2.0/ u_ViewportSize.y;
    vec2 vUv = v_texCoord;
    float i11 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i12 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y + 1.0 * vH) ).r;
    float i13 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y + 1.0 * vH) ).r;

    float i21 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y) ).r;
    float i22 = texture(SAMPLER_2D(u_texture), vec2( vUv.x , vUv.y) ).r;
    float i23 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y) ).r;

    float i31 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 1.0 * vW, vUv.y-1.0*vH) ).r;
    float i32 = texture(SAMPLER_2D(u_texture), vec2( vUv.x - 0.0 * vW, vUv.y-1.0*vH) ).r;
    float i33 = texture(SAMPLER_2D(u_texture), vec2( vUv.x + 1.0 * vW, vUv.y-1.0*vH) ).r;

    return(
        i11 + 
        i12 + 
        i13 + 
        i21 + 
        i21 + 
        i22 + 
        i23 + 
        i31 + 
        i32 + 
        i33
        )/9.0;
}


void main(){
    // float intensity = texture(u_texture, v_texCoord).r;
    float intensity = getBlurIndusty();
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(intensity, 0.0));
    outputColor = color;
    outputColor.a = color.a * smoothstep(0.,0.1,intensity) * u_opacity;
}
`,yC=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  float u_opacity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
  float u_common_uniforms_padding3;
};

#pragma include "scene_uniforms"

out vec2 v_texCoord;
void main() {
  v_texCoord = a_Uv;

  gl_Position = vec4(a_Position.xy, 0, 1.);
}
`,xC=`layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

in float v_weight;
in vec2 v_extrude;
out vec4 outputColor;
#define GAUSS_COEF  0.3989422804014327
void main(){
    float d = -0.5 * 3.0 * 3.0 * dot(v_extrude, v_extrude);
    float val = v_weight * u_intensity * GAUSS_COEF * exp(d);
    outputColor = vec4(val, 1., 1., 1.);
}
`,bC=`layout(location = 0) in vec3 a_Position;
layout(location = 9) in float a_Size;
layout(location = 10) in vec2 a_Dir;


layout(std140) uniform commonUniforms {
  float u_radius;
  float u_intensity;
  float u_common_uniforms_padding1;
  float u_common_uniforms_padding2;
};

out vec2 v_extrude;
out float v_weight;


#define GAUSS_COEF  0.3989422804014327

#pragma include "projection"

void main(){
    v_weight = a_Size;
    float ZERO = 1.0 / 255.0 / 16.0;
    float extrude_x = a_Dir.x * 2.0 -1.0;
    float extrude_y = a_Dir.y * 2.0 -1.0;
    vec2 extrude_dir = normalize(vec2(extrude_x,extrude_y));
    float S = sqrt(-2.0 * log(ZERO / a_Size / u_intensity / GAUSS_COEF)) / 2.5;
    v_extrude = extrude_dir * S;

    vec2 offset = project_pixel(v_extrude * u_radius);
    vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));

    // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));

    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
        gl_Position = u_Mvp * (vec4(project_pos.xy + offset, 0.0, 1.0));
    } else {
        gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, 0.0, 1.0));
    }
}
`,EC=ui.isEqual,I1=(R1=(0,tr.b2)(),R1(M1=function(e){(0,Le.Z)(t,e);var r=dC(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"colorModelUniformBuffer",[]),(0,F.Z)((0,Re.Z)(n),"heat3DModelUniformBuffer",[]),n}return(0,j.Z)(t,[{key:"prerender",value:function(){var i=this,a=this.rendererService,s=a.clear,l=a.useFramebuffer;l(this.heatmapFramerBuffer,function(){s({color:[0,0,0,0],depth:1,stencil:0,framebuffer:i.heatmapFramerBuffer}),i.drawIntensityMode()})}},{key:"render",value:function(i){var a=this.layer.getLayerConfig(),s=a.rampColors;EC(this.preRampColors,s)||this.updateColorTexture(),this.shapeType==="heatmap"?this.drawHeatMap(i):this.draw3DHeatMap(i)}},{key:"getUninforms",value:function(){throw new Error("Method not implemented.")}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y,b,T,M,P,k;return _e().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return l=this.rendererService,f=l.createFramebuffer,d=l.getViewportSize,y=l.createTexture2D,b=this.styleAttributeService.getLayerStyleAttribute("shape"),T=(b==null||(s=b.scale)===null||s===void 0?void 0:s.field)||"heatmap",this.shapeType=T,q.next=6,this.buildHeatMapIntensity();case 6:return this.intensityModel=q.sent,this.colorModel=T==="heatmap"?this.buildHeatmap():this.build3dHeatMap(),M=d(),P=M.width,k=M.height,this.heatmapTexture=y({width:Math.floor(P/4),height:Math.floor(k/4),wrapS:I.CLAMP_TO_EDGE,wrapT:I.CLAMP_TO_EDGE,min:I.LINEAR,mag:I.LINEAR,usage:ft.RENDER_TARGET}),this.heatmapFramerBuffer=f({color:this.heatmapTexture,depth:!1}),this.updateColorTexture(),q.abrupt("return",[this.intensityModel,this.colorModel]);case 13:case"end":return q.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"dir",type:Mn.Attribute,descriptor:{name:"a_Dir",shaderLocation:10,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return[l]}}})}},{key:"buildHeatMapIntensity",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.uniformBuffers=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})],this.layer.triangulation=C1,f.next=4,this.layer.buildLayerModel({moduleName:"heatmapIntensity",vertexShader:bC,fragmentShader:xC,triangulation:C1,depth:{enable:!1},cull:{enable:!0,face:Ji(this.mapService.version)}});case 4:return s=f.sent,f.abrupt("return",s);case 6:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildHeatmap",value:function(){this.shaderModuleService.registerModule("heatmapColor",{vs:yC,fs:_C}),this.colorModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(4).fill(0),isUBO:!0})];var i=this.shaderModuleService.getModule("heatmapColor"),a=i.vs,s=i.fs,l=i.uniforms,f=this.rendererService,d=f.createAttribute,y=f.createElements,b=f.createBuffer,T=f.createModel;return T({vs:a,fs:s,uniformBuffers:[].concat((0,Jt.Z)(this.colorModelUniformBuffer),(0,Jt.Z)(this.rendererService.uniformBuffers)),attributes:{a_Position:d({shaderLocation:qn.POSITION,buffer:b({data:[-1,1,0,1,1,0,-1,-1,0,1,-1,0],type:I.FLOAT}),size:3}),a_Uv:d({shaderLocation:qn.UV,buffer:b({data:[0,1,1,1,0,0,1,0],type:I.FLOAT}),size:2})},uniforms:(0,W.Z)({},l),depth:{enable:!1},elements:y({data:[0,2,1,2,3,1],type:I.UNSIGNED_INT,count:6})})}},{key:"drawIntensityMode",value:function(){var i,a=this.layer.getLayerConfig(),s=a.intensity,l=s===void 0?10:s,f=a.radius,d=f===void 0?5:f,y={u_radius:d,u_intensity:l};this.uniformBuffers[0].subData({offset:0,data:[d,l]}),this.layerService.beforeRenderData(this.layer),this.layer.hooks.beforeRender.call(),(i=this.intensityModel)===null||i===void 0||i.draw({uniforms:y,blend:{enable:!0,func:{srcRGB:I.ONE,srcAlpha:1,dstRGB:I.ONE,dstAlpha:1}},stencil:{enable:!1,mask:255,func:{cmp:514,ref:1,mask:255}}}),this.layer.hooks.afterRender.call()}},{key:"drawHeatMap",value:function(i){var a,s=this.layer.getLayerConfig(),l=s.opacity,f=l===void 0?1:l,d={u_opacity:f,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer},y=[this.heatmapTexture,this.colorTexture];this.colorModelUniformBuffer[0].subData({offset:0,data:[f]}),(a=this.colorModel)===null||a===void 0||a.draw({uniforms:d,textures:y,blend:this.getBlend(),stencil:this.getStencil(i)})}},{key:"draw3DHeatMap",value:function(i){var a,s=this.layer.getLayerConfig(),l=s.opacity,f=l===void 0?1:l,d=It.create();It.invert(d,this.cameraService.getViewProjectionMatrixUncentered());var y={u_opacity:f,u_colorTexture:this.colorTexture,u_texture:this.heatmapFramerBuffer,u_ViewProjectionMatrixUncentered:this.cameraService.getViewProjectionMatrixUncentered(),u_InverseViewProjectionMatrix:(0,Jt.Z)(d)};this.heat3DModelUniformBuffer[0].subData({offset:0,data:[].concat((0,Jt.Z)(y.u_ViewProjectionMatrixUncentered),(0,Jt.Z)(y.u_InverseViewProjectionMatrix),[f])});var b=[this.heatmapTexture,this.colorTexture];(a=this.colorModel)===null||a===void 0||a.draw({uniforms:y,textures:b,blend:{enable:!0,func:{srcRGB:I.SRC_ALPHA,srcAlpha:1,dstRGB:I.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},stencil:this.getStencil(i)})}},{key:"build3dHeatMap",value:function(){var i=this.rendererService.getViewportSize,a=i(),s=a.width,l=a.height,f=pC(s/4,l/4);this.shaderModuleService.registerModule("heatmap3dColor",{vs:gC,fs:mC}),this.heat3DModelUniformBuffer=[this.rendererService.createBuffer({data:new Float32Array(16*2+4).fill(0),isUBO:!0})];var d=this.shaderModuleService.getModule("heatmap3dColor"),y=d.vs,b=d.fs,T=d.uniforms,M=this.rendererService,P=M.createAttribute,k=M.createElements,H=M.createBuffer,q=M.createModel;return q({vs:y,fs:b,attributes:{a_Position:P({shaderLocation:qn.POSITION,buffer:H({data:f.vertices,type:I.FLOAT}),size:3}),a_Uv:P({shaderLocation:qn.UV,buffer:H({data:f.uvs,type:I.FLOAT}),size:2})},primitive:I.TRIANGLES,uniformBuffers:[].concat((0,Jt.Z)(this.heat3DModelUniformBuffer),(0,Jt.Z)(this.rendererService.uniformBuffers)),uniforms:(0,W.Z)({},T),depth:{enable:!0},blend:{enable:!0,func:{srcRGB:I.SRC_ALPHA,srcAlpha:1,dstRGB:I.ONE_MINUS_SRC_ALPHA,dstAlpha:1}},elements:k({data:f.indices,type:I.UNSIGNED_INT,count:f.indices.length})})}},{key:"updateColorTexture",value:function(){var i=this.rendererService.createTexture2D;this.texture&&this.texture.destroy();var a=this.layer.getLayerConfig(),s=a.rampColors,l=zo(s);this.colorTexture=i({data:new Uint8Array(l.data),width:l.width,height:l.height,wrapS:I.CLAMP_TO_EDGE,wrapT:I.CLAMP_TO_EDGE,min:I.NEAREST,mag:I.NEAREST,flipY:!1}),this.preRampColors=s}}]),t}(Na))||M1);function SC(e){var r=AC();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function AC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TC=`in vec4 v_color;

#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,wC=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 10) in vec3 a_Pos;

layout(std140) uniform commonUniforms {
    vec2 u_radius;
    float u_opacity;
    float u_coverage;
    float u_angle;
};

out vec4 v_color;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

void main() {
  v_color = a_Color;
  v_color.a *= u_opacity;
    
  mat2 rotationMatrix = mat2(cos(u_angle), sin(u_angle), -sin(u_angle), cos(u_angle));
  vec2 offset =(vec2(a_Position.xy * u_radius * rotationMatrix * u_coverage));
  vec2 lnglat = unProjectFlat(a_Pos.xy + offset);
 
  // vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    // gl_Position = u_Mvp * (vec4(project_pos.xy, 0., 1.0));
    // gl_Position = u_Mvp * (vec4(a_Pos.xy + offset, 0., 1.0));
    vec2 customLnglat = customProject(lnglat) - u_sceneCenterMercator;
    vec4 project_pos = project_position(vec4(customLnglat, 0, 1.0));
    gl_Position = u_Mvp * vec4(project_pos.xy, 0.0, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(lnglat, 0, 1.0));
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, 0., 1.0));
  }
  setPickingColor(a_PickingColor);
}
`,CC=function(e){(0,Le.Z)(t,e);var r=SC(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,W.Z)((0,W.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.coverage,l=i.angle,f={u_radius:[this.layer.getSource().data.xOffset,this.layer.getSource().data.yOffset],u_opacity:a||1,u_coverage:s||.9,u_angle:l||0},d=this.getUniformsBufferInfo(f);return d}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"heatmapHexagon",vertexShader:wC,fragmentShader:TC,triangulation:w1,depth:{enable:!1},primitive:I.TRIANGLES});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"pos",type:Mn.Attribute,descriptor:{name:"a_Pos",shaderLocation:10,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a){var s=a.version==="GAODE2.x"?a.originCoordinates:a.coordinates;return[s[0],s[1],0]}}})}}]),t}(Na),RC={heatmap:I1,heatmap3d:I1,grid:sC,grid3d:hC,hexagon:CC},MC=RC;function IC(e){var r=PC();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function PC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var OC=function(e){(0,Le.Z)(t,e);var r=IC(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"type","HeatMapLayer"),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new MC[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"prerender",value:function(){var i=this.getModelType();i==="heatmap"&&this.layerModel&&this.layerModel.prerender()}},{key:"renderModels",value:function(){var i=this,a=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},s=this.getModelType();return s==="heatmap"?(this.layerModel&&this.layerModel.render(a),this):this.encodeDataLength<=0&&!this.forceRender?this:(this.hooks.beforeRender.call(),this.models.forEach(function(l){return l.draw({uniforms:i.layerModel.getUninforms(),blend:i.layerModel.getBlend(),stencil:i.layerModel.getStencil(a)})}),this.hooks.afterRender.call(),this)}},{key:"updateModelData",value:function(i){i.attributes&&i.elements?this.models[0].updateAttributesAndElements(i.attributes,i.elements):console.warn("data error")}},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=this.getLayerConfig(),l=s.shape3d,f=this.getSource(),d=f.data.type,y=(a==null||(i=a.scale)===null||i===void 0?void 0:i.field)||"heatmap";return y==="heatmap"||y==="heatmap3d"?"heatmap":d==="hexagon"?(l==null?void 0:l.indexOf(y))===-1?"hexagon":"grid3d":d==="grid"?(l==null?void 0:l.indexOf(y))===-1?"grid":"grid3d":"heatmap"}}]),t}(Rp);function kC(e){var r=DC();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function DC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var LC=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

in vec2 v_texCoord;
out vec4 outputColor;
vec3 setContrast(vec3 rgb, float contrast) {
  vec3 color = mix(vec3(0.5), rgb, contrast);
  color = clamp(color, 0.0, 1.0);
  return color;
}
vec3 setSaturation(vec3 rgb, float adjustment) {
  const vec3 grayVector = vec3(0.2125, 0.7154, 0.0721);
  vec3 intensity = vec3(dot(rgb, grayVector));
  vec3 color = mix(intensity, rgb, adjustment);
  color = clamp(color, 0.0, 1.0);
  return color;
}
void main() {
  vec4 color = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y));
  //brightness
  color.rgb = mix(vec3(0.0, 0.0, 0.0), color.rgb, u_brightness);
  //contrast
  color.rgb = setContrast(color.rgb, u_contrast);
  // saturation
  color.rgb = setSaturation(color.rgb, u_saturation);
  // gamma
  color.rgb = pow(color.rgb, vec3(u_gamma));
  outputColor = color;
  outputColor.a *= u_opacity;
  if(outputColor.a < 0.01)
    discard;
}
`,BC=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
    float u_opacity:1.0;
    float u_brightness:1.0;
    float u_contrast:1.0;
    float u_saturation:1.0;
    float u_gamma:1.0;
};

out vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
 
}
`,FC=function(e){(0,Le.Z)(t,e);var r=kC(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.color,s=a===void 0?"rgb(255,255,255)":a,l=i.opacity,f=i.brightness,d=i.contrast,y=i.saturation,b=i.gamma,T=vi(s),M={u_opacity:vl(l,1),u_brightness:vl(f,1),u_contrast:vl(d,1),u_saturation:vl(y,1),u_gamma:vl(b,1)};this.textures=[this.texture];var P=this.getUniformsBufferInfo(M);return P}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"loadTexture",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f;return _e().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return s=this.rendererService.createTexture2D,this.texture=s({height:0,width:0}),l=this.layer.getSource(),y.next=5,l.data.images;case 5:f=y.sent,this.texture=s({data:f[0],width:f[0].width,height:f[0].height,mag:I.LINEAR,min:I.LINEAR});case 7:case"end":return y.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"rasterImage",vertexShader:BC,fragmentShader:LC,triangulation:Ig,primitive:I.TRIANGLES,blend:{enable:!0},depth:{enable:!1}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Mn.Attribute,descriptor:{name:"a_Uv",shaderLocation:qn.UV,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Na),NC={image:FC},UC=NC;function zC(e){var r=ZC();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function ZC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var P1=function(e){(0,Le.Z)(t,e);var r=zC(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"type","ImageLayer"),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new UC[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={image:{}};return a[i]}},{key:"getModelType",value:function(){return"image"}}]),t}(Rp);function VC(e){var r=jC();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function jC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var HC=`
#define Animate 0.0
#define LineTexture 1.0
uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};
in vec2 v_iconMapUV;
in vec4 v_lineData;
in vec4 v_color;
//dash
in vec4 v_dash_array;
in float v_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  outputColor = v_color;
  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_lineData.b, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;
  }

  // \u5F53\u5B58\u5728\u8D34\u56FE\u65F6\u5728\u5E95\u8272\u4E0A\u8D34\u4E0A\u8D34\u56FE
  if(u_line_texture == LineTexture) { // while load texture
    float arcRadio = smoothstep( 0.0, 1.0, (v_lineData.r / segmentNumber));
    // float arcRadio = smoothstep( 0.0, 1.0, d_distance_ratio);

    float count = v_lineData.g; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);
    float v = v_lineData.a; // \u6A2A\u5411 v
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;

    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
    
  } else {
     outputColor = filterColor(outputColor);
  }
}`,WC=`#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_lineDir: 1.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_blur : 0.9;
  float u_line_type: 0.0;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_lineData;
//dash
out vec4 v_dash_array;
out float v_distance_ratio;


#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}
vec2 midPoint(vec2 source, vec2 target, float arcThetaOffset) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = arcThetaOffset;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  if(u_lineDir == 1.0) { // \u6B63\u5411
    return mid;
  } else { // \u9006\u5411
    // (mid + vmin)/2 = (s + t)/2
    vec2 vmid = source + target - mid;
    return vmid;
  }
  // return mid;
}
float getSegmentRatio(float index) {
    // dash: index / (segmentNumber - 1.);
    // normal: smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    return smoothstep(0.0, 1.0, index / (segmentNumber - 1.));
    //  return index / (segmentNumber - 1.);
}
vec2 interpolate (vec2 source, vec2 target, float t, float arcThetaOffset) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  vec2 mid = midPoint(source, target, arcThetaOffset);
  vec3 x = vec3(source.x, mid.x, target.x);
  vec3 y = vec3(source.y, mid.y, target.y);
  return vec2(bezier3(x ,t), bezier3(y,t));
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;

  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9



  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);

  //\u8BA1\u7B97dashArray\u548CdistanceRatio \u8F93\u51FA\u5230\u7247\u5143
  vec2 s = source;
  vec2 t = target;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    s = unProjCustomCoord(source);
    t = unProjCustomCoord(target);
  }
  float total_Distance = pixelDistance(s, t) / 2.0 * PI;
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  v_distance_ratio = segmentIndex / segmentNumber;

  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));
  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  float d_distance_ratio;
  
  if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
      if(u_lineDir != 1.0) {
        d_distance_ratio = 1.0 - d_distance_ratio;
      }
  }

  v_lineData.b = d_distance_ratio;

  vec4 curr = project_position(vec4(interpolate(source, target, segmentRatio, thetaOffset), 0.0, 1.0));
  vec4 next = project_position(vec4(interpolate(source, target, nextSegmentRatio, thetaOffset), 0.0, 1.0));

  
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));


  float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
  v_lineData.r = d_segmentIndex;

  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F

    float arcDistrance = length(source - target); // \u8D77\u59CB\u70B9\u548C\u7EC8\u70B9\u7684\u8DDD\u79BB
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      arcDistrance *= 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      // arcDistrance *= 8.0;
      arcDistrance = project_pixel_allmap(arcDistrance);
    }
    v_iconMapUV = a_iconMapUV;

    float pixelLen = project_pixel_texture(u_icon_step); // \u8D34\u56FE\u6CBF\u5F27\u7EBF\u65B9\u5411\u7684\u957F\u5EA6 - \u968F\u5730\u56FE\u7F29\u653E\u6539\u53D8
    float texCount = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    v_lineData.g = texCount;

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size); // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB
    v_lineData.a = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));

  setPickingColor(a_PickingColor);
}
`,GC={solid:0,dash:1},lF=ui.isNumber,XC=function(e){(0,Le.Z)(t,e);var r=VC(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:I.NEAREST,min:I.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,y=d===void 0?"solid":d,b=i.dashArray,T=b===void 0?[10,5]:b,M=i.forward,P=M===void 0?!0:M,k=i.lineTexture,H=k===void 0?!1:k,q=i.iconStep,ae=q===void 0?100:q,Se=i.segmentNumber,ze=Se===void 0?30:Se,it=this.layer.getLayerConfig(),ut=it.animateOption,ot=T;y!=="dash"&&(ot=[0,0]),ot.length===2&&ot.push(0,0);var Ct=0,Xt=[0,0,0,0],Sr=[0,0,0,0];a&&s&&(Xt=vi(a),Sr=vi(s),Ct=1),this.rendererService.getDirty()&&this.texture.bind();var _r={u_animate:this.animateOption2Array(ut),u_dash_array:ot,u_sourceColor:Xt,u_targetColor:Sr,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:ze,u_lineDir:P?1:-1,u_icon_step:ae,u_line_texture:H?1:0,u_textureBlend:f==="normal"?0:1,u_blur:.9,u_line_type:GC[y||"solid"],u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:Ct},Wr=this.getUniformsBufferInfo(_r);return Wr}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:HC,vert:WC,type:""}}},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y,b,T,M;return _e().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return this.initUniformsBuffer(),s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,d=this.getShaders(),y=d.frag,b=d.vert,T=d.type,k.next=5,this.layer.buildLayerModel({moduleName:"lineArc2d"+T,vertexShader:b,fragmentShader:y,inject:this.getInject(),triangulation:$0,depth:{enable:!1},styleOption:{segmentNumber:f}});case 5:return M=k.sent,k.abrupt("return",[M]);case 7:case"end":return k.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Mn.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Mn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},y=d.x,b=d.y;return[y,b]}}})}}]),t}(Na);function $C(e){var r=YC();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function YC(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};

// varying vec2 v_normal;
in vec4 v_dash_array;
in vec4 v_color;
in vec4 v_line_data;
in float v_segmentIndex;
in vec2 v_iconMapUV;

out vec4 outputColor;

#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_line_data.g; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  outputColor = v_color;

  if(u_line_type == LineTypeDash) {
    float flag = 0.;
    float dashLength = mod(d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      flag = 1.;
    }
    outputColor.a *=flag;
  }

  if(u_animate.x == Animate && u_line_texture != LineTexture) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);

      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      // alpha = smoothstep(0., 1., alpha);
      alpha = clamp(alpha, 0.0, 1.0);
      outputColor.a *= alpha;

      // u_animate 
      // x enable
      // y duration
      // z interval
      // w trailLength
  }

  if(u_line_texture == LineTexture && u_line_type != LineTypeDash) { // while load texture
    // float arcRadio = smoothstep( 0.0, 1.0, (v_segmentIndex / segmentNumber));
    float arcRadio = v_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float time = 0.0;
    if(u_animate.x == Animate) {
      time = u_time / u_animate.y;
    }
    float redioCount = arcRadio * count;

    float u = fract(redioCount - time);

    float v = v_line_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_animate.x == Animate) {
      float currentPlane = floor(redioCount - time);
      float textureStep = floor(count * u_animate.z);
      float a = mod(currentPlane, textureStep);
      if(a < textureStep - 1.0) {
        pattern = vec4(0.0);
      }
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
          discard;
        } else {
          outputColor = filterColor(pattern);
        }
    }

  } else {
    outputColor = filterColor(outputColor);
  }
}
`,KC=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_globel;
  float u_globel_radius;
  float u_global_height: 10;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0.0;
};
out vec4 v_color;
out vec4 v_dash_array;
out float v_segmentIndex;
out vec2 v_iconMapUV;
out vec4 v_line_data;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return smoothstep(0.0, 1.0, index / (segmentNumber - 1.0));
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
    mix(source, target, segmentRatio),
    sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);

  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size) / 2.0;

  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
  dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}

float torad(float deg) {
  return (deg / 180.0) * acos(-1.0);
}

vec3 lglt2xyz(vec2 lnglat) {
  float pi = 3.1415926;
  // + Math.PI/2 \u662F\u4E3A\u4E86\u5BF9\u9F50\u5750\u6807
  float lng = torad(lnglat.x) + pi / 2.0;
  float lat = torad(lnglat.y);

  // \u624B\u52A8\u589E\u52A0\u4E00\u4E9B\u504F\u79FB\uFF0C\u51CF\u8F7B\u9762\u7684\u51B2\u7A81
  float radius = u_globel_radius;

  float z = radius * cos(lat) * cos(lng);
  float x = radius * cos(lat) * sin(lng);
  float y = radius * sin(lat);
  return vec3(x, y, z);
}

void main() {
  //vs\u4E2D\u8BA1\u7B97\u6E10\u53D8\u8272
  if(u_linearColor==1.0){
    float d_segmentIndex = a_Position.x + 1.0; // \u5F53\u524D\u9876\u70B9\u5728\u5F27\u7EBF\u4E2D\u6240\u5904\u7684\u5206\u6BB5\u4F4D\u7F6E
    v_color = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
  }
  else{
    v_color = a_Color;
  }
  v_color.a = v_color.a * opacity;
  vec2 source = project_position(vec4(a_Instance.rg, 0, 0)).xy;
  vec2 target = project_position(vec4(a_Instance.ba, 0, 0)).xy;
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  float d_distance_ratio;
   if(u_line_type == LineTypeDash) {
    d_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / (total_Distance / segmentNumber * segmentIndex);
  }
    if(u_animate.x == Animate) {
      d_distance_ratio = segmentIndex / segmentNumber;
  }
  v_line_data.g = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  vec3 curr = getPos(source, target, segmentRatio);
  vec3 next = getPos(source, target, nextSegmentRatio);
  vec2 offset = getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y);
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);


  v_segmentIndex = a_Position.x;
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  

    float arcDistrance = length(source - target);
    float pixelLen =  project_pixel_texture(u_icon_step);
    v_line_data.b = floor(arcDistrance/pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    vec2 projectOffset = project_pixel(offset);
    float lineOffsetWidth = length(projectOffset + projectOffset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + project_pixel(offset), curr.z * thetaOffset, 1.0));

  // \u5730\u7403\u6A21\u5F0F
  if(u_globel > 0.0) {
    vec3 startLngLat = lglt2xyz(a_Instance.rg);
    vec3 endLngLat = lglt2xyz(a_Instance.ba);
    float globalRadius = length(startLngLat);

    vec3 lineDir = normalize(endLngLat - startLngLat);
    vec3 midPointDir = normalize((startLngLat + endLngLat)/2.0);

    // \u7EBF\u7684\u504F\u79FB
    vec3 lnglatOffset = cross(lineDir, midPointDir) * a_Position.y;
    // \u8BA1\u7B97\u8D77\u59CB\u70B9\u548C\u7EC8\u6B62\u70B9\u7684\u8DDD\u79BB
    float lnglatLength = length(a_Instance.rg - a_Instance.ba)/50.0;
    // \u8BA1\u7B97\u98DE\u7EBF\u5404\u4E2A\u8282\u70B9\u76F8\u5E94\u7684\u9AD8\u5EA6
    float lineHeight = u_global_height * (-4.0*segmentRatio*segmentRatio + 4.0 * segmentRatio) * lnglatLength;
    // \u5730\u7403\u70B9\u4F4D
    vec3 globalPoint = normalize(mix(startLngLat, endLngLat, segmentRatio)) * (globalRadius + lineHeight) + lnglatOffset * a_Size;
    
    gl_Position = u_ViewProjectionMatrix * vec4(globalPoint, 1.0);
  }
 

  setPickingColor(a_PickingColor);
}
`,QC={solid:0,dash:1},O1=function(e){(0,Le.Z)(t,e);var r=$C(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:I.NEAREST,min:I.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,y=d===void 0?"solid":d,b=i.dashArray,T=b===void 0?[10,5]:b,M=i.lineTexture,P=M===void 0?!1:M,k=i.iconStep,H=k===void 0?100:k,q=i.segmentNumber,ae=q===void 0?30:q,Se=i.globalArcHeight,ze=Se===void 0?10:Se,it=this.layer.getLayerConfig(),ut=it.animateOption;T.length===2&&T.push(0,0);var ot=0,Ct=[0,0,0,0],Xt=[0,0,0,0];a&&s&&(Ct=vi(a),Xt=vi(s),ot=1),this.rendererService.getDirty()&&this.texture.bind();var Sr={u_animate:this.animateOption2Array(ut),u_dash_array:T,u_sourceColor:Ct,u_targetColor:Xt,u_textSize:[1024,this.iconService.canvasHeight||128],u_globel:this.mapService.version==="GLOBEL"?1:0,u_globel_radius:m1,u_global_height:ze,segmentNumber:ae,u_line_type:QC[y]||0,u_icon_step:H,u_line_texture:P?1:0,u_textureBlend:f==="normal"?0:1,u_time:this.layer.getLayerAnimateTime()||0,u_linearColor:ot},_r=this.getUniformsBufferInfo(Sr);return _r}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"getShaders",value:function(){return{frag:qC,vert:KC,type:""}}},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y,b,T,M;return _e().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,d=this.getShaders(),y=d.frag,b=d.vert,T=d.type,k.next=4,this.layer.buildLayerModel({moduleName:"lineArc3d"+T,vertexShader:b,fragmentShader:y,inject:this.getInject(),triangulation:$0,styleOption:{segmentNumber:f}});case 4:return M=k.sent,k.abrupt("return",[M]);case 6:case"end":return k.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Mn.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Mn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},y=d.x,b=d.y;return[y,b]}}})}}]),t}(Na),k1={circle:2,triangle:2,diamond:4,rect:2,classic:3,halfTriangle:2,none:0},Vl=1/2;function JC(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?1:i;return{vertices:[0,Vl*e,1*e*n,-(a+Vl)*e,1*e*n,(a-Vl)*e,0,Vl*e,1*e*n,-(a+Vl)*e,1*e*n,(a-Vl)*e],indices:[3,4,5],outLineIndices:[0,1,2],normals:[1*e,-2*e,1,-2*e,1.5*e,1,1*e,1.5*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function e3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,1*e*n,1*a,1*e*n,-1*a,0,0,1*e*n,1*a,1*e*n,-1*a],outLineIndices:[0,1,2],indices:[3,4,5],normals:[0,-1.5*e,1,2,1*e,1,-2,1*e,1,0,0,0,0,0,0,0,0,0],dimensions:2}}function t3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?2:i;return{vertices:[0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2,0,a/2,e*n*1,a/2,e*n*1,-a/2,0,-a/2],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function r3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a,0,0,1*n*e,.5*a,2*n*e,0,1*n*e,-.5*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function n3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?3:i;return{vertices:[0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a,0,0,2*e*n,1*a,1.5*e*n,0,2*e*n,-1*a],dimensions:2,indices:[4,5,6,4,6,7],outLineIndices:[0,1,2,0,2,3],normals:[0,-e,1,1,0,1,0,-e,1,-1,-0,1,0,0,0,0,0,0,0,0,0,0,0,0]}}function i3(e,r){var t=r.width,n=t===void 0?2:t,i=r.height,a=i===void 0?2:i,s=H0(),l=Oo().flatten([s]),f=Oo()(l.vertices,l.holes,l.dimensions),d=s.map(function(y){return[y[0]*n*e,y[1]*a]}).flat();return{vertices:[].concat((0,Jt.Z)(d),(0,Jt.Z)(d)),dimensions:2,indices:f.map(function(y){return y+s.length}),outLineIndices:f,normals:[].concat((0,Jt.Z)(s.map(function(y){return[y[1]*a,y[0]*n*e,1]}).flat()),(0,Jt.Z)(new Array(s.length*3).fill(0)))}}function a3(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0,t=arguments.length>2?arguments[2]:void 0,n=(0,js.Z)(t.source)==="object"?t.source.type:t.source,i=(0,js.Z)(t.target)==="object"?t.target.type:t.target,a=(0,js.Z)(t.source)==="object"?t.source:{},s=a.width,l=s===void 0?n?k1[n]:0:s,f=a.height,d=f===void 0?2:f,y=(0,js.Z)(t.target)==="object"?t.target:{},b=y.width,T=b===void 0?i?k1[i]:0:b,M=y.height,P=M===void 0?2:M;return{vertices:[0,Vl,1*l].concat((0,Jt.Z)(e),[1,Vl,-1*T],(0,Jt.Z)(e),[1,-Vl,-1*T],(0,Jt.Z)(e),[0,-Vl,1*l],(0,Jt.Z)(e),[0,Vl,1*l],(0,Jt.Z)(e),[1,Vl,-1*T],(0,Jt.Z)(e),[1,-Vl,-1*T],(0,Jt.Z)(e),[0,-Vl,1*l],(0,Jt.Z)(e)),outLineIndices:[0,1,2,0,2,3].map(function(k){return k+r}),indices:[4,5,6,4,6,7].map(function(k){return k+r}),normals:[1,-1,1,1,1,1,-1,0,1,-1,0,1,0,0,0,0,0,0,0,0,0,0,0,0],dimensions:2}}function D1(e,r){var t=(0,js.Z)(e)==="object"?e.type:e,n=r==="source"?1:-1,i=(0,js.Z)(e)==="object"?e:{};switch(t){case"circle":return i3(n,i);case"triangle":return e3(n,i);case"diamond":return r3(n,i);case"rect":return t3(n,i);case"classic":return n3(n,i);case"halfTriangle":return JC(n,i);default:return{vertices:[],indices:[],normals:[],dimensions:2,outLineIndices:[],outLineNormals:[]}}}function o3(e){var r=e.coordinates.flat(),t=1,n=1;return{vertices:[1,0,0].concat((0,Jt.Z)(r),[1,2,-3],(0,Jt.Z)(r),[1,1,-3],(0,Jt.Z)(r),[0,1,0],(0,Jt.Z)(r),[0,0,0],(0,Jt.Z)(r),[1,0,0],(0,Jt.Z)(r),[1,2,-3],(0,Jt.Z)(r),[1,1,-3],(0,Jt.Z)(r),[0,1,0],(0,Jt.Z)(r),[0,0,0],(0,Jt.Z)(r)),normals:[-t,2*n,1,2*n,-n,1,n,-n,1,n,-n,1,-t,-n,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0],indices:[0,1,2,0,2,3,0,3,4,5,6,7,5,7,8,5,8,9],size:7}}function s3(e,r){return r?u3(e,r):o3(e)}function u3(e,r){var t=e.coordinates.flat(),n=r,i=n.target,a=i===void 0?"classic":i,s=n.source,l=s===void 0?"circle":s,f=L1(D1(l,"source"),t,0,0),d=a3(t,f.vertices.length/7,r),y=L1(D1(a,"target"),t,1,f.vertices.length/7+d.vertices.length/7),b={vertices:[].concat((0,Jt.Z)(f.vertices),(0,Jt.Z)(d.vertices),(0,Jt.Z)(y.vertices)),indices:[].concat((0,Jt.Z)(f.outLineIndices),(0,Jt.Z)(d.outLineIndices),(0,Jt.Z)(y.outLineIndices),(0,Jt.Z)(f.indices),(0,Jt.Z)(d.indices),(0,Jt.Z)(y.indices)),normals:[].concat((0,Jt.Z)(f.normals),(0,Jt.Z)(d.normals),(0,Jt.Z)(y.normals)),size:7};return b}function L1(e,r){for(var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,n=arguments.length>3&&arguments[3]!==void 0?arguments[3]:0,i=[],a=e.vertices,s=e.indices,l=e.dimensions,f=e.outLineIndices,d=0;d<a.length;d+=l)i.push.apply(i,[t,a[d+1],a[d]].concat((0,Jt.Z)(r)));return(0,W.Z)((0,W.Z)({},e),{},{vertices:i,indices:s.map(function(y){return y+n}),outLineIndices:f.map(function(y){return y+n})})}function l3(e){var r=c3();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function c3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var f3=`// #extension GL_OES_standard_derivatives : enable

in vec4 v_color;
out vec4 outputColor;


// line texture

#pragma include "picking"

void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,h3=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniorm {
  float u_gap_width: 1.0;
  float u_stroke_width: 1.0;
  float u_stroke_opacity: 1.0;
};

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

out vec4 v_color;

vec2 project_pixel_offset(vec2 offsets) {

   vec2 data = project_pixel(offsets);
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
    return data;
  }

  return vec2(data.x, -data.y);;
}

vec2 line_dir(vec2 target, vec2 source) {

   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return normalize(target - source);
  }
  return normalize(ProjectFlat(target) - ProjectFlat(source));
}

float flag_gap() {
   if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
     return 1.;
  }
  return -1.;

}


void main() {

// \u900F\u660E\u5EA6\u8BA1\u7B97
  vec2 source = a_Instance.rg;  // \u8D77\u59CB\u70B9
  vec2 target =  a_Instance.ba; // \u7EC8\u70B9
  vec2 flowlineDir = line_dir(target,source);
  vec2 perpendicularDir = vec2(-flowlineDir.y, flowlineDir.x); // mapbox || \u9AD8\u5FB7
   
  vec2 position = mix(source, target, a_Position.x);
  
  float lengthCommon = length(project_position(vec4(target,0,1)) - project_position(vec4(source,0,1)));  //    
  vec2 offsetDistances = a_Size.x * project_pixel_offset(vec2(a_Position.y, a_Position.z)); // Mapbox || \u9AD8\u5FB7
  vec2 limitedOffsetDistances = clamp(   
   offsetDistances,
   project_pixel(-lengthCommon*.2), project_pixel(lengthCommon*.2)
  );


  float startOffsetCommon = project_pixel(offsets[0]);
  float endOffsetCommon = project_pixel(offsets[1]);
  float endpointOffset = mix(
    clamp(startOffsetCommon, 0.0, lengthCommon*.2),
    -clamp(endOffsetCommon, 0.0, lengthCommon*.2),
    a_Position.x
  );

  vec2 normalsCommon =  u_stroke_width * project_pixel_offset(vec2(a_Normal.x, a_Normal.y)); // mapbox || \u9AD8\u5FB7

  float gapCommon = flag_gap() * project_pixel(u_gap_width);
  vec3 offsetCommon = vec3(
    flowlineDir * (limitedOffsetDistances[1] + normalsCommon.y + endpointOffset * 1.05) -
    perpendicularDir *  (limitedOffsetDistances[0] + gapCommon + normalsCommon.x),
    0.0
  );

  vec4 project_pos = project_position(vec4(position.xy, 0, 1.0));

  vec4 fillColor = vec4(a_Color.rgb, a_Color.a * opacity);
  v_color = mix(fillColor, vec4(u_stroke.xyz, u_stroke.w * fillColor.w * u_stroke_opacity), a_Normal.z);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy +  offsetCommon.xy, 0., 1.0));



  setPickingColor(a_PickingColor);
}
`,p3=function(e){(0,Le.Z)(t,e);var r=l3(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.gapWidth,s=a===void 0?2:a,l=i.strokeWidth,f=l===void 0?1:l,d=i.strokeOpacity,y=d===void 0?1:d,b={u_gap_width:s,u_stroke_width:f,u_stroke_opacity:y},T=this.getUniformsBufferInfo(b);return T}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"flow_line",vertexShader:h3,fragmentShader:f3,inject:this.getInject(),triangulation:s3,styleOption:this.layer.getLayerConfig().symbol,primitive:I.TRIANGLES,depth:{enable:!1},pick:!1});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0],l[1]]:[l,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Mn.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:4,update:function(a,s,l){return[l[3],l[4],l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Mn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a,s,l,f,d){return d}}})}}]),t}(Na);function v3(e){var r=m3();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function m3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var g3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

in vec4 v_line_data;
in vec2 v_iconMapUV;
in vec4 v_dash_array;
in float v_distance_ratio;
in vec4 v_color;

out vec4 outputColor;
#pragma include "picking"
#pragma include "project"
#pragma include "projection"

void main() {

  float animateSpeed = 0.0;
  float d_segmentIndex = v_line_data.g;
  
  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_segmentIndex/segmentNumber);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
    outputColor = v_color;
  }

  // float blur = 1.- smoothstep(u_blur, 1., length(v_normal.xy));
  // float blur = smoothstep(1.0, u_blur, length(v_normal.xy));
  if(u_line_type == LineTypeDash) {
    float dashLength = mod(v_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z)) {
      // \u5B9E\u7EBF\u90E8\u5206
    } else {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u52A8\u753B\u6A21\u5F0F
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
      float alpha =1.0 - fract( mod(1.0- v_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + u_time / u_animate.y);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  // \u8BBE\u7F6E\u5F27\u7EBF\u7684\u8D34\u56FE
  if(LineTexture == u_line_texture && u_line_type != LineTypeDash) { 
    float arcRadio = smoothstep( 0.0, 1.0, (d_segmentIndex / (segmentNumber - 1.0)));
    // float arcRadio = d_segmentIndex / (segmentNumber - 1.0);
    float count = v_line_data.b; // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF
    float u = fract(arcRadio * count - animateSpeed * count);
    // float u = fract(arcRadio * count - animateSpeed);
    if(u_animate.x == Animate) {
      u = outputColor.a/v_color.a;
    }

    float v = v_line_data.a; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);
    
    // \u8BBE\u7F6E\u8D34\u56FE\u548C\u5E95\u8272\u7684\u53E0\u52A0\u6A21\u5F0F
    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  } else {
    outputColor = filterColor(outputColor);
  }

  // gl_FragColor = filterColor(gl_FragColor);
}`,_3=`#define LineTypeSolid 0.0
#define LineTypeDash 1.0
#define Animate 0.0
#define LineTexture 1.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 12) in vec4 a_Instance;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array: [10.0, 5., 0, 0];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float segmentNumber;
  float u_line_type: 0.0;
  float u_icon_step: 100;
  float u_line_texture: 0.0;
  float u_textureBlend;
  float u_time;
  float u_linearColor: 0;
};

out vec4 v_dash_array;
out vec4 v_color;
out vec2 v_iconMapUV;
out vec4 v_line_data;
out float v_distance_ratio;

#pragma include "projection"
#pragma include "project"
#pragma include "picking"

float maps (float value, float start1, float stop1, float start2, float stop2) {
  return start2 + (stop2 - start2) * ((value - start1) / (stop1 - start1));
}

float getSegmentRatio(float index) {
  return index / (segmentNumber - 1.);
}

float paraboloid(vec2 source, vec2 target, float ratio) {
  vec2 x = mix(source, target, ratio);
  vec2 center = mix(source, target, 0.5);
  float dSourceCenter = distance(source, center);
  float dXCenter = distance(x, center);
  return (dSourceCenter + dXCenter) * (dSourceCenter - dXCenter);
}

vec3 getPos(vec2 source, vec2 target, float segmentRatio) {
  float vertex_height = paraboloid(source, target, segmentRatio);

  return vec3(
  mix(source, target, segmentRatio),
  sqrt(max(0.0, vertex_height))
  );
}
vec2 getExtrusionOffset(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
  vec2 offset = dir_screenspace * offset_direction * setPickingSize(a_Size)/ 2.0;
  return offset;
}
vec2 getNormal(vec2 line_clipspace, float offset_direction) {
  // normalized direction of the line
  vec2 dir_screenspace = normalize(line_clipspace);
  // rotate by 90 degrees
   dir_screenspace = vec2(-dir_screenspace.y, dir_screenspace.x);
   return reverse_offset_normal(vec3(dir_screenspace,1.0)).xy * sign(offset_direction);
}
float getAngularDist (vec2 source, vec2 target) {
  vec2 delta = source - target;
  vec2 sin_half_delta = sin(delta / 2.0);
  float a =
    sin_half_delta.y * sin_half_delta.y +
    cos(source.y) * cos(target.y) *
    sin_half_delta.x * sin_half_delta.x;
  return 2.0 * atan(sqrt(a), sqrt(1.0 - a));
}

vec2 midPoint(vec2 source, vec2 target) {
  vec2 center = target - source;
  float r = length(center);
  float theta = atan(center.y, center.x);
  float thetaOffset = 0.314;
  float r2 = r / 2.0 / cos(thetaOffset);
  float theta2 = theta + thetaOffset;
  vec2 mid = vec2(r2*cos(theta2) + source.x, r2*sin(theta2) + source.y);
  return mid;
}
float bezier3(vec3 arr, float t) {
  float ut = 1. - t;
  return (arr.x * ut + arr.y * t) * ut + (arr.y * ut + arr.z * t) * t;
}

vec2 interpolate (vec2 source, vec2 target, float angularDist, float t) {
  // if the angularDist is PI, linear interpolation is applied. otherwise, use spherical interpolation
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    vec2 mid = midPoint(source, target);
    vec3 x = vec3(source.x, mid.x, target.x);
    vec3 y = vec3(source.y, mid.y, target.y);
    return vec2(bezier3(x ,t), bezier3(y,t));
  }
  else {
    if(abs(angularDist - PI) < 0.001) {
      return (1.0 - t) * source + t * target;
    }
    float a = sin((1.0 - t) * angularDist) / sin(angularDist);
    float b = sin(t * angularDist) / sin(angularDist);
    vec2 sin_source = sin(source);
    vec2 cos_source = cos(source);
    vec2 sin_target = sin(target);
    vec2 cos_target = cos(target);
    float x = a * cos_source.y * cos_source.x + b * cos_target.y * cos_target.x;
    float y = a * cos_source.y * sin_source.x + b * cos_target.y * sin_target.x;
    float z = a * sin_source.y + b * sin_target.y;
    return vec2(atan(y, x), atan(z, sqrt(x * x + y * y)));
  }
}

void main() {
  v_color = a_Color;
  v_color.a = v_color.a * opacity;
  vec2 source = radians(a_Instance.rg);
  vec2 target = radians(a_Instance.ba);
  float angularDist = getAngularDist(source, target);
  float segmentIndex = a_Position.x;
  float segmentRatio = getSegmentRatio(segmentIndex);
  float indexDir = mix(-1.0, 1.0, step(segmentIndex, 0.0));

  if(u_line_type == LineTypeDash) {
    v_distance_ratio = segmentIndex / segmentNumber;
    vec2 s = source;
    vec2 t = target;
    
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
      s = unProjCustomCoord(source);
      t = unProjCustomCoord(target);
    }
    float total_Distance = pixelDistance(s, t) / 2.0 * PI;
    total_Distance = total_Distance*16.0; // total_Distance*16.0 \u8C03\u6574\u9ED8\u8BA4\u7684\u6548\u679C
    v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / total_Distance;
  }

  if(u_animate.x == Animate) {
      v_distance_ratio = segmentIndex / segmentNumber;
  }

  float nextSegmentRatio = getSegmentRatio(segmentIndex + indexDir);
  v_distance_ratio = segmentIndex / segmentNumber;
  vec4 curr = project_position(vec4(degrees(interpolate(source, target, angularDist, segmentRatio)), 0.0, 1.0));
  vec4 next = project_position(vec4(degrees(interpolate(source, target, angularDist, nextSegmentRatio)), 0.0, 1.0));
  // v_normal = getNormal((next.xy - curr.xy) * indexDir, a_Position.y);
  vec2 offset = project_pixel(getExtrusionOffset((next.xy - curr.xy) * indexDir, a_Position.y));
  //  vec4 project_pos = project_position(vec4(curr.xy, 0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(curr.xy + offset, curr.z, 1.0));

  v_line_data.g = a_Position.x; // \u8BE5\u9876\u70B9\u5728\u5F27\u7EBF\u4E0A\u7684\u5206\u6BB5\u6392\u5E8F
  if(LineTexture == u_line_texture) { // \u5F00\u542F\u8D34\u56FE\u6A21\u5F0F  
    // float mapZoomScale = u_CoordinateSystem !== COORDINATE_SYSTEM_P20_2?10000000.0:1.0;
    float d_arcDistrance = length(source - target);
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20) { // amap
      d_arcDistrance = d_arcDistrance * 1000000.0;
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) { // mapbox
      d_arcDistrance = project_pixel_allmap(d_arcDistrance);
    }
    float d_pixelLen = project_pixel(u_icon_step)/8.0;
    v_line_data.b = floor(d_arcDistrance/d_pixelLen); // \u8D34\u56FE\u5728\u5F27\u7EBF\u4E0A\u91CD\u590D\u7684\u6570\u91CF

    float lineOffsetWidth = length(offset + offset * sign(a_Position.y)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB
    float linePixelSize = project_pixel(a_Size);  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB
    v_line_data.a = lineOffsetWidth/linePixelSize;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    v_iconMapUV = a_iconMapUV;
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(curr.xy + offset, 0, 1.0));
  setPickingColor(a_PickingColor);
}

`,y3={solid:0,dash:1},x3=function(e){(0,Le.Z)(t,e);var r=v3(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:I.NEAREST,min:I.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,y=d===void 0?"solid":d,b=i.dashArray,T=b===void 0?[10,5]:b,M=i.lineTexture,P=M===void 0?!1:M,k=i.iconStep,H=k===void 0?100:k,q=i.segmentNumber,ae=q===void 0?30:q,Se=this.layer.getLayerConfig(),ze=Se.animateOption;T.length===2&&T.push(0,0),this.rendererService.getDirty()&&this.texture.bind();var it=0,ut=[0,0,0,0],ot=[0,0,0,0];a&&s&&(ut=vi(a),ot=vi(s),it=1);var Ct=this.layer.getLayerAnimateTime();isNaN(Ct)&&(Ct=0);var Xt={u_animate:this.animateOption2Array(ze),u_dash_array:T,u_sourceColor:ut,u_targetColor:ot,u_textSize:[1024,this.iconService.canvasHeight||128],segmentNumber:ae,u_line_type:y3[y]||0,u_icon_step:H,u_line_texture:P?1:0,u_textureBlend:f==="normal"?0:1,u_time:Ct,u_linearColor:it},Sr=this.getUniformsBufferInfo(Xt);return Sr}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.segmentNumber,f=l===void 0?30:l,b.next=3,this.layer.buildLayerModel({moduleName:"lineGreatCircle",vertexShader:_3,fragmentShader:g3,triangulation:$0,styleOption:{segmentNumber:f},inject:this.getInject(),depth:{enable:!1}});case 3:return d=b.sent,b.abrupt("return",[d]);case 5:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"instance",type:Mn.Attribute,descriptor:{name:"a_Instance",shaderLocation:12,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:4,update:function(s,l,f){return[f[3],f[4],f[5],f[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Mn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},y=d.x,b=d.y;return[y,b]}}})}}]),t}(Na),cF=function(e){return e[e.solid=0]="solid",e[e.dash=1]="dash",e}({}),B1=function(e){return e.VERTICAL="vertical",e.HORIZONTAL="horizontal",e}({}),b3=function(e){return e.NORMAL="normal",e.REPLACE="replace",e}({}),Y0=function(e){return e[e.pixel=0]="pixel",e[e.meter=1]="meter",e}({}),fF=function(e){return e.ALWAYS="always",e.DRAGEND="dragend",e}({});function E3(e){var r=S3();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function S3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var A3=`// #extension GL_OES_standard_derivatives : enable
#define Animate 0.0
#define LineTexture 1.0

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};

in vec4 v_color;
in vec4 v_stroke;
in vec2 v_iconMapUV;
in vec4 v_texture_data;
// dash
in vec4 v_dash_array;
in float v_d_distance_ratio;

out vec4 outputColor;
#pragma include "picking"

// [animate, duration, interval, trailLength],
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_d_distance_ratio, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_texture_data.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  if(u_linearDir < 1.0) {
    d_distance_ratio = v_texture_data.a;
  }
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, d_distance_ratio);
    outputColor.a *= v_color.a;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }
  // anti-alias
  // float blur = 1.0 - smoothstep(u_blur, 1., length(v_normal.xy));
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_texture_data.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_texture_data.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_texture_data.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // v = max(smoothstep(0.95, 1.0, v), v);
    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
     vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor += pattern;
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = pattern;
    }
  } 

  float v = v_texture_data.a;
  float strokeWidth = min(0.5, u_strokeWidth);
  // \u7ED8\u5236 border
  if(strokeWidth > 0.01) {
    float borderOuterWidth = strokeWidth / 2.0;


    if(v >= 1.0 - strokeWidth || v <= strokeWidth) {
      if(v > strokeWidth) { // \u5916\u4FA7
        float linear = smoothstep(0.0, 1.0, (v - (1.0 - strokeWidth))/strokeWidth);
        //  float linear = step(0.0, (v - (1.0 - borderWidth))/borderWidth);
        outputColor.rgb = mix(outputColor.rgb, v_stroke.rgb, linear);
      } else if(v <= strokeWidth) {
        float linear = smoothstep(0.0, 1.0, v/strokeWidth);
        outputColor.rgb = mix(v_stroke.rgb, outputColor.rgb, linear);
      }
    }

    if(v < borderOuterWidth) {
      outputColor.a = mix(0.0, outputColor.a, v/borderOuterWidth);
    } else if(v > 1.0 - borderOuterWidth) {
      outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - borderOuterWidth))/borderOuterWidth);
    }
  }

  // blur
  float blurV = v_texture_data.a;
  if(blurV < 0.5) {
    outputColor.a *= mix(u_blur.r, u_blur.g, blurV/0.5);
  } else {
    outputColor.a *= mix(u_blur.g, u_blur.b, (blurV - 0.5)/0.5);
  }
  
  outputColor = filterColor(outputColor);
}
`,T3=`
#define Animate 0.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 10) in vec2 a_DistanceAndIndex;
layout(location = 9) in vec2 a_Size;
layout(location = 11) in float a_Total_Distance;
layout(location = 13) in vec3 a_Normal;
layout(location = 15) in float a_Miter;
layout(location = 14) in vec2 a_iconMapUV;

layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_dash_array;
  vec4 u_blur;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed: 0.0;
  float u_vertexScale: 1.0;
  float u_raisingHeight: 0.0;
  float u_strokeWidth: 0.0;
  float u_textureBlend;
  float u_line_texture;
  float u_linearDir: 1.0;
  float u_linearColor: 0;
  float u_time;
};
#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out vec4 v_stroke;
//dash
out vec4 v_dash_array;
out float v_d_distance_ratio;

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_texture_data;

void main() {
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_Total_Distance;
  v_d_distance_ratio = a_DistanceAndIndex.x / a_Total_Distance;

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_iconMapUV = a_iconMapUV;
  d_texPixelLen = project_float_pixel(u_icon_step);
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  v_color = a_Color;
  v_color.a *= opacity;
  v_stroke = stroke;

  vec3 size = a_Miter * setPickingSize(a_Size.x) * reverse_offset_normal(a_Normal);
  
  vec2 offset = project_pixel(size.xy);

  float lineDistance = a_DistanceAndIndex.x;
  float currentLinePointRatio = lineDistance / a_Total_Distance;
 

  float lineOffsetWidth = length(offset + offset * sign(a_Miter)); // \u7EBF\u6A2A\u5411\u504F\u79FB\u7684\u8DDD\u79BB\uFF08\u5411\u4E24\u4FA7\u504F\u79FB\u7684\u548C\uFF09
  float linePixelSize = project_pixel(a_Size.x) * 2.0;  // \u5B9A\u70B9\u4F4D\u7F6E\u504F\u79FB\uFF0C\u6309\u5730\u56FE\u7B49\u7EA7\u7F29\u653E\u540E\u7684\u8DDD\u79BB \u5355\u4FA7 * 2
  float texV = lineOffsetWidth/linePixelSize; // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C
  
  v_texture_data = vec4(currentLinePointRatio, lineDistance, d_texPixelLen, texV);
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, a_Size.y, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5 vertex height
  float lineHeight = a_Size.y; // size \u7B2C\u4E8C\u4E2A\u53C2\u6570\u4EE3\u8868\u7684\u9AD8\u5EA6 [linewidth, lineheight]

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    lineHeight *= 0.2; // \u4FDD\u6301\u548C amap/mapbox \u4E00\u81F4\u7684\u6548\u679C
    h *= 0.2;
    if(u_heightfixed < 1.0) {
      lineHeight = project_pixel(a_Size.y);
    }
    gl_Position = u_Mvp * (vec4(project_pos.xy + offset, lineHeight + h + u_raisingHeight, 1.0));
  } else {
    // mapbox -  amap
    
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // mapbox
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      h *= mapboxZoomScale;
      h += u_raisingHeight * mapboxZoomScale;
      if(u_heightfixed > 0.0) {
        lineHeight *= mapboxZoomScale;
      }
      
    } else {
      // amap
      h += u_raisingHeight;
      // lineHeight \u9876\u70B9\u504F\u79FB\u9AD8\u5EA6
      if(u_heightfixed < 1.0) {
        lineHeight *= pow(2.0, 20.0 - u_Zoom);
      }
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, lineHeight + h, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,hF={solid:0,dash:1},F1=function(e){(0,Le.Z)(t,e);var r=E3(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"textureEventFlag",!1),(0,F.Z)((0,Re.Z)(n),"texture",n.createTexture2D({data:new Uint8Array([0,0,0,0]),width:1,height:1})),(0,F.Z)((0,Re.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.textures.length===0&&(n.textures=[n.texture]),n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:I.NEAREST,min:I.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128})}),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.lineType,y=d===void 0?"solid":d,b=i.dashArray,T=b===void 0?[10,5,0,0]:b,M=i.lineTexture,P=M===void 0?!1:M,k=i.iconStep,H=k===void 0?100:k,q=i.vertexHeightScale,ae=q===void 0?20:q,Se=i.strokeWidth,ze=Se===void 0?0:Se,it=i.raisingHeight,ut=it===void 0?0:it,ot=i.heightfixed,Ct=ot===void 0?!1:ot,Xt=i.linearDir,Sr=Xt===void 0?B1.VERTICAL:Xt,_r=i.blur,Wr=_r===void 0?[1,1,1,0]:_r,Cn=T;y!=="dash"&&(Cn=[0,0,0,0]),Cn.length===2&&Cn.push(0,0),this.rendererService.getDirty()&&this.texture&&this.texture.bind();var wi=this.layer.getLayerConfig(),ua=wi.animateOption,co=0,Xo=[0,0,0,0],No=[0,0,0,0];a&&s&&(Xo=vi(a),No=vi(s),co=1);var Ys={u_animate:this.animateOption2Array(ua),u_dash_array:Cn,u_blur:Wr,u_sourceColor:Xo,u_targetColor:No,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:H,u_heightfixed:Number(Ct),u_vertexScale:ae,u_raisingHeight:Number(ut),u_strokeWidth:ze,u_textureBlend:f===b3.NORMAL?0:1,u_line_texture:P?1:0,u_linearDir:Sr===B1.VERTICAL?1:0,u_linearColor:co,u_time:this.layer.getLayerAnimateTime()||0},bl=this.getUniformsBufferInfo(Ys);return bl}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.textureEventFlag||(this.textureEventFlag=!0,this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture)),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y,b,T,M;return _e().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,f=l===void 0?!1:l,d=this.getShaders(),y=d.frag,b=d.vert,T=d.type,this.layer.triangulation=Hf,k.next=5,this.layer.buildLayerModel({moduleName:"line"+T,vertexShader:b,fragmentShader:y,triangulation:Hf,inject:this.getInject(),depth:{enable:f}});case 5:return M=k.sent,k.abrupt("return",[M]);case 7:case"end":return k.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:A3,vert:T3,type:""}}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distanceAndIndex",type:Mn.Attribute,descriptor:{name:"a_DistanceAndIndex",shaderLocation:10,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(s,l,f,d,y,b){return b===void 0?[f[3],10]:[f[3],b]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Mn.Attribute,descriptor:{name:"a_Total_Distance",shaderLocation:11,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s,l,f){return[f[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0],f[1]]:[f,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Mn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(s,l,f,d,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Mn.Attribute,descriptor:{shaderLocation:15,name:"a_Miter",buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s,l,f){return[f[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Mn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:qn.UV,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},y=d.x,b=d.y;return[y,b]}}})}}]),t}(Na);function w3(e){var r=C3();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function C3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var R3=`
layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};
in float v_distanceScale;
in vec4 v_color;
//dash
in vec4 v_dash_array;

out vec4 outputColor;
void main() {
  if(u_dash_array!=vec4(0.0)){
    float dashLength = mod(v_distanceScale, v_dash_array.x + v_dash_array.y + v_dash_array.z + v_dash_array.w);
    if(!(dashLength < v_dash_array.x || (dashLength > (v_dash_array.x + v_dash_array.y) && dashLength <  v_dash_array.x + v_dash_array.y + v_dash_array.z))) {
      // \u865A\u7EBF\u90E8\u5206
      discard;
    };
  }
  if(u_linearColor==1.0){
    outputColor = mix(u_sourceColor, u_targetColor, v_distanceScale);
    outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  }
  else{
    outputColor = v_color;
  }
}
`,M3=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec4 a_SizeDistanceAndTotalDistance;

layout(std140) uniform commonUniorm {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec4 u_dash_array;
  float u_vertexScale: 1.0;
  float u_linearColor: 0;
};

#pragma include "projection"
#pragma include "picking"

out vec4 v_color;
out float v_distanceScale;
out vec4 v_dash_array;

void main() {
  //dash\u8F93\u51FA
  v_dash_array = pow(2.0, 20.0 - u_Zoom) * u_dash_array / a_SizeDistanceAndTotalDistance.a;

  v_color = a_Color; 
  v_distanceScale = a_SizeDistanceAndTotalDistance.b / a_SizeDistanceAndTotalDistance.a;
  v_color.a = v_color.a * opacity;
  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float h = float(a_Position.z) * u_vertexScale; // \u7EBF\u9876\u70B9\u7684\u9AD8\u5EA6 - \u517C\u5BB9\u4E0D\u5B58\u5728\u7B2C\u4E09\u4E2A\u6570\u503C\u7684\u60C5\u51B5

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, project_pixel(a_SizeDistanceAndTotalDistance.y) + h * 0.2, 1.0));
  } else {
    float lineHeight = a_SizeDistanceAndTotalDistance.y;
    // \u517C\u5BB9 mapbox \u5728\u7EBF\u9AD8\u5EA6\u4E0A\u7684\u6548\u679C\u8868\u73B0\u57FA\u672C\u4E00\u81F4
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      h *= 2.0/pow(2.0, 20.0 - u_Zoom);
    }

    // amap1.x
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // \u4FDD\u6301\u9AD8\u5EA6\u76F8\u5BF9\u4E0D\u53D8
      lineHeight *= pow(2.0, 20.0 - u_Zoom);
    }

    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, lineHeight + h, 1.0));
    gl_PointSize = 10.0;
  }
}
`,pF=ui.isNumber,I3=function(e){(0,Le.Z)(t,e);var r=w3(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.lineType,f=l===void 0?"solid":l,d=i.dashArray,y=d===void 0?[10,5,0,0]:d,b=i.vertexHeightScale,T=b===void 0?20:b,M=y;f!=="dash"&&(M=[0,0,0,0]),M.length===2&&M.push(0,0);var P=0,k=[0,0,0,0],H=[0,0,0,0];a&&s&&(k=vi(a),H=vi(s),P=1);var q={u_sourceColor:k,u_targetColor:H,u_dash_array:M,u_vertexScale:T,u_linearColor:P},ae=this.getUniformsBufferInfo(q);return ae}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:R3,vert:M3,type:"lineSimpleNormal"}}},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y;return _e().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return this.initUniformsBuffer(),s=this.getShaders(),l=s.frag,f=s.vert,d=s.type,T.next=4,this.layer.buildLayerModel({moduleName:d,vertexShader:f,fragmentShader:l,triangulation:Zw,inject:this.getInject(),primitive:I.LINES,depth:{enable:!1},pick:!1});case 4:return y=T.sent,T.abrupt("return",[y]);case 6:case"end":return T.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"sizeDistanceAndTotalDistance",type:Mn.Attribute,descriptor:{name:"a_SizeDistanceAndTotalDistance",shaderLocation:qn.SIZE,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:4,update:function(a,s,l){var f=a.size,d=f===void 0?1:f,y=Array.isArray(d)?[d[0],d[1]]:[d,0];return[y[0],y[1],l[3],l[5]]}}})}}]),t}(Na);function P3(e){var r=O3();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function O3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var k3=`#define Animate 0.0
#define LineTexture 1.0

// line texture

uniform sampler2D u_texture;
layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
in vec2 v_iconMapUV;
in float v_blur;
in float v_radio;
in vec4 v_color;
in vec4 v_dataset;

out vec4 outputColor;
#pragma include "picking"

void main() {
  float animateSpeed = 0.0; // \u8FD0\u52A8\u901F\u5EA6
  float d_distance_ratio = v_dataset.r; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float v = v_dataset.a;

  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    outputColor = mix(u_sourceColor, u_targetColor, v);
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     outputColor = v_color;
  }

  outputColor.a *= v_color.a; // \u5168\u5C40\u900F\u660E\u5EA6
  if(u_animate.x == Animate) {
      animateSpeed = u_time / u_animate.y;
       float alpha =1.0 - fract( mod(1.0- d_distance_ratio, u_animate.z)* (1.0/ u_animate.z) + animateSpeed);
      alpha = (alpha + u_animate.w -1.0) / u_animate.w;
      alpha = smoothstep(0., 1., alpha);
      outputColor.a *= alpha;
  }

  if(u_line_texture == LineTexture) { // while load texture
    float aDistance = v_dataset.g;      // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
    float d_texPixelLen = v_dataset.b;  // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
    float u = fract(mod(aDistance, d_texPixelLen)/d_texPixelLen - animateSpeed);
    float v = v_dataset.a;  // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C

    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 start
    float flag = 0.0;
    if(u > 1.0/u_iconStepCount) {
      flag = 1.0;
    }
    u = fract(u*u_iconStepCount);
    // \u8BA1\u7B97\u7EB9\u7406\u95F4\u9694 end

    vec2 uv= v_iconMapUV / u_textSize + vec2(u, v) / u_textSize * 64.;
    vec4 pattern = texture(SAMPLER_2D(u_texture), uv);

    // Tip: \u5224\u65AD\u7EB9\u7406\u95F4\u9694
    if(flag > 0.0) {
      pattern = vec4(0.0);
    }

    if(u_textureBlend == 0.0) { // normal
      pattern.a = 0.0;
      outputColor = filterColor(outputColor + pattern);
    } else { // replace
        pattern.a *= v_color.a;
        if(outputColor.a <= 0.0) {
          pattern.a = 0.0;
        }
        outputColor = filterColor(pattern);
    }
  }
  

  // blur - AA
  if(v < v_blur) {
    outputColor.a = mix(0.0, outputColor.a, v/v_blur);
  } else if(v > 1.0 - v_blur) {
    outputColor.a = mix(outputColor.a, 0.0, (v - (1.0 - v_blur))/v_blur);
  }

  outputColor = filterColor(outputColor);
}
`,D3=`#define Animate 0.0
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec2 a_Size;
layout(location = 10) in float a_Miter;
layout(location = 11) in float a_Total_Distance;
layout(location = 12) in vec4 a_Instance;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec2 a_iconMapUV;
layout(location = 15) in float a_Distance;


layout(std140) uniform commonUniorm {
  vec4 u_animate: [ 1., 2., 1.0, 0.2 ];
  vec4 u_sourceColor;
  vec4 u_targetColor;
  vec2 u_textSize;
  float u_icon_step: 100;
  float u_heightfixed;
  float u_linearColor: 0;
  float u_line_texture;
  float u_textureBlend;
  float u_iconStepCount;
  float u_time;
};
#pragma include "projection"
#pragma include "light"
#pragma include "picking"

// texV \u7EBF\u56FE\u5C42 - \u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\uFF08\u7EBF\u7684\u5BBD\u5EA6\u65B9\u5411\uFF09
out vec2 v_iconMapUV;
out vec4 v_color;
out float v_blur;
out float v_radio;
out vec4 v_dataset;

void main() {


  float d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  float d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E

  v_iconMapUV = a_iconMapUV;
  if(u_heightfixed < 1.0) {     // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
    d_texPixelLen = project_pixel(u_icon_step);
  } else {
    d_texPixelLen = u_icon_step;
  }
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
    d_texPixelLen *= 10.0;
  }

  if(u_animate.x == Animate || u_linearColor == 1.0) {
      d_distance_ratio = a_Distance / a_Total_Distance;
  }

  float miter = (a_Miter + 1.0)/2.0;
  // \u8BBE\u7F6E\u6570\u636E\u96C6\u7684\u53C2\u6570
  v_dataset[0] = d_distance_ratio; // \u5F53\u524D\u70B9\u4F4D\u8DDD\u79BB\u5360\u7EBF\u603B\u957F\u7684\u6BD4\u4F8B
  v_dataset[1] = a_Distance;       // \u5F53\u524D\u9876\u70B9\u7684\u8DDD\u79BB
  v_dataset[2] = d_texPixelLen;    // \u8D34\u56FE\u7684\u50CF\u7D20\u957F\u5EA6\uFF0C\u6839\u636E\u5730\u56FE\u5C42\u7EA7\u7F29\u653E
  v_dataset[3] = miter;          // \u7EBF\u56FE\u5C42\u8D34\u56FE\u90E8\u5206\u7684 v \u5750\u6807\u503C 0 - 1

  vec4 project_pos = project_position(vec4(a_Position.xy, 0, 1.0));

  float originSize = a_Size.x;  // \u56FA\u5B9A\u9AD8\u5EA6
  if(u_heightfixed < 1.0) {    
     originSize = project_float_meter(a_Size.x); // \u9AD8\u5EA6\u968F zoom \u8C03\u6574
  }


  float wallHeight = originSize * miter;
  float lightWeight = calc_lighting(vec4(project_pos.xy, wallHeight, 1.0));

  v_blur = min(project_float_pixel(2.0) / originSize, 0.05);
  v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xy, wallHeight, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy, wallHeight, 1.0));
  }

  setPickingColor(a_PickingColor);
}
`,L3=function(e){(0,Le.Z)(t,e);var r=P3(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas()}),n.layer.render();return}n.texture=l({data:n.iconService.getCanvas(),mag:I.NEAREST,min:I.NEAREST,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128}),n.textures=[n.texture]}),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.sourceColor,s=i.targetColor,l=i.textureBlend,f=l===void 0?"normal":l,d=i.heightfixed,y=d===void 0?!1:d,b=i.lineTexture,T=b===void 0?!1:b,M=i.iconStep,P=M===void 0?100:M,k=i.iconStepCount,H=k===void 0?1:k,q=this.layer.getLayerConfig(),ae=q.animateOption;this.rendererService.getDirty()&&this.texture.bind();var Se=0,ze=[0,0,0,0],it=[0,0,0,0];a&&s&&(ze=vi(a),it=vi(s),Se=1);var ut={u_animate:this.animateOption2Array(ae),u_sourceColor:ze,u_targetColor:it,u_textSize:[1024,this.iconService.canvasHeight||128],u_icon_step:P,u_heightfixed:Number(y),u_linearColor:Se,u_line_texture:T?1:0,u_textureBlend:f==="normal"?0:1,u_iconStepCount:H,u_time:this.layer.getLayerAnimateTime()||0},ot=this.getUniformsBufferInfo(ut);return ot}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),this.updateTexture(),this.iconService.on("imageUpdate",this.updateTexture),l.abrupt("return",this.buildModels());case 4:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return f.next=2,this.layer.buildLayerModel({moduleName:"lineWall",vertexShader:D3,fragmentShader:k3,triangulation:zw,inject:this.getInject(),depth:{enable:!1},blend:this.getBlend()});case 2:return s=f.sent,f.abrupt("return",[s]);case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"distance",type:Mn.Attribute,descriptor:{name:"a_Distance",shaderLocation:15,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s,l,f){return[f[3]]}}}),this.styleAttributeService.registerStyleAttribute({name:"total_distance",type:Mn.Attribute,descriptor:{name:"a_Total_Distance",shaderLocation:11,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s,l,f){return[f[5]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(s){var l=s.size,f=l===void 0?1:l;return Array.isArray(f)?[f[0],f[1]]:[f,0]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Mn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(s,l,f,d,y){return y}}}),this.styleAttributeService.registerStyleAttribute({name:"miter",type:Mn.Attribute,descriptor:{name:"a_Miter",shaderLocation:10,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s,l,f){return[f[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Mn.Attribute,descriptor:{name:"a_iconMapUV",shaderLocation:14,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.texture,d=l[f]||{x:0,y:0},y=d.x,b=d.y;return[y,b]}}})}}]),t}(Na),B3={arc:XC,arc3d:O1,greatcircle:x3,wall:L3,line:F1,simple:I3,flowline:p3,earthArc3d:O1},F3=B3;function N3(e){var r=U3();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function U3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var q0=function(e){(0,Le.Z)(t,e);var r=N3(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"type","LineLayer"),(0,F.Z)((0,Re.Z)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","thetaOffset"]),(0,F.Z)((0,Re.Z)(n),"arrowInsertCount",0),(0,F.Z)((0,Re.Z)(n),"defaultSourceConfig",{data:[{lng1:100,lat1:30,lng2:130,lat2:30}],options:{parser:{type:"json",x:"lng1",y:"lat1",x1:"lng2",y1:"lat2"}}}),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new F3[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={line:{},linearline:{},simple:{},wall:{},arc3d:{blend:"additive"},arc:{blend:"additive"},greatcircle:{blend:"additive"},tileLine:{},earthArc3d:{},flowline:{},arrow:{}};return a[i]}},{key:"getModelType",value:function(){var i;if(this.layerType)return this.layerType;var a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return s||"line"}},{key:"processData",value:function(i){if(this.getModelType()!=="simple")return i;var a=[];return i.map(function(s){if(Array.isArray(s.coordinates)&&Array.isArray(s.coordinates[0])&&Array.isArray(s.coordinates[0][0])){var l=(0,W.Z)({},s);s.coordinates.map(function(f){a.push((0,W.Z)((0,W.Z)({},l),{},{coordinates:f}))})}else a.push(s)}),a}}]),t}(Rp);function z3(e){var r=Z3();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function Z3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var V3=`
layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

in vec4 v_color;
in float v_blur;
in float v_innerRadius;

out vec4 outputColor;

#pragma include "picking"
void main() {
  vec2 center = vec2(0.5);

  // Tip: \u7247\u5143\u5230\u4E2D\u5FC3\u70B9\u7684\u8DDD\u79BB 0 - 1
  float fragmengTocenter = distance(center, gl_PointCoord) * 2.0;
  // Tip: \u7247\u5143\u7684\u526A\u5207\u6210\u5706\u5F62
  float circleClipOpacity = 1.0 - smoothstep(v_blur, 1.0, fragmengTocenter);


  if(v_innerRadius < 0.99) {
    // \u5F53\u5B58\u5728 stroke \u4E14 stroke > 0.01
    float blurWidth = (1.0 - v_blur)/2.0;
    vec4 stroke = vec4(u_stroke_color.rgb, u_stroke_opacity);
    if(fragmengTocenter > v_innerRadius + blurWidth) {
      outputColor = stroke;
    } else if(fragmengTocenter > v_innerRadius - blurWidth){
      float mixR = (fragmengTocenter - (v_innerRadius - blurWidth)) / (blurWidth * 2.0);
      outputColor = mix(v_color, stroke, mixR);
    } else {
      outputColor = v_color;
    }
  } else {
    // \u5F53\u4E0D\u5B58\u5728 stroke \u6216 stroke <= 0.01
    outputColor = v_color;
  }

  outputColor = filterColor(outputColor);
  
  if(u_additive > 0.0) {
    outputColor *= circleClipOpacity;
  } else {
    outputColor.a *= circleClipOpacity;
  }

}
`,j3=`
layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform commonUniorm {
  vec4 u_stroke_color;
  float u_additive;
  float u_stroke_opacity;
  float u_stroke_width;
};

out vec4 v_color;
out float v_blur;
out float v_innerRadius;

#pragma include "projection"
#pragma include "picking"
#pragma include "project"
void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_blur = 1.0 - max(2.0/a_Size, 0.05);
  v_innerRadius = max((a_Size - u_stroke_width) / a_Size, 0.0);
  
  vec2 offset = project_pixel(u_offsets);
  
  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position.xy + offset, a_Position.z, 1.0);
  } else { // else
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2.,-a_Size /2.,0.,0.);
    gl_Position = project_common_position_to_clipspace(vec4(vec2(project_pos.xy+offset),project_pos.z,project_pos.w));
  }
  
  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`;function N1(e){var r=e.coordinates;return{vertices:(0,Jt.Z)(r),indices:[0],size:r.length}}var H3=function(e){(0,Le.Z)(t,e);var r=z3(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.blend,s=i.strokeOpacity,l=s===void 0?1:s,f=i.strokeWidth,d=f===void 0?0:f,y=i.stroke,b=y===void 0?"#fff":y,T={u_stroke_color:vi(b),u_additive:a==="additive"?1:0,u_stroke_opacity:l,u_stroke_width:d},M=this.getUniformsBufferInfo(T);return M}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=N1,this.initUniformsBuffer(),f.next=4,this.layer.buildLayerModel({moduleName:"pointSimple",vertexShader:j3,fragmentShader:V3,inject:this.getInject(),triangulation:N1,depth:{enable:!1},primitive:I.POINTS});case 4:return s=f.sent,f.abrupt("return",[s]);case 6:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Na);function W3(e){var r=G3();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function G3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var X3=`precision highp float;
in vec4 v_color;

#pragma include "picking"

layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};
in float v_lightWeight;
in float v_barLinearZ;
out vec4 outputColor;
void main() {

   outputColor = v_color;

  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_opacitylinear_dir > 0.0 ? (1.0 - v_barLinearZ): v_barLinearZ;
  }

  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,$3=`precision highp float;

#define pi 3.1415926535
#define ambientRatio 0.5
#define diffuseRatio 0.3
#define specularRatio 0.2


layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Pos;
layout(location = 13) in vec3 a_Normal;


layout(std140) uniform commonUniform {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor: 0;
  float u_heightfixed: 0.0; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_globel;
  float u_r;
  float u_pickLight: 0.0;
  float u_opacitylinear: 0.0;
  float u_opacitylinear_dir: 1.0;
  float u_lightEnable: 1.0;
};

out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;
// \u7528\u4E8E\u5C06\u5728\u9876\u70B9\u7740\u8272\u5668\u4E2D\u8BA1\u7B97\u597D\u7684\u6837\u5F0F\u503C\u4F20\u9012\u7ED9\u7247\u5143


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec3 size = a_Size * a_Position;

  // a_Position.z \u662F\u5728\u6784\u5EFA\u7F51\u683C\u7684\u65F6\u5019\u4F20\u5165\u7684\u6807\u51C6\u503C 0 - 1\uFF0C\u5728\u63D2\u503C\u5668\u63D2\u503C\u53EF\u4EE5\u83B7\u53D6 0\uFF5E1 \u7EBF\u6027\u6E10\u53D8\u7684\u503C
  v_barLinearZ =  a_Position.z;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB
  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Pos.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;
  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }
  v_lightWeight = lightWeight;
  // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, v_barLinearZ);
    v_color.rgb *= lightWeight;
  } else { // \u4F7F\u7528 color \u65B9\u6CD5\u4F20\u5165\u7684\u989C\u8272
     v_color = a_Color;
  }
  v_color.a *= u_opacity;

    
  // \u5728\u5730\u7403\u6A21\u5F0F\u4E0B\uFF0C\u5C06\u539F\u672C\u5782\u76F4\u4E8E xy \u5E73\u9762\u7684\u5706\u67F1\u8C03\u6574\u59FF\u6001\u5230\u9002\u5E94\u5706\u7684\u89D2\u5EA6
  //\u65CB\u8F6C\u77E9\u9635mx\uFF0C\u521B\u5EFA\u7ED5x\u8F74\u65CB\u8F6C\u77E9\u9635
  float r = sqrt(a_Pos.z*a_Pos.z + a_Pos.x*a_Pos.x);
  float xRadian = getXRadian(a_Pos.y, r);
  float xcos = cos(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float xsin = sin(xRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 mx = mat4(
    1,0,0,0,  
    0,xcos,-xsin,0,  
    0,xsin,xcos,0,  
    0,0,0,1);

  //\u65CB\u8F6C\u77E9\u9635my\uFF0C\u521B\u5EFA\u7ED5y\u8F74\u65CB\u8F6C\u77E9\u9635
  float yRadian = getYRadian(a_Pos.x, a_Pos.z);
  float ycos = cos(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u4F59\u5F26\u503C
  float ysin = sin(yRadian);//\u6C42\u89E3\u65CB\u8F6C\u89D2\u5EA6\u6B63\u5F26\u503C
  mat4 my = mat4(
    ycos,0,-ysin,0,  
    0,1,0,0,  
    ysin,0,ycos,0,  
    0,0,0,1);

  gl_Position = u_ViewProjectionMatrix * vec4(( my * mx *  vec4(a_Position * a_Size, 1.0)).xyz + a_Pos, 1.0);
  

  setPickingColor(a_PickingColor);
}
`,Y3=ui.isNumber,q3=function(e){(0,Le.Z)(t,e);var r=W3(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"raiseCount",0),(0,F.Z)((0,Re.Z)(n),"raiseRepeat",0),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.opacity,f=l===void 0?1:l,d=i.sourceColor,y=i.targetColor,b=i.pickLight,T=b===void 0?!1:b,M=i.heightfixed,P=M===void 0?!0:M,k=i.opacityLinear,H=k===void 0?{enable:!1,dir:"up"}:k,q=i.lightEnable,ae=q===void 0?!0:q,Se=0,ze=[0,0,0,0],it=[0,0,0,0];if(d&&y&&(ze=vi(d),it=vi(y),Se=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var ut=s.speed,ot=ut===void 0?.01:ut;this.raiseCount+=ot,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var Ct={u_sourceColor:ze,u_targetColor:it,u_linearColor:Se,u_pickLight:Number(T),u_heightfixed:Number(P),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_opacity:Y3(f)?f:1,u_opacitylinear:Number(H.enable),u_opacitylinear_dir:H.dir==="up"?1:0,u_lightEnable:Number(ae)},Xt=this.getUniformsBufferInfo(Ct);return Xt}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption.repeat,f=l===void 0?1:l,this.raiseRepeat=f,b.next=4,this.layer.buildLayerModel({moduleName:"pointEarthExtrude",vertexShader:$3,fragmentShader:X3,triangulation:W0,depth:{enable:!0},inject:this.getInject(),cull:{enable:!0,face:Ji(this.mapService.version)},blend:this.getBlend()});case 4:return d=b.sent,b.abrupt("return",[d]);case 6:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a){var s=a.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Mn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"pos",type:Mn.Attribute,descriptor:{name:"a_Pos",shaderLocation:15,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a){var s=Qs(a.coordinates);return _1([s[0],s[1]])}}})}}]),t}(Na);function K3(e){var r=Q3();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function Q3(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var J3=`in vec4 v_data;
in vec4 v_color;
in float v_radius;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));

  vec4 strokeColor = u_stroke == vec4(0.0) ? v_color : u_stroke;

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  if(outer_df > antialiasblur + 0.018) discard;

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  if(u_stroke_width < 0.01) {
    outputColor = vec4(v_color.rgb, v_color.a * u_opacity);
  } else {
    outputColor = mix(vec4(v_color.rgb, v_color.a * u_opacity), strokeColor * u_stroke_opacity, color_t);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor = filterColor(outputColor);
  }
}
`,eR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in float a_Shape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniform {
  float u_additive;
  float u_stroke_opacity : 1;
  float u_stroke_width : 2;
  float u_blur : 0.0;
};
out vec4 v_data;
out vec4 v_color;
out float v_radius;

#pragma include "projection"
#pragma include "picking"


void main() {
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;

  // unpack color(vec2)
  v_color = a_Color;

  // radius(16-bit)
  v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur);

  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);

  gl_Position = u_ViewProjectionMatrix * vec4(a_Position + extrude * newSize * 0.1 + vec3(u_offsets,0.0), 1.0);

  setPickingColor(a_PickingColor);
}`,tR=function(e){(0,Le.Z)(t,e);var r=K3(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.strokeOpacity,s=a===void 0?1:a,l=i.strokeWidth,f=l===void 0?0:l,d=i.blend,y=i.blur,b=y===void 0?0:y;this.layer.getLayerConfig();var T={u_additive:d==="additive"?1:0,u_stroke_opacity:s,u_stroke_width:f,u_blur:b},M=this.getUniformsBufferInfo(T);return M}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=A1,f.next=3,this.layer.buildLayerModel({moduleName:"pointEarthFill",vertexShader:eR,fragmentShader:J3,triangulation:A1,inject:this.getInject(),depth:{enable:!0},blend:this.getBlend()});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Mn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:qn.EXTRUDE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(s,l,f,d){var y=(0,yn.Z)(f,3),b=y[0],T=y[1],M=y[2],P=La.fromValues(0,0,1),k=La.fromValues(b,0,M),H=b>=0?La.angle(P,k):Math.PI*2-La.angle(P,k),q=Math.PI*2-Math.asin(T/100),ae=It.create();It.rotateY(ae,ae,H),It.rotateX(ae,ae,q);var Se=La.fromValues(1,1,0);La.transformMat4(Se,Se,ae),La.normalize(Se,Se);var ze=La.fromValues(-1,1,0);La.transformMat4(ze,ze,ae),La.normalize(ze,ze);var it=La.fromValues(-1,-1,0);La.transformMat4(it,it,ae),La.normalize(it,it);var ut=La.fromValues(1,-1,0);La.transformMat4(ut,ut,ae),La.normalize(ut,ut);var ot=[].concat((0,Jt.Z)(Se),(0,Jt.Z)(ze),(0,Jt.Z)(it),(0,Jt.Z)(ut)),Ct=d%4*3;return[ot[Ct],ot[Ct+1],ot[Ct+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Mn.Attribute,descriptor:{name:"a_Shape",shaderLocation:qn.SHAPE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s){var l=s.shape,f=l===void 0?2:l,d=i.layer.getLayerConfig().shape2d,y=d.indexOf(f);return[y]}}})}}]),t}(Na);function rR(e){var r=nR();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function nR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iR=`
in vec4 v_color;
in float v_lightWeight;
out vec4 outputColor;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};

#pragma include "picking"

void main() {

  outputColor = v_color;
  // \u5F00\u542F\u900F\u660E\u5EA6\u6E10\u53D8
  // picking
  if(u_pickLight > 0.0) {
    outputColor = filterColorAlpha(outputColor, v_lightWeight);
  } else {
    outputColor = filterColor(outputColor);
  }
}
`,aR=`#define pi 3.1415926535

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in vec3 a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 13) in vec3 a_Normal;

layout(std140) uniform commonUniforms {
  float u_pickLight;
  float u_heightfixed;
  float u_r;
  float u_linearColor;
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_opacitylinear;
  float u_opacitylinear_dir;
  float u_lightEnable;
};
out vec4 v_color;
out float v_lightWeight;
out float v_barLinearZ;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

float getYRadian(float x, float z) {
  if(x > 0.0 && z > 0.0) {
    return atan(x/z);
  } else if(x > 0.0 && z <= 0.0){
    return atan(-z/x) + pi/2.0;
  } else if(x <= 0.0 && z <= 0.0) {
    return  pi + atan(x/z); //atan(x/z) + 
  } else {
    return atan(z/-x) + pi*3.0/2.0;
  }
}

float getXRadian(float y, float r) {
  return atan(y/r);
}

void main() {


  vec3 size = a_Size * a_Position;

  vec3 offset = size; // \u63A7\u5236\u5706\u67F1\u4F53\u7684\u5927\u5C0F - \u4ECE\u6807\u51C6\u5355\u4F4D\u5706\u67F1\u4F53\u8FDB\u884C\u504F\u79FB

  if(u_heightfixed < 1.0) { // \u5706\u67F1\u4F53\u4E0D\u56FA\u5B9A\u9AD8\u5EA6
    
    if (u_CoordinateSystem == COORDINATE_SYSTEM_P20 || u_CoordinateSystem == COORDINATE_SYSTEM_P20_OFFSET) {
      // P20 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF1
      offset = offset * pow(2.0, (19.0 - u_Zoom));
    }
    if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) {
      // P20_2 \u5750\u6807\u7CFB\u4E0B\uFF0C\u4E3A\u4E86\u548C Web \u58A8\u5361\u6258\u5750\u6807\u7CFB\u7EDF\u4E00\uFF0Czoom \u9ED8\u8BA4\u51CF3
      offset = offset * pow(2.0, (19.0 - 3.0 - u_Zoom));
    }
  } else {// \u5706\u67F1\u4F53\u56FA\u5B9A\u9AD8\u5EA6 \uFF08 \u5904\u7406 mapbox \uFF09
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      offset *= 4.0/pow(2.0, 21.0 - u_Zoom);
    }
  }


  vec4 project_pos = project_position(vec4(a_Extrude.xy, 0., 1.0));

  // u_r \u63A7\u5236\u5706\u67F1\u7684\u751F\u957F
  vec4 pos = vec4(project_pos.xy + offset.xy, offset.z * u_r, 1.0);

  // // \u5706\u67F1\u5149\u7167\u6548\u679C
  float lightWeight = 1.0;

  if(u_lightEnable > 0.0) { // \u53D6\u6D88\u4E09\u5143\u8868\u8FBE\u5F0F\uFF0C\u589E\u5F3A\u5065\u58EE\u6027
    lightWeight = calc_lighting(pos);
  }

  v_lightWeight = lightWeight;

  v_color = a_Color;

    // \u8BBE\u7F6E\u5706\u67F1\u7684\u5E95\u8272
  if(u_linearColor == 1.0) { // \u4F7F\u7528\u6E10\u53D8\u989C\u8272
    v_color = mix(u_sourceColor, u_targetColor, a_Position.z);
    v_color.a =  v_color.a * opacity;
  } else {
    v_color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);
  }

    if(u_opacitylinear > 0.0) {
    v_color.a *= u_opacitylinear_dir > 0.0 ? (1.0 - a_Position.z): a_Position.z;
  }


  gl_Position = project_common_position_to_clipspace_v2(pos);

  setPickingColor(a_PickingColor);
}
`,U1=function(e){(0,Le.Z)(t,e);var r=rR(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"raiseCount",0),(0,F.Z)((0,Re.Z)(n),"raiseRepeat",0),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1,speed:.01,repeat:!1}:a,l=i.sourceColor,f=i.targetColor,d=i.pickLight,y=d===void 0?!1:d,b=i.heightfixed,T=b===void 0?!1:b,M=i.opacityLinear,P=M===void 0?{enable:!1,dir:"up"}:M,k=i.lightEnable,H=k===void 0?!0:k,q=0,ae=[0,0,0,0],Se=[0,0,0,0];if(l&&f&&(ae=vi(l),Se=vi(f),q=1),this.raiseCount<1&&this.raiseRepeat>0&&s.enable){var ze=s.speed,it=ze===void 0?.01:ze;this.raiseCount+=it,this.raiseCount>=1&&(this.raiseRepeat>1?(this.raiseCount=0,this.raiseRepeat--):this.raiseCount=1)}var ut={u_pickLight:Number(y),u_heightfixed:Number(T),u_r:s.enable&&this.raiseRepeat>0?this.raiseCount:1,u_linearColor:q,u_sourceColor:ae,u_targetColor:Se,u_opacitylinear:Number(P.enable),u_opacitylinear_dir:P.dir==="up"?1:0,u_lightEnable:Number(H)},ot=this.getUniformsBufferInfo(ut);return ot}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y,b;return _e().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return s=this.layer.getLayerConfig(),l=s.depth,f=l===void 0?!0:l,d=s.animateOption.repeat,y=d===void 0?1:d,this.raiseRepeat=y,this.initUniformsBuffer(),M.next=5,this.layer.buildLayerModel({moduleName:"pointExtrude",vertexShader:aR,fragmentShader:iR,triangulation:W0,inject:this.getInject(),cull:{enable:!0,face:Ji(this.mapService.version)},depth:{enable:f}});case 5:return b=M.sent,M.abrupt("return",[b]);case 7:case"end":return M.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a){var s=a.size;if(s){var l=[];return Array.isArray(s)&&(l=s.length===2?[s[0],s[0],s[1]]:s),Array.isArray(s)||(l=[s,s,s]),l}else return[2,2,2]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Mn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Mn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:qn.EXTRUDE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a){var s=Qs(a.coordinates);return[s[0],s[1],0]}}})}}]),t}(Na);function oR(e){var r=sR();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function sR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var uR=`layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;
};


in vec4 v_color;
in vec4 v_stroke;
in vec4 v_data;
in float v_radius;

#pragma include "scene_uniforms"
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {
  int shape = int(floor(v_data.w + 0.5));
  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius + u_stroke_width);

  float outer_df;
  float inner_df;
  // 'circle', 'triangle', 'square', 'pentagon', 'hexagon', 'octogon', 'hexagram', 'rhombus', 'vesica'
  if (shape == 0) {
    outer_df = sdCircle(v_data.xy, 1.0);
    inner_df = sdCircle(v_data.xy, r);
  } else if (shape == 1) {
    outer_df = sdEquilateralTriangle(1.1 * v_data.xy);
    inner_df = sdEquilateralTriangle(1.1 / r * v_data.xy);
  } else if (shape == 2) {
    outer_df = sdBox(v_data.xy, vec2(1.));
    inner_df = sdBox(v_data.xy, vec2(r));
  } else if (shape == 3) {
    outer_df = sdPentagon(v_data.xy, 0.8);
    inner_df = sdPentagon(v_data.xy, r * 0.8);
  } else if (shape == 4) {
    outer_df = sdHexagon(v_data.xy, 0.8);
    inner_df = sdHexagon(v_data.xy, r * 0.8);
  } else if (shape == 5) {
    outer_df = sdOctogon(v_data.xy, 1.0);
    inner_df = sdOctogon(v_data.xy, r);
  } else if (shape == 6) {
    outer_df = sdHexagram(v_data.xy, 0.52);
    inner_df = sdHexagram(v_data.xy, r * 0.52);
  } else if (shape == 7) {
    outer_df = sdRhombus(v_data.xy, vec2(1.0));
    inner_df = sdRhombus(v_data.xy, vec2(r));
  } else if (shape == 8) {
    outer_df = sdVesica(v_data.xy, 1.1, 0.8);
    inner_df = sdVesica(v_data.xy, r * 1.1, r * 0.8);
  }

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  float color_t = u_stroke_width < 0.01 ? 0.0 : smoothstep(
    antialiasblur,
    0.0,
    inner_df
  );

  float PI = 3.14159;
  float N_RINGS = 3.0;
  float FREQ = 1.0;

  if(u_stroke_width < 0.01) {
    outputColor = v_color;
  } else {
    outputColor = mix(v_color, v_stroke * u_stroke_opacity, color_t);
  }
  float intensity = 1.0;
  if(u_time!=-1.0){
    //wave\u76F8\u5173\u903B\u8F91
    float d = length(v_data.xy);
    if(d > 0.5) {
      discard;
    }
    intensity = clamp(cos(d * PI), 0.0, 1.0) * clamp(cos(2.0 * PI * (d * 2.0 * u_animate.z - u_animate.y * u_time)), 0.0, 1.0);
  }

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
    outputColor *= intensity;//wave
    outputColor = filterColorAlpha(outputColor, outputColor.a);
  } else {
    outputColor.a *= opacity_t;
    outputColor.a *= intensity;//wave 
    outputColor = filterColor(outputColor);
  }
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if(outputColor.a < 0.01) {
    discard;
  } 
}
`,lR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in float a_Shape;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniforms {
  vec3 u_blur_height_fixed;
  float u_stroke_width;
  float u_additive;
  float u_stroke_opacity;
  float u_size_unit;
  float u_time;
  vec4 u_animate;   
};

out vec4 v_color;
out vec4 v_stroke;
out vec4 v_data;
out float v_radius;

#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // \u900F\u660E\u5EA6\u8BA1\u7B97
   v_stroke = stroke;  
  vec3 extrude = a_Extrude;
  float shape_type = a_Shape;
  /*
  *  setPickingSize \u8BBE\u7F6E\u62FE\u53D6\u5927\u5C0F
  *  u_meter2coord \u5728\u7B49\u9762\u79EF\u5927\u5C0F\u7684\u65F6\u5019\u8BBE\u7F6E\u5355\u4F4D
  */
  float newSize = setPickingSize(a_Size);
  // float newSize = setPickingSize(a_Size) * 0.00001038445708445579;



  // unpack color(vec2)
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }

   v_radius = newSize;

  // anti-alias
  //  float antialiased_blur = -max(u_blur, antialiasblur);
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / newSize, u_blur_height_fixed.x);

  vec2 offset = (extrude.xy * (newSize + u_stroke_width) + u_offsets);
  vec3 aPosition = a_Position;

  offset = project_pixel(offset);
  offset = rotate_matrix(offset,rotation);
  
  // TODP: /abs(extrude.x) \u662F\u4E3A\u4E86\u517C\u5BB9\u5730\u7403\u6A21\u5F0F
  v_data = vec4(extrude.x/abs(extrude.x), extrude.y/abs(extrude.y), antialiasblur,shape_type);


  // vec4 project_pos = project_position(vec4(a_Position.xy, 0.0, 1.0));
  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  float raisingHeight = u_blur_height_fixed.y;

  if(u_blur_height_fixed.z < 1.0) { // false
    raisingHeight = project_pixel(u_blur_height_fixed.y);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_blur_height_fixed.y * mapboxZoomScale;
    }
  }
  
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  setPickingColor(a_PickingColor);
}
`,z1=function(e){(0,Le.Z)(t,e);var r=oR(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.strokeOpacity,s=a===void 0?1:a,l=i.strokeWidth,f=l===void 0?0:l,d=i.blend,y=i.blur,b=y===void 0?0:y,T=i.raisingHeight,M=T===void 0?0:T,P=i.heightfixed,k=P===void 0?!1:P,H=i.unit,q=H===void 0?"pixel":H,ae=this.getAnimateUniforms().u_time;isNaN(ae)&&(ae=-1);var Se={u_blur_height_fixed:[b,Number(M),Number(k)],u_stroke_width:f,u_additive:d==="additive"?1:0,u_stroke_opacity:s,u_size_unit:Y0[q],u_time:ae,u_animate:this.getAnimateUniforms().u_animate},ze=this.getUniformsBufferInfo(Se);return ze}},{key:"getAnimateUniforms",value:function(){var i=this.layer.getLayerConfig(),a=i.animateOption,s=a===void 0?{enable:!1}:a;return{u_animate:this.animateOption2Array(s),u_time:this.layer.getLayerAnimateTime()}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),dp)}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y,b,T,M;return _e().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return s=this.layer.getLayerConfig(),l=s.animateOption,f=l===void 0?{enable:!1}:l,d=this.getShaders(f),y=d.frag,b=d.vert,T=d.type,this.layer.triangulation=dp,this.initUniformsBuffer(),k.next=6,this.layer.buildLayerModel({moduleName:T,vertexShader:b,fragmentShader:y,inject:this.getInject(),triangulation:dp,depth:{enable:!1}});case 6:return M=k.sent,k.abrupt("return",[M]);case 8:case"end":return k.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(i){return{frag:uR,vert:lR,type:"pointFill"}}},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig().shape2d;this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Mn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:qn.EXTRUDE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(s,l,f,d){var y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=d%4*3;return[y[b],y[b+1],y[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"shape",type:Mn.Attribute,descriptor:{name:"a_Shape",shaderLocation:qn.SHAPE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s){var l=s.shape,f=l===void 0?2:l,d=i.indexOf(f);return[d]}}})}}]),t}(Na);function cR(e){var r=fR();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function fR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var hR=`in vec4 v_color;
in vec2 v_uv;// \u672C\u8EAB\u7684 uv \u5750\u6807
in vec2 v_Iconuv;
in float v_opacity;
out vec4 outputColor;

uniform sampler2D u_texture;
layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

#pragma include "sdf_2d"
#pragma include "picking"


void main() {
  vec2 pos = v_Iconuv / u_textSize + v_uv / u_textSize * 64.;
  outputColor = texture(SAMPLER_2D(u_texture), pos);
  outputColor.a *= v_opacity;
  outputColor = filterColor(outputColor);
}
`,pR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniform {
  vec2 u_textSize;
  float u_heightfixed: 0.0;
  float u_raisingHeight: 0.0;
  float u_size_unit;
};

out vec2 v_uv;
out vec2 v_Iconuv;
out float v_opacity;


#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  vec3 extrude = a_Extrude;
  v_uv = (a_Extrude.xy + 1.0)/2.0;
  v_uv.y = 1.0 - v_uv.y;
  v_Iconuv = a_Uv;
  v_opacity = opacity;
  float newSize = a_Size;
  if(u_size_unit == 1.0) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  
  // vec2 offset = (u_RotateMatrix * extrude.xy * (a_Size) + textrueOffsets);
  vec2 offset = (extrude.xy * (newSize) + offsets);

  offset = rotate_matrix(offset,rotation);

  vec3 aPosition = a_Position;

  offset = project_pixel(offset);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // height fixed
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, 0.0, 1.0));

  setPickingColor(a_PickingColor);
}
`,dR=function(e){(0,Le.Z)(t,e);var r=cR(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"meter2coord",1),(0,F.Z)((0,Re.Z)(n),"isMeter",!1),(0,F.Z)((0,Re.Z)(n),"radian",0),(0,F.Z)((0,Re.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),n.layerService.throttleRenderLayers();return}n.texture=l({data:n.iconService.getCanvas(),mag:I.LINEAR,min:I.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0}),n.textures=[n.texture]}),n}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.heightfixed,f=l===void 0?!1:l,d=i.unit,y=d===void 0?"pixel":d;this.rendererService.getDirty()&&this.texture.bind();var b={u_textSize:[1024,this.iconService.canvasHeight||128],u_heightfixed:Number(f),u_raisingHeight:Number(s),u_size_unit:Y0[y],u_texture:this.texture};this.textures=[this.texture];var T=this.getUniformsBufferInfo(b);return T}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Mg)}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"pointFillImage",vertexShader:pR,fragmentShader:hR,triangulation:Mg,depth:{enable:!1},inject:this.getInject(),cull:{enable:!0,face:Ji(this.mapService.version)}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;this.iconService.off("imageUpdate",this.updateTexture),(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"uv",type:Mn.Attribute,descriptor:{name:"a_Uv",shaderLocation:qn.UV,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.shape,d=l[f]||{x:-64,y:-64},y=d.x,b=d.y;return[y,b]}}}),this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Mn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:qn.EXTRUDE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(s,l,f,d){var y=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],b=d%4*3;return[y[b],y[b+1],y[b+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}})}}]),t}(Na);function vR(e){var r=mR();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function mR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gR=`layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

uniform sampler2D u_texture;

in vec4 v_color;
in vec2 v_uv;
in float v_opacity;

#pragma include "picking"

out vec4 outputColor;

void main(){
  vec2 pos = v_uv / u_textSize + gl_PointCoord / u_textSize * 64.;
  vec4 textureColor;

  // Y = 0.299R + 0.587G + 0.114B // \u4EAE\u5EA6\u63D0\u53D6
  
  textureColor = texture(SAMPLER_2D(u_texture), pos);

  // Tip: \u53BB\u9664\u8FB9\u7F18\u90E8\u5206 mipmap \u5BFC\u81F4\u7684\u6DF7\u5408\u53D8\u6697
  float fragmengTocenter = distance(vec2(0.5), gl_PointCoord);
  if(fragmengTocenter >= 0.5) {
        float luma = 0.299 * textureColor.r + 0.587 * textureColor.g + 0.114 * textureColor.b;
        textureColor.a *= luma;
  }
  
  if(all(lessThan(v_color, vec4(1.0+0.00001))) && all(greaterThan(v_color, vec4(1.0-0.00001))) || v_color==vec4(1.0)){
        outputColor= textureColor;
  }else {
        outputColor= step(0.01, textureColor.z) * v_color;
  }
  outputColor.a *= v_opacity;
  if (outputColor.a < 0.01) {
      discard;
  }
  outputColor = filterColor(outputColor);
}
`,_R=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_textSize;
  float u_raisingHeight;
  float u_heightfixed;
};

out vec4 v_color;
out vec2 v_uv;
out float v_opacity;

#pragma include "projection"
#pragma include "picking"

void main() {

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  v_color = a_Color;
  v_opacity = opacity;
  v_uv = a_Uv;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
   
  vec2 offset = project_pixel(offsets);

  float raisingHeight = u_raisingHeight;
  if(u_heightfixed < 1.0) { // false
    raisingHeight = project_pixel(u_raisingHeight);
  } else {
     if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      raisingHeight = u_raisingHeight * mapboxZoomScale;
    }
  }


  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, raisingHeight, 1.0));

  gl_PointSize = a_Size * 2.0 * u_DevicePixelRatio;
  setPickingColor(a_PickingColor);
}
`,Z1=function(e){(0,Le.Z)(t,e);var r=vR(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"updateTexture",function(){var l=n.rendererService.createTexture2D;if(n.texture){n.texture.update({data:n.iconService.getCanvas(),mag:"linear",min:"linear mipmap nearest",mipmap:!0}),setTimeout(function(){n.layerService.throttleRenderLayers()});return}n.texture=l({data:n.iconService.getCanvas(),mag:I.LINEAR,min:I.LINEAR_MIPMAP_LINEAR,premultiplyAlpha:!1,width:1024,height:n.iconService.canvasHeight||128,mipmap:!0})}),n}return(0,j.Z)(t,[{key:"getUninforms",value:function(){this.rendererService.getDirty()&&this.texture.bind();var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,W.Z)((0,W.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.heightfixed,f=l===void 0?!1:l,d={u_textSize:[1024,this.iconService.canvasHeight||128],u_raisingHeight:Number(s),u_heightfixed:Number(f),u_texture:this.texture};this.textures=[this.texture];var y=this.getUniformsBufferInfo(d);return y}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.iconService.on("imageUpdate",this.updateTexture),this.updateTexture(),l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.iconService.off("imageUpdate",this.updateTexture)}},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"pointImage",vertexShader:_R,fragmentShader:gR,triangulation:Uw,inject:this.getInject(),depth:{enable:!1},primitive:I.POINTS});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this;this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(s){var l=s.size,f=l===void 0?5:l;return Array.isArray(f)?[f[0]]:[f]}}}),this.styleAttributeService.registerStyleAttribute({name:"uv",type:Mn.Attribute,descriptor:{name:"a_Uv",shaderLocation:qn.UV,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(s){var l=i.iconService.getIconMap(),f=s.shape,d=l[f]||{x:-64,y:-64},y=d.x,b=d.y;return[y,b]}}})}}]),t}(Na);function yR(e){var r=xR();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function xR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var bR=`in vec4 v_color;
out vec4 outputColor;
void main() {
  outputColor = v_color;
}`,ER=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;

layout(std140) uniform u_Common {
  float u_size_scale;
};

out vec4 v_color;

#pragma include "projection"
#pragma include "project"

void main() {
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);

  if (u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * vec4(a_Position, 1.0);
  } else {
    vec4 project_pos = project_position(vec4(a_Position, 1.0)) + vec4(a_Size / 2., -a_Size /2., 0., 0.);
    gl_Position = project_common_position_to_clipspace(project_pos);
  }

  gl_PointSize = a_Size * u_size_scale *  2.0  * u_DevicePixelRatio;
}
`;function V1(e){var r=e.coordinates;return{vertices:(0,Jt.Z)(r),indices:[0],size:r.length}}var j1=function(e){(0,Le.Z)(t,e);var r=yR(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getDefaultStyle",value:function(){return{blend:"additive"}}},{key:"getCommonUniformsInfo",value:function(){var i={u_size_scale:.5},a=this.getUniformsBufferInfo(i);return a}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.layer.triangulation=V1,this.initUniformsBuffer(),f.next=4,this.layer.buildLayerModel({moduleName:"pointNormal",vertexShader:ER,fragmentShader:bR,triangulation:V1,inject:this.getInject(),depth:{enable:!1},primitive:I.POINTS,pick:!1});case 4:return s=f.sent,f.abrupt("return",[s]);case 6:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?1:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Na);function SR(e){var r=AR();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function AR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var TR=`
layout(std140) uniform commonUniorm{
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};
in vec4 v_data;
in vec4 v_color;
in float v_radius;
in vec2 v_extrude;
#pragma include "sdf_2d"
#pragma include "picking"

out vec4 outputColor;

void main() {

  lowp float antialiasblur = v_data.z;
  float r = v_radius / (v_radius);

  float outer_df = sdCircle(v_data.xy, 1.0);
  float inner_df = sdCircle(v_data.xy, r);

  float opacity_t = smoothstep(0.0, antialiasblur, outer_df);

  outputColor = vec4(v_color.rgb, v_color.a);

  if(u_additive > 0.0) {
    outputColor *= opacity_t;
  } else {
    outputColor.a *= opacity_t;
  }

  if(outputColor.a > 0.0) {
    outputColor = filterColor(outputColor);
  }

  vec2 extrude =  v_extrude;
  vec2 dir = normalize(extrude);
  vec2 baseDir = vec2(1.0, 0.0);
  float pi = 3.14159265359;
  float flag = sign(dir.y);
  float rades = dot(dir, baseDir);
  float radar_v = (flag - 1.0) * -0.5 * acos(rades)/pi;
  // simple AA
  if(radar_v > 0.99) {
    radar_v = 1.0 - (radar_v - 0.99)/0.01;
  }

  outputColor.a *= radar_v;
}
`,wR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 11) in vec3 a_Extrude;

layout(std140) uniform commonUniorm {
  float u_additive;
  float u_size_unit;
  float u_speed: 1.0;
  float u_time;
};

out vec4 v_data;
out vec4 v_color;
out float v_radius;
out vec2 v_extrude;

#pragma include "projection"
#pragma include "picking"

void main() {
  float newSize = setPickingSize(a_Size);

  float time = u_time * u_speed;
  mat2 rotateMatrix = mat2( 
    cos(time), sin(time), 
    -sin(time), cos(time)
  );
  v_extrude = rotateMatrix * a_Extrude.xy;

  v_color = a_Color;
  v_color.a *= opacity;

  float blur = 0.0;
  float antialiasblur = -max(2.0 / u_DevicePixelRatio / a_Size, blur);

  if(u_size_unit == 1.) {
    newSize = newSize  * u_PixelsPerMeter.z;
  }
  v_radius = newSize;

  vec2 offset = (a_Extrude.xy * (newSize));
  vec3 aPosition = a_Position;
  
  offset = project_pixel(offset);
  
  v_data = vec4(a_Extrude.x, a_Extrude.y, antialiasblur, -1.0);

  vec4 project_pos = project_position(vec4(aPosition.xy, 0.0, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy + offset, project_pixel(setPickingOrder(0.0)), 1.0));

  setPickingColor(a_PickingColor);
}
`,CR=function(e){(0,Le.Z)(t,e);var r=SR(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.blend,s=i.speed,l=s===void 0?1:s,f=i.unit,d=f===void 0?"pixel":f,y={u_additive:a==="additive"?1:0,u_size_unit:Y0[d],u_speed:l,u_time:this.layer.getLayerAnimateTime()},b=this.getUniformsBufferInfo(y);return b}},{key:"getAnimateUniforms",value:function(){return{}}},{key:"getAttribute",value:function(){return this.styleAttributeService.createAttributesAndIndices(this.layer.getEncodedData(),Mg)}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"pointRadar",vertexShader:wR,fragmentShader:TR,triangulation:Mg,inject:this.getInject(),depth:{enable:!1}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"animateOption2Array",value:function(i){return[i.enable?0:1,i.speed||1,i.rings||3,0]}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"extrude",type:Mn.Attribute,descriptor:{name:"a_Extrude",shaderLocation:qn.EXTRUDE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a,s,l,f){var d=[1,1,0,-1,1,0,-1,-1,0,1,-1,0],y=f%4*3;return[d[y],d[y+1],d[y+2]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{shaderLocation:qn.SIZE,name:"a_Size",buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?5:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Na);function RR(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=MR(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function MR(e,r){if(e){if(typeof e=="string")return H1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return H1(e,r)}}function H1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}var IR=function(){function e(r,t,n){(0,Q.Z)(this,e),(0,F.Z)(this,"boxCells",[]);var i=this.boxCells;this.xCellCount=Math.ceil(r/n),this.yCellCount=Math.ceil(t/n);for(var a=0;a<this.xCellCount*this.yCellCount;a++)i.push([]);this.boxKeys=[],this.bboxes=[],this.width=r,this.height=t,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/t,this.boxUid=0}return(0,j.Z)(e,[{key:"insert",value:function(t,n,i,a,s){this.forEachCell(n,i,a,s,this.insertBoxCell,this.boxUid++),this.boxKeys.push(t),this.bboxes.push(n),this.bboxes.push(i),this.bboxes.push(a),this.bboxes.push(s)}},{key:"query",value:function(t,n,i,a,s){return this.queryHitTest(t,n,i,a,!1,s)}},{key:"hitTest",value:function(t,n,i,a,s){return this.queryHitTest(t,n,i,a,!0,s)}},{key:"insertBoxCell",value:function(t,n,i,a,s,l){this.boxCells[s].push(l)}},{key:"queryHitTest",value:function(t,n,i,a,s,l){if(i<0||t>this.width||a<0||n>this.height)return s?!1:[];var f=[];if(t<=0&&n<=0&&this.width<=i&&this.height<=a){if(s)return!0;for(var d=0;d<this.boxKeys.length;d++)f.push({key:this.boxKeys[d],x1:this.bboxes[d*4],y1:this.bboxes[d*4+1],x2:this.bboxes[d*4+2],y2:this.bboxes[d*4+3]});return l?f.filter(l):f}var y={hitTest:s,seenUids:{box:{},circle:{}}};return this.forEachCell(t,n,i,a,this.queryCell,f,y,l),s?f.length>0:f}},{key:"queryCell",value:function(t,n,i,a,s,l,f,d){var y=f.seenUids,b=this.boxCells[s];if(b!==null){var T=this.bboxes,M=RR(b),P;try{for(M.s();!(P=M.n()).done;){var k=P.value;if(!y.box[k]){y.box[k]=!0;var H=k*4;if(t<=T[H+2]&&n<=T[H+3]&&i>=T[H+0]&&a>=T[H+1]&&(!d||d(this.boxKeys[k]))){if(f.hitTest)return l.push(!0),!0;l.push({key:this.boxKeys[k],x1:T[H],y1:T[H+1],x2:T[H+2],y2:T[H+3]})}}}}catch(q){M.e(q)}finally{M.f()}}return!1}},{key:"forEachCell",value:function(t,n,i,a,s,l,f,d){for(var y=this.convertToXCellCoord(t),b=this.convertToYCellCoord(n),T=this.convertToXCellCoord(i),M=this.convertToYCellCoord(a),P=y;P<=T;P++)for(var k=b;k<=M;k++){var H=this.xCellCount*k+P;if(s.call(this,t,n,i,a,H,l,f,d))return}}},{key:"convertToXCellCoord",value:function(t){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(t*this.xScale)))}},{key:"convertToYCellCoord",value:function(t){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(t*this.yScale)))}}]),e}(),PR=IR,OR=function(){function e(r,t){(0,Q.Z)(this,e),(0,F.Z)(this,"viewportPadding",100),this.width=r,this.height=t,this.viewportPadding=Math.max(r,t),this.grid=new PR(r+this.viewportPadding,t+this.viewportPadding,25),this.screenRightBoundary=r+this.viewportPadding,this.screenBottomBoundary=t+this.viewportPadding,this.gridRightBoundary=r+2*this.viewportPadding,this.gridBottomBoundary=t+2*this.viewportPadding}return(0,j.Z)(e,[{key:"placeCollisionBox",value:function(t){var n=t.x1+t.anchorPointX+this.viewportPadding,i=t.y1+t.anchorPointY+this.viewportPadding,a=t.x2+t.anchorPointX+this.viewportPadding,s=t.y2+t.anchorPointY+this.viewportPadding;return!this.isInsideGrid(n,i,a,s)||this.grid.hitTest(n,i,a,s)?{box:[]}:{box:[n,i,a,s]}}},{key:"insertCollisionBox",value:function(t,n){var i={featureIndex:n};this.grid.insert(i,t[0],t[1],t[2],t[3])}},{key:"project",value:function(t,n,i){var a=Bh.al(n,i,0,1),s=Bh.Ue(),l=It.fromValues.apply(It,(0,Jt.Z)(t));return Bh.fF(s,a,l),{x:(s[0]/s[3]+1)/2*this.width+this.viewportPadding,y:(-s[1]/s[3]+1)/2*this.height+this.viewportPadding}}},{key:"isInsideGrid",value:function(t,n,i,a){return i>=0&&t<this.gridRightBoundary&&a>=0&&n<this.gridBottomBoundary}}]),e}();function W1(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=kR(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function kR(e,r){if(e){if(typeof e=="string")return G1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return G1(e,r)}}function G1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function X1(e){var r=.5,t=.5;switch(e){case"right":case"top-right":case"bottom-right":r=1;break;case"left":case"top-left":case"bottom-left":r=0;break;default:r=.5}switch(e){case"bottom":case"bottom-right":case"bottom-left":t=1;break;case"top":case"top-right":case"top-left":t=0;break;default:t=.5}return{horizontalAlign:r,verticalAlign:t}}function $1(e,r,t,n,i){if(i){var a=e[n],s=a.glyph;if(s)for(var l=r[s].advance*a.scale,f=(e[n].x+l)*i,d=t;d<=n;d++)e[d].x-=f}}function Y1(e,r,t,n,i,a,s){var l=(r-t)*i,f=(-n*s+.5)*a,d=W1(e),y;try{for(d.s();!(y=d.n()).done;){var b=y.value;b.x+=l,b.y+=f}}catch(T){d.e(T)}finally{d.f()}}function DR(e,r,t,n,i,a,s){var l=-8,f=0,d=l,y=0,b=e.positionedGlyphs,T=a==="right"?1:a==="left"?0:.5,M=b.length;t.forEach(function(ae){if(ae.split("").forEach(function(ze){var it=r[ze],ut=0;it&&(b.push({glyph:ze,x:f,y:d+ut,vertical:!1,scale:1,metrics:it}),f+=it.advance+s)}),b.length!==M){var Se=f-s;y=Math.max(Se,y),$1(b,r,M,b.length-1,T)}f=0,d-=n+5});var P=X1(i),k=P.horizontalAlign,H=P.verticalAlign;Y1(b,T,k,H,y,n,t.length);var q=d-l;e.top+=-H*q,e.bottom=e.top-q,e.left+=-k*y,e.right=e.left+y}function LR(e,r,t,n,i,a,s){var l=-8,f=0,d=l,y=0,b=e.positionedGlyphs,T=a==="right"?1:a==="left"?0:.5,M=b.length;t.forEach(function(ae){var Se=r[ae],ze=0;if(Se&&(b.push({glyph:ae,x:Se.advance/2,y:d+ze,vertical:!1,scale:1,metrics:Se}),f+=Se.advance+s),b.length!==M){var it=f-s;y=Math.max(it,y),$1(b,r,M,b.length-1,T)}f=0,d-=n+5});var P=X1(i),k=P.horizontalAlign,H=P.verticalAlign;Y1(b,T,k,H,y,n,t.length);var q=d-l;e.top+=-H*q,e.bottom=e.top-q,e.left+=-k*y,e.right=e.left+y}function BR(e,r,t,n,i,a){var s=arguments.length>6&&arguments[6]!==void 0?arguments[6]:[0,0],l=arguments.length>7?arguments[7]:void 0,f=e.split(`
`),d=[],y={positionedGlyphs:d,top:s[1],bottom:s[1],left:s[0],right:s[0],lineCount:f.length,text:e};return l?LR(y,r,f,t,n,i,a):DR(y,r,f,t,n,i,a),d.length?y:!1}function FR(e){var r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:[0,0],t=arguments.length>2?arguments[2]:void 0,n=e.positionedGlyphs,i=n===void 0?[]:n,a=[],s=W1(i),l;try{for(s.s();!(l=s.n()).done;){var f=l.value,d=f.metrics,y=4,b=d.advance*f.scale/2,T=t?[f.x+b,f.y]:[0,0],M=t?[0,0]:[f.x+b+r[0],f.y+r[1]],P=(0-y)*f.scale-b+M[0],k=(0-y)*f.scale+M[1],H=P+d.width*f.scale,q=k+d.height*f.scale,ae={x:P,y:k},Se={x:H,y:k},ze={x:P,y:q},it={x:H,y:q};a.push({tl:ae,tr:Se,bl:ze,br:it,tex:d,glyphOffset:T})}}catch(ut){s.e(ut)}finally{s.f()}return a}function NR(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=UR(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function UR(e,r){if(e){if(typeof e=="string")return q1(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return q1(e,r)}}function q1(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function zR(e){var r=ZR();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function ZR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var K1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 48.0

uniform sampler2D u_sdf_map;
layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

in vec4 v_color;
in vec4 v_stroke_color;
in vec2 v_uv;
in float v_gamma_scale;
in float v_fontScale;
out vec4 outputColor;

#pragma include "picking"
void main() {
  // get style data mapping

  // get sdf from atlas
  float dist = texture(SAMPLER_2D(u_sdf_map), v_uv).a;

  lowp float buff = (6.0 - u_stroke_width / v_fontScale) / SDF_PX;
  highp float gamma = (u_halo_blur * 1.19 / SDF_PX + EDGE_GAMMA) / (v_fontScale * u_gamma_scale) / 1.0;

  highp float gamma_scaled = gamma * v_gamma_scale;

  highp float alpha = smoothstep(buff - gamma_scaled, buff + gamma_scaled, dist);

  outputColor = mix(v_color, v_stroke_color, smoothstep(0., 0.5, 1.- dist));

  outputColor.a *= alpha;
   // \u4F5C\u4E3A mask \u6A21\u677F\u65F6\u9700\u8981\u4E22\u5F03\u900F\u660E\u7684\u50CF\u7D20
  if (outputColor.a < 0.01) {
    discard;
  }
  outputColor = filterColor(outputColor);
}
`,Q1=`#define SDF_PX 8.0
#define EDGE_GAMMA 0.105
#define FONT_SIZE 24.0

layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 10) in vec2 a_textOffsets;
layout(location = 14) in vec2 a_tex;

layout(std140) uniform commonUniforms {
  vec4 u_stroke_color : [0.0, 0.0, 0.0, 0.0];
  vec2 u_sdf_map_size;
  float u_raisingHeight: 0.0;
  float u_stroke_width : 2;
  float u_gamma_scale : 0.5;
  float u_halo_blur : 0.5;
};

out vec2 v_uv;
out float v_gamma_scale;
out vec4 v_color;
out vec4 v_stroke_color;
out float v_fontScale;



#pragma include "projection"
#pragma include "picking"
#pragma include "rotation_2d"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  
  v_uv = a_tex / u_sdf_map_size;



  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  v_stroke_color = vec4(u_stroke_color.xyz, u_stroke_color.w * opacity);

  // \u6587\u672C\u7F29\u653E\u6BD4\u4F8B
  float fontScale = a_Size / FONT_SIZE;
  v_fontScale = fontScale;

  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // vec4 projected_position  = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  vec2 offset = rotate_matrix(a_textOffsets,rotation);
  
  // gl_Position = vec4(projected_position.xy / projected_position.w + rotation_matrix * a_textOffsets * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);

  float raiseHeight = u_raisingHeight;
  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    raiseHeight = u_raisingHeight * mapboxZoomScale;
  }

  vec4 projected_position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz + vec3(0.0, 0.0, raiseHeight), 1.0));

  gl_Position = vec4(
    projected_position.xy / projected_position.w + offset * fontScale / u_ViewportSize * 2.0 * u_DevicePixelRatio, 0.0, 1.0);
  v_gamma_scale = gl_Position.w;
  setPickingColor(a_PickingColor);

}
`,bm=ui.isEqual;function J1(e){var r=this,t=e.id,n=[],i=[];if(!r.glyphInfoMap||!r.glyphInfoMap[t])return{vertices:[],indices:[],size:7};var a=r.glyphInfoMap[t].centroid,s=a.length===2?[a[0],a[1],0]:a;return r.glyphInfoMap[t].glyphQuads.forEach(function(l,f){n.push.apply(n,(0,Jt.Z)(s).concat([l.tex.x,l.tex.y+l.tex.height,l.tl.x,l.tl.y],(0,Jt.Z)(s),[l.tex.x+l.tex.width,l.tex.y+l.tex.height,l.tr.x,l.tr.y],(0,Jt.Z)(s),[l.tex.x+l.tex.width,l.tex.y,l.br.x,l.br.y],(0,Jt.Z)(s),[l.tex.x,l.tex.y,l.bl.x,l.bl.y])),i.push(0+f*4,1+f*4,2+f*4,2+f*4,3+f*4,0+f*4)}),{vertices:n,indices:i,size:7}}var ex=function(e){(0,Le.Z)(t,e);var r=zR(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"glyphInfoMap",{}),(0,F.Z)((0,Re.Z)(n),"currentZoom",-1),(0,F.Z)((0,Re.Z)(n),"textureHeight",0),(0,F.Z)((0,Re.Z)(n),"textCount",0),(0,F.Z)((0,Re.Z)(n),"preTextStyle",{}),(0,F.Z)((0,Re.Z)(n),"mapping",(0,Zt.Z)(_e().mark(function l(){return _e().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return n.initGlyph(),n.updateTexture(),d.next=4,n.reBuildModel();case 4:case"end":return d.stop()}},l)}))),n}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,W.Z)((0,W.Z)((0,W.Z)({},i.uniformsOption),a.uniformsOption),{u_sdf_map:this.textures[0]})}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.stroke,s=a===void 0?"#fff":a,l=i.strokeWidth,f=l===void 0?0:l,d=i.halo,y=d===void 0?.5:d,b=i.gamma,T=b===void 0?2:b,M=i.raisingHeight,P=M===void 0?0:M,k=this.getFontServiceMapping(),H=this.getFontServiceCanvas();k&&Object.keys(k).length!==this.textCount&&H&&(this.updateTexture(),this.textCount=Object.keys(k).length),this.preTextStyle=this.getTextStyle();var q={u_stroke_color:vi(s),u_sdf_map_size:[(H==null?void 0:H.width)||1,(H==null?void 0:H.height)||1],u_raisingHeight:Number(P),u_stroke_width:f,u_gamma_scale:T,u_halo_blur:y},ae=this.getUniformsBufferInfo(q);return ae}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.bindEvent(),this.extent=this.textExtent(),this.rawEncodeData=this.layer.getEncodedData(),this.preTextStyle=this.getTextStyle(),this.initUniformsBuffer(),l.abrupt("return",this.buildModels());case 6:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getLayerConfig(),l=s.textAllowOverlap,f=l===void 0?!1:l,this.initGlyph(),this.updateTexture(),f||this.filterGlyphs(),b.next=6,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Q1,fragmentShader:K1,inject:this.getInject(),triangulation:J1.bind(this),depth:{enable:!1}});case 6:return d=b.sent,b.abrupt("return",[d]);case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"needUpdate",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y,b,T,M,P,k,H,q;return _e().wrap(function(Se){for(;;)switch(Se.prev=Se.next){case 0:if(s=this.getTextStyle(),l=s.textAllowOverlap,f=l===void 0?!1:l,d=s.textAnchor,y=d===void 0?"center":d,b=s.textOffset,T=s.padding,M=s.fontFamily,P=s.fontWeight,!(!bm(T,this.preTextStyle.padding)||!bm(b,this.preTextStyle.textOffset)||!bm(y,this.preTextStyle.textAnchor)||!bm(M,this.preTextStyle.fontFamily)||!bm(P,this.preTextStyle.fontWeight))){Se.next=5;break}return Se.next=4,this.mapping();case 4:return Se.abrupt("return",!0);case 5:if(!f){Se.next=7;break}return Se.abrupt("return",!1);case 7:if(k=this.mapService.getZoom(),H=this.mapService.getBounds(),q=da(this.extent,H),!(Math.abs(this.currentZoom-k)>.5||!q||f!==this.preTextStyle.textAllowOverlap)){Se.next=14;break}return Se.next=13,this.reBuildModel();case 13:return Se.abrupt("return",!0);case 14:return Se.abrupt("return",!1);case 15:case"end":return Se.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.layer.off("remapping",this.mapping)}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"textOffsets",type:Mn.Attribute,descriptor:{shaderLocation:10,name:"a_textOffsets",buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(a,s,l){return[l[5],l[6]]}}}),this.styleAttributeService.registerStyleAttribute({name:"textUv",type:Mn.Attribute,descriptor:{name:"a_tex",shaderLocation:qn.UV,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?12:s;return Array.isArray(l)?[l[0]]:[l]}}})}},{key:"bindEvent",value:function(){this.layer.isTileLayer||this.layer.on("remapping",this.mapping)}},{key:"textExtent",value:function(){var i=this.mapService.getBounds();return Zu(i,.5)}},{key:"initTextFont",value:function(){var i=this.getTextStyle(),a=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,f=[];l.forEach(function(d){var y=d.shape,b=y===void 0?"":y;b=b.toString();var T=NR(b),M;try{for(T.s();!(M=T.n()).done;){var P=M.value;f.indexOf(P)===-1&&f.push(P)}}catch(k){T.e(k)}finally{T.f()}}),this.fontService.setFontOptions({characterSet:f,fontWeight:a,fontFamily:s,iconfont:!1})}},{key:"initIconFontTex",value:function(){var i=this.getTextStyle(),a=i.fontWeight,s=i.fontFamily,l=this.rawEncodeData,f=[];l.forEach(function(d){var y=d.shape,b=y===void 0?"":y;b="".concat(b),f.indexOf(b)===-1&&f.push(b)}),this.fontService.setFontOptions({characterSet:f,fontWeight:a,fontFamily:s,iconfont:!0})}},{key:"getTextStyle",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,f=l===void 0?"sans-serif":l,d=i.textAllowOverlap,y=d===void 0?!1:d,b=i.padding,T=b===void 0?[0,0]:b,M=i.textAnchor,P=M===void 0?"center":M,k=i.textOffset,H=k===void 0?[0,0]:k,q=i.opacity,ae=q===void 0?1:q,Se=i.strokeOpacity,ze=Se===void 0?1:Se,it=i.strokeWidth,ut=it===void 0?0:it,ot=i.stroke,Ct=ot===void 0?"#000":ot;return{fontWeight:s,fontFamily:f,textAllowOverlap:y,padding:T,textAnchor:P,textOffset:H,opacity:ae,strokeOpacity:ze,strokeWidth:ut,stroke:Ct}}},{key:"generateGlyphLayout",value:function(i){var a=this,s=this.getFontServiceMapping(),l=this.layer.getLayerConfig(),f=l.spacing,d=f===void 0?2:f,y=l.textAnchor,b=y===void 0?"center":y,T=l.textOffset,M=this.rawEncodeData;this.glyphInfo=M.map(function(P){var k=P.shape,H=k===void 0?"":k,q=P.id,ae=P.size,Se=ae===void 0?1:ae,ze=P.textOffset?P.textOffset:T||[0,0],it=P.textAnchor?P.textAnchor:b||"center",ut=BR(H.toString(),s,Se,it,"left",d,ze,i),ot=FR(ut,ze,!1);return P.shaping=ut,P.glyphQuads=ot,P.centroid=Qs(P.coordinates),P.originCentroid=P.version==="GAODE2.x"?Qs(P.originCoordinates):P.originCentroid=P.centroid,a.glyphInfoMap[q]={shaping:ut,glyphQuads:ot,centroid:Qs(P.coordinates)},P})}},{key:"getFontServiceMapping",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,f=l===void 0?"sans-serif":l;return this.fontService.getMappingByKey("".concat(f,"_").concat(s))}},{key:"getFontServiceCanvas",value:function(){var i=this.layer.getLayerConfig(),a=i.fontWeight,s=a===void 0?"400":a,l=i.fontFamily,f=l===void 0?"sans-serif":l;return this.fontService.getCanvasByKey("".concat(f,"_").concat(s))}},{key:"filterGlyphs",value:function(){var i=this,a=this.layer.getLayerConfig(),s=a.padding,l=s===void 0?[0,0]:s,f=a.textAllowOverlap,d=f===void 0?!1:f;if(!d){this.glyphInfoMap={},this.currentZoom=this.mapService.getZoom(),this.extent=this.textExtent();var y=this.rendererService.getViewportSize(),b=y.width,T=y.height,M=new OR(b,T),P=this.glyphInfo.filter(function(k){var H=k.shaping,q=k.id,ae=q===void 0?0:q,Se=k.version==="GAODE2.x"?k.originCentroid:k.centroid,ze=k.size,it=ze/16,ut=i.mapService.lngLatToContainer(Se),ot=M.placeCollisionBox({x1:H.left*it-l[0],x2:H.right*it+l[0],y1:H.top*it-l[1],y2:H.bottom*it+l[1],anchorPointX:ut.x,anchorPointY:ut.y}),Ct=ot.box;return Ct&&Ct.length?(M.insertCollisionBox(Ct,ae),!0):!1});P.forEach(function(k){i.glyphInfoMap[k.id]=k})}}},{key:"initGlyph",value:function(){var i=this.layer.getLayerConfig(),a=i.iconfont,s=a===void 0?!1:a;s?this.initIconFontTex():this.initTextFont(),this.generateGlyphLayout(s)}},{key:"updateTexture",value:function(){var i=this.rendererService.createTexture2D,a=this.getFontServiceCanvas();this.textureHeight=a.height,this.texture&&this.texture.destroy(),this.texture=i({data:a,mag:I.LINEAR,min:I.LINEAR,width:a.width,height:a.height}),this.textures=[this.texture]}},{key:"reBuildModel",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.filterGlyphs(),f.next=3,this.layer.buildLayerModel({moduleName:"pointText",vertexShader:Q1,fragmentShader:K1,triangulation:J1.bind(this),inject:this.getInject(),depth:{enable:!1}});case 3:s=f.sent,this.layer.models=[s];case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Na),VR={fillImage:dR,fill:z1,radar:CR,image:Z1,normal:j1,simplePoint:H3,extrude:U1,text:ex,earthFill:tR,earthExtrude:q3},jR=VR;function HR(e,r){var t=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!t){if(Array.isArray(e)||(t=WR(e))||r&&e&&typeof e.length=="number"){t&&(e=t);var n=0,i=function(){};return{s:i,n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(d){throw d},f:i}}throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var a=!0,s=!1,l;return{s:function(){t=t.call(e)},n:function(){var d=t.next();return a=d.done,d},e:function(d){s=!0,l=d},f:function(){try{!a&&t.return!=null&&t.return()}finally{if(s)throw l}}}}function WR(e,r){if(e){if(typeof e=="string")return tx(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return tx(e,r)}}function tx(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function GR(e){var r=XR();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function XR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Og=function(e){(0,Le.Z)(t,e);var r=GR(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"type","PointLayer"),(0,F.Z)((0,Re.Z)(n),"enableShaderEncodeStyles",["stroke","offsets","opacity","rotation"]),(0,F.Z)((0,Re.Z)(n),"enableDataEncodeStyles",["textOffset","textAnchor"]),(0,F.Z)((0,Re.Z)(n),"defaultSourceConfig",{data:[],options:{parser:{type:"json",x:"lng",y:"lat"}}}),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel&&this.layerModel.clearModels(),this.layerModel=new jR[s](this),f.next=5,this.initLayerModels();case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"rebuildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.buildModels();case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelTypeWillEmptyData",value:function(){if(this.shapeOption){var i=this.shapeOption,a=i.field,s=i.values,l=this.getLayerConfig(),f=l.shape2d,d=this.iconService.getIconMap();if(a&&(f==null?void 0:f.indexOf(a))!==-1)return"fill";if(s==="text")return"text";if(s&&s instanceof Array){var y=HR(s),b;try{for(y.s();!(b=y.n()).done;){var T=b.value;if(typeof T=="string"&&d.hasOwnProperty(T))return"image"}}catch(M){y.e(M)}finally{y.f()}}}return"normal"}},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={fillImage:{},normal:{blend:"additive"},radar:{},simplePoint:{},fill:{blend:"normal"},extrude:{},image:{},text:{blend:"normal"},tile:{},tileText:{},earthFill:{},earthExtrude:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),s=a.shape2d,l=a.shape3d,f=a.billboard,d=f===void 0?!0:f,y=this.iconService.getIconMap(),b=i.find(function(M){return M.hasOwnProperty("shape")});if(b){var T=b.shape;return T==="dot"?"normal":T==="simple"?"simplePoint":T==="radar"?"radar":this.layerType==="fillImage"||d===!1?"fillImage":(s==null?void 0:s.indexOf(T))!==-1?this.mapService.version==="GLOBEL"?"earthFill":"fill":(l==null?void 0:l.indexOf(T))!==-1?this.mapService.version==="GLOBEL"?"earthExtrude":"extrude":y.hasOwnProperty(T)?"image":"text"}else return this.getModelTypeWillEmptyData()}}]),t}(Rp);function $R(e){var r=YR();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function YR(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var qR=`layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
#pragma include "picking"
out vec4 outputColor;
void main() {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = v_Color;
  
  outputColor = filterColor(outputColor);
}
`,KR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
float isSide = a_Position.z;
 float topU = a_uvs[0];
 float topV = 1.0 - a_uvs[1];
 float sidey = a_uvs[2];

  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);

  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


 gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    // if(u_sidesurface < 1.0) {
    //   discard;
    // }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      v_Color = linearColor;
    } else {
      v_Color = a_Color;
    }

  } else {
    v_Color = a_Color;
  }

  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);


  setPickingColor(a_PickingColor);
}
`,QR=`uniform sampler2D u_texture;

layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;


#pragma include "picking"

out vec4 outputColor;

void main() {
  float opacity = u_opacity;
  float isSide = v_texture_data.x;
  float lightWeight = v_texture_data.y;
  float topU = v_uvs[0];
  float topV = 1.0 - v_uvs[1];
  float sidey = v_uvs[2];
  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {// \u662F\u5426\u662F\u8FB9\u7F18
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }

    if(u_linearColor == 1.0) {
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      outputColor = v_Color;
    }
  } else {

     // top face
    if(u_topsurface < 1.0) {
      discard;
    }

    outputColor = texture(SAMPLER_2D(u_texture), vec2(topU, topV));
  }
  

  outputColor.a *= opacity;
  outputColor = filterColor(outputColor);
}
`,JR=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec4 v_Color;

out vec2 v_texture_data;
out vec3 v_uvs;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  float lightWeight = calc_lighting(pos);
  vec4 project_pos = project_position(pos);
  v_uvs = a_uvs;
  v_Color = a_Color;
  v_Color.a *= opacity;
   
  v_texture_data = vec2(a_Position.z, lightWeight);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;

    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }


    gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));



  setPickingColor(a_PickingColor);
}
`,eM=`
layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

in vec4 v_Color;
in vec3 v_uvs;
in vec2 v_texture_data;
out vec4 outputColor;

#pragma include "picking"

void main() {
  float isSide =  v_texture_data.x;
  float sidey = v_uvs[2];
  float lightWeight = v_texture_data.y;

  // Tip: \u90E8\u5206\u673A\u578B GPU \u8BA1\u7B97\u7CBE\u5EA6\u517C\u5BB9
  if(isSide < 0.999) {
    // side face
    if(u_sidesurface < 1.0) {
      discard;
    }
    
    if( u_linearColor == 1.0) {
      // side use linear
      vec4 linearColor = mix(u_targetColor, u_sourceColor, sidey);
      linearColor.rgb *= lightWeight;
      outputColor = linearColor;
    } else {
      // side notuse linear
       outputColor = v_Color;
    }
  } else {
    // top face
    if(u_topsurface < 1.0) {
      discard;
    }
    outputColor = v_Color;
  }

  outputColor = filterColorAlpha(outputColor, lightWeight);
}
`,tM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;
layout(location = 14) in vec3 a_uvs;


layout(std140) uniform commonUniforms {
  vec4 u_sourceColor;
  vec4 u_targetColor;
  float u_linearColor;
  float u_topsurface;
  float u_sidesurface;
  float u_heightfixed; // \u9ED8\u8BA4\u4E0D\u56FA\u5B9A
  float u_raisingHeight;
};

out vec2 v_texture_data;
out vec3 v_uvs;
out vec4 v_Color;


#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {


  v_uvs = a_uvs;
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size, 1.0);
  vec4 project_pos = project_position(pos);

  if(u_heightfixed > 0.0) { // \u5224\u65AD\u51E0\u4F55\u4F53\u662F\u5426\u56FA\u5B9A\u9AD8\u5EA6
    project_pos.z = a_Position.z * a_Size;
    project_pos.z += u_raisingHeight;
    if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
      float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
      project_pos.z *= mapboxZoomScale;
      project_pos.z += u_raisingHeight * mapboxZoomScale;
    }
  }

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  float lightWeight = calc_lighting(pos);
  v_texture_data = vec2(a_Position.z,lightWeight);

  v_Color = vec4(a_Color.rgb * lightWeight, a_Color.w * opacity);

  setPickingColor(a_PickingColor);
}
`,rM=function(e){(0,Le.Z)(t,e);var r=$R(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,W.Z)((0,W.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.heightfixed,s=a===void 0?!1:a,l=i.raisingHeight,f=l===void 0?0:l,d=i.topsurface,y=d===void 0?!0:d,b=i.sidesurface,T=b===void 0?!0:b,M=i.sourceColor,P=i.targetColor,k=0,H=[1,1,1,1],q=[1,1,1,1];M&&P&&(H=vi(M),q=vi(P),k=1);var ae={u_sourceColor:H,u_targetColor:q,u_linearColor:k,u_topsurface:Number(y),u_sidesurface:Number(T),u_heightfixed:Number(s),u_raisingHeight:Number(f),u_texture:this.texture};this.texture&&(this.textures=[this.texture]);var Se=this.getUniformsBufferInfo(ae);return Se}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.loadTexture();case 2:return l.abrupt("return",this.buildModels());case 3:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y;return _e().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return s=this.getShaders(),l=s.frag,f=s.vert,d=s.type,this.initUniformsBuffer(),T.next=4,this.layer.buildLayerModel({moduleName:d,vertexShader:f,fragmentShader:l,depth:{enable:!0},inject:this.getInject(),triangulation:X0});case 4:return y=T.sent,T.abrupt("return",[y]);case 6:case"end":return T.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){var i=this.layer.getLayerConfig(),a=i.pickLight,s=i.mapTexture;return s?{frag:QR,vert:JR,type:"polygonExtrudeTexture"}:a?{frag:eM,vert:tM,type:"polygonExtrudePickLight"}:{frag:qR,vert:KR,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy(),this.textures=[]}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=i,s=this.layer.coordCenter||this.layer.getSource().center,l=a[2]-a[0],f=a[3]-a[1];if(this.mapService.version==="GAODE2.x"){var d=this.mapService.coordToAMap2RelativeCoordinates([i[0],i[1]],s),y=(0,yn.Z)(d,2),b=y[0],T=y[1],M=this.mapService.coordToAMap2RelativeCoordinates([i[2],i[3]],s),P=(0,yn.Z)(M,2),k=P[0],H=P[1];l=k-b,f=H-T,a=[b,T,k,H]}this.styleAttributeService.registerStyleAttribute({name:"uvs",type:Mn.Attribute,descriptor:{name:"a_uvs",shaderLocation:qn.UV,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(ae,Se,ze){var it=ze[0],ut=ze[1];return[(it-a[0])/l,(ut-a[1])/f,ze[4]]}}}),this.styleAttributeService.registerStyleAttribute({name:"normal",type:Mn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(ae,Se,ze,it,ut){return ut}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(ae){var Se=ae.size,ze=Se===void 0?10:Se;return Array.isArray(ze)?[ze[0]]:[ze]}}})}},{key:"loadTexture",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s=this,l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(l=this.layer.getLayerConfig(),f=l.mapTexture,d=this.rendererService.createTexture2D,this.texture=d({height:0,width:0}),!f){b.next=5;break}return b.abrupt("return",new Promise(function(T,M){var P=new Image;P.crossOrigin="anonymous",P.src=f,P.onload=function(){return s.texture=d({data:P,width:P.width,height:P.height,wrapS:I.CLAMP_TO_EDGE,wrapT:I.CLAMP_TO_EDGE,min:I.LINEAR,mag:I.LINEAR}),T(null)},P.onerror=function(){M(new Error("image load error"))}}));case 5:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()}]),t}(Na);function nM(e){var r=iM();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function iM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var aM=`
in vec4 v_Color;
#pragma include "picking"
out vec4 outputColor;
void main() {

  outputColor = v_Color;
  outputColor = filterColor(outputColor);
}
`,oM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 9) in float a_Size;
layout(location = 13) in vec3 a_Normal;

out vec4 v_Color;

#pragma include "projection"
#pragma include "light"
#pragma include "picking"

void main() {
 
  vec4 pos = vec4(a_Position.xy, a_Position.z * a_Size + (1.0 - a_Position.z) * extrusionBase, 1.0);

  vec4 project_pos = project_position(pos);
   float lightWeight = calc_lighting(project_pos);
  v_Color = a_Color;
  v_Color = vec4(v_Color.rgb * lightWeight, v_Color.w * opacity);

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}
`,sM=function(e){(0,Le.Z)(t,e);var r=nM(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,W.Z)((0,W.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i={},a=this.getUniformsBufferInfo(i);return a}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y;return _e().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return s=this.getShaders(),l=s.frag,f=s.vert,d=s.type,this.initUniformsBuffer(),T.next=4,this.layer.buildLayerModel({moduleName:d,vertexShader:f,fragmentShader:l,inject:this.getInject(),triangulation:X0,depth:{enable:!0}});case 4:return y=T.sent,T.abrupt("return",[y]);case 6:case"end":return T.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getShaders",value:function(){return{frag:aM,vert:oM,type:"polygonExtrude"}}},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"normal",type:Mn.Attribute,descriptor:{name:"a_Normal",shaderLocation:qn.NORMAL,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(a,s,l,f,d){return d}}}),this.styleAttributeService.registerStyleAttribute({name:"size",type:Mn.Attribute,descriptor:{name:"a_Size",shaderLocation:qn.SIZE,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(a){var s=a.size,l=s===void 0?10:s;return Array.isArray(l)?[l[0]]:[l]}}})}}]),t}(Na);function uM(e){var r=lM();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function lM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var cM=`in vec4 v_color;
#pragma include "picking"
out vec4 outputColor;
void main() {
  outputColor = v_color;
  outputColor = filterColor(outputColor);
}
`,fM=`
layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};

in vec3 v_linear;
in vec2 v_pos;
in vec4 v_color;
out vec4 outputColor;
#pragma include "picking"

void main() {
   outputColor = v_color;
  if(u_opacitylinear > 0.0) {
    outputColor.a *= u_dir == 1.0 ? 1.0 - length(v_pos - v_linear.xy)/v_linear.z : length(v_pos - v_linear.xy)/v_linear.z;
  }
  outputColor = filterColor(outputColor);
}
`,hM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 15) in vec3 a_linear;


layout(std140) uniform commonUniforms {
  float u_raisingHeight;
  float u_opacitylinear;
  float u_dir;
};


out vec4 v_color;

#pragma include "projection"
#pragma include "picking"

out vec3 v_linear;
out vec2 v_pos;

void main() {
  if(u_opacitylinear > 0.0) {
    v_linear = a_linear;
    v_pos = a_Position.xy;
  }
  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
  setPickingColor(a_PickingColor);
}`,pM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;

layout(std140) uniform commonUniforms {
  float u_raisingHeight;
};


out vec4 v_color;


#pragma include "projection"
#pragma include "picking"

void main() {
  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  // cal style mapping - \u6570\u636E\u7EB9\u7406\u6620\u5C04\u90E8\u5206\u7684\u8BA1\u7B97

  v_color = vec4(a_Color.xyz, a_Color.w * opacity);
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  // gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));

  project_pos.z += u_raisingHeight;

  if(u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT || u_CoordinateSystem == COORDINATE_SYSTEM_LNGLAT_OFFSET) {
    float mapboxZoomScale = 4.0/pow(2.0, 21.0 - u_Zoom);
    project_pos.z *= mapboxZoomScale;
    project_pos.z += u_raisingHeight * mapboxZoomScale;
  }

 
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));

  setPickingColor(a_PickingColor);
}

`,dM=function(e){(0,Le.Z)(t,e);var r=uM(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,W.Z)((0,W.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.raisingHeight,s=a===void 0?0:a,l=i.opacityLinear,f=l===void 0?{enable:!1,dir:"in"}:l,d={u_raisingHeight:Number(s),u_opacitylinear:Number(f.enable),u_dir:f.dir==="in"?1:0},y=this.getUniformsBufferInfo(d);return y}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y,b;return _e().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return s=this.getModelParams(),l=s.frag,f=s.vert,d=s.triangulation,y=s.type,this.initUniformsBuffer(),this.layer.triangulation=d,M.next=5,this.layer.buildLayerModel({moduleName:y,vertexShader:f,fragmentShader:l,inject:this.getInject(),triangulation:d,primitive:I.TRIANGLES,depth:{enable:!1}});case 5:return b=M.sent,M.abrupt("return",[b]);case 7:case"end":return M.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,s=a===void 0?{enable:!1,dir:"in"}:a;s.enable&&this.styleAttributeService.registerStyleAttribute({name:"linear",type:Mn.Attribute,descriptor:{name:"a_linear",shaderLocation:qn.LINEAR,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:3,update:function(f,d,y){return[y[3],y[4],y[5]]}}})}},{key:"getModelParams",value:function(){var i=this.layer.getLayerConfig(),a=i.opacityLinear,s=a===void 0?{enable:!1}:a;return s.enable?{frag:fM,vert:hM,type:"polygonLinear",triangulation:Hw}:{frag:cM,vert:pM,type:"polygonFill",triangulation:Mh}}}]),t}(Na);function vM(e){var r=mM();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function mM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var gM=`
layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};

in vec2 v_uv;
in float v_opacity;
out vec4 outputColor;

float coast2water_fadedepth = 0.10;
float large_waveheight      = .750; // change to adjust the "heavy" waves
float large_wavesize        = 3.4;  // factor to adjust the large wave size
float small_waveheight      = 0.6;  // change to adjust the small random waves
float small_wavesize        = 0.5;   // factor to ajust the small wave size
float water_softlight_fact  = 15.;  // range [1..200] (should be << smaller than glossy-fact)
float water_glossylight_fact= 120.; // range [1..200]
float particle_amount       = 70.;

vec3 water_specularcolor    = vec3(1.3, 1.3, 0.9);    // specular Color (RGB) of the water-highlights
#define light                 vec3(-0., sin(u_time*0.5)*.5 + .35, 2.8) // position of the sun

uniform sampler2D u_texture1;
uniform sampler2D u_texture2;
uniform sampler2D u_texture3;

  

float hash( float n ) {
    return fract(sin(n)*43758.5453123);
}

// 2d noise function
float noise1( in vec2 x ) {
  vec2 p  = floor(x);
  vec2 f  = smoothstep(0.0, 1.0, fract(x));
  float n = p.x + p.y*57.0;
  return mix(mix( hash(n+  0.0), hash(n+  1.0),f.x),
    mix( hash(n+ 57.0), hash(n+ 58.0),f.x),f.y);
}

float noise(vec2 p) {
    return texture(SAMPLER_2D(u_texture2),p*vec2(1./256.)).x;
}

vec4 highness(vec2 p) {
    vec4 t = texture(SAMPLER_2D(u_texture1),fract(p));
    float clipped = -2.0-smoothstep(3.,10.,t.a)*6.9-smoothstep(10.,100.,t.a)*89.9-smoothstep(0.,10000.,t.a)*10000.0;
    return clamp(t, 0.0,3.0)+clamp(t/3.0-1.0, 0.0,1.0)+clamp(t/16.0-1.0, 0.0,1.0);
}

float height_map( vec2 p ) {
    vec4 height=highness(p);
    /*
    height = -0.5+
        0.5*smoothstep(-100.,0.,-height)+
        2.75*smoothstep(0.,2.,height)+
        1.75*smoothstep(2.,4.,height)+
        2.75*smoothstep(4.,16.,height)+
        1.5*smoothstep(16.,1000.,height);
    */

    mat2 m = mat2( 0.9563*1.4,  -0.2924*1.4,  0.2924*1.4,  0.9563*1.4 );
    //p = p*6.;
    float f = 0.6000*noise1( p ); p = m*p*1.1*6.;
    f += 0.2500*noise( p ); p = m*p*1.32;
    f += 0.1666*noise( p ); p = m*p*1.11;
    f += 0.0834*noise( p ); p = m*p*1.12;
    f += 0.0634*noise( p ); p = m*p*1.13;
    f += 0.0444*noise( p ); p = m*p*1.14;
    f += 0.0274*noise( p ); p = m*p*1.15;
    f += 0.0134*noise( p ); p = m*p*1.16;
    f += 0.0104*noise( p ); p = m*p*1.17;
    f += 0.0084*noise( p );
    f = .25*f+dot(height,vec4(-.03125,-.125,.25,.25))*.5;
        const float FLAT_LEVEL = 0.92525;
        //f = f*0.25+height*0.75;
    if (f<FLAT_LEVEL)
        f = f;
    else
        f = pow((f-FLAT_LEVEL)/(1.-FLAT_LEVEL), 2.)*(1.-FLAT_LEVEL)*2.0+FLAT_LEVEL; // makes a smooth coast-increase
    return clamp(f, 0., 10.);
}

vec3 plasma_quintic( float x ) {
    x = clamp( x, 0.0, 1.0);
    vec4 x1 = vec4( 1.0, x, x * x, x * x * x ); // 1 x x2 x3
    vec4 x2 = x1 * x1.w * x; // x4 x5 x6 x7
    return vec3(
        dot( x1.xyzw, vec4( +0.063861086, +1.992659096, -1.023901152, -0.490832805 ) ) + dot( x2.xy, vec2( +1.308442123, -0.914547012 ) ),
        dot( x1.xyzw, vec4( +0.049718590, -0.791144343, +2.892305078, +0.811726816 ) ) + dot( x2.xy, vec2( -4.686502417, +2.717794514 ) ),
        dot( x1.xyzw, vec4( +0.513275779, +1.580255060, -5.164414457, +4.559573646 ) ) + dot( x2.xy, vec2( -1.916810682, +0.570638854 ) ) );
}

vec4 color(vec2 p){
    vec4 c1 = vec4(1.7,1.6,.9,1);
    vec4 c2 = vec4(.2,.94,.1,1);
    vec4 c3 = vec4(.3,.2,.0,1);
    vec4 c4 = vec4(.99,.99,1.6,1);
    vec4 v = highness(p);
    float los = smoothstep(0.1,1.1,v.b);
    float his = smoothstep(3.5,6.5,v.b);
    float ces = smoothstep(1.,5.,v.a);
    vec4 lo = mix(c1,c2,los);
    vec4 hi = mix(c3,c4,his);
    vec4 ce = mix(lo,hi,ces);

    return vec4(plasma_quintic(ces),1).ragb;
}

vec3 terrain_map( vec2 p )
{
  return color(p).rgb*0.75+0.25*vec3(0.7, .55, .4)+texture(SAMPLER_2D(u_texture3), fract(p*5.)).rgb*.5; // test-terrain is simply 'sandstone'
}

const mat2 m = mat2( 0.72, -1.60,  1.60,  0.72 );

float water_map( vec2 p, float height ) {
    vec2 p2 = p*large_wavesize;
    vec2 shift1 = 0.001*vec2( u_time*160.0*2.0, u_time*120.0*2.0 );
    vec2 shift2 = 0.001*vec2( u_time*190.0*2.0, -u_time*130.0*2.0 );

    // coarse crossing 'ocean' waves...
    float f = 0.6000*noise( p );
    f += 0.2500*noise( p*m );
    f += 0.1666*noise( p*m*m );
    float wave = sin(p2.x*0.622+p2.y*0.622+shift2.x*4.269)*large_waveheight*f*height*height ;

    p *= small_wavesize;
    f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<9; i++)
    { p = m*p*.947; f -= amp*abs(sin((noise( p+shift1*s )-.5)*2.)); amp = amp*.59; s*=-1.329; }
    
    return wave+f*small_waveheight;
}

float nautic(vec2 p) {
    p *= 18.;
    float f = 0.;
    float amp = 1.0, s = .5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*abs(smoothstep(0., 1., noise( p+u_time*s ))-.5); amp = amp*.5; s*=-1.227; }
    return pow(1.-f, 5.);
}

float particles(vec2 p) {
    p *= 200.;
    float f = 0.;
    float amp = 1.0, s = 1.5;
    for (int i=0; i<3; i++)
    { p = m*p*1.2; f += amp*noise( p+u_time*s ); amp = amp*.5; s*=-1.227; }
    return pow(f*.35, 7.)*particle_amount;
}

float test_shadow( vec2 xy, float height) {
    vec3 r0 = vec3(xy, height);
    vec3 rd = normalize( light - r0 );
    
    float hit = 1.0;
    float t   = 0.001;
    for (int j=1; j<25; j++)
    {
        vec3 p = r0 + t*rd;
        float h = height_map( p.xy );
        float height_diff = p.z - h;
        if (height_diff<0.0)
        {
            return 0.0;
        }
        t += 0.01+height_diff*.02;
        hit = min(hit, 2.*height_diff/t); // soft shaddow   
    }
    return hit;
}

vec3 CalcTerrain(vec2 uv, float height) {
    vec3 col = terrain_map( uv );
    vec2 iResolution = vec2(512.);
    float h1 = height_map(uv-vec2(0., 0.5)/ iResolution.xy);
    float h2 = height_map(uv+vec2(0., 0.5)/ iResolution.xy);
    float h3 = height_map(uv-vec2(0.5, 0.)/ iResolution.xy);
    float h4 = height_map(uv+vec2(0.5, 0.)/ iResolution.xy);
    vec3 norm = normalize(vec3(h3-h4, h1-h2, 1.));
    vec3 r0 = vec3(uv, height);
    vec3 rd = normalize( light - r0 );
    float grad = dot(norm, rd);
    col *= grad+pow(grad, 8.);
    float terrainshade = test_shadow( uv, height );
    col = mix(col*.25, col, terrainshade);
    return col;
}


void main() {
  vec3 watercolor = u_watercolor.rgb;
  vec3 watercolor2 = u_watercolor2.rgb;
  vec2 uv = v_uv;
  float WATER_LEVEL = 0.84; // Water level (range: 0.0 - 2.0)
  float deepwater_fadedepth   = 0.4 + coast2water_fadedepth;
  float height = height_map( uv );
  vec3 col;

    float waveheight = clamp(WATER_LEVEL*3.-1.5, 0., 1.);
    float level = WATER_LEVEL + .2*water_map(uv*15. + vec2(u_time*.1), waveheight);
    if (height > level)
    {
        col = CalcTerrain(uv, height);
    }
    if (height <= level)
    {
        vec2 dif = vec2(.0, .01);
        vec2 pos = uv*15. + vec2(u_time*.01);
        float h1 = water_map(pos-dif,waveheight);
        float h2 = water_map(pos+dif,waveheight);
        float h3 = water_map(pos-dif.yx,waveheight);
        float h4 = water_map(pos+dif.yx,waveheight);
        vec3 normwater = normalize(vec3(h3-h4, h1-h2, .125)); // norm-vector of the 'bumpy' water-plane
        uv += normwater.xy*.002*(level-height);
        
        col = CalcTerrain(uv, height);

        float coastfade = clamp((level-height)/coast2water_fadedepth, 0., 1.);
        float coastfade2= clamp((level-height)/deepwater_fadedepth, 0., 1.);
        float intensity = col.r*.2126+col.g*.7152+col.b*.0722;
        watercolor = mix(watercolor*intensity, watercolor2, smoothstep(0., 1., coastfade2));

        vec3 r0 = vec3(uv, WATER_LEVEL);
        vec3 rd = normalize( light - r0 ); // ray-direction to the light from water-position
        float grad     = dot(normwater, rd); // dot-product of norm-vector and light-direction
        float specular = pow(grad, water_softlight_fact);  // used for soft highlights                          
        float specular2= pow(grad, water_glossylight_fact); // used for glossy highlights
        float gradpos  = dot(vec3(0., 0., 1.), rd);
        float specular1= smoothstep(0., 1., pow(gradpos, 5.));  // used for diffusity (some darker corona around light's specular reflections...)                          
        float watershade  = test_shadow( uv, level );
        watercolor *= 2.2+watershade;
        watercolor += (.2+.8*watershade) * ((grad-1.0)*.5+specular) * .25;
        watercolor /= (1.+specular1*1.25);
        watercolor += watershade*specular2*water_specularcolor;
        watercolor += watershade*coastfade*(1.-coastfade2)*(vec3(.5, .6, .7)*nautic(uv)+vec3(1., 1., 1.)*particles(uv));
        
        col = mix(col, watercolor, coastfade);
    }
    
  outputColor = vec4(col, v_opacity);  
}
`,_M=`layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_uv;

layout(std140) uniform commonUniforms {
  vec4 u_watercolor;
  vec4 u_watercolor2;
  float u_time;
};


out vec2 v_uv;
out float v_opacity;

#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_opacity = opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,dF=ui.isNumber,yM=function(e){(0,Le.Z)(t,e);var r=vM(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,W.Z)((0,W.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.watercolor,s=a===void 0?"#6D99A8":a,l=i.watercolor2,f=l===void 0?"#0F121C":l,d={u_watercolor:vi(s),u_watercolor2:vi(f),u_time:this.layer.getLayerAnimateTime(),u_texture1:this.texture1,u_texture2:this.texture2,u_texture3:this.texture3};this.textures=[this.texture1,this.texture2,this.texture3];var y=this.getUniformsBufferInfo(d);return y}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"polygonOcean",vertexShader:_M,fragmentShader:gM,inject:this.getInject(),triangulation:G0,primitive:I.TRIANGLES,depth:{enable:!1}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a,s;(i=this.texture1)===null||i===void 0||i.destroy(),(a=this.texture2)===null||a===void 0||a.destroy(),(s=this.texture3)===null||s===void 0||s.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,yn.Z)(i,4),s=a[0],l=a[1],f=a[2],d=a[3],y=f-s,b=d-l;this.styleAttributeService.registerStyleAttribute({name:"oceanUv",type:Mn.Attribute,descriptor:{name:"a_uv",shaderLocation:qn.UV,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(M,P,k,H){var q=M.version==="GAODE2.x"?M.originCoordinates[0][H]:k,ae=(0,yn.Z)(q,2),Se=ae[0],ze=ae[1];return[(Se-s)/y,(ze-l)/b]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.rendererService.createTexture2D,s={height:0,width:0};this.texture1=a(s),this.texture2=a(s),this.texture3=a(s),l(function(d){i.texture1=f(d[0]),i.texture2=f(d[1]),i.texture3=f(d[2]),i.layerService.reRender()});function l(d){var y=0,b=[],T=["https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*MJ22QbpuCzIAAAAAAAAAAAAAARQnAQ","https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*-z2HSIVDsHIAAAAAAAAAAAAAARQnAQ"];T.map(function(M){var P=new Image;P.crossOrigin="",P.src=M,b.push(P),P.onload=function(){y++,y===3&&d(b)}})}function f(d){return a({data:d,width:d.width,height:d.height,wrapS:I.MIRRORED_REPEAT,wrapT:I.MIRRORED_REPEAT,min:I.LINEAR,mag:I.LINEAR})}}}]),t}(Na);function xM(e){var r=bM();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function bM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var EM=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};

out vec4 outputColor;


in vec4 v_Color;
in vec2 v_uv;

float rand(vec2 n) { return 0.5 + 0.5 * fract(sin(dot(n.xy, vec2(12.9898, 78.233)))* 43758.5453); }

float water(vec3 p) {
  float t = u_time * u_speed;
  p.z += t * 2.; p.x += t * 2.;
  vec3 c1 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 3.; p.x += t * 0.52;
  vec3 c2 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  p.z += t * 4.; p.x += t * 0.8;
  vec3 c3 = texture(SAMPLER_2D(u_texture), p.xz / 30.).xyz;
  c1 += c2 - c3;
  float z = (c1.x + c1.y + c1.z) / 3.;
  return p.y + z / 4.;
}

float map(vec3 p) {
  float d = 100.0;
  d = water(p);
  return d;
}

float intersect(vec3 ro, vec3 rd) {
  float d = 0.0;
  for (int i = 0; i <= 100; i++) {
    float h = map(ro + rd * d);
    if (h < 0.1) return  d;
    d += h;
  }
  return 0.0;
}

vec3 norm(vec3 p) {
  float eps = .1;
  return normalize(vec3(
    map(p + vec3(eps, 0, 0)) - map(p + vec3(-eps, 0, 0)),
    map(p + vec3(0, eps, 0)) - map(p + vec3(0, -eps, 0)),
    map(p + vec3(0, 0, eps)) - map(p + vec3(0, 0, -eps))
  ));
} 

float calSpc() {
  vec3 l1 = normalize(vec3(1, 1, 1));
  vec3 ro = vec3(-3, 20, -8);
  vec3 rc = vec3(0, 0, 0);
  vec3 ww = normalize(rc - ro);
  vec3 uu = normalize(cross(vec3(0,1,0), ww));
  vec3 vv = normalize(cross(rc - ro, uu));
  vec3 rd = normalize(uu * v_uv.x + vv * v_uv.y + ww);
  float d = intersect(ro, rd);
  vec3 p = ro + rd * d;
  vec3 n = norm(p);
  float spc = pow(max(0.0, dot(reflect(l1, n), rd)), 30.0);
  return spc;
}

void main() {

  outputColor = v_Color;
  float spc = calSpc();
  outputColor += spc * 0.4;
}
`,SM=`layout(location = 0) in vec3 a_Position;
layout(location = 1) in vec4 a_Color;
layout(location = 14) in vec2 a_uv;
layout(std140) uniform commonUniforms {
  float u_speed;
  float u_time;
};
out vec4 v_Color;
out vec2 v_uv;


#pragma include "projection"

void main() {
  v_uv = a_uv;
  v_Color = a_Color;
  v_Color.a *= opacity;
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xyz, 1.0));
}

`,vF=ui.isNumber,AM=function(e){(0,Le.Z)(t,e);var r=xM(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,W.Z)((0,W.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.speed,s=a===void 0?.5:a,l={u_speed:s,u_time:this.layer.getLayerAnimateTime(),u_texture:this.texture};this.textures=[this.texture];var f=this.getUniformsBufferInfo(l);return f}},{key:"getAnimateUniforms",value:function(){return{u_time:this.layer.getLayerAnimateTime()}}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return this.loadTexture(),l.abrupt("return",this.buildModels());case 2:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"polygonWater",vertexShader:SM,fragmentShader:EM,triangulation:G0,inject:this.getInject(),primitive:I.TRIANGLES,depth:{enable:!1}});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){var i=this.layer.getSource().extent,a=(0,yn.Z)(i,4),s=a[0],l=a[1],f=a[2],d=a[3],y=f-s,b=d-l;this.styleAttributeService.registerStyleAttribute({name:"waterUv",type:Mn.Attribute,descriptor:{name:"a_uv",shaderLocation:qn.UV,buffer:{usage:I.STATIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(M,P,k,H){var q=M.version==="GAODE2.x"?M.originCoordinates[0][H]:k,ae=(0,yn.Z)(q,2),Se=ae[0],ze=ae[1];return[(Se-s)/y,(ze-l)/b]}}})}},{key:"loadTexture",value:function(){var i=this,a=this.layer.getLayerConfig(),s=a.waterTexture,l=this.rendererService.createTexture2D;this.texture=l({height:0,width:0});var f=new Image;f.crossOrigin="",s?(console.warn("L7 recommend\uFF1Ahttps://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ"),f.src=s):f.src="https://gw.alipayobjects.com/mdn/rms_816329/afts/img/A*EojwT4VzSiYAAAAAAAAAAAAAARQnAQ",f.onload=function(){i.texture=l({data:f,width:f.width,height:f.height,wrapS:I.MIRRORED_REPEAT,wrapT:I.MIRRORED_REPEAT,min:I.LINEAR,mag:I.LINEAR}),i.layerService.reRender()}}}]),t}(Na),TM={fill:dM,line:F1,extrude:rM,text:ex,point_fill:z1,point_image:Z1,point_normal:j1,point_extrude:U1,water:AM,ocean:yM,extrusion:sM},wM=TM;function CM(e){var r=RM();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function RM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var kg=function(e){(0,Le.Z)(t,e);var r=CM(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"type","PolygonLayer"),(0,F.Z)((0,Re.Z)(n),"enableShaderEncodeStyles",["opacity","extrusionBase","rotation","offsets","stroke"]),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new wM[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){var i,a=this.styleAttributeService.getLayerStyleAttribute("shape"),s=a==null||(i=a.scale)===null||i===void 0?void 0:i.field;return s==="fill"||!s?"fill":s==="extrude"?"extrude":s==="extrusion"?"extrusion":s==="water"?"water":s==="ocean"?"ocean":s==="line"?"line":this.getPointModelType()}},{key:"getPointModelType",value:function(){var i=this.getEncodedData(),a=this.getLayerConfig(),s=a.shape2d,l=a.shape3d,f=this.iconService.getIconMap(),d=i.find(function(b){return b.hasOwnProperty("shape")});if(d){var y=d.shape;return y==="dot"?"point_normal":(s==null?void 0:s.indexOf(y))!==-1?"point_fill":(l==null?void 0:l.indexOf(y))!==-1?"point_extrude":f.hasOwnProperty(y)?"point_image":"text"}else return"fill"}}]),t}(Rp);function MM(e){var r=IM();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function IM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var PM=`layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  bool u_clampLow;
  bool u_clampHigh;
};

uniform sampler2D u_rasterTexture;
uniform sampler2D u_colorTexture;

in vec2 v_texCoord;

bool isnan_emu(float x) { return (x > 0.0 || x < 0.0) ? x != x : x != 0.0; }

out vec4 outputColor;

void main() {
  // Can use any component here since u_rasterTexture is under luminance format.
  float value = texture(SAMPLER_2D(u_rasterTexture), vec2(v_texCoord.x, v_texCoord.y)).r;
  if (value == u_noDataValue || isnan_emu(value)) {
    discard;
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
    discard;
  } else {
    float normalisedValue =(value - u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec4 color = texture(SAMPLER_2D(u_colorTexture), vec2(normalisedValue, 0));
    
    outputColor = color;
    outputColor.a = outputColor.a * u_opacity ;
    if (outputColor.a < 0.01)
      discard;
  }
}
`,OM=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
  vec2 u_domain;
  float u_opacity;
  float u_noDataValue;
  bool u_clampLow;
  bool u_clampHigh;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
  gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,rx=function(e){(0,Le.Z)(t,e);var r=MM(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,W.Z)((0,W.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.clampLow,f=l===void 0?!0:l,d=i.clampHigh,y=d===void 0?!0:d,b=i.noDataValue,T=b===void 0?-9999999:b,M=i.domain,P=i.rampColors,k=M||_c(P);this.colorTexture=this.layer.textureService.getColorTexture(P,k);var H={u_domain:k,u_opacity:s||1,u_noDataValue:T,u_clampLow:f,u_clampHigh:typeof y!="undefined"?y:f,u_rasterTexture:this.texture,u_colorTexture:this.colorTexture};this.textures=[this.texture,this.colorTexture];var q=this.getUniformsBufferInfo(H);return q}},{key:"getRasterData",value:function(){var n=(0,Zt.Z)(_e().mark(function a(s){var l,f,d,y;return _e().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(!Array.isArray(s.data)){T.next=4;break}return T.abrupt("return",{data:s.data,width:s.width,height:s.height});case 4:return T.next=6,s.data;case 6:return l=T.sent,f=l.rasterData,d=l.width,y=l.height,T.abrupt("return",{data:Array.from(f),width:d,height:y});case 11:case"end":return T.stop()}},a)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y,b,T,M,P,k;return _e().wrap(function(q){for(;;)switch(q.prev=q.next){case 0:return this.initUniformsBuffer(),s=this.layer.getSource(),l=this.rendererService,f=l.createTexture2D,d=l.queryVerdorInfo,y=s.data.dataArray[0],q.next=6,this.getRasterData(y);case 6:return b=q.sent,T=b.data,M=b.width,P=b.height,this.texture=f({data:new Float32Array(T),width:M,height:P,format:d()==="WebGL1"?I.LUMINANCE:I.RED,type:I.FLOAT,alignment:1}),q.next=13,this.layer.buildLayerModel({moduleName:"rasterImageData",vertexShader:OM,fragmentShader:PM,triangulation:Ig,primitive:I.TRIANGLES,depth:{enable:!1}});case 13:return k=q.sent,q.abrupt("return",[k]);case 15:case"end":return q.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i,a;(i=this.texture)===null||i===void 0||i.destroy(),(a=this.colorTexture)===null||a===void 0||a.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Mn.Attribute,descriptor:{shaderLocation:qn.UV,name:"a_Uv",buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Na),kM=["data"],DM=["rasterData"];function LM(e){var r=BM();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function BM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var FM=`uniform sampler2D u_texture;
layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

in vec2 v_texCoord;

out vec4 outputColor;

void main() {

  vec3 rgb = texture(SAMPLER_2D(u_texture),vec2(v_texCoord.x,v_texCoord.y)).rgb;

  if(rgb == vec3(u_noDataValue)) {
    outputColor = vec4(0.0, 0, 0, 0.0);
  } else {
    outputColor = vec4(rgb.r / (u_rminmax.y -u_rminmax.x), rgb.g /(u_gminmax.y -u_gminmax.x), rgb.b/ (u_bminmax.y - u_bminmax.x), u_opacity);
  }
  if(outputColor.a < 0.01)
    discard;
 
}`,NM=`
layout(location = 0) in vec3 a_Position;
layout(location = 14) in vec2 a_Uv;

layout(std140) uniform commonUniforms {
 vec2 u_rminmax;
 vec2 u_gminmax;
 vec2 u_bminmax;
 float u_opacity;
 float u_noDataValue;
};

out vec2 v_texCoord;

#pragma include "projection"

void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,UM=function(e){(0,Le.Z)(t,e);var r=LM(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"dataOption",{}),n}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,W.Z)((0,W.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.noDataValue,f=l===void 0?0:l,d=this.dataOption,y=d.rMinMax,b=y===void 0?[0,255]:y,T=d.gMinMax,M=T===void 0?[0,255]:T,P=d.bMinMax,k=P===void 0?[0,255]:P,H={u_rminmax:b,u_gminmax:M,u_bminmax:k,u_opacity:s||1,u_noDataValue:f,u_texture:this.texture};this.textures=[this.texture];var q=this.getUniformsBufferInfo(H);return q}},{key:"getRasterData",value:function(){var n=(0,Zt.Z)(_e().mark(function a(s){var l,f,d,y,b;return _e().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:if(!Array.isArray(s.data)){M.next=4;break}return l=s.data,f=(0,Ea.Z)(s,kM),this.dataOption=f,M.abrupt("return",(0,W.Z)({data:l},f));case 4:return M.next=6,s.data;case 6:if(d=M.sent,y=d.rasterData,b=(0,Ea.Z)(d,DM),this.dataOption=b,!Array.isArray(y)){M.next=14;break}return M.abrupt("return",(0,W.Z)({data:y},b));case 14:return M.abrupt("return",(0,W.Z)({data:Array.from(y)},b));case 15:case"end":return M.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y,b,T,M;return _e().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:return this.initUniformsBuffer(),s=this.layer.getSource(),l=this.rendererService.createTexture2D,f=s.data.dataArray[0],k.next=6,this.getRasterData(f);case 6:return d=k.sent,y=d.data,b=d.width,T=d.height,this.texture=l({data:new Float32Array(y),width:b,height:T,format:I.RGB,type:I.FLOAT}),k.next=13,this.layer.buildLayerModel({moduleName:"rasterImageDataRGBA",vertexShader:NM,fragmentShader:FM,triangulation:Ig,primitive:I.TRIANGLES,depth:{enable:!1}});case 13:return M=k.sent,k.abrupt("return",[M]);case 15:case"end":return k.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Mn.Attribute,descriptor:{name:"a_Uv",shaderLocation:qn.UV,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Na);function zM(e){var r=ZM();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function ZM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var VM=`precision mediump float;
uniform float u_opacity: 1.0;

uniform sampler2D u_texture;
uniform sampler2D u_colorTexture;

varying vec2 v_texCoord;

uniform vec2 u_domain;
uniform float u_noDataValue;
uniform bool u_clampLow: true;
uniform bool u_clampHigh: true;
uniform vec4 u_unpack;

float getElevation(vec2 coord, float bias) {
    // Convert encoded elevation value to meters
    vec4 data = texture2D(u_texture, coord,bias) * 255.0;
    data.a = -1.0;
    return dot(data, u_unpack);
}

vec4 getColor(float value) {
   float normalisedValue =(value- u_domain[0]) / (u_domain[1] - u_domain[0]);
    vec2 coord = vec2(normalisedValue, 0);
    return texture2D(u_colorTexture, coord);
}

void main() {
  float value = getElevation(v_texCoord,0.0);
  if (value == u_noDataValue) {
    gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else if ((!u_clampLow && value < u_domain[0]) || (!u_clampHigh && value > u_domain[1])) {
     gl_FragColor = vec4(0.0, 0, 0, 0.0);
  } else {
   
    gl_FragColor = getColor(value);
    gl_FragColor.a =  gl_FragColor.a * u_opacity ;
      if(gl_FragColor.a < 0.01)
      discard;
  }
}
`,jM=`precision highp float;
uniform mat4 u_ModelMatrix;

attribute vec3 a_Position;
attribute vec2 a_Uv;
varying vec2 v_texCoord;
#pragma include "projection"
void main() {
   v_texCoord = a_Uv;
   vec4 project_pos = project_position(vec4(a_Position, 1.0));
   gl_Position = project_common_position_to_clipspace_v2(vec4(project_pos.xy,0., 1.0));
}
`,HM=function(e){(0,Le.Z)(t,e);var r=zM(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=i.clampLow,l=s===void 0?!0:s,f=i.clampHigh,d=f===void 0?!0:f,y=i.noDataValue,b=y===void 0?-9999999:y,T=i.domain,M=i.rampColors,P=i.colorTexture,k=i.rScaler,H=k===void 0?6553.6:k,q=i.gScaler,ae=q===void 0?25.6:q,Se=i.bScaler,ze=Se===void 0?.1:Se,it=i.offset,ut=it===void 0?1e4:it,ot=T||_c(M),Ct=P;return P?this.layer.textureService.setColorTexture(P,M,ot):Ct=this.layer.textureService.getColorTexture(M,ot),{u_opacity:a||1,u_texture:this.texture,u_domain:ot,u_clampLow:l,u_clampHigh:typeof d!="undefined"?d:l,u_noDataValue:b,u_unpack:[H,ae,ze,ut],u_colorTexture:Ct}}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.layer.getSource(),l=this.rendererService.createTexture2D,b.next=4,s.data.images;case 4:return f=b.sent,this.texture=l({data:f[0],width:f[0].width,height:f[0].height,min:I.LINEAR,mag:I.LINEAR}),b.next=8,this.layer.buildLayerModel({moduleName:"RasterTileDataImage",vertexShader:jM,fragmentShader:VM,triangulation:Ig,primitive:I.TRIANGLES,depth:{enable:!1}});case 8:return d=b.sent,b.abrupt("return",[d]);case 10:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i;(i=this.texture)===null||i===void 0||i.destroy()}},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.initModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"registerBuiltinAttributes",value:function(){this.styleAttributeService.registerStyleAttribute({name:"uv",type:Mn.Attribute,descriptor:{name:"a_Uv",buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:2,update:function(a,s,l){return[l[3],l[4]]}}})}}]),t}(Na),WM={raster:rx,rasterRgb:UM,raster3d:rx,rasterTerrainRgb:HM},GM=WM;function XM(e){var r=$M();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function $M(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Dg=function(e){(0,Le.Z)(t,e);var r=XM(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"type","RasterLayer"),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new GM[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getDefaultConfig",value:function(){var i=this.getModelType(),a={raster:{},rasterRgb:{},raster3d:{},rasterTerrainRgb:{}};return a[i]}},{key:"getModelType",value:function(){var i=this.layerSource.getParserType();switch(i){case"raster":return"raster";case"rasterRgb":return"rasterRgb";case"rgb":return"rasterRgb";case"image":return"rasterTerrainRgb";default:return"raster"}}}]),t}(Rp);function YM(e){var r=qM();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function qM(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var KM=`layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

out vec4 outputColor;

void main() {
  outputColor = u_color;
  outputColor.a *= u_opacity;
}
`,QM=`layout(location = 0) in vec3 a_Position;

layout(std140) uniform commonUniorm {
  vec4 u_color;
  float u_opacity;
};

#pragma include "projection"

void main() {
  vec4 project_pos = project_position(vec4(a_Position, 1.0));

  if(u_CoordinateSystem == COORDINATE_SYSTEM_P20_2) { // gaode2.x
    gl_Position = u_Mvp * (vec4(project_pos.xyz, 1.0));
  } else {
    gl_Position = project_common_position_to_clipspace(vec4(project_pos.xyz, 1.0));
  }
}

`,JM=function(e){(0,Le.Z)(t,e);var r=YM(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getUninforms",value:function(){var i=this.getCommonUniformsInfo(),a=this.getUniformsBufferInfo(this.getStyleAttribute());return this.updateStyleUnifoms(),(0,W.Z)((0,W.Z)({},i.uniformsOption),a.uniformsOption)}},{key:"getCommonUniformsInfo",value:function(){var i=this.layer.getLayerConfig(),a=i.opacity,s=a===void 0?1:a,l=i.color,f=l===void 0?"#000":l,d={u_color:vi(f),u_opacity:s||1},y=this.getUniformsBufferInfo(d);return y}},{key:"initModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.abrupt("return",this.buildModels());case 1:case"end":return l.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return this.initUniformsBuffer(),f.next=3,this.layer.buildLayerModel({moduleName:"mask",vertexShader:QM,fragmentShader:KM,triangulation:G0,depth:{enable:!1},pick:!1});case 3:return s=f.sent,f.abrupt("return",[s]);case 5:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"clearModels",value:function(){var i=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;i&&this.layerService.clear()}},{key:"registerBuiltinAttributes",value:function(){return""}}]),t}(Na),eI={fill:JM},tI=eI;function rI(e){var r=nI();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function nI(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var nx=function(e){(0,Le.Z)(t,e);var r=rI(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"type","MaskLayer"),n}return(0,j.Z)(t,[{key:"buildModels",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return s=this.getModelType(),this.layerModel=new tI[s](this),f.next=4,this.initLayerModels();case 4:case"end":return f.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getModelType",value:function(){return"fill"}}]),t}(Rp),ix,ax,ox,sx,Lg,ux,lx,iI=ui.cloneDeep,aI=(ix=(0,tr.b2)(),ax=(0,tr.f3)(Je.IMapService),ox=(0,tr.f3)(Je.IFontService),ix(sx=(Lg=function(){function e(){(0,Q.Z)(this,e),ki(this,"mapService",ux,this),ki(this,"fontService",lx,this)}return(0,j.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("DataMappingPlugin",(0,Zt.Z)(_e().mark(function s(){return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:t.log(ks.MappingStart,Qo.INIT),i.generateMaping(t,{styleAttributeService:a}),t.log(ks.MappingEnd,Qo.INIT);case 3:case"end":return f.stop()}},s)}))),t.hooks.beforeRenderData.tapPromise("DataMappingPlugin",function(){var s=(0,Zt.Z)(_e().mark(function l(f){var d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(f){b.next=2;break}return b.abrupt("return",f);case 2:return t.dataState.dataMappingNeedUpdate=!1,t.log(ks.MappingStart,Qo.UPDATE),d=i.generateMaping(t,{styleAttributeService:a}),t.log(ks.MappingEnd,Qo.UPDATE),b.abrupt("return",d);case 7:case"end":return b.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),t.hooks.beforeRender.tap("DataMappingPlugin",function(){var s=t.getSource();if(!(t.layerModelNeedUpdate||!s||!s.inited)){var l=a.getLayerStyleAttributes()||[],f=a.getLayerStyleAttribute("filter"),d=s.data.dataArray;if(!(Array.isArray(d)&&d.length===0)){var y=l.filter(function(M){return M.needRemapping}),b=d;if(f!=null&&f.needRemapping&&f!==null&&f!==void 0&&f.scale&&(b=d.filter(function(M){return i.applyAttributeMapping(f,M)[0]})),y.length){var T=i.mapping(t,y,b,t.getEncodedData());t.setEncodedData(T)}}}})}},{key:"generateMaping",value:function(t,n){var i=this,a=n.styleAttributeService,s=a.getLayerStyleAttributes()||[],l=a.getLayerStyleAttribute("filter"),f=t.getSource().data.dataArray,d=f;l!=null&&l.scale&&(d=f.filter(function(b){return i.applyAttributeMapping(l,b)[0]})),d=t.processData(d);var y=this.mapping(t,s,d,void 0);return t.setEncodedData(y),t.emit("dataUpdate",null),!0}},{key:"mapping",value:function(t,n,i,a){var s=this,l=n.filter(function(d){return d.scale!==void 0}).filter(function(d){return d.name!=="filter"}),f=i.map(function(d,y){var b=a?a[y]:{},T=(0,W.Z)({id:d._id,coordinates:d.coordinates},b);return l.forEach(function(M){var P=s.applyAttributeMapping(M,d);(M.name==="color"||M.name==="stroke")&&(P=P.map(function(k){return vi(k)})),T[M.name]=Array.isArray(P)&&P.length===1?P[0]:P,M.name==="shape"&&(T.shape=s.fontService.getIconFontKey(T[M.name]))}),T});return n.forEach(function(d){d.needRemapping=!1}),this.adjustData2Amap2Coordinates(f,t),this.adjustData2SimpleCoordinates(f),f}},{key:"adjustData2Amap2Coordinates",value:function(t,n){var i=this;if(t.length>0&&this.mapService.version==="GAODE2.x"){var a=n.coordCenter||n.getSource().center;t.filter(function(s){return!s.originCoordinates}).map(function(s){s.version="GAODE2.x",s.originCoordinates=iI(s.coordinates),s.coordinates=i.mapService.coordToAMap2RelativeCoordinates(s.coordinates,a)})}}},{key:"adjustData2SimpleCoordinates",value:function(t){var n=this;t.length>0&&this.mapService.version==="SIMPLE"&&t.map(function(i){i.simpleCoordinate||(i.coordinates=n.unProjectCoordinates(i.coordinates),i.simpleCoordinate=!0)})}},{key:"unProjectCoordinates",value:function(t){var n=this;if(typeof t[0]=="number")return this.mapService.simpleMapCoord.unproject(t);if(t[0]&&t[0][0]instanceof Array){var i=[];return t.map(function(s){var l=[];s.map(function(f){l.push(n.mapService.simpleMapCoord.unproject(f))}),i.push(l)}),i}else{var a=[];return t.map(function(s){a.push(n.mapService.simpleMapCoord.unproject(s))}),a}}},{key:"applyAttributeMapping",value:function(t,n){var i;if(!t.scale)return[];var a=(t==null||(i=t.scale)===null||i===void 0?void 0:i.scalers)||[],s=[];a.forEach(function(f){var d,y=f.field;(n.hasOwnProperty(y)||((d=t.scale)===null||d===void 0?void 0:d.type)==="variable")&&s.push(n[y])});var l=t.mapping?t.mapping(s):[];return l}},{key:"getArrowPoints",value:function(t,n){var i=[n[0]-t[0],n[1]-t[1]],a=Vu(i),s=[t[0]+a[0]*1e-4,t[1]+a[1]*1e-4];return s}}]),e}(),ux=Pi(Lg.prototype,"mapService",[ax],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lx=Pi(Lg.prototype,"fontService",[ox],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Lg))||sx),cx,fx,oI=(cx=(0,tr.b2)(),cx(fx=function(){function e(){(0,Q.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t){var n=this;this.mapService=t.getContainer().get(Je.IMapService),t.hooks.init.tapPromise("DataSourcePlugin",(0,Zt.Z)(_e().mark(function i(){var a,s,l,f;return _e().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:if(t.log(ks.SourceInitStart,Qo.INIT),a=t.getSource(),a||(s=t.sourceOption||t.defaultSourceConfig,l=s.data,f=s.options,a=new $y(l,f),t.setSource(a)),!a.inited){y.next=8;break}n.updateClusterData(t),t.log(ks.SourceInitEnd,Qo.INIT),y.next=10;break;case 8:return y.next=10,new Promise(function(b){a.on("update",function(T){T.type==="inited"&&(n.updateClusterData(t),t.log(ks.SourceInitEnd,Qo.INIT)),b(null)})});case 10:case"end":return y.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("DataSourcePlugin",(0,Zt.Z)(_e().mark(function i(){var a,s,l;return _e().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return a=n.updateClusterData(t),s=t.dataState.dataSourceNeedUpdate,t.dataState.dataSourceNeedUpdate=!1,l=a||s,d.abrupt("return",l);case 5:case"end":return d.stop()}},i)})))}},{key:"updateClusterData",value:function(t){if(t.isTileLayer||t.tileLayer||!t.getSource())return!1;var n=t.getSource(),i=n.cluster,a=n.clusterOptions.zoom,s=a===void 0?0:a,l=this.mapService.getZoom()-1,f=t.dataState.dataSourceNeedUpdate;return i&&f&&n.updateClusterData(Math.floor(l)),i&&Math.abs(t.clusterZoom-l)>=1?(s!==Math.floor(l)&&n.updateClusterData(Math.floor(l)),t.clusterZoom=l,!0):!1}}]),e}())||fx);function K0(e,r){return e<r?-1:e>r?1:e>=r?0:NaN}function hx(e){return e.length===1&&(e=sI(e)),{left:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)<0?n=a+1:i=a}return n},right:function(r,t,n,i){for(n==null&&(n=0),i==null&&(i=r.length);n<i;){var a=n+i>>>1;e(r[a],t)>0?i=a:n=a+1}return n}}}function sI(e){return function(r,t){return K0(e(r),t)}}var px=hx(K0),uI=px.right,mF=px.left,Bg=uI;function dx(e,r){var t=e.length,n=-1,i,a,s;if(r==null){for(;++n<t;)if((i=e[n])!=null&&i>=i)for(a=s=i;++n<t;)(i=e[n])!=null&&(a>i&&(a=i),s<i&&(s=i))}else for(;++n<t;)if((i=r(e[n],n,e))!=null&&i>=i)for(a=s=i;++n<t;)(i=r(e[n],n,e))!=null&&(a>i&&(a=i),s<i&&(s=i));return[a,s]}var vx=Array.prototype,gF=vx.slice,_F=vx.map,Q0=Math.sqrt(50),J0=Math.sqrt(10),e_=Math.sqrt(2);function mx(e,r,t){var n,i=-1,a,s,l;if(r=+r,e=+e,t=+t,e===r&&t>0)return[e];if((n=r<e)&&(a=e,e=r,r=a),(l=Fg(e,r,t))===0||!isFinite(l))return[];if(l>0)for(e=Math.ceil(e/l),r=Math.floor(r/l),s=new Array(a=Math.ceil(r-e+1));++i<a;)s[i]=(e+i)*l;else for(e=Math.floor(e*l),r=Math.ceil(r*l),s=new Array(a=Math.ceil(e-r+1));++i<a;)s[i]=(e-i)/l;return n&&s.reverse(),s}function Fg(e,r,t){var n=(r-e)/Math.max(0,t),i=Math.floor(Math.log(n)/Math.LN10),a=n/Math.pow(10,i);return i>=0?(a>=Q0?10:a>=J0?5:a>=e_?2:1)*Math.pow(10,i):-Math.pow(10,-i)/(a>=Q0?10:a>=J0?5:a>=e_?2:1)}function t_(e,r,t){var n=Math.abs(r-e)/Math.max(0,t),i=Math.pow(10,Math.floor(Math.log(n)/Math.LN10)),a=n/i;return a>=Q0?i*=10:a>=J0?i*=5:a>=e_&&(i*=2),r<e?-i:i}function yF(){var e=identity,r=extent,t=sturges;function n(i){var a,s=i.length,l,f=new Array(s);for(a=0;a<s;++a)f[a]=e(i[a],a,i);var d=r(f),y=d[0],b=d[1],T=t(f,y,b);Array.isArray(T)||(T=tickStep(y,b,T),T=range(Math.ceil(y/T)*T,b,T));for(var M=T.length;T[0]<=y;)T.shift(),--M;for(;T[M-1]>b;)T.pop(),--M;var P=new Array(M+1),k;for(a=0;a<=M;++a)k=P[a]=[],k.x0=a>0?T[a-1]:y,k.x1=a<M?T[a]:b;for(a=0;a<s;++a)l=f[a],y<=l&&l<=b&&P[bisect(T,l,0,M)].push(i[a]);return P}return n.value=function(i){return arguments.length?(e=typeof i=="function"?i:constant(i),n):e},n.domain=function(i){return arguments.length?(r=typeof i=="function"?i:constant([i[0],i[1]]),n):r},n.thresholds=function(i){return arguments.length?(t=typeof i=="function"?i:Array.isArray(i)?constant(slice.call(i)):constant(i),n):t},n}function xF(e,r,t){return e=map.call(e,number).sort(ascending),Math.ceil((t-r)/(2*(quantile(e,.75)-quantile(e,.25))*Math.pow(e.length,-1/3)))}function lI(e){return e===null?NaN:+e}function cI(e,r,t){if(t==null&&(t=lI),!!(n=e.length)){if((r=+r)<=0||n<2)return+t(e[0],0,e);if(r>=1)return+t(e[n-1],n-1,e);var n,i=(n-1)*r,a=Math.floor(i),s=+t(e[a],a,e),l=+t(e[a+1],a+1,e);return s+(l-s)*(i-a)}}function gx(e,r,t,n,i){var a=e*e,s=a*e;return((1-3*e+3*a-s)*r+(4-6*a+3*s)*t+(1+3*e+3*a-3*s)*n+s*i)/6}function fI(e){var r=e.length-1;return function(t){var n=t<=0?t=0:t>=1?(t=1,r-1):Math.floor(t*r),i=e[n],a=e[n+1],s=n>0?e[n-1]:2*i-a,l=n<r-1?e[n+2]:2*a-i;return gx((t-n/r)*r,s,i,a,l)}}function hI(e){var r=e.length;return function(t){var n=Math.floor(((t%=1)<0?++t:t)*r),i=e[(n+r-1)%r],a=e[n%r],s=e[(n+1)%r],l=e[(n+2)%r];return gx((t-n/r)*r,i,a,s,l)}}function r_(e){return function(){return e}}function _x(e,r){return function(t){return e+t*r}}function pI(e,r,t){return e=Math.pow(e,t),r=Math.pow(r,t)-e,t=1/t,function(n){return Math.pow(e+n*r,t)}}function bF(e,r){var t=r-e;return t?_x(e,t>180||t<-180?t-360*Math.round(t/360):t):constant(isNaN(e)?r:e)}function dI(e){return(e=+e)==1?yx:function(r,t){return t-r?pI(r,t,e):r_(isNaN(r)?t:r)}}function yx(e,r){var t=r-e;return t?_x(e,t):r_(isNaN(e)?r:e)}var xx=function e(r){var t=dI(r);function n(i,a){var s=t((i=(0,ds.B8)(i)).r,(a=(0,ds.B8)(a)).r),l=t(i.g,a.g),f=t(i.b,a.b),d=yx(i.opacity,a.opacity);return function(y){return i.r=s(y),i.g=l(y),i.b=f(y),i.opacity=d(y),i+""}}return n.gamma=e,n}(1);function bx(e){return function(r){var t=r.length,n=new Array(t),i=new Array(t),a=new Array(t),s,l;for(s=0;s<t;++s)l=(0,ds.B8)(r[s]),n[s]=l.r||0,i[s]=l.g||0,a[s]=l.b||0;return n=e(n),i=e(i),a=e(a),l.opacity=1,function(f){return l.r=n(f),l.g=i(f),l.b=a(f),l+""}}}var vI=bx(fI),EF=bx(hI),Gc="$";function Ng(){}Ng.prototype=Ex.prototype={constructor:Ng,has:function(e){return Gc+e in this},get:function(e){return this[Gc+e]},set:function(e,r){return this[Gc+e]=r,this},remove:function(e){var r=Gc+e;return r in this&&delete this[r]},clear:function(){for(var e in this)e[0]===Gc&&delete this[e]},keys:function(){var e=[];for(var r in this)r[0]===Gc&&e.push(r.slice(1));return e},values:function(){var e=[];for(var r in this)r[0]===Gc&&e.push(this[r]);return e},entries:function(){var e=[];for(var r in this)r[0]===Gc&&e.push({key:r.slice(1),value:this[r]});return e},size:function(){var e=0;for(var r in this)r[0]===Gc&&++e;return e},empty:function(){for(var e in this)if(e[0]===Gc)return!1;return!0},each:function(e){for(var r in this)r[0]===Gc&&e(this[r],r.slice(1),this)}};function Ex(e,r){var t=new Ng;if(e instanceof Ng)e.each(function(l,f){t.set(f,l)});else if(Array.isArray(e)){var n=-1,i=e.length,a;if(r==null)for(;++n<i;)t.set(n,e[n]);else for(;++n<i;)t.set(r(a=e[n],n,e),a)}else if(e)for(var s in e)t.set(s,e[s]);return t}var n_=Ex;function SF(){var e=[],r=[],t,n,i;function a(l,f,d,y){if(f>=e.length)return t!=null&&l.sort(t),n!=null?n(l):l;for(var b=-1,T=l.length,M=e[f++],P,k,H=map(),q,ae=d();++b<T;)(q=H.get(P=M(k=l[b])+""))?q.push(k):H.set(P,[k]);return H.each(function(Se,ze){y(ae,ze,a(Se,f,d,y))}),ae}function s(l,f){if(++f>e.length)return l;var d,y=r[f-1];return n!=null&&f>=e.length?d=l.entries():(d=[],l.each(function(b,T){d.push({key:T,values:s(b,f)})})),y!=null?d.sort(function(b,T){return y(b.key,T.key)}):d}return i={object:function(l){return a(l,0,mI,gI)},map:function(l){return a(l,0,Sx,Ax)},entries:function(l){return s(a(l,0,Sx,Ax),0)},key:function(l){return e.push(l),i},sortKeys:function(l){return r[e.length-1]=l,i},sortValues:function(l){return t=l,i},rollup:function(l){return n=l,i}}}function mI(){return{}}function gI(e,r,t){e[r]=t}function Sx(){return map()}function Ax(e,r,t){e.set(r,t)}function Ug(){}var bd=n_.prototype;Ug.prototype=_I.prototype={constructor:Ug,has:bd.has,add:function(e){return e+="",this[Gc+e]=e,this},remove:bd.remove,clear:bd.clear,values:bd.keys,size:bd.size,empty:bd.empty,each:bd.each};function _I(e,r){var t=new Ug;if(e instanceof Ug)e.each(function(a){t.add(a)});else if(e){var n=-1,i=e.length;if(r==null)for(;++n<i;)t.add(e[n]);else for(;++n<i;)t.add(r(e[n],n,e))}return t}var AF=null,Tx=Array.prototype,Cx=Tx.map,Ed=Tx.slice;function Pp(e,r){switch(arguments.length){case 0:break;case 1:this.range(e);break;default:this.range(r).domain(e);break}return this}function Rx(e,r){switch(arguments.length){case 0:break;case 1:this.interpolator(e);break;default:this.interpolator(r).domain(e);break}return this}var Mx={name:"implicit"};function zg(){var e=n_(),r=[],t=[],n=Mx;function i(a){var s=a+"",l=e.get(s);if(!l){if(n!==Mx)return n;e.set(s,l=r.push(a))}return t[(l-1)%t.length]}return i.domain=function(a){if(!arguments.length)return r.slice();r=[],e=n_();for(var s=-1,l=a.length,f,d;++s<l;)e.has(d=(f=a[s])+"")||e.set(d,r.push(f));return i},i.range=function(a){return arguments.length?(t=Ed.call(a),i):t.slice()},i.unknown=function(a){return arguments.length?(n=a,i):n},i.copy=function(){return zg(r,t).unknown(n)},Pp.apply(i,arguments),i}function Ix(){var e=ordinal().unknown(void 0),r=e.domain,t=e.range,n=[0,1],i,a,s=!1,l=0,f=0,d=.5;delete e.unknown;function y(){var b=r().length,T=n[1]<n[0],M=n[T-0],P=n[1-T];i=(P-M)/Math.max(1,b-l+f*2),s&&(i=Math.floor(i)),M+=(P-M-i*(b-l))*d,a=i*(1-l),s&&(M=Math.round(M),a=Math.round(a));var k=sequence(b).map(function(H){return M+i*H});return t(T?k.reverse():k)}return e.domain=function(b){return arguments.length?(r(b),y()):r()},e.range=function(b){return arguments.length?(n=[+b[0],+b[1]],y()):n.slice()},e.rangeRound=function(b){return n=[+b[0],+b[1]],s=!0,y()},e.bandwidth=function(){return a},e.step=function(){return i},e.round=function(b){return arguments.length?(s=!!b,y()):s},e.padding=function(b){return arguments.length?(l=Math.min(1,f=+b),y()):l},e.paddingInner=function(b){return arguments.length?(l=Math.min(1,b),y()):l},e.paddingOuter=function(b){return arguments.length?(f=+b,y()):f},e.align=function(b){return arguments.length?(d=Math.max(0,Math.min(1,b)),y()):d},e.copy=function(){return Ix(r(),n).round(s).paddingInner(l).paddingOuter(f).align(d)},initRange.apply(y(),arguments)}function Px(e){var r=e.copy;return e.padding=e.paddingOuter,delete e.paddingInner,delete e.paddingOuter,e.copy=function(){return Px(r())},e}function TF(){return Px(Ix.apply(null,arguments).paddingInner(1))}function wF(e,r){return(isNumberArray(r)?numberArray:Ox)(e,r)}function Ox(e,r){var t=r?r.length:0,n=e?Math.min(t,e.length):0,i=new Array(n),a=new Array(t),s;for(s=0;s<n;++s)i[s]=o_(e[s],r[s]);for(;s<t;++s)a[s]=r[s];return function(l){for(s=0;s<n;++s)a[s]=i[s](l);return a}}function yI(e,r){var t=new Date;return e=+e,r=+r,function(n){return t.setTime(e*(1-n)+r*n),t}}function Zg(e,r){return e=+e,r=+r,function(t){return e*(1-t)+r*t}}function xI(e,r){var t={},n={},i;(e===null||typeof e!="object")&&(e={}),(r===null||typeof r!="object")&&(r={});for(i in r)i in e?t[i]=o_(e[i],r[i]):n[i]=r[i];return function(a){for(i in t)n[i]=t[i](a);return n}}var i_=/[-+]?(?:\d+\.?\d*|\.?\d+)(?:[eE][-+]?\d+)?/g,a_=new RegExp(i_.source,"g");function bI(e){return function(){return e}}function EI(e){return function(r){return e(r)+""}}function SI(e,r){var t=i_.lastIndex=a_.lastIndex=0,n,i,a,s=-1,l=[],f=[];for(e=e+"",r=r+"";(n=i_.exec(e))&&(i=a_.exec(r));)(a=i.index)>t&&(a=r.slice(t,a),l[s]?l[s]+=a:l[++s]=a),(n=n[0])===(i=i[0])?l[s]?l[s]+=i:l[++s]=i:(l[++s]=null,f.push({i:s,x:Zg(n,i)})),t=a_.lastIndex;return t<r.length&&(a=r.slice(t),l[s]?l[s]+=a:l[++s]=a),l.length<2?f[0]?EI(f[0].x):bI(r):(r=f.length,function(d){for(var y=0,b;y<r;++y)l[(b=f[y]).i]=b.x(d);return l.join("")})}function AI(e,r){r||(r=[]);var t=e?Math.min(r.length,e.length):0,n=r.slice(),i;return function(a){for(i=0;i<t;++i)n[i]=e[i]*(1-a)+r[i]*a;return n}}function TI(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)}function o_(e,r){var t=typeof r,n;return r==null||t==="boolean"?r_(r):(t==="number"?Zg:t==="string"?(n=(0,ds.ZP)(r))?(r=n,xx):SI:r instanceof ds.ZP?xx:r instanceof Date?yI:TI(r)?AI:Array.isArray(r)?Ox:typeof r.valueOf!="function"&&typeof r.toString!="function"||isNaN(r)?xI:Zg)(e,r)}function wI(e,r){return e=+e,r=+r,function(t){return Math.round(e*(1-t)+r*t)}}function CI(e){return function(){return e}}function RI(e){return+e}var kx=[0,1];function Ku(e){return e}function s_(e,r){return(r-=e=+e)?function(t){return(t-e)/r}:CI(isNaN(r)?NaN:.5)}function Dx(e){var r=e[0],t=e[e.length-1],n;return r>t&&(n=r,r=t,t=n),function(i){return Math.max(r,Math.min(t,i))}}function MI(e,r,t){var n=e[0],i=e[1],a=r[0],s=r[1];return i<n?(n=s_(i,n),a=t(s,a)):(n=s_(n,i),a=t(a,s)),function(l){return a(n(l))}}function II(e,r,t){var n=Math.min(e.length,r.length)-1,i=new Array(n),a=new Array(n),s=-1;for(e[n]<e[0]&&(e=e.slice().reverse(),r=r.slice().reverse());++s<n;)i[s]=s_(e[s],e[s+1]),a[s]=t(r[s],r[s+1]);return function(l){var f=Bg(e,l,1,n)-1;return a[f](i[f](l))}}function Vg(e,r){return r.domain(e.domain()).range(e.range()).interpolate(e.interpolate()).clamp(e.clamp()).unknown(e.unknown())}function u_(){var e=kx,r=kx,t=o_,n,i,a,s=Ku,l,f,d;function y(){return l=Math.min(e.length,r.length)>2?II:MI,f=d=null,b}function b(T){return isNaN(T=+T)?a:(f||(f=l(e.map(n),r,t)))(n(s(T)))}return b.invert=function(T){return s(i((d||(d=l(r,e.map(n),Zg)))(T)))},b.domain=function(T){return arguments.length?(e=Cx.call(T,RI),s===Ku||(s=Dx(e)),y()):e.slice()},b.range=function(T){return arguments.length?(r=Ed.call(T),y()):r.slice()},b.rangeRound=function(T){return r=Ed.call(T),t=wI,y()},b.clamp=function(T){return arguments.length?(s=T?Dx(e):Ku,b):s!==Ku},b.interpolate=function(T){return arguments.length?(t=T,y()):t},b.unknown=function(T){return arguments.length?(a=T,b):a},function(T,M){return n=T,i=M,y()}}function Lx(e,r){return u_()(e,r)}var PI=/^(?:(.)?([<>=^]))?([+\-( ])?([$#])?(0)?(\d+)?(,)?(\.\d+)?(~)?([a-z%])?$/i;function jg(e){if(!(r=PI.exec(e)))throw new Error("invalid format: "+e);var r;return new l_({fill:r[1],align:r[2],sign:r[3],symbol:r[4],zero:r[5],width:r[6],comma:r[7],precision:r[8]&&r[8].slice(1),trim:r[9],type:r[10]})}jg.prototype=l_.prototype;function l_(e){this.fill=e.fill===void 0?" ":e.fill+"",this.align=e.align===void 0?">":e.align+"",this.sign=e.sign===void 0?"-":e.sign+"",this.symbol=e.symbol===void 0?"":e.symbol+"",this.zero=!!e.zero,this.width=e.width===void 0?void 0:+e.width,this.comma=!!e.comma,this.precision=e.precision===void 0?void 0:+e.precision,this.trim=!!e.trim,this.type=e.type===void 0?"":e.type+""}l_.prototype.toString=function(){return this.fill+this.align+this.sign+this.symbol+(this.zero?"0":"")+(this.width===void 0?"":Math.max(1,this.width|0))+(this.comma?",":"")+(this.precision===void 0?"":"."+Math.max(0,this.precision|0))+(this.trim?"~":"")+this.type};function OI(e){return Math.abs(e=Math.round(e))>=1e21?e.toLocaleString("en").replace(/,/g,""):e.toString(10)}function Hg(e,r){if((t=(e=r?e.toExponential(r-1):e.toExponential()).indexOf("e"))<0)return null;var t,n=e.slice(0,t);return[n.length>1?n[0]+n.slice(2):n,+e.slice(t+1)]}function mv(e){return e=Hg(Math.abs(e)),e?e[1]:NaN}function kI(e,r){return Math.max(0,Math.max(-8,Math.min(8,Math.floor(mv(r)/3)))*3-mv(Math.abs(e)))}function DI(e,r){return function(t,n){for(var i=t.length,a=[],s=0,l=e[0],f=0;i>0&&l>0&&(f+l+1>n&&(l=Math.max(1,n-f)),a.push(t.substring(i-=l,i+l)),!((f+=l+1)>n));)l=e[s=(s+1)%e.length];return a.reverse().join(r)}}function LI(e){return function(r){return r.replace(/[0-9]/g,function(t){return e[+t]})}}function BI(e){e:for(var r=e.length,t=1,n=-1,i;t<r;++t)switch(e[t]){case".":n=i=t;break;case"0":n===0&&(n=t),i=t;break;default:if(!+e[t])break e;n>0&&(n=0);break}return n>0?e.slice(0,n)+e.slice(i+1):e}var Bx;function FI(e,r){var t=Hg(e,r);if(!t)return e+"";var n=t[0],i=t[1],a=i-(Bx=Math.max(-8,Math.min(8,Math.floor(i/3)))*3)+1,s=n.length;return a===s?n:a>s?n+new Array(a-s+1).join("0"):a>0?n.slice(0,a)+"."+n.slice(a):"0."+new Array(1-a).join("0")+Hg(e,Math.max(0,r+a-1))[0]}function Fx(e,r){var t=Hg(e,r);if(!t)return e+"";var n=t[0],i=t[1];return i<0?"0."+new Array(-i).join("0")+n:n.length>i+1?n.slice(0,i+1)+"."+n.slice(i+1):n+new Array(i-n.length+2).join("0")}var Nx={"%":function(e,r){return(e*100).toFixed(r)},b:function(e){return Math.round(e).toString(2)},c:function(e){return e+""},d:OI,e:function(e,r){return e.toExponential(r)},f:function(e,r){return e.toFixed(r)},g:function(e,r){return e.toPrecision(r)},o:function(e){return Math.round(e).toString(8)},p:function(e,r){return Fx(e*100,r)},r:Fx,s:FI,X:function(e){return Math.round(e).toString(16).toUpperCase()},x:function(e){return Math.round(e).toString(16)}};function Ux(e){return e}var zx=Array.prototype.map,Zx=["y","z","a","f","p","n","\xB5","m","","k","M","G","T","P","E","Z","Y"];function NI(e){var r=e.grouping===void 0||e.thousands===void 0?Ux:DI(zx.call(e.grouping,Number),e.thousands+""),t=e.currency===void 0?"":e.currency[0]+"",n=e.currency===void 0?"":e.currency[1]+"",i=e.decimal===void 0?".":e.decimal+"",a=e.numerals===void 0?Ux:LI(zx.call(e.numerals,String)),s=e.percent===void 0?"%":e.percent+"",l=e.minus===void 0?"-":e.minus+"",f=e.nan===void 0?"NaN":e.nan+"";function d(b){b=jg(b);var T=b.fill,M=b.align,P=b.sign,k=b.symbol,H=b.zero,q=b.width,ae=b.comma,Se=b.precision,ze=b.trim,it=b.type;it==="n"?(ae=!0,it="g"):Nx[it]||(Se===void 0&&(Se=12),ze=!0,it="g"),(H||T==="0"&&M==="=")&&(H=!0,T="0",M="=");var ut=k==="$"?t:k==="#"&&/[boxX]/.test(it)?"0"+it.toLowerCase():"",ot=k==="$"?n:/[%p]/.test(it)?s:"",Ct=Nx[it],Xt=/[defgprs%]/.test(it);Se=Se===void 0?6:/[gprs]/.test(it)?Math.max(1,Math.min(21,Se)):Math.max(0,Math.min(20,Se));function Sr(_r){var Wr=ut,Cn=ot,wi,ua,co;if(it==="c")Cn=Ct(_r)+Cn,_r="";else{_r=+_r;var Xo=_r<0||1/_r<0;if(_r=isNaN(_r)?f:Ct(Math.abs(_r),Se),ze&&(_r=BI(_r)),Xo&&+_r==0&&P!=="+"&&(Xo=!1),Wr=(Xo?P==="("?P:l:P==="-"||P==="("?"":P)+Wr,Cn=(it==="s"?Zx[8+Bx/3]:"")+Cn+(Xo&&P==="("?")":""),Xt){for(wi=-1,ua=_r.length;++wi<ua;)if(co=_r.charCodeAt(wi),48>co||co>57){Cn=(co===46?i+_r.slice(wi+1):_r.slice(wi))+Cn,_r=_r.slice(0,wi);break}}}ae&&!H&&(_r=r(_r,1/0));var No=Wr.length+_r.length+Cn.length,Ys=No<q?new Array(q-No+1).join(T):"";switch(ae&&H&&(_r=r(Ys+_r,Ys.length?q-Cn.length:1/0),Ys=""),M){case"<":_r=Wr+_r+Cn+Ys;break;case"=":_r=Wr+Ys+_r+Cn;break;case"^":_r=Ys.slice(0,No=Ys.length>>1)+Wr+_r+Cn+Ys.slice(No);break;default:_r=Ys+Wr+_r+Cn;break}return a(_r)}return Sr.toString=function(){return b+""},Sr}function y(b,T){var M=d((b=jg(b),b.type="f",b)),P=Math.max(-8,Math.min(8,Math.floor(mv(T)/3)))*3,k=Math.pow(10,-P),H=Zx[8+P/3];return function(q){return M(k*q)+H}}return{format:d,formatPrefix:y}}var Wg,c_,Vx;UI({decimal:".",thousands:",",grouping:[3],currency:["$",""],minus:"-"});function UI(e){return Wg=NI(e),c_=Wg.format,Vx=Wg.formatPrefix,Wg}function zI(e,r){return e=Math.abs(e),r=Math.abs(r)-e,Math.max(0,mv(r)-mv(e))+1}function ZI(e){return Math.max(0,-mv(Math.abs(e)))}function VI(e,r,t,n){var i=t_(e,r,t),a;switch(n=jg(n==null?",f":n),n.type){case"s":{var s=Math.max(Math.abs(e),Math.abs(r));return n.precision==null&&!isNaN(a=kI(i,s))&&(n.precision=a),Vx(n,s)}case"":case"e":case"g":case"p":case"r":{n.precision==null&&!isNaN(a=zI(i,Math.max(Math.abs(e),Math.abs(r))))&&(n.precision=a-(n.type==="e"));break}case"f":case"%":{n.precision==null&&!isNaN(a=ZI(i))&&(n.precision=a-(n.type==="%")*2);break}}return c_(n)}function Em(e){var r=e.domain;return e.ticks=function(t){var n=r();return mx(n[0],n[n.length-1],t==null?10:t)},e.tickFormat=function(t,n){var i=r();return VI(i[0],i[i.length-1],t==null?10:t,n)},e.nice=function(t){t==null&&(t=10);var n=r(),i=0,a=n.length-1,s=n[i],l=n[a],f;return l<s&&(f=s,s=l,l=f,f=i,i=a,a=f),f=Fg(s,l,t),f>0?(s=Math.floor(s/f)*f,l=Math.ceil(l/f)*f,f=Fg(s,l,t)):f<0&&(s=Math.ceil(s*f)/f,l=Math.floor(l*f)/f,f=Fg(s,l,t)),f>0?(n[i]=Math.floor(s/f)*f,n[a]=Math.ceil(l/f)*f,r(n)):f<0&&(n[i]=Math.ceil(s*f)/f,n[a]=Math.floor(l*f)/f,r(n)),e},e}function jx(){var e=Lx(Ku,Ku);return e.copy=function(){return Vg(e,jx())},Pp.apply(e,arguments),Em(e)}function jI(e){var r;function t(n){return isNaN(n=+n)?r:n}return t.invert=t,t.domain=t.range=function(n){return arguments.length?(e=map.call(n,number),t):e.slice()},t.unknown=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return jI(e).unknown(r)},e=arguments.length?map.call(e,number):[0,1],linearish(t)}function Hx(e,r){e=e.slice();var t=0,n=e.length-1,i=e[t],a=e[n],s;return a<i&&(s=t,t=n,n=s,s=i,i=a,a=s),e[t]=r.floor(i),e[n]=r.ceil(a),e}function Wx(e){return Math.log(e)}function Gx(e){return Math.exp(e)}function HI(e){return-Math.log(-e)}function WI(e){return-Math.exp(-e)}function GI(e){return isFinite(e)?+("1e"+e):e<0?0:e}function XI(e){return e===10?GI:e===Math.E?Math.exp:function(r){return Math.pow(e,r)}}function $I(e){return e===Math.E?Math.log:e===10&&Math.log10||e===2&&Math.log2||(e=Math.log(e),function(r){return Math.log(r)/e})}function Xx(e){return function(r){return-e(-r)}}function YI(e){var r=e(Wx,Gx),t=r.domain,n=10,i,a;function s(){return i=$I(n),a=XI(n),t()[0]<0?(i=Xx(i),a=Xx(a),e(HI,WI)):e(Wx,Gx),r}return r.base=function(l){return arguments.length?(n=+l,s()):n},r.domain=function(l){return arguments.length?(t(l),s()):t()},r.ticks=function(l){var f=t(),d=f[0],y=f[f.length-1],b;(b=y<d)&&(T=d,d=y,y=T);var T=i(d),M=i(y),P,k,H,q=l==null?10:+l,ae=[];if(!(n%1)&&M-T<q){if(T=Math.round(T)-1,M=Math.round(M)+1,d>0){for(;T<M;++T)for(k=1,P=a(T);k<n;++k)if(H=P*k,!(H<d)){if(H>y)break;ae.push(H)}}else for(;T<M;++T)for(k=n-1,P=a(T);k>=1;--k)if(H=P*k,!(H<d)){if(H>y)break;ae.push(H)}}else ae=mx(T,M,Math.min(M-T,q)).map(a);return b?ae.reverse():ae},r.tickFormat=function(l,f){if(f==null&&(f=n===10?".0e":","),typeof f!="function"&&(f=c_(f)),l===1/0)return f;l==null&&(l=10);var d=Math.max(1,n*l/r.ticks().length);return function(y){var b=y/a(Math.round(i(y)));return b*n<n-.5&&(b*=n),b<=d?f(y):""}},r.nice=function(){return t(Hx(t(),{floor:function(l){return a(Math.floor(i(l)))},ceil:function(l){return a(Math.ceil(i(l)))}}))},r}function $x(){var e=YI(u_()).domain([1,10]);return e.copy=function(){return Vg(e,$x()).base(e.base())},Pp.apply(e,arguments),e}function Yx(e){return function(r){return Math.sign(r)*Math.log1p(Math.abs(r/e))}}function qx(e){return function(r){return Math.sign(r)*Math.expm1(Math.abs(r))*e}}function qI(e){var r=1,t=e(Yx(r),qx(r));return t.constant=function(n){return arguments.length?e(Yx(r=+n),qx(r)):r},linearish(t)}function KI(){var e=qI(transformer());return e.copy=function(){return copy(e,KI()).constant(e.constant())},initRange.apply(e,arguments)}function Kx(e){return function(r){return r<0?-Math.pow(-r,e):Math.pow(r,e)}}function QI(e){return e<0?-Math.sqrt(-e):Math.sqrt(e)}function JI(e){return e<0?-e*e:e*e}function eP(e){var r=e(Ku,Ku),t=1;function n(){return t===1?e(Ku,Ku):t===.5?e(QI,JI):e(Kx(t),Kx(1/t))}return r.exponent=function(i){return arguments.length?(t=+i,n()):t},Em(r)}function f_(){var e=eP(u_());return e.copy=function(){return Vg(e,f_()).exponent(e.exponent())},Pp.apply(e,arguments),e}function CF(){return f_.apply(null,arguments).exponent(.5)}function Qx(){var e=[],r=[],t=[],n;function i(){var s=0,l=Math.max(1,r.length);for(t=new Array(l-1);++s<l;)t[s-1]=cI(e,s/l);return a}function a(s){return isNaN(s=+s)?n:r[Bg(t,s)]}return a.invertExtent=function(s){var l=r.indexOf(s);return l<0?[NaN,NaN]:[l>0?t[l-1]:e[0],l<t.length?t[l]:e[e.length-1]]},a.domain=function(s){if(!arguments.length)return e.slice();e=[];for(var l=0,f=s.length,d;l<f;++l)d=s[l],d!=null&&!isNaN(d=+d)&&e.push(d);return e.sort(K0),i()},a.range=function(s){return arguments.length?(r=Ed.call(s),i()):r.slice()},a.unknown=function(s){return arguments.length?(n=s,a):n},a.quantiles=function(){return t.slice()},a.copy=function(){return Qx().domain(e).range(r).unknown(n)},Pp.apply(a,arguments)}function Jx(){var e=0,r=1,t=1,n=[.5],i=[0,1],a;function s(f){return f<=f?i[Bg(n,f,0,t)]:a}function l(){var f=-1;for(n=new Array(t);++f<t;)n[f]=((f+1)*r-(f-t)*e)/(t+1);return s}return s.domain=function(f){return arguments.length?(e=+f[0],r=+f[1],l()):[e,r]},s.range=function(f){return arguments.length?(t=(i=Ed.call(f)).length-1,l()):i.slice()},s.invertExtent=function(f){var d=i.indexOf(f);return d<0?[NaN,NaN]:d<1?[e,n[0]]:d>=t?[n[t-1],r]:[n[d-1],n[d]]},s.unknown=function(f){return arguments.length&&(a=f),s},s.thresholds=function(){return n.slice()},s.copy=function(){return Jx().domain([e,r]).range(i).unknown(a)},Pp.apply(Em(s),arguments)}function eb(){var e=[.5],r=[0,1],t,n=1;function i(a){return a<=a?r[Bg(e,a,0,n)]:t}return i.domain=function(a){return arguments.length?(e=Ed.call(a),n=Math.min(e.length,r.length-1),i):e.slice()},i.range=function(a){return arguments.length?(r=Ed.call(a),n=Math.min(e.length,r.length-1),i):r.slice()},i.invertExtent=function(a){var s=r.indexOf(a);return[e[s-1],e[s]]},i.unknown=function(a){return arguments.length?(t=a,i):t},i.copy=function(){return eb().domain(e).range(r).unknown(t)},Pp.apply(i,arguments)}var h_=new Date,p_=new Date;function _l(e,r,t,n){function i(a){return e(a=arguments.length===0?new Date:new Date(+a)),a}return i.floor=function(a){return e(a=new Date(+a)),a},i.ceil=function(a){return e(a=new Date(a-1)),r(a,1),e(a),a},i.round=function(a){var s=i(a),l=i.ceil(a);return a-s<l-a?s:l},i.offset=function(a,s){return r(a=new Date(+a),s==null?1:Math.floor(s)),a},i.range=function(a,s,l){var f=[],d;if(a=i.ceil(a),l=l==null?1:Math.floor(l),!(a<s)||!(l>0))return f;do f.push(d=new Date(+a)),r(a,l),e(a);while(d<a&&a<s);return f},i.filter=function(a){return _l(function(s){if(s>=s)for(;e(s),!a(s);)s.setTime(s-1)},function(s,l){if(s>=s)if(l<0)for(;++l<=0;)for(;r(s,-1),!a(s););else for(;--l>=0;)for(;r(s,1),!a(s););})},t&&(i.count=function(a,s){return h_.setTime(+a),p_.setTime(+s),e(h_),e(p_),Math.floor(t(h_,p_))},i.every=function(a){return a=Math.floor(a),!isFinite(a)||!(a>0)?null:a>1?i.filter(n?function(s){return n(s)%a===0}:function(s){return i.count(0,s)%a===0}):i}),i}var d_=_l(function(e){e.setMonth(0,1),e.setHours(0,0,0,0)},function(e,r){e.setFullYear(e.getFullYear()+r)},function(e,r){return r.getFullYear()-e.getFullYear()},function(e){return e.getFullYear()});d_.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:_l(function(r){r.setFullYear(Math.floor(r.getFullYear()/e)*e),r.setMonth(0,1),r.setHours(0,0,0,0)},function(r,t){r.setFullYear(r.getFullYear()+t*e)})};var gv=d_,RF=d_.range,tb=_l(function(e){e.setDate(1),e.setHours(0,0,0,0)},function(e,r){e.setMonth(e.getMonth()+r)},function(e,r){return r.getMonth()-e.getMonth()+(r.getFullYear()-e.getFullYear())*12},function(e){return e.getMonth()}),tP=tb,MF=tb.range,Gg=1e3,Sm=6e4,rb=36e5,nb=864e5,ib=6048e5;function Sd(e){return _l(function(r){r.setDate(r.getDate()-(r.getDay()+7-e)%7),r.setHours(0,0,0,0)},function(r,t){r.setDate(r.getDate()+t*7)},function(r,t){return(t-r-(t.getTimezoneOffset()-r.getTimezoneOffset())*Sm)/ib})}var v_=Sd(0),Xg=Sd(1),rP=Sd(2),nP=Sd(3),_v=Sd(4),iP=Sd(5),aP=Sd(6),IF=v_.range,PF=Xg.range,OF=rP.range,kF=nP.range,DF=_v.range,LF=iP.range,BF=aP.range,ab=_l(function(e){e.setHours(0,0,0,0)},function(e,r){e.setDate(e.getDate()+r)},function(e,r){return(r-e-(r.getTimezoneOffset()-e.getTimezoneOffset())*Sm)/nb},function(e){return e.getDate()-1}),m_=ab,FF=ab.range,ob=_l(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Gg-e.getMinutes()*Sm)},function(e,r){e.setTime(+e+r*rb)},function(e,r){return(r-e)/rb},function(e){return e.getHours()}),oP=ob,NF=ob.range,sb=_l(function(e){e.setTime(e-e.getMilliseconds()-e.getSeconds()*Gg)},function(e,r){e.setTime(+e+r*Sm)},function(e,r){return(r-e)/Sm},function(e){return e.getMinutes()}),sP=sb,UF=sb.range,ub=_l(function(e){e.setTime(e-e.getMilliseconds())},function(e,r){e.setTime(+e+r*Gg)},function(e,r){return(r-e)/Gg},function(e){return e.getUTCSeconds()}),uP=ub,zF=ub.range,$g=_l(function(){},function(e,r){e.setTime(+e+r)},function(e,r){return r-e});$g.every=function(e){return e=Math.floor(e),!isFinite(e)||!(e>0)?null:e>1?_l(function(r){r.setTime(Math.floor(r/e)*e)},function(r,t){r.setTime(+r+t*e)},function(r,t){return(t-r)/e}):$g};var lP=$g,ZF=$g.range;function Ad(e){return _l(function(r){r.setUTCDate(r.getUTCDate()-(r.getUTCDay()+7-e)%7),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCDate(r.getUTCDate()+t*7)},function(r,t){return(t-r)/ib})}var lb=Ad(0),Yg=Ad(1),cP=Ad(2),fP=Ad(3),yv=Ad(4),hP=Ad(5),pP=Ad(6),VF=lb.range,jF=Yg.range,HF=cP.range,WF=fP.range,GF=yv.range,XF=hP.range,$F=pP.range,cb=_l(function(e){e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCDate(e.getUTCDate()+r)},function(e,r){return(r-e)/nb},function(e){return e.getUTCDate()-1}),fb=cb,YF=cb.range,g_=_l(function(e){e.setUTCMonth(0,1),e.setUTCHours(0,0,0,0)},function(e,r){e.setUTCFullYear(e.getUTCFullYear()+r)},function(e,r){return r.getUTCFullYear()-e.getUTCFullYear()},function(e){return e.getUTCFullYear()});g_.every=function(e){return!isFinite(e=Math.floor(e))||!(e>0)?null:_l(function(r){r.setUTCFullYear(Math.floor(r.getUTCFullYear()/e)*e),r.setUTCMonth(0,1),r.setUTCHours(0,0,0,0)},function(r,t){r.setUTCFullYear(r.getUTCFullYear()+t*e)})};var Am=g_,qF=g_.range;function __(e){if(0<=e.y&&e.y<100){var r=new Date(-1,e.m,e.d,e.H,e.M,e.S,e.L);return r.setFullYear(e.y),r}return new Date(e.y,e.m,e.d,e.H,e.M,e.S,e.L)}function y_(e){if(0<=e.y&&e.y<100){var r=new Date(Date.UTC(-1,e.m,e.d,e.H,e.M,e.S,e.L));return r.setUTCFullYear(e.y),r}return new Date(Date.UTC(e.y,e.m,e.d,e.H,e.M,e.S,e.L))}function Tm(e,r,t){return{y:e,m:r,d:t,H:0,M:0,S:0,L:0}}function dP(e){var r=e.dateTime,t=e.date,n=e.time,i=e.periods,a=e.days,s=e.shortDays,l=e.months,f=e.shortMonths,d=wm(i),y=Cm(i),b=wm(a),T=Cm(a),M=wm(s),P=Cm(s),k=wm(l),H=Cm(l),q=wm(f),ae=Cm(f),Se={a:Xo,A:No,b:Ys,B:bl,c:null,d:gb,e:gb,f:FP,g:XP,G:YP,H:DP,I:LP,j:BP,L:_b,m:NP,M:UP,p:AB,q:TB,Q:Ab,s:Tb,S:zP,u:ZP,U:VP,V:jP,w:HP,W:WP,x:null,X:null,y:GP,Y:$P,Z:qP,"%":Sb},ze={a:wB,A:CB,b:RB,B:MB,c:null,d:xb,e:xb,f:eO,g:cO,G:hO,H:KP,I:QP,j:JP,L:bb,m:tO,M:rO,p:IB,q:PB,Q:Ab,s:Tb,S:nO,u:iO,U:aO,V:oO,w:sO,W:uO,x:null,X:null,y:lO,Y:fO,Z:pO,"%":Sb},it={a:Sr,A:_r,b:Wr,B:Cn,c:wi,d:vb,e:vb,f:IP,g:db,G:pb,H:mb,I:mb,j:wP,L:MP,m:TP,M:CP,p:Xt,q:AP,Q:OP,s:kP,S:RP,u:yP,U:xP,V:bP,w:_P,W:EP,x:ua,X:co,y:db,Y:pb,Z:SP,"%":PP};Se.x=ut(t,Se),Se.X=ut(n,Se),Se.c=ut(r,Se),ze.x=ut(t,ze),ze.X=ut(n,ze),ze.c=ut(r,ze);function ut(oi,_a){return function(za){var _n=[],Wl=-1,Uo=0,mc=oi.length,gc,kd,r2;for(za instanceof Date||(za=new Date(+za));++Wl<mc;)oi.charCodeAt(Wl)===37&&(_n.push(oi.slice(Uo,Wl)),(kd=hb[gc=oi.charAt(++Wl)])!=null?gc=oi.charAt(++Wl):kd=gc==="e"?" ":"0",(r2=_a[gc])&&(gc=r2(za,kd)),_n.push(gc),Uo=Wl+1);return _n.push(oi.slice(Uo,Wl)),_n.join("")}}function ot(oi,_a){return function(za){var _n=Tm(1900,void 0,1),Wl=Ct(_n,oi,za+="",0),Uo,mc;if(Wl!=za.length)return null;if("Q"in _n)return new Date(_n.Q);if("s"in _n)return new Date(_n.s*1e3+("L"in _n?_n.L:0));if(_a&&!("Z"in _n)&&(_n.Z=0),"p"in _n&&(_n.H=_n.H%12+_n.p*12),_n.m===void 0&&(_n.m="q"in _n?_n.q:0),"V"in _n){if(_n.V<1||_n.V>53)return null;"w"in _n||(_n.w=1),"Z"in _n?(Uo=y_(Tm(_n.y,0,1)),mc=Uo.getUTCDay(),Uo=mc>4||mc===0?Yg.ceil(Uo):Yg(Uo),Uo=fb.offset(Uo,(_n.V-1)*7),_n.y=Uo.getUTCFullYear(),_n.m=Uo.getUTCMonth(),_n.d=Uo.getUTCDate()+(_n.w+6)%7):(Uo=__(Tm(_n.y,0,1)),mc=Uo.getDay(),Uo=mc>4||mc===0?Xg.ceil(Uo):Xg(Uo),Uo=m_.offset(Uo,(_n.V-1)*7),_n.y=Uo.getFullYear(),_n.m=Uo.getMonth(),_n.d=Uo.getDate()+(_n.w+6)%7)}else("W"in _n||"U"in _n)&&("w"in _n||(_n.w="u"in _n?_n.u%7:"W"in _n?1:0),mc="Z"in _n?y_(Tm(_n.y,0,1)).getUTCDay():__(Tm(_n.y,0,1)).getDay(),_n.m=0,_n.d="W"in _n?(_n.w+6)%7+_n.W*7-(mc+5)%7:_n.w+_n.U*7-(mc+6)%7);return"Z"in _n?(_n.H+=_n.Z/100|0,_n.M+=_n.Z%100,y_(_n)):__(_n)}}function Ct(oi,_a,za,_n){for(var Wl=0,Uo=_a.length,mc=za.length,gc,kd;Wl<Uo;){if(_n>=mc)return-1;if(gc=_a.charCodeAt(Wl++),gc===37){if(gc=_a.charAt(Wl++),kd=it[gc in hb?_a.charAt(Wl++):gc],!kd||(_n=kd(oi,za,_n))<0)return-1}else if(gc!=za.charCodeAt(_n++))return-1}return _n}function Xt(oi,_a,za){var _n=d.exec(_a.slice(za));return _n?(oi.p=y[_n[0].toLowerCase()],za+_n[0].length):-1}function Sr(oi,_a,za){var _n=M.exec(_a.slice(za));return _n?(oi.w=P[_n[0].toLowerCase()],za+_n[0].length):-1}function _r(oi,_a,za){var _n=b.exec(_a.slice(za));return _n?(oi.w=T[_n[0].toLowerCase()],za+_n[0].length):-1}function Wr(oi,_a,za){var _n=q.exec(_a.slice(za));return _n?(oi.m=ae[_n[0].toLowerCase()],za+_n[0].length):-1}function Cn(oi,_a,za){var _n=k.exec(_a.slice(za));return _n?(oi.m=H[_n[0].toLowerCase()],za+_n[0].length):-1}function wi(oi,_a,za){return Ct(oi,r,_a,za)}function ua(oi,_a,za){return Ct(oi,t,_a,za)}function co(oi,_a,za){return Ct(oi,n,_a,za)}function Xo(oi){return s[oi.getDay()]}function No(oi){return a[oi.getDay()]}function Ys(oi){return f[oi.getMonth()]}function bl(oi){return l[oi.getMonth()]}function AB(oi){return i[+(oi.getHours()>=12)]}function TB(oi){return 1+~~(oi.getMonth()/3)}function wB(oi){return s[oi.getUTCDay()]}function CB(oi){return a[oi.getUTCDay()]}function RB(oi){return f[oi.getUTCMonth()]}function MB(oi){return l[oi.getUTCMonth()]}function IB(oi){return i[+(oi.getUTCHours()>=12)]}function PB(oi){return 1+~~(oi.getUTCMonth()/3)}return{format:function(oi){var _a=ut(oi+="",Se);return _a.toString=function(){return oi},_a},parse:function(oi){var _a=ot(oi+="",!1);return _a.toString=function(){return oi},_a},utcFormat:function(oi){var _a=ut(oi+="",ze);return _a.toString=function(){return oi},_a},utcParse:function(oi){var _a=ot(oi+="",!0);return _a.toString=function(){return oi},_a}}}var hb={"-":"",_:" ",0:"0"},du=/^\s*\d+/,vP=/^%/,mP=/[\\^$*+?|[\]().{}]/g;function Ua(e,r,t){var n=e<0?"-":"",i=(n?-e:e)+"",a=i.length;return n+(a<t?new Array(t-a+1).join(r)+i:i)}function gP(e){return e.replace(mP,"\\$&")}function wm(e){return new RegExp("^(?:"+e.map(gP).join("|")+")","i")}function Cm(e){for(var r={},t=-1,n=e.length;++t<n;)r[e[t].toLowerCase()]=t;return r}function _P(e,r,t){var n=du.exec(r.slice(t,t+1));return n?(e.w=+n[0],t+n[0].length):-1}function yP(e,r,t){var n=du.exec(r.slice(t,t+1));return n?(e.u=+n[0],t+n[0].length):-1}function xP(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.U=+n[0],t+n[0].length):-1}function bP(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.V=+n[0],t+n[0].length):-1}function EP(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.W=+n[0],t+n[0].length):-1}function pb(e,r,t){var n=du.exec(r.slice(t,t+4));return n?(e.y=+n[0],t+n[0].length):-1}function db(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.y=+n[0]+(+n[0]>68?1900:2e3),t+n[0].length):-1}function SP(e,r,t){var n=/^(Z)|([+-]\d\d)(?::?(\d\d))?/.exec(r.slice(t,t+6));return n?(e.Z=n[1]?0:-(n[2]+(n[3]||"00")),t+n[0].length):-1}function AP(e,r,t){var n=du.exec(r.slice(t,t+1));return n?(e.q=n[0]*3-3,t+n[0].length):-1}function TP(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.m=n[0]-1,t+n[0].length):-1}function vb(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.d=+n[0],t+n[0].length):-1}function wP(e,r,t){var n=du.exec(r.slice(t,t+3));return n?(e.m=0,e.d=+n[0],t+n[0].length):-1}function mb(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.H=+n[0],t+n[0].length):-1}function CP(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.M=+n[0],t+n[0].length):-1}function RP(e,r,t){var n=du.exec(r.slice(t,t+2));return n?(e.S=+n[0],t+n[0].length):-1}function MP(e,r,t){var n=du.exec(r.slice(t,t+3));return n?(e.L=+n[0],t+n[0].length):-1}function IP(e,r,t){var n=du.exec(r.slice(t,t+6));return n?(e.L=Math.floor(n[0]/1e3),t+n[0].length):-1}function PP(e,r,t){var n=vP.exec(r.slice(t,t+1));return n?t+n[0].length:-1}function OP(e,r,t){var n=du.exec(r.slice(t));return n?(e.Q=+n[0],t+n[0].length):-1}function kP(e,r,t){var n=du.exec(r.slice(t));return n?(e.s=+n[0],t+n[0].length):-1}function gb(e,r){return Ua(e.getDate(),r,2)}function DP(e,r){return Ua(e.getHours(),r,2)}function LP(e,r){return Ua(e.getHours()%12||12,r,2)}function BP(e,r){return Ua(1+m_.count(gv(e),e),r,3)}function _b(e,r){return Ua(e.getMilliseconds(),r,3)}function FP(e,r){return _b(e,r)+"000"}function NP(e,r){return Ua(e.getMonth()+1,r,2)}function UP(e,r){return Ua(e.getMinutes(),r,2)}function zP(e,r){return Ua(e.getSeconds(),r,2)}function ZP(e){var r=e.getDay();return r===0?7:r}function VP(e,r){return Ua(v_.count(gv(e)-1,e),r,2)}function yb(e){var r=e.getDay();return r>=4||r===0?_v(e):_v.ceil(e)}function jP(e,r){return e=yb(e),Ua(_v.count(gv(e),e)+(gv(e).getDay()===4),r,2)}function HP(e){return e.getDay()}function WP(e,r){return Ua(Xg.count(gv(e)-1,e),r,2)}function GP(e,r){return Ua(e.getFullYear()%100,r,2)}function XP(e,r){return e=yb(e),Ua(e.getFullYear()%100,r,2)}function $P(e,r){return Ua(e.getFullYear()%1e4,r,4)}function YP(e,r){var t=e.getDay();return e=t>=4||t===0?_v(e):_v.ceil(e),Ua(e.getFullYear()%1e4,r,4)}function qP(e){var r=e.getTimezoneOffset();return(r>0?"-":(r*=-1,"+"))+Ua(r/60|0,"0",2)+Ua(r%60,"0",2)}function xb(e,r){return Ua(e.getUTCDate(),r,2)}function KP(e,r){return Ua(e.getUTCHours(),r,2)}function QP(e,r){return Ua(e.getUTCHours()%12||12,r,2)}function JP(e,r){return Ua(1+fb.count(Am(e),e),r,3)}function bb(e,r){return Ua(e.getUTCMilliseconds(),r,3)}function eO(e,r){return bb(e,r)+"000"}function tO(e,r){return Ua(e.getUTCMonth()+1,r,2)}function rO(e,r){return Ua(e.getUTCMinutes(),r,2)}function nO(e,r){return Ua(e.getUTCSeconds(),r,2)}function iO(e){var r=e.getUTCDay();return r===0?7:r}function aO(e,r){return Ua(lb.count(Am(e)-1,e),r,2)}function Eb(e){var r=e.getUTCDay();return r>=4||r===0?yv(e):yv.ceil(e)}function oO(e,r){return e=Eb(e),Ua(yv.count(Am(e),e)+(Am(e).getUTCDay()===4),r,2)}function sO(e){return e.getUTCDay()}function uO(e,r){return Ua(Yg.count(Am(e)-1,e),r,2)}function lO(e,r){return Ua(e.getUTCFullYear()%100,r,2)}function cO(e,r){return e=Eb(e),Ua(e.getUTCFullYear()%100,r,2)}function fO(e,r){return Ua(e.getUTCFullYear()%1e4,r,4)}function hO(e,r){var t=e.getUTCDay();return e=t>=4||t===0?yv(e):yv.ceil(e),Ua(e.getUTCFullYear()%1e4,r,4)}function pO(){return"+0000"}function Sb(){return"%"}function Ab(e){return+e}function Tb(e){return Math.floor(+e/1e3)}var xv,wb,dO,vO,mO;gO({dateTime:"%x, %X",date:"%-m/%-d/%Y",time:"%-I:%M:%S %p",periods:["AM","PM"],days:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],shortDays:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],months:["January","February","March","April","May","June","July","August","September","October","November","December"],shortMonths:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"]});function gO(e){return xv=dP(e),wb=xv.format,dO=xv.parse,vO=xv.utcFormat,mO=xv.utcParse,xv}var Rm=1e3,Mm=Rm*60,Im=Mm*60,Pm=Im*24,_O=Pm*7,Cb=Pm*30,x_=Pm*365;function yO(e){return new Date(e)}function xO(e){return e instanceof Date?+e:+new Date(+e)}function Rb(e,r,t,n,i,a,s,l,f){var d=Lx(Ku,Ku),y=d.invert,b=d.domain,T=f(".%L"),M=f(":%S"),P=f("%I:%M"),k=f("%I %p"),H=f("%a %d"),q=f("%b %d"),ae=f("%B"),Se=f("%Y"),ze=[[s,1,Rm],[s,5,5*Rm],[s,15,15*Rm],[s,30,30*Rm],[a,1,Mm],[a,5,5*Mm],[a,15,15*Mm],[a,30,30*Mm],[i,1,Im],[i,3,3*Im],[i,6,6*Im],[i,12,12*Im],[n,1,Pm],[n,2,2*Pm],[t,1,_O],[r,1,Cb],[r,3,3*Cb],[e,1,x_]];function it(ot){return(s(ot)<ot?T:a(ot)<ot?M:i(ot)<ot?P:n(ot)<ot?k:r(ot)<ot?t(ot)<ot?H:q:e(ot)<ot?ae:Se)(ot)}function ut(ot,Ct,Xt,Sr){if(ot==null&&(ot=10),typeof ot=="number"){var _r=Math.abs(Xt-Ct)/ot,Wr=hx(function(Cn){return Cn[2]}).right(ze,_r);Wr===ze.length?(Sr=t_(Ct/x_,Xt/x_,ot),ot=e):Wr?(Wr=ze[_r/ze[Wr-1][2]<ze[Wr][2]/_r?Wr-1:Wr],Sr=Wr[1],ot=Wr[0]):(Sr=Math.max(t_(Ct,Xt,ot),1),ot=l)}return Sr==null?ot:ot.every(Sr)}return d.invert=function(ot){return new Date(y(ot))},d.domain=function(ot){return arguments.length?b(Cx.call(ot,xO)):b().map(yO)},d.ticks=function(ot,Ct){var Xt=b(),Sr=Xt[0],_r=Xt[Xt.length-1],Wr=_r<Sr,Cn;return Wr&&(Cn=Sr,Sr=_r,_r=Cn),Cn=ut(ot,Sr,_r,Ct),Cn=Cn?Cn.range(Sr,_r+1):[],Wr?Cn.reverse():Cn},d.tickFormat=function(ot,Ct){return Ct==null?it:f(Ct)},d.nice=function(ot,Ct){var Xt=b();return(ot=ut(ot,Xt[0],Xt[Xt.length-1],Ct))?b(Hx(Xt,ot)):d},d.copy=function(){return Vg(d,Rb(e,r,t,n,i,a,s,l,f))},d}function bO(){return Pp.apply(Rb(gv,tP,v_,m_,oP,sP,uP,lP,wb).domain([new Date(2e3,0,1),new Date(2e3,0,2)]),arguments)}function KF(){return initRange.apply(calendar(utcYear,utcMonth,utcWeek,utcDay,utcHour,utcMinute,utcSecond,utcMillisecond,utcFormat).domain([Date.UTC(2e3,0,1),Date.UTC(2e3,0,2)]),arguments)}function qg(){var e=0,r=1,t,n,i,a,s=Ku,l=!1,f;function d(y){return isNaN(y=+y)?f:s(i===0?.5:(y=(a(y)-t)*i,l?Math.max(0,Math.min(1,y)):y))}return d.domain=function(y){return arguments.length?(t=a(e=+y[0]),n=a(r=+y[1]),i=t===n?0:1/(n-t),d):[e,r]},d.clamp=function(y){return arguments.length?(l=!!y,d):l},d.interpolator=function(y){return arguments.length?(s=y,d):s},d.unknown=function(y){return arguments.length?(f=y,d):f},function(y){return a=y,t=y(e),n=y(r),i=t===n?0:1/(n-t),d}}function Om(e,r){return r.domain(e.domain()).interpolator(e.interpolator()).clamp(e.clamp()).unknown(e.unknown())}function Mb(){var e=Em(qg()(Ku));return e.copy=function(){return Om(e,Mb())},Rx.apply(e,arguments)}function EO(){var e=loggish(qg()).domain([1,10]);return e.copy=function(){return Om(e,EO()).base(e.base())},initInterpolator.apply(e,arguments)}function SO(){var e=symlogish(qg());return e.copy=function(){return Om(e,SO()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Ib(){var e=powish(qg());return e.copy=function(){return Om(e,Ib()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function QF(){return Ib.apply(null,arguments).exponent(.5)}function AO(){var e=[],r=identity;function t(n){if(!isNaN(n=+n))return r((bisect(e,n)-1)/(e.length-1))}return t.domain=function(n){if(!arguments.length)return e.slice();e=[];for(var i=0,a=n.length,s;i<a;++i)s=n[i],s!=null&&!isNaN(s=+s)&&e.push(s);return e.sort(ascending),t},t.interpolator=function(n){return arguments.length?(r=n,t):r},t.copy=function(){return AO(r).domain(e)},initInterpolator.apply(t,arguments)}function Kg(){var e=0,r=.5,t=1,n,i,a,s,l,f=Ku,d,y=!1,b;function T(M){return isNaN(M=+M)?b:(M=.5+((M=+d(M))-i)*(M<i?s:l),f(y?Math.max(0,Math.min(1,M)):M))}return T.domain=function(M){return arguments.length?(n=d(e=+M[0]),i=d(r=+M[1]),a=d(t=+M[2]),s=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),T):[e,r,t]},T.clamp=function(M){return arguments.length?(y=!!M,T):y},T.interpolator=function(M){return arguments.length?(f=M,T):f},T.unknown=function(M){return arguments.length?(b=M,T):b},function(M){return d=M,n=M(e),i=M(r),a=M(t),s=n===i?0:.5/(i-n),l=i===a?0:.5/(a-i),T}}function Pb(){var e=Em(Kg()(Ku));return e.copy=function(){return Om(e,Pb())},Rx.apply(e,arguments)}function TO(){var e=loggish(Kg()).domain([.1,1,10]);return e.copy=function(){return copy(e,TO()).base(e.base())},initInterpolator.apply(e,arguments)}function wO(){var e=symlogish(Kg());return e.copy=function(){return copy(e,wO()).constant(e.constant())},initInterpolator.apply(e,arguments)}function Ob(){var e=powish(Kg());return e.copy=function(){return copy(e,Ob()).exponent(e.exponent())},initInterpolator.apply(e,arguments)}function JF(){return Ob.apply(null,arguments).exponent(.5)}function kb(e){var r,t=[];function n(i){return i==null?r:i}return n.invert=n,n.domain=n.range=function(i){return i?(t=i,i):t},n.unknown=function(i){return i?(r=i,i):r},n.copy=function(){return kb(e).unknown(r)},n}var dc,Db,Lb,b_=ui.isNil,CO=ui.isString,RO=ui.uniq,MO=/^(?:(?!0000)[0-9]{4}([-/.]+)(?:(?:0?[1-9]|1[0-2])\1(?:0?[1-9]|1[0-9]|2[0-8])|(?:0?[13-9]|1[0-2])\1(?:29|30)|(?:0?[13578]|1[02])\1(?:31))|(?:[0-9]{2}(?:0[48]|[2468][048]|[13579][26])|(?:0[48]|[2468][048]|[13579][26])00)([-/.]?)0?2\2(?:29))(\s+([01]|([01][0-9]|2[0-3])):([0-9]|[0-5][0-9]):([0-9]|[0-5][0-9]))?$/,IO=(dc={},(0,F.Z)(dc,$a.LINEAR,jx),(0,F.Z)(dc,$a.POWER,f_),(0,F.Z)(dc,$a.LOG,$x),(0,F.Z)(dc,$a.IDENTITY,kb),(0,F.Z)(dc,$a.SEQUENTIAL,Mb),(0,F.Z)(dc,$a.TIME,bO),(0,F.Z)(dc,$a.QUANTILE,Qx),(0,F.Z)(dc,$a.QUANTIZE,Jx),(0,F.Z)(dc,$a.THRESHOLD,eb),(0,F.Z)(dc,$a.CAT,zg),(0,F.Z)(dc,$a.DIVERGING,Pb),dc),PO=(Db=(0,tr.b2)(),Db(Lb=function(){function e(){(0,Q.Z)(this,e),(0,F.Z)(this,"scaleOptions",{})}return(0,j.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("FeatureScalePlugin",(0,Zt.Z)(_e().mark(function s(){var l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:if(t.log(ks.ScaleInitStart,Qo.INIT),i.scaleOptions=t.getScaleOptions(),f=a.getLayerStyleAttributes(),d=(l=t.getSource())===null||l===void 0?void 0:l.data.dataArray,!(Array.isArray(d)&&d.length===0)){b.next=8;break}return b.abrupt("return");case 8:i.caculateScalesForAttributes(f||[],d);case 9:t.log(ks.ScaleInitEnd,Qo.INIT);case 10:case"end":return b.stop()}},s)}))),t.hooks.beforeRenderData.tapPromise("FeatureScalePlugin",function(){var s=(0,Zt.Z)(_e().mark(function l(f){var d,y;return _e().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(f){T.next=2;break}return T.abrupt("return",f);case 2:if(t.log(ks.ScaleInitStart,Qo.UPDATE),i.scaleOptions=t.getScaleOptions(),d=a.getLayerStyleAttributes(),y=t.getSource().data.dataArray,!(Array.isArray(y)&&y.length===0)){T.next=8;break}return T.abrupt("return",!0);case 8:return i.caculateScalesForAttributes(d||[],y),t.log(ks.ScaleInitEnd,Qo.UPDATE),t.layerModelNeedUpdate=!0,T.abrupt("return",!0);case 12:case"end":return T.stop()}},l)}));return function(l){return s.apply(this,arguments)}}()),t.hooks.beforeRender.tap("FeatureScalePlugin",function(){if(!t.layerModelNeedUpdate){i.scaleOptions=t.getScaleOptions();var s=a.getLayerStyleAttributes(),l=t.getSource().data.dataArray;if(!(Array.isArray(l)&&l.length===0)&&s){var f=s.filter(function(d){return d.needRescale});f.length&&i.caculateScalesForAttributes(f,l)}}})}},{key:"isNumber",value:function(t){return!isNaN(parseFloat(t))&&isFinite(t)}},{key:"caculateScalesForAttributes",value:function(t,n){var i=this;t.forEach(function(a){if(a.scale){var s=a.scale,l=a.scale.field;s.names=i.parseFields(b_(l)?[]:l);var f=[];s.names.forEach(function(d){var y;f.push(i.createScale(d,a.name,(y=a.scale)===null||y===void 0?void 0:y.values,n))}),f.some(function(d){return d.type===lv.VARIABLE})?(s.type=lv.VARIABLE,f.forEach(function(d){if(!s.callback&&s.values!=="text"){var y;switch((y=d.option)===null||y===void 0?void 0:y.type){case $a.LOG:case $a.LINEAR:case $a.POWER:if(s.values&&s.values.length>2){var b=d.scale.ticks(s.values.length);d.scale.domain(b)}s.values?d.scale.range(s.values):d.scale.range(d.option.domain);break;case $a.QUANTILE:case $a.QUANTIZE:case $a.THRESHOLD:d.scale.range(s.values);break;case $a.IDENTITY:break;case $a.CAT:s.values?d.scale.range(s.values):d.scale.range(d.option.domain);break;case $a.DIVERGING:case $a.SEQUENTIAL:d.scale.interpolator(vI(s.values));break}}if(s.values==="text"){var T;d.scale.range((T=d.option)===null||T===void 0?void 0:T.domain)}})):(s.type=lv.CONSTANT,s.defaultValues=f.map(function(d,y){return d.scale(s.names[y])})),s.scalers=f.map(function(d){return{field:d.field,func:d.scale,option:d.option}}),a.needRescale=!1}})}},{key:"parseFields",value:function(t){return Array.isArray(t)?t:CO(t)?t.split("*"):[t]}},{key:"createScale",value:function(t,n,i,a){var s,l,f=this.scaleOptions[n]&&((s=this.scaleOptions[n])===null||s===void 0?void 0:s.field)===t?this.scaleOptions[n]:this.scaleOptions[t],d={field:t,scale:void 0,type:lv.VARIABLE,option:f};if(!a||!a.length)return f&&f.type?d.scale=this.createDefaultScale(f):(d.scale=zg([t]),d.type=lv.CONSTANT),d;var y=(l=a.find(function(M){return!b_(M[t])}))===null||l===void 0?void 0:l[t];if(this.isNumber(t)||b_(y)&&!f)d.scale=zg([t]),d.type=lv.CONSTANT;else{var b=f&&f.type||this.getDefaultType(y);i==="text"&&(b=$a.CAT),i===void 0&&(b=$a.IDENTITY);var T=this.createScaleConfig(b,t,f,a);d.scale=this.createDefaultScale(T),d.option=T}return d}},{key:"getDefaultType",value:function(t){var n=$a.LINEAR;return typeof t=="string"&&(n=MO.test(t)?$a.TIME:$a.CAT),n}},{key:"createScaleConfig",value:function(t,n,i,a){var s={type:t},l=[];if(t===$a.QUANTILE){var f=new Map;a==null||a.forEach(function(b){f.set(b._id,b[n])}),l=Array.from(f.values())}else l=(a==null?void 0:a.map(function(b){return b[n]}))||[];if(i!=null&&i.domain)s.domain=i==null?void 0:i.domain;else if(t===$a.CAT||t===$a.IDENTITY)s.domain=RO(l);else if(t===$a.QUANTILE)s.domain=l;else if(t===$a.DIVERGING){var d=dx(l),y=(i==null?void 0:i.neutral)!==void 0?i==null?void 0:i.neutral:(d[0]+d[1])/2;s.domain=[d[0],y,d[1]]}else s.domain=dx(l);return(0,W.Z)((0,W.Z)({},s),i)}},{key:"createDefaultScale",value:function(t){var n=t.type,i=t.domain,a=t.unknown,s=t.clamp,l=t.nice,f=IO[n]();return i&&f.domain&&f.domain(i),a&&f.unknown(a),s!==void 0&&f.clamp&&f.clamp(s),l!==void 0&&f.nice&&f.nice(l),f}}]),e}())||Lb),Bb,Fb,OO=(Bb=(0,tr.b2)(),Bb(Fb=function(){function e(){(0,Q.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LayerAnimateStylePlugin",function(){var n=t.animateStatus;n&&t.models.forEach(function(i){i.addUniforms((0,W.Z)({},t.layerModel.getAnimateUniforms()))})})}}]),e}())||Fb),Nb,Ub,kO=(Nb=(0,tr.b2)(),Nb(Ub=function(){function e(){(0,Q.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerMaskPlugin",function(){var n=t.getLayerConfig(),i=n.maskLayers,a=n.enableMask;if(!t.tileLayer&&i&&i.length>0){var s;(s=t.masks).push.apply(s,(0,Jt.Z)(i)),t.updateLayerConfig({mask:a})}})}}]),e}())||Ub),DO=function(){function e(r){var t=r.rendererService,n=r.layerService,i=r.parent;(0,Q.Z)(this,e),(0,F.Z)(this,"tileResource",new Map),(0,F.Z)(this,"layerTiles",[]),this.rendererService=t,this.layerService=n,this.parent=i}return(0,j.Z)(e,[{key:"tiles",get:function(){return this.layerTiles}},{key:"hasTile",value:function(t){return this.layerTiles.some(function(n){return n.key===t})}},{key:"addTile",value:function(t){this.layerTiles.push(t)}},{key:"getTile",value:function(t){return this.layerTiles.find(function(n){return n.key===t})}},{key:"getVisibleTileBylngLat",value:function(t){return this.layerTiles.find(function(n){return n.isLoaded&&n.visible&&n.lnglatInBounds(t)})}},{key:"removeTile",value:function(t){var n=this.layerTiles.findIndex(function(a){return a.key===t}),i=this.layerTiles.splice(n,1);i[0]&&i[0].destroy()}},{key:"updateTileVisible",value:function(t){var n=this.getTile(t.key);if(t.isVisible)if(t.parent){var i=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(i)}else n==null||n.updateVisible(!0);else if(t.parent){var a=this.isChildrenLoaded(t.parent);n==null||n.updateVisible(!a)}else n==null||n.updateVisible(!1)}},{key:"isParentLoaded",value:function(t){var n=t.parent;if(!n)return!0;var i=this.getTile(n==null?void 0:n.key);return!!(i!=null&&i.isLoaded)}},{key:"isChildrenLoaded",value:function(t){var n=this,i=t==null?void 0:t.children;return i.length===0?!0:i.every(function(a){var s=n.getTile(a==null?void 0:a.key);return s?(s==null?void 0:s.isLoaded)===!0:!0})}},{key:"render",value:function(){var r=(0,Zt.Z)(_e().mark(function n(){var i=this,a,s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:return a=this.getRenderLayers(),s=a.map(function(){var d=(0,Zt.Z)(_e().mark(function y(b){return _e().wrap(function(M){for(;;)switch(M.prev=M.next){case 0:return M.next=2,i.layerService.renderTileLayer(b);case 2:case"end":return M.stop()}},y)}));return function(y){return d.apply(this,arguments)}}()),f.next=4,Promise.all(s);case 4:case"end":return f.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"getRenderLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.visible&&i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,(0,Jt.Z)(i.getLayers()))}),n}},{key:"getLayers",value:function(){var t=this.layerTiles.filter(function(i){return i.isLoaded}),n=[];return t.map(function(i){return n.push.apply(n,(0,Jt.Z)(i.getLayers()))}),n}},{key:"getTiles",value:function(){return this.layerTiles}},{key:"destroy",value:function(){this.layerTiles.forEach(function(t){return t.destroy()}),this.tileResource.clear()}}]),e}(),LO=U(41227);function BO(e,r,t){t===void 0&&(t={});var n=Nn(e),i=Nn(r),a=LO.union(n.coordinates,i.coordinates);return a.length===0?null:a.length===1?dr(a[0],t.properties):Jr(a,t.properties)}var FO=BO,NO=function(){function e(){(0,Q.Z)(this,e)}return(0,j.Z)(e,[{key:"getCombineFeature",value:function(t){var n=null,i=t[0];return t.map(function(a){var s=dr(a.coordinates);n===null?n=s:n=FO(n,s)}),i&&(n.properties=(0,W.Z)({},i)),n}}]),e}(),km="select",Dm="active",UO=function(){function e(r){var t=r.layerService,n=r.tileLayerService,i=r.parent;(0,Q.Z)(this,e),(0,F.Z)(this,"tilePickID",new Map),this.layerService=t,this.tileLayerService=n,this.parent=i,this.tileSourceService=new NO}return(0,j.Z)(e,[{key:"pickRender",value:function(t){var n=this.tileLayerService.getVisibleTileBylngLat(t.lngLat);if(n){var i=n.getMainLayer();i==null||i.layerPickService.pickRender(t)}}},{key:"pick",value:function(t,n){var i=this.parent.getContainer(),a=i.get(Je.IPickingService);if(t.type==="RasterLayer"){var s=this.tileLayerService.getVisibleTileBylngLat(n.lngLat);if(s&&s.getMainLayer()!==void 0){var l=s.getMainLayer();return l.layerPickService.pickRasterLayer(l,n,this.parent)}return!1}return this.pickRender(n),a.pickFromPickingFBO(t,n)}},{key:"selectFeature",value:function(t){var n=(0,yn.Z)(t,3),i=n[0],a=n[1],s=n[2],l=this.color2PickId(i,a,s);this.tilePickID.set(km,l),this.updateHighLight(i,a,s,km)}},{key:"highlightPickedFeature",value:function(t){var n=(0,yn.Z)(t,3),i=n[0],a=n[1],s=n[2],l=this.color2PickId(i,a,s);this.tilePickID.set(Dm,l),this.updateHighLight(i,a,s,Dm)}},{key:"updateHighLight",value:function(t,n,i,a){this.tileLayerService.tiles.map(function(s){var l=s.getMainLayer();switch(a){case km:l==null||l.hooks.beforeSelect.call([t,n,i]);break;case Dm:l==null||l.hooks.beforeHighlight.call([t,n,i]);break}})}},{key:"setPickState",value:function(){var t=this.tilePickID.get(km),n=this.tilePickID.get(Dm);if(t){var i=this.pickId2Color(t),a=(0,yn.Z)(i,3),s=a[0],l=a[1],f=a[2];this.updateHighLight(s,l,f,km);return}if(n){var d=this.pickId2Color(n),y=(0,yn.Z)(d,3),b=y[0],T=y[1],M=y[2];this.updateHighLight(b,T,M,Dm);return}}},{key:"color2PickId",value:function(t,n,i){return ka(new Uint8Array([t,n,i]))}},{key:"pickId2Color",value:function(t){return na(t)}},{key:"getFeatureById",value:function(t){var n=this.tileLayerService.getTiles().filter(function(a){return a.visible}),i=[];return n.forEach(function(a){i.push.apply(i,(0,Jt.Z)(a.getFeatureById(t)))}),i}},{key:"pickRasterLayer",value:function(t,n,i){return!1}}]),e}();function zO(e){return e==="PolygonLayer"?kg:e==="LineLayer"?q0:Og}function ZO(e){return["PolygonLayer","LineLayer"].indexOf(e)!==-1}function VO(e){var r=jO();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function jO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Td=function(e){(0,Le.Z)(t,e);var r=VO(t);function t(n,i){var a;return(0,Q.Z)(this,t),a=r.call(this),(0,F.Z)((0,Re.Z)(a),"visible",!0),(0,F.Z)((0,Re.Z)(a),"layers",[]),(0,F.Z)((0,Re.Z)(a),"isLoaded",!1),(0,F.Z)((0,Re.Z)(a),"tileMaskLayers",[]),a.parent=i,a.sourceTile=n,a.x=n.x,a.y=n.y,a.z=n.z,a.key="".concat(a.x,"_").concat(a.y,"_").concat(a.z),a}return(0,j.Z)(t,[{key:"getLayers",value:function(){return this.layers}},{key:"styleUpdate",value:function(){}},{key:"lnglatInBounds",value:function(i){var a=(0,yn.Z)(this.sourceTile.bounds,4),s=a[0],l=a[1],f=a[2],d=a[3],y=i.lng,b=i.lat;return y>=s&&y<=f&&b>=l&&b<=d}},{key:"getLayerOptions",value:function(){var i,a=this.parent.getLayerConfig();return(0,W.Z)((0,W.Z)({},a),{},{textAllowOverlap:!0,autoFit:!1,maskLayers:this.getMaskLayer(),tileMask:ZO(this.parent.type),mask:a.mask||((i=a.maskLayers)===null||i===void 0?void 0:i.length)!==0&&a.enableMask})}},{key:"getMaskLayer",value:function(){var i=this,a=this.parent.getLayerConfig(),s=a.maskLayers,l=[];return s==null||s.forEach(function(f){if(!f.tileLayer)return l.push(f),f;var d=f.tileLayer,y=d.getTile(i.sourceTile.key),b=y==null?void 0:y.getLayers()[0];b&&l.push(b)}),l}},{key:"addTileMask",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f;return _e().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return s=new kg({visible:!1,enablePicking:!1}).source({type:"FeatureCollection",features:[this.sourceTile.bboxPolygon]},{parser:{type:"geojson",featureId:"id"}}).shape("fill").style({opacity:.5}),l=gm(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),y.next=5,s.init();case 5:return this.tileMask=s,f=this.getMainLayer(),f!==void 0&&(f.tileMask=s),y.abrupt("return",s);case 9:case"end":return y.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"addMask",value:function(){var n=(0,Zt.Z)(_e().mark(function a(s,l){var f;return _e().wrap(function(y){for(;;)switch(y.prev=y.next){case 0:return f=gm(this.parent.sceneContainer),l.setContainer(f,this.parent.sceneContainer),y.next=4,l.init();case 4:s.addMask(l),this.tileMaskLayers.push(l);case 6:case"end":return y.stop()}},a,this)}));function i(a,s){return n.apply(this,arguments)}return i}()},{key:"addLayer",value:function(){var n=(0,Zt.Z)(_e().mark(function a(s){var l;return _e().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:return s.isTileLayer=!0,l=gm(this.parent.sceneContainer),s.setContainer(l,this.parent.sceneContainer),this.layers.push(s),d.next=6,s.init();case 6:case"end":return d.stop()}},a,this)}));function i(a){return n.apply(this,arguments)}return i}()},{key:"updateVisible",value:function(i){this.visible=i,this.updateOptions("visible",i)}},{key:"updateOptions",value:function(i,a){this.layers.forEach(function(s){s.updateLayerConfig((0,F.Z)({},i,a))})}},{key:"getMainLayer",value:function(){return this.layers[0]}},{key:"getFeatures",value:function(i){return[]}},{key:"getFeatureById",value:function(i){return[]}},{key:"destroy",value:function(){var i;(i=this.tileMask)===null||i===void 0||i.destroy(),this.layers.forEach(function(a){return a.destroy()})}}]),t}(qa.EventEmitter);function HO(e){var r=WO();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function WO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var GO=function(e){(0,Le.Z)(t,e);var r=HO(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.getSourceOption(),l=s.data.features[0].properties,f=new q0().source(s.data,s.options).size(1).shape("line").color("red"),d=new Og({minZoom:this.z-1,maxZoom:this.z+1,textAllowOverlap:!0}).source([l],{parser:{type:"json",x:"x",y:"y"}}).size(20).color("red").shape(this.key).style({stroke:"#fff",strokeWidth:2}),b.next=6,this.addLayer(f);case 6:return b.next=8,this.addLayer(d);case 8:this.isLoaded=!0;case 9:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.layers.testTile.features;return{data:{type:"FeatureCollection",features:a},options:{parser:{type:"geojson"},transforms:i.transforms}}}}]),t}(Td);function XO(e){var r=$O();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function $O(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var YO=function(e){(0,Le.Z)(t,e);var r=XO(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new P1((0,W.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(T){var M,P,k=T;d[k]((M=s[k])===null||M===void 0?void 0:M.field,(P=s[k])===null||P===void 0?void 0:P.values)}),b.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(Td);function qO(e){var r=KO();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function KO(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var QO=function(e){(0,Le.Z)(t,e);var r=qO(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new nx((0,W.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(T){var M,P,k=T;d[k]((M=s[k])===null||M===void 0?void 0:M.field,(P=s[k])===null||P===void 0?void 0:P.values)}),b.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getFeatures",value:function(i){if(!i)return[];var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),s=a.sourceLayer,l=a.featureId,f=this.getFeatures(s);return{data:{type:"FeatureCollection",features:f},options:{parser:{type:"geojson",featureId:l},transforms:i.transforms}}}}]),t}(Td),JO=["rasterData"];function e5(e){var r=t5();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function t5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var r5=function(e){(0,Le.Z)(t,e);var r=e5(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new Dg((0,W.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(T){var M,P,k=T;d[k]((M=s[k])===null||M===void 0?void 0:M.field,(P=s[k])===null||P===void 0?void 0:P.values)}),b.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,s=a.rasterData,l=(0,Ea.Z)(a,JO);return{data:s,options:{parser:(0,W.Z)({type:"rasterRgb",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}}]),t}(Td);function n5(e){var r=i5();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function i5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var a5=function(e){(0,Le.Z)(t,e);var r=n5(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d;return _e().wrap(function(b){for(;;)switch(b.prev=b.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=new Dg((0,W.Z)({},l)).source(f.data,f.options),s&&Object.keys(s).forEach(function(T){var M,P,k=T;d[k]((M=s[k])===null||M===void 0?void 0:M.field,(P=s[k])===null||P===void 0?void 0:P.values)}),b.next=7,this.addLayer(d);case 7:this.isLoaded=!0;case 8:case"end":return b.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource();return{data:this.sourceTile.data,options:{parser:{type:"image",extent:this.sourceTile.bounds},transforms:i.transforms}}}}]),t}(Td),o5=["rasterData"];function s5(e){var r=u5();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function u5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var l5={positions:[0,1],colors:["#000","#fff"]},c5=function(e){(0,Le.Z)(t,e);var r=s5(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y,b,T;return _e().wrap(function(P){for(;;)switch(P.prev=P.next){case 0:return s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=this.getSourceOption(),d=this.getLayerOptions(),y=d.rampColors,b=d.domain,this.colorTexture=this.parent.textureService.getColorTexture(y,b),T=new Dg((0,W.Z)((0,W.Z)({},l),{},{colorTexture:this.colorTexture})).source(f.data,f.options),s&&Object.keys(s).forEach(function(k){var H,q,ae=k;T[ae]((H=s[ae])===null||H===void 0?void 0:H.field,(q=s[ae])===null||q===void 0?void 0:q.values)}),P.next=9,this.addLayer(T);case 9:this.isLoaded=!0;case 10:case"end":return P.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.sourceTile.data.data,s=a.rasterData,l=(0,Ea.Z)(a,o5);return{data:s,options:{parser:(0,W.Z)({type:"raster",extent:this.sourceTile.bounds},l),transforms:i.transforms}}}},{key:"styleUpdate",value:function(){for(var i=this,a=arguments.length,s=new Array(a),l=0;l<a;l++)s[l]=arguments[l];var f=s,d=f.rampColors,y=d===void 0?l5:d,b=f.domain;this.colorTexture=this.parent.textureService.getColorTexture(y,b||_c(y)),this.layers.forEach(function(T){return T.style({colorTexture:i.colorTexture})})}},{key:"destroy",value:function(){this.layers.forEach(function(i){return i.destroy()})}}]),t}(Td);function f5(e){var r=h5();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function h5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var Qg=function(e){(0,Le.Z)(t,e);var r=f5(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"initTileLayer",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s,l,f,d,y;return _e().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:if(s=this.parent.getLayerAttributeConfig(),l=this.getLayerOptions(),f=zO(this.parent.type),d=this.getSourceOption(),d){T.next=8;break}return this.isLoaded=!0,this.emit("loaded"),T.abrupt("return");case 8:return y=new f((0,W.Z)({},l)).source(d.data,d.options),Object.keys(s).forEach(function(M){var P,k,H=M;y[H]((P=s[H])===null||P===void 0?void 0:P.field,(k=s[H])===null||k===void 0?void 0:k.values)}),T.next=12,this.addLayer(y);case 12:if(!l.tileMask){T.next=15;break}return T.next=15,this.addTileMask();case 15:this.setLayerMinMaxZoom(y),this.isLoaded=!0,this.emit("loaded");case 18:case"end":return T.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"getSourceOption",value:function(){var i=this.parent.getSource(),a=this.parent.getLayerConfig(),s=a.sourceLayer,l=s===void 0?"defaultLayer":s,f=a.featureId,d=f===void 0?"id":f,y=this.getFeatures(l);return{data:{type:"FeatureCollection",features:y},options:{parser:{type:"geojson",featureId:d},transforms:i.transforms}}}},{key:"setLayerMinMaxZoom",value:function(i){i.getModelType()==="text"&&i.updateLayerConfig({maxZoom:this.z+1,minZoom:this.z-1})}},{key:"getFeatures",value:function(i){var a=this.sourceTile.data;return a.getTileData(i)}},{key:"getFeatureById",value:function(i){var a=this.getMainLayer();if(!a)return[];var s=a.getSource().data.dataArray.filter(function(l){return l._id===i});return s}}]),t}(Td);function p5(e){var r=e.type;switch(r){case"PolygonLayer":return Qg;case"LineLayer":return Qg;case"PointLayer":return Qg;case"TileDebugLayer":return GO;case"MaskLayer":return QO;case"RasterLayer":var t=e.getSource().parser.dataType;switch(t){case Mu.RGB:case Mu.CUSTOMRGB:return r5;case Mu.ARRAYBUFFER:case Mu.CUSTOMARRAYBUFFER:return c5;case Mu.TERRAINRGB:case Mu.CUSTOMTERRAINRGB:return a5;default:return YO}default:return Qg}}var d5=["shape","color","size","style","animate","filter","rotate","scale","setBlend","setSelect","setActive","disableMask","enableMask","addMask","removeMask"],v5=ui.debounce,zb=function(){function e(r){var t=this;(0,Q.Z)(this,e),(0,F.Z)(this,"initedTileset",!1),(0,F.Z)(this,"mapchange",function(){var i;if(t.parent.isVisible()!==!1){var a=t.getCurrentView(),s=a.latLonBounds,l=a.zoom;if(t.mapService.version==="GAODE1.x"){var f=t.parent.getLayerConfig(),d=f.visible;l<2&&d?(t.parent.updateLayerConfig({visible:!1}),t.layerService.reRender()):l>=2&&!d&&(t.parent.updateLayerConfig({visible:!0}),t.layerService.reRender())}t.lastViewStates&&t.lastViewStates.zoom===l&&t.lastViewStates.latLonBounds.toString()===s.toString()||(t.lastViewStates={zoom:l,latLonBounds:s},(i=t.tilesetManager)===null||i===void 0||i.throttleUpdate(l,s))}}),(0,F.Z)(this,"viewchange",v5(this.mapchange,24)),this.parent=r;var n=this.parent.getContainer();this.rendererService=n.get(Je.IRendererService),this.layerService=n.get(Je.ILayerService),this.mapService=n.get(Je.IMapService),this.pickingService=n.get(Je.IPickingService),this.tileLayerService=new DO({rendererService:this.rendererService,layerService:this.layerService,parent:r}),this.tilePickService=new UO({tileLayerService:this.tileLayerService,layerService:this.layerService,parent:r}),this.parent.setLayerPickService(this.tilePickService),this.proxy(r),this.initTileSetManager()}return(0,j.Z)(e,[{key:"initTileSetManager",value:function(){var t,n=this.parent.getSource();if(this.tilesetManager=n.tileset,this.initedTileset||(this.bindTilesetEvent(),this.initedTileset=!0),this.parent.isVisible()!==!1){var i=this.getCurrentView(),a=i.latLonBounds,s=i.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(s,a)}}},{key:"getCurrentView",value:function(){var t=this.mapService.getBounds(),n=[t[0][0],t[0][1],t[1][0],t[1][1]],i=this.mapService.getZoom();return{latLonBounds:n,zoom:i}}},{key:"bindTilesetEvent",value:function(){var t=this;this.tilesetManager.on("tile-loaded",function(n){}),this.tilesetManager.on("tile-unload",function(n){t.tileUnLoad(n)}),this.tilesetManager.on("tile-error",function(n,i){t.tileError(n)}),this.tilesetManager.on("tile-update",function(){t.tileUpdate()}),this.mapService.on("zoomend",this.mapchange),this.mapService.on("moveend",this.viewchange)}},{key:"render",value:function(){this.tileLayerService.render()}},{key:"getLayers",value:function(){return this.tileLayerService.getLayers()}},{key:"getTiles",value:function(){return this.tileLayerService.getTiles()}},{key:"getTile",value:function(t){return this.tileLayerService.getTile(t)}},{key:"tileLoaded",value:function(t){}},{key:"tileError",value:function(t){console.warn("error:",t)}},{key:"destroy",value:function(){var t;this.mapService.off("zoomend",this.mapchange),this.mapService.off("moveend",this.viewchange),(t=this.tilesetManager)===null||t===void 0||t.destroy(),this.tileLayerService.destroy()}},{key:"reload",value:function(){var t;this.tilesetManager.clear();var n=this.getCurrentView(),i=n.latLonBounds,a=n.zoom;(t=this.tilesetManager)===null||t===void 0||t.update(a,i)}},{key:"tileUnLoad",value:function(t){this.tileLayerService.removeTile(t.key)}},{key:"tileUpdate",value:function(){var r=(0,Zt.Z)(_e().mark(function n(){var i=this,a,s;return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(this.tilesetManager){f.next=2;break}return f.abrupt("return");case 2:return a=this.parent.getMinZoom(),s=this.parent.getMaxZoom(),f.next=6,Promise.all(this.tilesetManager.tiles.filter(function(d){return d.isLoaded}).filter(function(d){return d.isVisibleChange}).filter(function(d){return d.data}).filter(function(d){return d.z>=a&&d.z<s}).map(function(){var d=(0,Zt.Z)(_e().mark(function y(b){var T,M;return _e().wrap(function(k){for(;;)switch(k.prev=k.next){case 0:if(i.tileLayerService.hasTile(b.key)){k.next=9;break}return T=p5(i.parent),M=new T(b,i.parent),k.next=5,M.initTileLayer();case 5:i.tilePickService.setPickState(),M.getLayers().length!==0&&(i.tileLayerService.addTile(M),i.tileLayerService.updateTileVisible(b),i.layerService.reRender()),k.next=12;break;case 9:i.tileLayerService.updateTileVisible(b),i.tilePickService.setPickState(),i.layerService.reRender();case 12:case"end":return k.stop()}},y)}));return function(y){return d.apply(this,arguments)}}()));case 6:this.tilesetManager.isLoaded&&this.parent.emit("tiles-loaded",this.tilesetManager.currentTiles);case 7:case"end":return f.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"setPickState",value:function(t){}},{key:"pickRender",value:function(t){this.tilePickService.pickRender(t)}},{key:"selectFeature",value:function(t){this.tilePickService.selectFeature(t)}},{key:"highlightPickedFeature",value:function(t){this.tilePickService.highlightPickedFeature(t)}},{key:"proxy",value:function(t){var n=this;d5.forEach(function(i){var a=t[i].bind(t);t[i]=function(){for(var s=arguments.length,l=new Array(s),f=0;f<s;f++)l[f]=arguments[f];return a.apply(void 0,l),n.getLayers().map(function(d){d[i].apply(d,l)}),i==="style"&&n.getTiles().forEach(function(d){return d.styleUpdate.apply(d,l)}),t}})}}]),e}(),Zb,Vb,m5=(Zb=(0,tr.b2)(),Zb(Vb=function(){function e(){(0,Q.Z)(this,e)}return(0,j.Z)(e,[{key:"build",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i){return _e().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return i.prepareBuildModel(),s.next=3,i.buildModels();case 3:case"end":return s.stop()}},n)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"initLayerModel",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i){return _e().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"prepareLayerModel",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i){return _e().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,this.build(i);case 2:i.styleNeedUpdate=!1;case 3:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"apply",value:function(t){var n=this;t.hooks.init.tapPromise("LayerModelPlugin",(0,Zt.Z)(_e().mark(function i(){return _e().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:if(!t.getSource().isTile){s.next=4;break}return t.prepareBuildModel(),t.tileLayer=new zb(t),s.abrupt("return");case 4:return t.log(ks.BuildModelStart,Qo.INIT),s.next=7,n.initLayerModel(t);case 7:t.log(ks.BuildModelEnd,Qo.INIT);case 8:case"end":return s.stop()}},i)}))),t.hooks.beforeRenderData.tapPromise("LayerModelPlugin",function(){var i=(0,Zt.Z)(_e().mark(function a(s){return _e().wrap(function(f){for(;;)switch(f.prev=f.next){case 0:if(s){f.next=2;break}return f.abrupt("return",!1);case 2:if(!t.getSource().isTile){f.next=5;break}return t.tileLayer=new zb(t),f.abrupt("return",!1);case 5:return t.log(ks.BuildModelStart,Qo.UPDATE),f.next=8,n.prepareLayerModel(t);case 8:return t.log(ks.BuildModelEnd,Qo.UPDATE),f.abrupt("return",!0);case 10:case"end":return f.stop()}},a)}));return function(a){return i.apply(this,arguments)}}())}}]),e}())||Vb),jb,Hb,g5=(jb=(0,tr.b2)(),jb(Hb=function(){function e(){(0,Q.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t){t.hooks.afterInit.tap("LayerStylePlugin",function(){var n=t.getLayerConfig(),i=n.autoFit,a=n.fitBoundsOptions;i&&t.fitBounds(a),t.styleNeedUpdate=!1})}}]),e}())||Hb),Wb,Gb,_5=["type"],Xb={directional:{lights:"u_DirectionalLights",num:"u_NumOfDirectionalLights"},spot:{lights:"u_SpotLights",num:"u_NumOfSpotLights"}},y5={type:"directional",direction:[1,10.5,12],ambient:[.2,.2,.2],diffuse:[.6,.6,.6],specular:[.1,.1,.1]},x5={direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0]},b5={position:[0,0,0],direction:[0,0,0],ambient:[0,0,0],diffuse:[0,0,0],specular:[0,0,0],constant:1,linear:0,quadratic:0,angle:14,exponent:40,blur:5};function E5(e){var r={u_DirectionalLights:new Array(3).fill((0,W.Z)({},x5)),u_NumOfDirectionalLights:0,u_SpotLights:new Array(3).fill((0,W.Z)({},b5)),u_NumOfSpotLights:0};return(!e||!e.length)&&(e=[y5]),e.forEach(function(t){var n=t.type,i=n===void 0?"directional":n,a=(0,Ea.Z)(t,_5),s=Xb[i].lights,l=Xb[i].num,f=r[l];r[s][f]=(0,W.Z)((0,W.Z)({},r[s][f]),a),r[l]++}),r}var S5=(Wb=(0,tr.b2)(),Wb(Gb=function(){function e(){(0,Q.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("LightingPlugin",function(){var n=t.getLayerConfig(),i=n.enableLighting;i&&t.models.forEach(function(a){return a.addUniforms((0,W.Z)({},E5()))})})}}]),e}())||Gb),$b,Yb,A5=($b=(0,tr.b2)(),$b(Yb=function(){function e(){(0,Q.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.rendererService,s=n.postProcessingPassFactory,l=n.normalPassFactory;t.hooks.init.tapPromise("MultiPassRendererPlugin",function(){var f=t.getLayerConfig(),d=f.enableMultiPassRenderer,y=f.passes,b=y===void 0?[]:y;i.enabled=!!d&&t.getLayerConfig().enableMultiPassRenderer!==!1,i.enabled&&(t.multiPassRenderer=a1(t,b,s,l),t.multiPassRenderer.setRenderFlag(!0))}),t.hooks.beforeRender.tap("MultiPassRendererPlugin",function(){if(i.enabled){var f=a.getViewportSize(),d=f.width,y=f.height;t.multiPassRenderer.resize(d,y)}})}}]),e}())||Yb),qb,Kb,T5=ui.isNumber,bv={NONE:0,ENCODE:1,HIGHLIGHT:2},w5=(qb=(0,tr.b2)(),qb(Kb=function(){function e(){(0,Q.Z)(this,e)}return(0,j.Z)(e,[{key:"pickOption2Array",value:function(){var t=[];return this.pickingUniformMap.forEach(function(n,i){T5(n)?t.push(n):t.push.apply(t,(0,Jt.Z)(n))}),t}},{key:"updatePickOption",value:function(t,n){var i=this;Object.keys(t).forEach(function(f){i.pickingUniformMap.set(f,t[f])});var a=n.getLayerConfig().pickingBuffer||0,s=Number(n.getShaderPickStat());this.pickingUniformMap.set("u_PickingBuffer",a),this.pickingUniformMap.set("u_shaderPick",s);var l=n.getPickingUniformBuffer();l.subData({offset:0,data:this.pickOption2Array()})}},{key:"apply",value:function(t,n){var i=this,a=n.rendererService,s=n.styleAttributeService,l;this.pickingUniformMap=new Map([["u_HighlightColor",[1,0,0,1]],["u_SelectColor",[1,0,0,1]],["u_PickingColor",[0,0,0]],["u_PickingStage",0],["u_CurrentSelectedId",[0,0,0]],["u_PickingThreshold",10],["u_PickingBuffer",0],["u_shaderPick",0],["u_EnableSelect",0],["u_activeMix",0]]),t.hooks.init.tapPromise("PixelPickingPlugin",function(){var f=t.getLayerConfig(),d=f.enablePicking;s.registerStyleAttribute({name:"pickingColor",type:Mn.Attribute,descriptor:{name:"a_PickingColor",shaderLocation:qn.PICKING_COLOR,buffer:{data:[],type:I.FLOAT},size:3,update:function(b){var T=b.id;return d?na(T):[0,0,0]}}})}),t.hooks.beforePickingEncode.tap("PixelPickingPlugin",function(){var f=t.getLayerConfig(),d=f.enablePicking;d&&t.isVisible()&&(i.updatePickOption({u_PickingStage:bv.ENCODE},t),t.models.forEach(function(y){return y.addUniforms({u_PickingStage:bv.ENCODE})}))}),t.hooks.afterPickingEncode.tap("PixelPickingPlugin",function(){var f=t.getLayerConfig(),d=f.enablePicking;d&&t.isVisible()&&(i.updatePickOption({u_PickingStage:bv.HIGHLIGHT},t),t.models.forEach(function(y){return y.addUniforms({u_PickingStage:bv.HIGHLIGHT})}))}),t.hooks.beforeHighlight.tap("PixelPickingPlugin",function(f){var d=t.getLayerConfig(),y=d.highlightColor,b=d.activeMix,T=b===void 0?0:b,M=typeof y=="string"?vi(y):y||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:ka(new Uint8Array(f))});var P={u_PickingStage:bv.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:M.map(function(k){return k*255}),u_activeMix:T};i.updatePickOption(P,t),t.models.forEach(function(k){return k.addUniforms(P)})}),t.hooks.beforeSelect.tap("PixelPickingPlugin",function(f){var d=t.getLayerConfig(),y=d.selectColor,b=d.selectMix,T=b===void 0?0:b,M=typeof y=="string"?vi(y):y||[1,0,0,1];t.updateLayerConfig({pickedFeatureID:ka(new Uint8Array(f))});var P={u_PickingStage:bv.HIGHLIGHT,u_PickingColor:f,u_HighlightColor:M.map(function(k){return k*255}),u_activeMix:T,u_CurrentSelectedId:f,u_SelectColor:M.map(function(k){return k*255}),u_EnableSelect:1};i.updatePickOption(P,t),t.models.forEach(function(k){return k.addUniforms(P)})})}}]),e}())||Kb),C5=["mvt","geojsonvt","testTile"];function R5(e){var r=e.getSource();return C5.includes(r.parser.type)}function eN(e){return e.getContext?{width:e.width/DOM.DPR,height:e.height/DOM.DPR}:e.getBoundingClientRect()}var Qb,Jb,M5=(Qb=(0,tr.b2)(),Qb(Jb=function(){function e(){(0,Q.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("RegisterStyleAttributePlugin",function(){R5(t)||i.registerBuiltinAttributes(a,t)})}},{key:"registerBuiltinAttributes",value:function(t,n){if(n.type==="MaskLayer"){this.registerPositionAttribute(t);return}this.registerPositionAttribute(t),this.registerColorAttribute(t),this.registerVertexIdAttribute(t)}},{key:"registerPositionAttribute",value:function(t){t.registerStyleAttribute({name:"position",type:Mn.Attribute,descriptor:{name:"a_Position",shaderLocation:qn.POSITION,buffer:{data:[],type:I.FLOAT},size:3,update:function(i,a,s){return s.length===2?[s[0],s[1],0]:[s[0],s[1],s[2]]}}})}},{key:"registerColorAttribute",value:function(t){t.registerStyleAttribute({name:"color",type:Mn.Attribute,descriptor:{name:"a_Color",shaderLocation:qn.COLOR,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:4,update:function(i){var a=i.color;return!a||!a.length?[1,1,1,1]:a}}})}},{key:"registerVertexIdAttribute",value:function(t){t.registerStyleAttribute({name:"vertexId",type:Mn.Attribute,descriptor:{name:"a_vertexId",shaderLocation:qn.VERTEX_ID,buffer:{usage:I.DYNAMIC_DRAW,data:[],type:I.FLOAT},size:1,update:function(i,a){return[a]}}})}}]),e}())||Jb),eE,tE,rE,nE,iE,aE,oE,wd,sE,uE,lE,cE,fE,I5=(eE=(0,tr.b2)(),tE=(0,tr.f3)(Je.ICameraService),rE=(0,tr.f3)(Je.ICoordinateSystemService),nE=(0,tr.f3)(Je.IRendererService),iE=(0,tr.f3)(Je.IMapService),aE=(0,tr.f3)(Je.ILayerService),eE(oE=(wd=function(){function e(){(0,Q.Z)(this,e),ki(this,"cameraService",sE,this),ki(this,"coordinateSystemService",uE,this),ki(this,"rendererService",lE,this),ki(this,"mapService",cE,this),ki(this,"layerService",fE,this)}return(0,j.Z)(e,[{key:"apply",value:function(t){var n=this,i=this.mapService.version,a=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],s=[0,0],l;this.rendererService.uniformBuffers[0]||(l=this.rendererService.createBuffer({data:new Float32Array(16*4+4*7),isUBO:!0}),this.rendererService.uniformBuffers[0]=l),t.hooks.beforeRender.tap("ShaderUniformPlugin",function(){var f=t.getLayerConfig().tileOrigin;if(n.coordinateSystemService.refresh(f),i==="GAODE2.x"){n.setLayerCenter(t),a=n.mapService.map.customCoords.getMVPMatrix(),s=n.mapService.getCustomCoordCenter();var d=t.getLayerUniformBuffer();d.subData({offset:0,data:new Uint8Array(new Float32Array([].concat((0,Jt.Z)(a),(0,Jt.Z)(s))).buffer)})}var y=n.rendererService.getViewportSize(),b=y.width,T=y.height,M=n.generateUBO(a,s,b,T),P=M.data,k=M.uniforms;n.layerService.alreadyInRendering&&l&&l.subData({offset:0,data:P}),t.models.forEach(function(H){H.addUniforms((0,W.Z)((0,W.Z)({},k),{},{u_PickingBuffer:t.getLayerConfig().pickingBuffer||0,u_shaderPick:Number(t.getShaderPickStat())}))})})}},{key:"setLayerCenter",value:function(t){t.coordCenter===void 0&&(t.coordCenter=t.getSource().center),this.mapService.setCoordCenter&&this.mapService.setCoordCenter(t.coordCenter)}},{key:"generateUBO",value:function(t,n,i,a){var s,l=this.cameraService.getProjectionMatrix(),f=this.cameraService.getViewMatrix(),d=this.cameraService.getViewProjectionMatrix(),y=this.cameraService.getModelMatrix(),b=this.coordinateSystemService.getViewportCenterProjection(),T=this.coordinateSystemService.getPixelsPerDegree(),M=this.cameraService.getZoom(),P=this.coordinateSystemService.getPixelsPerDegree2(),k=this.cameraService.getZoomScale(),H=this.coordinateSystemService.getPixelsPerMeter(),q=this.coordinateSystemService.getCoordinateSystem(),ae=this.cameraService.getCameraPosition(),Se=window.devicePixelRatio,ze=this.coordinateSystemService.getViewportCenter(),it=[i,a],ut=this.cameraService.getFocalDistance(),ot=[].concat((0,Jt.Z)(f),(0,Jt.Z)(l),(0,Jt.Z)(d),(0,Jt.Z)(y),(0,Jt.Z)(b),(0,Jt.Z)(T),[M],(0,Jt.Z)(P),[k],(0,Jt.Z)(H),[q],(0,Jt.Z)(ae),[Se],(0,Jt.Z)(ze),it,[ut,0,0,0]);return{data:ot,uniforms:(s={},(0,F.Z)(s,yd.ProjectionMatrix,l),(0,F.Z)(s,yd.ViewMatrix,f),(0,F.Z)(s,yd.ViewProjectionMatrix,d),(0,F.Z)(s,yd.Zoom,M),(0,F.Z)(s,yd.ZoomScale,k),(0,F.Z)(s,yd.FocalDistance,ut),(0,F.Z)(s,yd.CameraPosition,ae),(0,F.Z)(s,uc.CoordinateSystem,q),(0,F.Z)(s,uc.ViewportCenter,ze),(0,F.Z)(s,uc.ViewportCenterProjection,b),(0,F.Z)(s,uc.PixelsPerDegree,T),(0,F.Z)(s,uc.PixelsPerDegree2,P),(0,F.Z)(s,uc.PixelsPerMeter,H),(0,F.Z)(s,uc.Mvp,t),(0,F.Z)(s,"u_sceneCenterMercator",n),(0,F.Z)(s,"u_ViewportSize",it),(0,F.Z)(s,"u_ModelMatrix",y),(0,F.Z)(s,"u_DevicePixelRatio",Se),s)}}}]),e}(),sE=Pi(wd.prototype,"cameraService",[tE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),uE=Pi(wd.prototype,"coordinateSystemService",[rE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),lE=Pi(wd.prototype,"rendererService",[nE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),cE=Pi(wd.prototype,"mapService",[iE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),fE=Pi(wd.prototype,"layerService",[aE],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),wd))||oE),hE,pE,P5=(hE=(0,tr.b2)(),hE(pE=function(){function e(){(0,Q.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t){t.hooks.beforeRender.tap("UpdateModelPlugin",function(){t.layerModel&&t.layerModel.needUpdate().then(function(n){n&&t.renderLayers()})}),t.hooks.afterRender.tap("UpdateModelPlugin",function(){t.layerModelNeedUpdate=!1})}}]),e}())||pE),dE,vE,O5=(dE=(0,tr.b2)(),dE(vE=function(){function e(){(0,Q.Z)(this,e)}return(0,j.Z)(e,[{key:"apply",value:function(t,n){var i=this,a=n.styleAttributeService;t.hooks.init.tapPromise("UpdateStyleAttributePlugin",function(){i.initStyleAttribute(t,{styleAttributeService:a})}),t.hooks.beforeRender.tap("UpdateStyleAttributePlugin",function(){t.layerModelNeedUpdate||t.inited&&i.updateStyleAttribute(t,{styleAttributeService:a})})}},{key:"updateStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[],s=i.getLayerStyleAttribute("filter");if(s&&s.needRegenerateVertices){t.layerModelNeedUpdate=!0,a.forEach(function(l){return l.needRegenerateVertices=!1});return}a.filter(function(l){return l.needRegenerateVertices}).forEach(function(l){i.updateAttributeByFeatureRange(l.name,t.getEncodedData(),l.featureRange.startIndex,l.featureRange.endIndex,t),l.needRegenerateVertices=!1})}},{key:"initStyleAttribute",value:function(t,n){var i=n.styleAttributeService,a=i.getLayerStyleAttributes()||[];a.filter(function(s){return s.needRegenerateVertices}).forEach(function(s){i.updateAttributeByFeatureRange(s.name,t.getEncodedData(),s.featureRange.startIndex,s.featureRange.endIndex),s.needRegenerateVertices=!1})}}]),e}())||vE);Zl.bind(Je.ILayerPlugin).to(oI).inRequestScope(),Zl.bind(Je.ILayerPlugin).to(M5).inRequestScope(),Zl.bind(Je.ILayerPlugin).to(PO).inRequestScope(),Zl.bind(Je.ILayerPlugin).to(aI).inRequestScope(),Zl.bind(Je.ILayerPlugin).to(g5).inRequestScope(),Zl.bind(Je.ILayerPlugin).to(kO).inRequestScope(),Zl.bind(Je.ILayerPlugin).to(O5).inRequestScope(),Zl.bind(Je.ILayerPlugin).to(P5).inRequestScope(),Zl.bind(Je.ILayerPlugin).to(A5).inRequestScope(),Zl.bind(Je.ILayerPlugin).to(I5).inRequestScope(),Zl.bind(Je.ILayerPlugin).to(OO).inRequestScope(),Zl.bind(Je.ILayerPlugin).to(S5).inRequestScope(),Zl.bind(Je.ILayerPlugin).to(w5).inRequestScope(),Zl.bind(Je.ILayerPlugin).to(m5).inRequestScope();function tN(e){var r=k5();return function(){var n=_getPrototypeOf(e),i;if(r){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function k5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var rN=null;function D5(e){var r=L5();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function L5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var B5=function(e){(0,Le.Z)(t,e);var r=D5(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"zoomIn",function(){!n.disabled&&n.mapsService.getZoom()<n.mapsService.getMaxZoom()&&n.mapsService.zoomIn()}),(0,F.Z)((0,Re.Z)(n),"zoomOut",function(){!n.disabled&&n.mapsService.getZoom()>n.mapsService.getMinZoom()&&n.mapsService.zoomOut()}),(0,F.Z)((0,Re.Z)(n),"updateDisabled",function(){var l=n.mapsService;n.zoomInButton.removeAttribute("disabled"),n.zoomOutButton.removeAttribute("disabled"),(n.disabled||l.getZoom()<=l.getMinZoom())&&n.zoomOutButton.setAttribute("disabled","true"),n.controlOption.showZoom&&n.zoomNumDiv&&(n.zoomNumDiv.innerText=String(Math.floor(l.getZoom()))),(n.disabled||l.getZoom()>=l.getMaxZoom())&&n.zoomInButton.setAttribute("disabled","true")}),n}return(0,j.Z)(t,[{key:"getDefault",value:function(i){return(0,W.Z)((0,W.Z)({},Ra((0,Ee.Z)(t.prototype),"getDefault",this).call(this,i)),{},{position:Cr.BOTTOMRIGHT,name:"zoom",zoomInText:Xh("l7-icon-enlarge"),zoomInTitle:"Zoom in",zoomOutText:Xh("l7-icon-narrow"),zoomOutTitle:"Zoom out",showZoom:!1})}},{key:"setOptions",value:function(i){Ra((0,Ee.Z)(t.prototype),"setOptions",this).call(this,i),this.checkUpdateOption(i,["zoomInText","zoomInTitle","zoomOutText","zoomOutTitle","showZoom"])&&this.resetButtonGroup(this.container)}},{key:"onAdd",value:function(){var i=$i("div","l7-control-zoom");return this.resetButtonGroup(i),this.mapsService.on("zoomend",this.updateDisabled),this.mapsService.on("zoomchange",this.updateDisabled),i}},{key:"onRemove",value:function(){this.mapsService.off("zoomend",this.updateDisabled),this.mapsService.off("zoomchange",this.updateDisabled)}},{key:"disable",value:function(){return this.disabled=!0,this.updateDisabled(),this}},{key:"enable",value:function(){return this.disabled=!1,this.updateDisabled(),this}},{key:"resetButtonGroup",value:function(i){Ml(i),this.zoomInButton=this.createButton(this.controlOption.zoomInText,this.controlOption.zoomInTitle,"l7-button-control",i,this.zoomIn),this.controlOption.showZoom&&(this.zoomNumDiv=this.createButton("0","","l7-button-control l7-control-zoom__number",i)),this.zoomOutButton=this.createButton(this.controlOption.zoomOutText,this.controlOption.zoomOutTitle,"l7-button-control",i,this.zoomOut),this.updateDisabled()}},{key:"createButton",value:function(i,a,s,l,f){var d=$i("button",s,l);return typeof i=="string"?d.innerHTML=i:d.append(i),d.title=a,f&&d.addEventListener("click",f),d}}]),t}(fv);function F5(e){var r=N5();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function N5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var mE=function(e){(0,Le.Z)(t,e);var r=F5(t);function t(n){var i;(0,Q.Z)(this,t),i=r.call(this),(0,F.Z)((0,Re.Z)(i),"isShow",!0),(0,F.Z)((0,Re.Z)(i),"onMouseMove",function(s){var l,f=i.mapsService.getMapContainer(),d=(l=f==null?void 0:f.getBoundingClientRect())!==null&&l!==void 0?l:{},y=d.left,b=y===void 0?0:y,T=d.top,M=T===void 0?0:T;i.setPopupPosition(s.clientX-b,s.clientY-M)}),(0,F.Z)((0,Re.Z)(i),"updateLngLatPosition",function(){if(!(!i.mapsService||i.popupOption.followCursor)){var s=i.lngLat,l=s.lng,f=s.lat,d=i.mapsService.lngLatToContainer([l,f]),y=d.x,b=d.y;i.setPopupPosition(y,b)}}),(0,F.Z)((0,Re.Z)(i),"onKeyDown",function(s){s.keyCode===27&&i.remove()}),(0,F.Z)((0,Re.Z)(i),"onCloseButtonClick",function(s){s.stopPropagation&&s.stopPropagation(),i.hide()}),(0,F.Z)((0,Re.Z)(i),"update",function(){var s=!!i.lngLat,l=i.popupOption,f=l.className,d=l.style,y=l.maxWidth,b=l.anchor,T=l.stopPropagation;if(!(!i.mapsService||!s||!i.content)){var M=i.mapsService.getMarkerContainer();if(!i.container&&M&&(i.container=$i("div","l7-popup ".concat(f!=null?f:""," ").concat(i.isShow?"":"l7-popup-hide"),M),d&&i.container.setAttribute("style",d),i.tip=$i("div","l7-popup-tip",i.container),i.container.appendChild(i.content),T&&["mousemove","mousedown","mouseup","click","dblclick"].forEach(function(H){i.container.addEventListener(H,function(q){q.stopPropagation()})}),i.container.style.whiteSpace="nowrap"),i.updateLngLatPosition(),gu(i.container,"".concat(wa[b])),Gl(i.container,b,"popup"),y){var P=i.container.getBoundingClientRect(),k=P.width;k>parseFloat(y)&&(i.container.style.width=y)}else i.container.style.removeProperty("width")}}),i.popupOption=(0,W.Z)((0,W.Z)({},i.getDefault(n!=null?n:{})),n);var a=i.popupOption.lngLat;return a&&(i.lngLat=a),i}return(0,j.Z)(t,[{key:"lngLat",get:function(){var i;return(i=this.popupOption.lngLat)!==null&&i!==void 0?i:{lng:0,lat:0}},set:function(i){this.popupOption.lngLat=i}},{key:"getIsShow",value:function(){return this.isShow}},{key:"addTo",value:function(i){this.mapsService=i.get(Je.IMapService),this.sceneService=i.get(Je.ISceneService),this.layerService=i.get(Je.ILayerService),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update),this.scene=i,this.update(),this.updateCloseOnClick(),this.updateCloseOnEsc(),this.updateFollowCursor();var a=this.popupOption,s=a.html,l=a.text,f=a.title;return s?this.setHTML(s):l&&this.setText(l),f&&this.setTitle(f),this.emit("open"),this}},{key:"remove",value:function(){if(this!==null&&this!==void 0&&this.isOpen())return this.content&&Ci(this.content),this.container&&(Ci(this.container),delete this.container),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.updateCloseOnClick(!0),this.updateCloseOnEsc(!0),this.updateFollowCursor(!0),delete this.mapsService),this.emit("close"),this}},{key:"getOptions",value:function(){return this.popupOption}},{key:"setOptions",value:function(i){return this.show(),this.popupOption=(0,W.Z)((0,W.Z)({},this.popupOption),i),this.checkUpdateOption(i,["html","text","title","closeButton","closeButtonOffsets","maxWidth","anchor","stopPropagation","className","style","lngLat","offsets"])&&(this.container&&(Ci(this.container),this.container=void 0),this.popupOption.html?this.setHTML(this.popupOption.html):this.popupOption.text&&this.setText(this.popupOption.text),this.popupOption.title&&this.setTitle(this.popupOption.title)),this.checkUpdateOption(i,["closeOnEsc"])&&this.updateCloseOnEsc(),this.checkUpdateOption(i,["closeOnClick"])&&this.updateCloseOnClick(),this.checkUpdateOption(i,["followCursor"])&&this.updateFollowCursor(),this.checkUpdateOption(i,["html"])&&i.html?this.setHTML(i.html):this.checkUpdateOption(i,["text"])&&i.text&&this.setText(i.text),this.checkUpdateOption(i,["lngLat"])&&i.lngLat&&this.setLnglat(i.lngLat),this}},{key:"open",value:function(){return this.addTo(this.scene),this}},{key:"close",value:function(){return this.remove(),this}},{key:"show",value:function(){if(!this.isShow)return this.container&&mu(this.container,"l7-popup-hide"),this.isShow=!0,this.emit("show"),this}},{key:"hide",value:function(){if(this.isShow)return this.container&&ou(this.container,"l7-popup-hide"),this.isShow=!1,this.emit("hide"),this}},{key:"setHTML",value:function(i){return this.popupOption.html=i,this.setDOMContent(i)}},{key:"setText",value:function(i){return this.popupOption.text=i,this.setDOMContent(window.document.createTextNode(i))}},{key:"setTitle",value:function(i){this.show(),this.popupOption.title=i,i?(this.contentTitle||(this.contentTitle=$i("div","l7-popup-content__title"),this.content.firstChild?this.content.insertBefore(this.contentTitle,this.content.firstChild):this.content.append(this.contentTitle)),Ml(this.contentTitle),al(this.contentTitle,i)):this.contentTitle&&(Ci(this.contentTitle),this.contentTitle=void 0)}},{key:"panToPopup",value:function(){var i=this.lngLat,a=i.lng,s=i.lat;return this.popupOption.autoPan&&this.mapsService.panTo([a,s]),this}},{key:"setLngLat",value:function(i){return this.setLnglat(i)}},{key:"setLnglat",value:function(i){var a=this;return this.show(),this.lngLat=i,Array.isArray(i)&&(this.lngLat={lng:i[0],lat:i[1]}),this.mapsService&&(this.mapsService.off("camerachange",this.update),this.mapsService.off("viewchange",this.update),this.mapsService.on("camerachange",this.update),this.mapsService.on("viewchange",this.update)),this.update(),this.popupOption.autoPan&&setTimeout(function(){a.panToPopup()},0),this}},{key:"getLnglat",value:function(){return this.lngLat}},{key:"setMaxWidth",value:function(i){return this.popupOption.maxWidth=i,this.update(),this}},{key:"isOpen",value:function(){return!!this.mapsService}},{key:"getDefault",value:function(i){return{closeButton:!0,closeOnClick:!1,maxWidth:"240px",offsets:[0,0],anchor:ca.BOTTOM,stopPropagation:!0,autoPan:!1,autoClose:!0,closeOnEsc:!1,followCursor:!1}}},{key:"setDOMContent",value:function(i){return this.show(),this.createContent(),al(this.contentPanel,i),this.update(),this}},{key:"updateCloseOnClick",value:function(i){var a=this,s=this.mapsService;s&&(s==null||s.off("click",this.onCloseButtonClick),this.popupOption.closeOnClick&&!i&&requestAnimationFrame(function(){s==null||s.on("click",a.onCloseButtonClick)}))}},{key:"updateCloseOnEsc",value:function(i){window.removeEventListener("keydown",this.onKeyDown),this.popupOption.closeOnEsc&&!i&&window.addEventListener("keydown",this.onKeyDown)}},{key:"updateFollowCursor",value:function(i){var a,s=(a=this.mapsService)===null||a===void 0?void 0:a.getContainer();s&&(s==null||s.removeEventListener("mousemove",this.onMouseMove),this.popupOption.followCursor&&!i&&(s==null||s.addEventListener("mousemove",this.onMouseMove)))}},{key:"createContent",value:function(){var i=this;if(this.content&&Ci(this.content),this.contentTitle=void 0,this.content=$i("div","l7-popup-content",this.container),this.setTitle(this.popupOption.title),this.popupOption.closeButton){var a=Xh("l7-icon-guanbi");ou(a,"l7-popup-close-button"),this.content.appendChild(a),this.popupOption.closeButtonOffsets&&(a.style.right=this.popupOption.closeButtonOffsets[0]+"px",a.style.top=this.popupOption.closeButtonOffsets[1]+"px"),a.setAttribute("aria-label","Close popup"),a.addEventListener("click",function(){i.hide()}),a.addEventListener("pointerup",function(s){s.stopPropagation()}),a.addEventListener("pointerdown",function(s){s.stopPropagation()}),this.closeButton=a}else this.closeButton=void 0;this.contentPanel=$i("div","l7-popup-content__panel",this.content)}},{key:"setPopupPosition",value:function(i,a){if(this.container){var s=this.popupOption.offsets;this.container.style.left=i+s[0]+"px",this.container.style.top=a-s[1]+"px"}}},{key:"checkUpdateOption",value:function(i,a){return a.some(function(s){return s in i})}}]),t}(qa.EventEmitter);function nN(e){var r=U5();return function(){var n=_getPrototypeOf(e),i;if(r){var a=_getPrototypeOf(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return _possibleConstructorReturn(this,i)}}function U5(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var iN=ui.get,aN=null;function z5(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}z5(`.l7-marker-container {
  position: absolute;
  width: 100%;
  height: 100%;
  overflow: hidden;
}
.l7-marker {
  position: absolute !important;
  top: 0;
  left: 0;
  z-index: 5;
  cursor: pointer;
}
.l7-marker-cluster {
  width: 40px;
  height: 40px;
  background-color: rgba(181, 226, 140, 0.6);
  background-clip: padding-box;
  border-radius: 20px;
}
.l7-marker-cluster div {
  width: 30px;
  height: 30px;
  margin-top: 5px;
  margin-left: 5px;
  font: 12px 'Helvetica Neue', Arial, Helvetica, sans-serif;
  text-align: center;
  background-color: rgba(110, 204, 57, 0.6);
  border-radius: 15px;
}
.l7-marker-cluster span {
  line-height: 30px;
}
.l7-touch .l7-control-attribution,
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  -webkit-box-shadow: none;
          box-shadow: none;
}
.l7-touch .l7-control-layers,
.l7-touch .l7-bar {
  background-clip: padding-box;
  border: 2px solid rgba(0, 0, 0, 0.2);
}
.mapboxgl-ctrl-logo,
.amap-logo {
  display: none !important;
}
.l7-select-box {
  border: 3px dashed gray;
  border-radius: 2px;
  position: absolute;
  z-index: 999;
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
}
.l7-control-container {
  font: 12px/1.5 'Helvetica Neue', Arial, Helvetica, sans-serif;
}
.l7-control-container .l7-control {
  position: relative;
  z-index: 999;
  float: left;
  clear: both;
  color: #595959;
  font-size: 12px;
  pointer-events: visiblePainted;
  /* IE 9-10 doesn't have auto */
  pointer-events: auto;
}
.l7-control-container .l7-control.l7-control--hide {
  display: none;
}
.l7-control-container .l7-top {
  top: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-top .l7-control:not(.l7-control--hide) {
  margin-top: 8px;
}
.l7-control-container .l7-right {
  right: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-right .l7-control:not(.l7-control--hide) {
  margin-right: 8px;
}
.l7-control-container .l7-bottom {
  bottom: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-bottom .l7-control:not(.l7-control--hide) {
  margin-bottom: 8px;
}
.l7-control-container .l7-left {
  left: 0;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  position: absolute;
  z-index: 999;
  pointer-events: none;
}
.l7-control-container .l7-left .l7-control:not(.l7-control--hide) {
  margin-left: 8px;
}
.l7-control-container .l7-center {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
}
.l7-control-container .l7-center.l7-top,
.l7-control-container .l7-center.l7-bottom {
  width: 100%;
}
.l7-control-container .l7-center.l7-left,
.l7-control-container .l7-center.l7-right {
  height: 100%;
}
.l7-control-container .l7-center .l7-control {
  margin-right: 8px;
  margin-bottom: 8px;
}
.l7-control-container .l7-row {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-control-container .l7-row.l7-top {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-row.l7-bottom {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-control-container .l7-column {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-container .l7-column.l7-left {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-control-container .l7-column.l7-right {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-button-control {
  min-width: 28px;
  height: 28px;
  background-color: #fff;
  border-width: 0;
  border-radius: 2px;
  outline: 0;
  cursor: pointer;
  -webkit-transition: all 0.2s;
  transition: all 0.2s;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  padding: 0 6px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  line-height: 16px;
}
.l7-button-control .l7-iconfont {
  fill: #595959;
  color: #595959;
  width: 16px;
  height: 16px;
}
.l7-button-control.l7-button-control--row {
  padding: 0 16px 0 13px;
}
.l7-button-control.l7-button-control--row * + .l7-button-control__text {
  margin-left: 8px;
}
.l7-button-control.l7-button-control--column {
  height: 44px;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-button-control.l7-button-control--column .l7-iconfont {
  margin-top: 3px;
}
.l7-button-control.l7-button-control--column .l7-button-control__text {
  margin-top: 3px;
  font-size: 10px;
  -webkit-transform: scale(0.83333);
          transform: scale(0.83333);
}
.l7-button-control:not(:disabled):hover {
  background-color: #f3f3f3;
}
.l7-button-control:not(:disabled):active {
  background-color: #f3f3f3;
}
.l7-button-control:disabled {
  background-color: #fafafa;
  color: #bdbdbd;
  cursor: not-allowed;
}
.l7-button-control:disabled .l7-iconfont {
  fill: #bdbdbd;
  color: #bdbdbd;
}
.l7-button-control:disabled:hover {
  background-color: #fafafa;
}
.l7-button-control:disabled:active {
  background-color: #fafafa;
}
.l7-popper {
  position: absolute;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  z-index: 5;
  color: #595959;
}
.l7-popper.l7-popper-hide {
  display: none;
}
.l7-popper .l7-popper-content {
  min-height: 28px;
  background: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper .l7-popper-arrow {
  width: 0;
  height: 0;
  border-width: 4px;
  border-style: solid;
  border-top-color: transparent;
  border-bottom-color: transparent;
  border-left-color: transparent;
  border-right-color: transparent;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-popper.l7-popper-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popper.l7-popper-left .l7-popper-arrow {
  border-left-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popper.l7-popper-right .l7-popper-arrow {
  border-right-color: #fff;
  margin: 10px 0;
}
.l7-popper.l7-popper-top {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popper.l7-popper-top .l7-popper-arrow {
  border-top-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-bottom {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popper.l7-popper-bottom .l7-popper-arrow {
  border-bottom-color: #fff;
  margin: 0 10px;
}
.l7-popper.l7-popper-start {
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
}
.l7-popper.l7-popper-end {
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-select-control--normal {
  padding: 4px 0;
}
.l7-select-control--normal .l7-select-control-item {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  height: 24px;
  padding: 0 16px;
  font-size: 12px;
  line-height: 24px;
}
.l7-select-control--normal .l7-select-control-item > * + * {
  margin-left: 6px;
}
.l7-select-control--normal .l7-select-control-item input[type='checkbox'] {
  width: 14px;
  height: 14px;
}
.l7-select-control--normal .l7-select-control-item:hover {
  background-color: #f3f3f3;
}
.l7-select-control--image {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -ms-flex-wrap: wrap;
      flex-wrap: wrap;
  -webkit-box-align: start;
      -ms-flex-align: start;
          align-items: flex-start;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  max-width: 460px;
  max-height: 400px;
  margin: 12px 0 0 12px;
  overflow-x: hidden;
  overflow-y: auto;
}
.l7-select-control--image .l7-select-control-item {
  position: relative;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-flex: 0;
      -ms-flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
          flex: 0 0 calc((100% - (12px + 9px) * 2) / 3);
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  -webkit-box-sizing: content-box;
          box-sizing: content-box;
  margin-right: 12px;
  margin-bottom: 12px;
  overflow: hidden;
  font-size: 12px;
  border: 1px solid #fff;
  border-radius: 2px;
}
.l7-select-control--image .l7-select-control-item img {
  width: 100%;
  height: 80px;
}
.l7-select-control--image .l7-select-control-item input[type='checkbox'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item input[type='radio'] {
  position: absolute;
  top: 0;
  right: 0;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: center;
      -ms-flex-align: center;
          align-items: center;
  -webkit-box-pack: center;
      -ms-flex-pack: center;
          justify-content: center;
  line-height: 26px;
}
.l7-select-control--image .l7-select-control-item .l7-select-control-item-row > * + * {
  margin-left: 8px;
}
.l7-select-control--image .l7-select-control-item.l7-select-control-item-active {
  border-color: #0370fe;
}
.l7-select-control-item {
  cursor: pointer;
}
.l7-select-control-item input[type='checkbox'] {
  margin: 0;
  cursor: pointer;
}
.l7-select-control--multiple .l7-select-control-item:hover {
  background-color: transparent;
}
.l7-control-logo {
  width: 89px;
  height: 16px;
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
}
.l7-control-logo img {
  height: 100%;
  width: 100%;
}
.l7-control-logo .l7-control-logo-link {
  display: block;
  cursor: pointer;
}
.l7-control-logo .l7-control-logo-link img {
  cursor: pointer;
}
.l7-control-mouse-location {
  background-color: #fff;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
  padding: 2px 4px;
  min-width: 130px;
}
.l7-control-zoom {
  overflow: hidden;
  border-radius: 2px;
  -webkit-box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
          box-shadow: 0 0 20px 0 rgba(0, 0, 0, 0.15);
}
.l7-control-zoom .l7-button-control {
  font-size: 16px;
  border-bottom: 1px solid #f0f0f0;
  border-radius: 0;
  -webkit-box-shadow: 0 0 0;
          box-shadow: 0 0 0;
}
.l7-control-zoom .l7-button-control .l7-iconfont {
  width: 14px;
  height: 14px;
}
.l7-control-zoom .l7-button-control:last-child {
  border-bottom: 0;
}
.l7-control-zoom .l7-control-zoom__number {
  color: #595959;
  padding: 0;
}
.l7-control-zoom .l7-control-zoom__number:hover {
  background-color: #fff;
}
.l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-control-scale .l7-control-scale-line {
  -webkit-box-sizing: border-box;
          box-sizing: border-box;
  padding: 2px 5px 1px;
  overflow: hidden;
  color: #595959;
  font-size: 10px;
  line-height: 1.1;
  white-space: nowrap;
  background: #fff;
  border: 2px solid #000;
  border-top: 0;
  -webkit-transition: width 0.1s;
  transition: width 0.1s;
}
.l7-control-scale .l7-control-scale-line + .l7-control-scale .l7-control-scale-line {
  margin-top: -2px;
  border-top: 2px solid #777;
  border-bottom: none;
}
.l7-right .l7-control-scale {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  -webkit-box-align: end;
      -ms-flex-align: end;
          align-items: flex-end;
}
.l7-right .l7-control-scale .l7-control-scale-line {
  text-align: right;
}
.l7-popup {
  position: absolute;
  top: 0;
  left: 0;
  z-index: 5;
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
  will-change: transform;
  pointer-events: none;
}
.l7-popup.l7-popup-hide {
  display: none;
}
.l7-popup .l7-popup-content {
  position: relative;
  padding: 16px;
  font-size: 14px;
  background: #fff;
  border-radius: 3px;
  -webkit-box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
          box-shadow: 0 1px 2px rgba(0, 0, 0, 0.1);
}
.l7-popup .l7-popup-content .l7-popup-content__title {
  margin-bottom: 8px;
  font-weight: bold;
}
.l7-popup .l7-popup-content .l7-popup-close-button,
.l7-popup .l7-popup-content .l7-popup-content__title,
.l7-popup .l7-popup-content .l7-popup-content__panel {
  white-space: normal;
  -webkit-user-select: text;
     -moz-user-select: text;
      -ms-user-select: text;
          user-select: text;
  pointer-events: initial;
}
.l7-popup .l7-popup-content .l7-popup-close-button {
  position: absolute;
  top: 0;
  right: 0;
  width: 18px;
  height: 18px;
  padding: 0;
  font-size: 14px;
  line-height: 18px;
  text-align: center;
  background-color: transparent;
  border: 0;
  border-radius: 0 3px 0 0;
  cursor: pointer;
}
.l7-popup .l7-popup-tip {
  position: relative;
  z-index: 1;
  width: 0;
  height: 0;
  border: 10px solid transparent;
}
.l7-popup.l7-popup-anchor-bottom,
.l7-popup.l7-popup-anchor-bottom-left,
.l7-popup.l7-popup-anchor-bottom-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: reverse;
      -ms-flex-direction: column-reverse;
          flex-direction: column-reverse;
}
.l7-popup.l7-popup-anchor-bottom .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-bottom-right .l7-popup-tip {
  bottom: 1px;
}
.l7-popup.l7-popup-anchor-top,
.l7-popup.l7-popup-anchor-top-left,
.l7-popup.l7-popup-anchor-top-right {
  -webkit-box-orient: vertical;
  -webkit-box-direction: normal;
      -ms-flex-direction: column;
          flex-direction: column;
}
.l7-popup.l7-popup-anchor-top .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-left .l7-popup-tip,
.l7-popup.l7-popup-anchor-top-right .l7-popup-tip {
  top: 1px;
}
.l7-popup.l7-popup-anchor-left {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: normal;
      -ms-flex-direction: row;
          flex-direction: row;
}
.l7-popup.l7-popup-anchor-right {
  -webkit-box-orient: horizontal;
  -webkit-box-direction: reverse;
      -ms-flex-direction: row-reverse;
          flex-direction: row-reverse;
}
.l7-popup-anchor-top .l7-popup-tip {
  position: relative;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top: none;
  border-bottom-color: #fff;
  border-left: none;
}
.l7-popup-anchor-top-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top: none;
  border-right: none;
  border-bottom-color: #fff;
}
.l7-popup-anchor-bottom .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-top-color: #fff;
  border-bottom: none;
}
.l7-popup-anchor-bottom-left .l7-popup-tip {
  -webkit-align-self: flex-start;
  -ms-flex-item-align: start;
      align-self: flex-start;
  border-top-color: #fff;
  border-bottom: none;
  border-left: none;
}
.l7-popup-anchor-bottom-right .l7-popup-tip {
  -webkit-align-self: flex-end;
  -ms-flex-item-align: end;
      align-self: flex-end;
  border-top-color: #fff;
  border-right: none;
  border-bottom: none;
}
.l7-popup-anchor-left .l7-popup-tip {
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right-color: #fff;
  border-left: none;
}
.l7-popup-anchor-right .l7-popup-tip {
  right: 1px;
  -webkit-align-self: center;
  -ms-flex-item-align: center;
      align-self: center;
  border-right: none;
  border-left-color: #fff;
}
.l7-popup-anchor-top-left .l7-popup-content {
  border-top-left-radius: 0;
}
.l7-popup-anchor-top-right .l7-popup-content {
  border-top-right-radius: 0;
}
.l7-popup-anchor-bottom-left .l7-popup-content {
  border-bottom-left-radius: 0;
}
.l7-popup-anchor-bottom-right .l7-popup-content {
  border-bottom-right-radius: 0;
}
.l7-popup-track-pointer {
  display: none;
}
.l7-popup-track-pointer * {
  -webkit-user-select: none;
     -moz-user-select: none;
      -ms-user-select: none;
          user-select: none;
  pointer-events: none;
}
.l7-map:hover .l7-popup-track-pointer {
  display: -webkit-box;
  display: -ms-flexbox;
  display: flex;
}
.l7-map:active .l7-popup-track-pointer {
  display: none;
}
.l7-layer-popup__row {
  font-size: 12px;
}
.l7-layer-popup__row + .l7-layer-popup__row {
  margin-top: 4px;
}
.l7-control-swipe {
  position: absolute;
  top: 50%;
  left: 50%;
  z-index: 6;
  -webkit-transform: translate(-50%, -50%);
          transform: translate(-50%, -50%);
  -ms-touch-action: none;
      touch-action: none;
}
.l7-control-swipe_hide {
  display: none;
}
.l7-control-swipe:before {
  position: absolute;
  top: -5000px;
  bottom: -5000px;
  left: 50%;
  z-index: -1;
  width: 4px;
  background: #fff;
  -webkit-transform: translate(-2px, 0);
          transform: translate(-2px, 0);
  content: '';
}
.l7-control-swipe.horizontal:before {
  top: 50%;
  right: -5000px;
  bottom: auto;
  left: -5000px;
  width: auto;
  height: 4px;
}
.l7-control-swipe__button {
  display: block;
  width: 28px;
  height: 28px;
  margin: 0;
  padding: 0;
  color: #595959;
  font-weight: bold;
  font-size: inherit;
  text-align: center;
  text-decoration: none;
  background-color: #fff;
  border: none;
  border-radius: 2px;
  outline: none;
}
.l7-control-swipe,
.l7-control-swipe__button {
  cursor: ew-resize;
}
.l7-control-swipe.horizontal,
.l7-control-swipe.horizontal button {
  cursor: ns-resize;
}
.l7-control-swipe:after,
.l7-control-swipe__button:before,
.l7-control-swipe__button:after {
  position: absolute;
  top: 25%;
  bottom: 25%;
  left: 50%;
  width: 2px;
  background: currentColor;
  -webkit-transform: translate(-1px, 0);
          transform: translate(-1px, 0);
  content: '';
}
.l7-control-swipe__button:after {
  -webkit-transform: translateX(4px);
          transform: translateX(4px);
}
.l7-control-swipe__button:before {
  -webkit-transform: translateX(-6px);
          transform: translateX(-6px);
}
`);var Z5=U(79801),V5=U.n(Z5),j5=function(){function e(r,t){(0,Q.Z)(this,e);var n=t.buffer,i=t.offset,a=t.stride,s=t.normalized,l=t.size,f=t.divisor;this.buffer=n,this.attribute={buffer:n.get(),offset:i||0,stride:a||0,normalized:s||!1,divisor:f||0},l&&(this.attribute.size=l)}return(0,j.Z)(e,[{key:"get",value:function(){return this.attribute}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Yh,Lm,Op,Xc,Bm,kp,Fm,Jg,ih,Cd,Pu,ah,oh,e0,H5=(Yh={},(0,F.Z)(Yh,I.POINTS,"points"),(0,F.Z)(Yh,I.LINES,"lines"),(0,F.Z)(Yh,I.LINE_LOOP,"line loop"),(0,F.Z)(Yh,I.LINE_STRIP,"line strip"),(0,F.Z)(Yh,I.TRIANGLES,"triangles"),(0,F.Z)(Yh,I.TRIANGLE_FAN,"triangle fan"),(0,F.Z)(Yh,I.TRIANGLE_STRIP,"triangle strip"),Yh),gE=(Lm={},(0,F.Z)(Lm,I.STATIC_DRAW,"static"),(0,F.Z)(Lm,I.DYNAMIC_DRAW,"dynamic"),(0,F.Z)(Lm,I.STREAM_DRAW,"stream"),Lm),E_=(Op={},(0,F.Z)(Op,I.BYTE,"int8"),(0,F.Z)(Op,I.INT,"int32"),(0,F.Z)(Op,I.UNSIGNED_BYTE,"uint8"),(0,F.Z)(Op,I.UNSIGNED_SHORT,"uint16"),(0,F.Z)(Op,I.UNSIGNED_INT,"uint32"),(0,F.Z)(Op,I.FLOAT,"float"),Op),W5=(Xc={},(0,F.Z)(Xc,I.ALPHA,"alpha"),(0,F.Z)(Xc,I.LUMINANCE,"luminance"),(0,F.Z)(Xc,I.LUMINANCE_ALPHA,"luminance alpha"),(0,F.Z)(Xc,I.RGB,"rgb"),(0,F.Z)(Xc,I.RGBA,"rgba"),(0,F.Z)(Xc,I.RGBA4,"rgba4"),(0,F.Z)(Xc,I.RGB5_A1,"rgb5 a1"),(0,F.Z)(Xc,I.RGB565,"rgb565"),(0,F.Z)(Xc,I.DEPTH_COMPONENT,"depth"),(0,F.Z)(Xc,I.DEPTH_STENCIL,"depth stencil"),Xc),G5=(Bm={},(0,F.Z)(Bm,I.DONT_CARE,"dont care"),(0,F.Z)(Bm,I.NICEST,"nice"),(0,F.Z)(Bm,I.FASTEST,"fast"),Bm),_E=(kp={},(0,F.Z)(kp,I.NEAREST,"nearest"),(0,F.Z)(kp,I.LINEAR,"linear"),(0,F.Z)(kp,I.LINEAR_MIPMAP_LINEAR,"mipmap"),(0,F.Z)(kp,I.NEAREST_MIPMAP_LINEAR,"nearest mipmap linear"),(0,F.Z)(kp,I.LINEAR_MIPMAP_NEAREST,"linear mipmap nearest"),(0,F.Z)(kp,I.NEAREST_MIPMAP_NEAREST,"nearest mipmap nearest"),kp),yE=(Fm={},(0,F.Z)(Fm,I.REPEAT,"repeat"),(0,F.Z)(Fm,I.CLAMP_TO_EDGE,"clamp"),(0,F.Z)(Fm,I.MIRRORED_REPEAT,"mirror"),Fm),X5=(Jg={},(0,F.Z)(Jg,I.NONE,"none"),(0,F.Z)(Jg,I.BROWSER_DEFAULT_WEBGL,"browser"),Jg),$5=(ih={},(0,F.Z)(ih,I.NEVER,"never"),(0,F.Z)(ih,I.ALWAYS,"always"),(0,F.Z)(ih,I.LESS,"less"),(0,F.Z)(ih,I.LEQUAL,"lequal"),(0,F.Z)(ih,I.GREATER,"greater"),(0,F.Z)(ih,I.GEQUAL,"gequal"),(0,F.Z)(ih,I.EQUAL,"equal"),(0,F.Z)(ih,I.NOTEQUAL,"notequal"),ih),xE=(Cd={},(0,F.Z)(Cd,I.FUNC_ADD,"add"),(0,F.Z)(Cd,I.MIN_EXT,"min"),(0,F.Z)(Cd,I.MAX_EXT,"max"),(0,F.Z)(Cd,I.FUNC_SUBTRACT,"subtract"),(0,F.Z)(Cd,I.FUNC_REVERSE_SUBTRACT,"reverse subtract"),Cd),t0=(Pu={},(0,F.Z)(Pu,I.ZERO,"zero"),(0,F.Z)(Pu,I.ONE,"one"),(0,F.Z)(Pu,I.SRC_COLOR,"src color"),(0,F.Z)(Pu,I.ONE_MINUS_SRC_COLOR,"one minus src color"),(0,F.Z)(Pu,I.SRC_ALPHA,"src alpha"),(0,F.Z)(Pu,I.ONE_MINUS_SRC_ALPHA,"one minus src alpha"),(0,F.Z)(Pu,I.DST_COLOR,"dst color"),(0,F.Z)(Pu,I.ONE_MINUS_DST_COLOR,"one minus dst color"),(0,F.Z)(Pu,I.DST_ALPHA,"dst alpha"),(0,F.Z)(Pu,I.ONE_MINUS_DST_ALPHA,"one minus dst alpha"),(0,F.Z)(Pu,I.CONSTANT_COLOR,"constant color"),(0,F.Z)(Pu,I.ONE_MINUS_CONSTANT_COLOR,"one minus constant color"),(0,F.Z)(Pu,I.CONSTANT_ALPHA,"constant alpha"),(0,F.Z)(Pu,I.ONE_MINUS_CONSTANT_ALPHA,"one minus constant alpha"),(0,F.Z)(Pu,I.SRC_ALPHA_SATURATE,"src alpha saturate"),Pu),Y5=(ah={},(0,F.Z)(ah,I.NEVER,"never"),(0,F.Z)(ah,I.ALWAYS,"always"),(0,F.Z)(ah,I.LESS,"less"),(0,F.Z)(ah,I.LEQUAL,"lequal"),(0,F.Z)(ah,I.GREATER,"greater"),(0,F.Z)(ah,I.GEQUAL,"gequal"),(0,F.Z)(ah,I.EQUAL,"equal"),(0,F.Z)(ah,I.NOTEQUAL,"notequal"),ah),Ev=(oh={},(0,F.Z)(oh,I.ZERO,"zero"),(0,F.Z)(oh,I.KEEP,"keep"),(0,F.Z)(oh,I.REPLACE,"replace"),(0,F.Z)(oh,I.INVERT,"invert"),(0,F.Z)(oh,I.INCR,"increment"),(0,F.Z)(oh,I.DECR,"decrement"),(0,F.Z)(oh,I.INCR_WRAP,"increment wrap"),(0,F.Z)(oh,I.DECR_WRAP,"decrement wrap"),oh),q5=(e0={},(0,F.Z)(e0,I.FRONT,"front"),(0,F.Z)(e0,I.BACK,"back"),e0),K5=function(){function e(r,t){(0,Q.Z)(this,e),(0,F.Z)(this,"isDestroyed",!1);var n=t.data,i=t.usage,a=t.type;this.buffer=r.buffer({data:n,usage:gE[i||I.STATIC_DRAW],type:E_[a||I.UNSIGNED_BYTE]})}return(0,j.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset;this.buffer.subdata(n,i)}}]),e}(),Q5=function(){function e(r,t){(0,Q.Z)(this,e);var n=t.data,i=t.usage,a=t.type,s=t.count;this.elements=r.elements({data:n,usage:gE[i||I.STATIC_DRAW],type:E_[a||I.UNSIGNED_BYTE],count:s})}return(0,j.Z)(e,[{key:"get",value:function(){return this.elements}},{key:"subData",value:function(t){var n=t.data;this.elements.subdata(n)}},{key:"destroy",value:function(){}}]),e}(),J5=function(){function e(r,t){(0,Q.Z)(this,e);var n=t.width,i=t.height,a=t.color,s=t.colors,l={width:n,height:i};Array.isArray(s)&&(l.colors=s.map(function(f){return f.get()})),a&&typeof a!="boolean"&&(l.color=a.get()),this.framebuffer=r.framebuffer(l)}return(0,j.Z)(e,[{key:"get",value:function(){return this.framebuffer}},{key:"destroy",value:function(){this.framebuffer.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.framebuffer.resize(n,i)}}]),e}(),Sv=U(39696),Dp=U(58622),e4=U(39083),In=U(99938),bE=U(73983),Xe;(function(e){e[e.DEPTH_BUFFER_BIT=256]="DEPTH_BUFFER_BIT",e[e.STENCIL_BUFFER_BIT=1024]="STENCIL_BUFFER_BIT",e[e.COLOR_BUFFER_BIT=16384]="COLOR_BUFFER_BIT",e[e.POINTS=0]="POINTS",e[e.LINES=1]="LINES",e[e.LINE_LOOP=2]="LINE_LOOP",e[e.LINE_STRIP=3]="LINE_STRIP",e[e.TRIANGLES=4]="TRIANGLES",e[e.TRIANGLE_STRIP=5]="TRIANGLE_STRIP",e[e.TRIANGLE_FAN=6]="TRIANGLE_FAN",e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC_COLOR=768]="SRC_COLOR",e[e.ONE_MINUS_SRC_COLOR=769]="ONE_MINUS_SRC_COLOR",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.DST_COLOR=774]="DST_COLOR",e[e.ONE_MINUS_DST_COLOR=775]="ONE_MINUS_DST_COLOR",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE",e[e.CONSTANT_COLOR=32769]="CONSTANT_COLOR",e[e.ONE_MINUS_CONSTANT_COLOR=32770]="ONE_MINUS_CONSTANT_COLOR",e[e.CONSTANT_ALPHA=32771]="CONSTANT_ALPHA",e[e.ONE_MINUS_CONSTANT_ALPHA=32772]="ONE_MINUS_CONSTANT_ALPHA",e[e.FUNC_ADD=32774]="FUNC_ADD",e[e.FUNC_SUBTRACT=32778]="FUNC_SUBTRACT",e[e.FUNC_REVERSE_SUBTRACT=32779]="FUNC_REVERSE_SUBTRACT",e[e.BLEND_EQUATION=32777]="BLEND_EQUATION",e[e.BLEND_EQUATION_RGB=32777]="BLEND_EQUATION_RGB",e[e.BLEND_EQUATION_ALPHA=34877]="BLEND_EQUATION_ALPHA",e[e.BLEND_DST_RGB=32968]="BLEND_DST_RGB",e[e.BLEND_SRC_RGB=32969]="BLEND_SRC_RGB",e[e.BLEND_DST_ALPHA=32970]="BLEND_DST_ALPHA",e[e.BLEND_SRC_ALPHA=32971]="BLEND_SRC_ALPHA",e[e.BLEND_COLOR=32773]="BLEND_COLOR",e[e.ARRAY_BUFFER_BINDING=34964]="ARRAY_BUFFER_BINDING",e[e.ELEMENT_ARRAY_BUFFER_BINDING=34965]="ELEMENT_ARRAY_BUFFER_BINDING",e[e.LINE_WIDTH=2849]="LINE_WIDTH",e[e.ALIASED_POINT_SIZE_RANGE=33901]="ALIASED_POINT_SIZE_RANGE",e[e.ALIASED_LINE_WIDTH_RANGE=33902]="ALIASED_LINE_WIDTH_RANGE",e[e.CULL_FACE_MODE=2885]="CULL_FACE_MODE",e[e.FRONT_FACE=2886]="FRONT_FACE",e[e.DEPTH_RANGE=2928]="DEPTH_RANGE",e[e.DEPTH_WRITEMASK=2930]="DEPTH_WRITEMASK",e[e.DEPTH_CLEAR_VALUE=2931]="DEPTH_CLEAR_VALUE",e[e.DEPTH_FUNC=2932]="DEPTH_FUNC",e[e.STENCIL_CLEAR_VALUE=2961]="STENCIL_CLEAR_VALUE",e[e.STENCIL_FUNC=2962]="STENCIL_FUNC",e[e.STENCIL_FAIL=2964]="STENCIL_FAIL",e[e.STENCIL_PASS_DEPTH_FAIL=2965]="STENCIL_PASS_DEPTH_FAIL",e[e.STENCIL_PASS_DEPTH_PASS=2966]="STENCIL_PASS_DEPTH_PASS",e[e.STENCIL_REF=2967]="STENCIL_REF",e[e.STENCIL_VALUE_MASK=2963]="STENCIL_VALUE_MASK",e[e.STENCIL_WRITEMASK=2968]="STENCIL_WRITEMASK",e[e.STENCIL_BACK_FUNC=34816]="STENCIL_BACK_FUNC",e[e.STENCIL_BACK_FAIL=34817]="STENCIL_BACK_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_FAIL=34818]="STENCIL_BACK_PASS_DEPTH_FAIL",e[e.STENCIL_BACK_PASS_DEPTH_PASS=34819]="STENCIL_BACK_PASS_DEPTH_PASS",e[e.STENCIL_BACK_REF=36003]="STENCIL_BACK_REF",e[e.STENCIL_BACK_VALUE_MASK=36004]="STENCIL_BACK_VALUE_MASK",e[e.STENCIL_BACK_WRITEMASK=36005]="STENCIL_BACK_WRITEMASK",e[e.VIEWPORT=2978]="VIEWPORT",e[e.SCISSOR_BOX=3088]="SCISSOR_BOX",e[e.COLOR_CLEAR_VALUE=3106]="COLOR_CLEAR_VALUE",e[e.COLOR_WRITEMASK=3107]="COLOR_WRITEMASK",e[e.UNPACK_ALIGNMENT=3317]="UNPACK_ALIGNMENT",e[e.PACK_ALIGNMENT=3333]="PACK_ALIGNMENT",e[e.MAX_TEXTURE_SIZE=3379]="MAX_TEXTURE_SIZE",e[e.MAX_VIEWPORT_DIMS=3386]="MAX_VIEWPORT_DIMS",e[e.SUBPIXEL_BITS=3408]="SUBPIXEL_BITS",e[e.RED_BITS=3410]="RED_BITS",e[e.GREEN_BITS=3411]="GREEN_BITS",e[e.BLUE_BITS=3412]="BLUE_BITS",e[e.ALPHA_BITS=3413]="ALPHA_BITS",e[e.DEPTH_BITS=3414]="DEPTH_BITS",e[e.STENCIL_BITS=3415]="STENCIL_BITS",e[e.POLYGON_OFFSET_UNITS=10752]="POLYGON_OFFSET_UNITS",e[e.POLYGON_OFFSET_FACTOR=32824]="POLYGON_OFFSET_FACTOR",e[e.TEXTURE_BINDING_2D=32873]="TEXTURE_BINDING_2D",e[e.SAMPLE_BUFFERS=32936]="SAMPLE_BUFFERS",e[e.SAMPLES=32937]="SAMPLES",e[e.SAMPLE_COVERAGE_VALUE=32938]="SAMPLE_COVERAGE_VALUE",e[e.SAMPLE_COVERAGE_INVERT=32939]="SAMPLE_COVERAGE_INVERT",e[e.COMPRESSED_TEXTURE_FORMATS=34467]="COMPRESSED_TEXTURE_FORMATS",e[e.VENDOR=7936]="VENDOR",e[e.RENDERER=7937]="RENDERER",e[e.VERSION=7938]="VERSION",e[e.IMPLEMENTATION_COLOR_READ_TYPE=35738]="IMPLEMENTATION_COLOR_READ_TYPE",e[e.IMPLEMENTATION_COLOR_READ_FORMAT=35739]="IMPLEMENTATION_COLOR_READ_FORMAT",e[e.BROWSER_DEFAULT_WEBGL=37444]="BROWSER_DEFAULT_WEBGL",e[e.STATIC_DRAW=35044]="STATIC_DRAW",e[e.STREAM_DRAW=35040]="STREAM_DRAW",e[e.DYNAMIC_DRAW=35048]="DYNAMIC_DRAW",e[e.ARRAY_BUFFER=34962]="ARRAY_BUFFER",e[e.ELEMENT_ARRAY_BUFFER=34963]="ELEMENT_ARRAY_BUFFER",e[e.BUFFER_SIZE=34660]="BUFFER_SIZE",e[e.BUFFER_USAGE=34661]="BUFFER_USAGE",e[e.CURRENT_VERTEX_ATTRIB=34342]="CURRENT_VERTEX_ATTRIB",e[e.VERTEX_ATTRIB_ARRAY_ENABLED=34338]="VERTEX_ATTRIB_ARRAY_ENABLED",e[e.VERTEX_ATTRIB_ARRAY_SIZE=34339]="VERTEX_ATTRIB_ARRAY_SIZE",e[e.VERTEX_ATTRIB_ARRAY_STRIDE=34340]="VERTEX_ATTRIB_ARRAY_STRIDE",e[e.VERTEX_ATTRIB_ARRAY_TYPE=34341]="VERTEX_ATTRIB_ARRAY_TYPE",e[e.VERTEX_ATTRIB_ARRAY_NORMALIZED=34922]="VERTEX_ATTRIB_ARRAY_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_POINTER=34373]="VERTEX_ATTRIB_ARRAY_POINTER",e[e.VERTEX_ATTRIB_ARRAY_BUFFER_BINDING=34975]="VERTEX_ATTRIB_ARRAY_BUFFER_BINDING",e[e.CULL_FACE=2884]="CULL_FACE",e[e.FRONT=1028]="FRONT",e[e.BACK=1029]="BACK",e[e.FRONT_AND_BACK=1032]="FRONT_AND_BACK",e[e.BLEND=3042]="BLEND",e[e.DEPTH_TEST=2929]="DEPTH_TEST",e[e.DITHER=3024]="DITHER",e[e.POLYGON_OFFSET_FILL=32823]="POLYGON_OFFSET_FILL",e[e.SAMPLE_ALPHA_TO_COVERAGE=32926]="SAMPLE_ALPHA_TO_COVERAGE",e[e.SAMPLE_COVERAGE=32928]="SAMPLE_COVERAGE",e[e.SCISSOR_TEST=3089]="SCISSOR_TEST",e[e.STENCIL_TEST=2960]="STENCIL_TEST",e[e.NO_ERROR=0]="NO_ERROR",e[e.INVALID_ENUM=1280]="INVALID_ENUM",e[e.INVALID_VALUE=1281]="INVALID_VALUE",e[e.INVALID_OPERATION=1282]="INVALID_OPERATION",e[e.OUT_OF_MEMORY=1285]="OUT_OF_MEMORY",e[e.CONTEXT_LOST_WEBGL=37442]="CONTEXT_LOST_WEBGL",e[e.CW=2304]="CW",e[e.CCW=2305]="CCW",e[e.DONT_CARE=4352]="DONT_CARE",e[e.FASTEST=4353]="FASTEST",e[e.NICEST=4354]="NICEST",e[e.GENERATE_MIPMAP_HINT=33170]="GENERATE_MIPMAP_HINT",e[e.BYTE=5120]="BYTE",e[e.UNSIGNED_BYTE=5121]="UNSIGNED_BYTE",e[e.SHORT=5122]="SHORT",e[e.UNSIGNED_SHORT=5123]="UNSIGNED_SHORT",e[e.INT=5124]="INT",e[e.UNSIGNED_INT=5125]="UNSIGNED_INT",e[e.FLOAT=5126]="FLOAT",e[e.DOUBLE=5130]="DOUBLE",e[e.DEPTH_COMPONENT=6402]="DEPTH_COMPONENT",e[e.ALPHA=6406]="ALPHA",e[e.RGB=6407]="RGB",e[e.RGBA=6408]="RGBA",e[e.LUMINANCE=6409]="LUMINANCE",e[e.LUMINANCE_ALPHA=6410]="LUMINANCE_ALPHA",e[e.UNSIGNED_SHORT_4_4_4_4=32819]="UNSIGNED_SHORT_4_4_4_4",e[e.UNSIGNED_SHORT_5_5_5_1=32820]="UNSIGNED_SHORT_5_5_5_1",e[e.UNSIGNED_SHORT_5_6_5=33635]="UNSIGNED_SHORT_5_6_5",e[e.FRAGMENT_SHADER=35632]="FRAGMENT_SHADER",e[e.VERTEX_SHADER=35633]="VERTEX_SHADER",e[e.COMPILE_STATUS=35713]="COMPILE_STATUS",e[e.DELETE_STATUS=35712]="DELETE_STATUS",e[e.LINK_STATUS=35714]="LINK_STATUS",e[e.VALIDATE_STATUS=35715]="VALIDATE_STATUS",e[e.ATTACHED_SHADERS=35717]="ATTACHED_SHADERS",e[e.ACTIVE_ATTRIBUTES=35721]="ACTIVE_ATTRIBUTES",e[e.ACTIVE_UNIFORMS=35718]="ACTIVE_UNIFORMS",e[e.MAX_VERTEX_ATTRIBS=34921]="MAX_VERTEX_ATTRIBS",e[e.MAX_VERTEX_UNIFORM_VECTORS=36347]="MAX_VERTEX_UNIFORM_VECTORS",e[e.MAX_VARYING_VECTORS=36348]="MAX_VARYING_VECTORS",e[e.MAX_COMBINED_TEXTURE_IMAGE_UNITS=35661]="MAX_COMBINED_TEXTURE_IMAGE_UNITS",e[e.MAX_VERTEX_TEXTURE_IMAGE_UNITS=35660]="MAX_VERTEX_TEXTURE_IMAGE_UNITS",e[e.MAX_TEXTURE_IMAGE_UNITS=34930]="MAX_TEXTURE_IMAGE_UNITS",e[e.MAX_FRAGMENT_UNIFORM_VECTORS=36349]="MAX_FRAGMENT_UNIFORM_VECTORS",e[e.SHADER_TYPE=35663]="SHADER_TYPE",e[e.SHADING_LANGUAGE_VERSION=35724]="SHADING_LANGUAGE_VERSION",e[e.CURRENT_PROGRAM=35725]="CURRENT_PROGRAM",e[e.NEVER=512]="NEVER",e[e.ALWAYS=519]="ALWAYS",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.GEQUAL=518]="GEQUAL",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.KEEP=7680]="KEEP",e[e.REPLACE=7681]="REPLACE",e[e.INCR=7682]="INCR",e[e.DECR=7683]="DECR",e[e.INVERT=5386]="INVERT",e[e.INCR_WRAP=34055]="INCR_WRAP",e[e.DECR_WRAP=34056]="DECR_WRAP",e[e.NEAREST=9728]="NEAREST",e[e.LINEAR=9729]="LINEAR",e[e.NEAREST_MIPMAP_NEAREST=9984]="NEAREST_MIPMAP_NEAREST",e[e.LINEAR_MIPMAP_NEAREST=9985]="LINEAR_MIPMAP_NEAREST",e[e.NEAREST_MIPMAP_LINEAR=9986]="NEAREST_MIPMAP_LINEAR",e[e.LINEAR_MIPMAP_LINEAR=9987]="LINEAR_MIPMAP_LINEAR",e[e.TEXTURE_MAG_FILTER=10240]="TEXTURE_MAG_FILTER",e[e.TEXTURE_MIN_FILTER=10241]="TEXTURE_MIN_FILTER",e[e.TEXTURE_WRAP_S=10242]="TEXTURE_WRAP_S",e[e.TEXTURE_WRAP_T=10243]="TEXTURE_WRAP_T",e[e.TEXTURE_2D=3553]="TEXTURE_2D",e[e.TEXTURE=5890]="TEXTURE",e[e.TEXTURE_CUBE_MAP=34067]="TEXTURE_CUBE_MAP",e[e.TEXTURE_BINDING_CUBE_MAP=34068]="TEXTURE_BINDING_CUBE_MAP",e[e.TEXTURE_CUBE_MAP_POSITIVE_X=34069]="TEXTURE_CUBE_MAP_POSITIVE_X",e[e.TEXTURE_CUBE_MAP_NEGATIVE_X=34070]="TEXTURE_CUBE_MAP_NEGATIVE_X",e[e.TEXTURE_CUBE_MAP_POSITIVE_Y=34071]="TEXTURE_CUBE_MAP_POSITIVE_Y",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Y=34072]="TEXTURE_CUBE_MAP_NEGATIVE_Y",e[e.TEXTURE_CUBE_MAP_POSITIVE_Z=34073]="TEXTURE_CUBE_MAP_POSITIVE_Z",e[e.TEXTURE_CUBE_MAP_NEGATIVE_Z=34074]="TEXTURE_CUBE_MAP_NEGATIVE_Z",e[e.MAX_CUBE_MAP_TEXTURE_SIZE=34076]="MAX_CUBE_MAP_TEXTURE_SIZE",e[e.TEXTURE0=33984]="TEXTURE0",e[e.ACTIVE_TEXTURE=34016]="ACTIVE_TEXTURE",e[e.REPEAT=10497]="REPEAT",e[e.CLAMP_TO_EDGE=33071]="CLAMP_TO_EDGE",e[e.MIRRORED_REPEAT=33648]="MIRRORED_REPEAT",e[e.TEXTURE_WIDTH=4096]="TEXTURE_WIDTH",e[e.TEXTURE_HEIGHT=4097]="TEXTURE_HEIGHT",e[e.FLOAT_VEC2=35664]="FLOAT_VEC2",e[e.FLOAT_VEC3=35665]="FLOAT_VEC3",e[e.FLOAT_VEC4=35666]="FLOAT_VEC4",e[e.INT_VEC2=35667]="INT_VEC2",e[e.INT_VEC3=35668]="INT_VEC3",e[e.INT_VEC4=35669]="INT_VEC4",e[e.BOOL=35670]="BOOL",e[e.BOOL_VEC2=35671]="BOOL_VEC2",e[e.BOOL_VEC3=35672]="BOOL_VEC3",e[e.BOOL_VEC4=35673]="BOOL_VEC4",e[e.FLOAT_MAT2=35674]="FLOAT_MAT2",e[e.FLOAT_MAT3=35675]="FLOAT_MAT3",e[e.FLOAT_MAT4=35676]="FLOAT_MAT4",e[e.SAMPLER_2D=35678]="SAMPLER_2D",e[e.SAMPLER_CUBE=35680]="SAMPLER_CUBE",e[e.LOW_FLOAT=36336]="LOW_FLOAT",e[e.MEDIUM_FLOAT=36337]="MEDIUM_FLOAT",e[e.HIGH_FLOAT=36338]="HIGH_FLOAT",e[e.LOW_INT=36339]="LOW_INT",e[e.MEDIUM_INT=36340]="MEDIUM_INT",e[e.HIGH_INT=36341]="HIGH_INT",e[e.FRAMEBUFFER=36160]="FRAMEBUFFER",e[e.RENDERBUFFER=36161]="RENDERBUFFER",e[e.RGBA4=32854]="RGBA4",e[e.RGB5_A1=32855]="RGB5_A1",e[e.RGB565=36194]="RGB565",e[e.DEPTH_COMPONENT16=33189]="DEPTH_COMPONENT16",e[e.STENCIL_INDEX=6401]="STENCIL_INDEX",e[e.STENCIL_INDEX8=36168]="STENCIL_INDEX8",e[e.DEPTH_STENCIL=34041]="DEPTH_STENCIL",e[e.RENDERBUFFER_WIDTH=36162]="RENDERBUFFER_WIDTH",e[e.RENDERBUFFER_HEIGHT=36163]="RENDERBUFFER_HEIGHT",e[e.RENDERBUFFER_INTERNAL_FORMAT=36164]="RENDERBUFFER_INTERNAL_FORMAT",e[e.RENDERBUFFER_RED_SIZE=36176]="RENDERBUFFER_RED_SIZE",e[e.RENDERBUFFER_GREEN_SIZE=36177]="RENDERBUFFER_GREEN_SIZE",e[e.RENDERBUFFER_BLUE_SIZE=36178]="RENDERBUFFER_BLUE_SIZE",e[e.RENDERBUFFER_ALPHA_SIZE=36179]="RENDERBUFFER_ALPHA_SIZE",e[e.RENDERBUFFER_DEPTH_SIZE=36180]="RENDERBUFFER_DEPTH_SIZE",e[e.RENDERBUFFER_STENCIL_SIZE=36181]="RENDERBUFFER_STENCIL_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE=36048]="FRAMEBUFFER_ATTACHMENT_OBJECT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_OBJECT_NAME=36049]="FRAMEBUFFER_ATTACHMENT_OBJECT_NAME",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL=36050]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LEVEL",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE=36051]="FRAMEBUFFER_ATTACHMENT_TEXTURE_CUBE_MAP_FACE",e[e.COLOR_ATTACHMENT0=36064]="COLOR_ATTACHMENT0",e[e.DEPTH_ATTACHMENT=36096]="DEPTH_ATTACHMENT",e[e.STENCIL_ATTACHMENT=36128]="STENCIL_ATTACHMENT",e[e.DEPTH_STENCIL_ATTACHMENT=33306]="DEPTH_STENCIL_ATTACHMENT",e[e.NONE=0]="NONE",e[e.FRAMEBUFFER_COMPLETE=36053]="FRAMEBUFFER_COMPLETE",e[e.FRAMEBUFFER_INCOMPLETE_ATTACHMENT=36054]="FRAMEBUFFER_INCOMPLETE_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT=36055]="FRAMEBUFFER_INCOMPLETE_MISSING_ATTACHMENT",e[e.FRAMEBUFFER_INCOMPLETE_DIMENSIONS=36057]="FRAMEBUFFER_INCOMPLETE_DIMENSIONS",e[e.FRAMEBUFFER_UNSUPPORTED=36061]="FRAMEBUFFER_UNSUPPORTED",e[e.FRAMEBUFFER_BINDING=36006]="FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_BINDING=36007]="RENDERBUFFER_BINDING",e[e.READ_FRAMEBUFFER=36008]="READ_FRAMEBUFFER",e[e.DRAW_FRAMEBUFFER=36009]="DRAW_FRAMEBUFFER",e[e.MAX_RENDERBUFFER_SIZE=34024]="MAX_RENDERBUFFER_SIZE",e[e.INVALID_FRAMEBUFFER_OPERATION=1286]="INVALID_FRAMEBUFFER_OPERATION",e[e.UNPACK_FLIP_Y_WEBGL=37440]="UNPACK_FLIP_Y_WEBGL",e[e.UNPACK_PREMULTIPLY_ALPHA_WEBGL=37441]="UNPACK_PREMULTIPLY_ALPHA_WEBGL",e[e.UNPACK_COLORSPACE_CONVERSION_WEBGL=37443]="UNPACK_COLORSPACE_CONVERSION_WEBGL",e[e.READ_BUFFER=3074]="READ_BUFFER",e[e.UNPACK_ROW_LENGTH=3314]="UNPACK_ROW_LENGTH",e[e.UNPACK_SKIP_ROWS=3315]="UNPACK_SKIP_ROWS",e[e.UNPACK_SKIP_PIXELS=3316]="UNPACK_SKIP_PIXELS",e[e.PACK_ROW_LENGTH=3330]="PACK_ROW_LENGTH",e[e.PACK_SKIP_ROWS=3331]="PACK_SKIP_ROWS",e[e.PACK_SKIP_PIXELS=3332]="PACK_SKIP_PIXELS",e[e.TEXTURE_BINDING_3D=32874]="TEXTURE_BINDING_3D",e[e.UNPACK_SKIP_IMAGES=32877]="UNPACK_SKIP_IMAGES",e[e.UNPACK_IMAGE_HEIGHT=32878]="UNPACK_IMAGE_HEIGHT",e[e.MAX_3D_TEXTURE_SIZE=32883]="MAX_3D_TEXTURE_SIZE",e[e.MAX_ELEMENTS_VERTICES=33e3]="MAX_ELEMENTS_VERTICES",e[e.MAX_ELEMENTS_INDICES=33001]="MAX_ELEMENTS_INDICES",e[e.MAX_TEXTURE_LOD_BIAS=34045]="MAX_TEXTURE_LOD_BIAS",e[e.MAX_FRAGMENT_UNIFORM_COMPONENTS=35657]="MAX_FRAGMENT_UNIFORM_COMPONENTS",e[e.MAX_VERTEX_UNIFORM_COMPONENTS=35658]="MAX_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_ARRAY_TEXTURE_LAYERS=35071]="MAX_ARRAY_TEXTURE_LAYERS",e[e.MIN_PROGRAM_TEXEL_OFFSET=35076]="MIN_PROGRAM_TEXEL_OFFSET",e[e.MAX_PROGRAM_TEXEL_OFFSET=35077]="MAX_PROGRAM_TEXEL_OFFSET",e[e.MAX_VARYING_COMPONENTS=35659]="MAX_VARYING_COMPONENTS",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT",e[e.RASTERIZER_DISCARD=35977]="RASTERIZER_DISCARD",e[e.VERTEX_ARRAY_BINDING=34229]="VERTEX_ARRAY_BINDING",e[e.MAX_VERTEX_OUTPUT_COMPONENTS=37154]="MAX_VERTEX_OUTPUT_COMPONENTS",e[e.MAX_FRAGMENT_INPUT_COMPONENTS=37157]="MAX_FRAGMENT_INPUT_COMPONENTS",e[e.MAX_SERVER_WAIT_TIMEOUT=37137]="MAX_SERVER_WAIT_TIMEOUT",e[e.MAX_ELEMENT_INDEX=36203]="MAX_ELEMENT_INDEX",e[e.RED=6403]="RED",e[e.RGB8=32849]="RGB8",e[e.RGBA8=32856]="RGBA8",e[e.RGB10_A2=32857]="RGB10_A2",e[e.TEXTURE_3D=32879]="TEXTURE_3D",e[e.TEXTURE_WRAP_R=32882]="TEXTURE_WRAP_R",e[e.TEXTURE_MIN_LOD=33082]="TEXTURE_MIN_LOD",e[e.TEXTURE_MAX_LOD=33083]="TEXTURE_MAX_LOD",e[e.TEXTURE_BASE_LEVEL=33084]="TEXTURE_BASE_LEVEL",e[e.TEXTURE_MAX_LEVEL=33085]="TEXTURE_MAX_LEVEL",e[e.TEXTURE_COMPARE_MODE=34892]="TEXTURE_COMPARE_MODE",e[e.TEXTURE_COMPARE_FUNC=34893]="TEXTURE_COMPARE_FUNC",e[e.SRGB=35904]="SRGB",e[e.SRGB8=35905]="SRGB8",e[e.SRGB8_ALPHA8=35907]="SRGB8_ALPHA8",e[e.COMPARE_REF_TO_TEXTURE=34894]="COMPARE_REF_TO_TEXTURE",e[e.RGBA32F=34836]="RGBA32F",e[e.RGB32F=34837]="RGB32F",e[e.RGBA16F=34842]="RGBA16F",e[e.RGB16F=34843]="RGB16F",e[e.TEXTURE_2D_ARRAY=35866]="TEXTURE_2D_ARRAY",e[e.TEXTURE_BINDING_2D_ARRAY=35869]="TEXTURE_BINDING_2D_ARRAY",e[e.R11F_G11F_B10F=35898]="R11F_G11F_B10F",e[e.RGB9_E5=35901]="RGB9_E5",e[e.RGBA32UI=36208]="RGBA32UI",e[e.RGB32UI=36209]="RGB32UI",e[e.RGBA16UI=36214]="RGBA16UI",e[e.RGB16UI=36215]="RGB16UI",e[e.RGBA8UI=36220]="RGBA8UI",e[e.RGB8UI=36221]="RGB8UI",e[e.RGBA32I=36226]="RGBA32I",e[e.RGB32I=36227]="RGB32I",e[e.RGBA16I=36232]="RGBA16I",e[e.RGB16I=36233]="RGB16I",e[e.RGBA8I=36238]="RGBA8I",e[e.RGB8I=36239]="RGB8I",e[e.RED_INTEGER=36244]="RED_INTEGER",e[e.RGB_INTEGER=36248]="RGB_INTEGER",e[e.RGBA_INTEGER=36249]="RGBA_INTEGER",e[e.R8=33321]="R8",e[e.RG8=33323]="RG8",e[e.R16F=33325]="R16F",e[e.R32F=33326]="R32F",e[e.RG16F=33327]="RG16F",e[e.RG32F=33328]="RG32F",e[e.R8I=33329]="R8I",e[e.R8UI=33330]="R8UI",e[e.R16I=33331]="R16I",e[e.R16UI=33332]="R16UI",e[e.R32I=33333]="R32I",e[e.R32UI=33334]="R32UI",e[e.RG8I=33335]="RG8I",e[e.RG8UI=33336]="RG8UI",e[e.RG16I=33337]="RG16I",e[e.RG16UI=33338]="RG16UI",e[e.RG32I=33339]="RG32I",e[e.RG32UI=33340]="RG32UI",e[e.R8_SNORM=36756]="R8_SNORM",e[e.RG8_SNORM=36757]="RG8_SNORM",e[e.RGB8_SNORM=36758]="RGB8_SNORM",e[e.RGBA8_SNORM=36759]="RGBA8_SNORM",e[e.RGB10_A2UI=36975]="RGB10_A2UI",e[e.TEXTURE_IMMUTABLE_FORMAT=37167]="TEXTURE_IMMUTABLE_FORMAT",e[e.TEXTURE_IMMUTABLE_LEVELS=33503]="TEXTURE_IMMUTABLE_LEVELS",e[e.UNSIGNED_INT_2_10_10_10_REV=33640]="UNSIGNED_INT_2_10_10_10_REV",e[e.UNSIGNED_INT_10F_11F_11F_REV=35899]="UNSIGNED_INT_10F_11F_11F_REV",e[e.UNSIGNED_INT_5_9_9_9_REV=35902]="UNSIGNED_INT_5_9_9_9_REV",e[e.FLOAT_32_UNSIGNED_INT_24_8_REV=36269]="FLOAT_32_UNSIGNED_INT_24_8_REV",e[e.UNSIGNED_INT_24_8=34042]="UNSIGNED_INT_24_8",e[e.HALF_FLOAT=5131]="HALF_FLOAT",e[e.RG=33319]="RG",e[e.RG_INTEGER=33320]="RG_INTEGER",e[e.INT_2_10_10_10_REV=36255]="INT_2_10_10_10_REV",e[e.CURRENT_QUERY=34917]="CURRENT_QUERY",e[e.QUERY_RESULT=34918]="QUERY_RESULT",e[e.QUERY_RESULT_AVAILABLE=34919]="QUERY_RESULT_AVAILABLE",e[e.ANY_SAMPLES_PASSED=35887]="ANY_SAMPLES_PASSED",e[e.ANY_SAMPLES_PASSED_CONSERVATIVE=36202]="ANY_SAMPLES_PASSED_CONSERVATIVE",e[e.MAX_DRAW_BUFFERS=34852]="MAX_DRAW_BUFFERS",e[e.DRAW_BUFFER0=34853]="DRAW_BUFFER0",e[e.DRAW_BUFFER1=34854]="DRAW_BUFFER1",e[e.DRAW_BUFFER2=34855]="DRAW_BUFFER2",e[e.DRAW_BUFFER3=34856]="DRAW_BUFFER3",e[e.DRAW_BUFFER4=34857]="DRAW_BUFFER4",e[e.DRAW_BUFFER5=34858]="DRAW_BUFFER5",e[e.DRAW_BUFFER6=34859]="DRAW_BUFFER6",e[e.DRAW_BUFFER7=34860]="DRAW_BUFFER7",e[e.DRAW_BUFFER8=34861]="DRAW_BUFFER8",e[e.DRAW_BUFFER9=34862]="DRAW_BUFFER9",e[e.DRAW_BUFFER10=34863]="DRAW_BUFFER10",e[e.DRAW_BUFFER11=34864]="DRAW_BUFFER11",e[e.DRAW_BUFFER12=34865]="DRAW_BUFFER12",e[e.DRAW_BUFFER13=34866]="DRAW_BUFFER13",e[e.DRAW_BUFFER14=34867]="DRAW_BUFFER14",e[e.DRAW_BUFFER15=34868]="DRAW_BUFFER15",e[e.MAX_COLOR_ATTACHMENTS=36063]="MAX_COLOR_ATTACHMENTS",e[e.COLOR_ATTACHMENT1=36065]="COLOR_ATTACHMENT1",e[e.COLOR_ATTACHMENT2=36066]="COLOR_ATTACHMENT2",e[e.COLOR_ATTACHMENT3=36067]="COLOR_ATTACHMENT3",e[e.COLOR_ATTACHMENT4=36068]="COLOR_ATTACHMENT4",e[e.COLOR_ATTACHMENT5=36069]="COLOR_ATTACHMENT5",e[e.COLOR_ATTACHMENT6=36070]="COLOR_ATTACHMENT6",e[e.COLOR_ATTACHMENT7=36071]="COLOR_ATTACHMENT7",e[e.COLOR_ATTACHMENT8=36072]="COLOR_ATTACHMENT8",e[e.COLOR_ATTACHMENT9=36073]="COLOR_ATTACHMENT9",e[e.COLOR_ATTACHMENT10=36074]="COLOR_ATTACHMENT10",e[e.COLOR_ATTACHMENT11=36075]="COLOR_ATTACHMENT11",e[e.COLOR_ATTACHMENT12=36076]="COLOR_ATTACHMENT12",e[e.COLOR_ATTACHMENT13=36077]="COLOR_ATTACHMENT13",e[e.COLOR_ATTACHMENT14=36078]="COLOR_ATTACHMENT14",e[e.COLOR_ATTACHMENT15=36079]="COLOR_ATTACHMENT15",e[e.SAMPLER_3D=35679]="SAMPLER_3D",e[e.SAMPLER_2D_SHADOW=35682]="SAMPLER_2D_SHADOW",e[e.SAMPLER_2D_ARRAY=36289]="SAMPLER_2D_ARRAY",e[e.SAMPLER_2D_ARRAY_SHADOW=36292]="SAMPLER_2D_ARRAY_SHADOW",e[e.SAMPLER_CUBE_SHADOW=36293]="SAMPLER_CUBE_SHADOW",e[e.INT_SAMPLER_2D=36298]="INT_SAMPLER_2D",e[e.INT_SAMPLER_3D=36299]="INT_SAMPLER_3D",e[e.INT_SAMPLER_CUBE=36300]="INT_SAMPLER_CUBE",e[e.INT_SAMPLER_2D_ARRAY=36303]="INT_SAMPLER_2D_ARRAY",e[e.UNSIGNED_INT_SAMPLER_2D=36306]="UNSIGNED_INT_SAMPLER_2D",e[e.UNSIGNED_INT_SAMPLER_3D=36307]="UNSIGNED_INT_SAMPLER_3D",e[e.UNSIGNED_INT_SAMPLER_CUBE=36308]="UNSIGNED_INT_SAMPLER_CUBE",e[e.UNSIGNED_INT_SAMPLER_2D_ARRAY=36311]="UNSIGNED_INT_SAMPLER_2D_ARRAY",e[e.MAX_SAMPLES=36183]="MAX_SAMPLES",e[e.SAMPLER_BINDING=35097]="SAMPLER_BINDING",e[e.PIXEL_PACK_BUFFER=35051]="PIXEL_PACK_BUFFER",e[e.PIXEL_UNPACK_BUFFER=35052]="PIXEL_UNPACK_BUFFER",e[e.PIXEL_PACK_BUFFER_BINDING=35053]="PIXEL_PACK_BUFFER_BINDING",e[e.PIXEL_UNPACK_BUFFER_BINDING=35055]="PIXEL_UNPACK_BUFFER_BINDING",e[e.COPY_READ_BUFFER=36662]="COPY_READ_BUFFER",e[e.COPY_WRITE_BUFFER=36663]="COPY_WRITE_BUFFER",e[e.COPY_READ_BUFFER_BINDING=36662]="COPY_READ_BUFFER_BINDING",e[e.COPY_WRITE_BUFFER_BINDING=36663]="COPY_WRITE_BUFFER_BINDING",e[e.FLOAT_MAT2x3=35685]="FLOAT_MAT2x3",e[e.FLOAT_MAT2x4=35686]="FLOAT_MAT2x4",e[e.FLOAT_MAT3x2=35687]="FLOAT_MAT3x2",e[e.FLOAT_MAT3x4=35688]="FLOAT_MAT3x4",e[e.FLOAT_MAT4x2=35689]="FLOAT_MAT4x2",e[e.FLOAT_MAT4x3=35690]="FLOAT_MAT4x3",e[e.UNSIGNED_INT_VEC2=36294]="UNSIGNED_INT_VEC2",e[e.UNSIGNED_INT_VEC3=36295]="UNSIGNED_INT_VEC3",e[e.UNSIGNED_INT_VEC4=36296]="UNSIGNED_INT_VEC4",e[e.UNSIGNED_NORMALIZED=35863]="UNSIGNED_NORMALIZED",e[e.SIGNED_NORMALIZED=36764]="SIGNED_NORMALIZED",e[e.VERTEX_ATTRIB_ARRAY_INTEGER=35069]="VERTEX_ATTRIB_ARRAY_INTEGER",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR",e[e.TRANSFORM_FEEDBACK_BUFFER_MODE=35967]="TRANSFORM_FEEDBACK_BUFFER_MODE",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS=35968]="MAX_TRANSFORM_FEEDBACK_SEPARATE_COMPONENTS",e[e.TRANSFORM_FEEDBACK_VARYINGS=35971]="TRANSFORM_FEEDBACK_VARYINGS",e[e.TRANSFORM_FEEDBACK_BUFFER_START=35972]="TRANSFORM_FEEDBACK_BUFFER_START",e[e.TRANSFORM_FEEDBACK_BUFFER_SIZE=35973]="TRANSFORM_FEEDBACK_BUFFER_SIZE",e[e.TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN=35976]="TRANSFORM_FEEDBACK_PRIMITIVES_WRITTEN",e[e.MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS=35978]="MAX_TRANSFORM_FEEDBACK_INTERLEAVED_COMPONENTS",e[e.MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS=35979]="MAX_TRANSFORM_FEEDBACK_SEPARATE_ATTRIBS",e[e.INTERLEAVED_ATTRIBS=35980]="INTERLEAVED_ATTRIBS",e[e.SEPARATE_ATTRIBS=35981]="SEPARATE_ATTRIBS",e[e.TRANSFORM_FEEDBACK_BUFFER=35982]="TRANSFORM_FEEDBACK_BUFFER",e[e.TRANSFORM_FEEDBACK_BUFFER_BINDING=35983]="TRANSFORM_FEEDBACK_BUFFER_BINDING",e[e.TRANSFORM_FEEDBACK=36386]="TRANSFORM_FEEDBACK",e[e.TRANSFORM_FEEDBACK_PAUSED=36387]="TRANSFORM_FEEDBACK_PAUSED",e[e.TRANSFORM_FEEDBACK_ACTIVE=36388]="TRANSFORM_FEEDBACK_ACTIVE",e[e.TRANSFORM_FEEDBACK_BINDING=36389]="TRANSFORM_FEEDBACK_BINDING",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE",e[e.FRAMEBUFFER_ATTACHMENT_RED_SIZE=33298]="FRAMEBUFFER_ATTACHMENT_RED_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_GREEN_SIZE=33299]="FRAMEBUFFER_ATTACHMENT_GREEN_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_BLUE_SIZE=33300]="FRAMEBUFFER_ATTACHMENT_BLUE_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE=33301]="FRAMEBUFFER_ATTACHMENT_ALPHA_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE=33302]="FRAMEBUFFER_ATTACHMENT_DEPTH_SIZE",e[e.FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE=33303]="FRAMEBUFFER_ATTACHMENT_STENCIL_SIZE",e[e.FRAMEBUFFER_DEFAULT=33304]="FRAMEBUFFER_DEFAULT",e[e.DEPTH24_STENCIL8=35056]="DEPTH24_STENCIL8",e[e.DRAW_FRAMEBUFFER_BINDING=36006]="DRAW_FRAMEBUFFER_BINDING",e[e.READ_FRAMEBUFFER_BINDING=36010]="READ_FRAMEBUFFER_BINDING",e[e.RENDERBUFFER_SAMPLES=36011]="RENDERBUFFER_SAMPLES",e[e.FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER=36052]="FRAMEBUFFER_ATTACHMENT_TEXTURE_LAYER",e[e.FRAMEBUFFER_INCOMPLETE_MULTISAMPLE=36182]="FRAMEBUFFER_INCOMPLETE_MULTISAMPLE",e[e.UNIFORM_BUFFER=35345]="UNIFORM_BUFFER",e[e.UNIFORM_BUFFER_BINDING=35368]="UNIFORM_BUFFER_BINDING",e[e.UNIFORM_BUFFER_START=35369]="UNIFORM_BUFFER_START",e[e.UNIFORM_BUFFER_SIZE=35370]="UNIFORM_BUFFER_SIZE",e[e.MAX_VERTEX_UNIFORM_BLOCKS=35371]="MAX_VERTEX_UNIFORM_BLOCKS",e[e.MAX_FRAGMENT_UNIFORM_BLOCKS=35373]="MAX_FRAGMENT_UNIFORM_BLOCKS",e[e.MAX_COMBINED_UNIFORM_BLOCKS=35374]="MAX_COMBINED_UNIFORM_BLOCKS",e[e.MAX_UNIFORM_BUFFER_BINDINGS=35375]="MAX_UNIFORM_BUFFER_BINDINGS",e[e.MAX_UNIFORM_BLOCK_SIZE=35376]="MAX_UNIFORM_BLOCK_SIZE",e[e.MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS=35377]="MAX_COMBINED_VERTEX_UNIFORM_COMPONENTS",e[e.MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS=35379]="MAX_COMBINED_FRAGMENT_UNIFORM_COMPONENTS",e[e.UNIFORM_BUFFER_OFFSET_ALIGNMENT=35380]="UNIFORM_BUFFER_OFFSET_ALIGNMENT",e[e.ACTIVE_UNIFORM_BLOCKS=35382]="ACTIVE_UNIFORM_BLOCKS",e[e.UNIFORM_TYPE=35383]="UNIFORM_TYPE",e[e.UNIFORM_SIZE=35384]="UNIFORM_SIZE",e[e.UNIFORM_BLOCK_INDEX=35386]="UNIFORM_BLOCK_INDEX",e[e.UNIFORM_OFFSET=35387]="UNIFORM_OFFSET",e[e.UNIFORM_ARRAY_STRIDE=35388]="UNIFORM_ARRAY_STRIDE",e[e.UNIFORM_MATRIX_STRIDE=35389]="UNIFORM_MATRIX_STRIDE",e[e.UNIFORM_IS_ROW_MAJOR=35390]="UNIFORM_IS_ROW_MAJOR",e[e.UNIFORM_BLOCK_BINDING=35391]="UNIFORM_BLOCK_BINDING",e[e.UNIFORM_BLOCK_DATA_SIZE=35392]="UNIFORM_BLOCK_DATA_SIZE",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORMS=35394]="UNIFORM_BLOCK_ACTIVE_UNIFORMS",e[e.UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES=35395]="UNIFORM_BLOCK_ACTIVE_UNIFORM_INDICES",e[e.UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER=35396]="UNIFORM_BLOCK_REFERENCED_BY_VERTEX_SHADER",e[e.UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER=35398]="UNIFORM_BLOCK_REFERENCED_BY_FRAGMENT_SHADER",e[e.OBJECT_TYPE=37138]="OBJECT_TYPE",e[e.SYNC_CONDITION=37139]="SYNC_CONDITION",e[e.SYNC_STATUS=37140]="SYNC_STATUS",e[e.SYNC_FLAGS=37141]="SYNC_FLAGS",e[e.SYNC_FENCE=37142]="SYNC_FENCE",e[e.SYNC_GPU_COMMANDS_COMPLETE=37143]="SYNC_GPU_COMMANDS_COMPLETE",e[e.UNSIGNALED=37144]="UNSIGNALED",e[e.SIGNALED=37145]="SIGNALED",e[e.ALREADY_SIGNALED=37146]="ALREADY_SIGNALED",e[e.TIMEOUT_EXPIRED=37147]="TIMEOUT_EXPIRED",e[e.CONDITION_SATISFIED=37148]="CONDITION_SATISFIED",e[e.WAIT_FAILED=37149]="WAIT_FAILED",e[e.SYNC_FLUSH_COMMANDS_BIT=1]="SYNC_FLUSH_COMMANDS_BIT",e[e.COLOR=6144]="COLOR",e[e.DEPTH=6145]="DEPTH",e[e.STENCIL=6146]="STENCIL",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX",e[e.DEPTH_COMPONENT24=33190]="DEPTH_COMPONENT24",e[e.STREAM_READ=35041]="STREAM_READ",e[e.STREAM_COPY=35042]="STREAM_COPY",e[e.STATIC_READ=35045]="STATIC_READ",e[e.STATIC_COPY=35046]="STATIC_COPY",e[e.DYNAMIC_READ=35049]="DYNAMIC_READ",e[e.DYNAMIC_COPY=35050]="DYNAMIC_COPY",e[e.DEPTH_COMPONENT32F=36012]="DEPTH_COMPONENT32F",e[e.DEPTH32F_STENCIL8=36013]="DEPTH32F_STENCIL8",e[e.INVALID_INDEX=4294967295]="INVALID_INDEX",e[e.TIMEOUT_IGNORED=-1]="TIMEOUT_IGNORED",e[e.MAX_CLIENT_WAIT_TIMEOUT_WEBGL=37447]="MAX_CLIENT_WAIT_TIMEOUT_WEBGL",e[e.VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE=35070]="VERTEX_ATTRIB_ARRAY_DIVISOR_ANGLE",e[e.UNMASKED_VENDOR_WEBGL=37445]="UNMASKED_VENDOR_WEBGL",e[e.UNMASKED_RENDERER_WEBGL=37446]="UNMASKED_RENDERER_WEBGL",e[e.MAX_TEXTURE_MAX_ANISOTROPY_EXT=34047]="MAX_TEXTURE_MAX_ANISOTROPY_EXT",e[e.TEXTURE_MAX_ANISOTROPY_EXT=34046]="TEXTURE_MAX_ANISOTROPY_EXT",e[e.COMPRESSED_RGB_S3TC_DXT1_EXT=33776]="COMPRESSED_RGB_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT1_EXT=33777]="COMPRESSED_RGBA_S3TC_DXT1_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT3_EXT=33778]="COMPRESSED_RGBA_S3TC_DXT3_EXT",e[e.COMPRESSED_RGBA_S3TC_DXT5_EXT=33779]="COMPRESSED_RGBA_S3TC_DXT5_EXT",e[e.COMPRESSED_R11_EAC=37488]="COMPRESSED_R11_EAC",e[e.COMPRESSED_SIGNED_R11_EAC=37489]="COMPRESSED_SIGNED_R11_EAC",e[e.COMPRESSED_RG11_EAC=37490]="COMPRESSED_RG11_EAC",e[e.COMPRESSED_SIGNED_RG11_EAC=37491]="COMPRESSED_SIGNED_RG11_EAC",e[e.COMPRESSED_RGB8_ETC2=37492]="COMPRESSED_RGB8_ETC2",e[e.COMPRESSED_RGBA8_ETC2_EAC=37493]="COMPRESSED_RGBA8_ETC2_EAC",e[e.COMPRESSED_SRGB8_ETC2=37494]="COMPRESSED_SRGB8_ETC2",e[e.COMPRESSED_SRGB8_ALPHA8_ETC2_EAC=37495]="COMPRESSED_SRGB8_ALPHA8_ETC2_EAC",e[e.COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2=37496]="COMPRESSED_RGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2=37497]="COMPRESSED_SRGB8_PUNCHTHROUGH_ALPHA1_ETC2",e[e.COMPRESSED_RGB_PVRTC_4BPPV1_IMG=35840]="COMPRESSED_RGB_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG=35842]="COMPRESSED_RGBA_PVRTC_4BPPV1_IMG",e[e.COMPRESSED_RGB_PVRTC_2BPPV1_IMG=35841]="COMPRESSED_RGB_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG=35843]="COMPRESSED_RGBA_PVRTC_2BPPV1_IMG",e[e.COMPRESSED_RGB_ETC1_WEBGL=36196]="COMPRESSED_RGB_ETC1_WEBGL",e[e.COMPRESSED_RGB_ATC_WEBGL=35986]="COMPRESSED_RGB_ATC_WEBGL",e[e.COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL=35986]="COMPRESSED_RGBA_ATC_EXPLICIT_ALPHA_WEBGL",e[e.COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL=34798]="COMPRESSED_RGBA_ATC_INTERPOLATED_ALPHA_WEBGL",e[e.UNSIGNED_INT_24_8_WEBGL=34042]="UNSIGNED_INT_24_8_WEBGL",e[e.HALF_FLOAT_OES=36193]="HALF_FLOAT_OES",e[e.RGBA32F_EXT=34836]="RGBA32F_EXT",e[e.RGB32F_EXT=34837]="RGB32F_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT=33297]="FRAMEBUFFER_ATTACHMENT_COMPONENT_TYPE_EXT",e[e.UNSIGNED_NORMALIZED_EXT=35863]="UNSIGNED_NORMALIZED_EXT",e[e.MIN_EXT=32775]="MIN_EXT",e[e.MAX_EXT=32776]="MAX_EXT",e[e.SRGB_EXT=35904]="SRGB_EXT",e[e.SRGB_ALPHA_EXT=35906]="SRGB_ALPHA_EXT",e[e.SRGB8_ALPHA8_EXT=35907]="SRGB8_ALPHA8_EXT",e[e.FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT=33296]="FRAMEBUFFER_ATTACHMENT_COLOR_ENCODING_EXT",e[e.FRAGMENT_SHADER_DERIVATIVE_HINT_OES=35723]="FRAGMENT_SHADER_DERIVATIVE_HINT_OES",e[e.COLOR_ATTACHMENT0_WEBGL=36064]="COLOR_ATTACHMENT0_WEBGL",e[e.COLOR_ATTACHMENT1_WEBGL=36065]="COLOR_ATTACHMENT1_WEBGL",e[e.COLOR_ATTACHMENT2_WEBGL=36066]="COLOR_ATTACHMENT2_WEBGL",e[e.COLOR_ATTACHMENT3_WEBGL=36067]="COLOR_ATTACHMENT3_WEBGL",e[e.COLOR_ATTACHMENT4_WEBGL=36068]="COLOR_ATTACHMENT4_WEBGL",e[e.COLOR_ATTACHMENT5_WEBGL=36069]="COLOR_ATTACHMENT5_WEBGL",e[e.COLOR_ATTACHMENT6_WEBGL=36070]="COLOR_ATTACHMENT6_WEBGL",e[e.COLOR_ATTACHMENT7_WEBGL=36071]="COLOR_ATTACHMENT7_WEBGL",e[e.COLOR_ATTACHMENT8_WEBGL=36072]="COLOR_ATTACHMENT8_WEBGL",e[e.COLOR_ATTACHMENT9_WEBGL=36073]="COLOR_ATTACHMENT9_WEBGL",e[e.COLOR_ATTACHMENT10_WEBGL=36074]="COLOR_ATTACHMENT10_WEBGL",e[e.COLOR_ATTACHMENT11_WEBGL=36075]="COLOR_ATTACHMENT11_WEBGL",e[e.COLOR_ATTACHMENT12_WEBGL=36076]="COLOR_ATTACHMENT12_WEBGL",e[e.COLOR_ATTACHMENT13_WEBGL=36077]="COLOR_ATTACHMENT13_WEBGL",e[e.COLOR_ATTACHMENT14_WEBGL=36078]="COLOR_ATTACHMENT14_WEBGL",e[e.COLOR_ATTACHMENT15_WEBGL=36079]="COLOR_ATTACHMENT15_WEBGL",e[e.DRAW_BUFFER0_WEBGL=34853]="DRAW_BUFFER0_WEBGL",e[e.DRAW_BUFFER1_WEBGL=34854]="DRAW_BUFFER1_WEBGL",e[e.DRAW_BUFFER2_WEBGL=34855]="DRAW_BUFFER2_WEBGL",e[e.DRAW_BUFFER3_WEBGL=34856]="DRAW_BUFFER3_WEBGL",e[e.DRAW_BUFFER4_WEBGL=34857]="DRAW_BUFFER4_WEBGL",e[e.DRAW_BUFFER5_WEBGL=34858]="DRAW_BUFFER5_WEBGL",e[e.DRAW_BUFFER6_WEBGL=34859]="DRAW_BUFFER6_WEBGL",e[e.DRAW_BUFFER7_WEBGL=34860]="DRAW_BUFFER7_WEBGL",e[e.DRAW_BUFFER8_WEBGL=34861]="DRAW_BUFFER8_WEBGL",e[e.DRAW_BUFFER9_WEBGL=34862]="DRAW_BUFFER9_WEBGL",e[e.DRAW_BUFFER10_WEBGL=34863]="DRAW_BUFFER10_WEBGL",e[e.DRAW_BUFFER11_WEBGL=34864]="DRAW_BUFFER11_WEBGL",e[e.DRAW_BUFFER12_WEBGL=34865]="DRAW_BUFFER12_WEBGL",e[e.DRAW_BUFFER13_WEBGL=34866]="DRAW_BUFFER13_WEBGL",e[e.DRAW_BUFFER14_WEBGL=34867]="DRAW_BUFFER14_WEBGL",e[e.DRAW_BUFFER15_WEBGL=34868]="DRAW_BUFFER15_WEBGL",e[e.MAX_COLOR_ATTACHMENTS_WEBGL=36063]="MAX_COLOR_ATTACHMENTS_WEBGL",e[e.MAX_DRAW_BUFFERS_WEBGL=34852]="MAX_DRAW_BUFFERS_WEBGL",e[e.VERTEX_ARRAY_BINDING_OES=34229]="VERTEX_ARRAY_BINDING_OES",e[e.QUERY_COUNTER_BITS_EXT=34916]="QUERY_COUNTER_BITS_EXT",e[e.CURRENT_QUERY_EXT=34917]="CURRENT_QUERY_EXT",e[e.QUERY_RESULT_EXT=34918]="QUERY_RESULT_EXT",e[e.QUERY_RESULT_AVAILABLE_EXT=34919]="QUERY_RESULT_AVAILABLE_EXT",e[e.TIME_ELAPSED_EXT=35007]="TIME_ELAPSED_EXT",e[e.TIMESTAMP_EXT=36392]="TIMESTAMP_EXT",e[e.GPU_DISJOINT_EXT=36795]="GPU_DISJOINT_EXT"})(Xe||(Xe={}));var ga;(function(e){e[e.Buffer=0]="Buffer",e[e.Texture=1]="Texture",e[e.RenderTarget=2]="RenderTarget",e[e.Sampler=3]="Sampler",e[e.Program=4]="Program",e[e.Bindings=5]="Bindings",e[e.InputLayout=6]="InputLayout",e[e.RenderPipeline=7]="RenderPipeline",e[e.ComputePipeline=8]="ComputePipeline",e[e.Readback=9]="Readback",e[e.QueryPool=10]="QueryPool"})(ga||(ga={}));var Ni;(function(e){e[e.NEVER=512]="NEVER",e[e.LESS=513]="LESS",e[e.EQUAL=514]="EQUAL",e[e.LEQUAL=515]="LEQUAL",e[e.GREATER=516]="GREATER",e[e.NOTEQUAL=517]="NOTEQUAL",e[e.GEQUAL=518]="GEQUAL",e[e.ALWAYS=519]="ALWAYS"})(Ni||(Ni={}));var Nm;(function(e){e[e.CCW=2305]="CCW",e[e.CW=2304]="CW"})(Nm||(Nm={}));var jl;(function(e){e[e.NONE=0]="NONE",e[e.FRONT=1]="FRONT",e[e.BACK=2]="BACK",e[e.FRONT_AND_BACK=3]="FRONT_AND_BACK"})(jl||(jl={}));var Xi;(function(e){e[e.ZERO=0]="ZERO",e[e.ONE=1]="ONE",e[e.SRC=768]="SRC",e[e.ONE_MINUS_SRC=769]="ONE_MINUS_SRC",e[e.DST=774]="DST",e[e.ONE_MINUS_DST=775]="ONE_MINUS_DST",e[e.SRC_ALPHA=770]="SRC_ALPHA",e[e.ONE_MINUS_SRC_ALPHA=771]="ONE_MINUS_SRC_ALPHA",e[e.DST_ALPHA=772]="DST_ALPHA",e[e.ONE_MINUS_DST_ALPHA=773]="ONE_MINUS_DST_ALPHA",e[e.CONST=32769]="CONST",e[e.ONE_MINUS_CONSTANT=32770]="ONE_MINUS_CONSTANT",e[e.SRC_ALPHA_SATURATE=776]="SRC_ALPHA_SATURATE"})(Xi||(Xi={}));var iu;(function(e){e[e.ADD=32774]="ADD",e[e.SUBSTRACT=32778]="SUBSTRACT",e[e.REVERSE_SUBSTRACT=32779]="REVERSE_SUBSTRACT",e[e.MIN=32775]="MIN",e[e.MAX=32776]="MAX"})(iu||(iu={}));var yl;(function(e){e[e.CLAMP_TO_EDGE=0]="CLAMP_TO_EDGE",e[e.REPEAT=1]="REPEAT",e[e.MIRRORED_REPEAT=2]="MIRRORED_REPEAT"})(yl||(yl={}));var es;(function(e){e[e.POINT=0]="POINT",e[e.BILINEAR=1]="BILINEAR"})(es||(es={}));var Xs;(function(e){e[e.NO_MIP=0]="NO_MIP",e[e.NEAREST=1]="NEAREST",e[e.LINEAR=2]="LINEAR"})(Xs||(Xs={}));var ws;(function(e){e[e.POINTS=0]="POINTS",e[e.TRIANGLES=1]="TRIANGLES",e[e.TRIANGLE_STRIP=2]="TRIANGLE_STRIP",e[e.LINES=3]="LINES",e[e.LINE_STRIP=4]="LINE_STRIP"})(ws||(ws={}));var ro;(function(e){e[e.MAP_READ=1]="MAP_READ",e[e.MAP_WRITE=2]="MAP_WRITE",e[e.COPY_SRC=4]="COPY_SRC",e[e.COPY_DST=8]="COPY_DST",e[e.INDEX=16]="INDEX",e[e.VERTEX=32]="VERTEX",e[e.UNIFORM=64]="UNIFORM",e[e.STORAGE=128]="STORAGE",e[e.INDIRECT=256]="INDIRECT",e[e.QUERY_RESOLVE=512]="QUERY_RESOLVE"})(ro||(ro={}));var bf;(function(e){e[e.STATIC=1]="STATIC",e[e.DYNAMIC=2]="DYNAMIC"})(bf||(bf={}));var Rd;(function(e){e[e.VERTEX=1]="VERTEX",e[e.INSTANCE=2]="INSTANCE"})(Rd||(Rd={}));var EE;(function(e){e.LOADED="loaded"})(EE||(EE={}));var Wi;(function(e){e[e.TEXTURE_2D=0]="TEXTURE_2D",e[e.TEXTURE_2D_ARRAY=1]="TEXTURE_2D_ARRAY",e[e.TEXTURE_3D=2]="TEXTURE_3D",e[e.TEXTURE_CUBE_MAP=3]="TEXTURE_CUBE_MAP"})(Wi||(Wi={}));var Ou;(function(e){e[e.SAMPLED=1]="SAMPLED",e[e.RENDER_TARGET=2]="RENDER_TARGET",e[e.STORAGE=4]="STORAGE"})(Ou||(Ou={}));var au;(function(e){e[e.NONE=0]="NONE",e[e.RED=1]="RED",e[e.GREEN=2]="GREEN",e[e.BLUE=4]="BLUE",e[e.ALPHA=8]="ALPHA",e[e.RGB=7]="RGB",e[e.ALL=15]="ALL"})(au||(au={}));var Ho;(function(e){e[e.KEEP=7680]="KEEP",e[e.ZERO=0]="ZERO",e[e.REPLACE=7681]="REPLACE",e[e.INVERT=5386]="INVERT",e[e.INCREMENT_CLAMP=7682]="INCREMENT_CLAMP",e[e.DECREMENT_CLAMP=7683]="DECREMENT_CLAMP",e[e.INCREMENT_WRAP=34055]="INCREMENT_WRAP",e[e.DECREMENT_WRAP=34056]="DECREMENT_WRAP"})(Ho||(Ho={}));function oN(e,r,t,n){var i=Wi.TEXTURE_2D,a=1,s=Ou.SAMPLED;return{dimension:i,format:e,width:r,height:t,depthOrArrayLayers:a,mipLevelCount:n,usage:s}}var Wo;(function(e){e[e.Float=0]="Float",e[e.Uint=1]="Uint",e[e.Sint=2]="Sint",e[e.Depth=3]="Depth"})(Wo||(Wo={}));var Av;(function(e){e[e.LOWER_LEFT=0]="LOWER_LEFT",e[e.UPPER_LEFT=1]="UPPER_LEFT"})(Av||(Av={}));var Tv;(function(e){e[e.NEGATIVE_ONE=0]="NEGATIVE_ONE",e[e.ZERO=1]="ZERO"})(Tv||(Tv={}));var r0;(function(e){e[e.OcclusionConservative=0]="OcclusionConservative"})(r0||(r0={}));var Ir;(function(e){e[e.U8=1]="U8",e[e.U16=2]="U16",e[e.U32=3]="U32",e[e.S8=4]="S8",e[e.S16=5]="S16",e[e.S32=6]="S32",e[e.F16=7]="F16",e[e.F32=8]="F32",e[e.BC1=65]="BC1",e[e.BC2=66]="BC2",e[e.BC3=67]="BC3",e[e.BC4_UNORM=68]="BC4_UNORM",e[e.BC4_SNORM=69]="BC4_SNORM",e[e.BC5_UNORM=70]="BC5_UNORM",e[e.BC5_SNORM=71]="BC5_SNORM",e[e.U16_PACKED_5551=97]="U16_PACKED_5551",e[e.U16_PACKED_565=98]="U16_PACKED_565",e[e.D24=129]="D24",e[e.D32F=130]="D32F",e[e.D24S8=131]="D24S8",e[e.D32FS8=132]="D32FS8"})(Ir||(Ir={}));var Wn;(function(e){e[e.R=1]="R",e[e.RG=2]="RG",e[e.RGB=3]="RGB",e[e.RGBA=4]="RGBA",e[e.A=5]="A"})(Wn||(Wn={}));function sN(e){return e}var wn;(function(e){e[e.None=0]="None",e[e.Normalized=1]="Normalized",e[e.sRGB=2]="sRGB",e[e.Depth=4]="Depth",e[e.Stencil=8]="Stencil",e[e.RenderTarget=16]="RenderTarget",e[e.Luminance=32]="Luminance"})(wn||(wn={}));function li(e,r,t){return e<<16|r<<8|t}var kt;(function(e){e[e.ALPHA=li(Ir.U8,Wn.A,wn.None)]="ALPHA",e[e.U8_LUMINANCE=li(Ir.U8,Wn.A,wn.Luminance)]="U8_LUMINANCE",e[e.F16_LUMINANCE=li(Ir.F16,Wn.A,wn.Luminance)]="F16_LUMINANCE",e[e.F32_LUMINANCE=li(Ir.F32,Wn.A,wn.Luminance)]="F32_LUMINANCE",e[e.F16_R=li(Ir.F16,Wn.R,wn.None)]="F16_R",e[e.F16_RG=li(Ir.F16,Wn.RG,wn.None)]="F16_RG",e[e.F16_RGB=li(Ir.F16,Wn.RGB,wn.None)]="F16_RGB",e[e.F16_RGBA=li(Ir.F16,Wn.RGBA,wn.None)]="F16_RGBA",e[e.F32_R=li(Ir.F32,Wn.R,wn.None)]="F32_R",e[e.F32_RG=li(Ir.F32,Wn.RG,wn.None)]="F32_RG",e[e.F32_RGB=li(Ir.F32,Wn.RGB,wn.None)]="F32_RGB",e[e.F32_RGBA=li(Ir.F32,Wn.RGBA,wn.None)]="F32_RGBA",e[e.U8_R=li(Ir.U8,Wn.R,wn.None)]="U8_R",e[e.U8_R_NORM=li(Ir.U8,Wn.R,wn.Normalized)]="U8_R_NORM",e[e.U8_RG=li(Ir.U8,Wn.RG,wn.None)]="U8_RG",e[e.U8_RG_NORM=li(Ir.U8,Wn.RG,wn.Normalized)]="U8_RG_NORM",e[e.U8_RGB=li(Ir.U8,Wn.RGB,wn.None)]="U8_RGB",e[e.U8_RGB_NORM=li(Ir.U8,Wn.RGB,wn.Normalized)]="U8_RGB_NORM",e[e.U8_RGB_SRGB=li(Ir.U8,Wn.RGB,wn.sRGB|wn.Normalized)]="U8_RGB_SRGB",e[e.U8_RGBA=li(Ir.U8,Wn.RGBA,wn.None)]="U8_RGBA",e[e.U8_RGBA_NORM=li(Ir.U8,Wn.RGBA,wn.Normalized)]="U8_RGBA_NORM",e[e.U8_RGBA_SRGB=li(Ir.U8,Wn.RGBA,wn.sRGB|wn.Normalized)]="U8_RGBA_SRGB",e[e.U16_R=li(Ir.U16,Wn.R,wn.None)]="U16_R",e[e.U16_R_NORM=li(Ir.U16,Wn.R,wn.Normalized)]="U16_R_NORM",e[e.U16_RG_NORM=li(Ir.U16,Wn.RG,wn.Normalized)]="U16_RG_NORM",e[e.U16_RGBA_NORM=li(Ir.U16,Wn.RGBA,wn.Normalized)]="U16_RGBA_NORM",e[e.U16_RGB=li(Ir.U16,Wn.RGB,wn.None)]="U16_RGB",e[e.U32_R=li(Ir.U32,Wn.R,wn.None)]="U32_R",e[e.U32_RG=li(Ir.U32,Wn.RG,wn.None)]="U32_RG",e[e.S8_R=li(Ir.S8,Wn.R,wn.None)]="S8_R",e[e.S8_R_NORM=li(Ir.S8,Wn.R,wn.Normalized)]="S8_R_NORM",e[e.S8_RG_NORM=li(Ir.S8,Wn.RG,wn.Normalized)]="S8_RG_NORM",e[e.S8_RGB_NORM=li(Ir.S8,Wn.RGB,wn.Normalized)]="S8_RGB_NORM",e[e.S8_RGBA_NORM=li(Ir.S8,Wn.RGBA,wn.Normalized)]="S8_RGBA_NORM",e[e.S16_R=li(Ir.S16,Wn.R,wn.None)]="S16_R",e[e.S16_RG=li(Ir.S16,Wn.RG,wn.None)]="S16_RG",e[e.S16_RG_NORM=li(Ir.S16,Wn.RG,wn.Normalized)]="S16_RG_NORM",e[e.S16_RGB_NORM=li(Ir.S16,Wn.RGB,wn.Normalized)]="S16_RGB_NORM",e[e.S16_RGBA=li(Ir.S16,Wn.RGBA,wn.None)]="S16_RGBA",e[e.S16_RGBA_NORM=li(Ir.S16,Wn.RGBA,wn.Normalized)]="S16_RGBA_NORM",e[e.S32_R=li(Ir.S32,Wn.R,wn.None)]="S32_R",e[e.U16_RGBA_5551=li(Ir.U16_PACKED_5551,Wn.RGBA,wn.Normalized)]="U16_RGBA_5551",e[e.U16_RGB_565=li(Ir.U16_PACKED_565,Wn.RGB,wn.Normalized)]="U16_RGB_565",e[e.BC1=li(Ir.BC1,Wn.RGBA,wn.Normalized)]="BC1",e[e.BC1_SRGB=li(Ir.BC1,Wn.RGBA,wn.Normalized|wn.sRGB)]="BC1_SRGB",e[e.BC2=li(Ir.BC2,Wn.RGBA,wn.Normalized)]="BC2",e[e.BC2_SRGB=li(Ir.BC2,Wn.RGBA,wn.Normalized|wn.sRGB)]="BC2_SRGB",e[e.BC3=li(Ir.BC3,Wn.RGBA,wn.Normalized)]="BC3",e[e.BC3_SRGB=li(Ir.BC3,Wn.RGBA,wn.Normalized|wn.sRGB)]="BC3_SRGB",e[e.BC4_UNORM=li(Ir.BC4_UNORM,Wn.R,wn.Normalized)]="BC4_UNORM",e[e.BC4_SNORM=li(Ir.BC4_SNORM,Wn.R,wn.Normalized)]="BC4_SNORM",e[e.BC5_UNORM=li(Ir.BC5_UNORM,Wn.RG,wn.Normalized)]="BC5_UNORM",e[e.BC5_SNORM=li(Ir.BC5_SNORM,Wn.RG,wn.Normalized)]="BC5_SNORM",e[e.D24=li(Ir.D24,Wn.R,wn.Depth)]="D24",e[e.D24_S8=li(Ir.D24S8,Wn.RG,wn.Depth|wn.Stencil)]="D24_S8",e[e.D32F=li(Ir.D32F,Wn.R,wn.Depth)]="D32F",e[e.D32F_S8=li(Ir.D32FS8,Wn.RG,wn.Depth|wn.Stencil)]="D32F_S8",e[e.U8_RGB_RT=li(Ir.U8,Wn.RGB,wn.RenderTarget|wn.Normalized)]="U8_RGB_RT",e[e.U8_RGBA_RT=li(Ir.U8,Wn.RGBA,wn.RenderTarget|wn.Normalized)]="U8_RGBA_RT",e[e.U8_RGBA_RT_SRGB=li(Ir.U8,Wn.RGBA,wn.RenderTarget|wn.Normalized|wn.sRGB)]="U8_RGBA_RT_SRGB"})(kt||(kt={}));function n0(e){return e>>>8&255}function sh(e){return e>>>16&255}function wv(e){return e&255}function SE(e){switch(e){case Ir.F32:case Ir.U32:case Ir.S32:return 4;case Ir.U16:case Ir.S16:case Ir.F16:return 2;case Ir.U8:case Ir.S8:return 1;default:throw new Error("whoops")}}function AE(e){return SE(sh(e))}function uN(e){return n0(e)}function t4(e){var r=SE(sh(e)),t=n0(e);return r*t}function lN(e,r){return e&4294967040|r}function cN(e,r){return e&4294902015|r<<8}function TE(e){var r=wv(e);if(r&wn.Depth)return Wo.Depth;if(r&wn.Normalized)return Wo.Float;var t=sh(e);if(t===Ir.F16||t===Ir.F32)return Wo.Float;if(t===Ir.U8||t===Ir.U16||t===Ir.U32)return Wo.Uint;if(t===Ir.S8||t===Ir.S16||t===Ir.S32)return Wo.Sint;throw new Error("whoops")}function Oi(e,r){if(r===void 0&&(r=""),!e)throw new Error("Assert fail: ".concat(r))}function Md(e){if(e!=null)return e;throw new Error("Missing object")}function wE(e,r){return e.r===r.r&&e.g===r.g&&e.b===r.b&&e.a===r.a}function CE(e,r){e.r=r.r,e.g=r.g,e.b=r.b,e.a=r.a}function RE(e){var r=e.r,t=e.g,n=e.b,i=e.a;return{r,g:t,b:n,a:i}}function Um(e,r,t,n){return n===void 0&&(n=1),{r:e,g:r,b:t,a:n}}var S_=Um(0,0,0,0),fN=Um(0,0,0,1),r4=Um(1,1,1,0),hN=Um(1,1,1,1),Cv=!0;function pN(e,r){r===void 0&&(r=Cv),r&&(e[10]=-e[10],e[14]=-e[14])}function dN(e,r){r===void 0&&(r=Cv),r&&(e[10]=-e[10],e[14]=-e[14]+1)}function n4(e,r){if(r===void 0&&(r=Cv),r)switch(e){case Ni.LESS:return Ni.GREATER;case Ni.LEQUAL:return Ni.GEQUAL;case Ni.GEQUAL:return Ni.LEQUAL;case Ni.GREATER:return Ni.LESS;default:return e}else return e}function vN(e,r){return r===void 0&&(r=Cv),r?1-e:e}function mN(e,r){return r===void 0&&(r=Cv),r?-e:e}function gN(e,r,t,n){if(n===void 0&&(n=Cv),t=n4(t,n),t===Ni.LESS)return e<r;if(t===Ni.LEQUAL)return e<=r;if(t===Ni.GREATER)return e>r;if(t===Ni.GEQUAL)return e>=r;throw new Error("whoops")}function i0(e){return!!(e&&!(e&e-1))}function Rv(e,r){return e!=null?e:r}function i4(e){return e===void 0?null:e}function _N(e,r,t){e.length=r,e.fill(t)}function a0(e,r){var t=r-1;return e+t&~t}function yN(e,r){return((e+r-1)/r|0)*r}function a4(e,r,t){for(var n=0,i=e.length;n<i;){var a=n+(i-n>>>1),s=t(r,e[a]);s<0?i=a:n=a+1}return n}function xN(e,r,t){var n=a4(e,r,t);e.splice(n,0,r)}function bN(e,r,t){return t?e|=r:e&=~r,e}function o4(e,r){for(var t=new Array(e),n=0;n<e;n++)t[n]=r();return t}function s4(e,r){r===void 0&&(r=1);var t=e.split(`
`);return t.map(function(n,i){return"".concat(u4(""+(r+i),4," "),"  ").concat(n)}).join(`
`)}function u4(e,r,t){for(t===void 0&&(t="0");e.length<r;)e="".concat(t).concat(e);return e}function EN(e,r){for(var t=[],n=e;n<e+r;n++)t.push(n);return t}function ME(e,r){e.blendDstFactor=r.blendDstFactor,e.blendSrcFactor=r.blendSrcFactor,e.blendMode=r.blendMode}function o0(e,r){return e===void 0&&(e={}),e.compare=r.compare,e.depthFailOp=r.depthFailOp,e.passOp=r.passOp,e.failOp=r.failOp,e}function IE(e,r){return e===void 0&&(e={rgbBlendState:{},alphaBlendState:{},channelWriteMask:0}),ME(e.rgbBlendState,r.rgbBlendState),ME(e.alphaBlendState,r.alphaBlendState),e.channelWriteMask=r.channelWriteMask,e}function A_(e,r){e.length!==r.length&&(e.length=r.length);for(var t=0;t<r.length;t++)e[t]=IE(e[t],r[t])}function l4(e,r){r.attachmentsState!==void 0&&A_(e.attachmentsState,r.attachmentsState),e.blendConstant&&r.blendConstant&&CE(e.blendConstant,r.blendConstant),e.depthCompare=Rv(r.depthCompare,e.depthCompare),e.depthWrite=Rv(r.depthWrite,e.depthWrite),e.stencilWrite=Rv(r.stencilWrite,e.stencilWrite),e.stencilFront&&r.stencilFront&&o0(e.stencilFront,r.stencilFront),e.stencilBack&&r.stencilBack&&o0(e.stencilBack,r.stencilBack),e.cullMode=Rv(r.cullMode,e.cullMode),e.frontFace=Rv(r.frontFace,e.frontFace),e.polygonOffset=Rv(r.polygonOffset,e.polygonOffset)}function Mv(e){var r=Object.assign({},e);return r.attachmentsState=[],A_(r.attachmentsState,e.attachmentsState),r.blendConstant=r.blendConstant&&RE(r.blendConstant),r.stencilFront=o0(void 0,e.stencilFront),r.stencilBack=o0(void 0,e.stencilBack),r}function c4(e,r){r.channelWriteMask!==void 0&&(e.channelWriteMask=r.channelWriteMask),r.rgbBlendMode!==void 0&&(e.rgbBlendState.blendMode=r.rgbBlendMode),r.alphaBlendMode!==void 0&&(e.alphaBlendState.blendMode=r.alphaBlendMode),r.rgbBlendSrcFactor!==void 0&&(e.rgbBlendState.blendSrcFactor=r.rgbBlendSrcFactor),r.alphaBlendSrcFactor!==void 0&&(e.alphaBlendState.blendSrcFactor=r.alphaBlendSrcFactor),r.rgbBlendDstFactor!==void 0&&(e.rgbBlendState.blendDstFactor=r.rgbBlendDstFactor),r.alphaBlendDstFactor!==void 0&&(e.alphaBlendState.blendDstFactor=r.alphaBlendDstFactor)}var PE={blendMode:iu.ADD,blendSrcFactor:Xi.ONE,blendDstFactor:Xi.ZERO},Id={attachmentsState:[{channelWriteMask:au.ALL,rgbBlendState:PE,alphaBlendState:PE}],blendConstant:RE(S_),depthWrite:!0,depthCompare:Ni.LEQUAL,stencilWrite:!1,stencilFront:{compare:Ni.ALWAYS,passOp:Ho.KEEP,depthFailOp:Ho.KEEP,failOp:Ho.KEEP},stencilBack:{compare:Ni.ALWAYS,passOp:Ho.KEEP,depthFailOp:Ho.KEEP,failOp:Ho.KEEP},cullMode:jl.NONE,frontFace:Nm.CCW,polygonOffset:!1};function f4(e,r){e===void 0&&(e=null),r===void 0&&(r=Id);var t=Mv(r);return e!==null&&l4(t,e),t}var SN=f4({depthCompare:Ni.ALWAYS,depthWrite:!1},Id);function AN(e,r){return e.attachmentsState===void 0&&(e.attachmentsState=[],A_(e.attachmentsState,Id.attachmentsState)),c4(e.attachmentsState[0],r),e}var OE={texture:null,sampler:null,formatKind:Wo.Float,dimension:Wi.TEXTURE_2D};function Lp(e,r,t){if(e.length!==r.length)return!1;for(var n=0;n<e.length;n++)if(!t(e[n],r[n]))return!1;return!0}function Iv(e,r){for(var t=Array(e.length),n=0;n<e.length;n++)t[n]=r(e[n]);return t}function h4(e,r){return e.texture===r.texture&&e.binding===r.binding}function kE(e,r){return e.buffer===r.buffer&&e.size===r.size&&e.binding===r.binding&&e.offset===r.offset}function p4(e,r){return e===null?r===null:r===null?!1:e.sampler===r.sampler&&e.texture===r.texture&&e.dimension===r.dimension&&e.formatKind===r.formatKind&&e.comparison===r.comparison}function TN(e,r){return e.samplerBindings=e.samplerBindings||[],e.uniformBufferBindings=e.uniformBufferBindings||[],e.storageBufferBindings=e.storageBufferBindings||[],e.storageTextureBindings=e.storageTextureBindings||[],r.samplerBindings=r.samplerBindings||[],r.uniformBufferBindings=r.uniformBufferBindings||[],r.storageBufferBindings=r.storageBufferBindings||[],r.storageTextureBindings=r.storageTextureBindings||[],!(e.samplerBindings.length!==r.samplerBindings.length||!Lp(e.samplerBindings,r.samplerBindings,p4)||!Lp(e.uniformBufferBindings,r.uniformBufferBindings,kE)||!Lp(e.storageBufferBindings,r.storageBufferBindings,kE)||!Lp(e.storageTextureBindings,r.storageTextureBindings,h4))}function DE(e,r){return e.blendMode==r.blendMode&&e.blendSrcFactor===r.blendSrcFactor&&e.blendDstFactor===r.blendDstFactor}function d4(e,r){return!(!DE(e.rgbBlendState,r.rgbBlendState)||!DE(e.alphaBlendState,r.alphaBlendState)||e.channelWriteMask!==r.channelWriteMask)}function s0(e,r){return e.compare==r.compare&&e.depthFailOp===r.depthFailOp&&e.failOp===r.failOp&&e.passOp===r.passOp}function v4(e,r){return!Lp(e.attachmentsState,r.attachmentsState,d4)||e.blendConstant&&r.blendConstant&&!wE(e.blendConstant,r.blendConstant)||e.stencilFront&&r.stencilFront&&!s0(e.stencilFront,r.stencilFront)||e.stencilBack&&r.stencilBack&&!s0(e.stencilBack,r.stencilBack)?!1:e.depthCompare===r.depthCompare&&e.depthWrite===r.depthWrite&&e.stencilWrite===r.stencilWrite&&e.cullMode===r.cullMode&&e.frontFace===r.frontFace&&e.polygonOffset===r.polygonOffset}function LE(e,r){return e.id===r.id}function m4(e,r){return e===r}function wN(e,r){return!(e.topology!==r.topology||e.inputLayout!==r.inputLayout||e.sampleCount!==r.sampleCount||e.megaStateDescriptor&&r.megaStateDescriptor&&!v4(e.megaStateDescriptor,r.megaStateDescriptor)||!LE(e.program,r.program)||!Lp(e.colorAttachmentFormats,r.colorAttachmentFormats,m4)||e.depthStencilAttachmentFormat!==r.depthStencilAttachmentFormat)}function g4(e,r){return e.offset===r.offset&&e.shaderLocation===r.shaderLocation&&e.format===r.format&&e.divisor===r.divisor}function _4(e,r){return isNil(e)?isNil(r):isNil(r)?!1:e.arrayStride===r.arrayStride&&e.stepMode===r.stepMode&&Lp(e.attributes,r.attributes,g4)}function CN(e,r){return!(e.indexBufferFormat!==r.indexBufferFormat||!Lp(e.vertexBufferDescriptors,r.vertexBufferDescriptors,_4)||!LE(e.program,r.program))}function RN(e,r){return e.addressModeU===r.addressModeU&&e.addressModeV===r.addressModeV&&e.minFilter===r.minFilter&&e.magFilter===r.magFilter&&e.mipmapFilter===r.mipmapFilter&&e.lodMinClamp===r.lodMinClamp&&e.lodMaxClamp===r.lodMaxClamp&&e.maxAnisotropy===r.maxAnisotropy&&e.compareFunction===r.compareFunction}function y4(e){var r=e.sampler,t=e.texture,n=e.dimension,i=e.formatKind,a=e.comparison;return{sampler:r,texture:t,dimension:n,formatKind:i,comparison:a}}function BE(e){var r=e.buffer,t=e.size,n=e.binding,i=e.offset;return{binding:n,buffer:r,offset:i,size:t}}function x4(e){var r=e.binding,t=e.texture;return{binding:r,texture:t}}function MN(e){var r=e.samplerBindings&&Iv(e.samplerBindings,y4),t=e.uniformBufferBindings&&Iv(e.uniformBufferBindings,BE),n=e.storageBufferBindings&&Iv(e.storageBufferBindings,BE),i=e.storageTextureBindings&&Iv(e.storageTextureBindings,x4);return{samplerBindings:r,uniformBufferBindings:t,storageBufferBindings:n,storageTextureBindings:i,pipeline:e.pipeline}}function IN(e){var r=e.inputLayout,t=e.program,n=e.topology,i=e.megaStateDescriptor&&Mv(e.megaStateDescriptor),a=e.colorAttachmentFormats.slice(),s=e.depthStencilAttachmentFormat,l=e.sampleCount;return{inputLayout:r,megaStateDescriptor:i,program:t,topology:n,colorAttachmentFormats:a,depthStencilAttachmentFormat:s,sampleCount:l}}function b4(e){var r=e.shaderLocation,t=e.format,n=e.offset,i=e.divisor;return{shaderLocation:r,format:t,offset:n,divisor:i}}function E4(e){if(isNil(e))return e;var r=e.arrayStride,t=e.stepMode,n=Iv(e.attributes,b4);return{arrayStride:r,stepMode:t,attributes:n}}function PN(e){var r=Iv(e.vertexBufferDescriptors,E4),t=e.indexBufferFormat,n=e.program;return{vertexBufferDescriptors:r,indexBufferFormat:t,program:n}}var ra,S4=/([^[]*)(\[[0-9]+\])?/;function A4(e){if(e[e.length-1]!=="]")return{name:e,length:1,isArray:!1};var r=e.match(S4);if(!r||r.length<2)throw new Error("Failed to parse GLSL uniform name ".concat(e));return{name:r[1],length:Number(r[2])||1,isArray:!!r[2]}}function xl(){var e=null;return function(r,t,n){var i=e!==n;return i&&(r.uniform1i(t,n),e=n),i}}function Go(e,r,t,n){var i=null,a=null;return function(s,l,f){var d=r(f,t),y=d.length,b=!1;if(i===null)i=new Float32Array(y),a=y,b=!0;else{Oi(a===y,"Uniform length cannot change.");for(var T=0;T<y;++T)if(d[T]!==i[T]){b=!0;break}}return b&&(n(s,e,l,d),i.set(d)),b}}function Qu(e,r,t,n){e[r](t,n)}function qh(e,r,t,n){e[r](t,!1,n)}var T4={},w4={},C4={},FE=[0];function T_(e,r,t,n){r===1&&typeof e=="boolean"&&(e=e?1:0),Number.isFinite(e)&&(FE[0]=e,e=FE);var i=e.length;if(e instanceof t)return e;var a=n[i];a||(a=new t(i),n[i]=a);for(var s=0;s<i;s++)a[s]=e[s];return a}function vc(e,r){return T_(e,r,Float32Array,T4)}function Bp(e,r){return T_(e,r,Int32Array,w4)}function u0(e,r){return T_(e,r,Uint32Array,C4)}var R4=(ra={},ra[Xe.FLOAT]=Go.bind(null,"uniform1fv",vc,1,Qu),ra[Xe.FLOAT_VEC2]=Go.bind(null,"uniform2fv",vc,2,Qu),ra[Xe.FLOAT_VEC3]=Go.bind(null,"uniform3fv",vc,3,Qu),ra[Xe.FLOAT_VEC4]=Go.bind(null,"uniform4fv",vc,4,Qu),ra[Xe.INT]=Go.bind(null,"uniform1iv",Bp,1,Qu),ra[Xe.INT_VEC2]=Go.bind(null,"uniform2iv",Bp,2,Qu),ra[Xe.INT_VEC3]=Go.bind(null,"uniform3iv",Bp,3,Qu),ra[Xe.INT_VEC4]=Go.bind(null,"uniform4iv",Bp,4,Qu),ra[Xe.BOOL]=Go.bind(null,"uniform1iv",Bp,1,Qu),ra[Xe.BOOL_VEC2]=Go.bind(null,"uniform2iv",Bp,2,Qu),ra[Xe.BOOL_VEC3]=Go.bind(null,"uniform3iv",Bp,3,Qu),ra[Xe.BOOL_VEC4]=Go.bind(null,"uniform4iv",Bp,4,Qu),ra[Xe.FLOAT_MAT2]=Go.bind(null,"uniformMatrix2fv",vc,4,qh),ra[Xe.FLOAT_MAT3]=Go.bind(null,"uniformMatrix3fv",vc,9,qh),ra[Xe.FLOAT_MAT4]=Go.bind(null,"uniformMatrix4fv",vc,16,qh),ra[Xe.UNSIGNED_INT]=Go.bind(null,"uniform1uiv",u0,1,Qu),ra[Xe.UNSIGNED_INT_VEC2]=Go.bind(null,"uniform2uiv",u0,2,Qu),ra[Xe.UNSIGNED_INT_VEC3]=Go.bind(null,"uniform3uiv",u0,3,Qu),ra[Xe.UNSIGNED_INT_VEC4]=Go.bind(null,"uniform4uiv",u0,4,Qu),ra[Xe.FLOAT_MAT2x3]=Go.bind(null,"uniformMatrix2x3fv",vc,6,qh),ra[Xe.FLOAT_MAT2x4]=Go.bind(null,"uniformMatrix2x4fv",vc,8,qh),ra[Xe.FLOAT_MAT3x2]=Go.bind(null,"uniformMatrix3x2fv",vc,6,qh),ra[Xe.FLOAT_MAT3x4]=Go.bind(null,"uniformMatrix3x4fv",vc,12,qh),ra[Xe.FLOAT_MAT4x2]=Go.bind(null,"uniformMatrix4x2fv",vc,8,qh),ra[Xe.FLOAT_MAT4x3]=Go.bind(null,"uniformMatrix4x3fv",vc,12,qh),ra[Xe.SAMPLER_2D]=xl,ra[Xe.SAMPLER_CUBE]=xl,ra[Xe.SAMPLER_3D]=xl,ra[Xe.SAMPLER_2D_SHADOW]=xl,ra[Xe.SAMPLER_2D_ARRAY]=xl,ra[Xe.SAMPLER_2D_ARRAY_SHADOW]=xl,ra[Xe.SAMPLER_CUBE_SHADOW]=xl,ra[Xe.INT_SAMPLER_2D]=xl,ra[Xe.INT_SAMPLER_3D]=xl,ra[Xe.INT_SAMPLER_CUBE]=xl,ra[Xe.INT_SAMPLER_2D_ARRAY]=xl,ra[Xe.UNSIGNED_INT_SAMPLER_2D]=xl,ra[Xe.UNSIGNED_INT_SAMPLER_3D]=xl,ra[Xe.UNSIGNED_INT_SAMPLER_CUBE]=xl,ra[Xe.UNSIGNED_INT_SAMPLER_2D_ARRAY]=xl,ra);function NE(e,r,t){var n=R4[t.type];if(!n)throw new Error("Unknown GLSL uniform type ".concat(t.type));return n().bind(null,e,r)}var M4={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function I4(e){return Object.prototype.toString.call(e)in M4}function zm(e,r){return"#define ".concat(e," ").concat(r)}function P4(e){var r={};return e.replace(/^\s*#define\s*(\S*)\s*(\S*)\s*$/gm,function(t,n,i){var a=Number(i);return r[n]=isNaN(a)?i:a,""}),r}function O4(e,r){var t=[];return e.replace(/^\s*layout\(location\s*=\s*(\S*)\)\s*in\s+\S+\s*(.*);$/gm,function(n,i,a){var s=Number(i);return t.push({location:isNaN(s)?r[i]:s,name:a}),""}),t}function ON(e){var r=[],t=[];return e.replace(/\s*struct\s*(.*)\s*{((?:\s*.*\s*)*?)};/g,function(n,i,a){var s=[];return a.trim().replace(`\r
`,`
`).split(`
`).forEach(function(l){var f=__read(l.trim().split(/\s+/),2),d=f[0],y=f[1];s.push({type:d.trim(),name:y.replace(";","").trim()})}),t.push({type:i.trim(),uniforms:s}),""}),e.replace(/\s*uniform(?:\s+)(?:\w+)(?:\s?){([^]*?)};?/g,function(n,i){return i.trim().replace(`\r
`,`
`).split(`
`).forEach(function(a){var s=a.trim().split(" "),l=s[0]||"",f=s[1]||"",d=f.indexOf("[")>-1;if(f=f.replace(";","").replace("[","").trim(),!l.startsWith("#")){if(l){var y=t.find(function(M){return l===M.type});if(y)if(d)for(var b=function(M){y.uniforms.forEach(function(P){r.push("".concat(f,"[").concat(M,"].").concat(P.name))})},T=0;T<5;T++)b(T);else y.uniforms.forEach(function(M){r.push("".concat(f,".").concat(M.name))})}f&&r.push(f)}}),""}),r}function UE(e){if(e===void 0)return null;var r=/binding\s*=\s*(\d+)/.exec(e);if(r!==null){var t=parseInt(r[1],10);if(!Number.isNaN(t))return t}return null}function k4(e){var r="",t=e;return[t,r]}function Fp(e,r,t,n,i){var a;n===void 0&&(n=null),i===void 0&&(i=!0);var s=e.glslVersion==="#version 100",l=r==="frag"&&((a=t.match(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm))===null||a===void 0?void 0:a.length)>1,f=t.replace(`\r
`,`
`).split(`
`).map(function(ut){return ut.replace(/[/][/].*$/,"")}).filter(function(ut){var ot=!ut||/^\s+$/.test(ut);return!ot}),d="";n!==null&&(d=Object.keys(n).map(function(ut){return zm(ut,n[ut])}).join(`
`));var y=f.find(function(ut){return ut.startsWith("precision")})||"precision mediump float;",b=i?f.filter(function(ut){return!ut.startsWith("precision")}).join(`
`):f.join(`
`),T="";if(e.viewportOrigin===Av.UPPER_LEFT&&(T+="".concat(zm("VIEWPORT_ORIGIN_TL","1"),`
`)),e.clipSpaceNearZ===Tv.ZERO&&(T+="".concat(zm("CLIPSPACE_NEAR_ZERO","1"),`
`)),e.explicitBindingLocations){var M=0,P=0,k=0;b=b.replace(/^\s*(layout\((.*)\))?\s*uniform(.+{)$/gm,function(ut,ot,Ct,Xt){var Sr=Ct?"".concat(Ct,", "):"";return"layout(".concat(Sr,"set = ").concat(M,", binding = ").concat(P++,") uniform ").concat(Xt)}),M++,P=0,Oi(e.separateSamplerTextures),b=b.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(ut,ot,Ct,Xt,Sr){var _r=UE(Ct);_r===null&&(_r=P++);var Wr=(0,In.CR)(k4(Xt),2),Cn=Wr[0],wi=Wr[1];return r==="frag"?`
layout(set = `.concat(M,", binding = ").concat(_r*2+0,") uniform texture").concat(Cn," T_").concat(Sr,`;
layout(set = `).concat(M,", binding = ").concat(_r*2+1,") uniform sampler").concat(wi," S_").concat(Sr,";").trim():""}),b=b.replace(r==="frag"?/^\s*\b(varying|in)\b/gm:/^\s*\b(varying|out)\b/gm,function(ut,ot){return"layout(location = ".concat(k++,") ").concat(ot)}),T+="".concat(zm("gl_VertexID","gl_VertexIndex"),`
`),T+="".concat(zm("gl_InstanceID","gl_InstanceIndex"),`
`),y=y.replace(/^precision (.*) sampler(.*);$/gm,"")}else{var H=0;b=b.replace(/^\s*(layout\((.*)\))?\s*uniform sampler(\w+) (.*);/gm,function(ut,ot,Ct,Xt,Sr){var _r=UE(Ct);return _r===null&&(_r=H++),"uniform sampler".concat(Xt," ").concat(Sr,"; // BINDING=").concat(_r)})}if(e.separateSamplerTextures)b=b.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(ut,ot,Ct){return"sampler".concat(ot,"(T_").concat(Ct,", S_").concat(Ct,")")}),b=b.replace(/\bTEXTURE\((.*?)\)/g,function(ut,ot){return"T_".concat(ot)});else{var q=[];b=b.replace(/\bSAMPLER_(\w+)\((.*?)\)/g,function(ut,ot,Ct){return q.push([Ct,ot]),Ct}),s&&q.forEach(function(ut){var ot=(0,In.CR)(ut,2),Ct=ot[0],Xt=ot[1];b=b.replace(new RegExp("texture\\(".concat(Ct),"g"),function(){return"texture".concat(Xt,"(").concat(Ct)})}),b=b.replace(/\bTEXTURE\((.*?)\)/g,function(ut,ot){return ot})}var ae="".concat(s?"":e.glslVersion,`
`).concat(s&&l?`#extension GL_EXT_draw_buffers : require
`:"",`
`).concat(s&&r==="frag"?`#extension GL_OES_standard_derivatives : enable
`:"").concat(i?y:"",`
`).concat(T||"").concat(d?d+`
`:"",`
`).concat(b,`
`).trim();if(e.explicitBindingLocations&&r==="frag"&&(ae=ae.replace(/^\b(out)\b/g,function(ut,ot){return"layout(location = 0) ".concat(ot)})),s){if(r==="frag"&&(ae=ae.replace(/^\s*in\s+(\S+)\s*(.*);$/gm,function(ut,ot,Ct){return"varying ".concat(ot," ").concat(Ct,`;
`)})),r==="vert"&&(ae=ae.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(ut,ot,Ct){return"varying ".concat(ot," ").concat(Ct,`;
`)}),ae=ae.replace(/^\s*layout\(location\s*=\s*\S*\)\s*in\s+(\S+)\s*(.*);$/gm,function(ut,ot,Ct){return"attribute ".concat(ot," ").concat(Ct,`;
`)})),ae=ae.replace(/\s*uniform\s*.*\s*{((?:\s*.*\s*)*?)};/g,function(ut,ot){return ot.trim().replace(/^.*$/gm,function(Ct){var Xt=Ct.trim();return Xt.startsWith("#")?Xt:Ct?"uniform ".concat(Xt):""})}),r==="frag")if(l){var Se=[];ae=ae.replace(/^\s*layout\(location\s*=\s*\d*\)\s*out\s+vec4\s*(.*);$/gm,function(ut,ot){return Se.push(ot),"vec4 ".concat(ot,`;
`)});var ze=ae.lastIndexOf("}");ae=ae.substring(0,ze)+`
    `.concat(Se.map(function(ut,ot){return"gl_FragData[".concat(ot,"] = ").concat(ut,`;
    `)}).join(`
`))+ae.substring(ze)}else{var it;if(ae=ae.replace(/^\s*out\s+(\S+)\s*(.*);$/gm,function(ut,ot,Ct){return it=Ct,"".concat(ot," ").concat(Ct,`;
`)}),it){var ze=ae.lastIndexOf("}");ae=ae.substring(0,ze)+`
  gl_FragColor = vec4(`.concat(it,`);
`)+ae.substring(ze)}}ae=ae.replace(/^\s*layout\((.*)\)/gm,"")}return ae}function kN(e,r,t,n){n===void 0&&(n=null);var i=Fp(e,"vert",r,n),a=Fp(e,"frag",t,n);return{vert:r,frag:t,preprocessedVert:i,preprocessedFrag:a}}var Ef=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this)||this;return a.id=n,a.device=i,a.device.resourceCreationTracker!==null&&a.device.resourceCreationTracker.trackResourceCreated(a),a}return r.prototype.destroy=function(){this.device.resourceCreationTracker!==null&&this.device.resourceCreationTracker.trackResourceDestroyed(this)},r}(bE.Z),D4=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ga.Bindings;var l=a.uniformBufferBindings,f=a.samplerBindings;return s.uniformBufferBindings=l||[],s.samplerBindings=f||[],s.bindingLayouts=s.createBindingLayouts(),s}return r.prototype.createBindingLayouts=function(){var t=0,n=0,i=[],a=this.uniformBufferBindings.length,s=this.samplerBindings.length;return i.push({firstUniformBuffer:t,numUniformBuffers:a,firstSampler:n,numSamplers:s}),t+=a,n+=s,{numUniformBuffers:t,numSamplers:n,bindingLayoutTables:i}},r}(Ef);function Vn(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}function zE(e){var r=sh(e);switch(r){case Ir.BC1:case Ir.BC2:case Ir.BC3:case Ir.BC4_UNORM:case Ir.BC4_SNORM:case Ir.BC5_UNORM:case Ir.BC5_SNORM:return!0;default:return!1}}function ZE(e){var r=wv(e);if(r&wn.Normalized)return!1;var t=sh(e);return t===Ir.S8||t===Ir.S16||t===Ir.S32||t===Ir.U8||t===Ir.U16||t===Ir.U32}function L4(e){switch(e){case bf.STATIC:return Xe.STATIC_DRAW;case bf.DYNAMIC:return Xe.DYNAMIC_DRAW}}function VE(e){if(e&ro.INDEX)return Xe.ELEMENT_ARRAY_BUFFER;if(e&ro.VERTEX)return Xe.ARRAY_BUFFER;if(e&ro.UNIFORM)return Xe.UNIFORM_BUFFER}function B4(e){switch(e){case ws.TRIANGLES:return Xe.TRIANGLES;case ws.POINTS:return Xe.POINTS;case ws.TRIANGLE_STRIP:return Xe.TRIANGLE_STRIP;case ws.LINES:return Xe.LINES;case ws.LINE_STRIP:return Xe.LINE_STRIP;default:throw new Error("Unknown primitive topology mode")}}function F4(e){switch(e){case Ir.U8:return Xe.UNSIGNED_BYTE;case Ir.U16:return Xe.UNSIGNED_SHORT;case Ir.U32:return Xe.UNSIGNED_INT;case Ir.S8:return Xe.BYTE;case Ir.S16:return Xe.SHORT;case Ir.S32:return Xe.INT;case Ir.F16:return Xe.HALF_FLOAT;case Ir.F32:return Xe.FLOAT;default:throw new Error("whoops")}}function N4(e){switch(e){case Wn.R:return 1;case Wn.RG:return 2;case Wn.RGB:return 3;case Wn.RGBA:return 4;default:return 1}}function U4(e){var r=sh(e),t=n0(e),n=wv(e),i=F4(r),a=N4(t),s=!!(n&wn.Normalized);return{size:a,type:i,normalized:s}}function z4(e){switch(e){case kt.U8_R:return Xe.UNSIGNED_BYTE;case kt.U16_R:return Xe.UNSIGNED_SHORT;case kt.U32_R:return Xe.UNSIGNED_INT;default:throw new Error("whoops")}}function Zm(e){switch(e){case yl.CLAMP_TO_EDGE:return Xe.CLAMP_TO_EDGE;case yl.REPEAT:return Xe.REPEAT;case yl.MIRRORED_REPEAT:return Xe.MIRRORED_REPEAT;default:throw new Error("whoops")}}function l0(e,r){if(r===Xs.LINEAR&&e===es.BILINEAR)return Xe.LINEAR_MIPMAP_LINEAR;if(r===Xs.LINEAR&&e===es.POINT)return Xe.NEAREST_MIPMAP_LINEAR;if(r===Xs.NEAREST&&e===es.BILINEAR)return Xe.LINEAR_MIPMAP_NEAREST;if(r===Xs.NEAREST&&e===es.POINT)return Xe.NEAREST_MIPMAP_NEAREST;if(r===Xs.NO_MIP&&e===es.BILINEAR)return Xe.LINEAR;if(r===Xs.NO_MIP&&e===es.POINT)return Xe.NEAREST;throw new Error("Unknown texture filter mode")}function Pv(e,r){r===void 0&&(r=0);var t=e;return t.gl_buffer_pages[r/t.pageByteSize|0]}function Ov(e){var r=e;return r.gl_texture}function w_(e){var r=e;return r.gl_sampler}function Vm(e,r){e.name=r,e.__SPECTOR_Metadata={name:r}}function jE(e,r){for(var t=[];;){var n=r.exec(e);if(!n)break;t.push(n)}return t}function Np(e){return e.blendMode==iu.ADD&&e.blendSrcFactor==Xi.ONE&&e.blendDstFactor===Xi.ZERO}function Z4(e){switch(e){case r0.OcclusionConservative:return Xe.ANY_SAMPLES_PASSED_CONSERVATIVE;default:throw new Error("whoops")}}function V4(e){if(e===Wi.TEXTURE_2D)return Xe.TEXTURE_2D;if(e===Wi.TEXTURE_2D_ARRAY)return Xe.TEXTURE_2D_ARRAY;if(e===Wi.TEXTURE_CUBE_MAP)return Xe.TEXTURE_CUBE_MAP;if(e===Wi.TEXTURE_3D)return Xe.TEXTURE_3D;throw new Error("whoops")}function C_(e,r,t,n){return!(e%t!==0||r%n!==0)}var j4=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ga.Buffer;var l=a.viewOrSize,f=a.usage,d=a.hint,y=d===void 0?bf.STATIC:d,b=i.uniformBufferMaxPageByteSize,T=i.gl,M=f&ro.UNIFORM;M||(Vn(T)?T.bindVertexArray(null):i.OES_vertex_array_object.bindVertexArrayOES(null));var P=(0,Sv.Z)(l)?a0(l,4):a0(l.byteLength,4);s.gl_buffer_pages=[];var k;if(M){for(var H=P;H>0;)s.gl_buffer_pages.push(s.createBufferPage(Math.min(H,b),f,y)),H-=b;k=b}else s.gl_buffer_pages.push(s.createBufferPage(P,f,y)),k=P;return s.pageByteSize=k,s.byteSize=P,s.usage=f,s.gl_target=VE(f),(0,Sv.Z)(l)||s.setSubData(0,new Uint8Array(l.buffer)),M||(Vn(T)?T.bindVertexArray(s.device.currentBoundVAO):i.OES_vertex_array_object.bindVertexArrayOES(s.device.currentBoundVAO)),s}return r.prototype.setSubData=function(t,n,i,a){i===void 0&&(i=0),a===void 0&&(a=n.byteLength-i);for(var s=this.device.gl,l=this.pageByteSize,f=t+a,d=t,y=t%l;d<f;){var b=Vn(s)?s.COPY_WRITE_BUFFER:this.gl_target,T=Pv(this,d);if(T.ubo)return;s.bindBuffer(b,T),Vn(s)?s.bufferSubData(b,y,n,i,Math.min(f-d,l)):s.bufferSubData(b,y,n),d+=l,y=0,i+=l,this.device.debugGroupStatisticsBufferUpload()}},r.prototype.destroy=function(){e.prototype.destroy.call(this);for(var t=0;t<this.gl_buffer_pages.length;t++)this.gl_buffer_pages[t].ubo||this.device.gl.deleteBuffer(this.gl_buffer_pages[t]);this.gl_buffer_pages=[]},r.prototype.createBufferPage=function(t,n,i){var a=this.device.gl,s=n&ro.UNIFORM;if(!Vn(a)&&s)return{ubo:!0};var l=this.device.ensureResourceExists(a.createBuffer()),f=VE(n),d=L4(i);return a.bindBuffer(f,l),a.bufferData(f,t,d),l},r}(Ef),H4=function(e){(0,In.ZT)(r,e);function r(t){var n,i,a,s,l=t.id,f=t.device,d=t.descriptor,y,b=e.call(this,{id:l,device:f})||this;b.type=ga.InputLayout;var T=d.vertexBufferDescriptors,M=d.indexBufferFormat,P=d.program;Oi(M===kt.U16_R||M===kt.U32_R||M===null);var k=M!==null?z4(M):null,H=M!==null?AE(M):null,q=b.device.gl,ae=b.device.ensureResourceExists(Vn(q)?q.createVertexArray():f.OES_vertex_array_object.createVertexArrayOES());Vn(q)?q.bindVertexArray(ae):f.OES_vertex_array_object.bindVertexArrayOES(ae),q.bindBuffer(q.ARRAY_BUFFER,Pv(b.device.fallbackVertexBuffer));try{for(var Se=(0,In.XA)(d.vertexBufferDescriptors),ze=Se.next();!ze.done;ze=Se.next()){var it=ze.value,ut=it.stepMode,ot=it.attributes;try{for(var Ct=(a=void 0,(0,In.XA)(ot)),Xt=Ct.next();!Xt.done;Xt=Ct.next()){var Sr=Xt.value,_r=Sr.shaderLocation,Wr=Sr.format,Cn=Sr.divisor,wi=Cn===void 0?1:Cn,ua=Vn(q)?_r:(y=P.attributes[_r])===null||y===void 0?void 0:y.location,co=U4(Wr);if(Sr.vertexFormat=co,!(0,Dp.Z)(ua)){ZE(Wr);var Xo=co.size,No=co.type,Ys=co.normalized;q.vertexAttribPointer(ua,Xo,No,Ys,0,0),ut===Rd.INSTANCE&&(Vn(q)?q.vertexAttribDivisor(ua,wi):f.ANGLE_instanced_arrays.vertexAttribDivisorANGLE(ua,wi)),q.enableVertexAttribArray(ua)}}}catch(bl){a={error:bl}}finally{try{Xt&&!Xt.done&&(s=Ct.return)&&s.call(Ct)}finally{if(a)throw a.error}}}}catch(bl){n={error:bl}}finally{try{ze&&!ze.done&&(i=Se.return)&&i.call(Se)}finally{if(n)throw n.error}}return Vn(q)?q.bindVertexArray(null):f.OES_vertex_array_object.bindVertexArrayOES(null),b.vertexBufferDescriptors=T,b.vao=ae,b.indexBufferFormat=M,b.indexBufferType=k,b.indexBufferCompByteSize=H,b.program=P,b}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.currentBoundVAO===this.vao&&(Vn(this.device.gl)?(this.device.gl.bindVertexArray(null),this.device.gl.deleteVertexArray(this.vao)):(this.device.OES_vertex_array_object.bindVertexArrayOES(null),this.device.OES_vertex_array_object.deleteVertexArrayOES(this.vao)),this.device.currentBoundVAO=null)},r}(Ef),R_=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=t.fake,l=e.call(this,{id:n,device:i})||this;l.type=ga.Texture,a=(0,In.pi)({dimension:Wi.TEXTURE_2D,depthOrArrayLayers:1,mipLevelCount:1},a);var f=l.device.gl,d,y,b=l.clampmipLevelCount(a);if(l.immutable=a.usage===Ou.RENDER_TARGET,l.pixelStore=a.pixelStore,l.format=a.format,l.dimension=a.dimension,l.formatKind=TE(a.format),l.width=a.width,l.height=a.height,l.depthOrArrayLayers=a.depthOrArrayLayers,l.mipmaps=b>=1,!s){y=l.device.ensureResourceExists(f.createTexture());var T=l.device.translateTextureType(a.format),M=l.device.translateTextureInternalFormat(a.format);if(l.device.setActiveTexture(f.TEXTURE0),l.device.currentTextures[0]=null,l.preprocessImage(),a.dimension===Wi.TEXTURE_2D){if(d=Xe.TEXTURE_2D,f.bindTexture(d,y),l.immutable)if(Vn(f))f.texStorage2D(d,b,M,a.width,a.height);else{var P=(M===Xe.DEPTH_COMPONENT||l.isNPOT(),0);(l.format===kt.D32F||l.format===kt.D24_S8)&&!Vn(f)&&!i.WEBGL_depth_texture||(f.texImage2D(d,P,M,a.width,a.height,0,M,T,null),l.mipmaps&&(l.mipmaps=!1,f.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_MIN_FILTER,Xe.LINEAR),f.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_WRAP_S,Xe.CLAMP_TO_EDGE),f.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_WRAP_T,Xe.CLAMP_TO_EDGE)))}Oi(a.depthOrArrayLayers===1)}else if(a.dimension===Wi.TEXTURE_2D_ARRAY)d=Xe.TEXTURE_2D_ARRAY,f.bindTexture(d,y),l.immutable&&Vn(f)&&f.texStorage3D(d,b,M,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Wi.TEXTURE_3D)d=Xe.TEXTURE_3D,f.bindTexture(d,y),l.immutable&&Vn(f)&&f.texStorage3D(d,b,M,a.width,a.height,a.depthOrArrayLayers);else if(a.dimension===Wi.TEXTURE_CUBE_MAP)d=Xe.TEXTURE_CUBE_MAP,f.bindTexture(d,y),l.immutable&&Vn(f)&&f.texStorage2D(d,b,M,a.width,a.height),Oi(a.depthOrArrayLayers===6);else throw new Error("whoops")}return l.gl_texture=y,l.gl_target=d,l.mipLevelCount=b,l}return r.prototype.setImageData=function(t,n){n===void 0&&(n=0);var i=this.device.gl;zE(this.format);var a=this.gl_target===Xe.TEXTURE_3D||this.gl_target===Xe.TEXTURE_2D_ARRAY,s=this.gl_target===Xe.TEXTURE_CUBE_MAP,l=I4(t[0]);this.device.setActiveTexture(i.TEXTURE0),this.device.currentTextures[0]=null;var f=t[0],d,y;l?(d=this.width,y=this.height):(d=f.width,y=f.height,this.width=d,this.height=y),i.bindTexture(this.gl_target,this.gl_texture);var b=this.device.translateTextureFormat(this.format),T=Vn(i)?this.device.translateInternalTextureFormat(this.format):b,M=this.device.translateTextureType(this.format);this.preprocessImage();for(var P=0;P<this.depthOrArrayLayers;P++){var k=t[P],H=this.gl_target;s&&(H=Xe.TEXTURE_CUBE_MAP_POSITIVE_X+P%6),this.immutable?i.texSubImage2D(H,n,0,0,d,y,b,M,k):Vn(i)?a?i.texImage3D(H,n,T,d,y,this.depthOrArrayLayers,0,b,M,k):i.texImage2D(H,n,T,d,y,0,b,M,k):l?i.texImage2D(H,n,b,d,y,0,b,M,k):i.texImage2D(H,n,b,b,M,k)}this.mipmaps&&this.generateMipmap(a)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteTexture(Ov(this))},r.prototype.clampmipLevelCount=function(t){if(t.dimension===Wi.TEXTURE_2D_ARRAY&&t.depthOrArrayLayers>1){var n=sh(t.format);if(n===Ir.BC1)for(var i=t.width,a=t.height,s=0;s<t.mipLevelCount;s++){if(i<=2||a<=2)return s-1;i=Math.max(i/2|0,1),a=Math.max(a/2|0,1)}}return t.mipLevelCount},r.prototype.preprocessImage=function(){var t=this.device.gl;this.pixelStore&&(this.pixelStore.unpackFlipY&&t.pixelStorei(Xe.UNPACK_FLIP_Y_WEBGL,!0),this.pixelStore.packAlignment&&t.pixelStorei(Xe.PACK_ALIGNMENT,this.pixelStore.packAlignment),this.pixelStore.unpackAlignment&&t.pixelStorei(Xe.UNPACK_ALIGNMENT,this.pixelStore.unpackAlignment))},r.prototype.generateMipmap=function(t){t===void 0&&(t=!1);var n=this.device.gl;return!Vn(n)&&this.isNPOT()?this:(this.gl_texture&&this.gl_target&&(n.bindTexture(this.gl_target,this.gl_texture),t?(n.texParameteri(this.gl_target,Xe.TEXTURE_BASE_LEVEL,0),n.texParameteri(this.gl_target,Xe.TEXTURE_MAX_LEVEL,Math.log2(this.width)),n.texParameteri(this.gl_target,Xe.TEXTURE_MIN_FILTER,Xe.LINEAR_MIPMAP_LINEAR),n.texParameteri(this.gl_target,Xe.TEXTURE_MAG_FILTER,Xe.LINEAR)):n.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_MIN_FILTER,Xe.NEAREST_MIPMAP_LINEAR),n.generateMipmap(this.gl_target),n.bindTexture(this.gl_target,null)),this)},r.prototype.isNPOT=function(){var t=this.device.gl;return Vn(t)?!1:!i0(this.width)||!i0(this.height)},r}(Ef),W4=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ga.RenderTarget,s.gl_renderbuffer=null,s.texture=null;var l=s.device.gl,f=a.format,d=a.width,y=a.height,b=a.sampleCount,T=b===void 0?1:b,M=a.texture,P=!1;if((f===kt.D32F||f===kt.D24_S8)&&M&&!Vn(l)&&!i.WEBGL_depth_texture&&(M.destroy(),s.texture=null,P=!0),!P&&M)s.texture=M;else{s.gl_renderbuffer=s.device.ensureResourceExists(l.createRenderbuffer()),l.bindRenderbuffer(l.RENDERBUFFER,s.gl_renderbuffer);var k=s.device.translateTextureInternalFormat(f,!0);Vn(l)&&T>1?l.renderbufferStorageMultisample(Xe.RENDERBUFFER,T,k,d,y):l.renderbufferStorage(Xe.RENDERBUFFER,k,d,y)}return s.format=f,s.width=d,s.height=y,s.sampleCount=T,s}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gl_renderbuffer!==null&&this.device.gl.deleteRenderbuffer(this.gl_renderbuffer),this.texture&&this.texture.destroy()},r}(Ef),Hl;(function(e){e[e.NeedsCompile=0]="NeedsCompile",e[e.Compiling=1]="Compiling",e[e.NeedsBind=2]="NeedsBind",e[e.ReadyToUse=3]="ReadyToUse"})(Hl||(Hl={}));var G4=function(e){(0,In.ZT)(r,e);function r(t,n){var i=t.id,a=t.device,s=t.descriptor,l=e.call(this,{id:i,device:a})||this;l.rawVertexGLSL=n,l.type=ga.Program,l.uniformSetters={},l.attributes=[];var f=l.device.gl;return l.descriptor=s,l.gl_program=l.device.ensureResourceExists(f.createProgram()),l.gl_shader_vert=null,l.gl_shader_frag=null,l.compileState=Hl.NeedsCompile,l.tryCompileProgram(),l}return r.prototype.destroy=function(){e.prototype.destroy.call(this),this.device.gl.deleteProgram(this.gl_program),this.device.gl.deleteShader(this.gl_shader_vert),this.device.gl.deleteShader(this.gl_shader_frag)},r.prototype.tryCompileProgram=function(){var t,n;Oi(this.compileState===Hl.NeedsCompile);var i=this.descriptor,a=this.device.gl;!((t=i.vertex)===null||t===void 0)&&t.glsl&&(!((n=i.fragment)===null||n===void 0)&&n.glsl)&&(this.gl_shader_vert=this.compileShader(i.vertex.glsl,a.VERTEX_SHADER),this.gl_shader_frag=this.compileShader(i.fragment.glsl,a.FRAGMENT_SHADER),a.attachShader(this.gl_program,this.gl_shader_vert),a.attachShader(this.gl_program,this.gl_shader_frag),a.linkProgram(this.gl_program),this.compileState=Hl.Compiling,Vn(a)||(this.readUniformLocationsFromLinkedProgram(),this.readAttributesFromLinkedProgram()))},r.prototype.readAttributesFromLinkedProgram=function(){for(var t,n=this.device.gl,i=n.getProgramParameter(this.gl_program,n.ACTIVE_ATTRIBUTES),a=P4(this.descriptor.vertex.glsl),s=O4(this.rawVertexGLSL,a),l=function(y){var b=n.getActiveAttrib(f.gl_program,y),T=b.name,M=b.type,P=b.size,k=n.getAttribLocation(f.gl_program,T),H=(t=s.find(function(q){return q.name===T}))===null||t===void 0?void 0:t.location;k>=0&&!(0,Dp.Z)(H)&&(f.attributes[H]={name:T,location:k,type:M,size:P})},f=this,d=0;d<i;d++)l(d)},r.prototype.readUniformLocationsFromLinkedProgram=function(){for(var t=this.device.gl,n=t.getProgramParameter(this.gl_program,t.ACTIVE_UNIFORMS),i=0;i<n;i++){var a=t.getActiveUniform(this.gl_program,i),s=A4(a.name).name,l=t.getUniformLocation(this.gl_program,s);if(this.uniformSetters[s]=NE(t,l,a),a&&a.size>1)for(var f=0;f<a.size;f++)l=t.getUniformLocation(this.gl_program,"".concat(s,"[").concat(f,"]")),this.uniformSetters["".concat(s,"[").concat(f,"]")]=NE(t,l,a)}},r.prototype.compileShader=function(t,n){var i=this.device.gl,a=this.device.ensureResourceExists(i.createShader(n));return i.shaderSource(a,t),i.compileShader(a),a},r.prototype.setUniformsLegacy=function(t){t===void 0&&(t={});var n=this.device.gl;if(!Vn(n)){var i=!1;for(var a in t){i||(n.useProgram(this.gl_program),i=!0);var s=t[a],l=this.uniformSetters[a];if(l){var f=s;f instanceof R_&&(f=f.textureIndex),l(f)}}}return this},r}(Ef),X4=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ga.QueryPool;var l=s.device.gl;if(Vn(l)){var f=a.elemCount,d=a.type;s.gl_query=o4(f,function(){return s.device.ensureResourceExists(l.createQuery())}),s.gl_query_type=Z4(d)}return s}return r.prototype.queryResultOcclusion=function(t){var n=this.device.gl;if(Vn(n)){var i=this.gl_query[t];return n.getQueryParameter(i,n.QUERY_RESULT_AVAILABLE)?!!n.getQueryParameter(i,n.QUERY_RESULT):null}return null},r.prototype.destroy=function(){e.prototype.destroy.call(this);var t=this.device.gl;if(Vn(t))for(var n=0;n<this.gl_query.length;n++)t.deleteQuery(this.gl_query[n])},r}(Ef),$4=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=ga.Readback,a.gl_pbo=null,a.gl_sync=null,a}return r.prototype.clientWaitAsync=function(t,n,i){n===void 0&&(n=0),i===void 0&&(i=10);var a=this.device.gl;return new Promise(function(s,l){function f(){var d=a.clientWaitSync(t,n,0);if(d==a.WAIT_FAILED){l();return}if(d==a.TIMEOUT_EXPIRED){setTimeout(f,(0,e4.Z)(i,0,a.MAX_CLIENT_WAIT_TIMEOUT_WEBGL));return}s()}f()})},r.prototype.getBufferSubDataAsync=function(t,n,i,a,s,l){return(0,In.mG)(this,void 0,void 0,function(){var f;return(0,In.Jh)(this,function(d){switch(d.label){case 0:return f=this.device.gl,Vn(f)?(this.gl_sync=f.fenceSync(f.SYNC_GPU_COMMANDS_COMPLETE,0),f.flush(),[4,this.clientWaitAsync(this.gl_sync,0,10)]):[3,2];case 1:return d.sent(),f.bindBuffer(t,n),f.getBufferSubData(t,i,a,s,l),f.bindBuffer(t,null),[2,a];case 2:return[2]}})})},r.prototype.readTexture=function(t,n,i,a,s,l,f,d){return f===void 0&&(f=0),d===void 0&&(d=l.byteLength||0),(0,In.mG)(this,void 0,void 0,function(){var y,b,T,M,P;return(0,In.Jh)(this,function(k){return y=this.device.gl,b=t,T=this.device.translateTextureFormat(b.format),M=this.device.translateTextureType(b.format),P=t4(b.format),Vn(y)?(this.gl_pbo=this.device.ensureResourceExists(y.createBuffer()),y.bindBuffer(y.PIXEL_PACK_BUFFER,this.gl_pbo),y.bufferData(y.PIXEL_PACK_BUFFER,d,y.STREAM_READ),y.bindBuffer(y.PIXEL_PACK_BUFFER,null),y.bindFramebuffer(Xe.READ_FRAMEBUFFER,this.device.readbackFramebuffer),y.framebufferTexture2D(Xe.READ_FRAMEBUFFER,Xe.COLOR_ATTACHMENT0,Xe.TEXTURE_2D,b.gl_texture,0),y.bindBuffer(y.PIXEL_PACK_BUFFER,this.gl_pbo),y.readPixels(n,i,a,s,T,M,f*P),y.bindBuffer(y.PIXEL_PACK_BUFFER,null),[2,this.getBufferSubDataAsync(y.PIXEL_PACK_BUFFER,this.gl_pbo,0,l,f,0)]):[2,this.readTextureSync(t,n,i,a,s,l,f,d)]})})},r.prototype.readTextureSync=function(t,n,i,a,s,l,f,d){d===void 0&&(d=l.byteLength||0);var y=this.device.gl,b=t,T=this.device.translateTextureType(b.format);return y.bindFramebuffer(Xe.FRAMEBUFFER,this.device.readbackFramebuffer),y.framebufferTexture2D(Xe.FRAMEBUFFER,Xe.COLOR_ATTACHMENT0,Xe.TEXTURE_2D,b.gl_texture,0),y.pixelStorei(y.PACK_ALIGNMENT,4),y.readPixels(n,i,a,s,y.RGBA,T,l),l},r.prototype.readBuffer=function(t,n,i,a,s){return(0,In.mG)(this,void 0,void 0,function(){var l;return(0,In.Jh)(this,function(f){return l=this.device.gl,Vn(l)?[2,this.getBufferSubDataAsync(l.ARRAY_BUFFER,Pv(t,n),n,i,a,s)]:[2,Promise.reject()]})})},r.prototype.destroy=function(){e.prototype.destroy.call(this),Vn(this.device.gl)&&(this.gl_sync!==null&&this.device.gl.deleteSync(this.gl_sync),this.gl_pbo!==null&&this.device.gl.deleteBuffer(this.gl_pbo))},r}(Ef),Y4=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;return f.type=ga.RenderPipeline,f.drawMode=B4((s=a.topology)!==null&&s!==void 0?s:ws.TRIANGLES),f.program=a.program,f.inputLayout=a.inputLayout,f.megaState=(0,In.pi)((0,In.pi)({},Mv(Id)),a.megaStateDescriptor),f.colorAttachmentFormats=a.colorAttachmentFormats.slice(),f.depthStencilAttachmentFormat=a.depthStencilAttachmentFormat,f.sampleCount=(l=a.sampleCount)!==null&&l!==void 0?l:1,f}return r}(Ef),q4=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ga.ComputePipeline,s.descriptor=a,s}return r}(Ef),K4=function(){function e(){this.liveObjects=new Set,this.creationStacks=new Map,this.deletionStacks=new Map}return e.prototype.trackResourceCreated=function(r){this.creationStacks.set(r,new Error().stack),this.liveObjects.add(r)},e.prototype.trackResourceDestroyed=function(r){this.deletionStacks.has(r)&&console.warn("Object double freed:",r,`

Creation stack: `,this.creationStacks.get(r),`

Deletion stack: `,this.deletionStacks.get(r),`

This stack: `,new Error().stack),this.deletionStacks.set(r,new Error().stack),this.liveObjects.delete(r)},e.prototype.checkForLeaks=function(){var r,t;try{for(var n=(0,In.XA)(this.liveObjects.values()),i=n.next();!i.done;i=n.next()){var a=i.value;console.warn("Object leaked:",a,"Creation stack:",this.creationStacks.get(a))}}catch(s){r={error:s}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(r)throw r.error}}},e.prototype.setResourceLeakCheck=function(r,t){t?this.liveObjects.add(r):this.liveObjects.delete(r)},e}(),Q4=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;f.type=ga.Sampler;var d=f.device.gl;if(Vn(d)){var y=f.device.ensureResourceExists(d.createSampler());d.samplerParameteri(y,Xe.TEXTURE_WRAP_S,Zm(a.addressModeU)),d.samplerParameteri(y,Xe.TEXTURE_WRAP_T,Zm(a.addressModeV)),d.samplerParameteri(y,Xe.TEXTURE_WRAP_R,Zm((s=a.addressModeW)!==null&&s!==void 0?s:a.addressModeU)),d.samplerParameteri(y,Xe.TEXTURE_MIN_FILTER,l0(a.minFilter,a.mipmapFilter)),d.samplerParameteri(y,Xe.TEXTURE_MAG_FILTER,l0(a.magFilter,Xs.NO_MIP)),a.lodMinClamp!==void 0&&d.samplerParameterf(y,Xe.TEXTURE_MIN_LOD,a.lodMinClamp),a.lodMaxClamp!==void 0&&d.samplerParameterf(y,Xe.TEXTURE_MAX_LOD,a.lodMaxClamp),a.compareFunction!==void 0&&(d.samplerParameteri(y,d.TEXTURE_COMPARE_MODE,d.COMPARE_REF_TO_TEXTURE),d.samplerParameteri(y,d.TEXTURE_COMPARE_FUNC,a.compareFunction));var b=(l=a.maxAnisotropy)!==null&&l!==void 0?l:1;b>1&&f.device.EXT_texture_filter_anisotropic!==null&&(Oi(a.minFilter===es.BILINEAR&&a.magFilter===es.BILINEAR&&a.mipmapFilter===Xs.LINEAR),d.samplerParameterf(y,f.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,b)),f.gl_sampler=y}else f.descriptor=a;return f}return r.prototype.setTextureParameters=function(t,n,i){var a,s=this.device.gl,l=this.descriptor;this.isNPOT(n,i)?s.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_MIN_FILTER,Xe.LINEAR):s.texParameteri(t,Xe.TEXTURE_MIN_FILTER,l0(l.minFilter,l.mipmapFilter)),s.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_WRAP_S,Zm(l.addressModeU)),s.texParameteri(Xe.TEXTURE_2D,Xe.TEXTURE_WRAP_T,Zm(l.addressModeV)),s.texParameteri(t,Xe.TEXTURE_MAG_FILTER,l0(l.magFilter,Xs.NO_MIP));var f=(a=l.maxAnisotropy)!==null&&a!==void 0?a:1;f>1&&this.device.EXT_texture_filter_anisotropic!==null&&(Oi(l.minFilter===es.BILINEAR&&l.magFilter===es.BILINEAR&&l.mipmapFilter===Xs.LINEAR),s.texParameteri(t,this.device.EXT_texture_filter_anisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f))},r.prototype.destroy=function(){e.prototype.destroy.call(this),Vn(this.device.gl)&&this.device.gl.deleteSampler(w_(this))},r.prototype.isNPOT=function(t,n){return!i0(t)||!i0(n)},r}(Ef),J4=function(){function e(){}return e.prototype.dispatchWorkgroups=function(r,t,n){},e.prototype.dispatchWorkgroupsIndirect=function(r,t){},e.prototype.setPipeline=function(r){},e.prototype.setBindings=function(r){},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e}(),HE=65536,ek=/uniform(?:\s+)(\w+)(?:\s?){([^]*?)}/g,tk=function(){function e(r,t){this.shaderDebug=!1,this.OES_vertex_array_object=null,this.ANGLE_instanced_arrays=null,this.OES_texture_float=null,this.OES_draw_buffers_indexed=null,this.WEBGL_draw_buffers=null,this.WEBGL_depth_texture=null,this.WEBGL_color_buffer_float=null,this.EXT_color_buffer_half_float=null,this.WEBGL_compressed_texture_s3tc=null,this.WEBGL_compressed_texture_s3tc_srgb=null,this.EXT_texture_compression_rgtc=null,this.EXT_texture_filter_anisotropic=null,this.KHR_parallel_shader_compile=null,this.EXT_texture_norm16=null,this.EXT_color_buffer_float=null,this.OES_texture_float_linear=null,this.OES_texture_half_float_linear=null,this.scTexture=null,this.scPlatformFramebuffer=null,this.currentActiveTexture=null,this.currentBoundVAO=null,this.currentProgram=null,this.resourceCreationTracker=null,this.resourceUniqueId=0,this.currentColorAttachments=[],this.currentColorAttachmentLevels=[],this.currentColorResolveTos=[],this.currentColorResolveToLevels=[],this.currentSampleCount=-1,this.currentIndexBufferByteOffset=null,this.currentMegaState=Mv(Id),this.currentSamplers=[],this.currentTextures=[],this.currentUniformBuffers=[],this.currentUniformBufferByteOffsets=[],this.currentUniformBufferByteSizes=[],this.currentScissorEnabled=!1,this.currentStencilRef=null,this.currentRenderPassDescriptor=null,this.currentRenderPassDescriptorStack=[],this.debugGroupStack=[],this.resolveColorAttachmentsChanged=!1,this.resolveDepthStencilAttachmentsChanged=!1,this.explicitBindingLocations=!1,this.separateSamplerTextures=!1,this.viewportOrigin=Av.LOWER_LEFT,this.clipSpaceNearZ=Tv.NEGATIVE_ONE,this.supportMRT=!1,this.inBlitRenderPass=!1,this.supportedSampleCounts=[],this.occlusionQueriesRecommended=!1,this.computeShadersSupported=!1,this.gl=r,this.contextAttributes=Md(r.getContextAttributes()),Vn(r)?(this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.EXT_color_buffer_float=r.getExtension("EXT_color_buffer_float")):(this.OES_vertex_array_object=r.getExtension("OES_vertex_array_object"),this.ANGLE_instanced_arrays=r.getExtension("ANGLE_instanced_arrays"),this.OES_texture_float=r.getExtension("OES_texture_float"),this.WEBGL_draw_buffers=r.getExtension("WEBGL_draw_buffers"),this.WEBGL_depth_texture=r.getExtension("WEBGL_depth_texture"),this.WEBGL_color_buffer_float=r.getExtension("WEBGL_color_buffer_float"),this.EXT_color_buffer_half_float=r.getExtension("EXT_color_buffer_half_float"),r.getExtension("EXT_frag_depth"),r.getExtension("OES_element_index_uint"),r.getExtension("OES_standard_derivatives")),this.WEBGL_compressed_texture_s3tc=r.getExtension("WEBGL_compressed_texture_s3tc"),this.WEBGL_compressed_texture_s3tc_srgb=r.getExtension("WEBGL_compressed_texture_s3tc_srgb"),this.EXT_texture_compression_rgtc=r.getExtension("EXT_texture_compression_rgtc"),this.EXT_texture_filter_anisotropic=r.getExtension("EXT_texture_filter_anisotropic"),this.EXT_texture_norm16=r.getExtension("EXT_texture_norm16"),this.OES_texture_float_linear=r.getExtension("OES_texture_float_linear"),this.OES_texture_half_float_linear=r.getExtension("OES_texture_half_float_linear"),this.KHR_parallel_shader_compile=r.getExtension("KHR_parallel_shader_compile"),Vn(r)?(this.platformString="WebGL2",this.glslVersion="#version 300 es"):(this.platformString="WebGL1",this.glslVersion="#version 100"),this.scTexture=new R_({id:this.getNextUniqueId(),device:this,descriptor:{width:0,height:0,depthOrArrayLayers:1,dimension:Wi.TEXTURE_2D,mipLevelCount:1,usage:Ou.RENDER_TARGET,format:this.contextAttributes.alpha===!1?kt.U8_RGB_RT:kt.U8_RGBA_RT},fake:!0}),this.scTexture.formatKind=Wo.Float,this.scTexture.gl_target=null,this.scTexture.gl_texture=null,this.resolveColorReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveColorDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilReadFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.resolveDepthStencilDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.renderPassDrawFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.readbackFramebuffer=this.ensureResourceExists(r.createFramebuffer()),this.fallbackTexture2D=this.createFallbackTexture(Wi.TEXTURE_2D,Wo.Float),this.fallbackTexture2DDepth=this.createFallbackTexture(Wi.TEXTURE_2D,Wo.Depth),this.fallbackVertexBuffer=this.createBuffer({viewOrSize:1,usage:ro.VERTEX,hint:bf.STATIC}),Vn(r)&&(this.fallbackTexture2DArray=this.createFallbackTexture(Wi.TEXTURE_2D_ARRAY,Wo.Float),this.fallbackTexture3D=this.createFallbackTexture(Wi.TEXTURE_3D,Wo.Float),this.fallbackTextureCube=this.createFallbackTexture(Wi.TEXTURE_CUBE_MAP,Wo.Float)),this.currentMegaState.depthCompare=Ni.LESS,this.currentMegaState.depthWrite=!1,this.currentMegaState.attachmentsState[0].channelWriteMask=au.ALL,r.enable(r.DEPTH_TEST),r.enable(r.STENCIL_TEST),this.checkLimits(),t.shaderDebug&&(this.shaderDebug=!0),t.trackResources&&(this.resourceCreationTracker=new K4)}return e.prototype.destroy=function(){this.blitBindings&&this.blitBindings.destroy(),this.blitInputLayout&&this.blitInputLayout.destroy(),this.blitRenderPipeline&&this.blitRenderPipeline.destroy(),this.blitVertexBuffer&&this.blitVertexBuffer.destroy(),this.blitProgram&&this.blitProgram.destroy()},e.prototype.createFallbackTexture=function(r,t){var n=r===Wi.TEXTURE_CUBE_MAP?6:1,i=t===Wo.Depth?kt.D32F:kt.U8_RGBA_NORM,a=this.createTexture({dimension:r,format:i,usage:Ou.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1});return t===Wo.Float&&a.setImageData([new Uint8Array(4*n)]),Ov(a)},e.prototype.getNextUniqueId=function(){return++this.resourceUniqueId},e.prototype.checkLimits=function(){var r=this.gl;if(this.maxVertexAttribs=r.getParameter(Xe.MAX_VERTEX_ATTRIBS),Vn(r)){this.uniformBufferMaxPageByteSize=Math.min(r.getParameter(Xe.MAX_UNIFORM_BLOCK_SIZE),HE),this.uniformBufferWordAlignment=r.getParameter(r.UNIFORM_BUFFER_OFFSET_ALIGNMENT)/4;var t=r.getInternalformatParameter(r.RENDERBUFFER,r.DEPTH32F_STENCIL8,r.SAMPLES);this.supportedSampleCounts=t?(0,In.ev)([],(0,In.CR)(t),!1):[],this.occlusionQueriesRecommended=!0}else this.uniformBufferWordAlignment=64,this.uniformBufferMaxPageByteSize=HE;this.uniformBufferMaxPageWordSize=this.uniformBufferMaxPageByteSize/4,this.supportedSampleCounts.includes(1)||this.supportedSampleCounts.push(1),this.supportedSampleCounts.sort(function(n,i){return n-i})},e.prototype.configureSwapChain=function(r,t,n){var i=this.scTexture;i.width=r,i.height=t,this.scPlatformFramebuffer=i4(n)},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.gl.canvas},e.prototype.getOnscreenTexture=function(){return this.scTexture},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.translateTextureInternalFormat=function(r,t){switch(t===void 0&&(t=!1),r){case kt.ALPHA:return Xe.ALPHA;case kt.U8_LUMINANCE:case kt.F16_LUMINANCE:case kt.F32_LUMINANCE:return Xe.LUMINANCE;case kt.F16_R:return Xe.R16F;case kt.F16_RG:return Xe.RG16F;case kt.F16_RGB:return Xe.RGB16F;case kt.F16_RGBA:return Xe.RGBA16F;case kt.F32_R:return Xe.R32F;case kt.F32_RG:return Xe.RG32F;case kt.F32_RGB:return Xe.RGB32F;case kt.F32_RGBA:return Vn(this.gl)?Xe.RGBA32F:t?this.WEBGL_color_buffer_float.RGBA32F_EXT:Xe.RGBA;case kt.U8_R_NORM:return Xe.R8;case kt.U8_RG_NORM:return Xe.RG8;case kt.U8_RGB_NORM:case kt.U8_RGB_RT:return Xe.RGB8;case kt.U8_RGB_SRGB:return Xe.SRGB8;case kt.U8_RGBA_NORM:case kt.U8_RGBA_RT:return Vn(this.gl)?Xe.RGBA8:t?Xe.RGBA4:Xe.RGBA;case kt.U8_RGBA:return Xe.RGBA;case kt.U8_RGBA_SRGB:case kt.U8_RGBA_RT_SRGB:return Xe.SRGB8_ALPHA8;case kt.U16_R:return Xe.R16UI;case kt.U16_R_NORM:return this.EXT_texture_norm16.R16_EXT;case kt.U16_RG_NORM:return this.EXT_texture_norm16.RG16_EXT;case kt.U16_RGBA_NORM:return this.EXT_texture_norm16.RGBA16_EXT;case kt.U16_RGBA_5551:return Xe.RGB5_A1;case kt.U16_RGB_565:return Xe.RGB565;case kt.U32_R:return Xe.R32UI;case kt.S8_RGBA_NORM:return Xe.RGBA8_SNORM;case kt.S8_RG_NORM:return Xe.RG8_SNORM;case kt.BC1:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT1_EXT;case kt.BC1_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT1_EXT;case kt.BC2:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT3_EXT;case kt.BC2_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT3_EXT;case kt.BC3:return this.WEBGL_compressed_texture_s3tc.COMPRESSED_RGBA_S3TC_DXT5_EXT;case kt.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb.COMPRESSED_SRGB_ALPHA_S3TC_DXT5_EXT;case kt.BC4_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_RGTC1_EXT;case kt.BC4_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_RGTC1_EXT;case kt.BC5_UNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_RED_GREEN_RGTC2_EXT;case kt.BC5_SNORM:return this.EXT_texture_compression_rgtc.COMPRESSED_SIGNED_RED_GREEN_RGTC2_EXT;case kt.D32F_S8:return Vn(this.gl)?Xe.DEPTH32F_STENCIL8:this.WEBGL_depth_texture?Xe.DEPTH_STENCIL:Xe.DEPTH_COMPONENT16;case kt.D24_S8:return Vn(this.gl)?Xe.DEPTH24_STENCIL8:this.WEBGL_depth_texture?Xe.DEPTH_STENCIL:Xe.DEPTH_COMPONENT16;case kt.D32F:return Vn(this.gl)?Xe.DEPTH_COMPONENT32F:this.WEBGL_depth_texture?Xe.DEPTH_COMPONENT:Xe.DEPTH_COMPONENT16;case kt.D24:return Vn(this.gl)?Xe.DEPTH_COMPONENT24:this.WEBGL_depth_texture?Xe.DEPTH_COMPONENT:Xe.DEPTH_COMPONENT16;default:throw new Error("whoops")}},e.prototype.translateTextureType=function(r){var t=sh(r);switch(t){case Ir.U8:return Xe.UNSIGNED_BYTE;case Ir.U16:return Xe.UNSIGNED_SHORT;case Ir.U32:return Xe.UNSIGNED_INT;case Ir.S8:return Xe.BYTE;case Ir.F16:return Xe.HALF_FLOAT;case Ir.F32:return Xe.FLOAT;case Ir.U16_PACKED_5551:return Xe.UNSIGNED_SHORT_5_5_5_1;case Ir.D32F:return Vn(this.gl)?Xe.FLOAT:this.WEBGL_depth_texture?Xe.UNSIGNED_INT:Xe.UNSIGNED_BYTE;case Ir.D24:return Vn(this.gl)?Xe.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Xe.UNSIGNED_SHORT:Xe.UNSIGNED_BYTE;case Ir.D24S8:return Vn(this.gl)?Xe.UNSIGNED_INT_24_8:this.WEBGL_depth_texture?Xe.UNSIGNED_INT_24_8_WEBGL:Xe.UNSIGNED_BYTE;case Ir.D32FS8:return Xe.FLOAT_32_UNSIGNED_INT_24_8_REV;default:throw new Error("whoops")}},e.prototype.translateInternalTextureFormat=function(r){switch(r){case kt.F32_R:return Xe.R32F;case kt.F32_RG:return Xe.RG32F;case kt.F32_RGB:return Xe.RGB32F;case kt.F32_RGBA:return Xe.RGBA32F;case kt.F16_R:return Xe.R16F;case kt.F16_RG:return Xe.RG16F;case kt.F16_RGB:return Xe.RGB16F;case kt.F16_RGBA:return Xe.RGBA16F}return this.translateTextureFormat(r)},e.prototype.translateTextureFormat=function(r){if(zE(r)||r===kt.F32_LUMINANCE||r===kt.U8_LUMINANCE)return this.translateTextureInternalFormat(r);var t=Vn(this.gl)||!Vn(this.gl)&&!!this.WEBGL_depth_texture;switch(r){case kt.D24_S8:case kt.D32F_S8:return t?Xe.DEPTH_STENCIL:Xe.RGBA;case kt.D24:case kt.D32F:return t?Xe.DEPTH_COMPONENT:Xe.RGBA}var n=ZE(r),i=n0(r);switch(i){case Wn.A:return Xe.ALPHA;case Wn.R:return n?Xe.RED_INTEGER:Xe.RED;case Wn.RG:return n?Xe.RG_INTEGER:Xe.RG;case Wn.RGB:return n?Xe.RGB_INTEGER:Xe.RGB;case Wn.RGBA:return Xe.RGBA}},e.prototype.setActiveTexture=function(r){this.currentActiveTexture!==r&&(this.gl.activeTexture(r),this.currentActiveTexture=r)},e.prototype.bindVAO=function(r){this.currentBoundVAO!==r&&(Vn(this.gl)?this.gl.bindVertexArray(r):this.OES_vertex_array_object.bindVertexArrayOES(r),this.currentBoundVAO=r)},e.prototype.programCompiled=function(r){Oi(r.compileState!==Hl.NeedsCompile),r.compileState===Hl.Compiling&&(r.compileState=Hl.NeedsBind,this.shaderDebug&&this.checkProgramCompilationForErrors(r))},e.prototype.useProgram=function(r){this.currentProgram!==r&&(this.programCompiled(r),this.gl.useProgram(r.gl_program),this.currentProgram=r)},e.prototype.ensureResourceExists=function(r){if(r===null){var t=this.gl.getError();throw new Error("Created resource is null; GL error encountered: ".concat(t))}else return r},e.prototype.createBuffer=function(r){return new j4({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new R_({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new Q4({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){return new W4({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,a=t.height,s=t.mipLevelCount;return Oi(s===1),this.createRenderTarget({format:n,width:i,height:a,sampleCount:1,texture:r})},e.prototype.createProgram=function(r){var t,n,i,a=(t=r.vertex)===null||t===void 0?void 0:t.glsl;return!((n=r.vertex)===null||n===void 0)&&n.glsl&&(r.vertex.glsl=Fp(this.queryVendorInfo(),"vert",r.vertex.glsl)),!((i=r.fragment)===null||i===void 0)&&i.glsl&&(r.fragment.glsl=Fp(this.queryVendorInfo(),"frag",r.fragment.glsl)),this.createProgramSimple(r,a)},e.prototype.createProgramSimple=function(r,t){var n=new G4({id:this.getNextUniqueId(),device:this,descriptor:r},t);return n},e.prototype.createBindings=function(r){return new D4({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new H4({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new Y4({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePass=function(){return new J4},e.prototype.createComputePipeline=function(r){return new q4({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createReadback=function(){return new $4({id:this.getNextUniqueId(),device:this})},e.prototype.createQueryPool=function(r,t){return new X4({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.formatRenderPassDescriptor=function(r){var t,n,i,a,s,l,f=r.colorAttachment;r.depthClearValue=(t=r.depthClearValue)!==null&&t!==void 0?t:"load",r.stencilClearValue=(n=r.stencilClearValue)!==null&&n!==void 0?n:"load";for(var d=0;d<f.length;d++)r.colorAttachmentLevel||(r.colorAttachmentLevel=[]),r.colorAttachmentLevel[d]=(i=r.colorAttachmentLevel[d])!==null&&i!==void 0?i:0,r.colorResolveToLevel||(r.colorResolveToLevel=[]),r.colorResolveToLevel[d]=(a=r.colorResolveToLevel[d])!==null&&a!==void 0?a:0,r.colorClearColor||(r.colorClearColor=[]),r.colorClearColor[d]=(s=r.colorClearColor[d])!==null&&s!==void 0?s:"load",r.colorStore||(r.colorStore=[]),r.colorStore[d]=(l=r.colorStore[d])!==null&&l!==void 0?l:!1},e.prototype.createRenderPass=function(r){this.currentRenderPassDescriptor!==null&&this.currentRenderPassDescriptorStack.push(this.currentRenderPassDescriptor),this.currentRenderPassDescriptor=r,this.formatRenderPassDescriptor(r);var t=r.colorAttachment,n=r.colorAttachmentLevel,i=r.colorClearColor,a=r.colorResolveTo,s=r.colorResolveToLevel,l=r.depthStencilAttachment,f=r.depthClearValue,d=r.stencilClearValue,y=r.depthStencilResolveTo;this.setRenderPassParametersBegin(t.length);for(var b=0;b<t.length;b++)this.setRenderPassParametersColor(b,t[b],n[b],a[b],s[b]);this.setRenderPassParametersDepthStencil(l,y),this.validateCurrentAttachments();for(var b=0;b<t.length;b++){var T=i[b];T!=="load"&&this.setRenderPassParametersClearColor(b,T.r,T.g,T.b,T.a)}return this.setRenderPassParametersClearDepthStencil(f,d),this},e.prototype.submitPass=function(r){Oi(this.currentRenderPassDescriptor!==null),this.endPass(),this.currentRenderPassDescriptorStack.length?this.currentRenderPassDescriptor=this.currentRenderPassDescriptorStack.pop():this.currentRenderPassDescriptor=null},e.prototype.copySubTexture2D=function(r,t,n,i,a,s){var l=this.gl,f=r,d=i;if(Oi(d.mipLevelCount===1),Oi(f.mipLevelCount===1),Vn(l))f===this.scTexture?l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.scPlatformFramebuffer):(l.bindFramebuffer(l.DRAW_FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.bindFramebufferAttachment(l.DRAW_FRAMEBUFFER,l.COLOR_ATTACHMENT0,f,0)),l.bindFramebuffer(l.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.bindFramebufferAttachment(l.READ_FRAMEBUFFER,l.COLOR_ATTACHMENT0,d,0),l.blitFramebuffer(a,s,a+d.width,s+d.height,t,n,t+d.width,n+d.height,l.COLOR_BUFFER_BIT,l.LINEAR),l.bindFramebuffer(l.READ_FRAMEBUFFER,null),l.bindFramebuffer(l.DRAW_FRAMEBUFFER,null);else if(f===this.scTexture){var y=this.createRenderTargetFromTexture(i);this.submitBlitRenderPass(y,f)}},e.prototype.queryLimits=function(){return this},e.prototype.queryTextureFormatSupported=function(r,t,n){switch(r){case kt.BC1_SRGB:case kt.BC2_SRGB:case kt.BC3_SRGB:return this.WEBGL_compressed_texture_s3tc_srgb!==null?C_(t,n,4,4):!1;case kt.BC1:case kt.BC2:case kt.BC3:return this.WEBGL_compressed_texture_s3tc!==null?C_(t,n,4,4):!1;case kt.BC4_UNORM:case kt.BC4_SNORM:case kt.BC5_UNORM:case kt.BC5_SNORM:return this.EXT_texture_compression_rgtc!==null?C_(t,n,4,4):!1;case kt.U16_R_NORM:case kt.U16_RG_NORM:case kt.U16_RGBA_NORM:return this.EXT_texture_norm16!==null;case kt.F32_R:case kt.F32_RG:case kt.F32_RGB:case kt.F32_RGBA:return this.OES_texture_float_linear!==null;case kt.F16_R:case kt.F16_RG:case kt.F16_RGB:case kt.F16_RGBA:return this.OES_texture_half_float_linear!==null;default:return!0}},e.prototype.queryProgramReady=function(r){var t=this.gl;if(r.compileState===Hl.NeedsCompile)throw new Error("whoops");if(r.compileState===Hl.Compiling){var n=void 0;return this.KHR_parallel_shader_compile!==null?n=t.getProgramParameter(r.gl_program,this.KHR_parallel_shader_compile.COMPLETION_STATUS_KHR):n=!0,n&&this.programCompiled(r),n}return r.compileState===Hl.NeedsBind||r.compileState===Hl.ReadyToUse},e.prototype.queryPlatformAvailable=function(){return this.gl.isContextLost()},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){return this.currentRenderPassDescriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===ga.Buffer)for(var n=r.gl_buffer_pages,i=0;i<n.length;i++)Vm(n[i],"".concat(t," Page ").concat(i));else if(r.type===ga.Texture)Vm(Ov(r),t);else if(r.type===ga.Sampler)Vm(w_(r),t);else if(r.type===ga.RenderTarget){var a=r.gl_renderbuffer;a!==null&&Vm(a,t)}else r.type===ga.InputLayout&&Vm(r.vao,t)},e.prototype.setResourceLeakCheck=function(r,t){this.resourceCreationTracker!==null&&this.resourceCreationTracker.setResourceLeakCheck(r,t)},e.prototype.checkForLeaks=function(){this.resourceCreationTracker!==null&&this.resourceCreationTracker.checkForLeaks()},e.prototype.pushDebugGroup=function(r){},e.prototype.popDebugGroup=function(){},e.prototype.insertDebugMarker=function(r){},e.prototype.programPatched=function(r,t){Oi(this.shaderDebug)},e.prototype.getBufferData=function(r,t,n){n===void 0&&(n=0);var i=this.gl;Vn(i)&&(i.bindBuffer(i.COPY_READ_BUFFER,Pv(r,n*4)),i.getBufferSubData(i.COPY_READ_BUFFER,n*4,t))},e.prototype.debugGroupStatisticsDrawCall=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].drawCallCount+=r},e.prototype.debugGroupStatisticsBufferUpload=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].bufferUploadCount+=r},e.prototype.debugGroupStatisticsTextureBind=function(r){r===void 0&&(r=1);for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].textureBindCount+=r},e.prototype.debugGroupStatisticsTriangles=function(r){for(var t=this.debugGroupStack.length-1;t>=0;t--)this.debugGroupStack[t].triangleCount+=r},e.prototype.reportShaderError=function(r,t){var n=this.gl,i=n.getShaderParameter(r,n.COMPILE_STATUS);if(!i){console.error(s4(t));var a=n.getExtension("WEBGL_debug_shaders");a&&console.error(a.getTranslatedShaderSource(r)),console.error(n.getShaderInfoLog(r))}return i},e.prototype.checkProgramCompilationForErrors=function(r){var t=this.gl,n=r.gl_program;if(!t.getProgramParameter(n,t.LINK_STATUS)){var i=r.descriptor;if(!this.reportShaderError(r.gl_shader_vert,i.vertex.glsl)||!this.reportShaderError(r.gl_shader_frag,i.fragment.glsl))return;console.error(t.getProgramInfoLog(r.gl_program))}},e.prototype.bindFramebufferAttachment=function(r,t,n,i){var a=this.gl;if((0,Dp.Z)(n))a.framebufferRenderbuffer(r,t,a.RENDERBUFFER,null);else if(n.type===ga.RenderTarget)n.gl_renderbuffer!==null?a.framebufferRenderbuffer(r,t,a.RENDERBUFFER,n.gl_renderbuffer):n.texture!==null&&a.framebufferTexture2D(r,t,Xe.TEXTURE_2D,Ov(n.texture),i);else if(n.type===ga.Texture){var s=Ov(n);n.dimension===Wi.TEXTURE_2D?a.framebufferTexture2D(r,t,Xe.TEXTURE_2D,s,i):Vn(a)&&(n.dimension,Wi.TEXTURE_2D_ARRAY)}},e.prototype.bindFramebufferDepthStencilAttachment=function(r,t){var n=this.gl,i=(0,Dp.Z)(t)?wn.Depth|wn.Stencil:wv(t.format),a=!!(i&wn.Depth),s=!!(i&wn.Stencil);if(a&&s){var l=Vn(this.gl)||!Vn(this.gl)&&!!this.WEBGL_depth_texture;l?this.bindFramebufferAttachment(r,n.DEPTH_STENCIL_ATTACHMENT,t,0):this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0)}else a?(this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,null,0)):s&&(this.bindFramebufferAttachment(r,n.STENCIL_ATTACHMENT,t,0),this.bindFramebufferAttachment(r,n.DEPTH_ATTACHMENT,null,0))},e.prototype.validateCurrentAttachments=function(){for(var r=-1,t=-1,n=-1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];a!==null&&(r===-1?(r=a.sampleCount,t=a.width,n=a.height):(Oi(r===a.sampleCount),Oi(t===a.width),Oi(n===a.height)))}this.currentDepthStencilAttachment&&(r===-1?r=this.currentDepthStencilAttachment.sampleCount:(Oi(r===this.currentDepthStencilAttachment.sampleCount),Oi(t===this.currentDepthStencilAttachment.width),Oi(n===this.currentDepthStencilAttachment.height))),this.currentSampleCount=r},e.prototype.setRenderPassParametersBegin=function(r){var t=this.gl;if(Vn(t)?t.bindFramebuffer(Xe.DRAW_FRAMEBUFFER,this.renderPassDrawFramebuffer):this.inBlitRenderPass||t.bindFramebuffer(Xe.FRAMEBUFFER,this.renderPassDrawFramebuffer),Vn(t)?t.drawBuffers([Xe.COLOR_ATTACHMENT0,Xe.COLOR_ATTACHMENT1,Xe.COLOR_ATTACHMENT2,Xe.COLOR_ATTACHMENT3]):!this.inBlitRenderPass&&this.WEBGL_draw_buffers&&this.WEBGL_draw_buffers.drawBuffersWEBGL([Xe.COLOR_ATTACHMENT0_WEBGL,Xe.COLOR_ATTACHMENT1_WEBGL,Xe.COLOR_ATTACHMENT2_WEBGL,Xe.COLOR_ATTACHMENT3_WEBGL]),!this.inBlitRenderPass)for(var n=r;n<this.currentColorAttachments.length;n++){var i=Vn(t)?Xe.DRAW_FRAMEBUFFER:Xe.FRAMEBUFFER,a=Vn(t)?Xe.COLOR_ATTACHMENT0:Xe.COLOR_ATTACHMENT0_WEBGL;t.framebufferRenderbuffer(i,a+n,Xe.RENDERBUFFER,null),t.framebufferTexture2D(i,a+n,Xe.TEXTURE_2D,null,0)}this.currentColorAttachments.length=r},e.prototype.setRenderPassParametersColor=function(r,t,n,i,a){var s=this.gl,l=Vn(s);(this.currentColorAttachments[r]!==t||this.currentColorAttachmentLevels[r]!==n)&&(this.currentColorAttachments[r]=t,this.currentColorAttachmentLevels[r]=n,(l||!l&&this.WEBGL_draw_buffers)&&this.bindFramebufferAttachment(l?Xe.DRAW_FRAMEBUFFER:Xe.FRAMEBUFFER,(l?Xe.COLOR_ATTACHMENT0:Xe.COLOR_ATTACHMENT0_WEBGL)+r,t,n),this.resolveColorAttachmentsChanged=!0),(this.currentColorResolveTos[r]!==i||this.currentColorResolveToLevels[r]!==a)&&(this.currentColorResolveTos[r]=i,this.currentColorResolveToLevels[r]=a,i!==null&&(this.resolveColorAttachmentsChanged=!0))},e.prototype.setRenderPassParametersDepthStencil=function(r,t){var n=this.gl;this.currentDepthStencilAttachment!==r&&(this.currentDepthStencilAttachment=r,this.inBlitRenderPass||this.bindFramebufferDepthStencilAttachment(Vn(n)?Xe.DRAW_FRAMEBUFFER:Xe.FRAMEBUFFER,this.currentDepthStencilAttachment),this.resolveDepthStencilAttachmentsChanged=!0),this.currentDepthStencilResolveTo!==t&&(this.currentDepthStencilResolveTo=t,t&&(this.resolveDepthStencilAttachmentsChanged=!0))},e.prototype.setRenderPassParametersClearColor=function(r,t,n,i,a){var s=this.gl;if(this.OES_draw_buffers_indexed!==null){var l=this.currentMegaState.attachmentsState[r];l&&l.channelWriteMask!==au.ALL&&(this.OES_draw_buffers_indexed.colorMaskiOES(r,!0,!0,!0,!0),l.channelWriteMask=au.ALL)}else{var l=this.currentMegaState.attachmentsState[0];l&&l.channelWriteMask!==au.ALL&&(s.colorMask(!0,!0,!0,!0),l.channelWriteMask=au.ALL)}this.setScissorRectEnabled(!1),Vn(s)?s.clearBufferfv(s.COLOR,r,[t,n,i,a]):(s.clearColor(t,n,i,a),s.clear(s.COLOR_BUFFER_BIT))},e.prototype.setRenderPassParametersClearDepthStencil=function(r,t){r===void 0&&(r="load"),t===void 0&&(t="load");var n=this.gl;r!=="load"&&(Oi(!!this.currentDepthStencilAttachment),this.currentMegaState.depthWrite||(n.depthMask(!0),this.currentMegaState.depthWrite=!0),Vn(n)?n.clearBufferfv(n.DEPTH,0,[r]):(n.clearDepth(r),n.clear(n.DEPTH_BUFFER_BIT))),t!=="load"&&(Oi(!!this.currentDepthStencilAttachment),this.currentMegaState.stencilWrite||(n.enable(n.STENCIL_TEST),n.stencilMask(255),this.currentMegaState.stencilWrite=!0),Vn(n)?n.clearBufferiv(n.STENCIL,0,[t]):(n.clearStencil(t),n.clear(n.STENCIL_BUFFER_BIT)))},e.prototype.setBindings=function(r){var t,n=this.gl,i=r,a=i.uniformBufferBindings,s=i.samplerBindings,l=i.bindingLayouts;Oi(0<l.bindingLayoutTables.length);var f=l.bindingLayoutTables[0];Oi(a.length>=f.numUniformBuffers),Oi(s.length>=f.numSamplers);for(var d=0;d<a.length;d++){var y=a[d];if(y.size!==0){var b=f.firstUniformBuffer+d,T=y.buffer,M=y.offset||0,P=y.size||T.byteSize;if(T!==this.currentUniformBuffers[b]||M!==this.currentUniformBufferByteOffsets[b]||P!==this.currentUniformBufferByteSizes[b]){var k=M%T.pageByteSize,H=T.gl_buffer_pages[M/T.pageByteSize|0];Oi(k+P<=T.pageByteSize),Vn(n)&&n.bindBufferRange(n.UNIFORM_BUFFER,b,H,k,P),this.currentUniformBuffers[b]=T,this.currentUniformBufferByteOffsets[b]=M,this.currentUniformBufferByteSizes[b]=P}}}for(var d=0;d<f.numSamplers;d++){var y=s[d],q=f.firstSampler+d,ae=y!==null&&y.sampler!==null?w_(y.sampler):null,Se=y!==null&&y.texture!==null?Ov(y.texture):null;if(this.currentSamplers[q]!==ae&&(Vn(n)&&n.bindSampler(q,ae),this.currentSamplers[q]=ae),this.currentTextures[q]!==Se){if(this.setActiveTexture(n.TEXTURE0+q),Se!==null){var ze=Md(y).texture,it=ze.gl_target,ut=ze.width,ot=ze.height;y.texture.textureIndex=q,n.bindTexture(it,Se),Vn(n)||(t=y.sampler)===null||t===void 0||t.setTextureParameters(it,ut,ot),this.debugGroupStatisticsTextureBind()}else{var Ct=(0,In.pi)((0,In.pi)({},y),OE),Xt=Ct.dimension,Sr=Ct.formatKind,it=V4(Xt);n.bindTexture(it,this.getFallbackTexture((0,In.pi)({gl_target:it,formatKind:Sr},Ct)))}this.currentTextures[q]=Se}}},e.prototype.setViewport=function(r,t,n,i){var a=this.gl;a.viewport(r,t,n,i)},e.prototype.setScissorRect=function(r,t,n,i){var a=this.gl;this.setScissorRectEnabled(!0),a.scissor(r,t,n,i)},e.prototype.applyAttachmentStateIndexed=function(r,t,n){var i=this.gl,a=this.OES_draw_buffers_indexed;t.channelWriteMask!==n.channelWriteMask&&(a.colorMaskiOES(r,!!(n.channelWriteMask&au.RED),!!(n.channelWriteMask&au.GREEN),!!(n.channelWriteMask&au.BLUE),!!(n.channelWriteMask&au.ALPHA)),t.channelWriteMask=n.channelWriteMask);var s=t.rgbBlendState.blendMode!==n.rgbBlendState.blendMode||t.alphaBlendState.blendMode!==n.alphaBlendState.blendMode,l=t.rgbBlendState.blendSrcFactor!==n.rgbBlendState.blendSrcFactor||t.alphaBlendState.blendSrcFactor!==n.alphaBlendState.blendSrcFactor||t.rgbBlendState.blendDstFactor!==n.rgbBlendState.blendDstFactor||t.alphaBlendState.blendDstFactor!==n.alphaBlendState.blendDstFactor;(l||s)&&(Np(t.rgbBlendState)&&Np(t.alphaBlendState)?a.enableiOES(r,i.BLEND):Np(n.rgbBlendState)&&Np(n.alphaBlendState)&&a.disableiOES(r,i.BLEND)),s&&(a.blendEquationSeparateiOES(r,n.rgbBlendState.blendMode,n.alphaBlendState.blendMode),t.rgbBlendState.blendMode=n.rgbBlendState.blendMode,t.alphaBlendState.blendMode=n.alphaBlendState.blendMode),l&&(a.blendFuncSeparateiOES(r,n.rgbBlendState.blendSrcFactor,n.rgbBlendState.blendDstFactor,n.alphaBlendState.blendSrcFactor,n.alphaBlendState.blendDstFactor),t.rgbBlendState.blendSrcFactor=n.rgbBlendState.blendSrcFactor,t.alphaBlendState.blendSrcFactor=n.alphaBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor=n.rgbBlendState.blendDstFactor,t.alphaBlendState.blendDstFactor=n.alphaBlendState.blendDstFactor)},e.prototype.applyAttachmentState=function(r,t){var n=this.gl;r.channelWriteMask!==t.channelWriteMask&&(n.colorMask(!!(t.channelWriteMask&au.RED),!!(t.channelWriteMask&au.GREEN),!!(t.channelWriteMask&au.BLUE),!!(t.channelWriteMask&au.ALPHA)),r.channelWriteMask=t.channelWriteMask);var i=r.rgbBlendState.blendMode!==t.rgbBlendState.blendMode||r.alphaBlendState.blendMode!==t.alphaBlendState.blendMode,a=r.rgbBlendState.blendSrcFactor!==t.rgbBlendState.blendSrcFactor||r.alphaBlendState.blendSrcFactor!==t.alphaBlendState.blendSrcFactor||r.rgbBlendState.blendDstFactor!==t.rgbBlendState.blendDstFactor||r.alphaBlendState.blendDstFactor!==t.alphaBlendState.blendDstFactor;(a||i)&&(Np(r.rgbBlendState)&&Np(r.alphaBlendState)?n.enable(n.BLEND):Np(t.rgbBlendState)&&Np(t.alphaBlendState)&&n.disable(n.BLEND)),i&&(n.blendEquationSeparate(t.rgbBlendState.blendMode,t.alphaBlendState.blendMode),r.rgbBlendState.blendMode=t.rgbBlendState.blendMode,r.alphaBlendState.blendMode=t.alphaBlendState.blendMode),a&&(n.blendFuncSeparate(t.rgbBlendState.blendSrcFactor,t.rgbBlendState.blendDstFactor,t.alphaBlendState.blendSrcFactor,t.alphaBlendState.blendDstFactor),r.rgbBlendState.blendSrcFactor=t.rgbBlendState.blendSrcFactor,r.alphaBlendState.blendSrcFactor=t.alphaBlendState.blendSrcFactor,r.rgbBlendState.blendDstFactor=t.rgbBlendState.blendDstFactor,r.alphaBlendState.blendDstFactor=t.alphaBlendState.blendDstFactor)},e.prototype.setMegaState=function(r){var t=this.gl,n=this.currentMegaState;if(this.OES_draw_buffers_indexed!==null)for(var i=0;i<r.attachmentsState.length;i++)this.applyAttachmentStateIndexed(i,n.attachmentsState[0],r.attachmentsState[0]);else Oi(r.attachmentsState.length===1),this.applyAttachmentState(n.attachmentsState[0],r.attachmentsState[0]);if(wE(n.blendConstant,r.blendConstant)||(t.blendColor(r.blendConstant.r,r.blendConstant.g,r.blendConstant.b,r.blendConstant.a),CE(n.blendConstant,r.blendConstant)),n.depthCompare!==r.depthCompare&&(t.depthFunc(r.depthCompare),n.depthCompare=r.depthCompare),!!n.depthWrite!=!!r.depthWrite&&(t.depthMask(r.depthWrite),n.depthWrite=r.depthWrite),!!n.stencilWrite!=!!r.stencilWrite&&(t.stencilMask(r.stencilWrite?255:0),n.stencilWrite=r.stencilWrite),!s0(n.stencilFront,r.stencilFront)){var a=r.stencilFront,s=a.passOp,l=a.failOp,f=a.depthFailOp,d=a.compare;(n.stencilFront.passOp!==s||n.stencilFront.failOp!==l||n.stencilFront.depthFailOp!==f)&&(t.stencilOpSeparate(t.FRONT,l,f,s),n.stencilFront.passOp=s,n.stencilFront.failOp=l,n.stencilFront.depthFailOp=f),n.stencilFront.compare!==d&&(this.setStencilReference(0),n.stencilFront.compare=d)}if(!s0(n.stencilBack,r.stencilBack)){var y=r.stencilBack,s=y.passOp,l=y.failOp,f=y.depthFailOp,d=y.compare;(n.stencilBack.passOp!==s||n.stencilBack.failOp!==l||n.stencilBack.depthFailOp!==f)&&(t.stencilOpSeparate(t.BACK,l,f,s),n.stencilBack.passOp=s,n.stencilBack.failOp=l,n.stencilBack.depthFailOp=f),n.stencilBack.compare!==d&&(this.setStencilReference(0),n.stencilBack.compare=d)}n.cullMode!==r.cullMode&&(n.cullMode===jl.NONE?t.enable(t.CULL_FACE):r.cullMode===jl.NONE&&t.disable(t.CULL_FACE),r.cullMode===jl.BACK?t.cullFace(t.BACK):r.cullMode===jl.FRONT?t.cullFace(t.FRONT):r.cullMode===jl.FRONT_AND_BACK&&t.cullFace(t.FRONT_AND_BACK),n.cullMode=r.cullMode),n.frontFace!==r.frontFace&&(t.frontFace(r.frontFace),n.frontFace=r.frontFace),n.polygonOffset!==r.polygonOffset&&(r.polygonOffset?(t.polygonOffset(1,1),t.enable(t.POLYGON_OFFSET_FILL)):t.disable(t.POLYGON_OFFSET_FILL),n.polygonOffset=r.polygonOffset)},e.prototype.validatePipelineFormats=function(r){for(var t=0;t<this.currentColorAttachments.length;t++)var n=this.currentColorAttachments[t];this.currentDepthStencilAttachment&&Oi(this.currentDepthStencilAttachment.format===r.depthStencilAttachmentFormat),this.currentSampleCount!==-1&&Oi(this.currentSampleCount===r.sampleCount)},e.prototype.setPipeline=function(r){this.currentPipeline=r,this.validatePipelineFormats(this.currentPipeline),this.setMegaState(this.currentPipeline.megaState);var t=this.currentPipeline.program;if(this.useProgram(t),t.compileState===Hl.NeedsBind){var n=this.gl,i=t.gl_program,a=t.descriptor,s=jE(a.vertex.glsl,ek);if(Vn(n))for(var l=0;l<s.length;l++){var f=(0,In.CR)(s[l],2),d=f[1],y=n.getUniformBlockIndex(i,d);y!==-1&&y!==4294967295&&n.uniformBlockBinding(i,y,l)}for(var b=jE(a.fragment.glsl,/^uniform .*sampler\S+ (\w+);\s* \/\/ BINDING=(\d+)$/gm),l=0;l<b.length;l++){var T=(0,In.CR)(b[l],3),M=T[1],P=T[2],k=n.getUniformLocation(i,M);n.uniform1i(k,parseInt(P))}t.compileState=Hl.ReadyToUse}},e.prototype.setVertexInput=function(r,t,n){var i,a,s;if(r!==null){Oi(this.currentPipeline.inputLayout===r);var l=r;this.bindVAO(l.vao);for(var f=this.gl,d=0;d<l.vertexBufferDescriptors.length;d++){var y=l.vertexBufferDescriptors[d],b=y.arrayStride,T=y.attributes;try{for(var M=(i=void 0,(0,In.XA)(T)),P=M.next();!P.done;P=M.next()){var k=P.value,H=k.shaderLocation,q=k.offset,ae=Vn(f)?H:(s=l.program.attributes[H])===null||s===void 0?void 0:s.location;if(!(0,Dp.Z)(ae)){var Se=t[d];if(Se===null)continue;var ze=k.vertexFormat;f.bindBuffer(f.ARRAY_BUFFER,Pv(Se.buffer));var it=(Se.offset||0)+q;f.vertexAttribPointer(ae,ze.size,ze.type,ze.normalized,b,it)}}}catch(ot){i={error:ot}}finally{try{P&&!P.done&&(a=M.return)&&a.call(M)}finally{if(i)throw i.error}}}if(Oi(n!==null==(l.indexBufferFormat!==null)),n!==null){var ut=n.buffer;Oi(ut.usage===ro.INDEX),f.bindBuffer(f.ELEMENT_ARRAY_BUFFER,Pv(ut)),this.currentIndexBufferByteOffset=n.offset||0}else this.currentIndexBufferByteOffset=null}else Oi(this.currentPipeline.inputLayout===null),Oi(n===null),this.bindVAO(null),this.currentIndexBufferByteOffset=0},e.prototype.setStencilReference=function(r){this.currentStencilRef!==r&&(this.currentStencilRef=r,this.applyStencil())},e.prototype.draw=function(r,t,n,i){var a,s=this.gl,l=this.currentPipeline;if(t){var f=[l.drawMode,n||0,r,t];Vn(s)?s.drawArraysInstanced.apply(s,(0,In.ev)([],(0,In.CR)(f),!1)):(a=this.ANGLE_instanced_arrays).drawArraysInstancedANGLE.apply(a,(0,In.ev)([],(0,In.CR)(f),!1))}else s.drawArrays(l.drawMode,n,r);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndexed=function(r,t,n,i,a){var s,l=this.gl,f=this.currentPipeline,d=Md(f.inputLayout),y=Md(this.currentIndexBufferByteOffset)+n*d.indexBufferCompByteSize;if(t){var b=[f.drawMode,r,d.indexBufferType,y,t];Vn(l)?l.drawElementsInstanced.apply(l,(0,In.ev)([],(0,In.CR)(b),!1)):(s=this.ANGLE_instanced_arrays).drawElementsInstancedANGLE.apply(s,(0,In.ev)([],(0,In.CR)(b),!1))}else l.drawElements(f.drawMode,r,d.indexBufferType,y);this.debugGroupStatisticsDrawCall(),this.debugGroupStatisticsTriangles(r/3*Math.max(t,1))},e.prototype.drawIndirect=function(r,t){},e.prototype.drawIndexedIndirect=function(r,t){},e.prototype.beginOcclusionQuery=function(r){var t=this.gl;if(Vn(t)){var n=this.currentRenderPassDescriptor.occlusionQueryPool;t.beginQuery(n.gl_query_type,n.gl_query[r])}},e.prototype.endOcclusionQuery=function(){var r=this.gl;if(Vn(r)){var t=this.currentRenderPassDescriptor.occlusionQueryPool;r.endQuery(t.gl_query_type)}},e.prototype.pipelineQueryReady=function(r){var t=r;return this.queryProgramReady(t.program)},e.prototype.pipelineForceReady=function(r){},e.prototype.endPass=function(){for(var r=this.gl,t=Vn(r),n=!1,i=0;i<this.currentColorAttachments.length;i++){var a=this.currentColorAttachments[i];if(a!==null){var s=this.currentColorResolveTos[i],l=!1;s!==null&&(Oi(a.width===s.width&&a.height===s.height),this.setScissorRectEnabled(!1),t&&r.bindFramebuffer(r.READ_FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&t&&this.bindFramebufferAttachment(r.READ_FRAMEBUFFER,r.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i]),l=!0,s===this.scTexture?r.bindFramebuffer(t?Xe.DRAW_FRAMEBUFFER:Xe.FRAMEBUFFER,this.scPlatformFramebuffer):(r.bindFramebuffer(t?Xe.DRAW_FRAMEBUFFER:Xe.FRAMEBUFFER,this.resolveColorDrawFramebuffer),this.resolveColorAttachmentsChanged&&r.framebufferTexture2D(t?Xe.DRAW_FRAMEBUFFER:Xe.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,s.gl_texture,this.currentColorResolveToLevels[i])),t?(r.blitFramebuffer(0,0,a.width,a.height,0,0,s.width,s.height,r.COLOR_BUFFER_BIT,r.LINEAR),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,null)):this.submitBlitRenderPass(a,s),n=!0),this.currentRenderPassDescriptor.colorStore[i]||l||(r.bindFramebuffer(t?Xe.READ_FRAMEBUFFER:Xe.FRAMEBUFFER,this.resolveColorReadFramebuffer),this.resolveColorAttachmentsChanged&&this.bindFramebufferAttachment(t?Xe.READ_FRAMEBUFFER:Xe.FRAMEBUFFER,r.COLOR_ATTACHMENT0,a,this.currentColorAttachmentLevels[i])),r.bindFramebuffer(t?Xe.READ_FRAMEBUFFER:Xe.FRAMEBUFFER,null)}}this.resolveColorAttachmentsChanged=!1;var f=this.currentDepthStencilAttachment;if(f){var d=this.currentDepthStencilResolveTo,l=!1;d&&(Oi(f.width===d.width&&f.height===d.height),this.setScissorRectEnabled(!1),r.bindFramebuffer(t?Xe.READ_FRAMEBUFFER:Xe.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),r.bindFramebuffer(t?Xe.DRAW_FRAMEBUFFER:Xe.FRAMEBUFFER,this.resolveDepthStencilDrawFramebuffer),this.resolveDepthStencilAttachmentsChanged&&(this.bindFramebufferDepthStencilAttachment(t?Xe.READ_FRAMEBUFFER:Xe.FRAMEBUFFER,f),this.bindFramebufferDepthStencilAttachment(t?Xe.DRAW_FRAMEBUFFER:Xe.FRAMEBUFFER,d)),l=!0,t&&r.blitFramebuffer(0,0,f.width,f.height,0,0,d.width,d.height,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(t?Xe.DRAW_FRAMEBUFFER:Xe.FRAMEBUFFER,null),n=!0),this.currentRenderPassDescriptor.depthStencilStore||(l||(r.bindFramebuffer(t?Xe.READ_FRAMEBUFFER:Xe.FRAMEBUFFER,this.resolveDepthStencilReadFramebuffer),this.resolveDepthStencilAttachmentsChanged&&this.bindFramebufferDepthStencilAttachment(t?Xe.READ_FRAMEBUFFER:Xe.FRAMEBUFFER,f),l=!0),t&&r.invalidateFramebuffer(r.READ_FRAMEBUFFER,[r.DEPTH_STENCIL_ATTACHMENT])),l&&r.bindFramebuffer(t?Xe.READ_FRAMEBUFFER:Xe.FRAMEBUFFER,null),this.resolveDepthStencilAttachmentsChanged=!1}n||r.bindFramebuffer(t?Xe.DRAW_FRAMEBUFFER:Xe.FRAMEBUFFER,null)},e.prototype.setScissorRectEnabled=function(r){if(this.currentScissorEnabled!==r){var t=this.gl;r?t.enable(t.SCISSOR_TEST):t.disable(t.SCISSOR_TEST),this.currentScissorEnabled=r}},e.prototype.applyStencil=function(){(0,Dp.Z)(this.currentStencilRef)||(this.gl.stencilFuncSeparate(Xe.FRONT,this.currentMegaState.stencilFront.compare,this.currentStencilRef,255),this.gl.stencilFuncSeparate(Xe.BACK,this.currentMegaState.stencilBack.compare,this.currentStencilRef,255))},e.prototype.getFallbackTexture=function(r){var t=r.gl_target,n=r.formatKind;if(t===Xe.TEXTURE_2D)return n===Wo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===Xe.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===Xe.TEXTURE_3D)return this.fallbackTexture3D;if(t===Xe.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.submitBlitRenderPass=function(r,t){this.blitRenderPipeline||(this.blitProgram=this.createProgram({vertex:{glsl:`layout(location = 0) in vec2 a_Position;
out vec2 v_TexCoord;
void main() {
  v_TexCoord = 0.5 * (a_Position + 1.0);
  gl_Position = vec4(a_Position, 0., 1.);

  #ifdef VIEWPORT_ORIGIN_TL
    v_TexCoord.y = 1.0 - v_TexCoord.y;
  #endif
}`},fragment:{glsl:`uniform sampler2D u_Texture;
in vec2 v_TexCoord;
out vec4 outputColor;
void main() {
  outputColor = texture(SAMPLER_2D(u_Texture), v_TexCoord);
}`}}),this.blitVertexBuffer=this.createBuffer({usage:ro.VERTEX|ro.COPY_DST,viewOrSize:new Float32Array([-4,-4,4,-4,0,4])}),this.blitInputLayout=this.createInputLayout({vertexBufferDescriptors:[{arrayStride:4*2,stepMode:Rd.VERTEX,attributes:[{format:kt.F32_RG,offset:4*0,shaderLocation:0}]}],indexBufferFormat:null,program:this.blitProgram}),this.blitRenderPipeline=this.createRenderPipeline({topology:ws.TRIANGLES,sampleCount:1,program:this.blitProgram,colorAttachmentFormats:[kt.U8_RGBA_RT],depthStencilAttachmentFormat:null,inputLayout:this.blitInputLayout,megaStateDescriptor:Mv(Id)}),this.blitBindings=this.createBindings({samplerBindings:[{sampler:null,texture:r.texture}],uniformBufferBindings:[]}),this.blitProgram.setUniformsLegacy({u_Texture:r}));var n=this.currentRenderPassDescriptor;this.currentRenderPassDescriptor=null,this.inBlitRenderPass=!0;var i=this.createRenderPass({colorAttachment:[r],colorResolveTo:[t],colorClearColor:[r4]}),a=this.getCanvas(),s=a.width,l=a.height;i.setPipeline(this.blitRenderPipeline),i.setBindings(this.blitBindings),i.setVertexInput(this.blitInputLayout,[{buffer:this.blitVertexBuffer}],null),i.setViewport(0,0,s,l),this.gl.disable(this.gl.BLEND),i.draw(3,0),this.gl.enable(this.gl.BLEND),this.currentRenderPassDescriptor=n,this.inBlitRenderPass=!1},e}(),rk=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return(0,In.mG)(this,void 0,void 0,function(){var t,n,i,a,s,l,f,d,y,b,T;return(0,In.Jh)(this,function(M){return t=this.pluginOptions,n=t.targets,i=t.xrCompatible,a=t.antialias,s=a===void 0?!1:a,l=t.preserveDrawingBuffer,f=l===void 0?!1:l,d=t.premultipliedAlpha,y=d===void 0?!0:d,b={antialias:s,preserveDrawingBuffer:f,stencil:!0,premultipliedAlpha:y,xrCompatible:i},this.handleContextEvents(r),n.includes("webgl2")&&(T=r.getContext("webgl2",b)||r.getContext("experimental-webgl2",b)),!T&&n.includes("webgl1")&&(T=r.getContext("webgl",b)||r.getContext("experimental-webgl",b)),[2,new tk(T,{shaderDebug:!0,trackResources:!0})]})})},e.prototype.handleContextEvents=function(r){var t=this.pluginOptions,n=t.onContextLost,i=t.onContextRestored,a=t.onContextCreationError;a&&r.addEventListener("webglcontextcreationerror",a,!1),n&&r.addEventListener("webglcontextlost",n,!1),i&&r.addEventListener("webglcontextrestored",i,!1)},e}();let Cs;const WE=typeof TextDecoder!="undefined"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder!="undefined"&&WE.decode();let jm=null;function c0(){return(jm===null||jm.byteLength===0)&&(jm=new Uint8Array(Cs.memory.buffer)),jm}function f0(e,r){return e=e>>>0,WE.decode(c0().subarray(e,e+r))}const Kh=new Array(128).fill(void 0);Kh.push(void 0,null,!0,!1);let Hm=Kh.length;function nk(e){Hm===Kh.length&&Kh.push(Kh.length+1);const r=Hm;return Hm=Kh[r],Kh[r]=e,r}function h0(e){return Kh[e]}function ik(e){e<132||(Kh[e]=Hm,Hm=e)}function ak(e){const r=h0(e);return ik(e),r}let Wm=0;const p0=typeof TextEncoder!="undefined"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},ok=typeof p0.encodeInto=="function"?function(e,r){return p0.encodeInto(e,r)}:function(e,r){const t=p0.encode(e);return r.set(t),{read:e.length,written:t.length}};function M_(e,r,t){if(t===void 0){const l=p0.encode(e),f=r(l.length,1)>>>0;return c0().subarray(f,f+l.length).set(l),Wm=l.length,f}let n=e.length,i=r(n,1)>>>0;const a=c0();let s=0;for(;s<n;s++){const l=e.charCodeAt(s);if(l>127)break;a[i+s]=l}if(s!==n){s!==0&&(e=e.slice(s)),i=t(i,n,n=s+e.length*3,1)>>>0;const l=c0().subarray(i+s,i+n),f=ok(e,l);s+=f.written}return Wm=s,i}let Gm=null;function d0(){return(Gm===null||Gm.byteLength===0)&&(Gm=new Int32Array(Cs.memory.buffer)),Gm}function sk(e,r,t){let n,i;try{const l=Cs.__wbindgen_add_to_stack_pointer(-16),f=M_(e,Cs.__wbindgen_malloc,Cs.__wbindgen_realloc),d=Wm,y=M_(r,Cs.__wbindgen_malloc,Cs.__wbindgen_realloc),b=Wm;Cs.glsl_compile(l,f,d,y,b,t);var a=d0()[l/4+0],s=d0()[l/4+1];return n=a,i=s,f0(a,s)}finally{Cs.__wbindgen_add_to_stack_pointer(16),Cs.__wbindgen_free(n,i,1)}}class Xm{static __wrap(r){r=r>>>0;const t=Object.create(Xm.prototype);return t.__wbg_ptr=r,t}__destroy_into_raw(){const r=this.__wbg_ptr;return this.__wbg_ptr=0,r}free(){const r=this.__destroy_into_raw();Cs.__wbg_wgslcomposer_free(r)}constructor(){const r=Cs.wgslcomposer_new();return Xm.__wrap(r)}wgsl_compile(r){let t,n;try{const s=Cs.__wbindgen_add_to_stack_pointer(-16),l=M_(r,Cs.__wbindgen_malloc,Cs.__wbindgen_realloc),f=Wm;Cs.wgslcomposer_wgsl_compile(s,this.__wbg_ptr,l,f);var i=d0()[s/4+0],a=d0()[s/4+1];return t=i,n=a,f0(i,a)}finally{Cs.__wbindgen_add_to_stack_pointer(16),Cs.__wbindgen_free(t,n,1)}}}function uk(e,r){return z_(this,null,function*(){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return yield WebAssembly.instantiateStreaming(e,r)}catch(n){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",n);else throw n}const t=yield e.arrayBuffer();return yield WebAssembly.instantiate(t,r)}else{const t=yield WebAssembly.instantiate(e,r);return t instanceof WebAssembly.Instance?{instance:t,module:e}:t}})}function lk(){const e={};return e.wbg={},e.wbg.__wbindgen_string_new=function(r,t){const n=f0(r,t);return nk(n)},e.wbg.__wbindgen_object_drop_ref=function(r){ak(r)},e.wbg.__wbg_log_1d3ae0273d8f4f8a=function(r){console.log(h0(r))},e.wbg.__wbg_log_576ca876af0d4a77=function(r,t){console.log(h0(r),h0(t))},e.wbg.__wbindgen_throw=function(r,t){throw new Error(f0(r,t))},e}function ck(e,r){return Cs=e.exports,GE.__wbindgen_wasm_module=r,Gm=null,jm=null,Cs}function GE(e){return z_(this,null,function*(){if(Cs!==void 0)return Cs;const r=lk();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:t,module:n}=yield uk(yield e,r);return ck(t,n)})}var $s;(function(e){e[e.COPY_SRC=1]="COPY_SRC",e[e.COPY_DST=2]="COPY_DST",e[e.TEXTURE_BINDING=4]="TEXTURE_BINDING",e[e.STORAGE_BINDING=8]="STORAGE_BINDING",e[e.STORAGE=8]="STORAGE",e[e.RENDER_ATTACHMENT=16]="RENDER_ATTACHMENT"})($s||($s={}));var I_;(function(e){e[e.READ=1]="READ",e[e.WRITE=2]="WRITE"})(I_||(I_={}));function fk(e){var r=0;return e&Ou.SAMPLED&&(r|=$s.TEXTURE_BINDING|$s.COPY_DST|$s.COPY_SRC),e&Ou.STORAGE&&(r|=$s.TEXTURE_BINDING|$s.STORAGE_BINDING|$s.COPY_SRC|$s.COPY_DST),e&Ou.RENDER_TARGET&&(r|=$s.RENDER_ATTACHMENT|$s.TEXTURE_BINDING|$s.COPY_SRC|$s.COPY_DST),r}function P_(e){if(e===kt.U8_R_NORM)return"r8unorm";if(e===kt.S8_R_NORM)return"r8snorm";if(e===kt.U8_RG_NORM)return"rg8unorm";if(e===kt.S8_RG_NORM)return"rg8snorm";if(e===kt.U32_R)return"r32uint";if(e===kt.F32_R)return"r32float";if(e===kt.U8_RGBA_RT)return"bgra8unorm";if(e===kt.U8_RGBA_RT_SRGB)return"bgra8unorm-srgb";if(e===kt.U8_RGBA_NORM)return"rgba8unorm";if(e===kt.U8_RGBA_SRGB)return"rgba8unorm-srgb";if(e===kt.S8_RGBA_NORM)return"rgba8snorm";if(e===kt.F16_RGBA)return"rgba16float";if(e===kt.F32_RGBA)return"rgba32float";if(e===kt.D24)return"depth24plus";if(e===kt.D24_S8)return"depth24plus-stencil8";if(e===kt.D32F)return"depth32float";if(e===kt.D32F_S8)return"depth32float-stencil8";if(e===kt.BC1)return"bc1-rgba-unorm";if(e===kt.BC1_SRGB)return"bc1-rgba-unorm-srgb";if(e===kt.BC2)return"bc2-rgba-unorm";if(e===kt.BC2_SRGB)return"bc2-rgba-unorm-srgb";if(e===kt.BC3)return"bc3-rgba-unorm";if(e===kt.BC3_SRGB)return"bc3-rgba-unorm-srgb";if(e===kt.BC4_SNORM)return"bc4-r-snorm";if(e===kt.BC4_UNORM)return"bc4-r-unorm";if(e===kt.BC5_SNORM)return"bc5-rg-snorm";if(e===kt.BC5_UNORM)return"bc5-rg-unorm";throw"whoops"}function hk(e){if(e===Wi.TEXTURE_2D)return"2d";if(e===Wi.TEXTURE_CUBE_MAP)return"2d";if(e===Wi.TEXTURE_2D_ARRAY)return"2d";if(e===Wi.TEXTURE_3D)return"3d";throw new Error("whoops")}function pk(e){if(e===Wi.TEXTURE_2D)return"2d";if(e===Wi.TEXTURE_CUBE_MAP)return"cube";if(e===Wi.TEXTURE_2D_ARRAY)return"2d-array";if(e===Wi.TEXTURE_3D)return"3d";throw new Error("whoops")}function dk(e){var r=0;return e&ro.INDEX&&(r|=GPUBufferUsage.INDEX),e&ro.VERTEX&&(r|=GPUBufferUsage.VERTEX),e&ro.UNIFORM&&(r|=GPUBufferUsage.UNIFORM),e&ro.STORAGE&&(r|=GPUBufferUsage.STORAGE),e&ro.COPY_SRC&&(r|=GPUBufferUsage.COPY_SRC),r|=GPUBufferUsage.COPY_DST,r}function O_(e){if(e===yl.CLAMP_TO_EDGE)return"clamp-to-edge";if(e===yl.REPEAT)return"repeat";if(e===yl.MIRRORED_REPEAT)return"mirror-repeat";throw new Error("whoops")}function XE(e){if(e===es.BILINEAR)return"linear";if(e===es.POINT)return"nearest";throw new Error("whoops")}function vk(e){if(e===Xs.LINEAR)return"linear";if(e===Xs.NEAREST)return"nearest";if(e===Xs.NO_MIP)return"nearest";throw new Error("whoops")}function kv(e){var r=e;return r.gpuBuffer}function mk(e){var r=e;return r.gpuSampler}function gk(e){var r=e;return r.querySet}function _k(e){if(e===r0.OcclusionConservative)return"occlusion";throw new Error("whoops")}function yk(e){switch(e){case ws.TRIANGLES:return"triangle-list";case ws.POINTS:return"point-list";case ws.TRIANGLE_STRIP:return"triangle-strip";case ws.LINES:return"line-list";case ws.LINE_STRIP:return"line-strip";default:throw new Error("Unknown primitive topology mode")}}function xk(e){if(e===jl.NONE)return"none";if(e===jl.FRONT)return"front";if(e===jl.BACK)return"back";throw new Error("whoops")}function bk(e){if(e===Nm.CCW)return"ccw";if(e===Nm.CW)return"cw";throw new Error("whoops")}function Ek(e,r){return{topology:yk(e),cullMode:xk(r.cullMode),frontFace:bk(r.frontFace)}}function $E(e){if(e===Xi.ZERO)return"zero";if(e===Xi.ONE)return"one";if(e===Xi.SRC)return"src";if(e===Xi.ONE_MINUS_SRC)return"one-minus-src";if(e===Xi.DST)return"dst";if(e===Xi.ONE_MINUS_DST)return"one-minus-dst";if(e===Xi.SRC_ALPHA)return"src-alpha";if(e===Xi.ONE_MINUS_SRC_ALPHA)return"one-minus-src-alpha";if(e===Xi.DST_ALPHA)return"dst-alpha";if(e===Xi.ONE_MINUS_DST_ALPHA)return"one-minus-dst-alpha";if(e===Xi.CONST)return"constant";if(e===Xi.ONE_MINUS_CONSTANT)return"one-minus-constant";if(e===Xi.SRC_ALPHA_SATURATE)return"src-alpha-saturated";throw new Error("whoops")}function Sk(e){if(e===iu.ADD)return"add";if(e===iu.SUBSTRACT)return"subtract";if(e===iu.REVERSE_SUBSTRACT)return"reverse-subtract";if(e===iu.MIN)return"min";if(e===iu.MAX)return"max";throw new Error("whoops")}function YE(e){return{operation:Sk(e.blendMode),srcFactor:$E(e.blendSrcFactor),dstFactor:$E(e.blendDstFactor)}}function qE(e){return e.blendMode===iu.ADD&&e.blendSrcFactor===Xi.ONE&&e.blendDstFactor===Xi.ZERO}function Ak(e){if(!(qE(e.rgbBlendState)&&qE(e.alphaBlendState)))return{color:YE(e.rgbBlendState),alpha:YE(e.alphaBlendState)}}function Tk(e,r){return{format:P_(r),blend:Ak(e),writeMask:e.channelWriteMask}}function wk(e,r){return r.attachmentsState.map(function(t,n){return Tk(t,e[n])})}function v0(e){if(e===Ni.NEVER)return"never";if(e===Ni.LESS)return"less";if(e===Ni.EQUAL)return"equal";if(e===Ni.LEQUAL)return"less-equal";if(e===Ni.GREATER)return"greater";if(e===Ni.NOTEQUAL)return"not-equal";if(e===Ni.GEQUAL)return"greater-equal";if(e===Ni.ALWAYS)return"always";throw new Error("whoops")}function Dv(e){if(e===Ho.KEEP)return"keep";if(e===Ho.REPLACE)return"replace";if(e===Ho.ZERO)return"zero";if(e===Ho.DECREMENT_CLAMP)return"decrement-clamp";if(e===Ho.DECREMENT_WRAP)return"decrement-wrap";if(e===Ho.INCREMENT_CLAMP)return"increment-clamp";if(e===Ho.INCREMENT_WRAP)return"increment-wrap";if(e===Ho.INVERT)return"invert";throw new Error("whoops")}function Ck(e,r){if(!(0,Dp.Z)(e))return{format:P_(e),depthWriteEnabled:!!r.depthWrite,depthCompare:v0(r.depthCompare),depthBias:r.polygonOffset?1:0,depthBiasSlopeScale:r.polygonOffset?1:0,stencilFront:{compare:v0(r.stencilFront.compare),passOp:Dv(r.stencilFront.passOp),failOp:Dv(r.stencilFront.failOp),depthFailOp:Dv(r.stencilFront.depthFailOp)},stencilBack:{compare:v0(r.stencilBack.compare),passOp:Dv(r.stencilBack.passOp),failOp:Dv(r.stencilBack.failOp),depthFailOp:Dv(r.stencilBack.depthFailOp)},stencilReadMask:1,stencilWriteMask:1}}function Rk(e){if(e!==null){if(e===kt.U16_R)return"uint16";if(e===kt.U32_R)return"uint32";throw new Error("whoops")}}function Mk(e){if(e===Rd.VERTEX)return"vertex";if(e===Rd.INSTANCE)return"instance";throw new Error("whoops")}function Ik(e){if(e===kt.U8_R)return"uint8x2";if(e===kt.U8_RG)return"uint8x2";if(e===kt.U8_RGB)return"uint8x4";if(e===kt.U8_RGBA)return"uint8x4";if(e===kt.U8_RG_NORM)return"unorm8x2";if(e===kt.U8_RGBA_NORM)return"unorm8x4";if(e===kt.S8_RGB_NORM)return"snorm8x4";if(e===kt.S8_RGBA_NORM)return"snorm8x4";if(e===kt.U16_RG_NORM)return"unorm16x2";if(e===kt.U16_RGBA_NORM)return"unorm16x4";if(e===kt.S16_RG_NORM)return"snorm16x2";if(e===kt.S16_RGBA_NORM)return"snorm16x4";if(e===kt.S16_RG)return"uint16x2";if(e===kt.F16_RG)return"float16x2";if(e===kt.F16_RGBA)return"float16x4";if(e===kt.F32_R)return"float32";if(e===kt.F32_RG)return"float32x2";if(e===kt.F32_RGB)return"float32x3";if(e===kt.F32_RGBA)return"float32x4";throw"whoops"}function Pk(e){var r=sh(e);switch(r){case Ir.BC1:case Ir.BC2:case Ir.BC3:case Ir.BC4_SNORM:case Ir.BC4_UNORM:case Ir.BC5_SNORM:case Ir.BC5_UNORM:return!0;default:return!1}}function Ok(e){var r=sh(e);switch(r){case Ir.BC1:case Ir.BC2:case Ir.BC3:case Ir.BC4_SNORM:case Ir.BC4_UNORM:case Ir.BC5_SNORM:case Ir.BC5_UNORM:return 4;default:return 1}}function KE(e,r,t,n){switch(t===void 0&&(t=!1),e){case kt.S8_R:case kt.S8_R_NORM:case kt.S8_RG_NORM:case kt.S8_RGB_NORM:case kt.S8_RGBA_NORM:{var i=r instanceof ArrayBuffer?new Int8Array(r):new Int8Array(r);return n&&i.set(new Int8Array(n)),i}case kt.U8_R:case kt.U8_R_NORM:case kt.U8_RG:case kt.U8_RG_NORM:case kt.U8_RGB:case kt.U8_RGB_NORM:case kt.U8_RGB_SRGB:case kt.U8_RGBA:case kt.U8_RGBA_NORM:case kt.U8_RGBA_SRGB:{var a=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&a.set(new Uint8Array(n)),a}case kt.S16_R:case kt.S16_RG:case kt.S16_RG_NORM:case kt.S16_RGB_NORM:case kt.S16_RGBA:case kt.S16_RGBA_NORM:{var s=r instanceof ArrayBuffer?new Int16Array(r):new Int16Array(t?r/2:r);return n&&s.set(new Int16Array(n)),s}case kt.U16_R:case kt.U16_RGB:case kt.U16_RGBA_5551:case kt.U16_RGBA_NORM:case kt.U16_RG_NORM:case kt.U16_R_NORM:{var l=r instanceof ArrayBuffer?new Uint16Array(r):new Uint16Array(t?r/2:r);return n&&l.set(new Uint16Array(n)),l}case kt.S32_R:{var f=r instanceof ArrayBuffer?new Int32Array(r):new Int32Array(t?r/4:r);return n&&f.set(new Int32Array(n)),f}case kt.U32_R:case kt.U32_RG:{var d=r instanceof ArrayBuffer?new Uint32Array(r):new Uint32Array(t?r/4:r);return n&&d.set(new Uint32Array(n)),d}case kt.F32_R:case kt.F32_RG:case kt.F32_RGB:case kt.F32_RGBA:{var y=r instanceof ArrayBuffer?new Float32Array(r):new Float32Array(t?r/4:r);return n&&y.set(new Float32Array(n)),y}}var b=r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r);return n&&b.set(new Uint8Array(n)),b}function kk(e){var r=(e&32768)>>15,t=(e&31744)>>10,n=e&1023;return t===0?(r?-1:1)*Math.pow(2,-14)*(n/Math.pow(2,10)):t==31?n?NaN:(r?-1:1)*(1/0):(r?-1:1)*Math.pow(2,t-15)*(1+n/Math.pow(2,10))}var uh=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this)||this;return a.id=n,a.device=i,a}return r.prototype.destroy=function(){},r}(bE.Z),Dk=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;f.type=ga.Bindings;var d=a.pipeline;Oi(!!d);var y=a.uniformBufferBindings,b=a.storageBufferBindings,T=a.samplerBindings,M=a.storageTextureBindings;f.numUniformBuffers=(y==null?void 0:y.length)||0;var P=[[],[],[],[]],k=0;if(y&&y.length)for(var H=0;H<y.length;H++){var q=a.uniformBufferBindings[H],ae=q.binding,Se=q.size,ze=q.offset,it=q.buffer,ut={buffer:kv(it),offset:ze!=null?ze:0,size:Se};P[0].push({binding:ae!=null?ae:k++,resource:ut})}if(T&&T.length){k=0;for(var H=0;H<T.length;H++){var ot=(0,In.pi)((0,In.pi)({},T[H]),OE),ae=a.samplerBindings[H],Ct=ae.texture!==null?ae.texture:f.device.getFallbackTexture(ot);ot.dimension=Ct.dimension,ot.formatKind=TE(Ct.format);var Xt=Ct.gpuTextureView;if(P[1].push({binding:(s=ae.textureBinding)!==null&&s!==void 0?s:k++,resource:Xt}),ae.samplerBinding!==-1){var Sr=ae.sampler!==null?ae.sampler:f.device.getFallbackSampler(ot),_r=mk(Sr);P[1].push({binding:(l=ae.samplerBinding)!==null&&l!==void 0?l:k++,resource:_r})}}}if(b&&b.length){k=0;for(var H=0;H<b.length;H++){var Wr=a.storageBufferBindings[H],ae=Wr.binding,Se=Wr.size,ze=Wr.offset,it=Wr.buffer,ut={buffer:kv(it),offset:ze!=null?ze:0,size:Se};P[2].push({binding:ae!=null?ae:k++,resource:ut})}}if(M&&M.length){k=0;for(var H=0;H<M.length;H++){var Cn=a.storageTextureBindings[H],ae=Cn.binding,Ct=Cn.texture,Xt=Ct.gpuTextureView;P[3].push({binding:ae!=null?ae:k++,resource:Xt})}}var wi=P.findLastIndex(function(ua){return!!ua.length});return f.gpuBindGroup=P.map(function(ua,co){return co<=wi&&f.device.device.createBindGroup({layout:d.getBindGroupLayout(co),entries:ua})}),f}return r}(uh),Lk=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ga.Buffer;var l=a.usage,f=a.viewOrSize,d=!!(l&ro.MAP_READ);s.usage=dk(l),d&&(s.usage=ro.MAP_READ|ro.COPY_DST);var y=!(0,Sv.Z)(f);if(s.view=(0,Sv.Z)(f)?null:f,s.size=(0,Sv.Z)(f)?a0(f,4):a0(f.byteLength,4),(0,Sv.Z)(f))s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:d?y:!1});else{s.gpuBuffer=s.device.device.createBuffer({usage:s.usage,size:s.size,mappedAtCreation:!0});var b=f&&f.constructor||Float32Array;new b(s.gpuBuffer.getMappedRange()).set(f),s.gpuBuffer.unmap()}return s}return r.prototype.setSubData=function(t,n,i,a){i===void 0&&(i=0),a===void 0&&(a=0);var s=this.gpuBuffer;a=a||n.byteLength,a=Math.min(a,this.size-t);var l=n.byteOffset+i,f=l+a,d=a+3&-4;if(d!==a){var y=new Uint8Array(n.buffer.slice(l,f));n=new Uint8Array(d),n.set(y),i=0,l=0,f=d,a=d}for(var b=1024*1024*15,T=0;f-(l+T)>b;)this.device.device.queue.writeBuffer(s,t+T,n.buffer,l+T,b),T+=b;this.device.device.queue.writeBuffer(s,t+T,n.buffer,l+T,a-T)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuBuffer.destroy()},r}(uh),Bk=function(){function e(){this.commandEncoder=null,this.gpuComputePassEncoder=null}return e.prototype.dispatchWorkgroups=function(r,t,n){this.gpuComputePassEncoder.dispatchWorkgroups(r,t,n)},e.prototype.dispatchWorkgroupsIndirect=function(r,t){this.gpuComputePassEncoder.dispatchWorkgroupsIndirect(r.gpuBuffer,t)},e.prototype.finish=function(){return this.gpuComputePassEncoder.end(),this.gpuComputePassEncoder=null,this.commandEncoder.finish()},e.prototype.beginComputePass=function(){Oi(this.gpuComputePassEncoder===null),this.gpuComputePassEncoder=this.commandEncoder.beginComputePass(this.gpuComputePassDescriptor)},e.prototype.setPipeline=function(r){var t=r,n=Md(t.gpuComputePipeline);this.gpuComputePassEncoder.setPipeline(n)},e.prototype.setBindings=function(r){var t=this,n=r;n.gpuBindGroup.forEach(function(i,a){i&&t.gpuComputePassEncoder.setBindGroup(a,n.gpuBindGroup[a])})},e.prototype.pushDebugGroup=function(r){this.gpuComputePassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuComputePassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuComputePassEncoder.insertDebugMarker(r)},e}(),Fk=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ga.ComputePipeline,s.gpuComputePipeline=null,s.descriptor=a;var l=a.program,f=l.computeStage;if(f===null)return s;var d={layout:"auto",compute:(0,In.pi)({},f)};return s.gpuComputePipeline=s.device.device.createComputePipeline(d),s.name!==void 0&&(s.gpuComputePipeline.label=s.name),s}return r.prototype.getBindGroupLayout=function(t){return this.gpuComputePipeline.getBindGroupLayout(t)},r}(uh),Nk=function(e){(0,In.ZT)(r,e);function r(t){var n,i,a,s,l=t.id,f=t.device,d=t.descriptor,y=e.call(this,{id:l,device:f})||this;y.type=ga.InputLayout;var b=[];try{for(var T=(0,In.XA)(d.vertexBufferDescriptors),M=T.next();!M.done;M=T.next()){var P=M.value,k=P.arrayStride,H=P.stepMode,q=P.attributes;b.push({arrayStride:k,stepMode:Mk(H),attributes:[]});try{for(var ae=(a=void 0,(0,In.XA)(q)),Se=ae.next();!Se.done;Se=ae.next()){var ze=Se.value,it=ze.shaderLocation,ut=ze.format,ot=ze.offset;b[b.length-1].attributes.push({shaderLocation:it,format:Ik(ut),offset:ot})}}catch(Ct){a={error:Ct}}finally{try{Se&&!Se.done&&(s=ae.return)&&s.call(ae)}finally{if(a)throw a.error}}}}catch(Ct){n={error:Ct}}finally{try{M&&!M.done&&(i=T.return)&&i.call(T)}finally{if(n)throw n.error}}return y.indexFormat=Rk(d.indexBufferFormat),y.buffers=b,y}return r}(uh),QE=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ga.Program,s.vertexStage=null,s.fragmentStage=null,s.computeStage=null,s.descriptor=a,a.vertex&&(s.vertexStage=s.createShaderStage(a.vertex,"vertex")),a.fragment&&(s.fragmentStage=s.createShaderStage(a.fragment,"fragment")),a.compute&&(s.computeStage=s.createShaderStage(a.compute,"compute")),s}return r.prototype.setUniformsLegacy=function(t){},r.prototype.createShaderStage=function(t,n){var i,a,s=t.glsl,l=t.wgsl,f=t.entryPoint,d=!1,y=l;if(!y)try{y=this.device.glsl_compile(s,n,d)}catch(H){throw console.error(H,s),new Error("whoops")}var b=function(H){if(!y.includes(H))return"continue";y=y.replace("var T_".concat(H,": texture_2d<f32>;"),"var T_".concat(H,": texture_depth_2d;")),y=y.replace(new RegExp("textureSample\\(T_".concat(H,"(.*)\\);$"),"gm"),function(q,ae){return"vec4<f32>(textureSample(T_".concat(H).concat(ae,"), 0.0, 0.0, 0.0);")})};try{for(var T=(0,In.XA)(["u_TextureFramebufferDepth"]),M=T.next();!M.done;M=T.next()){var P=M.value;b(P)}}catch(H){i={error:H}}finally{try{M&&!M.done&&(a=T.return)&&a.call(T)}finally{if(i)throw i.error}}var k=this.device.device.createShaderModule({code:y});return{module:k,entryPoint:f||"main"}},r}(uh),Uk=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;s.type=ga.QueryPool;var l=a.elemCount,f=a.type;return s.querySet=s.device.device.createQuerySet({type:_k(f),count:l}),s.resolveBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.QUERY_RESOLVE|GPUBufferUsage.COPY_SRC}),s.cpuBuffer=s.device.device.createBuffer({size:l*8,usage:GPUBufferUsage.COPY_DST|GPUBufferUsage.MAP_READ}),s.results=null,s}return r.prototype.queryResultOcclusion=function(t){return this.results===null?null:this.results[t]!==BigInt(0)},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.querySet.destroy(),this.resolveBuffer.destroy(),this.cpuBuffer.destroy()},r}(uh),zk=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=e.call(this,{id:n,device:i})||this;return a.type=ga.Readback,a}return r.prototype.readTexture=function(t,n,i,a,s,l,f,d){return f===void 0&&(f=0),(0,In.mG)(this,void 0,void 0,function(){var y,b,T,M,P,k,H,q;return(0,In.Jh)(this,function(ae){return y=t,b=0,T=this.getBlockInformationFromFormat(y.gpuTextureformat),M=Math.ceil(a/T.width)*T.length,P=Math.ceil(M/256)*256,k=P*s,H=this.device.createBuffer({usage:ro.STORAGE|ro.MAP_READ|ro.COPY_DST,hint:bf.STATIC,viewOrSize:k}),q=this.device.device.createCommandEncoder(),q.copyTextureToBuffer({texture:y.gpuTexture,mipLevel:0,origin:{x:n,y:i,z:Math.max(b,0)}},{buffer:H.gpuBuffer,offset:0,bytesPerRow:P},{width:a,height:s,depthOrArrayLayers:1}),this.device.device.queue.submit([q.finish()]),[2,this.readBuffer(H,0,l.byteLength===k?l:null,f,k,y.format,!0,!1,M,P,s)]})})},r.prototype.readTextureSync=function(t,n,i,a,s,l,f,d){throw new Error("ERROR_MSG_METHOD_NOT_IMPLEMENTED")},r.prototype.readBuffer=function(t,n,i,a,s,l,f,d,y,b,T){var M=this;n===void 0&&(n=0),i===void 0&&(i=null),s===void 0&&(s=0),l===void 0&&(l=kt.U8_RGB),f===void 0&&(f=!1),y===void 0&&(y=0),b===void 0&&(b=0),T===void 0&&(T=0);var P=t,k=s||P.size,H=i||P.view,q=H&&H.constructor&&H.constructor.BYTES_PER_ELEMENT||AE(l),ae=P;if(!(P.usage&ro.MAP_READ&&P.usage&ro.COPY_DST)){var Se=this.device.device.createCommandEncoder();ae=this.device.createBuffer({usage:ro.STORAGE|ro.MAP_READ|ro.COPY_DST,hint:bf.STATIC,viewOrSize:k}),Se.copyBufferToBuffer(P.gpuBuffer,n,ae.gpuBuffer,0,k),this.device.device.queue.submit([Se.finish()])}return new Promise(function(ze,it){ae.gpuBuffer.mapAsync(I_.READ,n,k).then(function(){var ut=ae.gpuBuffer.getMappedRange(n,k),ot=H;if(f)ot===null?ot=KE(l,k,!0,ut):ot=KE(l,ot.buffer,void 0,ut);else if(ot===null)switch(q){case 1:ot=new Uint8Array(k),ot.set(new Uint8Array(ut));break;case 2:ot=M.getHalfFloatAsFloatRGBAArrayBuffer(k/2,ut);break;case 4:ot=new Float32Array(k/4),ot.set(new Float32Array(ut));break}else switch(q){case 1:ot=new Uint8Array(ot.buffer),ot.set(new Uint8Array(ut));break;case 2:ot=M.getHalfFloatAsFloatRGBAArrayBuffer(k/2,ut,H);break;case 4:var Ct=H&&H.constructor||Float32Array;ot=new Ct(ot.buffer),ot.set(new Ct(ut));break}if(y!==b){q===1&&!f&&(y*=2,b*=2);for(var Xt=new Uint8Array(ot.buffer),Sr=y,_r=0,Wr=1;Wr<T;++Wr){_r=Wr*b;for(var Cn=0;Cn<y;++Cn)Xt[Sr++]=Xt[_r++]}q!==0&&!f?ot=new Float32Array(Xt.buffer,0,Sr/4):ot=new Uint8Array(Xt.buffer,0,Sr)}ae.gpuBuffer.unmap(),ze(ot)},function(ut){return it(ut)})})},r.prototype.getHalfFloatAsFloatRGBAArrayBuffer=function(t,n,i){i||(i=new Float32Array(t));for(var a=new Uint16Array(n);t--;)i[t]=kk(a[t]);return i},r.prototype.getBlockInformationFromFormat=function(t){switch(t){case"r8unorm":case"r8snorm":case"r8uint":case"r8sint":return{width:1,height:1,length:1};case"r16uint":case"r16sint":case"r16float":case"rg8unorm":case"rg8snorm":case"rg8uint":case"rg8sint":return{width:1,height:1,length:2};case"r32uint":case"r32sint":case"r32float":case"rg16uint":case"rg16sint":case"rg16float":case"rgba8unorm":case"rgba8unorm-srgb":case"rgba8snorm":case"rgba8uint":case"rgba8sint":case"bgra8unorm":case"bgra8unorm-srgb":case"rgb9e5ufloat":case"rgb10a2unorm":case"rg11b10ufloat":return{width:1,height:1,length:4};case"rg32uint":case"rg32sint":case"rg32float":case"rgba16uint":case"rgba16sint":case"rgba16float":return{width:1,height:1,length:8};case"rgba32uint":case"rgba32sint":case"rgba32float":return{width:1,height:1,length:16};case"stencil8":throw new Error("No fixed size for Stencil8 format!");case"depth16unorm":return{width:1,height:1,length:2};case"depth24plus":throw new Error("No fixed size for Depth24Plus format!");case"depth24plus-stencil8":throw new Error("No fixed size for Depth24PlusStencil8 format!");case"depth32float":return{width:1,height:1,length:4};case"depth32float-stencil8":return{width:1,height:1,length:5};case"bc7-rgba-unorm":case"bc7-rgba-unorm-srgb":case"bc6h-rgb-ufloat":case"bc6h-rgb-float":case"bc2-rgba-unorm":case"bc2-rgba-unorm-srgb":case"bc3-rgba-unorm":case"bc3-rgba-unorm-srgb":case"bc5-rg-unorm":case"bc5-rg-snorm":return{width:4,height:4,length:16};case"bc4-r-unorm":case"bc4-r-snorm":case"bc1-rgba-unorm":case"bc1-rgba-unorm-srgb":return{width:4,height:4,length:8};default:return{width:1,height:1,length:4}}},r}(uh),Zk=function(){function e(r){this.device=r,this.commandEncoder=null,this.gpuRenderPassEncoder=null,this.gfxColorAttachment=[],this.gfxColorAttachmentLevel=[],this.gfxColorResolveTo=[],this.gfxColorResolveToLevel=[],this.gfxDepthStencilAttachment=null,this.gfxDepthStencilResolveTo=null,this.gpuColorAttachments=[],this.gpuDepthStencilAttachment={view:null,depthLoadOp:"load",depthStoreOp:"store",stencilLoadOp:"load",stencilStoreOp:"store"},this.gpuRenderPassDescriptor={colorAttachments:this.gpuColorAttachments,depthStencilAttachment:this.gpuDepthStencilAttachment}}return e.prototype.getTextureView=function(r,t){return Oi(t<r.mipLevelCount),r.mipLevelCount===1?r.gpuTextureView:r.gpuTexture.createView({baseMipLevel:t,mipLevelCount:1})},e.prototype.setRenderPassDescriptor=function(r){var t,n,i,a,s,l;this.descriptor=r,this.gpuRenderPassDescriptor.colorAttachments=this.gpuColorAttachments;var f=r.colorAttachment.length;this.gfxColorAttachment.length=f,this.gfxColorResolveTo.length=f;for(var d=0;d<r.colorAttachment.length;d++){var y=r.colorAttachment[d],b=r.colorResolveTo[d];if(y===null&&b!==null&&(y=b,b=null),this.gfxColorAttachment[d]=y,this.gfxColorResolveTo[d]=b,this.gfxColorAttachmentLevel[d]=((t=r.colorAttachmentLevel)===null||t===void 0?void 0:t[d])||0,this.gfxColorResolveToLevel[d]=((n=r.colorResolveToLevel)===null||n===void 0?void 0:n[d])||0,y!==null){this.gpuColorAttachments[d]===void 0&&(this.gpuColorAttachments[d]={});var T=this.gpuColorAttachments[d];T.view=this.getTextureView(y,((i=this.gfxColorAttachmentLevel)===null||i===void 0?void 0:i[d])||0);var M=(s=(a=r.colorClearColor)===null||a===void 0?void 0:a[d])!==null&&s!==void 0?s:"load";M==="load"?T.loadOp="load":(T.loadOp="clear",T.clearValue=M),T.storeOp=!((l=r.colorStore)===null||l===void 0)&&l[d]?"store":"discard",T.resolveTarget=void 0,b!==null&&(y.sampleCount>1?T.resolveTarget=this.getTextureView(b,this.gfxColorResolveToLevel[d]):T.storeOp="store")}else{this.gpuColorAttachments.length=d,this.gfxColorAttachment.length=d,this.gfxColorResolveTo.length=d;break}}if(this.gfxDepthStencilAttachment=r.depthStencilAttachment,this.gfxDepthStencilResolveTo=r.depthStencilResolveTo,r.depthStencilAttachment){var P=r.depthStencilAttachment,T=this.gpuDepthStencilAttachment;T.view=P.gpuTextureView;var k=!!(wv(P.format)&wn.Depth);k?(r.depthClearValue==="load"?T.depthLoadOp="load":(T.depthLoadOp="clear",T.depthClearValue=r.depthClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?T.depthStoreOp="store":T.depthStoreOp="discard"):(T.depthLoadOp=void 0,T.depthStoreOp=void 0);var H=!!(wv(P.format)&wn.Stencil);H?(r.stencilClearValue==="load"?T.stencilLoadOp="load":(T.stencilLoadOp="clear",T.stencilClearValue=r.stencilClearValue),r.depthStencilStore||this.gfxDepthStencilResolveTo!==null?T.stencilStoreOp="store":T.stencilStoreOp="discard"):(T.stencilLoadOp=void 0,T.stencilStoreOp=void 0),this.gpuRenderPassDescriptor.depthStencilAttachment=this.gpuDepthStencilAttachment}else this.gpuRenderPassDescriptor.depthStencilAttachment=void 0;this.gpuRenderPassDescriptor.occlusionQuerySet=(0,Dp.Z)(r.occlusionQueryPool)?void 0:gk(r.occlusionQueryPool)},e.prototype.beginRenderPass=function(r){Oi(this.gpuRenderPassEncoder===null),this.setRenderPassDescriptor(r),this.gpuRenderPassEncoder=this.commandEncoder.beginRenderPass(this.gpuRenderPassDescriptor)},e.prototype.flipY=function(r,t){var n=this.device.swapChainHeight;return n-r-t},e.prototype.setViewport=function(r,t,n,i,a,s){a===void 0&&(a=0),s===void 0&&(s=1),this.gpuRenderPassEncoder.setViewport(r,this.flipY(t,i),n,i,a,s)},e.prototype.setScissorRect=function(r,t,n,i){this.gpuRenderPassEncoder.setScissorRect(r,this.flipY(t,i),n,i)},e.prototype.setPipeline=function(r){var t=r,n=Md(t.gpuRenderPipeline);this.gpuRenderPassEncoder.setPipeline(n)},e.prototype.setVertexInput=function(r,t,n){if(r!==null){var i=r;n!==null&&this.gpuRenderPassEncoder.setIndexBuffer(kv(n.buffer),Md(i.indexFormat),n.offset);for(var a=0;a<t.length;a++){var s=t[a];s!==null&&this.gpuRenderPassEncoder.setVertexBuffer(a,kv(s.buffer),s.offset)}}},e.prototype.setBindings=function(r){var t=this,n=r;n.gpuBindGroup.forEach(function(i,a){i&&t.gpuRenderPassEncoder.setBindGroup(a,n.gpuBindGroup[a])})},e.prototype.setStencilReference=function(r){this.gpuRenderPassEncoder.setStencilReference(r)},e.prototype.draw=function(r,t,n,i){this.gpuRenderPassEncoder.draw(r,t,n,i)},e.prototype.drawIndexed=function(r,t,n,i,a){this.gpuRenderPassEncoder.drawIndexed(r,t,n,i,a)},e.prototype.drawIndirect=function(r,t){this.gpuRenderPassEncoder.drawIndirect(kv(r),t)},e.prototype.drawIndexedIndirect=function(r,t){this.gpuRenderPassEncoder.drawIndexedIndirect(kv(r),t)},e.prototype.beginOcclusionQuery=function(r){this.gpuRenderPassEncoder.beginOcclusionQuery(r)},e.prototype.endOcclusionQuery=function(){this.gpuRenderPassEncoder.endOcclusionQuery()},e.prototype.pushDebugGroup=function(r){this.gpuRenderPassEncoder.pushDebugGroup(r)},e.prototype.popDebugGroup=function(){this.gpuRenderPassEncoder.popDebugGroup()},e.prototype.insertDebugMarker=function(r){this.gpuRenderPassEncoder.insertDebugMarker(r)},e.prototype.finish=function(){this.gpuRenderPassEncoder.end(),this.gpuRenderPassEncoder=null;for(var r=0;r<this.gfxColorAttachment.length;r++){var t=this.gfxColorAttachment[r],n=this.gfxColorResolveTo[r];t!==null&&n!==null&&t.sampleCount===1&&this.copyAttachment(n,this.gfxColorAttachmentLevel[r],t,this.gfxColorResolveToLevel[r])}return this.gfxDepthStencilAttachment&&this.gfxDepthStencilResolveTo&&(this.gfxDepthStencilAttachment.sampleCount>1||this.copyAttachment(this.gfxDepthStencilResolveTo,0,this.gfxDepthStencilAttachment,0)),this.commandEncoder.finish()},e.prototype.copyAttachment=function(r,t,n,i){Oi(n.sampleCount===1);var a={texture:n.gpuTexture,mipLevel:i},s={texture:r.gpuTexture,mipLevel:t};Oi(n.width>>>i===r.width>>>t),Oi(n.height>>>i===r.height>>>t),Oi(!!(n.usage&$s.COPY_SRC)),Oi(!!(r.usage&$s.COPY_DST)),this.commandEncoder.copyTextureToTexture(a,s,[r.width,r.height,1])},e}(),Vk=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=e.call(this,{id:n,device:i})||this;return s.type=ga.RenderPipeline,s.isCreatingAsync=!1,s.gpuRenderPipeline=null,s.descriptor=a,s.device.createRenderPipelineInternal(s,!1),s}return r.prototype.getBindGroupLayout=function(t){return this.gpuRenderPipeline.getBindGroupLayout(t)},r}(uh),jk=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s,l,f=e.call(this,{id:n,device:i})||this;f.type=ga.Sampler;var d=a.lodMinClamp,y=a.mipmapFilter===Xs.NO_MIP?a.lodMinClamp:a.lodMaxClamp,b=(s=a.maxAnisotropy)!==null&&s!==void 0?s:1;return b>1&&Oi(a.minFilter===es.BILINEAR&&a.magFilter===es.BILINEAR&&a.mipmapFilter===Xs.LINEAR),f.gpuSampler=f.device.device.createSampler({addressModeU:O_(a.addressModeU),addressModeV:O_(a.addressModeV),addressModeW:O_((l=a.addressModeW)!==null&&l!==void 0?l:a.addressModeU),lodMinClamp:d,lodMaxClamp:y,minFilter:XE(a.minFilter),magFilter:XE(a.magFilter),mipmapFilter:vk(a.mipmapFilter),compare:a.compareFunction!==void 0?v0(a.compareFunction):void 0,maxAnisotropy:b}),f}return r}(uh),m0=function(e){(0,In.ZT)(r,e);function r(t){var n=t.id,i=t.device,a=t.descriptor,s=t.skipCreate,l=t.sampleCount,f=e.call(this,{id:n,device:i})||this;f.type=ga.Texture,f.flipY=!1;var d=a.format,y=a.dimension,b=a.width,T=a.height,M=a.depthOrArrayLayers,P=a.mipLevelCount,k=a.usage,H=a.pixelStore;return f.flipY=!!(H!=null&&H.unpackFlipY),f.device.createTextureShared({format:d,dimension:y!=null?y:Wi.TEXTURE_2D,width:b,height:T,depthOrArrayLayers:M!=null?M:1,mipLevelCount:P!=null?P:1,usage:k,sampleCount:l!=null?l:1},f,s),f}return r.prototype.textureFromImageBitmapOrCanvas=function(t,n,i){for(var a=n[0].width,s=n[0].height,l={size:{width:a,height:s,depthOrArrayLayers:i},format:"rgba8unorm",usage:GPUTextureUsage.TEXTURE_BINDING|GPUTextureUsage.COPY_DST|GPUTextureUsage.RENDER_ATTACHMENT},f=t.createTexture(l),d=0;d<n.length;d++)t.queue.copyExternalImageToTexture({source:n[d],flipY:this.flipY},{texture:f,origin:[0,0,d]},[a,s]);return[f,a,s]},r.prototype.isImageBitmapOrCanvases=function(t){var n=t[0];return n instanceof ImageBitmap||n instanceof HTMLCanvasElement||n instanceof OffscreenCanvas},r.prototype.isVideo=function(t){var n=t[0];return n instanceof HTMLVideoElement},r.prototype.setImageData=function(t,n){var i,a=this,s=this.device.device,l,f,d;this.isImageBitmapOrCanvases(t)?(i=(0,In.CR)(this.textureFromImageBitmapOrCanvas(s,t,this.depthOrArrayLayers),3),l=i[0],f=i[1],d=i[2]):this.isVideo(t)?l=s.importExternalTexture({source:t[0]}):t.forEach(function(y){s.queue.writeTexture({texture:a.gpuTexture},y,{},{width:a.width,height:a.height})}),this.width=f,this.height=d,l&&(this.gpuTexture=l),this.gpuTextureView=this.gpuTexture.createView({dimension:pk(this.dimension)})},r.prototype.destroy=function(){e.prototype.destroy.call(this),this.gpuTexture.destroy()},r}(uh),Hk=function(){function e(r,t,n,i,a,s){this.swapChainWidth=0,this.swapChainHeight=0,this.swapChainTextureUsage=$s.RENDER_ATTACHMENT|$s.COPY_DST,this._resourceUniqueId=0,this.renderPassPool=[],this.computePassPool=[],this.featureTextureCompressionBC=!1,this.platformString="WebGPU",this.glslVersion="#version 440",this.explicitBindingLocations=!0,this.separateSamplerTextures=!0,this.viewportOrigin=Av.UPPER_LEFT,this.clipSpaceNearZ=Tv.ZERO,this.supportsSyncPipelineCompilation=!1,this.supportMRT=!0,this.device=t,this.canvas=n,this.canvasContext=i,this.glsl_compile=a,this.WGSLComposer=s,this.fallbackTexture2D=this.createFallbackTexture(Wi.TEXTURE_2D,Wo.Float),this.setResourceName(this.fallbackTexture2D,"Fallback Texture2D"),this.fallbackTexture2DDepth=this.createFallbackTexture(Wi.TEXTURE_2D,Wo.Depth),this.setResourceName(this.fallbackTexture2DDepth,"Fallback Depth Texture2D"),this.fallbackTexture2DArray=this.createFallbackTexture(Wi.TEXTURE_2D_ARRAY,Wo.Float),this.setResourceName(this.fallbackTexture2DArray,"Fallback Texture2DArray"),this.fallbackTexture3D=this.createFallbackTexture(Wi.TEXTURE_3D,Wo.Float),this.setResourceName(this.fallbackTexture3D,"Fallback Texture3D"),this.fallbackTextureCube=this.createFallbackTexture(Wi.TEXTURE_CUBE_MAP,Wo.Float),this.setResourceName(this.fallbackTextureCube,"Fallback TextureCube"),this.fallbackSamplerFiltering=this.createSampler({addressModeU:yl.REPEAT,addressModeV:yl.REPEAT,minFilter:es.POINT,magFilter:es.POINT,mipmapFilter:Xs.NEAREST}),this.setResourceName(this.fallbackSamplerFiltering,"Fallback Sampler Filtering"),this.fallbackSamplerComparison=this.createSampler({addressModeU:yl.REPEAT,addressModeV:yl.REPEAT,minFilter:es.POINT,magFilter:es.POINT,mipmapFilter:Xs.NEAREST,compareFunction:Ni.ALWAYS}),this.setResourceName(this.fallbackSamplerComparison,"Fallback Sampler Comparison Filtering"),this.device.features&&(this.featureTextureCompressionBC=this.device.features.has("texture-compression-bc")),this.device.onuncapturederror=function(l){console.error(l.error)},this.swapChainFormat=navigator.gpu.getPreferredCanvasFormat(),this.canvasContext.configure({device:this.device,format:this.swapChainFormat,usage:this.swapChainTextureUsage,alphaMode:"premultiplied"})}return e.prototype.destroy=function(){},e.prototype.configureSwapChain=function(r,t){this.swapChainWidth===r&&this.swapChainHeight===t||(this.swapChainWidth=r,this.swapChainHeight=t)},e.prototype.getOnscreenTexture=function(){var r=this.canvasContext.getCurrentTexture(),t=r.createView(),n=new m0({id:0,device:this,descriptor:{format:kt.U8_RGBA_RT,width:this.swapChainWidth,height:this.swapChainHeight,depthOrArrayLayers:0,dimension:Wi.TEXTURE_2D,mipLevelCount:1,usage:this.swapChainTextureUsage},skipCreate:!0});return n.depthOrArrayLayers=1,n.sampleCount=1,n.gpuTexture=r,n.gpuTextureView=t,n.name="Onscreen",this.setResourceName(n,"Onscreen Texture"),n},e.prototype.getDevice=function(){return this},e.prototype.getCanvas=function(){return this.canvas},e.prototype.beginFrame=function(){},e.prototype.endFrame=function(){},e.prototype.getNextUniqueId=function(){return++this._resourceUniqueId},e.prototype.createBuffer=function(r){return new Lk({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTexture=function(r){return new m0({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createSampler=function(r){return new jk({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderTarget=function(r){var t=new m0({id:this.getNextUniqueId(),device:this,descriptor:(0,In.pi)((0,In.pi)({},r),{dimension:Wi.TEXTURE_2D,mipLevelCount:1,depthOrArrayLayers:1,usage:Ou.RENDER_TARGET}),sampleCount:r.sampleCount});return t.depthOrArrayLayers=1,t.type=ga.RenderTarget,t},e.prototype.createRenderTargetFromTexture=function(r){var t=r,n=t.format,i=t.width,a=t.height,s=t.depthOrArrayLayers,l=t.sampleCount,f=t.mipLevelCount,d=t.gpuTexture,y=t.gpuTextureView,b=t.usage;Oi(!!(b&$s.RENDER_ATTACHMENT));var T=new m0({id:this.getNextUniqueId(),device:this,descriptor:{format:n,width:i,height:a,depthOrArrayLayers:s,dimension:Wi.TEXTURE_2D,mipLevelCount:f,usage:b},skipCreate:!0});return T.depthOrArrayLayers=s,T.sampleCount=l,T.gpuTexture=d,T.gpuTextureView=y,T},e.prototype.createProgram=function(r){var t,n;return!((t=r.vertex)===null||t===void 0)&&t.glsl&&(r.vertex.glsl=Fp(this.queryVendorInfo(),"vert",r.vertex.glsl)),!((n=r.fragment)===null||n===void 0)&&n.glsl&&(r.fragment.glsl=Fp(this.queryVendorInfo(),"frag",r.fragment.glsl)),new QE({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createProgramSimple=function(r){return new QE({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createTextureShared=function(r,t,n){var i={width:r.width,height:r.height,depthOrArrayLayers:r.depthOrArrayLayers},a=r.mipLevelCount,s=P_(r.format),l=hk(r.dimension),f=fk(r.usage);if(t.gpuTextureformat=s,t.dimension=r.dimension,t.format=r.format,t.width=r.width,t.height=r.height,t.depthOrArrayLayers=r.depthOrArrayLayers,t.mipLevelCount=a,t.usage=f,t.sampleCount=r.sampleCount,!n){var d=this.device.createTexture({size:i,mipLevelCount:a,format:s,dimension:l,sampleCount:r.sampleCount,usage:f}),y=d.createView();t.gpuTexture=d,t.gpuTextureView=y}},e.prototype.getFallbackSampler=function(r){var t=r.formatKind;return t===Wo.Depth&&r.comparison?this.fallbackSamplerComparison:this.fallbackSamplerFiltering},e.prototype.getFallbackTexture=function(r){var t=r.dimension,n=r.formatKind;if(t===Wi.TEXTURE_2D)return n===Wo.Depth?this.fallbackTexture2DDepth:this.fallbackTexture2D;if(t===Wi.TEXTURE_2D_ARRAY)return this.fallbackTexture2DArray;if(t===Wi.TEXTURE_3D)return this.fallbackTexture3D;if(t===Wi.TEXTURE_CUBE_MAP)return this.fallbackTextureCube;throw new Error("whoops")},e.prototype.createFallbackTexture=function(r,t){var n=r===Wi.TEXTURE_CUBE_MAP?6:1,i=t===Wo.Float?kt.U8_RGBA_NORM:kt.D24;return this.createTexture({dimension:r,format:i,usage:Ou.SAMPLED,width:1,height:1,depthOrArrayLayers:n,mipLevelCount:1})},e.prototype.createBindings=function(r){return new Dk({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createInputLayout=function(r){return new Nk({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createComputePipeline=function(r){return new Fk({id:this.getNextUniqueId(),device:this,descriptor:r})},e.prototype.createRenderPipeline=function(r){return new Vk({id:this.getNextUniqueId(),device:this,descriptor:(0,In.pi)({},r)})},e.prototype.createQueryPool=function(r,t){return new Uk({id:this.getNextUniqueId(),device:this,descriptor:{type:r,elemCount:t}})},e.prototype.createRenderPipelineInternal=function(r,t){var n;if(r.gpuRenderPipeline===null){var i=r.descriptor,a=i.program,s=a.vertexStage,l=a.fragmentStage;if(!(s===null||l===null)){var f=i.megaStateDescriptor||{},d=f.stencilBack,y=f.stencilFront,b=(0,In._T)(f,["stencilBack","stencilFront"]),T=Mv(Id);i.megaStateDescriptor=(0,In.pi)((0,In.pi)((0,In.pi)({},T),{stencilBack:(0,In.pi)((0,In.pi)({},T.stencilBack),d),stencilFront:(0,In.pi)((0,In.pi)({},T.stencilFront),y)}),b);var M=i.megaStateDescriptor.attachmentsState[0];i.colorAttachmentFormats.forEach(function(ze,it){i.megaStateDescriptor.attachmentsState[it]||(i.megaStateDescriptor.attachmentsState[it]=IE(void 0,M))});var P=Ek((n=i.topology)!==null&&n!==void 0?n:ws.TRIANGLES,i.megaStateDescriptor),k=wk(i.colorAttachmentFormats,i.megaStateDescriptor),H=Ck(i.depthStencilAttachmentFormat,i.megaStateDescriptor),q=void 0;i.inputLayout!==null&&(q=i.inputLayout.buffers);var ae=i.sampleCount,Se={layout:"auto",vertex:(0,In.pi)((0,In.pi)({},s),{buffers:q}),primitive:P,depthStencil:H,multisample:{count:ae},fragment:(0,In.pi)((0,In.pi)({},l),{targets:k})};r.gpuRenderPipeline=this.device.createRenderPipeline(Se)}}},e.prototype.createReadback=function(){return new zk({id:this.getNextUniqueId(),device:this})},e.prototype.createRenderPass=function(r){var t=this.renderPassPool.pop();return t===void 0&&(t=new Zk(this)),t.commandEncoder=this.device.createCommandEncoder(),t.beginRenderPass(r),t},e.prototype.createComputePass=function(){var r=this.computePassPool.pop();return r===void 0&&(r=new Bk),r.commandEncoder=this.device.createCommandEncoder(),r.beginComputePass(),r},e.prototype.submitPass=function(r){var t=this.device.queue,n=r,i=n.finish();t.submit([i]),n.commandEncoder=null},e.prototype.copySubTexture2D=function(r,t,n,i,a,s,l){var f=this.device.createCommandEncoder(),d=r,y=i,b={texture:y.gpuTexture,origin:[a,s,0],mipLevel:0,aspect:"all"},T={texture:d.gpuTexture,origin:[t,n,0],mipLevel:0,aspect:"all"};Oi(!!(y.usage&$s.COPY_SRC)),Oi(!!(d.usage&$s.COPY_DST)),f.copyTextureToTexture(b,T,[y.width,y.height,l||1]),this.device.queue.submit([f.finish()])},e.prototype.queryLimits=function(){return{uniformBufferMaxPageWordSize:this.device.limits.maxUniformBufferBindingSize>>>2,uniformBufferWordAlignment:this.device.limits.minUniformBufferOffsetAlignment>>>2,supportedSampleCounts:[1],occlusionQueriesRecommended:!0,computeShadersSupported:!0}},e.prototype.queryTextureFormatSupported=function(r,t,n){if(Pk(r)){if(!this.featureTextureCompressionBC)return!1;var i=Ok(r);return t%i!==0||n%i!==0?!1:this.featureTextureCompressionBC}switch(r){case kt.U16_RGBA_NORM:return!1;case kt.F32_RGBA:return!1}return!0},e.prototype.queryPlatformAvailable=function(){return!0},e.prototype.queryVendorInfo=function(){return this},e.prototype.queryRenderPass=function(r){var t=r;return t.descriptor},e.prototype.queryRenderTarget=function(r){var t=r;return t},e.prototype.setResourceName=function(r,t){if(r.name=t,r.type===ga.Buffer){var n=r;n.gpuBuffer.label=t}else if(r.type===ga.Texture){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===ga.RenderTarget){var n=r;n.gpuTexture.label=t,n.gpuTextureView.label=t}else if(r.type===ga.Sampler){var n=r;n.gpuSampler.label=t}else if(r.type===ga.RenderPipeline){var n=r;n.gpuRenderPipeline!==null&&(n.gpuRenderPipeline.label=t)}},e.prototype.setResourceLeakCheck=function(r,t){},e.prototype.checkForLeaks=function(){},e.prototype.programPatched=function(r){},e.prototype.pipelineQueryReady=function(r){var t=r;return t.gpuRenderPipeline!==null},e.prototype.pipelineForceReady=function(r){var t=r;this.createRenderPipelineInternal(t,!1)},e}(),Wk=function(){function e(r){this.pluginOptions=r}return e.prototype.createSwapChain=function(r){return(0,In.mG)(this,void 0,void 0,function(){var t,n,i,a,s,l,f,d;return(0,In.Jh)(this,function(y){switch(y.label){case 0:if(globalThis.navigator.gpu===void 0)return[2,null];t=null,y.label=1;case 1:return y.trys.push([1,3,,4]),n=this.pluginOptions.xrCompatible,[4,globalThis.navigator.gpu.requestAdapter({xrCompatible:n})];case 2:return t=y.sent(),[3,4];case 3:return i=y.sent(),console.log(i),[3,4];case 4:return t===null?[2,null]:(a=["depth32float-stencil8","texture-compression-bc"],s=a.filter(function(b){return t.features.has(b)}),[4,t.requestDevice({requiredFeatures:s})]);case 5:if(l=y.sent(),l&&(f=this.pluginOptions.onContextLost,l.lost.then(function(){f&&f()})),l===null)return[2,null];if(d=r.getContext("webgpu"),!d)return[2,null];y.label=6;case 6:return y.trys.push([6,8,,9]),[4,GE(this.pluginOptions.shaderCompilerPath)];case 7:return y.sent(),[3,9];case 8:return y.sent(),[3,9];case 9:return[2,new Hk(t,l,r,d,sk,Xm&&new Xm)]}})})},e}(),Gk=ui.isPlainObject,Xk=ui.isTypedArray,$k=function(){function e(r,t){(0,Q.Z)(this,e),(0,F.Z)(this,"destroyed",!1),(0,F.Z)(this,"uniforms",{}),this.reGl=r;var n=t.vs,i=t.fs,a=t.attributes,s=t.uniforms,l=t.primitive,f=t.count,d=t.elements,y=t.depth,b=t.cull,T=t.instances,M={platformString:"WebGL1",glslVersion:"#version 100",explicitBindingLocations:!1,separateSamplerTextures:!1,viewportOrigin:Av.LOWER_LEFT,clipSpaceNearZ:Tv.NEGATIVE_ONE,supportMRT:!1},P={};this.options=t,s&&(this.uniforms=this.extractUniforms(s),Object.keys(s).forEach(function(Se){P[Se]=r.prop(Se)}));var k={};Object.keys(a).forEach(function(Se){k[Se]=a[Se].get()});var H=dm(Fp(M,"frag",i,null,!1)),q=dm(Fp(M,"vert",n,null,!1)),ae={attributes:k,frag:H,uniforms:P,vert:q,colorMask:r.prop("colorMask"),lineWidth:1,blend:{enable:r.prop("blend.enable"),func:r.prop("blend.func"),equation:r.prop("blend.equation"),color:r.prop("blend.color")},stencil:{enable:r.prop("stencil.enable"),mask:r.prop("stencil.mask"),func:r.prop("stencil.func"),opFront:r.prop("stencil.opFront"),opBack:r.prop("stencil.opBack")},primitive:H5[l===void 0?I.TRIANGLES:l]};T&&(ae.instances=T),f?ae.count=f:d&&(ae.elements=d.get()),this.initDepthDrawParams({depth:y},ae),this.initCullDrawParams({cull:b},ae),this.drawCommand=r(ae),this.drawParams=ae}return(0,j.Z)(e,[{key:"updateAttributesAndElements",value:function(t,n){var i={};Object.keys(t).forEach(function(a){i[a]=t[a].get()}),this.drawParams.attributes=i,this.drawParams.elements=n.get(),this.drawCommand=this.reGl(this.drawParams)}},{key:"updateAttributes",value:function(t){var n={};Object.keys(t).forEach(function(i){n[i]=t[i].get()}),this.drawParams.attributes=n,this.drawCommand=this.reGl(this.drawParams)}},{key:"addUniforms",value:function(t){this.uniforms=(0,W.Z)((0,W.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){if(!(this.drawParams.attributes&&Object.keys(this.drawParams.attributes).length===0)){var i=(0,W.Z)((0,W.Z)({},this.uniforms),this.extractUniforms(t.uniforms||{})),a={};Object.keys(i).forEach(function(s){var l=(0,js.Z)(i[s]);l==="boolean"||l==="number"||Array.isArray(i[s])||i[s].BYTES_PER_ELEMENT?a[s]=i[s]:a[s]=i[s].get()}),a.blend=n?this.getBlendDrawParams({blend:{enable:!1}}):this.getBlendDrawParams(t),a.stencil=this.getStencilDrawParams(t),a.colorMask=this.getColorMaskDrawParams(t,n),this.drawCommand(a)}}},{key:"destroy",value:function(){var t;(t=this.drawParams)===null||t===void 0||(t=t.elements)===null||t===void 0||t.destroy(),this.options.attributes&&Object.values(this.options.attributes).forEach(function(n){n==null||n.destroy()}),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t,n){var i=t.depth;i&&(n.depth={enable:i.enable===void 0?!0:!!i.enable,mask:i.mask===void 0?!0:!!i.mask,func:$5[i.func||I.LESS],range:i.range||[0,1]})}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},a=i.enable,s=i.func,l=i.equation,f=i.color,d=f===void 0?[0,0,0,0]:f;return{enable:!!a,func:{srcRGB:t0[s&&s.srcRGB||I.SRC_ALPHA],srcAlpha:t0[s&&s.srcAlpha||I.SRC_ALPHA],dstRGB:t0[s&&s.dstRGB||I.ONE_MINUS_SRC_ALPHA],dstAlpha:t0[s&&s.dstAlpha||I.ONE_MINUS_SRC_ALPHA]},equation:{rgb:xE[l&&l.rgb||I.FUNC_ADD],alpha:xE[l&&l.alpha||I.FUNC_ADD]},color:d}}},{key:"getStencilDrawParams",value:function(t){var n=t.stencil,i=n||{},a=i.enable,s=i.mask,l=s===void 0?-1:s,f=i.func,d=f===void 0?{cmp:I.ALWAYS,ref:0,mask:-1}:f,y=i.opFront,b=y===void 0?{fail:I.KEEP,zfail:I.KEEP,zpass:I.KEEP}:y,T=i.opBack,M=T===void 0?{fail:I.KEEP,zfail:I.KEEP,zpass:I.KEEP}:T;return{enable:!!a,mask:l,func:(0,W.Z)((0,W.Z)({},d),{},{cmp:Y5[d.cmp]}),opFront:{fail:Ev[b.fail],zfail:Ev[b.zfail],zpass:Ev[b.zpass]},opBack:{fail:Ev[M.fail],zfail:Ev[M.zfail],zpass:Ev[M.zpass]}}}},{key:"getColorMaskDrawParams",value:function(t,n){var i=t.stencil,a=i!=null&&i.enable&&i.opFront&&!n?[!1,!1,!1,!1]:[!0,!0,!0,!0];return a}},{key:"initCullDrawParams",value:function(t,n){var i=t.cull;if(i){var a=i.enable,s=i.face,l=s===void 0?I.BACK:s;n.cull={enable:!!a,face:q5[l]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||Xk(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}Gk(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,f){Object.keys(l).forEach(function(d){s.extractUniformsRecursively(d,l[d],i,"".concat(a&&a+".").concat(t,"[").concat(f,"]"))})})}}]),e}(),Yk=function(){function e(r,t){(0,Q.Z)(this,e),(0,F.Z)(this,"isDestroy",!1);var n=t.data,i=t.type,a=i===void 0?I.UNSIGNED_BYTE:i,s=t.width,l=t.height,f=t.flipY,d=f===void 0?!1:f,y=t.format,b=y===void 0?I.RGBA:y,T=t.mipmap,M=T===void 0?!1:T,P=t.wrapS,k=P===void 0?I.CLAMP_TO_EDGE:P,H=t.wrapT,q=H===void 0?I.CLAMP_TO_EDGE:H,ae=t.aniso,Se=ae===void 0?0:ae,ze=t.alignment,it=ze===void 0?1:ze,ut=t.premultiplyAlpha,ot=ut===void 0?!1:ut,Ct=t.mag,Xt=Ct===void 0?I.NEAREST:Ct,Sr=t.min,_r=Sr===void 0?I.NEAREST:Sr,Wr=t.colorSpace,Cn=Wr===void 0?I.BROWSER_DEFAULT_WEBGL:Wr,wi=t.x,ua=wi===void 0?0:wi,co=t.y,Xo=co===void 0?0:co,No=t.copy,Ys=No===void 0?!1:No;this.width=s,this.height=l;var bl={width:s,height:l,type:E_[a],format:W5[b],wrapS:yE[k],wrapT:yE[q],mag:_E[Xt],min:_E[_r],alignment:it,flipY:d,colorSpace:X5[Cn],premultiplyAlpha:ot,aniso:Se,x:ua,y:Xo,copy:Ys};n&&(bl.data=n),typeof M=="number"?bl.mipmap=G5[M]:typeof M=="boolean"&&(bl.mipmap=M),this.texture=r.texture(bl)}return(0,j.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};this.texture(t)}},{key:"bind",value:function(){this.texture._texture.bind()}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.texture.resize(n,i),this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),JE,eS,qk=(JE=(0,tr.b2)(),JE(eS=function(){function e(){var r=this;(0,Q.Z)(this,e),(0,F.Z)(this,"uniformBuffers",[]),(0,F.Z)(this,"queryVerdorInfo",function(){return"WebGL1"}),(0,F.Z)(this,"createModel",function(t){return new $k(r.gl,t)}),(0,F.Z)(this,"createAttribute",function(t){return new j5(r.gl,t)}),(0,F.Z)(this,"createBuffer",function(t){return new K5(r.gl,t)}),(0,F.Z)(this,"createElements",function(t){return new Q5(r.gl,t)}),(0,F.Z)(this,"createTexture2D",function(t){return new Yk(r.gl,t)}),(0,F.Z)(this,"createFramebuffer",function(t){return new J5(r.gl,t)}),(0,F.Z)(this,"useFramebuffer",function(t,n){r.gl({framebuffer:t?t.get():null})(n)}),(0,F.Z)(this,"clear",function(t){var n,i=t.color,a=t.depth,s=t.stencil,l=t.framebuffer,f=l===void 0?null:l,d={color:i,depth:a,stencil:s};d.framebuffer=f===null?f:f.get(),(n=r.gl)===null||n===void 0||n.clear(d)}),(0,F.Z)(this,"viewport",function(t){var n=t.x,i=t.y,a=t.width,s=t.height;r.gl._gl.viewport(n,i,a,s),r.width=a,r.height=s,r.gl._refresh()}),(0,F.Z)(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,a=t.y,s=t.width,l=t.height,f={x:i,y:a,width:s,height:l};return n&&(f.framebuffer=n.get()),r.gl.read(f)}),(0,F.Z)(this,"getViewportSize",function(){return{width:r.gl._gl.drawingBufferWidth,height:r.gl._gl.drawingBufferHeight}}),(0,F.Z)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),(0,F.Z)(this,"getCanvas",function(){return r.canvas}),(0,F.Z)(this,"getGLContext",function(){return r.gl._gl}),(0,F.Z)(this,"destroy",function(){var t;r.canvas=null,(t=r.gl)===null||t===void 0||(t=t._gl)===null||t===void 0||(t=t.getExtension("WEBGL_lose_context"))===null||t===void 0||t.loseContext(),r.gl.destroy(),r.gl=null})}return(0,j.Z)(e,[{key:"init",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i,a,s){var l=this;return _e().wrap(function(d){for(;;)switch(d.prev=d.next){case 0:if(this.canvas=i,!s){d.next=5;break}this.gl=s,d.next=8;break;case 5:return d.next=7,new Promise(function(y,b){V5()({canvas:l.canvas,attributes:{alpha:!0,antialias:a.antialias,premultipliedAlpha:!0,preserveDrawingBuffer:a.preserveDrawingBuffer,stencil:a.stencil},extensions:["OES_element_index_uint","OES_standard_derivatives","ANGLE_instanced_arrays"],optionalExtensions:["oes_texture_float_linear","OES_texture_float","EXT_texture_filter_anisotropic","EXT_blend_minmax","WEBGL_depth_texture","WEBGL_lose_context"],profile:!0,onDone:function(M,P){(M||!P)&&b(M),y(P)}})});case 7:this.gl=d.sent;case 8:this.extensionObject={OES_texture_float:this.testExtension("OES_texture_float")};case 9:case"end":return d.stop()}},n,this)}));function t(n,i,a){return r.apply(this,arguments)}return t}()},{key:"getPointSizeRange",value:function(){return this.gl._gl.getParameter(this.gl._gl.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!0,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setBaseState",value:function(){this.gl({cull:{enable:!1,face:"back"},viewport:{x:0,y:0,height:this.width,width:this.height},blend:{enable:!1,equation:"add"},framebuffer:null}),this.gl._refresh()}},{key:"setCustomLayerDefaults",value:function(){var t=this.getGLContext();t.disable(t.CULL_FACE)}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}},{key:"beginFrame",value:function(){}},{key:"endFrame",value:function(){}}]),e}())||eS),Kk=function(){function e(r,t){(0,Q.Z)(this,e);var n=t.buffer,i=t.offset,a=t.stride,s=t.normalized,l=t.size,f=t.divisor,d=t.shaderLocation;this.buffer=n,this.attribute={shaderLocation:d,buffer:n.get(),offset:i||0,stride:a||0,normalized:s||!1,divisor:f||0},l&&(this.attribute.size=l)}return(0,j.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"updateBuffer",value:function(t){this.buffer.subData(t)}},{key:"destroy",value:function(){this.buffer.destroy()}}]),e}(),Up,Qh,Lv,$m,Ym,lh,g0,Pd,ku,ch,fh,_0=(Up={},(0,F.Z)(Up,I.FLOAT,Float32Array),(0,F.Z)(Up,I.UNSIGNED_BYTE,Uint8Array),(0,F.Z)(Up,I.SHORT,Int16Array),(0,F.Z)(Up,I.UNSIGNED_SHORT,Uint16Array),(0,F.Z)(Up,I.INT,Int32Array),(0,F.Z)(Up,I.UNSIGNED_INT,Uint32Array),Up),Qk=(Qh={},(0,F.Z)(Qh,I.POINTS,ws.POINTS),(0,F.Z)(Qh,I.LINES,ws.LINES),(0,F.Z)(Qh,I.LINE_LOOP,ws.LINES),(0,F.Z)(Qh,I.LINE_STRIP,ws.LINE_STRIP),(0,F.Z)(Qh,I.TRIANGLES,ws.TRIANGLES),(0,F.Z)(Qh,I.TRIANGLE_FAN,ws.TRIANGLES),(0,F.Z)(Qh,I.TRIANGLE_STRIP,ws.TRIANGLE_STRIP),Qh),Jk=(Lv={},(0,F.Z)(Lv,1,kt.F32_R),(0,F.Z)(Lv,2,kt.F32_RG),(0,F.Z)(Lv,3,kt.F32_RGB),(0,F.Z)(Lv,4,kt.F32_RGBA),Lv),eD=($m={},(0,F.Z)($m,I.STATIC_DRAW,bf.STATIC),(0,F.Z)($m,I.DYNAMIC_DRAW,bf.DYNAMIC),(0,F.Z)($m,I.STREAM_DRAW,bf.DYNAMIC),$m),tS=(Ym={},(0,F.Z)(Ym,I.REPEAT,yl.REPEAT),(0,F.Z)(Ym,I.CLAMP_TO_EDGE,yl.CLAMP_TO_EDGE),(0,F.Z)(Ym,I.MIRRORED_REPEAT,yl.MIRRORED_REPEAT),Ym),tD=(lh={},(0,F.Z)(lh,I.NEVER,Ni.NEVER),(0,F.Z)(lh,I.ALWAYS,Ni.ALWAYS),(0,F.Z)(lh,I.LESS,Ni.LESS),(0,F.Z)(lh,I.LEQUAL,Ni.LEQUAL),(0,F.Z)(lh,I.GREATER,Ni.GREATER),(0,F.Z)(lh,I.GEQUAL,Ni.GEQUAL),(0,F.Z)(lh,I.EQUAL,Ni.EQUAL),(0,F.Z)(lh,I.NOTEQUAL,Ni.NOTEQUAL),lh),rD=(g0={},(0,F.Z)(g0,I.FRONT,jl.FRONT),(0,F.Z)(g0,I.BACK,jl.BACK),g0),rS=(Pd={},(0,F.Z)(Pd,I.FUNC_ADD,iu.ADD),(0,F.Z)(Pd,I.MIN_EXT,iu.MIN),(0,F.Z)(Pd,I.MAX_EXT,iu.MAX),(0,F.Z)(Pd,I.FUNC_SUBTRACT,iu.SUBSTRACT),(0,F.Z)(Pd,I.FUNC_REVERSE_SUBTRACT,iu.REVERSE_SUBSTRACT),Pd),y0=(ku={},(0,F.Z)(ku,I.ZERO,Xi.ZERO),(0,F.Z)(ku,I.ONE,Xi.ONE),(0,F.Z)(ku,I.SRC_COLOR,Xi.SRC),(0,F.Z)(ku,I.ONE_MINUS_SRC_COLOR,Xi.ONE_MINUS_SRC),(0,F.Z)(ku,I.SRC_ALPHA,Xi.SRC_ALPHA),(0,F.Z)(ku,I.ONE_MINUS_SRC_ALPHA,Xi.ONE_MINUS_SRC_ALPHA),(0,F.Z)(ku,I.DST_COLOR,Xi.DST),(0,F.Z)(ku,I.ONE_MINUS_DST_COLOR,Xi.ONE_MINUS_DST),(0,F.Z)(ku,I.DST_ALPHA,Xi.DST_ALPHA),(0,F.Z)(ku,I.ONE_MINUS_DST_ALPHA,Xi.ONE_MINUS_DST_ALPHA),(0,F.Z)(ku,I.CONSTANT_COLOR,Xi.CONST),(0,F.Z)(ku,I.ONE_MINUS_CONSTANT_COLOR,Xi.ONE_MINUS_CONSTANT),(0,F.Z)(ku,I.CONSTANT_ALPHA,Xi.CONST),(0,F.Z)(ku,I.ONE_MINUS_CONSTANT_ALPHA,Xi.ONE_MINUS_CONSTANT),(0,F.Z)(ku,I.SRC_ALPHA_SATURATE,Xi.SRC_ALPHA_SATURATE),ku),Bv=(ch={},(0,F.Z)(ch,I.REPLACE,Ho.REPLACE),(0,F.Z)(ch,I.KEEP,Ho.KEEP),(0,F.Z)(ch,I.ZERO,Ho.ZERO),(0,F.Z)(ch,I.INVERT,Ho.INVERT),(0,F.Z)(ch,I.INCR,Ho.INCREMENT_CLAMP),(0,F.Z)(ch,I.DECR,Ho.DECREMENT_CLAMP),(0,F.Z)(ch,I.INCR_WRAP,Ho.INCREMENT_WRAP),(0,F.Z)(ch,I.DECR_WRAP,Ho.DECREMENT_WRAP),ch),nD=(fh={},(0,F.Z)(fh,I.ALWAYS,Ni.ALWAYS),(0,F.Z)(fh,I.EQUAL,Ni.EQUAL),(0,F.Z)(fh,I.GEQUAL,Ni.GEQUAL),(0,F.Z)(fh,I.GREATER,Ni.GREATER),(0,F.Z)(fh,I.LEQUAL,Ni.LEQUAL),(0,F.Z)(fh,I.LESS,Ni.LESS),(0,F.Z)(fh,I.NEVER,Ni.NEVER),(0,F.Z)(fh,I.NOTEQUAL,Ni.NOTEQUAL),fh),iD={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121};function x0(e){return Object.prototype.toString.call(e)in iD}var aD=function(){function e(r,t){(0,Q.Z)(this,e),(0,F.Z)(this,"isDestroyed",!1);var n=t.data,i=t.usage,a=t.type,s=t.isUBO,l=t.label,f;x0(n)?f=n:f=new _0[this.type||I.FLOAT](n),this.type=a,this.size=f.byteLength,this.buffer=r.createBuffer({viewOrSize:f,usage:s?ro.UNIFORM:ro.VERTEX,hint:eD[i||I.STATIC_DRAW]}),l&&r.setResourceName(this.buffer,l)}return(0,j.Z)(e,[{key:"get",value:function(){return this.buffer}},{key:"destroy",value:function(){this.isDestroyed||this.buffer.destroy(),this.isDestroyed=!0}},{key:"subData",value:function(t){var n=t.data,i=t.offset,a;x0(n)?a=n:a=new _0[this.type||I.FLOAT](n),this.buffer.setSubData(i,new Uint8Array(a.buffer))}}]),e}(),oD=function(){function e(r,t){(0,Q.Z)(this,e);var n=t.data,i=t.type,a=t.count,s=a===void 0?0:a,l;x0(n)?l=n:l=new _0[this.type||I.UNSIGNED_INT](n),this.type=i,this.count=s,this.indexBuffer=r.createBuffer({viewOrSize:l,usage:ro.INDEX})}return(0,j.Z)(e,[{key:"get",value:function(){return this.indexBuffer}},{key:"subData",value:function(t){var n=t.data,i;x0(n)?i=n:i=new _0[this.type||I.UNSIGNED_INT](n),this.indexBuffer.setSubData(0,new Uint8Array(i.buffer))}},{key:"destroy",value:function(){this.indexBuffer.destroy()}}]),e}();function nS(e){return!!(e&&e.texture)}var iS=function(){function e(r,t){(0,Q.Z)(this,e),(0,F.Z)(this,"isDestroy",!1);var n=t.data,i=t.type,a=i===void 0?I.UNSIGNED_BYTE:i,s=t.width,l=t.height,f=t.flipY,d=f===void 0?!1:f,y=t.format,b=y===void 0?I.RGBA:y,T=t.wrapS,M=T===void 0?I.CLAMP_TO_EDGE:T,P=t.wrapT,k=P===void 0?I.CLAMP_TO_EDGE:P,H=t.aniso,q=H===void 0?0:H,ae=t.alignment,Se=ae===void 0?1:ae,ze=t.usage,it=ze===void 0?ft.SAMPLED:ze,ut=t.mipmap,ot=ut===void 0?!1:ut,Ct=t.mag,Xt=Ct===void 0?I.NEAREST:Ct,Sr=t.min,_r=Sr===void 0?I.NEAREST:Sr;this.width=s,this.height=l;var Wr=kt.U8_RGBA_RT;if(a===I.UNSIGNED_BYTE&&b===I.RGBA)Wr=kt.U8_RGBA_RT;else if(a===I.UNSIGNED_BYTE&&b===I.LUMINANCE)Wr=kt.U8_LUMINANCE;else if(a===I.FLOAT&&b===I.RGB)Wr=kt.F32_RGB;else if(a===I.FLOAT&&b===I.RGBA)Wr=kt.F32_RGBA;else if(a===I.FLOAT&&b===I.RED)Wr=kt.F32_R;else throw new Error("create texture error, type: ".concat(a,", format: ").concat(b));this.texture=r.createTexture({format:Wr,width:s,height:l,usage:it===ft.SAMPLED?Ou.SAMPLED:Ou.RENDER_TARGET,pixelStore:{unpackFlipY:d,packAlignment:Se},mipLevelCount:it===ft.RENDER_TARGET||ot?1:0}),n&&this.texture.setImageData([n]),this.sampler=r.createSampler({addressModeU:tS[M],addressModeV:tS[k],minFilter:_r===I.NEAREST?es.POINT:es.BILINEAR,magFilter:Xt===I.NEAREST?es.POINT:es.BILINEAR,mipmapFilter:Xs.NO_MIP,maxAnisotropy:q})}return(0,j.Z)(e,[{key:"get",value:function(){return this.texture}},{key:"update",value:function(t){var n=t.data;this.texture.setImageData([n])}},{key:"bind",value:function(){}},{key:"resize",value:function(t){var n=t.width,i=t.height;this.width=n,this.height=i}},{key:"getSize",value:function(){return[this.width,this.height]}},{key:"destroy",value:function(){if(!this.isDestroy){var t;(t=this.texture)===null||t===void 0||t.destroy()}this.isDestroy=!0}}]),e}(),aS=function(){function e(r,t){(0,Q.Z)(this,e),this.device=r,this.options=t,this.createColorRenderTarget(),this.createDepthRenderTarget()}return(0,j.Z)(e,[{key:"createColorRenderTarget",value:function(){var t=this.options,n=t.width,i=t.height,a=t.color;a&&(nS(a)?(this.colorTexture=a.get(),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=a.width,this.height=a.height):n&&i&&(this.colorTexture=this.device.createTexture({format:kt.U8_RGBA_RT,usage:Ou.RENDER_TARGET,width:n,height:i}),this.colorRenderTarget=this.device.createRenderTargetFromTexture(this.colorTexture),this.width=n,this.height=i))}},{key:"createDepthRenderTarget",value:function(){var t=this.options,n=t.width,i=t.height,a=t.depth;a&&(nS(a)?(this.depthTexture=a.get(),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=a.width,this.height=a.height):n&&i&&(this.depthTexture=this.device.createTexture({format:kt.D24_S8,usage:Ou.RENDER_TARGET,width:n,height:i}),this.depthRenderTarget=this.device.createRenderTargetFromTexture(this.depthTexture),this.width=n,this.height=i))}},{key:"get",value:function(){return this.colorRenderTarget}},{key:"destroy",value:function(){var t,n;(t=this.colorRenderTarget)===null||t===void 0||t.destroy(),(n=this.depthRenderTarget)===null||n===void 0||n.destroy()}},{key:"resize",value:function(t){var n=t.width,i=t.height;(this.width!==n||this.height!==i)&&(this.destroy(),this.options.width=n,this.options.height=i,this.createColorRenderTarget(),this.createDepthRenderTarget())}}]),e}(),sD=ui.isPlainObject,uD=ui.isTypedArray,lD=function(){function e(r,t,n){var i=this;(0,Q.Z)(this,e),(0,F.Z)(this,"destroyed",!1),(0,F.Z)(this,"uniforms",{}),(0,F.Z)(this,"vertexBuffers",[]),this.device=r,this.options=t,this.service=n;var a=t.vs,s=t.fs,l=t.attributes,f=t.uniforms,d=t.count,y=t.elements;this.options=t;var b=r.createProgram({vertex:{glsl:a},fragment:{glsl:s}});this.program=b,f&&(this.uniforms=this.extractUniforms(f));var T=[],M=0;Object.keys(l).forEach(function(k){var H=l[k],q=H.get();i.vertexBuffers.push(q.get());var ae=H.attribute,Se=ae.offset,ze=Se===void 0?0:Se,it=ae.stride,ut=it===void 0?0:it,ot=ae.size,Ct=ot===void 0?1:ot,Xt=ae.divisor,Sr=Xt===void 0?0:Xt,_r=ae.shaderLocation,Wr=_r===void 0?0:_r;T.push({arrayStride:ut||Ct*4,stepMode:Rd.VERTEX,attributes:[{format:Jk[Ct],shaderLocation:Wr,offset:ze,divisor:Sr}]}),M=q.size/Ct}),d||(this.options.count=M),y&&(this.indexBuffer=y.get());var P=r.createInputLayout({vertexBufferDescriptors:T,indexBufferFormat:y?kt.U32_R:null,program:b});this.inputLayout=P,this.pipeline=this.createPipeline(t)}return(0,j.Z)(e,[{key:"createPipeline",value:function(t,n){var i=t.primitive,a=i===void 0?I.TRIANGLES:i,s=t.depth,l=t.cull,f=t.blend,d=t.stencil,y=this.initDepthDrawParams({depth:s}),b=!!(y&&y.enable),T=this.initCullDrawParams({cull:l}),M=!!(T&&T.enable),P=this.getBlendDrawParams({blend:f}),k=!!(P&&P.enable),H=this.getStencilDrawParams({stencil:d}),q=!!(H&&H.enable);return this.device.createRenderPipeline({inputLayout:this.inputLayout,program:this.program,topology:Qk[a],colorAttachmentFormats:[kt.U8_RGBA_RT],depthStencilAttachmentFormat:kt.D24_S8,megaStateDescriptor:{attachmentsState:[n?{channelWriteMask:au.ALL,rgbBlendState:{blendMode:iu.ADD,blendSrcFactor:Xi.ONE,blendDstFactor:Xi.ZERO},alphaBlendState:{blendMode:iu.ADD,blendSrcFactor:Xi.ONE,blendDstFactor:Xi.ZERO}}:{channelWriteMask:q&&H.opFront.zpass===Ho.REPLACE?au.NONE:au.ALL,rgbBlendState:{blendMode:k&&P.equation.rgb||iu.ADD,blendSrcFactor:k&&P.func.srcRGB||Xi.SRC_ALPHA,blendDstFactor:k&&P.func.dstRGB||Xi.ONE_MINUS_SRC_ALPHA},alphaBlendState:{blendMode:k&&P.equation.alpha||iu.ADD,blendSrcFactor:k&&P.func.srcAlpha||Xi.ONE,blendDstFactor:k&&P.func.dstAlpha||Xi.ONE}}],blendConstant:k?S_:void 0,depthWrite:b,depthCompare:b&&y.func||Ni.LESS,cullMode:M&&T.face||jl.NONE,stencilWrite:q,stencilFront:{compare:q?H.func.cmp:Ni.ALWAYS,passOp:H.opFront.zpass},stencilBack:{compare:q?H.func.cmp:Ni.ALWAYS,passOp:H.opBack.zpass}}})}},{key:"updateAttributesAndElements",value:function(){}},{key:"updateAttributes",value:function(){}},{key:"addUniforms",value:function(t){this.uniforms=(0,W.Z)((0,W.Z)({},this.uniforms),this.extractUniforms(t))}},{key:"draw",value:function(t,n){var i=this,a=(0,W.Z)((0,W.Z)({},this.options),t),s=a.count,l=s===void 0?0:s,f=a.instances,d=a.elements,y=a.uniforms,b=y===void 0?{}:y,T=a.uniformBuffers,M=a.textures;this.uniforms=(0,W.Z)((0,W.Z)({},this.uniforms),this.extractUniforms(b));var P=this.service,k=P.renderPass,H=P.currentFramebuffer,q=P.width,ae=P.height;if(this.pipeline=this.createPipeline(a,n),k.setViewport(0,0,(H==null?void 0:H.width)||q,(H==null?void 0:H.height)||ae),k.setPipeline(this.pipeline),k.setStencilReference(1),k.setVertexInput(this.inputLayout,this.vertexBuffers.map(function(ze){return{buffer:ze}}),d?{buffer:this.indexBuffer,offset:0}:null),T&&(this.bindings=this.device.createBindings({pipeline:this.pipeline,uniformBufferBindings:T.map(function(ze,it){var ut=ze;return{binding:it,buffer:ut.get(),size:ut.size}}),samplerBindings:M==null?void 0:M.map(function(ze){return{texture:ze.texture,sampler:ze.sampler}})})),this.bindings&&(k.setBindings(this.bindings),Object.keys(this.uniforms).forEach(function(ze){var it=i.uniforms[ze];it instanceof iS?i.uniforms[ze]=it.get():it instanceof aS&&(i.uniforms[ze]=it.get().texture)}),this.program.setUniformsLegacy(this.uniforms)),d){var Se=d.count;Se===0?k.draw(l,f):k.drawIndexed(Se,f)}else k.draw(l,f)}},{key:"destroy",value:function(){var t,n,i;this.program.destroy(),(t=this.vertexBuffers)===null||t===void 0||t.forEach(function(a){return a.destroy()}),(n=this.indexBuffer)===null||n===void 0||n.destroy(),(i=this.bindings)===null||i===void 0||i.destroy(),this.inputLayout.destroy(),this.pipeline.destroy(),this.destroyed=!0}},{key:"initDepthDrawParams",value:function(t){var n=t.depth;if(n)return{enable:n.enable===void 0?!0:!!n.enable,mask:n.mask===void 0?!0:!!n.mask,func:tD[n.func||I.LESS],range:n.range||[0,1]}}},{key:"getBlendDrawParams",value:function(t){var n=t.blend,i=n||{},a=i.enable,s=i.func,l=i.equation,f=i.color,d=f===void 0?[0,0,0,0]:f;return{enable:!!a,func:{srcRGB:y0[s&&s.srcRGB||I.SRC_ALPHA],srcAlpha:y0[s&&s.srcAlpha||I.SRC_ALPHA],dstRGB:y0[s&&s.dstRGB||I.ONE_MINUS_SRC_ALPHA],dstAlpha:y0[s&&s.dstAlpha||I.ONE_MINUS_SRC_ALPHA]},equation:{rgb:rS[l&&l.rgb||I.FUNC_ADD],alpha:rS[l&&l.alpha||I.FUNC_ADD]},color:d}}},{key:"getStencilDrawParams",value:function(t){var n=t.stencil,i=n||{},a=i.enable,s=i.mask,l=s===void 0?-1:s,f=i.func,d=f===void 0?{cmp:I.ALWAYS,ref:0,mask:-1}:f,y=i.opFront,b=y===void 0?{fail:I.KEEP,zfail:I.KEEP,zpass:I.KEEP}:y,T=i.opBack,M=T===void 0?{fail:I.KEEP,zfail:I.KEEP,zpass:I.KEEP}:T;return{enable:!!a,mask:l,func:(0,W.Z)((0,W.Z)({},d),{},{cmp:nD[d.cmp]}),opFront:{fail:Bv[b.fail],zfail:Bv[b.zfail],zpass:Bv[b.zpass]},opBack:{fail:Bv[M.fail],zfail:Bv[M.zfail],zpass:Bv[M.zpass]}}}},{key:"initCullDrawParams",value:function(t){var n=t.cull;if(n){var i=n.enable,a=n.face,s=a===void 0?I.BACK:a;return{enable:!!i,face:rD[s]}}}},{key:"extractUniforms",value:function(t){var n=this,i={};return Object.keys(t).forEach(function(a){n.extractUniformsRecursively(a,t[a],i,"")}),i}},{key:"extractUniformsRecursively",value:function(t,n,i,a){var s=this;if(n===null||typeof n=="number"||typeof n=="boolean"||Array.isArray(n)&&typeof n[0]=="number"||uD(n)||n===""||"resize"in n){i["".concat(a&&a+".").concat(t)]=n;return}sD(n)&&Object.keys(n).forEach(function(l){s.extractUniformsRecursively(l,n[l],i,"".concat(a&&a+".").concat(t))}),Array.isArray(n)&&n.forEach(function(l,f){Object.keys(l).forEach(function(d){s.extractUniformsRecursively(d,l[d],i,"".concat(a&&a+".").concat(t,"[").concat(f,"]"))})})}}]),e}();function cD(e){return typeof WebGL2RenderingContext!="undefined"&&e instanceof WebGL2RenderingContext?!0:!!(e&&e._version===2)}var oS,sS,fD=(oS=(0,tr.b2)(),oS(sS=function(){function e(){var r=this;(0,Q.Z)(this,e),(0,F.Z)(this,"uniformBuffers",[]),(0,F.Z)(this,"queryVerdorInfo",function(){return r.device.queryVendorInfo().platformString}),(0,F.Z)(this,"createModel",function(t){return new lD(r.device,t,r)}),(0,F.Z)(this,"createAttribute",function(t){return new Kk(r.device,t)}),(0,F.Z)(this,"createBuffer",function(t){return new aD(r.device,t)}),(0,F.Z)(this,"createElements",function(t){return new oD(r.device,t)}),(0,F.Z)(this,"createTexture2D",function(t){return new iS(r.device,t)}),(0,F.Z)(this,"createFramebuffer",function(t){return new aS(r.device,t)}),(0,F.Z)(this,"useFramebuffer",function(t,n){r.currentFramebuffer=t,r.beginFrame(),n(),r.endFrame(),r.currentFramebuffer=null}),(0,F.Z)(this,"clear",function(t){var n=t.color,i=t.depth,a=t.stencil,s=t.framebuffer,l=s===void 0?null:s;l&&(l.clearOptions={color:n,depth:i,stencil:a})}),(0,F.Z)(this,"viewport",function(t){var n=t.width,i=t.height;r.width=n,r.height=i}),(0,F.Z)(this,"readPixels",function(t){var n=t.framebuffer,i=t.x,a=t.y,s=t.width,l=t.height,f=r.device.createReadback(),d=n.colorTexture;return f.readTextureSync(d,i,a,s,l,new Uint8Array(s*l*4))}),(0,F.Z)(this,"getViewportSize",function(){return{width:r.width,height:r.height}}),(0,F.Z)(this,"getContainer",function(){var t;return(t=r.canvas)===null||t===void 0?void 0:t.parentElement}),(0,F.Z)(this,"getCanvas",function(){return r.canvas}),(0,F.Z)(this,"getGLContext",function(){return r.device.gl}),(0,F.Z)(this,"destroy",function(){var t;r.canvas=null,(t=r.uniformBuffers)===null||t===void 0||t.forEach(function(n){n.destroy()}),r.device.destroy()})}return(0,j.Z)(e,[{key:"init",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i,a){var s,l,f,d,y;return _e().wrap(function(T){for(;;)switch(T.prev=T.next){case 0:return s=a.enableWebGPU,l=a.shaderCompilerPath,this.canvas=i,f=s?new Wk({shaderCompilerPath:l}):new rk({targets:["webgl2","webgl1"],onContextLost:function(P){console.warn("context lost",P)},onContextCreationError:function(P){console.warn("context creation error",P)},onContextRestored:function(P){console.warn("context restored",P)}}),T.next=5,f.createSwapChain(i);case 5:d=T.sent,d.configureSwapChain(i.width,i.height),this.device=d.getDevice(),this.swapChain=d,this.currentFramebuffer=null,y=this.device.gl,this.extensionObject={OES_texture_float:!cD(y)&&this.device.OES_texture_float},this.mainColorRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:kt.U8_RGBA_RT,width:i.width,height:i.height,usage:Ou.RENDER_TARGET})),this.mainDepthRT=this.device.createRenderTargetFromTexture(this.device.createTexture({format:kt.D24_S8,width:i.width,height:i.height,usage:Ou.RENDER_TARGET}));case 14:case"end":return T.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"beginFrame",value:function(){var t=this.currentFramebuffer,n=this.swapChain,i=this.mainColorRT,a=this.mainDepthRT,s=n.getOnscreenTexture(),l=t?t.colorRenderTarget:i,f=t?null:s,d=t?t.depthRenderTarget:a,y=(t==null?void 0:t.clearOptions)||{},b=y.color,T=b===void 0?[0,0,0,0]:b,M=y.depth,P=M===void 0?1:M,k=y.stencil,H=k===void 0?0:k,q=l?Um(T[0]*255,T[1]*255,T[2]*255,T[3]):S_,ae=d?P:void 0,Se=d?H:void 0,ze=this.device.createRenderPass({colorAttachment:[l],colorResolveTo:[f],colorClearColor:[q],depthStencilAttachment:d,depthClearValue:ae,stencilClearValue:Se});this.renderPass=ze}},{key:"endFrame",value:function(){this.device.submitPass(this.renderPass)}},{key:"getPointSizeRange",value:function(){var t=this.device.gl;return t.getParameter(t.ALIASED_POINT_SIZE_RANGE)}},{key:"testExtension",value:function(t){return!!this.getGLContext().getExtension(t)}},{key:"setState",value:function(){}},{key:"setBaseState",value:function(){}},{key:"setCustomLayerDefaults",value:function(){}},{key:"setDirty",value:function(t){this.isDirty=t}},{key:"getDirty",value:function(){return this.isDirty}}]),e}())||sS);function hD(e){var r=pD();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function pD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}var k_=["selectstart","selecting","selectend"],dD=function(e){(0,Le.Z)(t,e);var r=hD(t);function t(n){var i,a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};return(0,Q.Z)(this,t),i=r.call(this),(0,F.Z)((0,Re.Z)(i),"isEnable",!1),(0,F.Z)((0,Re.Z)(i),"onDragStart",function(s){i.box.style.display="block",i.startEvent=i.endEvent=s,i.syncBoxBound(),i.emit("selectstart",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,F.Z)((0,Re.Z)(i),"onDragging",function(s){i.endEvent=s,i.syncBoxBound(),i.emit("selecting",i.getLngLatBox(),i.startEvent,i.endEvent)}),(0,F.Z)((0,Re.Z)(i),"onDragEnd",function(s){i.endEvent=s,i.box.style.display="none",i.emit("selectend",i.getLngLatBox(),i.startEvent,i.endEvent)}),i.scene=n,i.options=a,i}return(0,j.Z)(t,[{key:"container",get:function(){return this.scene.getMapService().getMarkerContainer()}},{key:"enable",value:function(){if(!this.isEnable){var i=this.options.className;if(this.scene.setMapStatus({dragEnable:!1}),this.container.style.cursor="crosshair",!this.box){var a=$i("div",void 0,this.container);a.classList.add("l7-select-box"),i&&a.classList.add(i),a.style.display="none",this.box=a}this.scene.on("dragstart",this.onDragStart),this.scene.on("dragging",this.onDragging),this.scene.on("dragend",this.onDragEnd),this.isEnable=!0}}},{key:"disable",value:function(){this.isEnable&&(this.scene.setMapStatus({dragEnable:!0}),this.container.style.cursor="auto",this.scene.off("dragstart",this.onDragStart),this.scene.off("dragging",this.onDragging),this.scene.off("dragend",this.onDragEnd),this.isEnable=!1)}},{key:"syncBoxBound",value:function(){var i=this.startEvent,a=i.x,s=i.y,l=this.endEvent,f=l.x,d=l.y,y=Math.min(a,f),b=Math.min(s,d),T=Math.abs(a-f),M=Math.abs(s-d);this.box.style.top="".concat(b,"px"),this.box.style.left="".concat(y,"px"),this.box.style.width="".concat(T,"px"),this.box.style.height="".concat(M,"px")}},{key:"getLngLatBox",value:function(){var i=this.startEvent.lngLat,a=i.lng,s=i.lat,l=this.endEvent.lngLat,f=l.lng,d=l.lat;return kf([[a,s],[f,d]])}}]),t}(qa.EventEmitter),vD=function(){function e(r){(0,Q.Z)(this,e);var t=r.id,n=r.map,i=r.canvas,a=r.renderer,s=a===void 0?"regl":a,l=wA();this.container=l,n.setContainer(l,t,i),l.bind(Je.IRendererService).to(s==="regl"?qk:fD).inSingletonScope(),this.sceneService=l.get(Je.ISceneService),this.mapService=l.get(Je.IMapService),this.iconService=l.get(Je.IIconService),this.fontService=l.get(Je.IFontService),this.controlService=l.get(Je.IControlService),this.layerService=l.get(Je.ILayerService),this.debugService=l.get(Je.IDebugService),this.debugService.setEnable(r.debug),this.markerService=l.get(Je.IMarkerService),this.interactionService=l.get(Je.IInteractionService),this.popupService=l.get(Je.IPopupService),this.boxSelect=new dD(this,{}),this.initComponent(t),this.sceneService.init(r),this.initControl()}return(0,j.Z)(e,[{key:"map",get:function(){return this.mapService.map}},{key:"loaded",get:function(){return this.sceneService.loaded}},{key:"getServiceContainer",value:function(){return this.container}},{key:"getSize",value:function(){return this.mapService.getSize()}},{key:"getMinZoom",value:function(){return this.mapService.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.mapService.getMaxZoom()}},{key:"getType",value:function(){return this.mapService.getType()}},{key:"getMapContainer",value:function(){return this.mapService.getMapContainer()}},{key:"getMapCanvasContainer",value:function(){return this.mapService.getMapCanvasContainer()}},{key:"getMapService",value:function(){return this.mapService}},{key:"getDebugService",value:function(){return this.debugService}},{key:"exportPng",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i){return _e().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"exportMap",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i){return _e().wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.abrupt("return",this.sceneService.exportPng(i));case 1:case"end":return s.stop()}},n,this)}));function t(n){return r.apply(this,arguments)}return t}()},{key:"registerRenderService",value:function(t){var n=this;if(this.sceneService.loaded){var i=new t(this);i.init()}else this.on("loaded",function(){var a=new t(n);a.init()})}},{key:"setBgColor",value:function(t){this.mapService.setBgColor(t)}},{key:"addLayer",value:function(t){var n=this,i=gm(this.container);if(t.setContainer(i,this.container),this.sceneService.addLayer(t),t.inited){var a=this.initMask(t);this.addMask(a,t.id)}else t.on("inited",function(){var s=n.initMask(t);n.addMask(s,t.id)})}},{key:"initMask",value:function(t){var n=t.getLayerConfig(),i=n.mask,a=n.maskfence,s=n.maskColor,l=s===void 0?"#000":s,f=n.maskOpacity,d=f===void 0?0:f;if(!(!i||!a)){var y=new nx().source(a).shape("fill").style({color:l,opacity:d});return y}}},{key:"addMask",value:function(t,n){if(t){var i=this.getLayer(n);if(i){var a=gm(this.container);t.setContainer(a,this.container),i.addMaskLayer(t),this.sceneService.addMask(t)}else console.warn("parent layer not find!")}}},{key:"getPickedLayer",value:function(){return this.layerService.pickedLayerId}},{key:"getLayers",value:function(){return this.layerService.getLayers()}},{key:"getLayer",value:function(t){return this.layerService.getLayer(t)}},{key:"getLayerByName",value:function(t){return this.layerService.getLayerByName(t)}},{key:"removeLayer",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i,a){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.layerService.remove(i,a);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"removeAllLayer",value:function(){var r=(0,Zt.Z)(_e().mark(function n(){return _e().wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,this.layerService.removeAllLayers();case 2:case"end":return a.stop()}},n,this)}));function t(){return r.apply(this,arguments)}return t}()},{key:"render",value:function(){this.sceneService.render()}},{key:"setEnableRender",value:function(t){this.layerService.setEnableRender(t)}},{key:"addIconFont",value:function(t,n){this.fontService.addIconFont(t,n)}},{key:"addIconFonts",value:function(t){var n=this;t.forEach(function(i){var a=(0,yn.Z)(i,2),s=a[0],l=a[1];n.fontService.addIconFont(s,l)})}},{key:"addFontFace",value:function(t,n){var i=this;this.fontService.once("fontloaded",function(a){i.emit("fontloaded",a)}),this.fontService.addFontFace(t,n)}},{key:"addImage",value:function(){var r=(0,Zt.Z)(_e().mark(function n(i,a){return _e().wrap(function(l){for(;;)switch(l.prev=l.next){case 0:return l.next=2,this.iconService.addImage(i,a);case 2:case"end":return l.stop()}},n,this)}));function t(n,i){return r.apply(this,arguments)}return t}()},{key:"hasImage",value:function(t){return this.iconService.hasImage(t)}},{key:"removeImage",value:function(t){this.iconService.removeImage(t)}},{key:"addIconFontGlyphs",value:function(t,n){this.fontService.addIconGlyphs(n)}},{key:"addControl",value:function(t){this.controlService.addControl(t,this.container)}},{key:"removeControl",value:function(t){this.controlService.removeControl(t)}},{key:"getControlByName",value:function(t){return this.controlService.getControlByName(t)}},{key:"addMarker",value:function(t){this.markerService.addMarker(t)}},{key:"addMarkerLayer",value:function(t){this.markerService.addMarkerLayer(t)}},{key:"removeMarkerLayer",value:function(t){this.markerService.removeMarkerLayer(t)}},{key:"removeAllMarkers",value:function(){this.markerService.removeAllMarkers()}},{key:"removeAllMakers",value:function(){console.warn("removeAllMakers \u5DF2\u5E9F\u5F03\uFF0C\u8BF7\u4F7F\u7528 removeAllMarkers"),this.markerService.removeAllMarkers()}},{key:"addPopup",value:function(t){this.popupService.addPopup(t)}},{key:"removePopup",value:function(t){this.popupService.removePopup(t)}},{key:"on",value:function(t,n){if(k_.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.on(t,n)}else Ag.includes(t)?this.sceneService.on(t,n):this.mapService.on(t,n)}},{key:"once",value:function(t,n){if(k_.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.once(t,n)}else Ag.includes(t)?this.sceneService.once(t,n):this.mapService.once(t,n)}},{key:"emit",value:function(t,n){Ag.indexOf(t)===-1?this.mapService.on(t,n):this.sceneService.emit(t,n)}},{key:"off",value:function(t,n){if(k_.includes(t)){var i;(i=this.boxSelect)===null||i===void 0||i.off(t,n)}else Ag.includes(t)?this.sceneService.off(t,n):this.mapService.off(t,n)}},{key:"getZoom",value:function(){return this.mapService.getZoom()}},{key:"getCenter",value:function(t){return this.mapService.getCenter(t)}},{key:"setCenter",value:function(t,n){return this.mapService.setCenter(t,n)}},{key:"getPitch",value:function(){return this.mapService.getPitch()}},{key:"setPitch",value:function(t){return this.mapService.setPitch(t)}},{key:"getRotation",value:function(){return this.mapService.getRotation()}},{key:"getBounds",value:function(){return this.mapService.getBounds()}},{key:"setRotation",value:function(t){this.mapService.setRotation(t)}},{key:"zoomIn",value:function(){this.mapService.zoomIn()}},{key:"zoomOut",value:function(){this.mapService.zoomOut()}},{key:"panTo",value:function(t){this.mapService.panTo(t)}},{key:"panBy",value:function(t,n){this.mapService.panBy(t,n)}},{key:"getContainer",value:function(){return this.mapService.getContainer()}},{key:"setZoom",value:function(t){this.mapService.setZoom(t)}},{key:"fitBounds",value:function(t,n){var i=this.sceneService.getSceneConfig(),a=i.fitBoundsOptions,s=i.animate;this.mapService.fitBounds(t,n||(0,W.Z)((0,W.Z)({},a),{},{animate:s}))}},{key:"setZoomAndCenter",value:function(t,n){this.mapService.setZoomAndCenter(t,n)}},{key:"setMapStyle",value:function(t){this.mapService.setMapStyle(t)}},{key:"setMapStatus",value:function(t){this.mapService.setMapStatus(t)}},{key:"pixelToLngLat",value:function(t){return this.mapService.pixelToLngLat(t)}},{key:"lngLatToPixel",value:function(t){return this.mapService.lngLatToPixel(t)}},{key:"containerToLngLat",value:function(t){return this.mapService.containerToLngLat(t)}},{key:"lngLatToContainer",value:function(t){return this.mapService.lngLatToContainer(t)}},{key:"destroy",value:function(){this.sceneService.destroy()}},{key:"registerPostProcessingPass",value:function(t,n){this.container.bind(Je.IPostProcessingPass).to(t).whenTargetNamed(n)}},{key:"enableShaderPick",value:function(){this.layerService.enableShaderPick()}},{key:"diasbleShaderPick",value:function(){this.layerService.disableShaderPick()}},{key:"enableBoxSelect",value:function(){var t=this,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:!0;this.boxSelect.enable(),n&&this.boxSelect.once("selectend",function(){t.disableBoxSelect()})}},{key:"disableBoxSelect",value:function(){this.boxSelect.disable()}},{key:"getProtocol",value:function(t){return Xr.REGISTERED_PROTOCOLS[t]}},{key:"startAnimate",value:function(){this.layerService.startAnimate()}},{key:"stopAnimate",value:function(){this.layerService.stopAnimate()}},{key:"getPointSizeRange",value:function(){return this.sceneService.getPointSizeRange()}},{key:"initComponent",value:function(t){this.controlService.init({container:Bs(t)},this.container),this.markerService.init(this.container),this.popupService.init(this.container)}},{key:"initControl",value:function(){var t=this.sceneService.getSceneConfig(),n=t.logoVisible,i=t.logoPosition;n&&this.addControl(new r1({position:i}))}}],[{key:"addProtocol",value:function(t,n){Xr.REGISTERED_PROTOCOLS[t]=n}},{key:"removeProtocol",value:function(t){delete Xr.REGISTERED_PROTOCOLS[t]}}]),e}(),DN="2.20.13";function qm(e){"@babel/helpers - typeof";return qm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},qm(e)}function uS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function LN(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?uS(Object(t),!0).forEach(function(n){mD(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):uS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function mD(e,r,t){return r=gD(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function gD(e){var r=_D(e,"string");return qm(r)==="symbol"?r:String(r)}function _D(e,r){if(qm(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(qm(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function BN(e,r){return ED(e)||bD(e,r)||xD(e,r)||yD()}function yD(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function xD(e,r){if(e){if(typeof e=="string")return lS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return lS(e,r)}}function lS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function bD(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){d=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function ED(e){if(Array.isArray(e))return e}var FN=null,NN=null,cS,D_,fS,SD=(cS=D0(Je.IGlobalConfigService),D_=function(){function e(r){(0,Q.Z)(this,e),ki(this,"configService",fS,this),this.config=r}return(0,j.Z)(e,[{key:"setContainer",value:function(t,n,i){t.bind(Je.MapConfig).toConstantValue((0,W.Z)((0,W.Z)({},this.config),{},{id:n,canvas:i})),t.bind(Je.IMapService).to(this.getServiceConstructor()).inSingletonScope()}},{key:"getServiceConstructor",value:function(){throw new Error("Method not implemented.")}}]),e}(),fS=Pi(D_.prototype,"configService",[cS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),D_),AD=U(86463),Km=U.n(AD),TD=function(){function e(r){(0,Q.Z)(this,e),(0,F.Z)(this,"size",1e4),this.size=r||1e4}return(0,j.Z)(e,[{key:"setSize",value:function(t){this.size=t}},{key:"getSize",value:function(){return[this.size,this.size]}},{key:"mercatorXfromLng",value:function(t){return(180+t)/360*this.size}},{key:"mercatorYfromLat",value:function(t){return(1-(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+t*Math.PI/360)))/360)*this.size}},{key:"lngFromMercatorX",value:function(t){return t/this.size*360-180}},{key:"latFromMercatorY",value:function(t){var n=180-(1-t/this.size)*360;return 360/Math.PI*Math.atan(Math.exp(n*Math.PI/180))-90}},{key:"project",value:function(t){var n=this.mercatorXfromLng(t[0]),i=this.mercatorYfromLat(t[1]);return[n,i]}},{key:"unproject",value:function(t){var n=this.lngFromMercatorX(t[0]),i=this.latFromMercatorY(t[1]);return[n,i]}}]),e}(),wD={light:"mapbox://styles/zcxduo/ck2ypyb1r3q9o1co1766dex29",dark:"mapbox://styles/zcxduo/ck241p6413s0b1cpayzldv7x7",normal:"mapbox://styles/mapbox/streets-v11",blank:{version:8,sources:{},layers:[{id:"background",type:"background",layout:{visibility:"none"}}]}},hS,pS,dS,vS,mS,gS,Fv,_S,yS,xS,bS,ES={mapmove:"move",camerachange:"move",zoomchange:"zoom",dragging:"drag"},CD=12,RD=(hS=(0,tr.b2)(),pS=(0,tr.f3)(Je.MapConfig),dS=(0,tr.f3)(Je.IGlobalConfigService),vS=(0,tr.f3)(Je.ICoordinateSystemService),mS=(0,tr.f3)(Je.IEventEmitter),hS(gS=(Fv=function(){function e(){var r=this;(0,Q.Z)(this,e),(0,F.Z)(this,"version","DEFAUlTMAP"),(0,F.Z)(this,"simpleMapCoord",new TD),(0,F.Z)(this,"bgColor","rgba(0.0, 0.0, 0.0, 0.0)"),ki(this,"config",_S,this),ki(this,"configService",yS,this),ki(this,"coordinateSystemService",xS,this),ki(this,"eventEmitter",bS,this),(0,F.Z)(this,"handleCameraChanged",function(t){var n=r.map.getCenter(),i=n.lat,a=n.lng;r.emit("mapchange"),r.viewport.syncWithMapCamera({bearing:r.map.getBearing(),center:[a,i],viewportHeight:r.map.transform.height,pitch:r.map.getPitch(),viewportWidth:r.map.transform.width,zoom:r.map.getZoom(),cameraHeight:0}),r.updateCoordinateSystemService(),r.cameraChangedCallback(r.viewport)})}return(0,j.Z)(e,[{key:"setBgColor",value:function(t){this.bgColor=t}},{key:"addMarkerContainer",value:function(){var t=this.map.getCanvasContainer();this.markerContainer=$i("div","l7-marker-container",t),this.markerContainer.setAttribute("tabindex","-1")}},{key:"getMarkerContainer",value:function(){return this.markerContainer}},{key:"getOverlayContainer",value:function(){}},{key:"on",value:function(t,n){NA.indexOf(t)!==-1?this.eventEmitter.on(t,n):this.map.on(ES[t]||t,n)}},{key:"off",value:function(t,n){this.map.off(ES[t]||t,n),this.eventEmitter.off(t,n)}},{key:"getContainer",value:function(){return this.map.getContainer()}},{key:"getMapCanvasContainer",value:function(){return this.map.getCanvasContainer()}},{key:"getSize",value:function(){if(this.version==="SIMPLE")return this.simpleMapCoord.getSize();var t=this.map.transform;return[t.width,t.height]}},{key:"getType",value:function(){return"default"}},{key:"getZoom",value:function(){return this.map.getZoom()}},{key:"setZoom",value:function(t){return this.map.setZoom(t)}},{key:"getCenter",value:function(){return this.map.getCenter()}},{key:"setCenter",value:function(t){this.map.setCenter(t)}},{key:"getPitch",value:function(){return this.map.getPitch()}},{key:"getRotation",value:function(){return this.map.getBearing()}},{key:"getBounds",value:function(){return this.map.getBounds().toArray()}},{key:"getMinZoom",value:function(){return this.map.getMinZoom()}},{key:"getMaxZoom",value:function(){return this.map.getMaxZoom()}},{key:"setRotation",value:function(t){this.map.setBearing(t)}},{key:"zoomIn",value:function(t,n){this.map.zoomIn(t,n)}},{key:"zoomOut",value:function(t,n){this.map.zoomOut(t,n)}},{key:"setPitch",value:function(t){return this.map.setPitch(t)}},{key:"panTo",value:function(t){this.map.panTo(t)}},{key:"panBy",value:function(){var t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0,n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:0;this.map.panBy([t,n])}},{key:"fitBounds",value:function(t,n){this.map.fitBounds(t,n)}},{key:"setMaxZoom",value:function(t){this.map.setMaxZoom(t)}},{key:"setMinZoom",value:function(t){this.map.setMinZoom(t)}},{key:"setMapStatus",value:function(t){t.doubleClickZoom===!0&&this.map.doubleClickZoom.enable(),t.doubleClickZoom===!1&&this.map.doubleClickZoom.disable(),t.dragEnable===!1&&this.map.dragPan.disable(),t.dragEnable===!0&&this.map.dragPan.enable(),t.rotateEnable===!1&&this.map.dragRotate.disable(),t.dragEnable===!0&&this.map.dragRotate.enable(),t.keyboardEnable===!1&&this.map.keyboard.disable(),t.keyboardEnable===!0&&this.map.keyboard.enable(),t.zoomEnable===!1&&this.map.scrollZoom.disable(),t.zoomEnable===!0&&this.map.scrollZoom.enable()}},{key:"setZoomAndCenter",value:function(t,n){this.map.flyTo({zoom:t,center:n})}},{key:"setMapStyle",value:function(t){this.map.setStyle(this.getMapStyleValue(t))}},{key:"meterToCoord",value:function(t,n){return 1}},{key:"pixelToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToPixel",value:function(t){return this.map.project(t)}},{key:"containerToLngLat",value:function(t){return this.map.unproject(t)}},{key:"lngLatToContainer",value:function(t){return this.map.project(t)}},{key:"getMapStyle",value:function(){try{var t,n=(t=this.map.getStyle().sprite)!==null&&t!==void 0?t:"";return/^mapbox:\/\/sprites\/zcxduo\/\w+\/\w+$/.test(n)?n==null?void 0:n.replace(/\/\w+$/,"").replace(/sprites/,"styles"):n}catch(i){return""}}},{key:"getMapStyleConfig",value:function(){return wD}},{key:"getMapStyleValue",value:function(t){var n;return(n=this.getMapStyleConfig()[t])!==null&&n!==void 0?n:t}},{key:"destroy",value:function(){this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];(n=this.eventEmitter).emit.apply(n,[t].concat(a))}},{key:"once",value:function(t){for(var n,i=arguments.length,a=new Array(i>1?i-1:0),s=1;s<i;s++)a[s-1]=arguments[s];(n=this.eventEmitter).once.apply(n,[t].concat(a))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"exportMap",value:function(t){var n=this.map.getCanvas(),i=t==="jpg"?n==null?void 0:n.toDataURL("image/jpeg"):n==null?void 0:n.toDataURL("image/png");return i}},{key:"onCameraChanged",value:function(t){this.cameraChangedCallback=t}},{key:"creatMapContainer",value:function(t){var n=t;return typeof t=="string"&&(n=document.getElementById(t)),n}},{key:"updateView",value:function(t){this.emit("mapchange"),this.viewport.syncWithMapCamera({bearing:t.bearing,center:t.center,viewportHeight:t.viewportHeight,pitch:t.pitch,viewportWidth:t.viewportWidth,zoom:t.zoom,cameraHeight:0}),this.updateCoordinateSystemService(),this.cameraChangedCallback(this.viewport)}},{key:"updateCoordinateSystemService",value:function(){var t=this.config.offsetCoordinate,n=t===void 0?!0:t;this.viewport.getZoom()>CD&&n?this.coordinateSystemService.setCoordinateSystem(eo.LNGLAT_OFFSET):this.coordinateSystemService.setCoordinateSystem(eo.LNGLAT)}}]),e}(),_S=Pi(Fv.prototype,"config",[pS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),yS=Pi(Fv.prototype,"configService",[dS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),xS=Pi(Fv.prototype,"coordinateSystemService",[vS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),bS=Pi(Fv.prototype,"eventEmitter",[mS],{configurable:!0,enumerable:!0,writable:!0,initializer:null}),Fv))||gS);function Qm(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}function b0(e,r){var t=Bh.fF([],r,e);return Bh.bA(t,t,1/t[3]),t}function UN(e,r){var t=e%r;return t<0?r+t:t}function zN(e,r,t){return t*r+(1-t)*e}function Od(e,r){if(!e)throw new Error(r||"viewport-mercator-project: assertion failed.")}var Sf=Math.PI,SS=Sf/4,Jh=Sf/180,AS=180/Sf,L_=512,B_=4003e4,MD=1.5;function TS(e){return Math.pow(2,e)}function ID(e){return Math.log2(e)}function E0(e,r){var t=(0,yn.Z)(e,2),n=t[0],i=t[1];Od(Number.isFinite(n)&&Number.isFinite(r)),Od(Number.isFinite(i)&&i>=-90&&i<=90,"invalid latitude"),r*=L_;var a=n*Jh,s=i*Jh,l=r*(a+Sf)/(2*Sf),f=r*(Sf-Math.log(Math.tan(SS+s*.5)))/(2*Sf);return[l,f]}function F_(e,r){var t=(0,yn.Z)(e,2),n=t[0],i=t[1];r*=L_;var a=n/r*(2*Sf)-Sf,s=2*(Math.atan(Math.exp(Sf-i/r*(2*Sf)))-SS);return[a*AS,s*AS]}function ZN(e){var r=e.latitude;assert(Number.isFinite(r));var t=Math.cos(r*Jh);return ID(B_*t)-9}function wS(e){var r=e.latitude,t=e.longitude,n=e.zoom,i=e.scale,a=e.highPrecision,s=a===void 0?!1:a;i=i!==void 0?i:TS(n),Od(Number.isFinite(r)&&Number.isFinite(t)&&Number.isFinite(i));var l={},f=L_*i,d=Math.cos(r*Jh),y=f/360,b=y/d,T=f/B_/d;if(l.pixelsPerMeter=[T,-T,T],l.metersPerPixel=[1/T,-1/T,1/T],l.pixelsPerDegree=[y,-b,T],l.degreesPerPixel=[1/y,-1/b,1/T],s){var M=Jh*Math.tan(r*Jh)/d,P=y*M/2,k=f/B_*M,H=k/b*T;l.pixelsPerDegree2=[0,-P,k],l.pixelsPerMeter2=[H,0,H]}return l}function VN(e,r){var t=_slicedToArray(e,3),n=t[0],i=t[1],a=t[2],s=_slicedToArray(r,3),l=s[0],f=s[1],d=s[2],y=1,b=wS({longitude:n,latitude:i,scale:y,highPrecision:!0}),T=b.pixelsPerMeter,M=b.pixelsPerMeter2,P=E0(e,y);P[0]+=l*(T[0]+M[0]*f),P[1]+=f*(T[1]+M[1]*f);var k=F_(P,y),H=(a||0)+(d||0);return Number.isFinite(a)||Number.isFinite(d)?[k[0],k[1],H]:k}function PD(e){var r=e.height,t=e.pitch,n=e.bearing,i=e.altitude,a=e.center,s=a===void 0?null:a,l=e.flipY,f=l===void 0?!1:l,d=Qm();return It.translate(d,d,[0,0,-i]),It.scale(d,d,[1,1,1/r]),It.rotateX(d,d,-t*Jh),It.rotateZ(d,d,n*Jh),f&&It.scale(d,d,[1,-1,1]),s&&It.translate(d,d,La.negate([],s)),d}function OD(e){var r=e.width,t=e.height,n=e.altitude,i=n===void 0?MD:n,a=e.pitch,s=a===void 0?0:a,l=e.nearZMultiplier,f=l===void 0?1:l,d=e.farZMultiplier,y=d===void 0?1:d,b=s*Jh,T=Math.atan(.5/i),M=Math.sin(T)*i/Math.sin(Math.PI/2-b-T),P=Math.cos(Math.PI/2-b)*M+i;return{fov:2*Math.atan(t/2/i),aspect:r/t,focalDistance:i,near:f,far:P*y}}function kD(e){var r=e.width,t=e.height,n=e.pitch,i=e.altitude,a=e.nearZMultiplier,s=e.farZMultiplier,l=OD({width:r,height:t,altitude:i,pitch:n,nearZMultiplier:a,farZMultiplier:s}),f=l.fov,d=l.aspect,y=l.near,b=l.far,T=It.perspective([],f,d,y,b);return T}function DD(e,r){var t=(0,yn.Z)(e,3),n=t[0],i=t[1],a=t[2],s=a===void 0?0:a;return Od(Number.isFinite(n)&&Number.isFinite(i)&&Number.isFinite(s)),b0(r,[n,i,s,1])}function CS(e,r){var t=arguments.length>2&&arguments[2]!==void 0?arguments[2]:0,n=(0,yn.Z)(e,3),i=n[0],a=n[1],s=n[2];if(Od(Number.isFinite(i)&&Number.isFinite(a),"invalid pixel coordinate"),Number.isFinite(s)){var l=b0(r,[i,a,s,1]);return l}var f=b0(r,[i,a,0,1]),d=b0(r,[i,a,1,1]),y=f[2],b=d[2],T=y===b?0:((t||0)-y)/(b-y);return kr.t7([],f,d,T)}var RS=Qm(),LD=function(){function e(){var r=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=r.width,n=r.height,i=r.viewMatrix,a=i===void 0?RS:i,s=r.projectionMatrix,l=s===void 0?RS:s;(0,Q.Z)(this,e),this.width=t||1,this.height=n||1,this.scale=1,this.pixelsPerMeter=1,this.viewMatrix=a,this.projectionMatrix=l;var f=Qm();It.multiply(f,f,this.projectionMatrix),It.multiply(f,f,this.viewMatrix),this.viewProjectionMatrix=f;var d=Qm();It.scale(d,d,[this.width/2,-this.height/2,1]),It.translate(d,d,[1,-1,0]),It.multiply(d,d,this.viewProjectionMatrix);var y=It.invert(Qm(),d);if(!y)throw new Error("Pixel project matrix not invertible");this.pixelProjectionMatrix=d,this.pixelUnprojectionMatrix=y,this.equals=this.equals.bind(this),this.project=this.project.bind(this),this.unproject=this.unproject.bind(this),this.projectPosition=this.projectPosition.bind(this),this.unprojectPosition=this.unprojectPosition.bind(this),this.projectFlat=this.projectFlat.bind(this),this.unprojectFlat=this.unprojectFlat.bind(this)}return(0,j.Z)(e,[{key:"equals",value:function(t){return t instanceof e?t.width===this.width&&t.height===this.height&&It.equals(t.projectionMatrix,this.projectionMatrix)&&It.equals(t.viewMatrix,this.viewMatrix):!1}},{key:"project",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,s=this.projectPosition(t),l=DD(s,this.pixelProjectionMatrix),f=(0,yn.Z)(l,2),d=f[0],y=f[1],b=a?y:this.height-y;return t.length===2?[d,b]:[d,b,l[2]]}},{key:"unproject",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},i=n.topLeft,a=i===void 0?!0:i,s=n.targetZ,l=(0,yn.Z)(t,3),f=l[0],d=l[1],y=l[2],b=a?d:this.height-d,T=s&&s*this.pixelsPerMeter,M=CS([f,b,y],this.pixelUnprojectionMatrix,T),P=this.unprojectPosition(M),k=(0,yn.Z)(P,3),H=k[0],q=k[1],ae=k[2];return Number.isFinite(y)?[H,q,ae]:Number.isFinite(s)?[H,q,s]:[H,q]}},{key:"projectPosition",value:function(t){var n=this.projectFlat(t),i=(0,yn.Z)(n,2),a=i[0],s=i[1],l=(t[2]||0)*this.pixelsPerMeter;return[a,s,l]}},{key:"unprojectPosition",value:function(t){var n=this.unprojectFlat(t),i=(0,yn.Z)(n,2),a=i[0],s=i[1],l=(t[2]||0)/this.pixelsPerMeter;return[a,s,l]}},{key:"projectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}},{key:"unprojectFlat",value:function(t){var n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return t}}]),e}();function BD(e){var r=e.width,t=e.height,n=e.bounds,i=e.minExtent,a=i===void 0?0:i,s=e.maxZoom,l=s===void 0?24:s,f=e.padding,d=f===void 0?0:f,y=e.offset,b=y===void 0?[0,0]:y,T=(0,yn.Z)(n,2),M=(0,yn.Z)(T[0],2),P=M[0],k=M[1],H=(0,yn.Z)(T[1],2),q=H[0],ae=H[1];if(Number.isFinite(d)){var Se=d;d={top:Se,bottom:Se,left:Se,right:Se}}else Od(Number.isFinite(d.top)&&Number.isFinite(d.bottom)&&Number.isFinite(d.left)&&Number.isFinite(d.right));var ze=new MS({width:r,height:t,longitude:0,latitude:0,zoom:0}),it=ze.project([P,ae]),ut=ze.project([q,k]),ot=[Math.max(Math.abs(ut[0]-it[0]),a),Math.max(Math.abs(ut[1]-it[1]),a)],Ct=[r-d.left-d.right-Math.abs(b[0])*2,t-d.top-d.bottom-Math.abs(b[1])*2];Od(Ct[0]>0&&Ct[1]>0);var Xt=Ct[0]/ot[0],Sr=Ct[1]/ot[1],_r=(d.right-d.left)/2/Xt,Wr=(d.bottom-d.top)/2/Sr,Cn=[(ut[0]+it[0])/2+_r,(ut[1]+it[1])/2+Wr],wi=ze.unproject(Cn),ua=ze.zoom+Math.log2(Math.abs(Math.min(Xt,Sr)));return{longitude:wi[0],latitude:wi[1],zoom:Math.min(ua,l)}}var MS=function(e){(0,Le.Z)(r,e);function r(){var t,n=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},i=n.width,a=n.height,s=n.latitude,l=s===void 0?0:s,f=n.longitude,d=f===void 0?0:f,y=n.zoom,b=y===void 0?0:y,T=n.pitch,M=T===void 0?0:T,P=n.bearing,k=P===void 0?0:P,H=n.altitude,q=H===void 0?1.5:H,ae=n.nearZMultiplier,Se=n.farZMultiplier;(0,Q.Z)(this,r),i=i||1,a=a||1;var ze=TS(b);q=Math.max(.75,q);var it=E0([d,l],ze);it[2]=0;var ut=kD({width:i,height:a,pitch:M,bearing:k,altitude:q,nearZMultiplier:ae||1/a,farZMultiplier:Se||1.01}),ot=PD({height:a,center:it,pitch:M,bearing:k,altitude:q,flipY:!0});return t=(0,rt.Z)(this,(0,Ee.Z)(r).call(this,{width:i,height:a,viewMatrix:ot,projectionMatrix:ut})),t.latitude=l,t.longitude=d,t.zoom=b,t.pitch=M,t.bearing=k,t.altitude=q,t.scale=ze,t.center=it,t.pixelsPerMeter=wS((0,Re.Z)((0,Re.Z)(t))).pixelsPerMeter[2],Object.freeze((0,Re.Z)((0,Re.Z)(t))),t}return(0,j.Z)(r,[{key:"projectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return E0(n,i)}},{key:"unprojectFlat",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:this.scale;return F_(n,i)}},{key:"getMapCenterByLngLatPosition",value:function(n){var i=n.lngLat,a=n.pos,s=CS(a,this.pixelUnprojectionMatrix),l=E0(i,this.scale),f=kr.IH([],l,kr.tk([],s)),d=kr.IH([],this.center,f);return F_(d,this.scale)}},{key:"getLocationAtPoint",value:function(n){var i=n.lngLat,a=n.pos;return this.getMapCenterByLngLatPosition({lngLat:i,pos:a})}},{key:"fitBounds",value:function(n){var i=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{},a=this.width,s=this.height,l=BD(Object.assign({width:a,height:s,bounds:n},i)),f=l.longitude,d=l.latitude,y=l.zoom;return new r({width:a,height:s,longitude:f,latitude:d,zoom:y})}}]),r}(LD),FD=function(){function e(){(0,Q.Z)(this,e)}return(0,j.Z)(e,[{key:"syncWithMapCamera",value:function(t){var n=t.center,i=t.zoom,a=t.pitch,s=t.bearing,l=t.viewportHeight,f=t.viewportWidth;this.viewport=new MS({width:f,height:l,longitude:n&&n[0],latitude:n&&n[1],zoom:i,pitch:a,bearing:s})}},{key:"getZoom",value:function(){return this.viewport.zoom}},{key:"getZoomScale",value:function(){return Math.pow(2,this.getZoom())}},{key:"getCenter",value:function(){return[this.viewport.longitude,this.viewport.latitude]}},{key:"getProjectionMatrix",value:function(){return this.viewport.projectionMatrix}},{key:"getModelMatrix",value:function(){return[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]}},{key:"getViewMatrix",value:function(){return this.viewport.viewMatrix}},{key:"getViewMatrixUncentered",value:function(){return this.viewport.viewMatrixUncentered}},{key:"getViewProjectionMatrix",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getViewProjectionMatrixUncentered",value:function(){return this.viewport.viewProjectionMatrix}},{key:"getFocalDistance",value:function(){return 1}},{key:"projectFlat",value:function(t,n){return this.viewport.projectFlat(t,n)}}]),e}(),ND=["id","attributionControl","style","token","rotation","mapInstance"],IS,PS;function UD(e){var r=zD();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function zD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function ZD(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}ZD(`.mapboxgl-map{font:12px/20px Helvetica Neue,Arial,Helvetica,sans-serif;overflow:hidden;position:relative;-webkit-tap-highlight-color:rgba(0,0,0,0)}.mapboxgl-canvas{position:absolute;left:0;top:0}.mapboxgl-map:-webkit-full-screen{width:100%;height:100%}.mapboxgl-canary{background-color:salmon}.mapboxgl-canvas-container.mapboxgl-interactive,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass{cursor:-webkit-grab;cursor:grab;-moz-user-select:none;-webkit-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-canvas-container.mapboxgl-interactive.mapboxgl-track-pointer{cursor:pointer}.mapboxgl-canvas-container.mapboxgl-interactive:active,.mapboxgl-ctrl-group button.mapboxgl-ctrl-compass:active{cursor:-webkit-grabbing;cursor:grabbing}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate .mapboxgl-canvas{-ms-touch-action:pan-x pan-y;touch-action:pan-x pan-y}.mapboxgl-canvas-container.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:pinch-zoom;touch-action:pinch-zoom}.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan,.mapboxgl-canvas-container.mapboxgl-touch-zoom-rotate.mapboxgl-touch-drag-pan .mapboxgl-canvas{-ms-touch-action:none;touch-action:none}.mapboxgl-ctrl-bottom-left,.mapboxgl-ctrl-bottom-right,.mapboxgl-ctrl-top-left,.mapboxgl-ctrl-top-right{position:absolute;pointer-events:none;z-index:2}.mapboxgl-ctrl-top-left{top:0;left:0}.mapboxgl-ctrl-top-right{top:0;right:0}.mapboxgl-ctrl-bottom-left{bottom:0;left:0}.mapboxgl-ctrl-bottom-right{right:0;bottom:0}.mapboxgl-ctrl{clear:both;pointer-events:auto;-webkit-transform:translate(0);transform:translate(0)}.mapboxgl-ctrl-top-left .mapboxgl-ctrl{margin:10px 0 0 10px;float:left}.mapboxgl-ctrl-top-right .mapboxgl-ctrl{margin:10px 10px 0 0;float:right}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl{margin:0 0 10px 10px;float:left}.mapboxgl-ctrl-bottom-right .mapboxgl-ctrl{margin:0 10px 10px 0;float:right}.mapboxgl-ctrl-group{border-radius:4px;background:#fff}.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 2px rgba(0,0,0,.1);box-shadow:0 0 0 2px rgba(0,0,0,.1)}@media (-ms-high-contrast:active){.mapboxgl-ctrl-group:not(:empty){-webkit-box-shadow:0 0 0 2px ButtonText;box-shadow:0 0 0 2px ButtonText}}.mapboxgl-ctrl-group button{width:29px;height:29px;display:block;padding:0;outline:none;border:0;-webkit-box-sizing:border-box;box-sizing:border-box;background-color:transparent;cursor:pointer}.mapboxgl-ctrl-group button+button{border-top:1px solid #ddd}.mapboxgl-ctrl button .mapboxgl-ctrl-icon{display:block;width:100%;height:100%;background-repeat:no-repeat;background-position:50%}@media (-ms-high-contrast:active){.mapboxgl-ctrl-icon{background-color:transparent}.mapboxgl-ctrl-group button+button{border-top:1px solid ButtonText}}.mapboxgl-ctrl button::-moz-focus-inner{border:0;padding:0}.mapboxgl-ctrl-attrib-button:focus,.mapboxgl-ctrl-group button:focus{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl button:disabled{cursor:not-allowed}.mapboxgl-ctrl button:disabled .mapboxgl-ctrl-icon{opacity:.25}.mapboxgl-ctrl button:not(:disabled):hover{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-group button:focus:focus-visible{-webkit-box-shadow:0 0 2px 2px #0096ff;box-shadow:0 0 2px 2px #0096ff}.mapboxgl-ctrl-group button:focus:not(:focus-visible){-webkit-box-shadow:none;box-shadow:none}.mapboxgl-ctrl-group button:focus:first-child{border-radius:4px 4px 0 0}.mapboxgl-ctrl-group button:focus:last-child{border-radius:0 0 4px 4px}.mapboxgl-ctrl-group button:focus:only-child{border-radius:inherit}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-out .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 13c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h9c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-9z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-zoom-in .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M14.5 8.5c-.75 0-1.5.75-1.5 1.5v3h-3c-.75 0-1.5.75-1.5 1.5S9.25 16 10 16h3v3c0 .75.75 1.5 1.5 1.5S16 19.75 16 19v-3h3c.75 0 1.5-.75 1.5-1.5S19.75 13 19 13h-3v-3c0-.75-.75-1.5-1.5-1.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-fullscreen .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M24 16v5.5c0 1.75-.75 2.5-2.5 2.5H16v-1l3-1.5-4-5.5 1-1 5.5 4 1.5-3h1zM6 16l1.5 3 5.5-4 1 1-4 5.5 3 1.5v1H7.5C5.75 24 5 23.25 5 21.5V16h1zm7-11v1l-3 1.5 4 5.5-1 1-5.5-4L6 13H5V7.5C5 5.75 5.75 5 7.5 5H13zm11 2.5c0-1.75-.75-2.5-2.5-2.5H16v1l3 1.5-4 5.5 1 1 5.5-4 1.5 3h1V7.5z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-shrink .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M18.5 16c-1.75 0-2.5.75-2.5 2.5V24h1l1.5-3 5.5 4 1-1-4-5.5 3-1.5v-1h-5.5zM13 18.5c0-1.75-.75-2.5-2.5-2.5H5v1l3 1.5L4 24l1 1 5.5-4 1.5 3h1v-5.5zm3-8c0 1.75.75 2.5 2.5 2.5H24v-1l-3-1.5L25 5l-1-1-5.5 4L17 5h-1v5.5zM10.5 13c1.75 0 2.5-.75 2.5-2.5V5h-1l-1.5 3L5 4 4 5l4 5.5L5 12v1h5.5z'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23999'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-compass .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 29 29' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10.5 14l4-8 4 8h-8z'/%3E%3Cpath d='M10.5 16l4 8 4-8h-8z' fill='%23ccc'/%3E%3C/svg%3E")}}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23333'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23aaa'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-waiting .mapboxgl-ctrl-icon{-webkit-animation:mapboxgl-spin 2s linear infinite;animation:mapboxgl-spin 2s linear infinite}@media (-ms-high-contrast:active){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23fff'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23999'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-active-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e58978'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%2333b5e5'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate.mapboxgl-ctrl-geolocate-background-error .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23e54e33'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3C/svg%3E")}.mapboxgl-ctrl button.mapboxgl-ctrl-geolocate:disabled .mapboxgl-ctrl-icon{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='29' height='29' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill='%23666'%3E%3Cpath d='M10 4C9 4 9 5 9 5v.1A5 5 0 005.1 9H5s-1 0-1 1 1 1 1 1h.1A5 5 0 009 14.9v.1s0 1 1 1 1-1 1-1v-.1a5 5 0 003.9-3.9h.1s1 0 1-1-1-1-1-1h-.1A5 5 0 0011 5.1V5s0-1-1-1zm0 2.5a3.5 3.5 0 110 7 3.5 3.5 0 110-7z'/%3E%3Ccircle cx='10' cy='10' r='2'/%3E%3Cpath d='M14 5l1 1-9 9-1-1 9-9z' fill='red'/%3E%3C/svg%3E")}}@-webkit-keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes mapboxgl-spin{0%{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(1turn);transform:rotate(1turn)}}a.mapboxgl-ctrl-logo{width:88px;height:23px;margin:0 0 -4px -4px;display:block;background-repeat:no-repeat;cursor:pointer;overflow:hidden;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg opacity='.3' stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg opacity='.9' fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}a.mapboxgl-ctrl-logo.mapboxgl-compact{width:23px}@media (-ms-high-contrast:active){a.mapboxgl-ctrl-logo{background-color:transparent;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23000' stroke-width='3'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cg fill='%23fff'%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/g%3E%3C/svg%3E")}}@media (-ms-high-contrast:black-on-white){a.mapboxgl-ctrl-logo{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='88' height='23' viewBox='0 0 88 23' xmlns='http://www.w3.org/2000/svg' xmlns:xlink='http://www.w3.org/1999/xlink' fill-rule='evenodd'%3E%3Cdefs%3E%3Cpath id='a' d='M11.5 2.25c5.105 0 9.25 4.145 9.25 9.25s-4.145 9.25-9.25 9.25-9.25-4.145-9.25-9.25 4.145-9.25 9.25-9.25zM6.997 15.983c-.051-.338-.828-5.802 2.233-8.873a4.395 4.395 0 013.13-1.28c1.27 0 2.49.51 3.39 1.42.91.9 1.42 2.12 1.42 3.39 0 1.18-.449 2.301-1.28 3.13C12.72 16.93 7 16 7 16l-.003-.017zM15.3 10.5l-2 .8-.8 2-.8-2-2-.8 2-.8.8-2 .8 2 2 .8z'/%3E%3Cpath id='b' d='M50.63 8c.13 0 .23.1.23.23V9c.7-.76 1.7-1.18 2.73-1.18 2.17 0 3.95 1.85 3.95 4.17s-1.77 4.19-3.94 4.19c-1.04 0-2.03-.43-2.74-1.18v3.77c0 .13-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V8.23c0-.12.1-.23.23-.23h1.4zm-3.86.01c.01 0 .01 0 .01-.01.13 0 .22.1.22.22v7.55c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V15c-.7.76-1.69 1.19-2.73 1.19-2.17 0-3.94-1.87-3.94-4.19 0-2.32 1.77-4.19 3.94-4.19 1.03 0 2.02.43 2.73 1.18v-.75c0-.12.1-.23.23-.23h1.4zm26.375-.19a4.24 4.24 0 00-4.16 3.29c-.13.59-.13 1.19 0 1.77a4.233 4.233 0 004.17 3.3c2.35 0 4.26-1.87 4.26-4.19 0-2.32-1.9-4.17-4.27-4.17zM60.63 5c.13 0 .23.1.23.23v3.76c.7-.76 1.7-1.18 2.73-1.18 1.88 0 3.45 1.4 3.84 3.28.13.59.13 1.2 0 1.8-.39 1.88-1.96 3.29-3.84 3.29-1.03 0-2.02-.43-2.73-1.18v.77c0 .12-.1.23-.23.23h-1.4c-.13 0-.23-.1-.23-.23V5.23c0-.12.1-.23.23-.23h1.4zm-34 11h-1.4c-.13 0-.23-.11-.23-.23V8.22c.01-.13.1-.22.23-.22h1.4c.13 0 .22.11.23.22v.68c.5-.68 1.3-1.09 2.16-1.1h.03c1.09 0 2.09.6 2.6 1.55.45-.95 1.4-1.55 2.44-1.56 1.62 0 2.93 1.25 2.9 2.78l.03 5.2c0 .13-.1.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.8 0-1.46.7-1.59 1.62l.01 4.68c0 .13-.11.23-.23.23h-1.41c-.13 0-.23-.11-.23-.23v-4.59c0-.98-.74-1.71-1.62-1.71-.85 0-1.54.79-1.6 1.8v4.5c0 .13-.1.23-.23.23zm53.615 0h-1.61c-.04 0-.08-.01-.12-.03-.09-.06-.13-.19-.06-.28l2.43-3.71-2.39-3.65a.213.213 0 01-.03-.12c0-.12.09-.21.21-.21h1.61c.13 0 .24.06.3.17l1.41 2.37 1.4-2.37a.34.34 0 01.3-.17h1.6c.04 0 .08.01.12.03.09.06.13.19.06.28l-2.37 3.65 2.43 3.7c0 .05.01.09.01.13 0 .12-.09.21-.21.21h-1.61c-.13 0-.24-.06-.3-.17l-1.44-2.42-1.44 2.42a.34.34 0 01-.3.17zm-7.12-1.49c-1.33 0-2.42-1.12-2.42-2.51 0-1.39 1.08-2.52 2.42-2.52 1.33 0 2.42 1.12 2.42 2.51 0 1.39-1.08 2.51-2.42 2.52zm-19.865 0c-1.32 0-2.39-1.11-2.42-2.48v-.07c.02-1.38 1.09-2.49 2.4-2.49 1.32 0 2.41 1.12 2.41 2.51 0 1.39-1.07 2.52-2.39 2.53zm-8.11-2.48c-.01 1.37-1.09 2.47-2.41 2.47s-2.42-1.12-2.42-2.51c0-1.39 1.08-2.52 2.4-2.52 1.33 0 2.39 1.11 2.41 2.48l.02.08zm18.12 2.47c-1.32 0-2.39-1.11-2.41-2.48v-.06c.02-1.38 1.09-2.48 2.41-2.48s2.42 1.12 2.42 2.51c0 1.39-1.09 2.51-2.42 2.51z'/%3E%3C/defs%3E%3Cmask id='c'%3E%3Crect width='100%25' height='100%25' fill='%23fff'/%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/mask%3E%3Cg stroke='%23fff' stroke-width='3' fill='%23fff'%3E%3Ccircle mask='url(%23c)' cx='11.5' cy='11.5' r='9.25'/%3E%3Cuse xlink:href='%23b' mask='url(%23c)'/%3E%3C/g%3E%3Cuse xlink:href='%23a'/%3E%3Cuse xlink:href='%23b'/%3E%3C/svg%3E")}}.mapboxgl-ctrl.mapboxgl-ctrl-attrib{padding:0 5px;background-color:hsla(0,0%,100%,.5);margin:0}@media screen{.mapboxgl-ctrl-attrib.mapboxgl-compact{min-height:20px;padding:2px 24px 2px 0;margin:10px;position:relative;background-color:#fff;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 28px 2px 8px;visibility:visible}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show,.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact-show{padding:2px 8px 2px 28px;border-radius:12px}.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-inner{display:none}.mapboxgl-ctrl-attrib-button{display:none;cursor:pointer;position:absolute;background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E");background-color:hsla(0,0%,100%,.5);width:24px;height:24px;-webkit-box-sizing:border-box;box-sizing:border-box;border-radius:12px;outline:none;top:0;right:0;border:0}.mapboxgl-ctrl-bottom-left .mapboxgl-ctrl-attrib-button,.mapboxgl-ctrl-top-left .mapboxgl-ctrl-attrib-button{left:0}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-inner,.mapboxgl-ctrl-attrib.mapboxgl-compact .mapboxgl-ctrl-attrib-button{display:block}.mapboxgl-ctrl-attrib.mapboxgl-compact-show .mapboxgl-ctrl-attrib-button{background-color:rgba(0,0,0,.05)}.mapboxgl-ctrl-bottom-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;right:0}.mapboxgl-ctrl-top-right>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;right:0}.mapboxgl-ctrl-top-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{top:0;left:0}.mapboxgl-ctrl-bottom-left>.mapboxgl-ctrl-attrib.mapboxgl-compact:after{bottom:0;left:0}}@media screen and (-ms-high-contrast:active){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd' fill='%23fff'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}@media screen and (-ms-high-contrast:black-on-white){.mapboxgl-ctrl-attrib.mapboxgl-compact:after{background-image:url("data:image/svg+xml;charset=utf-8,%3Csvg width='24' height='24' viewBox='0 0 20 20' xmlns='http://www.w3.org/2000/svg' fill-rule='evenodd'%3E%3Cpath d='M4 10a6 6 0 1012 0 6 6 0 10-12 0m5-3a1 1 0 102 0 1 1 0 10-2 0m0 3a1 1 0 112 0v3a1 1 0 11-2 0'/%3E%3C/svg%3E")}}.mapboxgl-ctrl-attrib a{color:rgba(0,0,0,.75);text-decoration:none}.mapboxgl-ctrl-attrib a:hover{color:inherit;text-decoration:underline}.mapboxgl-ctrl-attrib .mapbox-improve-map{font-weight:700;margin-left:2px}.mapboxgl-attrib-empty{display:none}.mapboxgl-ctrl-scale{background-color:hsla(0,0%,100%,.75);font-size:10px;border:2px solid #333;border-top:#333;padding:0 5px;color:#333;-webkit-box-sizing:border-box;box-sizing:border-box}.mapboxgl-popup{position:absolute;top:0;left:0;display:-webkit-box;display:-ms-flexbox;display:flex;will-change:transform;pointer-events:none}.mapboxgl-popup-anchor-top,.mapboxgl-popup-anchor-top-left,.mapboxgl-popup-anchor-top-right{-webkit-box-orient:vertical;-webkit-box-direction:normal;-ms-flex-direction:column;flex-direction:column}.mapboxgl-popup-anchor-bottom,.mapboxgl-popup-anchor-bottom-left,.mapboxgl-popup-anchor-bottom-right{-webkit-box-orient:vertical;-webkit-box-direction:reverse;-ms-flex-direction:column-reverse;flex-direction:column-reverse}.mapboxgl-popup-anchor-left{-webkit-box-orient:horizontal;-webkit-box-direction:normal;-ms-flex-direction:row;flex-direction:row}.mapboxgl-popup-anchor-right{-webkit-box-orient:horizontal;-webkit-box-direction:reverse;-ms-flex-direction:row-reverse;flex-direction:row-reverse}.mapboxgl-popup-tip{width:0;height:0;border:10px solid transparent;z-index:1}.mapboxgl-popup-anchor-top .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-top:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-top:none;border-left:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-top:none;border-right:none;border-bottom-color:#fff}.mapboxgl-popup-anchor-bottom .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-bottom:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-tip{-webkit-align-self:flex-start;-ms-flex-item-align:start;align-self:flex-start;border-bottom:none;border-left:none;border-top-color:#fff}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-tip{-webkit-align-self:flex-end;-ms-flex-item-align:end;align-self:flex-end;border-bottom:none;border-right:none;border-top-color:#fff}.mapboxgl-popup-anchor-left .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-left:none;border-right-color:#fff}.mapboxgl-popup-anchor-right .mapboxgl-popup-tip{-webkit-align-self:center;-ms-flex-item-align:center;align-self:center;border-right:none;border-left-color:#fff}.mapboxgl-popup-close-button{position:absolute;right:0;top:0;border:0;border-radius:0 3px 0 0;cursor:pointer;background-color:transparent}.mapboxgl-popup-close-button:hover{background-color:rgba(0,0,0,.05)}.mapboxgl-popup-content{position:relative;background:#fff;border-radius:3px;-webkit-box-shadow:0 1px 2px rgba(0,0,0,.1);box-shadow:0 1px 2px rgba(0,0,0,.1);padding:10px 10px 15px;pointer-events:auto}.mapboxgl-popup-anchor-top-left .mapboxgl-popup-content{border-top-left-radius:0}.mapboxgl-popup-anchor-top-right .mapboxgl-popup-content{border-top-right-radius:0}.mapboxgl-popup-anchor-bottom-left .mapboxgl-popup-content{border-bottom-left-radius:0}.mapboxgl-popup-anchor-bottom-right .mapboxgl-popup-content{border-bottom-right-radius:0}.mapboxgl-popup-track-pointer{display:none}.mapboxgl-popup-track-pointer *{pointer-events:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}.mapboxgl-map:hover .mapboxgl-popup-track-pointer{display:-webkit-box;display:-ms-flexbox;display:flex}.mapboxgl-map:active .mapboxgl-popup-track-pointer{display:none}.mapboxgl-marker{position:absolute;top:0;left:0;will-change:transform}.mapboxgl-user-location-dot,.mapboxgl-user-location-dot:before{background-color:#1da1f2;width:15px;height:15px;border-radius:50%}.mapboxgl-user-location-dot:before{content:"";position:absolute;-webkit-animation:mapboxgl-user-location-dot-pulse 2s infinite;animation:mapboxgl-user-location-dot-pulse 2s infinite}.mapboxgl-user-location-dot:after{border-radius:50%;border:2px solid #fff;content:"";height:19px;left:-2px;position:absolute;top:-2px;width:19px;-webkit-box-sizing:border-box;box-sizing:border-box;-webkit-box-shadow:0 0 3px rgba(0,0,0,.35);box-shadow:0 0 3px rgba(0,0,0,.35)}@-webkit-keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);opacity:0}to{-webkit-transform:scale(1);opacity:0}}@keyframes mapboxgl-user-location-dot-pulse{0%{-webkit-transform:scale(1);transform:scale(1);opacity:1}70%{-webkit-transform:scale(3);transform:scale(3);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:0}}.mapboxgl-user-location-dot-stale{background-color:#aaa}.mapboxgl-user-location-dot-stale:after{display:none}.mapboxgl-user-location-accuracy-circle{background-color:rgba(29,161,242,.2);width:1px;height:1px;border-radius:100%}.mapboxgl-crosshair,.mapboxgl-crosshair .mapboxgl-interactive,.mapboxgl-crosshair .mapboxgl-interactive:active{cursor:crosshair}.mapboxgl-boxzoom{position:absolute;top:0;left:0;width:0;height:0;background:#fff;border:2px dotted #202020;opacity:.5}@media print{.mapbox-improve-map{display:none}}`),window.mapboxgl=Km();var VD=0,OS="101MlGsZ2AmmA&access_token=pk.eyJ1IjoiZXhhbXBsZXMiLCJhIjoiY2p0MG01MXRqMW45cjQzb2R6b2ptc3J4MSJ9.zA2W0IkI0c6KaAhJfk9bWg",jD=(IS=(0,tr.b2)(),IS(PS=function(e){(0,Le.Z)(t,e);var r=UD(t);function t(){var n;(0,Q.Z)(this,t);for(var i=arguments.length,a=new Array(i),s=0;s<i;s++)a[s]=arguments[s];return n=r.call.apply(r,[this].concat(a)),(0,F.Z)((0,Re.Z)(n),"version","MAPBOX"),n}return(0,j.Z)(t,[{key:"getType",value:function(){return"mapbox"}},{key:"lngLatToCoord",value:function(i){var a=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{x:0,y:0,z:0},s=this.lngLatToMercator(i,0),l=s.x,f=s.y;return[l-a.x,f-a.y]}},{key:"lngLatToMercator",value:function(i,a){var s=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),l=s.x,f=l===void 0?0:l,d=s.y,y=d===void 0?0:d,b=s.z,T=b===void 0?0:b;return{x:f,y,z:T}}},{key:"getModelMatrix",value:function(i,a,s){var l=arguments.length>3&&arguments[3]!==void 0?arguments[3]:[1,1,1],f=arguments.length>4&&arguments[4]!==void 0?arguments[4]:{x:0,y:0,z:0},d=window.mapboxgl.MercatorCoordinate.fromLngLat(i,a),y=d.meterInMercatorCoordinateUnits(),b=It.create();return It.translate(b,b,La.fromValues(d.x-f.x,d.y-f.y,d.z||0-f.z)),It.scale(b,b,La.fromValues(y*l[0],-y*l[1],y*l[2])),It.rotateX(b,b,s[0]),It.rotateY(b,b,s[1]),It.rotateZ(b,b,s[2]),b}},{key:"init",value:function(){var n=(0,Zt.Z)(_e().mark(function a(){var s=this,l,f,d,y,b,T,M,P,k,H,q,ae,Se;return _e().wrap(function(it){for(;;)switch(it.prev=it.next){case 0:l=this.config,f=l.id,d=f===void 0?"map":f,y=l.attributionControl,b=y===void 0?!1:y,T=l.style,M=T===void 0?"light":T,P=l.token,k=P===void 0?OS:P,H=l.rotation,q=H===void 0?0:H,ae=l.mapInstance,Se=(0,Ea.Z)(l,ND),this.viewport=new FD,!ae&&!window.mapboxgl&&console.error(this.configService.getSceneWarninfo("SDK")),k===OS&&M!=="blank"&&!window.mapboxgl.accessToken&&!ae&&console.warn(this.configService.getSceneWarninfo("MapToken")),!ae&&!window.mapboxgl.accessToken&&(window.mapboxgl.accessToken=k),ae?(this.map=ae,this.$mapContainer=this.map.getContainer()):(this.$mapContainer=this.creatMapContainer(d),this.map=new window.mapboxgl.Map((0,W.Z)({container:this.$mapContainer,style:this.getMapStyleValue(M),attributionControl:b,bearing:q},Se))),this.map.on("load",function(){s.handleCameraChanged()}),this.map.on("move",this.handleCameraChanged),this.handleCameraChanged();case 9:case"end":return it.stop()}},a,this)}));function i(){return n.apply(this,arguments)}return i}()},{key:"destroy",value:function(){var i;(i=this.$mapContainer)===null||i===void 0||(i=i.parentNode)===null||i===void 0||i.removeChild(this.$mapContainer),this.eventEmitter.removeAllListeners(),this.map&&(this.map.remove(),this.$mapContainer=null)}},{key:"emit",value:function(i){for(var a,s=arguments.length,l=new Array(s>1?s-1:0),f=1;f<s;f++)l[f-1]=arguments[f];(a=this.eventEmitter).emit.apply(a,[i].concat(l))}},{key:"once",value:function(i){for(var a,s=arguments.length,l=new Array(s>1?s-1:0),f=1;f<s;f++)l[f-1]=arguments[f];(a=this.eventEmitter).once.apply(a,[i].concat(l))}},{key:"getMapContainer",value:function(){return this.$mapContainer}},{key:"meterToCoord",value:function(i,a){var s=new(Km()).LngLat(i[0],i[1]),l=new(Km()).LngLat(a[0],a[1]),f=s.distanceTo(l),d=Km().MercatorCoordinate.fromLngLat({lng:i[0],lat:i[1]}),y=Km().MercatorCoordinate.fromLngLat({lng:a[0],lat:a[1]}),b=d.x,T=d.y,M=y.x,P=y.y,k=Math.sqrt(Math.pow(b-M,2)+Math.pow(T-P,2))*4194304*2;return k/f}},{key:"exportMap",value:function(i){var a=this.map.getCanvas(),s=i==="jpg"?a==null?void 0:a.toDataURL("image/jpeg"):a==null?void 0:a.toDataURL("image/png");return s}},{key:"creatMapContainer",value:function(i){var a=i;typeof i=="string"&&(a=document.getElementById(i));var s=document.createElement("div");return s.style.cssText+=`
      position: absolute;
      top: 0;
      height: 100%;
      width: 100%;
    `,s.id="l7_mapbox_div"+VD++,a.appendChild(s),s}}]),t}(RD))||PS);function HD(e){var r=WD();return function(){var n=(0,Ee.Z)(e),i;if(r){var a=(0,Ee.Z)(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return(0,rt.Z)(this,i)}}function WD(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function GD(e,r){var t=typeof my!="undefined"&&!!my&&typeof my.showToast=="function"&&my.isFRM!==!0,n=typeof wx!="undefined"&&wx!==null&&(typeof wx.request!="undefined"||typeof wx.miniProgram!="undefined");if(!(t||n)&&(r||(r=document),!!r)){var i=r.head||r.getElementsByTagName("head")[0];if(!i){i=r.createElement("head");var a=r.body||r.getElementsByTagName("body")[0];a?a.parentNode.insertBefore(i,a):r.documentElement.appendChild(i)}var s=r.createElement("style");return s.type="text/css",s.styleSheet?s.styleSheet.cssText=e:s.appendChild(r.createTextNode(e)),i.appendChild(s),s}}GD(`.mapboxgl-ctrl-logo {
 display: none !important;
}
`);var XD=function(e){(0,Le.Z)(t,e);var r=HD(t);function t(){return(0,Q.Z)(this,t),r.apply(this,arguments)}return(0,j.Z)(t,[{key:"getServiceConstructor",value:function(){return jD}}]),t}(SD);function Jm(e){"@babel/helpers - typeof";return Jm=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Jm(e)}function kS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function DS(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?kS(Object(t),!0).forEach(function(n){$D(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):kS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function $D(e,r,t){return r=YD(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function YD(e){var r=qD(e,"string");return Jm(r)==="symbol"?r:String(r)}function qD(e,r){if(Jm(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Jm(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function KD(e,r){return tL(e)||eL(e,r)||JD(e,r)||QD()}function QD(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function JD(e,r){if(e){if(typeof e=="string")return LS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return LS(e,r)}}function LS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function eL(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){d=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function tL(e){if(Array.isArray(e))return e}var rL=ee.memo(function(e){var r=e.style,t=e.className,n=e.map,i=e.option,a=e.onSceneLoaded,s=(0,ee.createRef)(),l=(0,ee.useState)(),f=KD(l,2),d=f[0],y=f[1];return(0,ee.useEffect)(function(){var b=new vD(DS(DS({id:s.current},i),{},{map:new XD(n)}));return b.on("loaded",function(){y(b),a&&a(b)}),function(){b.destroy()}},[]),(0,ee.useEffect)(function(){d&&n.style&&d.setMapStyle(n.style)},[JSON.stringify(n.style)]),(0,ee.useEffect)(function(){d&&n.zoom&&d.setZoom(n.zoom)},[n.zoom]),(0,ee.useEffect)(function(){d&&n.center&&d.setCenter(n.center)},[JSON.stringify(n.center)]),(0,ee.useEffect)(function(){d&&n.pitch!==void 0&&d.setPitch(n.pitch||0)},[n.pitch]),(0,ee.useEffect)(function(){d&&n.rotation&&d.setRotation(n.rotation)},[n.rotation]),ee.createElement(ve.Provider,{value:d},(0,ee.createElement)("div",{ref:s,style:r,className:t},d&&e.children))}),nL=rL;function eg(e){"@babel/helpers - typeof";return eg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},eg(e)}function BS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function jN(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?BS(Object(t),!0).forEach(function(n){iL(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):BS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function iL(e,r,t){return r=aL(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function aL(e){var r=oL(e,"string");return eg(r)==="symbol"?r:String(r)}function oL(e,r){if(eg(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(eg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function HN(e,r){return cL(e)||lL(e,r)||uL(e,r)||sL()}function sL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function uL(e,r){if(e){if(typeof e=="string")return FS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return FS(e,r)}}function FS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function lL(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){d=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function cL(e){if(Array.isArray(e))return e}var WN=null,GN=null;function tg(e){"@babel/helpers - typeof";return tg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},tg(e)}function NS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function XN(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?NS(Object(t),!0).forEach(function(n){fL(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):NS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function fL(e,r,t){return r=hL(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function hL(e){var r=pL(e,"string");return tg(r)==="symbol"?r:String(r)}function pL(e,r){if(tg(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(tg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function $N(e,r){return gL(e)||mL(e,r)||vL(e,r)||dL()}function dL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function vL(e,r){if(e){if(typeof e=="string")return US(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return US(e,r)}}function US(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function mL(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){d=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function gL(e){if(Array.isArray(e))return e}var YN=null,qN=null;function rg(e){"@babel/helpers - typeof";return rg=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},rg(e)}function zS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function KN(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?zS(Object(t),!0).forEach(function(n){_L(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):zS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function _L(e,r,t){return r=yL(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function yL(e){var r=xL(e,"string");return rg(r)==="symbol"?r:String(r)}function xL(e,r){if(rg(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(rg(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function QN(e,r){return AL(e)||SL(e,r)||EL(e,r)||bL()}function bL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function EL(e,r){if(e){if(typeof e=="string")return ZS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return ZS(e,r)}}function ZS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function SL(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){d=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function AL(e){if(Array.isArray(e))return e}var JN=null,e6=null;function t6(e,r){return RL(e)||CL(e,r)||wL(e,r)||TL()}function TL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function wL(e,r){if(e){if(typeof e=="string")return VS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return VS(e,r)}}function VS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function CL(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){d=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function RL(e){if(Array.isArray(e))return e}var r6=null;function ng(e){"@babel/helpers - typeof";return ng=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},ng(e)}var n6=null;function jS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function i6(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?jS(Object(t),!0).forEach(function(n){ML(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):jS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function ML(e,r,t){return r=IL(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function IL(e){var r=PL(e,"string");return ng(r)==="symbol"?r:String(r)}function PL(e,r){if(ng(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(ng(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function a6(e,r){if(e==null)return{};var t=OL(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}function OL(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var o6={exportImage:QT,fullscreen:nw,geoLocate:ow,layer:t1,layerSwitch:t1,logo:r1,mapTheme:vw,mouseLocation:_w,zoom:B5,scale:bw},s6=null,HS=U(10422);function WS(e,r){return BL(e)||LL(e,r)||DL(e,r)||kL()}function kL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function DL(e,r){if(e){if(typeof e=="string")return GS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return GS(e,r)}}function GS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function LL(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){d=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function BL(e){if(Array.isArray(e))return e}var XS=ee.useEffect,$S=ee.useState,FL=/\B([A-Z])/g,NL=function(r){return r.replace(FL,"-$1").toLowerCase()};function u6(e){var r=e.className,t=e.style,n=e.children,i=e.position,a=$S(),s=WS(a,2),l=s[0],f=s[1],d=useSceneValue(),y=$S(function(){return document.createElement("div")}),b=WS(y,1),T=b[0];return XS(function(){var M=new Control({position:i});return M.onAdd=function(){if(r&&(T.className=r),t){var P=Object.keys(t).map(function(k){return"".concat(NL(k),":").concat(t[k])}).join(";");T.style.cssText=P}return T},M.onRemove=function(){},f(M),d.addControl(M),function(){d.removeControl(M)}},[]),XS(function(){l&&l.setPosition(i||"bottomleft")},[i]),createPortal(n,T)}var YS=(0,ee.createContext)({});function l6(){return useContext(YS)}var UL=ee.memo(function(r){var t=r.layer,n=r.active;return t.active(n.option),null},Ms()),zL=ee.memo(function(r){var t=r.layer,n=r.animate;return t.animate(n),null},Ms()),ZL=ee.memo(function(r){var t=r.layer,n=r.color;return n.field?t.color(n.field,n.values):t.color(n.values),null},Ms()),VL=ee.memo(function(r){var t=r.layer,n=r.filter;return n.field&&t.filter(n.field,n.values),null},Ms()),jL=ee.memo(function(r){var t=r.layer,n=r.scale;return t.scale(n.values),null},Ms()),HL=ee.memo(function(r){var t=r.layer,n=r.select;return t.select(n.option),null},Ms()),WL=ee.memo(function(r){var t=r.layer,n=r.shape;return n.field?t.shape(n.field,n.values):t.shape(n.values),null},Ms()),GL=ee.memo(function(r){var t=r.layer,n=r.size;return n.field?t.size(n.field,n.values):t.size(n.values),null},Ms()),XL=["data"];function $L(e,r){if(e==null)return{};var t=YL(e,r),n,i;if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);for(i=0;i<a.length;i++)n=a[i],!(r.indexOf(n)>=0)&&Object.prototype.propertyIsEnumerable.call(e,n)&&(t[n]=e[n])}return t}function YL(e,r){if(e==null)return{};var t={},n=Object.keys(e),i,a;for(a=0;a<n.length;a++)i=n[a],!(r.indexOf(i)>=0)&&(t[i]=e[i]);return t}var qL=ee.memo(function(r){var t=r.layer,n=r.source,i=n.data,a=$L(n,XL);return t.inited?t.setData(i,a):t.source(i,a),a.autoFit&&t.fitBounds(a&&a.fitBoundsOptions),null},Ms()),c6=ee.useEffect,KL=ee.memo(function(r){var t=r.layer,n=r.style;return t.style(n),null},Ms());function QL(e,r){return rB(e)||tB(e,r)||eB(e,r)||JL()}function JL(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function eB(e,r){if(e){if(typeof e=="string")return qS(e,r);var t=Object.prototype.toString.call(e).slice(8,-1);if(t==="Object"&&e.constructor&&(t=e.constructor.name),t==="Map"||t==="Set")return Array.from(e);if(t==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t))return qS(e,r)}}function qS(e,r){(r==null||r>e.length)&&(r=e.length);for(var t=0,n=new Array(r);t<r;t++)n[t]=e[t];return n}function tB(e,r){var t=e==null?null:typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(t!=null){var n,i,a,s,l=[],f=!0,d=!1;try{if(a=(t=t.call(e)).next,r===0){if(Object(t)!==t)return;f=!1}else for(;!(f=(n=a.call(t)).done)&&(l.push(n.value),l.length!==r);f=!0);}catch(y){d=!0,i=y}finally{try{if(!f&&t.return!=null&&(s=t.return(),Object(s)!==s))return}finally{if(d)throw i}}return l}}function rB(e){if(Array.isArray(e))return e}var ig=ee.useEffect,nB=ee.useState;function KS(e,r){var t=r.source,n=r.color,i=r.shape,a=r.style,s=r.size,l=r.scale,f=r.active,d=r.select,y=r.filter,b=r.animate,T=r.options,M=r.onLayerLoaded,P=_(),k=nB(function(){var ae;switch(e){case"polygonLayer":ae=new kg(T);break;case"lineLayer":ae=new q0(T);break;case"pointLayer":ae=new Og(T);break;case"heatmapLayer":ae=new OC(T);break;case"rasterLayer":ae=new Dg(T);break;case"imageLayer":ae=new P1(T);break;case"citybuildingLayer":ae=new rC(T);break;default:ae=new kg(T)}return ae.on("inited",function(){M&&M(ae,P)}),ae}),H=QL(k,1),q=H[0];return ig(function(){return P.addLayer(q),function(){P.removeLayer(q)}},[]),ig(function(){q.inited&&T&&q.updateLayerConfig(T)},[T==null?void 0:T.minZoom,T==null?void 0:T.maxZoom,T==null?void 0:T.visible]),ig(function(){q.inited&&(T!=null&&T.zIndex)&&q.setIndex(T.zIndex)},[T==null?void 0:T.zIndex]),ig(function(){q.inited&&(T!=null&&T.blend)&&q.setBlend(T.blend)},[T==null?void 0:T.blend]),ig(function(){P.render()}),ee.createElement(YS.Provider,{value:q},ee.createElement(qL,{layer:q,source:t}),l&&ee.createElement(jL,{layer:q,scale:l}),n&&ee.createElement(ZL,{layer:q,color:n}),s&&ee.createElement(GL,{layer:q,size:s}),i&&ee.createElement(WL,{layer:q,shape:i}),a&&ee.createElement(KL,{layer:q,style:a}),f&&ee.createElement(UL,{layer:q,active:f}),d&&ee.createElement(HL,{layer:q,select:d}),y&&ee.createElement(VL,{layer:q,filter:y}),b&&ee.createElement(zL,{layer:q,animate:b}),r.children)}var f6=null,h6=null,iB=ee.memo(function(r){return KS("pointLayer",r)}),aB=ee.memo(function(r){return KS("heatmapLayer",r)}),p6=null,d6=null,v6=null,m6=ee.useEffect,g6=null,_6=null;function Nv(e){"@babel/helpers - typeof";return Nv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Nv(e)}function QS(e,r){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);r&&(n=n.filter(function(i){return Object.getOwnPropertyDescriptor(e,i).enumerable})),t.push.apply(t,n)}return t}function S0(e){for(var r=1;r<arguments.length;r++){var t=arguments[r]!=null?arguments[r]:{};r%2?QS(Object(t),!0).forEach(function(n){oB(e,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):QS(Object(t)).forEach(function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})}return e}function oB(e,r,t){return r=e2(r),r in e?Object.defineProperty(e,r,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[r]=t,e}function sB(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function JS(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,e2(n.key),n)}}function uB(e,r,t){return r&&JS(e.prototype,r),t&&JS(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function e2(e){var r=lB(e,"string");return Nv(r)==="symbol"?r:String(r)}function lB(e,r){if(Nv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Nv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function cB(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&N_(e,r)}function N_(e,r){return N_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},N_(e,r)}function fB(e){var r=dB();return function(){var n=A0(e),i;if(r){var a=A0(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return hB(this,i)}}function hB(e,r){if(r&&(Nv(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return pB(e)}function pB(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function dB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function A0(e){return A0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},A0(e)}var y6=function(e){cB(t,e);var r=fB(t);function t(n){var i;return sB(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.popup=void 0,i.el=document.createElement("div"),i}return uB(t,[{key:"componentDidMount",value:function(){var i,a=this.props,s=a.lnglat,l=a.children,f=a.option,d=a.lngLat,y=new mE(S0(S0({},f),{},{stopPropagation:(i=this.props.option)===null||i===void 0?void 0:i.stopPropagation}));s&&y.setLnglat(s),d&&y.setLnglat(d),l&&y.setHTML(this.el),this.popup=y,this.scene.addPopup(y)}},{key:"componentDidUpdate",value:function(i){var a,s,l,f,d,y,b=Array.isArray(i.lnglat)?i.lnglat:[i==null||(a=i.lnglat)===null||a===void 0?void 0:a.lng,i==null||(s=i.lnglat)===null||s===void 0?void 0:s.lat],T=Array.isArray(this.props.lnglat)?this.props.lnglat:[(l=this.props)===null||l===void 0||(f=l.lnglat)===null||f===void 0?void 0:f.lng,(d=this.props)===null||d===void 0||(y=d.lnglat)===null||y===void 0?void 0:y.lat],M=b.toString()!==T.toString();if(M){var P;this.popup.remove(),this.popup=new mE(S0(S0({},this.props.option),{},{stopPropagation:(P=this.props.option)===null||P===void 0?void 0:P.stopPropagation})),this.popup.setLnglat(this.props.lnglat),this.popup.setHTML(this.el),this.scene.addPopup(this.popup)}}},{key:"componentWillUnmount",value:function(){this.popup.remove()}},{key:"render",value:function(){var i=this;return ee.createElement(ve.Consumer,{},function(a){return a&&(i.scene=a),(0,HS.createPortal)(i.props.children,i.el)})}}]),t}(ee.PureComponent);function Uv(e){"@babel/helpers - typeof";return Uv=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(r){return typeof r}:function(r){return r&&typeof Symbol=="function"&&r.constructor===Symbol&&r!==Symbol.prototype?"symbol":typeof r},Uv(e)}function vB(e,r){if(!(e instanceof r))throw new TypeError("Cannot call a class as a function")}function t2(e,r){for(var t=0;t<r.length;t++){var n=r[t];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,gB(n.key),n)}}function mB(e,r,t){return r&&t2(e.prototype,r),t&&t2(e,t),Object.defineProperty(e,"prototype",{writable:!1}),e}function gB(e){var r=_B(e,"string");return Uv(r)==="symbol"?r:String(r)}function _B(e,r){if(Uv(e)!=="object"||e===null)return e;var t=e[Symbol.toPrimitive];if(t!==void 0){var n=t.call(e,r||"default");if(Uv(n)!=="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(r==="string"?String:Number)(e)}function yB(e,r){if(typeof r!="function"&&r!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(r&&r.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),r&&U_(e,r)}function U_(e,r){return U_=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(n,i){return n.__proto__=i,n},U_(e,r)}function xB(e){var r=SB();return function(){var n=T0(e),i;if(r){var a=T0(this).constructor;i=Reflect.construct(n,arguments,a)}else i=n.apply(this,arguments);return bB(this,i)}}function bB(e,r){if(r&&(Uv(r)==="object"||typeof r=="function"))return r;if(r!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return EB(e)}function EB(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function SB(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function T0(e){return T0=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(t){return t.__proto__||Object.getPrototypeOf(t)},T0(e)}var x6=function(e){yB(t,e);var r=xB(t);function t(n){var i;return vB(this,t),i=r.call(this,n),i.el=void 0,i.scene=void 0,i.marker=void 0,i.el=document.createElement("div"),i}return mB(t,[{key:"componentDidMount",value:function(){var i=this.props,a=i.lnglat,s=i.children,l=i.option,f=i.onMarkerLoaded,d=new BT(l);a&&d.setLnglat(a),s&&d.setElement(this.el),this.marker=d,f&&f(d),this.scene.addMarker(d)}},{key:"componentDidUpdate",value:function(i){var a,s=JSON.stringify(i==null?void 0:i.lnglat)!==JSON.stringify((a=this.props)===null||a===void 0?void 0:a.lnglat);s&&this.props.lnglat&&this.marker.setLnglat(this.props.lnglat)}},{key:"componentWillUnmount",value:function(){this.marker&&this.marker.remove()}},{key:"render",value:function(){var i=this;return ee.createElement(ve.Consumer,{},function(a){return a&&(i.scene=a),(0,HS.createPortal)(i.props.children,i.el)})}}]),t}(ee.PureComponent),b6=ee.useEffect,E6=null,S6=null,A6=ee.useEffect,T6=null},47903:function(Qt){Qt.exports=re;function re(ve,_){var fe=ve&&ve.type,Z;if(fe==="FeatureCollection")for(Z=0;Z<ve.features.length;Z++)re(ve.features[Z],_);else if(fe==="GeometryCollection")for(Z=0;Z<ve.geometries.length;Z++)re(ve.geometries[Z],_);else if(fe==="Feature")re(ve.geometry,_);else if(fe==="Polygon")U(ve.coordinates,_);else if(fe==="MultiPolygon")for(Z=0;Z<ve.coordinates.length;Z++)U(ve.coordinates[Z],_);return ve}function U(ve,_){if(ve.length!==0){ee(ve[0],_);for(var fe=1;fe<ve.length;fe++)ee(ve[fe],!_)}}function ee(ve,_){for(var fe=0,Z=0,he=0,ce=ve.length,Ge=ce-1;he<ce;Ge=he++){var oe=(ve[he][0]-ve[Ge][0])*(ve[Ge][1]+ve[he][1]),We=fe+oe;Z+=Math.abs(fe)>=Math.abs(oe)?fe-We+oe:oe-We+fe,fe=We}fe+Z>=0!=!!_&&ve.reverse()}},96542:function(Qt){"use strict";Qt.exports=re;function re(U,ee){this.x=U,this.y=ee}re.prototype={clone:function(){return new re(this.x,this.y)},add:function(U){return this.clone()._add(U)},sub:function(U){return this.clone()._sub(U)},multByPoint:function(U){return this.clone()._multByPoint(U)},divByPoint:function(U){return this.clone()._divByPoint(U)},mult:function(U){return this.clone()._mult(U)},div:function(U){return this.clone()._div(U)},rotate:function(U){return this.clone()._rotate(U)},rotateAround:function(U,ee){return this.clone()._rotateAround(U,ee)},matMult:function(U){return this.clone()._matMult(U)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(U){return this.x===U.x&&this.y===U.y},dist:function(U){return Math.sqrt(this.distSqr(U))},distSqr:function(U){var ee=U.x-this.x,ve=U.y-this.y;return ee*ee+ve*ve},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(U){return Math.atan2(this.y-U.y,this.x-U.x)},angleWith:function(U){return this.angleWithSep(U.x,U.y)},angleWithSep:function(U,ee){return Math.atan2(this.x*ee-this.y*U,this.x*U+this.y*ee)},_matMult:function(U){var ee=U[0]*this.x+U[1]*this.y,ve=U[2]*this.x+U[3]*this.y;return this.x=ee,this.y=ve,this},_add:function(U){return this.x+=U.x,this.y+=U.y,this},_sub:function(U){return this.x-=U.x,this.y-=U.y,this},_mult:function(U){return this.x*=U,this.y*=U,this},_div:function(U){return this.x/=U,this.y/=U,this},_multByPoint:function(U){return this.x*=U.x,this.y*=U.y,this},_divByPoint:function(U){return this.x/=U.x,this.y/=U.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var U=this.y;return this.y=this.x,this.x=-U,this},_rotate:function(U){var ee=Math.cos(U),ve=Math.sin(U),_=ee*this.x-ve*this.y,fe=ve*this.x+ee*this.y;return this.x=_,this.y=fe,this},_rotateAround:function(U,ee){var ve=Math.cos(U),_=Math.sin(U),fe=ee.x+ve*(this.x-ee.x)-_*(this.y-ee.y),Z=ee.y+_*(this.x-ee.x)+ve*(this.y-ee.y);return this.x=fe,this.y=Z,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},re.convert=function(U){return U instanceof re?U:Array.isArray(U)?new re(U[0],U[1]):U}},25865:function(Qt){"use strict";Qt.exports=U,Qt.exports.default=U;var re=1e20;function U(Z,he,ce,Ge,oe,We){this.fontSize=Z||24,this.buffer=he===void 0?3:he,this.cutoff=Ge||.25,this.fontFamily=oe||"sans-serif",this.fontWeight=We||"normal",this.radius=ce||8;var qe=this.size=this.fontSize+this.buffer*2,pt=qe+this.buffer*2;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=qe,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textAlign="left",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(pt*pt),this.gridInner=new Float64Array(pt*pt),this.f=new Float64Array(pt),this.z=new Float64Array(pt+1),this.v=new Uint16Array(pt),this.useMetrics=this.ctx.measureText("A").actualBoundingBoxLeft!==void 0,this.middle=Math.round(qe/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function ee(Z,he,ce,Ge,oe,We,qe){We.fill(re,0,he*ce),qe.fill(0,0,he*ce);for(var pt=(he-Ge)/2,vt=0;vt<oe;vt++)for(var bt=0;bt<Ge;bt++){var Et=(vt+pt)*he+bt+pt,Dt=Z.data[4*(vt*Ge+bt)+3]/255;if(Dt===1)We[Et]=0,qe[Et]=re;else if(Dt===0)We[Et]=re,qe[Et]=0;else{var wt=Math.max(0,.5-Dt),at=Math.max(0,Dt-.5);We[Et]=wt*wt,qe[Et]=at*at}}}function ve(Z,he,ce,Ge,oe,We,qe){for(var pt=0;pt<he*ce;pt++){var vt=Math.sqrt(Ge[pt])-Math.sqrt(oe[pt]);Z[pt]=Math.round(255-255*(vt/We+qe))}}U.prototype._draw=function(Z,he){var ce=this.ctx.measureText(Z),Ge=ce.width,oe=2*this.buffer,We,qe,pt,vt,bt,Et,Dt,wt;he&&this.useMetrics?(bt=Math.floor(ce.actualBoundingBoxAscent),wt=this.buffer+Math.ceil(ce.actualBoundingBoxAscent),Et=this.buffer,Dt=this.buffer,qe=Math.min(this.size,Math.ceil(ce.actualBoundingBoxRight-ce.actualBoundingBoxLeft)),vt=Math.min(this.size-Et,Math.ceil(ce.actualBoundingBoxAscent+ce.actualBoundingBoxDescent)),We=qe+oe,pt=vt+oe,this.ctx.textBaseline="alphabetic"):(We=qe=this.size,pt=vt=this.size,bt=19*this.fontSize/24,Et=Dt=0,wt=this.middle,this.ctx.textBaseline="middle");var at;qe&&vt&&(this.ctx.clearRect(Dt,Et,qe,vt),this.ctx.fillText(Z,this.buffer,wt),at=this.ctx.getImageData(Dt,Et,qe,vt));var Tt=new Uint8ClampedArray(We*pt);return ee(at,We,pt,qe,vt,this.gridOuter,this.gridInner),_(this.gridOuter,We,pt,this.f,this.v,this.z),_(this.gridInner,We,pt,this.f,this.v,this.z),ve(Tt,We,pt,this.gridOuter,this.gridInner,this.radius,this.cutoff),{data:Tt,metrics:{width:qe,height:vt,sdfWidth:We,sdfHeight:pt,top:bt,left:0,advance:Ge}}},U.prototype.draw=function(Z){return this._draw(Z,!1).data},U.prototype.drawWithMetrics=function(Z){return this._draw(Z,!0)};function _(Z,he,ce,Ge,oe,We){for(var qe=0;qe<he;qe++)fe(Z,qe,he,ce,Ge,oe,We);for(var pt=0;pt<ce;pt++)fe(Z,pt*he,1,he,Ge,oe,We)}function fe(Z,he,ce,Ge,oe,We,qe){var pt,vt,bt,Et;for(We[0]=0,qe[0]=-re,qe[1]=re,pt=0;pt<Ge;pt++)oe[pt]=Z[he+pt*ce];for(pt=1,vt=0,bt=0;pt<Ge;pt++){do Et=We[vt],bt=(oe[pt]-oe[Et]+pt*pt-Et*Et)/(pt-Et)/2;while(bt<=qe[vt]&&--vt>-1);vt++,We[vt]=pt,qe[vt]=bt,qe[vt+1]=re}for(pt=0,vt=0;pt<Ge;pt++){for(;qe[vt+1]<pt;)vt++;Et=We[vt],Z[he+pt*ce]=oe[Et]+(pt-Et)*(pt-Et)}}},99996:function(Qt,re,U){Qt.exports.VectorTile=U(14253),U(35752),U(143)},14253:function(Qt,re,U){"use strict";var ee=U(143);Qt.exports=ve;function ve(fe,Z){this.layers=fe.readFields(_,{},Z)}function _(fe,Z,he){if(fe===3){var ce=new ee(he,he.readVarint()+he.pos);ce.length&&(Z[ce.name]=ce)}}},35752:function(Qt,re,U){"use strict";var ee=U(96542);Qt.exports=ve;function ve(ce,Ge,oe,We,qe){this.properties={},this.extent=oe,this.type=0,this._pbf=ce,this._geometry=-1,this._keys=We,this._values=qe,ce.readFields(_,this,Ge)}function _(ce,Ge,oe){ce==1?Ge.id=oe.readVarint():ce==2?fe(oe,Ge):ce==3?Ge.type=oe.readVarint():ce==4&&(Ge._geometry=oe.pos)}function fe(ce,Ge){for(var oe=ce.readVarint()+ce.pos;ce.pos<oe;){var We=Ge._keys[ce.readVarint()],qe=Ge._values[ce.readVarint()];Ge.properties[We]=qe}}ve.types=["Unknown","Point","LineString","Polygon"],ve.prototype.loadGeometry=function(){var ce=this._pbf;ce.pos=this._geometry;for(var Ge=ce.readVarint()+ce.pos,oe=1,We=0,qe=0,pt=0,vt=[],bt;ce.pos<Ge;){if(We<=0){var Et=ce.readVarint();oe=Et&7,We=Et>>3}if(We--,oe===1||oe===2)qe+=ce.readSVarint(),pt+=ce.readSVarint(),oe===1&&(bt&&vt.push(bt),bt=[]),bt.push(new ee(qe,pt));else if(oe===7)bt&&bt.push(bt[0].clone());else throw new Error("unknown command "+oe)}return bt&&vt.push(bt),vt},ve.prototype.bbox=function(){var ce=this._pbf;ce.pos=this._geometry;for(var Ge=ce.readVarint()+ce.pos,oe=1,We=0,qe=0,pt=0,vt=1/0,bt=-1/0,Et=1/0,Dt=-1/0;ce.pos<Ge;){if(We<=0){var wt=ce.readVarint();oe=wt&7,We=wt>>3}if(We--,oe===1||oe===2)qe+=ce.readSVarint(),pt+=ce.readSVarint(),qe<vt&&(vt=qe),qe>bt&&(bt=qe),pt<Et&&(Et=pt),pt>Dt&&(Dt=pt);else if(oe!==7)throw new Error("unknown command "+oe)}return[vt,Et,bt,Dt]},ve.prototype.toGeoJSON=function(ce,Ge,oe){var We=this.extent*Math.pow(2,oe),qe=this.extent*ce,pt=this.extent*Ge,vt=this.loadGeometry(),bt=ve.types[this.type],Et,Dt;function wt(wr){for(var pr=0;pr<wr.length;pr++){var lr=wr[pr],Ot=180-(lr.y+pt)*360/We;wr[pr]=[(lr.x+qe)*360/We-180,360/Math.PI*Math.atan(Math.exp(Ot*Math.PI/180))-90]}}switch(this.type){case 1:var at=[];for(Et=0;Et<vt.length;Et++)at[Et]=vt[Et][0];vt=at,wt(vt);break;case 2:for(Et=0;Et<vt.length;Et++)wt(vt[Et]);break;case 3:for(vt=Z(vt),Et=0;Et<vt.length;Et++)for(Dt=0;Dt<vt[Et].length;Dt++)wt(vt[Et][Dt]);break}vt.length===1?vt=vt[0]:bt="Multi"+bt;var Tt={type:"Feature",geometry:{type:bt,coordinates:vt},properties:this.properties};return"id"in this&&(Tt.id=this.id),Tt};function Z(ce){var Ge=ce.length;if(Ge<=1)return[ce];for(var oe=[],We,qe,pt=0;pt<Ge;pt++){var vt=he(ce[pt]);vt!==0&&(qe===void 0&&(qe=vt<0),qe===vt<0?(We&&oe.push(We),We=[ce[pt]]):We.push(ce[pt]))}return We&&oe.push(We),oe}function he(ce){for(var Ge=0,oe=0,We=ce.length,qe=We-1,pt,vt;oe<We;qe=oe++)pt=ce[oe],vt=ce[qe],Ge+=(vt.x-pt.x)*(pt.y+vt.y);return Ge}},143:function(Qt,re,U){"use strict";var ee=U(35752);Qt.exports=ve;function ve(Z,he){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=Z,this._keys=[],this._values=[],this._features=[],Z.readFields(_,this,he),this.length=this._features.length}function _(Z,he,ce){Z===15?he.version=ce.readVarint():Z===1?he.name=ce.readString():Z===5?he.extent=ce.readVarint():Z===2?he._features.push(ce.pos):Z===3?he._keys.push(ce.readString()):Z===4&&he._values.push(fe(ce))}function fe(Z){for(var he=null,ce=Z.readVarint()+Z.pos;Z.pos<ce;){var Ge=Z.readVarint()>>3;he=Ge===1?Z.readString():Ge===2?Z.readFloat():Ge===3?Z.readDouble():Ge===4?Z.readVarint64():Ge===5?Z.readVarint():Ge===6?Z.readSVarint():Ge===7?Z.readBoolean():null}return he}ve.prototype.feature=function(Z){if(Z<0||Z>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[Z];var he=this._pbf.readVarint()+this._pbf.pos;return new ee(this._pbf,he,this.extent,this._keys,this._values)}},53725:function(Qt,re,U){"use strict";U.d(re,{Z:function(){return ve}});var ee=U(50959);function ve(){const[,_]=ee.useReducer(fe=>fe+1,0);return _}},54814:function(Qt,re,U){"use strict";U.d(re,{ZP:function(){return he},c4:function(){return _},m9:function(){return ce}});var ee=U(50959),ve=U(62966);const _=["xxl","xl","lg","md","sm","xs"],fe=Ge=>({xs:`(max-width: ${Ge.screenXSMax}px)`,sm:`(min-width: ${Ge.screenSM}px)`,md:`(min-width: ${Ge.screenMD}px)`,lg:`(min-width: ${Ge.screenLG}px)`,xl:`(min-width: ${Ge.screenXL}px)`,xxl:`(min-width: ${Ge.screenXXL}px)`}),Z=Ge=>{const oe=Ge,We=[].concat(_).reverse();return We.forEach((qe,pt)=>{const vt=qe.toUpperCase(),bt=`screen${vt}Min`,Et=`screen${vt}`;if(!(oe[bt]<=oe[Et]))throw new Error(`${bt}<=${Et} fails : !(${oe[bt]}<=${oe[Et]})`);if(pt<We.length-1){const Dt=`screen${vt}Max`;if(!(oe[Et]<=oe[Dt]))throw new Error(`${Et}<=${Dt} fails : !(${oe[Et]}<=${oe[Dt]})`);const at=`screen${We[pt+1].toUpperCase()}Min`;if(!(oe[Dt]<=oe[at]))throw new Error(`${Dt}<=${at} fails : !(${oe[Dt]}<=${oe[at]})`)}}),Ge};function he(){const[,Ge]=(0,ve.ZP)(),oe=fe(Z(Ge));return ee.useMemo(()=>{const We=new Map;let qe=-1,pt={};return{matchHandlers:{},dispatch(vt){return pt=vt,We.forEach(bt=>bt(pt)),We.size>=1},subscribe(vt){return We.size||this.register(),qe+=1,We.set(qe,vt),vt(pt),qe},unsubscribe(vt){We.delete(vt),We.size||this.unregister()},unregister(){Object.keys(oe).forEach(vt=>{const bt=oe[vt],Et=this.matchHandlers[bt];Et==null||Et.mql.removeListener(Et==null?void 0:Et.listener)}),We.clear()},register(){Object.keys(oe).forEach(vt=>{const bt=oe[vt],Et=wt=>{let{matches:at}=wt;this.dispatch(Object.assign(Object.assign({},pt),{[vt]:at}))},Dt=window.matchMedia(bt);Dt.addListener(Et),this.matchHandlers[bt]={mql:Dt,listener:Et},Et(Dt)})},responsiveMap:oe}},[Ge])}const ce=(Ge,oe)=>{if(oe&&typeof oe=="object")for(let We=0;We<_.length;We++){const qe=_[We];if(Ge[qe]&&oe[qe]!==void 0)return oe[qe]}}},87980:function(Qt,re,U){"use strict";var ee=U(3352);re.Z=ee.Z},84605:function(Qt,re,U){"use strict";var ee=U(50959);const ve=(0,ee.createContext)({});re.Z=ve},3352:function(Qt,re,U){"use strict";var ee=U(50959),ve=U(82187),_=U.n(ve),fe=U(76144),Z=U(84605),he=U(21941),ce=function(qe,pt){var vt={};for(var bt in qe)Object.prototype.hasOwnProperty.call(qe,bt)&&pt.indexOf(bt)<0&&(vt[bt]=qe[bt]);if(qe!=null&&typeof Object.getOwnPropertySymbols=="function")for(var Et=0,bt=Object.getOwnPropertySymbols(qe);Et<bt.length;Et++)pt.indexOf(bt[Et])<0&&Object.prototype.propertyIsEnumerable.call(qe,bt[Et])&&(vt[bt[Et]]=qe[bt[Et]]);return vt};function Ge(qe){return typeof qe=="number"?`${qe} ${qe} auto`:/^\d+(\.\d+)?(px|em|rem|%)$/.test(qe)?`0 0 ${qe}`:qe}const oe=["xs","sm","md","lg","xl","xxl"],We=ee.forwardRef((qe,pt)=>{const{getPrefixCls:vt,direction:bt}=ee.useContext(fe.E_),{gutter:Et,wrap:Dt}=ee.useContext(Z.Z),{prefixCls:wt,span:at,order:Tt,offset:wr,push:pr,pull:lr,className:Ot,children:ht,flex:Ft,style:Qe}=qe,Nt=ce(qe,["prefixCls","span","order","offset","push","pull","className","children","flex","style"]),sr=vt("col",wt),[ie,W,te]=(0,he.cG)(sr);let Oe={};oe.forEach(De=>{let Ze={};const Ke=qe[De];typeof Ke=="number"?Ze.span=Ke:typeof Ke=="object"&&(Ze=Ke||{}),delete Nt[De],Oe=Object.assign(Object.assign({},Oe),{[`${sr}-${De}-${Ze.span}`]:Ze.span!==void 0,[`${sr}-${De}-order-${Ze.order}`]:Ze.order||Ze.order===0,[`${sr}-${De}-offset-${Ze.offset}`]:Ze.offset||Ze.offset===0,[`${sr}-${De}-push-${Ze.push}`]:Ze.push||Ze.push===0,[`${sr}-${De}-pull-${Ze.pull}`]:Ze.pull||Ze.pull===0,[`${sr}-${De}-flex-${Ze.flex}`]:Ze.flex||Ze.flex==="auto",[`${sr}-rtl`]:bt==="rtl"})});const Te=_()(sr,{[`${sr}-${at}`]:at!==void 0,[`${sr}-order-${Tt}`]:Tt,[`${sr}-offset-${wr}`]:wr,[`${sr}-push-${pr}`]:pr,[`${sr}-pull-${lr}`]:lr},Ot,Oe,W,te),nt={};if(Et&&Et[0]>0){const De=Et[0]/2;nt.paddingLeft=De,nt.paddingRight=De}return Ft&&(nt.flex=Ge(Ft),Dt===!1&&!nt.minWidth&&(nt.minWidth=0)),ie(ee.createElement("div",Object.assign({},Nt,{style:Object.assign(Object.assign({},nt),Qe),className:Te,ref:pt}),ht))});re.Z=We},3625:function(Qt,re,U){"use strict";var ee=U(50959),ve=U(82187),_=U.n(ve),fe=U(54814),Z=U(76144),he=U(84605),ce=U(21941),Ge=function(vt,bt){var Et={};for(var Dt in vt)Object.prototype.hasOwnProperty.call(vt,Dt)&&bt.indexOf(Dt)<0&&(Et[Dt]=vt[Dt]);if(vt!=null&&typeof Object.getOwnPropertySymbols=="function")for(var wt=0,Dt=Object.getOwnPropertySymbols(vt);wt<Dt.length;wt++)bt.indexOf(Dt[wt])<0&&Object.prototype.propertyIsEnumerable.call(vt,Dt[wt])&&(Et[Dt[wt]]=vt[Dt[wt]]);return Et};const oe=null,We=null;function qe(vt,bt){const[Et,Dt]=ee.useState(typeof vt=="string"?vt:""),wt=()=>{if(typeof vt=="string"&&Dt(vt),typeof vt=="object")for(let at=0;at<fe.c4.length;at++){const Tt=fe.c4[at];if(!bt[Tt])continue;const wr=vt[Tt];if(wr!==void 0){Dt(wr);return}}};return ee.useEffect(()=>{wt()},[JSON.stringify(vt),bt]),Et}const pt=ee.forwardRef((vt,bt)=>{const{prefixCls:Et,justify:Dt,align:wt,className:at,style:Tt,children:wr,gutter:pr=0,wrap:lr}=vt,Ot=Ge(vt,["prefixCls","justify","align","className","style","children","gutter","wrap"]),{getPrefixCls:ht,direction:Ft}=ee.useContext(Z.E_),[Qe,Nt]=ee.useState({xs:!0,sm:!0,md:!0,lg:!0,xl:!0,xxl:!0}),[sr,ie]=ee.useState({xs:!1,sm:!1,md:!1,lg:!1,xl:!1,xxl:!1}),W=qe(wt,sr),te=qe(Dt,sr),Oe=ee.useRef(pr),Te=(0,fe.ZP)();ee.useEffect(()=>{const Jr=Te.subscribe(bi=>{ie(bi);const Gn=Oe.current||0;(!Array.isArray(Gn)&&typeof Gn=="object"||Array.isArray(Gn)&&(typeof Gn[0]=="object"||typeof Gn[1]=="object"))&&Nt(bi)});return()=>Te.unsubscribe(Jr)},[]);const nt=()=>{const Jr=[void 0,void 0];return(Array.isArray(pr)?pr:[pr,void 0]).forEach((Gn,zi)=>{if(typeof Gn=="object")for(let bn=0;bn<fe.c4.length;bn++){const Pn=fe.c4[bn];if(Qe[Pn]&&Gn[Pn]!==void 0){Jr[zi]=Gn[Pn];break}}else Jr[zi]=Gn}),Jr},De=ht("row",Et),[Ze,Ke,At]=(0,ce.VM)(De),dr=nt(),Pt=_()(De,{[`${De}-no-wrap`]:lr===!1,[`${De}-${te}`]:te,[`${De}-${W}`]:W,[`${De}-rtl`]:Ft==="rtl"},at,Ke,At),fn={},cn=dr[0]!=null&&dr[0]>0?dr[0]/-2:void 0;cn&&(fn.marginLeft=cn,fn.marginRight=cn),[,fn.rowGap]=dr;const[Lr,Fn]=dr,Sn=ee.useMemo(()=>({gutter:[Lr,Fn],wrap:lr}),[Lr,Fn,lr]);return Ze(ee.createElement(he.Z.Provider,{value:Sn},ee.createElement("div",Object.assign({},Ot,{className:Pt,style:Object.assign(Object.assign({},fn),Tt),ref:bt}),wr)))});re.Z=pt},21941:function(Qt,re,U){"use strict";U.d(re,{VM:function(){return qe},cG:function(){return pt}});var ee=U(601),ve=U(79349),_=U(56352);const fe=vt=>{const{componentCls:bt}=vt;return{[bt]:{display:"flex",flexFlow:"row wrap",minWidth:0,"&::before, &::after":{display:"flex"},"&-no-wrap":{flexWrap:"nowrap"},"&-start":{justifyContent:"flex-start"},"&-center":{justifyContent:"center"},"&-end":{justifyContent:"flex-end"},"&-space-between":{justifyContent:"space-between"},"&-space-around":{justifyContent:"space-around"},"&-space-evenly":{justifyContent:"space-evenly"},"&-top":{alignItems:"flex-start"},"&-middle":{alignItems:"center"},"&-bottom":{alignItems:"flex-end"}}}},Z=vt=>{const{componentCls:bt}=vt;return{[bt]:{position:"relative",maxWidth:"100%",minHeight:1}}},he=(vt,bt)=>{const{componentCls:Et,gridColumns:Dt}=vt,wt={};for(let at=Dt;at>=0;at--)at===0?(wt[`${Et}${bt}-${at}`]={display:"none"},wt[`${Et}-push-${at}`]={insetInlineStart:"auto"},wt[`${Et}-pull-${at}`]={insetInlineEnd:"auto"},wt[`${Et}${bt}-push-${at}`]={insetInlineStart:"auto"},wt[`${Et}${bt}-pull-${at}`]={insetInlineEnd:"auto"},wt[`${Et}${bt}-offset-${at}`]={marginInlineStart:0},wt[`${Et}${bt}-order-${at}`]={order:0}):(wt[`${Et}${bt}-${at}`]=[{["--ant-display"]:"block",display:"block"},{display:"var(--ant-display)",flex:`0 0 ${at/Dt*100}%`,maxWidth:`${at/Dt*100}%`}],wt[`${Et}${bt}-push-${at}`]={insetInlineStart:`${at/Dt*100}%`},wt[`${Et}${bt}-pull-${at}`]={insetInlineEnd:`${at/Dt*100}%`},wt[`${Et}${bt}-offset-${at}`]={marginInlineStart:`${at/Dt*100}%`},wt[`${Et}${bt}-order-${at}`]={order:at});return wt},ce=(vt,bt)=>he(vt,bt),Ge=(vt,bt,Et)=>({[`@media (min-width: ${(0,ee.bf)(bt)})`]:Object.assign({},ce(vt,Et))}),oe=()=>({}),We=()=>({}),qe=(0,ve.I$)("Grid",fe,oe),pt=(0,ve.I$)("Grid",vt=>{const bt=(0,_.TS)(vt,{gridColumns:24}),Et={"-sm":bt.screenSMMin,"-md":bt.screenMDMin,"-lg":bt.screenLGMin,"-xl":bt.screenXLMin,"-xxl":bt.screenXXLMin};return[Z(bt),ce(bt,""),ce(bt,"-xs"),Object.keys(Et).map(Dt=>Ge(bt,Et[Dt],Dt)).reduce((Dt,wt)=>Object.assign(Object.assign({},Dt),wt),{})]},We)},14417:function(Qt,re,U){"use strict";var ee=U(3625);re.Z=ee.Z},57385:function(Qt,re,U){"use strict";U.d(re,{Z:function(){return Ft}});var ee=U(50959),ve=U(53725),_=U(11493),fe=U(82187),Z=U.n(fe),he=U(76144),ce=U(66027),oe=Qe=>{const{value:Nt,formatter:sr,precision:ie,decimalSeparator:W,groupSeparator:te="",prefixCls:Oe}=Qe;let Te;if(typeof sr=="function")Te=sr(Nt);else{const nt=String(Nt),De=nt.match(/^(-?)(\d*)(\.(\d+))?$/);if(!De||nt==="-")Te=nt;else{const Ze=De[1];let Ke=De[2]||"0",At=De[4]||"";Ke=Ke.replace(/\B(?=(\d{3})+(?!\d))/g,te),typeof ie=="number"&&(At=At.padEnd(ie,"0").slice(0,ie>0?ie:0)),At&&(At=`${W}${At}`),Te=[ee.createElement("span",{key:"int",className:`${Oe}-content-value-int`},Ze,Ke),At&&ee.createElement("span",{key:"decimal",className:`${Oe}-content-value-decimal`},At)]}}return ee.createElement("span",{className:`${Oe}-content-value`},Te)},We=U(54531),qe=U(79349),pt=U(56352);const vt=Qe=>{const{componentCls:Nt,marginXXS:sr,padding:ie,colorTextDescription:W,titleFontSize:te,colorTextHeading:Oe,contentFontSize:Te,fontFamily:nt}=Qe;return{[`${Nt}`]:Object.assign(Object.assign({},(0,We.Wf)(Qe)),{[`${Nt}-title`]:{marginBottom:sr,color:W,fontSize:te},[`${Nt}-skeleton`]:{paddingTop:ie},[`${Nt}-content`]:{color:Oe,fontSize:Te,fontFamily:nt,[`${Nt}-content-value`]:{display:"inline-block",direction:"ltr"},[`${Nt}-content-prefix, ${Nt}-content-suffix`]:{display:"inline-block"},[`${Nt}-content-prefix`]:{marginInlineEnd:sr},[`${Nt}-content-suffix`]:{marginInlineStart:sr}}})}},bt=Qe=>{const{fontSizeHeading3:Nt,fontSize:sr}=Qe;return{titleFontSize:sr,contentFontSize:Nt}};var Et=(0,qe.I$)("Statistic",Qe=>{const Nt=(0,pt.TS)(Qe,{});return[vt(Nt)]},bt),wt=Qe=>{const{prefixCls:Nt,className:sr,rootClassName:ie,style:W,valueStyle:te,value:Oe=0,title:Te,valueRender:nt,prefix:De,suffix:Ze,loading:Ke=!1,onMouseEnter:At,onMouseLeave:dr,decimalSeparator:Pt=".",groupSeparator:fn=","}=Qe,{getPrefixCls:cn,direction:Lr,statistic:Fn}=ee.useContext(he.E_),Sn=cn("statistic",Nt),[Jr,bi,Gn]=Et(Sn),zi=ee.createElement(oe,Object.assign({decimalSeparator:Pt,groupSeparator:fn,prefixCls:Sn},Qe,{value:Oe})),bn=Z()(Sn,{[`${Sn}-rtl`]:Lr==="rtl"},Fn==null?void 0:Fn.className,sr,ie,bi,Gn);return Jr(ee.createElement("div",{className:bn,style:Object.assign(Object.assign({},Fn==null?void 0:Fn.style),W),onMouseEnter:At,onMouseLeave:dr},Te&&ee.createElement("div",{className:`${Sn}-title`},Te),ee.createElement(ce.Z,{paragraph:!1,loading:Ke,className:`${Sn}-skeleton`},ee.createElement("div",{style:te,className:`${Sn}-content`},De&&ee.createElement("span",{className:`${Sn}-content-prefix`},De),nt?nt(zi):zi,Ze&&ee.createElement("span",{className:`${Sn}-content-suffix`},Ze)))))};const at=[["Y",1e3*60*60*24*365],["M",1e3*60*60*24*30],["D",1e3*60*60*24],["H",1e3*60*60],["m",1e3*60],["s",1e3],["S",1]];function Tt(Qe,Nt){let sr=Qe;const ie=/\[[^\]]*]/g,W=(Nt.match(ie)||[]).map(nt=>nt.slice(1,-1)),te=Nt.replace(ie,"[]"),Oe=at.reduce((nt,De)=>{let[Ze,Ke]=De;if(nt.includes(Ze)){const At=Math.floor(sr/Ke);return sr-=At*Ke,nt.replace(new RegExp(`${Ze}+`,"g"),dr=>{const Pt=dr.length;return At.toString().padStart(Pt,"0")})}return nt},te);let Te=0;return Oe.replace(ie,()=>{const nt=W[Te];return Te+=1,nt})}function wr(Qe,Nt){const{format:sr=""}=Nt,ie=new Date(Qe).getTime(),W=Date.now(),te=Math.max(ie-W,0);return Tt(te,sr)}const pr=1e3/30;function lr(Qe){return new Date(Qe).getTime()}const Ot=Qe=>{const{value:Nt,format:sr="HH:mm:ss",onChange:ie,onFinish:W}=Qe,te=(0,ve.Z)(),Oe=ee.useRef(null),Te=()=>{W==null||W(),Oe.current&&(clearInterval(Oe.current),Oe.current=null)},nt=()=>{const Ke=lr(Nt);Ke>=Date.now()&&(Oe.current=setInterval(()=>{te(),ie==null||ie(Ke-Date.now()),Ke<Date.now()&&Te()},pr))};ee.useEffect(()=>(nt(),()=>{Oe.current&&(clearInterval(Oe.current),Oe.current=null)}),[Nt]);const De=(Ke,At)=>wr(Ke,Object.assign(Object.assign({},At),{format:sr})),Ze=Ke=>(0,_.Tm)(Ke,{title:void 0});return ee.createElement(wt,Object.assign({},Qe,{valueRender:Ze,formatter:De}))};var ht=ee.memo(Ot);wt.Countdown=ht;var Ft=wt},75734:function(Qt){"use strict";Qt.exports=re,Qt.exports.default=re;function re(te,Oe,Te){Te=Te||2;var nt=Oe&&Oe.length,De=nt?Oe[0]*Te:te.length,Ze=U(te,0,De,Te,!0),Ke=[];if(!Ze||Ze.next===Ze.prev)return Ke;var At,dr,Pt,fn,cn,Lr,Fn;if(nt&&(Ze=ce(te,Oe,Ze,Te)),te.length>80*Te){At=Pt=te[0],dr=fn=te[1];for(var Sn=Te;Sn<De;Sn+=Te)cn=te[Sn],Lr=te[Sn+1],cn<At&&(At=cn),Lr<dr&&(dr=Lr),cn>Pt&&(Pt=cn),Lr>fn&&(fn=Lr);Fn=Math.max(Pt-At,fn-dr),Fn=Fn!==0?32767/Fn:0}return ve(Ze,Ke,Te,At,dr,Fn,0),Ke}function U(te,Oe,Te,nt,De){var Ze,Ke;if(De===W(te,Oe,Te,nt)>0)for(Ze=Oe;Ze<Te;Ze+=nt)Ke=Nt(Ze,te[Ze],te[Ze+1],Ke);else for(Ze=Te-nt;Ze>=Oe;Ze-=nt)Ke=Nt(Ze,te[Ze],te[Ze+1],Ke);return Ke&&Tt(Ke,Ke.next)&&(sr(Ke),Ke=Ke.next),Ke}function ee(te,Oe){if(!te)return te;Oe||(Oe=te);var Te=te,nt;do if(nt=!1,!Te.steiner&&(Tt(Te,Te.next)||at(Te.prev,Te,Te.next)===0)){if(sr(Te),Te=Oe=Te.prev,Te===Te.next)break;nt=!0}else Te=Te.next;while(nt||Te!==Oe);return Oe}function ve(te,Oe,Te,nt,De,Ze,Ke){if(te){!Ke&&Ze&&pt(te,nt,De,Ze);for(var At=te,dr,Pt;te.prev!==te.next;){if(dr=te.prev,Pt=te.next,Ze?fe(te,nt,De,Ze):_(te)){Oe.push(dr.i/Te|0),Oe.push(te.i/Te|0),Oe.push(Pt.i/Te|0),sr(te),te=Pt.next,At=Pt.next;continue}if(te=Pt,te===At){Ke?Ke===1?(te=Z(ee(te),Oe,Te),ve(te,Oe,Te,nt,De,Ze,2)):Ke===2&&he(te,Oe,Te,nt,De,Ze):ve(ee(te),Oe,Te,nt,De,Ze,1);break}}}}function _(te){var Oe=te.prev,Te=te,nt=te.next;if(at(Oe,Te,nt)>=0)return!1;for(var De=Oe.x,Ze=Te.x,Ke=nt.x,At=Oe.y,dr=Te.y,Pt=nt.y,fn=De<Ze?De<Ke?De:Ke:Ze<Ke?Ze:Ke,cn=At<dr?At<Pt?At:Pt:dr<Pt?dr:Pt,Lr=De>Ze?De>Ke?De:Ke:Ze>Ke?Ze:Ke,Fn=At>dr?At>Pt?At:Pt:dr>Pt?dr:Pt,Sn=nt.next;Sn!==Oe;){if(Sn.x>=fn&&Sn.x<=Lr&&Sn.y>=cn&&Sn.y<=Fn&&Dt(De,At,Ze,dr,Ke,Pt,Sn.x,Sn.y)&&at(Sn.prev,Sn,Sn.next)>=0)return!1;Sn=Sn.next}return!0}function fe(te,Oe,Te,nt){var De=te.prev,Ze=te,Ke=te.next;if(at(De,Ze,Ke)>=0)return!1;for(var At=De.x,dr=Ze.x,Pt=Ke.x,fn=De.y,cn=Ze.y,Lr=Ke.y,Fn=At<dr?At<Pt?At:Pt:dr<Pt?dr:Pt,Sn=fn<cn?fn<Lr?fn:Lr:cn<Lr?cn:Lr,Jr=At>dr?At>Pt?At:Pt:dr>Pt?dr:Pt,bi=fn>cn?fn>Lr?fn:Lr:cn>Lr?cn:Lr,Gn=bt(Fn,Sn,Oe,Te,nt),zi=bt(Jr,bi,Oe,Te,nt),bn=te.prevZ,Pn=te.nextZ;bn&&bn.z>=Gn&&Pn&&Pn.z<=zi;){if(bn.x>=Fn&&bn.x<=Jr&&bn.y>=Sn&&bn.y<=bi&&bn!==De&&bn!==Ke&&Dt(At,fn,dr,cn,Pt,Lr,bn.x,bn.y)&&at(bn.prev,bn,bn.next)>=0||(bn=bn.prevZ,Pn.x>=Fn&&Pn.x<=Jr&&Pn.y>=Sn&&Pn.y<=bi&&Pn!==De&&Pn!==Ke&&Dt(At,fn,dr,cn,Pt,Lr,Pn.x,Pn.y)&&at(Pn.prev,Pn,Pn.next)>=0))return!1;Pn=Pn.nextZ}for(;bn&&bn.z>=Gn;){if(bn.x>=Fn&&bn.x<=Jr&&bn.y>=Sn&&bn.y<=bi&&bn!==De&&bn!==Ke&&Dt(At,fn,dr,cn,Pt,Lr,bn.x,bn.y)&&at(bn.prev,bn,bn.next)>=0)return!1;bn=bn.prevZ}for(;Pn&&Pn.z<=zi;){if(Pn.x>=Fn&&Pn.x<=Jr&&Pn.y>=Sn&&Pn.y<=bi&&Pn!==De&&Pn!==Ke&&Dt(At,fn,dr,cn,Pt,Lr,Pn.x,Pn.y)&&at(Pn.prev,Pn,Pn.next)>=0)return!1;Pn=Pn.nextZ}return!0}function Z(te,Oe,Te){var nt=te;do{var De=nt.prev,Ze=nt.next.next;!Tt(De,Ze)&&wr(De,nt,nt.next,Ze)&&ht(De,Ze)&&ht(Ze,De)&&(Oe.push(De.i/Te|0),Oe.push(nt.i/Te|0),Oe.push(Ze.i/Te|0),sr(nt),sr(nt.next),nt=te=Ze),nt=nt.next}while(nt!==te);return ee(nt)}function he(te,Oe,Te,nt,De,Ze){var Ke=te;do{for(var At=Ke.next.next;At!==Ke.prev;){if(Ke.i!==At.i&&wt(Ke,At)){var dr=Qe(Ke,At);Ke=ee(Ke,Ke.next),dr=ee(dr,dr.next),ve(Ke,Oe,Te,nt,De,Ze,0),ve(dr,Oe,Te,nt,De,Ze,0);return}At=At.next}Ke=Ke.next}while(Ke!==te)}function ce(te,Oe,Te,nt){var De=[],Ze,Ke,At,dr,Pt;for(Ze=0,Ke=Oe.length;Ze<Ke;Ze++)At=Oe[Ze]*nt,dr=Ze<Ke-1?Oe[Ze+1]*nt:te.length,Pt=U(te,At,dr,nt,!1),Pt===Pt.next&&(Pt.steiner=!0),De.push(Et(Pt));for(De.sort(Ge),Ze=0;Ze<De.length;Ze++)Te=oe(De[Ze],Te);return Te}function Ge(te,Oe){return te.x-Oe.x}function oe(te,Oe){var Te=We(te,Oe);if(!Te)return Oe;var nt=Qe(Te,te);return ee(nt,nt.next),ee(Te,Te.next)}function We(te,Oe){var Te=Oe,nt=te.x,De=te.y,Ze=-1/0,Ke;do{if(De<=Te.y&&De>=Te.next.y&&Te.next.y!==Te.y){var At=Te.x+(De-Te.y)*(Te.next.x-Te.x)/(Te.next.y-Te.y);if(At<=nt&&At>Ze&&(Ze=At,Ke=Te.x<Te.next.x?Te:Te.next,At===nt))return Ke}Te=Te.next}while(Te!==Oe);if(!Ke)return null;var dr=Ke,Pt=Ke.x,fn=Ke.y,cn=1/0,Lr;Te=Ke;do nt>=Te.x&&Te.x>=Pt&&nt!==Te.x&&Dt(De<fn?nt:Ze,De,Pt,fn,De<fn?Ze:nt,De,Te.x,Te.y)&&(Lr=Math.abs(De-Te.y)/(nt-Te.x),ht(Te,te)&&(Lr<cn||Lr===cn&&(Te.x>Ke.x||Te.x===Ke.x&&qe(Ke,Te)))&&(Ke=Te,cn=Lr)),Te=Te.next;while(Te!==dr);return Ke}function qe(te,Oe){return at(te.prev,te,Oe.prev)<0&&at(Oe.next,te,te.next)<0}function pt(te,Oe,Te,nt){var De=te;do De.z===0&&(De.z=bt(De.x,De.y,Oe,Te,nt)),De.prevZ=De.prev,De.nextZ=De.next,De=De.next;while(De!==te);De.prevZ.nextZ=null,De.prevZ=null,vt(De)}function vt(te){var Oe,Te,nt,De,Ze,Ke,At,dr,Pt=1;do{for(Te=te,te=null,Ze=null,Ke=0;Te;){for(Ke++,nt=Te,At=0,Oe=0;Oe<Pt&&(At++,nt=nt.nextZ,!!nt);Oe++);for(dr=Pt;At>0||dr>0&&nt;)At!==0&&(dr===0||!nt||Te.z<=nt.z)?(De=Te,Te=Te.nextZ,At--):(De=nt,nt=nt.nextZ,dr--),Ze?Ze.nextZ=De:te=De,De.prevZ=Ze,Ze=De;Te=nt}Ze.nextZ=null,Pt*=2}while(Ke>1);return te}function bt(te,Oe,Te,nt,De){return te=(te-Te)*De|0,Oe=(Oe-nt)*De|0,te=(te|te<<8)&16711935,te=(te|te<<4)&252645135,te=(te|te<<2)&858993459,te=(te|te<<1)&1431655765,Oe=(Oe|Oe<<8)&16711935,Oe=(Oe|Oe<<4)&252645135,Oe=(Oe|Oe<<2)&858993459,Oe=(Oe|Oe<<1)&1431655765,te|Oe<<1}function Et(te){var Oe=te,Te=te;do(Oe.x<Te.x||Oe.x===Te.x&&Oe.y<Te.y)&&(Te=Oe),Oe=Oe.next;while(Oe!==te);return Te}function Dt(te,Oe,Te,nt,De,Ze,Ke,At){return(De-Ke)*(Oe-At)>=(te-Ke)*(Ze-At)&&(te-Ke)*(nt-At)>=(Te-Ke)*(Oe-At)&&(Te-Ke)*(Ze-At)>=(De-Ke)*(nt-At)}function wt(te,Oe){return te.next.i!==Oe.i&&te.prev.i!==Oe.i&&!Ot(te,Oe)&&(ht(te,Oe)&&ht(Oe,te)&&Ft(te,Oe)&&(at(te.prev,te,Oe.prev)||at(te,Oe.prev,Oe))||Tt(te,Oe)&&at(te.prev,te,te.next)>0&&at(Oe.prev,Oe,Oe.next)>0)}function at(te,Oe,Te){return(Oe.y-te.y)*(Te.x-Oe.x)-(Oe.x-te.x)*(Te.y-Oe.y)}function Tt(te,Oe){return te.x===Oe.x&&te.y===Oe.y}function wr(te,Oe,Te,nt){var De=lr(at(te,Oe,Te)),Ze=lr(at(te,Oe,nt)),Ke=lr(at(Te,nt,te)),At=lr(at(Te,nt,Oe));return!!(De!==Ze&&Ke!==At||De===0&&pr(te,Te,Oe)||Ze===0&&pr(te,nt,Oe)||Ke===0&&pr(Te,te,nt)||At===0&&pr(Te,Oe,nt))}function pr(te,Oe,Te){return Oe.x<=Math.max(te.x,Te.x)&&Oe.x>=Math.min(te.x,Te.x)&&Oe.y<=Math.max(te.y,Te.y)&&Oe.y>=Math.min(te.y,Te.y)}function lr(te){return te>0?1:te<0?-1:0}function Ot(te,Oe){var Te=te;do{if(Te.i!==te.i&&Te.next.i!==te.i&&Te.i!==Oe.i&&Te.next.i!==Oe.i&&wr(Te,Te.next,te,Oe))return!0;Te=Te.next}while(Te!==te);return!1}function ht(te,Oe){return at(te.prev,te,te.next)<0?at(te,Oe,te.next)>=0&&at(te,te.prev,Oe)>=0:at(te,Oe,te.prev)<0||at(te,te.next,Oe)<0}function Ft(te,Oe){var Te=te,nt=!1,De=(te.x+Oe.x)/2,Ze=(te.y+Oe.y)/2;do Te.y>Ze!=Te.next.y>Ze&&Te.next.y!==Te.y&&De<(Te.next.x-Te.x)*(Ze-Te.y)/(Te.next.y-Te.y)+Te.x&&(nt=!nt),Te=Te.next;while(Te!==te);return nt}function Qe(te,Oe){var Te=new ie(te.i,te.x,te.y),nt=new ie(Oe.i,Oe.x,Oe.y),De=te.next,Ze=Oe.prev;return te.next=Oe,Oe.prev=te,Te.next=De,De.prev=Te,nt.next=Te,Te.prev=nt,Ze.next=nt,nt.prev=Ze,nt}function Nt(te,Oe,Te,nt){var De=new ie(te,Oe,Te);return nt?(De.next=nt.next,De.prev=nt,nt.next.prev=De,nt.next=De):(De.prev=De,De.next=De),De}function sr(te){te.next.prev=te.prev,te.prev.next=te.next,te.prevZ&&(te.prevZ.nextZ=te.nextZ),te.nextZ&&(te.nextZ.prevZ=te.prevZ)}function ie(te,Oe,Te){this.i=te,this.x=Oe,this.y=Te,this.prev=null,this.next=null,this.z=0,this.prevZ=null,this.nextZ=null,this.steiner=!1}re.deviation=function(te,Oe,Te,nt){var De=Oe&&Oe.length,Ze=De?Oe[0]*Te:te.length,Ke=Math.abs(W(te,0,Ze,Te));if(De)for(var At=0,dr=Oe.length;At<dr;At++){var Pt=Oe[At]*Te,fn=At<dr-1?Oe[At+1]*Te:te.length;Ke-=Math.abs(W(te,Pt,fn,Te))}var cn=0;for(At=0;At<nt.length;At+=3){var Lr=nt[At]*Te,Fn=nt[At+1]*Te,Sn=nt[At+2]*Te;cn+=Math.abs((te[Lr]-te[Sn])*(te[Fn+1]-te[Lr+1])-(te[Lr]-te[Fn])*(te[Sn+1]-te[Lr+1]))}return Ke===0&&cn===0?0:Math.abs((cn-Ke)/Ke)};function W(te,Oe,Te,nt){for(var De=0,Ze=Oe,Ke=Te-nt;Ze<Te;Ze+=nt)De+=(te[Ke]-te[Ze])*(te[Ze+1]+te[Ke+1]),Ke=Ze;return De}re.flatten=function(te){for(var Oe=te[0][0].length,Te={vertices:[],holes:[],dimensions:Oe},nt=0,De=0;De<te.length;De++){for(var Ze=0;Ze<te[De].length;Ze++)for(var Ke=0;Ke<Oe;Ke++)Te.vertices.push(te[De][Ze][Ke]);De>0&&(nt+=te[De-1].length,Te.holes.push(nt))}return Te}},31204:function(Qt){function re(ee){var ve=ee.target||ee.srcElement;ve.__resizeRAF__&&cancelAnimationFrame(ve.__resizeRAF__),ve.__resizeRAF__=requestAnimationFrame(function(){var _=ve.__resizeTrigger__,fe=_&&_.__resizeListeners__;fe&&fe.forEach(function(Z){Z.call(_,ee)})})}var U=function(ve,_){var fe=this,Z=fe.document,he,ce=Z.attachEvent;typeof navigator!="undefined"&&(he=navigator.userAgent.match(/Trident/)||navigator.userAgent.match(/Edge/));function Ge(){this.contentDocument.defaultView.__resizeTrigger__=this.__resizeElement__,this.contentDocument.defaultView.addEventListener("resize",re)}if(!ve.__resizeListeners__)if(ve.__resizeListeners__=[],ce)ve.__resizeTrigger__=ve,ve.attachEvent("onresize",re);else{getComputedStyle(ve).position==="static"&&(ve.style.position="relative");var oe=ve.__resizeTrigger__=Z.createElement("object");oe.setAttribute("style","position: absolute; top: 0; left: 0; height: 100%; width: 100%; pointer-events: none; z-index: -1; opacity: 0;"),oe.setAttribute("class","resize-sensor"),oe.setAttribute("tabindex","-1"),oe.setAttribute("title",""),oe.__resizeElement__=ve,oe.onload=Ge,oe.type="text/html",he&&ve.appendChild(oe),oe.data="about:blank",he||ve.appendChild(oe)}ve.__resizeListeners__.push(_)};Qt.exports=typeof window=="undefined"?U:U.bind(window),Qt.exports.unbind=function(ee,ve){var _=document.attachEvent,fe=ee.__resizeListeners__||[];if(ve){var Z=fe.indexOf(ve);Z!==-1&&fe.splice(Z,1)}else fe=ee.__resizeListeners__=[];if(!fe.length){if(_)ee.detachEvent("onresize",re);else if(ee.__resizeTrigger__){var he=ee.__resizeTrigger__.contentDocument,ce=he&&he.defaultView;ce&&(ce.removeEventListener("resize",re),delete ce.__resizeTrigger__),ee.__resizeTrigger__=!ee.removeChild(ee.__resizeTrigger__)}delete ee.__resizeListeners__}}},11312:function(Qt){"use strict";var re=Object.prototype.hasOwnProperty,U="~";function ee(){}Object.create&&(ee.prototype=Object.create(null),new ee().__proto__||(U=!1));function ve(he,ce,Ge){this.fn=he,this.context=ce,this.once=Ge||!1}function _(he,ce,Ge,oe,We){if(typeof Ge!="function")throw new TypeError("The listener must be a function");var qe=new ve(Ge,oe||he,We),pt=U?U+ce:ce;return he._events[pt]?he._events[pt].fn?he._events[pt]=[he._events[pt],qe]:he._events[pt].push(qe):(he._events[pt]=qe,he._eventsCount++),he}function fe(he,ce){--he._eventsCount===0?he._events=new ee:delete he._events[ce]}function Z(){this._events=new ee,this._eventsCount=0}Z.prototype.eventNames=function(){var ce=[],Ge,oe;if(this._eventsCount===0)return ce;for(oe in Ge=this._events)re.call(Ge,oe)&&ce.push(U?oe.slice(1):oe);return Object.getOwnPropertySymbols?ce.concat(Object.getOwnPropertySymbols(Ge)):ce},Z.prototype.listeners=function(ce){var Ge=U?U+ce:ce,oe=this._events[Ge];if(!oe)return[];if(oe.fn)return[oe.fn];for(var We=0,qe=oe.length,pt=new Array(qe);We<qe;We++)pt[We]=oe[We].fn;return pt},Z.prototype.listenerCount=function(ce){var Ge=U?U+ce:ce,oe=this._events[Ge];return oe?oe.fn?1:oe.length:0},Z.prototype.emit=function(ce,Ge,oe,We,qe,pt){var vt=U?U+ce:ce;if(!this._events[vt])return!1;var bt=this._events[vt],Et=arguments.length,Dt,wt;if(bt.fn){switch(bt.once&&this.removeListener(ce,bt.fn,void 0,!0),Et){case 1:return bt.fn.call(bt.context),!0;case 2:return bt.fn.call(bt.context,Ge),!0;case 3:return bt.fn.call(bt.context,Ge,oe),!0;case 4:return bt.fn.call(bt.context,Ge,oe,We),!0;case 5:return bt.fn.call(bt.context,Ge,oe,We,qe),!0;case 6:return bt.fn.call(bt.context,Ge,oe,We,qe,pt),!0}for(wt=1,Dt=new Array(Et-1);wt<Et;wt++)Dt[wt-1]=arguments[wt];bt.fn.apply(bt.context,Dt)}else{var at=bt.length,Tt;for(wt=0;wt<at;wt++)switch(bt[wt].once&&this.removeListener(ce,bt[wt].fn,void 0,!0),Et){case 1:bt[wt].fn.call(bt[wt].context);break;case 2:bt[wt].fn.call(bt[wt].context,Ge);break;case 3:bt[wt].fn.call(bt[wt].context,Ge,oe);break;case 4:bt[wt].fn.call(bt[wt].context,Ge,oe,We);break;default:if(!Dt)for(Tt=1,Dt=new Array(Et-1);Tt<Et;Tt++)Dt[Tt-1]=arguments[Tt];bt[wt].fn.apply(bt[wt].context,Dt)}}return!0},Z.prototype.on=function(ce,Ge,oe){return _(this,ce,Ge,oe,!1)},Z.prototype.once=function(ce,Ge,oe){return _(this,ce,Ge,oe,!0)},Z.prototype.removeListener=function(ce,Ge,oe,We){var qe=U?U+ce:ce;if(!this._events[qe])return this;if(!Ge)return fe(this,qe),this;var pt=this._events[qe];if(pt.fn)pt.fn===Ge&&(!We||pt.once)&&(!oe||pt.context===oe)&&fe(this,qe);else{for(var vt=0,bt=[],Et=pt.length;vt<Et;vt++)(pt[vt].fn!==Ge||We&&!pt[vt].once||oe&&pt[vt].context!==oe)&&bt.push(pt[vt]);bt.length?this._events[qe]=bt.length===1?bt[0]:bt:fe(this,qe)}return this},Z.prototype.removeAllListeners=function(ce){var Ge;return ce?(Ge=U?U+ce:ce,this._events[Ge]&&fe(this,Ge)):(this._events=new ee,this._eventsCount=0),this},Z.prototype.off=Z.prototype.removeListener,Z.prototype.addListener=Z.prototype.on,Z.prefixed=U,Z.EventEmitter=Z,Qt.exports=Z},11553:function(Qt,re,U){var ee;(function(ve,_,fe,Z){"use strict";var he=["","webkit","Moz","MS","ms","o"],ce=_.createElement("div"),Ge="function",oe=Math.round,We=Math.abs,qe=Date.now;function pt(ge,Pe,_t){return setTimeout(wr(ge,_t),Pe)}function vt(ge,Pe,_t){return Array.isArray(ge)?(bt(ge,_t[Pe],_t),!0):!1}function bt(ge,Pe,_t){var cr;if(ge)if(ge.forEach)ge.forEach(Pe,_t);else if(ge.length!==Z)for(cr=0;cr<ge.length;)Pe.call(_t,ge[cr],cr,ge),cr++;else for(cr in ge)ge.hasOwnProperty(cr)&&Pe.call(_t,ge[cr],cr,ge)}function Et(ge,Pe,_t){var cr="DEPRECATED METHOD: "+Pe+`
`+_t+` AT 
`;return function(){var Kr=new Error("get-stack-trace"),kn=Kr&&Kr.stack?Kr.stack.replace(/^[^\(]+?[\n$]/gm,"").replace(/^\s+at\s+/gm,"").replace(/^Object.<anonymous>\s*\(/gm,"{anonymous}()@"):"Unknown Stack Trace",ji=ve.console&&(ve.console.warn||ve.console.log);return ji&&ji.call(ve.console,cr,kn),ge.apply(this,arguments)}}var Dt;typeof Object.assign!="function"?Dt=function(Pe){if(Pe===Z||Pe===null)throw new TypeError("Cannot convert undefined or null to object");for(var _t=Object(Pe),cr=1;cr<arguments.length;cr++){var Kr=arguments[cr];if(Kr!==Z&&Kr!==null)for(var kn in Kr)Kr.hasOwnProperty(kn)&&(_t[kn]=Kr[kn])}return _t}:Dt=Object.assign;var wt=Et(function(Pe,_t,cr){for(var Kr=Object.keys(_t),kn=0;kn<Kr.length;)(!cr||cr&&Pe[Kr[kn]]===Z)&&(Pe[Kr[kn]]=_t[Kr[kn]]),kn++;return Pe},"extend","Use `assign`."),at=Et(function(Pe,_t){return wt(Pe,_t,!0)},"merge","Use `assign`.");function Tt(ge,Pe,_t){var cr=Pe.prototype,Kr;Kr=ge.prototype=Object.create(cr),Kr.constructor=ge,Kr._super=cr,_t&&Dt(Kr,_t)}function wr(ge,Pe){return function(){return ge.apply(Pe,arguments)}}function pr(ge,Pe){return typeof ge==Ge?ge.apply(Pe&&Pe[0]||Z,Pe):ge}function lr(ge,Pe){return ge===Z?Pe:ge}function Ot(ge,Pe,_t){bt(Nt(Pe),function(cr){ge.addEventListener(cr,_t,!1)})}function ht(ge,Pe,_t){bt(Nt(Pe),function(cr){ge.removeEventListener(cr,_t,!1)})}function Ft(ge,Pe){for(;ge;){if(ge==Pe)return!0;ge=ge.parentNode}return!1}function Qe(ge,Pe){return ge.indexOf(Pe)>-1}function Nt(ge){return ge.trim().split(/\s+/g)}function sr(ge,Pe,_t){if(ge.indexOf&&!_t)return ge.indexOf(Pe);for(var cr=0;cr<ge.length;){if(_t&&ge[cr][_t]==Pe||!_t&&ge[cr]===Pe)return cr;cr++}return-1}function ie(ge){return Array.prototype.slice.call(ge,0)}function W(ge,Pe,_t){for(var cr=[],Kr=[],kn=0;kn<ge.length;){var ji=Pe?ge[kn][Pe]:ge[kn];sr(Kr,ji)<0&&cr.push(ge[kn]),Kr[kn]=ji,kn++}return _t&&(Pe?cr=cr.sort(function(wo,fo){return wo[Pe]>fo[Pe]}):cr=cr.sort()),cr}function te(ge,Pe){for(var _t,cr,Kr=Pe[0].toUpperCase()+Pe.slice(1),kn=0;kn<he.length;){if(_t=he[kn],cr=_t?_t+Kr:Pe,cr in ge)return cr;kn++}return Z}var Oe=1;function Te(){return Oe++}function nt(ge){var Pe=ge.ownerDocument||ge;return Pe.defaultView||Pe.parentWindow||ve}var De=/mobile|tablet|ip(ad|hone|od)|android/i,Ze="ontouchstart"in ve,Ke=te(ve,"PointerEvent")!==Z,At=Ze&&De.test(navigator.userAgent),dr="touch",Pt="pen",fn="mouse",cn="kinect",Lr=25,Fn=1,Sn=2,Jr=4,bi=8,Gn=1,zi=2,bn=4,Pn=8,Aa=16,Zi=zi|bn,Ma=Pn|Aa,To=Zi|Ma,Ce=["x","y"],Ia=["clientX","clientY"];function Ta(ge,Pe){var _t=this;this.manager=ge,this.callback=Pe,this.element=ge.element,this.target=ge.options.inputTarget,this.domHandler=function(cr){pr(ge.options.enable,[ge])&&_t.handler(cr)},this.init()}Ta.prototype={handler:function(){},init:function(){this.evEl&&Ot(this.element,this.evEl,this.domHandler),this.evTarget&&Ot(this.target,this.evTarget,this.domHandler),this.evWin&&Ot(nt(this.element),this.evWin,this.domHandler)},destroy:function(){this.evEl&&ht(this.element,this.evEl,this.domHandler),this.evTarget&&ht(this.target,this.evTarget,this.domHandler),this.evWin&&ht(nt(this.element),this.evWin,this.domHandler)}};function no(ge){var Pe,_t=ge.options.inputClass;return _t?Pe=_t:Ke?Pe=B:At?Pe=Le:Ze?Pe=gr:Pe=Ht,new Pe(ge,qs)}function qs(ge,Pe,_t){var cr=_t.pointers.length,Kr=_t.changedPointers.length,kn=Pe&Fn&&cr-Kr===0,ji=Pe&(Jr|bi)&&cr-Kr===0;_t.isFirst=!!kn,_t.isFinal=!!ji,kn&&(ge.session={}),_t.eventType=Pe,Rs(ge,_t),ge.emit("hammer.input",_t),ge.recognize(_t),ge.session.prevInput=_t}function Rs(ge,Pe){var _t=ge.session,cr=Pe.pointers,Kr=cr.length;_t.firstInput||(_t.firstInput=xr(Pe)),Kr>1&&!_t.firstMultiple?_t.firstMultiple=xr(Pe):Kr===1&&(_t.firstMultiple=!1);var kn=_t.firstInput,ji=_t.firstMultiple,vo=ji?ji.center:kn.center,wo=Pe.center=Gr(cr);Pe.timeStamp=qe(),Pe.deltaTime=Pe.timeStamp-kn.timeStamp,Pe.angle=ue(vo,wo),Pe.distance=Ki(vo,wo),ts(_t,Pe),Pe.offsetDirection=Nn(Pe.deltaX,Pe.deltaY);var fo=nn(Pe.deltaTime,Pe.deltaX,Pe.deltaY);Pe.overallVelocityX=fo.x,Pe.overallVelocityY=fo.y,Pe.overallVelocity=We(fo.x)>We(fo.y)?fo.x:fo.y,Pe.scale=ji?z(ji.pointers,cr):1,Pe.rotation=ji?D(ji.pointers,cr):0,Pe.maxPointers=_t.prevInput?Pe.pointers.length>_t.prevInput.maxPointers?Pe.pointers.length:_t.prevInput.maxPointers:Pe.pointers.length,Wt(_t,Pe);var Ds=ge.element;Ft(Pe.srcEvent.target,Ds)&&(Ds=Pe.srcEvent.target),Pe.target=Ds}function ts(ge,Pe){var _t=Pe.center,cr=ge.offsetDelta||{},Kr=ge.prevDelta||{},kn=ge.prevInput||{};(Pe.eventType===Fn||kn.eventType===Jr)&&(Kr=ge.prevDelta={x:kn.deltaX||0,y:kn.deltaY||0},cr=ge.offsetDelta={x:_t.x,y:_t.y}),Pe.deltaX=Kr.x+(_t.x-cr.x),Pe.deltaY=Kr.y+(_t.y-cr.y)}function Wt(ge,Pe){var _t=ge.lastInterval||Pe,cr=Pe.timeStamp-_t.timeStamp,Kr,kn,ji,vo;if(Pe.eventType!=bi&&(cr>Lr||_t.velocity===Z)){var wo=Pe.deltaX-_t.deltaX,fo=Pe.deltaY-_t.deltaY,Ds=nn(cr,wo,fo);kn=Ds.x,ji=Ds.y,Kr=We(Ds.x)>We(Ds.y)?Ds.x:Ds.y,vo=Nn(wo,fo),ge.lastInterval=Pe}else Kr=_t.velocity,kn=_t.velocityX,ji=_t.velocityY,vo=_t.direction;Pe.velocity=Kr,Pe.velocityX=kn,Pe.velocityY=ji,Pe.direction=vo}function xr(ge){for(var Pe=[],_t=0;_t<ge.pointers.length;)Pe[_t]={clientX:oe(ge.pointers[_t].clientX),clientY:oe(ge.pointers[_t].clientY)},_t++;return{timeStamp:qe(),pointers:Pe,center:Gr(Pe),deltaX:ge.deltaX,deltaY:ge.deltaY}}function Gr(ge){var Pe=ge.length;if(Pe===1)return{x:oe(ge[0].clientX),y:oe(ge[0].clientY)};for(var _t=0,cr=0,Kr=0;Kr<Pe;)_t+=ge[Kr].clientX,cr+=ge[Kr].clientY,Kr++;return{x:oe(_t/Pe),y:oe(cr/Pe)}}function nn(ge,Pe,_t){return{x:Pe/ge||0,y:_t/ge||0}}function Nn(ge,Pe){return ge===Pe?Gn:We(ge)>=We(Pe)?ge<0?zi:bn:Pe<0?Pn:Aa}function Ki(ge,Pe,_t){_t||(_t=Ce);var cr=Pe[_t[0]]-ge[_t[0]],Kr=Pe[_t[1]]-ge[_t[1]];return Math.sqrt(cr*cr+Kr*Kr)}function ue(ge,Pe,_t){_t||(_t=Ce);var cr=Pe[_t[0]]-ge[_t[0]],Kr=Pe[_t[1]]-ge[_t[1]];return Math.atan2(Kr,cr)*180/Math.PI}function D(ge,Pe){return ue(Pe[1],Pe[0],Ia)+ue(ge[1],ge[0],Ia)}function z(ge,Pe){return Ki(Pe[0],Pe[1],Ia)/Ki(ge[0],ge[1],Ia)}var se={mousedown:Fn,mousemove:Sn,mouseup:Jr},be="mousedown",ke="mousemove mouseup";function Ht(){this.evEl=be,this.evWin=ke,this.pressed=!1,Ta.apply(this,arguments)}Tt(Ht,Ta,{handler:function(Pe){var _t=se[Pe.type];_t&Fn&&Pe.button===0&&(this.pressed=!0),_t&Sn&&Pe.which!==1&&(_t=Jr),this.pressed&&(_t&Jr&&(this.pressed=!1),this.callback(this.manager,_t,{pointers:[Pe],changedPointers:[Pe],pointerType:fn,srcEvent:Pe}))}});var Mt={pointerdown:Fn,pointermove:Sn,pointerup:Jr,pointercancel:bi,pointerout:bi},Lt={2:dr,3:Pt,4:fn,5:cn},mt="pointerdown",N="pointermove pointerup pointercancel";ve.MSPointerEvent&&!ve.PointerEvent&&(mt="MSPointerDown",N="MSPointerMove MSPointerUp MSPointerCancel");function B(){this.evEl=mt,this.evWin=N,Ta.apply(this,arguments),this.store=this.manager.session.pointerEvents=[]}Tt(B,Ta,{handler:function(Pe){var _t=this.store,cr=!1,Kr=Pe.type.toLowerCase().replace("ms",""),kn=Mt[Kr],ji=Lt[Pe.pointerType]||Pe.pointerType,vo=ji==dr,wo=sr(_t,Pe.pointerId,"pointerId");kn&Fn&&(Pe.button===0||vo)?wo<0&&(_t.push(Pe),wo=_t.length-1):kn&(Jr|bi)&&(cr=!0),!(wo<0)&&(_t[wo]=Pe,this.callback(this.manager,kn,{pointers:_t,changedPointers:[Pe],pointerType:ji,srcEvent:Pe}),cr&&_t.splice(wo,1))}});var $={touchstart:Fn,touchmove:Sn,touchend:Jr,touchcancel:bi},ne="touchstart",xe="touchstart touchmove touchend touchcancel";function Fe(){this.evTarget=ne,this.evWin=xe,this.started=!1,Ta.apply(this,arguments)}Tt(Fe,Ta,{handler:function(Pe){var _t=$[Pe.type];if(_t===Fn&&(this.started=!0),!!this.started){var cr=et.call(this,Pe,_t);_t&(Jr|bi)&&cr[0].length-cr[1].length===0&&(this.started=!1),this.callback(this.manager,_t,{pointers:cr[0],changedPointers:cr[1],pointerType:dr,srcEvent:Pe})}}});function et(ge,Pe){var _t=ie(ge.touches),cr=ie(ge.changedTouches);return Pe&(Jr|bi)&&(_t=W(_t.concat(cr),"identifier",!0)),[_t,cr]}var j={touchstart:Fn,touchmove:Sn,touchend:Jr,touchcancel:bi},Q="touchstart touchmove touchend touchcancel";function Le(){this.evTarget=Q,this.targetIds={},Ta.apply(this,arguments)}Tt(Le,Ta,{handler:function(Pe){var _t=j[Pe.type],cr=rt.call(this,Pe,_t);cr&&this.callback(this.manager,_t,{pointers:cr[0],changedPointers:cr[1],pointerType:dr,srcEvent:Pe})}});function rt(ge,Pe){var _t=ie(ge.touches),cr=this.targetIds;if(Pe&(Fn|Sn)&&_t.length===1)return cr[_t[0].identifier]=!0,[_t,_t];var Kr,kn,ji=ie(ge.changedTouches),vo=[],wo=this.target;if(kn=_t.filter(function(fo){return Ft(fo.target,wo)}),Pe===Fn)for(Kr=0;Kr<kn.length;)cr[kn[Kr].identifier]=!0,Kr++;for(Kr=0;Kr<ji.length;)cr[ji[Kr].identifier]&&vo.push(ji[Kr]),Pe&(Jr|bi)&&delete cr[ji[Kr].identifier],Kr++;if(vo.length)return[W(kn.concat(vo),"identifier",!0),vo]}var Ee=2500,Yt=25;function gr(){Ta.apply(this,arguments);var ge=wr(this.handler,this);this.touch=new Le(this.manager,ge),this.mouse=new Ht(this.manager,ge),this.primaryTouch=null,this.lastTouches=[]}Tt(gr,Ta,{handler:function(Pe,_t,cr){var Kr=cr.pointerType==dr,kn=cr.pointerType==fn;if(!(kn&&cr.sourceCapabilities&&cr.sourceCapabilities.firesTouchEvents)){if(Kr)tn.call(this,_t,cr);else if(kn&&rr.call(this,cr))return;this.callback(Pe,_t,cr)}},destroy:function(){this.touch.destroy(),this.mouse.destroy()}});function tn(ge,Pe){ge&Fn?(this.primaryTouch=Pe.changedPointers[0].identifier,Qr.call(this,Pe)):ge&(Jr|bi)&&Qr.call(this,Pe)}function Qr(ge){var Pe=ge.changedPointers[0];if(Pe.identifier===this.primaryTouch){var _t={x:Pe.clientX,y:Pe.clientY};this.lastTouches.push(_t);var cr=this.lastTouches,Kr=function(){var kn=cr.indexOf(_t);kn>-1&&cr.splice(kn,1)};setTimeout(Kr,Ee)}}function rr(ge){for(var Pe=ge.srcEvent.clientX,_t=ge.srcEvent.clientY,cr=0;cr<this.lastTouches.length;cr++){var Kr=this.lastTouches[cr],kn=Math.abs(Pe-Kr.x),ji=Math.abs(_t-Kr.y);if(kn<=Yt&&ji<=Yt)return!0}return!1}var Xr=te(ce.style,"touchAction"),zr=Xr!==Z,Vr="compute",ei="auto",sn="manipulation",hi="none",Vi="pan-x",ci="pan-y",Di=Qi();function Ei(ge,Pe){this.manager=ge,this.set(Pe)}Ei.prototype={set:function(ge){ge==Vr&&(ge=this.compute()),zr&&this.manager.element.style&&Di[ge]&&(this.manager.element.style[Xr]=ge),this.actions=ge.toLowerCase().trim()},update:function(){this.set(this.manager.options.touchAction)},compute:function(){var ge=[];return bt(this.manager.recognizers,function(Pe){pr(Pe.options.enable,[Pe])&&(ge=ge.concat(Pe.getTouchAction()))}),rs(ge.join(" "))},preventDefaults:function(ge){var Pe=ge.srcEvent,_t=ge.offsetDirection;if(this.manager.session.prevented){Pe.preventDefault();return}var cr=this.actions,Kr=Qe(cr,hi)&&!Di[hi],kn=Qe(cr,ci)&&!Di[ci],ji=Qe(cr,Vi)&&!Di[Vi];if(Kr){var vo=ge.pointers.length===1,wo=ge.distance<2,fo=ge.deltaTime<250;if(vo&&wo&&fo)return}if(!(ji&&kn)&&(Kr||kn&&_t&Zi||ji&&_t&Ma))return this.preventSrc(Pe)},preventSrc:function(ge){this.manager.session.prevented=!0,ge.preventDefault()}};function rs(ge){if(Qe(ge,hi))return hi;var Pe=Qe(ge,Vi),_t=Qe(ge,ci);return Pe&&_t?hi:Pe||_t?Pe?Vi:ci:Qe(ge,sn)?sn:ei}function Qi(){if(!zr)return!1;var ge={},Pe=ve.CSS&&ve.CSS.supports;return["auto","manipulation","pan-y","pan-x","pan-x pan-y","none"].forEach(function(_t){ge[_t]=Pe?ve.CSS.supports("touch-action",_t):!0}),ge}var Pa=1,Si=2,di=4,Ai=8,Oa=Ai,vu=16,ca=32;function wa(ge){this.options=Dt({},this.defaults,ge||{}),this.id=Te(),this.manager=null,this.options.enable=lr(this.options.enable,!0),this.state=Pa,this.simultaneous={},this.requireFail=[]}wa.prototype={defaults:{},set:function(ge){return Dt(this.options,ge),this.manager&&this.manager.touchAction.update(),this},recognizeWith:function(ge){if(vt(ge,"recognizeWith",this))return this;var Pe=this.simultaneous;return ge=Ca(ge,this),Pe[ge.id]||(Pe[ge.id]=ge,ge.recognizeWith(this)),this},dropRecognizeWith:function(ge){return vt(ge,"dropRecognizeWith",this)?this:(ge=Ca(ge,this),delete this.simultaneous[ge.id],this)},requireFailure:function(ge){if(vt(ge,"requireFailure",this))return this;var Pe=this.requireFail;return ge=Ca(ge,this),sr(Pe,ge)===-1&&(Pe.push(ge),ge.requireFailure(this)),this},dropRequireFailure:function(ge){if(vt(ge,"dropRequireFailure",this))return this;ge=Ca(ge,this);var Pe=sr(this.requireFail,ge);return Pe>-1&&this.requireFail.splice(Pe,1),this},hasRequireFailures:function(){return this.requireFail.length>0},canRecognizeWith:function(ge){return!!this.simultaneous[ge.id]},emit:function(ge){var Pe=this,_t=this.state;function cr(Kr){Pe.manager.emit(Kr,ge)}_t<Ai&&cr(Pe.options.event+Gl(_t)),cr(Pe.options.event),ge.additionalEvent&&cr(ge.additionalEvent),_t>=Ai&&cr(Pe.options.event+Gl(_t))},tryEmit:function(ge){if(this.canEmit())return this.emit(ge);this.state=ca},canEmit:function(){for(var ge=0;ge<this.requireFail.length;){if(!(this.requireFail[ge].state&(ca|Pa)))return!1;ge++}return!0},recognize:function(ge){var Pe=Dt({},ge);if(!pr(this.options.enable,[this,Pe])){this.reset(),this.state=ca;return}this.state&(Oa|vu|ca)&&(this.state=Pa),this.state=this.process(Pe),this.state&(Si|di|Ai|vu)&&this.tryEmit(Pe)},process:function(ge){},getTouchAction:function(){},reset:function(){}};function Gl(ge){return ge&vu?"cancel":ge&Ai?"end":ge&di?"move":ge&Si?"start":""}function ds(ge){return ge==Aa?"down":ge==Pn?"up":ge==zi?"left":ge==bn?"right":""}function Ca(ge,Pe){var _t=Pe.manager;return _t?_t.get(ge):ge}function vi(){wa.apply(this,arguments)}Tt(vi,wa,{defaults:{pointers:1},attrTest:function(ge){var Pe=this.options.pointers;return Pe===0||ge.pointers.length===Pe},process:function(ge){var Pe=this.state,_t=ge.eventType,cr=Pe&(Si|di),Kr=this.attrTest(ge);return cr&&(_t&bi||!Kr)?Pe|vu:cr||Kr?_t&Jr?Pe|Ai:Pe&Si?Pe|di:Si:ca}});function ka(){vi.apply(this,arguments),this.pX=null,this.pY=null}Tt(ka,vi,{defaults:{event:"pan",threshold:10,pointers:1,direction:To},getTouchAction:function(){var ge=this.options.direction,Pe=[];return ge&Zi&&Pe.push(ci),ge&Ma&&Pe.push(Vi),Pe},directionTest:function(ge){var Pe=this.options,_t=!0,cr=ge.distance,Kr=ge.direction,kn=ge.deltaX,ji=ge.deltaY;return Kr&Pe.direction||(Pe.direction&Zi?(Kr=kn===0?Gn:kn<0?zi:bn,_t=kn!=this.pX,cr=Math.abs(ge.deltaX)):(Kr=ji===0?Gn:ji<0?Pn:Aa,_t=ji!=this.pY,cr=Math.abs(ge.deltaY))),ge.direction=Kr,_t&&cr>Pe.threshold&&Kr&Pe.direction},attrTest:function(ge){return vi.prototype.attrTest.call(this,ge)&&(this.state&Si||!(this.state&Si)&&this.directionTest(ge))},emit:function(ge){this.pX=ge.deltaX,this.pY=ge.deltaY;var Pe=ds(ge.direction);Pe&&(ge.additionalEvent=this.options.event+Pe),this._super.emit.call(this,ge)}});function na(){vi.apply(this,arguments)}Tt(na,vi,{defaults:{event:"pinch",threshold:0,pointers:2},getTouchAction:function(){return[hi]},attrTest:function(ge){return this._super.attrTest.call(this,ge)&&(Math.abs(ge.scale-1)>this.options.threshold||this.state&Si)},emit:function(ge){if(ge.scale!==1){var Pe=ge.scale<1?"in":"out";ge.additionalEvent=this.options.event+Pe}this._super.emit.call(this,ge)}});function zo(){wa.apply(this,arguments),this._timer=null,this._input=null}Tt(zo,wa,{defaults:{event:"press",pointers:1,time:251,threshold:9},getTouchAction:function(){return[ei]},process:function(ge){var Pe=this.options,_t=ge.pointers.length===Pe.pointers,cr=ge.distance<Pe.threshold,Kr=ge.deltaTime>Pe.time;if(this._input=ge,!cr||!_t||ge.eventType&(Jr|bi)&&!Kr)this.reset();else if(ge.eventType&Fn)this.reset(),this._timer=pt(function(){this.state=Oa,this.tryEmit()},Pe.time,this);else if(ge.eventType&Jr)return Oa;return ca},reset:function(){clearTimeout(this._timer)},emit:function(ge){this.state===Oa&&(ge&&ge.eventType&Jr?this.manager.emit(this.options.event+"up",ge):(this._input.timeStamp=qe(),this.manager.emit(this.options.event,this._input)))}});function la(){vi.apply(this,arguments)}Tt(la,vi,{defaults:{event:"rotate",threshold:0,pointers:2},getTouchAction:function(){return[hi]},attrTest:function(ge){return this._super.attrTest.call(this,ge)&&(Math.abs(ge.rotation)>this.options.threshold||this.state&Si)}});function ns(){vi.apply(this,arguments)}Tt(ns,vi,{defaults:{event:"swipe",threshold:10,velocity:.3,direction:Zi|Ma,pointers:1},getTouchAction:function(){return ka.prototype.getTouchAction.call(this)},attrTest:function(ge){var Pe=this.options.direction,_t;return Pe&(Zi|Ma)?_t=ge.overallVelocity:Pe&Zi?_t=ge.overallVelocityX:Pe&Ma&&(_t=ge.overallVelocityY),this._super.attrTest.call(this,ge)&&Pe&ge.offsetDirection&&ge.distance>this.options.threshold&&ge.maxPointers==this.options.pointers&&We(_t)>this.options.velocity&&ge.eventType&Jr},emit:function(ge){var Pe=ds(ge.offsetDirection);Pe&&this.manager.emit(this.options.event+Pe,ge),this.manager.emit(this.options.event,ge)}});function $o(){wa.apply(this,arguments),this.pTime=!1,this.pCenter=!1,this._timer=null,this._input=null,this.count=0}Tt($o,wa,{defaults:{event:"tap",pointers:1,taps:1,interval:300,time:250,threshold:9,posThreshold:10},getTouchAction:function(){return[sn]},process:function(ge){var Pe=this.options,_t=ge.pointers.length===Pe.pointers,cr=ge.distance<Pe.threshold,Kr=ge.deltaTime<Pe.time;if(this.reset(),ge.eventType&Fn&&this.count===0)return this.failTimeout();if(cr&&Kr&&_t){if(ge.eventType!=Jr)return this.failTimeout();var kn=this.pTime?ge.timeStamp-this.pTime<Pe.interval:!0,ji=!this.pCenter||Ki(this.pCenter,ge.center)<Pe.posThreshold;this.pTime=ge.timeStamp,this.pCenter=ge.center,!ji||!kn?this.count=1:this.count+=1,this._input=ge;var vo=this.count%Pe.taps;if(vo===0)return this.hasRequireFailures()?(this._timer=pt(function(){this.state=Oa,this.tryEmit()},Pe.interval,this),Si):Oa}return ca},failTimeout:function(){return this._timer=pt(function(){this.state=ca},this.options.interval,this),ca},reset:function(){clearTimeout(this._timer)},emit:function(){this.state==Oa&&(this._input.tapCount=this.count,this.manager.emit(this.options.event,this._input))}});function Du(ge,Pe){return Pe=Pe||{},Pe.recognizers=lr(Pe.recognizers,Du.defaults.preset),new ya(ge,Pe)}Du.VERSION="2.0.7",Du.defaults={domEvents:!1,touchAction:Vr,enable:!0,inputTarget:null,inputClass:null,preset:[[la,{enable:!1}],[na,{enable:!1},["rotate"]],[ns,{direction:Zi}],[ka,{direction:Zi},["swipe"]],[$o],[$o,{event:"doubletap",taps:2},["tap"]],[zo]],cssProps:{userSelect:"none",touchSelect:"none",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}};var vs=1,_c=2;function ya(ge,Pe){this.options=Dt({},Du.defaults,Pe||{}),this.options.inputTarget=this.options.inputTarget||ge,this.handlers={},this.session={},this.recognizers=[],this.oldCssProps={},this.element=ge,this.input=no(this),this.touchAction=new Ei(this,this.options.touchAction),Ji(this,!0),bt(this.options.recognizers,function(_t){var cr=this.add(new _t[0](_t[1]));_t[2]&&cr.recognizeWith(_t[2]),_t[3]&&cr.requireFailure(_t[3])},this)}ya.prototype={set:function(ge){return Dt(this.options,ge),ge.touchAction&&this.touchAction.update(),ge.inputTarget&&(this.input.destroy(),this.input.target=ge.inputTarget,this.input.init()),this},stop:function(ge){this.session.stopped=ge?_c:vs},recognize:function(ge){var Pe=this.session;if(!Pe.stopped){this.touchAction.preventDefaults(ge);var _t,cr=this.recognizers,Kr=Pe.curRecognizer;(!Kr||Kr&&Kr.state&Oa)&&(Kr=Pe.curRecognizer=null);for(var kn=0;kn<cr.length;)_t=cr[kn],Pe.stopped!==_c&&(!Kr||_t==Kr||_t.canRecognizeWith(Kr))?_t.recognize(ge):_t.reset(),!Kr&&_t.state&(Si|di|Ai)&&(Kr=Pe.curRecognizer=_t),kn++}},get:function(ge){if(ge instanceof wa)return ge;for(var Pe=this.recognizers,_t=0;_t<Pe.length;_t++)if(Pe[_t].options.event==ge)return Pe[_t];return null},add:function(ge){if(vt(ge,"add",this))return this;var Pe=this.get(ge.options.event);return Pe&&this.remove(Pe),this.recognizers.push(ge),ge.manager=this,this.touchAction.update(),ge},remove:function(ge){if(vt(ge,"remove",this))return this;if(ge=this.get(ge),ge){var Pe=this.recognizers,_t=sr(Pe,ge);_t!==-1&&(Pe.splice(_t,1),this.touchAction.update())}return this},on:function(ge,Pe){if(ge!==Z&&Pe!==Z){var _t=this.handlers;return bt(Nt(ge),function(cr){_t[cr]=_t[cr]||[],_t[cr].push(Pe)}),this}},off:function(ge,Pe){if(ge!==Z){var _t=this.handlers;return bt(Nt(ge),function(cr){Pe?_t[cr]&&_t[cr].splice(sr(_t[cr],Pe),1):delete _t[cr]}),this}},emit:function(ge,Pe){this.options.domEvents&&Jt(ge,Pe);var _t=this.handlers[ge]&&this.handlers[ge].slice();if(!(!_t||!_t.length)){Pe.type=ge,Pe.preventDefault=function(){Pe.srcEvent.preventDefault()};for(var cr=0;cr<_t.length;)_t[cr](Pe),cr++}},destroy:function(){this.element&&Ji(this,!1),this.handlers={},this.session={},this.input.destroy(),this.element=null}};function Ji(ge,Pe){var _t=ge.element;if(_t.style){var cr;bt(ge.options.cssProps,function(Kr,kn){cr=te(_t.style,kn),Pe?(ge.oldCssProps[cr]=_t.style[cr],_t.style[cr]=Kr):_t.style[cr]=ge.oldCssProps[cr]||""}),Pe||(ge.oldCssProps={})}}function Jt(ge,Pe){var _t=_.createEvent("Event");_t.initEvent(ge,!0,!0),_t.gesture=Pe,Pe.target.dispatchEvent(_t)}Dt(Du,{INPUT_START:Fn,INPUT_MOVE:Sn,INPUT_END:Jr,INPUT_CANCEL:bi,STATE_POSSIBLE:Pa,STATE_BEGAN:Si,STATE_CHANGED:di,STATE_ENDED:Ai,STATE_RECOGNIZED:Oa,STATE_CANCELLED:vu,STATE_FAILED:ca,DIRECTION_NONE:Gn,DIRECTION_LEFT:zi,DIRECTION_RIGHT:bn,DIRECTION_UP:Pn,DIRECTION_DOWN:Aa,DIRECTION_HORIZONTAL:Zi,DIRECTION_VERTICAL:Ma,DIRECTION_ALL:To,Manager:ya,Input:Ta,TouchAction:Ei,TouchInput:Le,MouseInput:Ht,PointerEventInput:B,TouchMouseInput:gr,SingleTouchInput:Fe,Recognizer:wa,AttrRecognizer:vi,Tap:$o,Pan:ka,Swipe:ns,Pinch:na,Rotate:la,Press:zo,on:Ot,off:ht,each:bt,merge:at,extend:wt,assign:Dt,inherit:Tt,bindFn:wr,prefixed:te});var yn=typeof ve!="undefined"?ve:typeof self!="undefined"?self:{};yn.Hammer=Du,ee=function(){return Du}.call(re,U,re,Qt),ee!==Z&&(Qt.exports=ee)})(window,document,"Hammer")},84530:function(Qt,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0});var U=Symbol.for("INJECTION");function ee(he,ce,Ge,oe){function We(){return oe&&!Reflect.hasMetadata(U,this,ce)&&Reflect.defineMetadata(U,Ge(),this,ce),Reflect.hasMetadata(U,this,ce)?Reflect.getMetadata(U,this,ce):Ge()}function qe(pt){Reflect.defineMetadata(U,pt,this,ce)}Object.defineProperty(he,ce,{configurable:!0,enumerable:!0,get:We,set:qe})}function ve(he,ce){return function(Ge){return function(oe,We){var qe=function(){return he.get(Ge)};ee(oe,We,qe,ce)}}}re.makePropertyInjectDecorator=ve;function _(he,ce){return function(Ge,oe){return function(We,qe){var pt=function(){return he.getNamed(Ge,oe)};ee(We,qe,pt,ce)}}}re.makePropertyInjectNamedDecorator=_;function fe(he,ce){return function(Ge,oe,We){return function(qe,pt){var vt=function(){return he.getTagged(Ge,oe,We)};ee(qe,pt,vt,ce)}}}re.makePropertyInjectTaggedDecorator=fe;function Z(he,ce){return function(Ge){return function(oe,We){var qe=function(){return he.getAll(Ge)};ee(oe,We,qe,ce)}}}re.makePropertyMultiInjectDecorator=Z},67754:function(Qt,re,U){"use strict";var ee;ee={value:!0};var ve=U(84530);function _(fe,Z){Z===void 0&&(Z=!0);var he=ve.makePropertyInjectDecorator(fe,Z),ce=ve.makePropertyInjectNamedDecorator(fe,Z),Ge=ve.makePropertyInjectTaggedDecorator(fe,Z),oe=ve.makePropertyMultiInjectDecorator(fe,Z);return{lazyInject:he,lazyInjectNamed:ce,lazyInjectTagged:Ge,lazyMultiInject:oe}}re.Z=_},38362:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.tagProperty=re.tagParameter=re.decorate=void 0;var ee=U(81463),ve=U(17597);function _(oe,We,qe,pt){var vt=ve.TAGGED;Z(vt,oe,We,pt,qe)}re.tagParameter=_;function fe(oe,We,qe){var pt=ve.TAGGED_PROP;Z(pt,oe.constructor,We,qe)}re.tagProperty=fe;function Z(oe,We,qe,pt,vt){var bt={},Et=typeof vt=="number",Dt=vt!==void 0&&Et?vt.toString():qe;if(Et&&qe!==void 0)throw new Error(ee.INVALID_DECORATOR_OPERATION);Reflect.hasOwnMetadata(oe,We)&&(bt=Reflect.getMetadata(oe,We));var wt=bt[Dt];if(!Array.isArray(wt))wt=[];else for(var at=0,Tt=wt;at<Tt.length;at++){var wr=Tt[at];if(wr.key===pt.key)throw new Error(ee.DUPLICATED_METADATA+" "+wr.key.toString())}wt.push(pt),bt[Dt]=wt,Reflect.defineMetadata(oe,bt,We)}function he(oe,We){Reflect.decorate(oe,We)}function ce(oe,We){return function(qe,pt){We(qe,pt,oe)}}function Ge(oe,We,qe){typeof qe=="number"?he([ce(qe,oe)],We):typeof qe=="string"?Reflect.decorate([oe],We,qe):he([oe],We)}re.decorate=Ge},71791:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.inject=re.LazyServiceIdentifer=void 0;var ee=U(81463),ve=U(17597),_=U(4957),fe=U(38362),Z=function(){function ce(Ge){this._cb=Ge}return ce.prototype.unwrap=function(){return this._cb()},ce}();re.LazyServiceIdentifer=Z;function he(ce){return function(Ge,oe,We){if(ce===void 0)throw new Error(ee.UNDEFINED_INJECT_ANNOTATION(Ge.name));var qe=new _.Metadata(ve.INJECT_TAG,ce);typeof We=="number"?fe.tagParameter(Ge,oe,We,qe):fe.tagProperty(Ge,oe,qe)}}re.inject=he},66733:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.injectable=void 0;var ee=U(81463),ve=U(17597);function _(){return function(fe){if(Reflect.hasOwnMetadata(ve.PARAM_TYPES,fe))throw new Error(ee.DUPLICATED_INJECTABLE_DECORATOR);var Z=Reflect.getMetadata(ve.DESIGN_PARAM_TYPES,fe)||[];return Reflect.defineMetadata(ve.PARAM_TYPES,Z,fe),fe}}re.injectable=_},33406:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.multiInject=void 0;var ee=U(17597),ve=U(4957),_=U(38362);function fe(Z){return function(he,ce,Ge){var oe=new ve.Metadata(ee.MULTI_INJECT_TAG,Z);typeof Ge=="number"?_.tagParameter(he,ce,Ge,oe):_.tagProperty(he,ce,oe)}}re.multiInject=fe},23769:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.named=void 0;var ee=U(17597),ve=U(4957),_=U(38362);function fe(Z){return function(he,ce,Ge){var oe=new ve.Metadata(ee.NAMED_TAG,Z);typeof Ge=="number"?_.tagParameter(he,ce,Ge,oe):_.tagProperty(he,ce,oe)}}re.named=fe},57758:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.optional=void 0;var ee=U(17597),ve=U(4957),_=U(38362);function fe(){return function(Z,he,ce){var Ge=new ve.Metadata(ee.OPTIONAL_TAG,!0);typeof ce=="number"?_.tagParameter(Z,he,ce,Ge):_.tagProperty(Z,he,Ge)}}re.optional=fe},82935:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.postConstruct=void 0;var ee=U(81463),ve=U(17597),_=U(4957);function fe(){return function(Z,he,ce){var Ge=new _.Metadata(ve.POST_CONSTRUCT,he);if(Reflect.hasOwnMetadata(ve.POST_CONSTRUCT,Z.constructor))throw new Error(ee.MULTIPLE_POST_CONSTRUCT_METHODS);Reflect.defineMetadata(ve.POST_CONSTRUCT,Ge,Z.constructor)}}re.postConstruct=fe},76316:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.tagged=void 0;var ee=U(4957),ve=U(38362);function _(fe,Z){return function(he,ce,Ge){var oe=new ee.Metadata(fe,Z);typeof Ge=="number"?ve.tagParameter(he,ce,Ge,oe):ve.tagProperty(he,ce,oe)}}re.tagged=_},26805:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.targetName=void 0;var ee=U(17597),ve=U(4957),_=U(38362);function fe(Z){return function(he,ce,Ge){var oe=new ve.Metadata(ee.NAME_TAG,Z);_.tagParameter(he,ce,Ge,oe)}}re.targetName=fe},39868:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.unmanaged=void 0;var ee=U(17597),ve=U(4957),_=U(38362);function fe(){return function(Z,he,ce){var Ge=new ve.Metadata(ee.UNMANAGED_TAG,!0);_.tagParameter(Z,he,ce,Ge)}}re.unmanaged=fe},55047:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Binding=void 0;var ee=U(71297),ve=U(92452),_=function(){function fe(Z,he){this.id=ve.id(),this.activated=!1,this.serviceIdentifier=Z,this.scope=he,this.type=ee.BindingTypeEnum.Invalid,this.constraint=function(ce){return!0},this.implementationType=null,this.cache=null,this.factory=null,this.provider=null,this.onActivation=null,this.dynamicValue=null}return fe.prototype.clone=function(){var Z=new fe(this.serviceIdentifier,this.scope);return Z.activated=Z.scope===ee.BindingScopeEnum.Singleton?this.activated:!1,Z.implementationType=this.implementationType,Z.dynamicValue=this.dynamicValue,Z.scope=this.scope,Z.type=this.type,Z.factory=this.factory,Z.provider=this.provider,Z.constraint=this.constraint,Z.onActivation=this.onActivation,Z.cache=this.cache,Z},fe}();re.Binding=_},53837:function(Qt,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingCount=void 0;var U={MultipleBindingsAvailable:2,NoBindingsAvailable:0,OnlyOneBindingAvailable:1};re.BindingCount=U},81463:function(Qt,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.STACK_OVERFLOW=re.CIRCULAR_DEPENDENCY_IN_FACTORY=re.POST_CONSTRUCT_ERROR=re.MULTIPLE_POST_CONSTRUCT_METHODS=re.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK=re.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE=re.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE=re.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT=re.ARGUMENTS_LENGTH_MISMATCH=re.INVALID_DECORATOR_OPERATION=re.INVALID_TO_SELF_VALUE=re.INVALID_FUNCTION_BINDING=re.INVALID_MIDDLEWARE_RETURN=re.NO_MORE_SNAPSHOTS_AVAILABLE=re.INVALID_BINDING_TYPE=re.NOT_IMPLEMENTED=re.CIRCULAR_DEPENDENCY=re.UNDEFINED_INJECT_ANNOTATION=re.MISSING_INJECT_ANNOTATION=re.MISSING_INJECTABLE_ANNOTATION=re.NOT_REGISTERED=re.CANNOT_UNBIND=re.AMBIGUOUS_MATCH=re.KEY_NOT_FOUND=re.NULL_ARGUMENT=re.DUPLICATED_METADATA=re.DUPLICATED_INJECTABLE_DECORATOR=void 0,re.DUPLICATED_INJECTABLE_DECORATOR="Cannot apply @injectable decorator multiple times.",re.DUPLICATED_METADATA="Metadata key was used more than once in a parameter:",re.NULL_ARGUMENT="NULL argument",re.KEY_NOT_FOUND="Key Not Found",re.AMBIGUOUS_MATCH="Ambiguous match found for serviceIdentifier:",re.CANNOT_UNBIND="Could not unbind serviceIdentifier:",re.NOT_REGISTERED="No matching bindings found for serviceIdentifier:",re.MISSING_INJECTABLE_ANNOTATION="Missing required @injectable annotation in:",re.MISSING_INJECT_ANNOTATION="Missing required @inject or @multiInject annotation in:";var U=function(fe){return"@inject called with undefined this could mean that the class "+fe+" has a circular dependency problem. You can use a LazyServiceIdentifer to  overcome this limitation."};re.UNDEFINED_INJECT_ANNOTATION=U,re.CIRCULAR_DEPENDENCY="Circular dependency found:",re.NOT_IMPLEMENTED="Sorry, this feature is not fully implemented yet.",re.INVALID_BINDING_TYPE="Invalid binding type:",re.NO_MORE_SNAPSHOTS_AVAILABLE="No snapshot available to restore.",re.INVALID_MIDDLEWARE_RETURN="Invalid return type in middleware. Middleware must return!",re.INVALID_FUNCTION_BINDING="Value provided to function binding must be a function!",re.INVALID_TO_SELF_VALUE="The toSelf function can only be applied when a constructor is used as service identifier",re.INVALID_DECORATOR_OPERATION="The @inject @multiInject @tagged and @named decorators must be applied to the parameters of a class constructor or a class property.";var ee=function(){for(var fe=[],Z=0;Z<arguments.length;Z++)fe[Z]=arguments[Z];return"The number of constructor arguments in the derived class "+(fe[0]+" must be >= than the number of constructor arguments of its base class.")};re.ARGUMENTS_LENGTH_MISMATCH=ee,re.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT="Invalid Container constructor argument. Container options must be an object.",re.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE="Invalid Container option. Default scope must be a string ('singleton' or 'transient').",re.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE="Invalid Container option. Auto bind injectable must be a boolean",re.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK="Invalid Container option. Skip base check must be a boolean",re.MULTIPLE_POST_CONSTRUCT_METHODS="Cannot apply @postConstruct decorator multiple times in the same class";var ve=function(){for(var fe=[],Z=0;Z<arguments.length;Z++)fe[Z]=arguments[Z];return"@postConstruct error in class "+fe[0]+": "+fe[1]};re.POST_CONSTRUCT_ERROR=ve;var _=function(){for(var fe=[],Z=0;Z<arguments.length;Z++)fe[Z]=arguments[Z];return"It looks like there is a circular dependency "+("in one of the '"+fe[0]+"' bindings. Please investigate bindings with")+("service identifier '"+fe[1]+"'.")};re.CIRCULAR_DEPENDENCY_IN_FACTORY=_,re.STACK_OVERFLOW="Maximum call stack size exceeded"},71297:function(Qt,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.TargetTypeEnum=re.BindingTypeEnum=re.BindingScopeEnum=void 0;var U={Request:"Request",Singleton:"Singleton",Transient:"Transient"};re.BindingScopeEnum=U;var ee={ConstantValue:"ConstantValue",Constructor:"Constructor",DynamicValue:"DynamicValue",Factory:"Factory",Function:"Function",Instance:"Instance",Invalid:"Invalid",Provider:"Provider"};re.BindingTypeEnum=ee;var ve={ClassProperty:"ClassProperty",ConstructorArgument:"ConstructorArgument",Variable:"Variable"};re.TargetTypeEnum=ve},17597:function(Qt,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.NON_CUSTOM_TAG_KEYS=re.POST_CONSTRUCT=re.DESIGN_PARAM_TYPES=re.PARAM_TYPES=re.TAGGED_PROP=re.TAGGED=re.MULTI_INJECT_TAG=re.INJECT_TAG=re.OPTIONAL_TAG=re.UNMANAGED_TAG=re.NAME_TAG=re.NAMED_TAG=void 0,re.NAMED_TAG="named",re.NAME_TAG="name",re.UNMANAGED_TAG="unmanaged",re.OPTIONAL_TAG="optional",re.INJECT_TAG="inject",re.MULTI_INJECT_TAG="multi_inject",re.TAGGED="inversify:tagged",re.TAGGED_PROP="inversify:tagged_props",re.PARAM_TYPES="inversify:paramtypes",re.DESIGN_PARAM_TYPES="design:paramtypes",re.POST_CONSTRUCT="post_construct";function U(){return[re.INJECT_TAG,re.MULTI_INJECT_TAG,re.NAME_TAG,re.UNMANAGED_TAG,re.NAMED_TAG,re.OPTIONAL_TAG]}re.NON_CUSTOM_TAG_KEYS=U()},27877:function(Qt,re,U){"use strict";var ee=this&&this.__awaiter||function(wt,at,Tt,wr){function pr(lr){return lr instanceof Tt?lr:new Tt(function(Ot){Ot(lr)})}return new(Tt||(Tt=Promise))(function(lr,Ot){function ht(Nt){try{Qe(wr.next(Nt))}catch(sr){Ot(sr)}}function Ft(Nt){try{Qe(wr.throw(Nt))}catch(sr){Ot(sr)}}function Qe(Nt){Nt.done?lr(Nt.value):pr(Nt.value).then(ht,Ft)}Qe((wr=wr.apply(wt,at||[])).next())})},ve=this&&this.__generator||function(wt,at){var Tt={label:0,sent:function(){if(lr[0]&1)throw lr[1];return lr[1]},trys:[],ops:[]},wr,pr,lr,Ot;return Ot={next:ht(0),throw:ht(1),return:ht(2)},typeof Symbol=="function"&&(Ot[Symbol.iterator]=function(){return this}),Ot;function ht(Qe){return function(Nt){return Ft([Qe,Nt])}}function Ft(Qe){if(wr)throw new TypeError("Generator is already executing.");for(;Tt;)try{if(wr=1,pr&&(lr=Qe[0]&2?pr.return:Qe[0]?pr.throw||((lr=pr.return)&&lr.call(pr),0):pr.next)&&!(lr=lr.call(pr,Qe[1])).done)return lr;switch(pr=0,lr&&(Qe=[Qe[0]&2,lr.value]),Qe[0]){case 0:case 1:lr=Qe;break;case 4:return Tt.label++,{value:Qe[1],done:!1};case 5:Tt.label++,pr=Qe[1],Qe=[0];continue;case 7:Qe=Tt.ops.pop(),Tt.trys.pop();continue;default:if(lr=Tt.trys,!(lr=lr.length>0&&lr[lr.length-1])&&(Qe[0]===6||Qe[0]===2)){Tt=0;continue}if(Qe[0]===3&&(!lr||Qe[1]>lr[0]&&Qe[1]<lr[3])){Tt.label=Qe[1];break}if(Qe[0]===6&&Tt.label<lr[1]){Tt.label=lr[1],lr=Qe;break}if(lr&&Tt.label<lr[2]){Tt.label=lr[2],Tt.ops.push(Qe);break}lr[2]&&Tt.ops.pop(),Tt.trys.pop();continue}Qe=at.call(wt,Tt)}catch(Nt){Qe=[6,Nt],pr=0}finally{wr=lr=0}if(Qe[0]&5)throw Qe[1];return{value:Qe[0]?Qe[1]:void 0,done:!0}}},_=this&&this.__spreadArray||function(wt,at){for(var Tt=0,wr=at.length,pr=wt.length;Tt<wr;Tt++,pr++)wt[pr]=at[Tt];return wt};Object.defineProperty(re,"__esModule",{value:!0}),re.Container=void 0;var fe=U(55047),Z=U(81463),he=U(71297),ce=U(17597),Ge=U(51288),oe=U(14346),We=U(50857),qe=U(98e3),pt=U(92452),vt=U(96783),bt=U(527),Et=U(7026),Dt=function(){function wt(at){this._appliedMiddleware=[];var Tt=at||{};if(typeof Tt!="object")throw new Error(""+Z.CONTAINER_OPTIONS_MUST_BE_AN_OBJECT);if(Tt.defaultScope===void 0)Tt.defaultScope=he.BindingScopeEnum.Transient;else if(Tt.defaultScope!==he.BindingScopeEnum.Singleton&&Tt.defaultScope!==he.BindingScopeEnum.Transient&&Tt.defaultScope!==he.BindingScopeEnum.Request)throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_DEFAULT_SCOPE);if(Tt.autoBindInjectable===void 0)Tt.autoBindInjectable=!1;else if(typeof Tt.autoBindInjectable!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_AUTO_BIND_INJECTABLE);if(Tt.skipBaseClassChecks===void 0)Tt.skipBaseClassChecks=!1;else if(typeof Tt.skipBaseClassChecks!="boolean")throw new Error(""+Z.CONTAINER_OPTIONS_INVALID_SKIP_BASE_CHECK);this.options={autoBindInjectable:Tt.autoBindInjectable,defaultScope:Tt.defaultScope,skipBaseClassChecks:Tt.skipBaseClassChecks},this.id=pt.id(),this._bindingDictionary=new Et.Lookup,this._snapshots=[],this._middleware=null,this.parent=null,this._metadataReader=new Ge.MetadataReader}return wt.merge=function(at,Tt){for(var wr=[],pr=2;pr<arguments.length;pr++)wr[pr-2]=arguments[pr];var lr=new wt,Ot=_([at,Tt],wr).map(function(Qe){return oe.getBindingDictionary(Qe)}),ht=oe.getBindingDictionary(lr);function Ft(Qe,Nt){Qe.traverse(function(sr,ie){ie.forEach(function(W){Nt.add(W.serviceIdentifier,W.clone())})})}return Ot.forEach(function(Qe){Ft(Qe,ht)}),lr},wt.prototype.load=function(){for(var at=[],Tt=0;Tt<arguments.length;Tt++)at[Tt]=arguments[Tt];for(var wr=this._getContainerModuleHelpersFactory(),pr=0,lr=at;pr<lr.length;pr++){var Ot=lr[pr],ht=wr(Ot.id);Ot.registry(ht.bindFunction,ht.unbindFunction,ht.isboundFunction,ht.rebindFunction)}},wt.prototype.loadAsync=function(){for(var at=[],Tt=0;Tt<arguments.length;Tt++)at[Tt]=arguments[Tt];return ee(this,void 0,void 0,function(){var wr,pr,lr,Ot,ht;return ve(this,function(Ft){switch(Ft.label){case 0:wr=this._getContainerModuleHelpersFactory(),pr=0,lr=at,Ft.label=1;case 1:return pr<lr.length?(Ot=lr[pr],ht=wr(Ot.id),[4,Ot.registry(ht.bindFunction,ht.unbindFunction,ht.isboundFunction,ht.rebindFunction)]):[3,4];case 2:Ft.sent(),Ft.label=3;case 3:return pr++,[3,1];case 4:return[2]}})})},wt.prototype.unload=function(){for(var at=this,Tt=[],wr=0;wr<arguments.length;wr++)Tt[wr]=arguments[wr];var pr=function(lr){return function(Ot){return Ot.moduleId===lr}};Tt.forEach(function(lr){var Ot=pr(lr.id);at._bindingDictionary.removeByCondition(Ot)})},wt.prototype.bind=function(at){var Tt=this.options.defaultScope||he.BindingScopeEnum.Transient,wr=new fe.Binding(at,Tt);return this._bindingDictionary.add(at,wr),new qe.BindingToSyntax(wr)},wt.prototype.rebind=function(at){return this.unbind(at),this.bind(at)},wt.prototype.unbind=function(at){try{this._bindingDictionary.remove(at)}catch(Tt){throw new Error(Z.CANNOT_UNBIND+" "+vt.getServiceIdentifierAsString(at))}},wt.prototype.unbindAll=function(){this._bindingDictionary=new Et.Lookup},wt.prototype.isBound=function(at){var Tt=this._bindingDictionary.hasKey(at);return!Tt&&this.parent&&(Tt=this.parent.isBound(at)),Tt},wt.prototype.isBoundNamed=function(at,Tt){return this.isBoundTagged(at,ce.NAMED_TAG,Tt)},wt.prototype.isBoundTagged=function(at,Tt,wr){var pr=!1;if(this._bindingDictionary.hasKey(at)){var lr=this._bindingDictionary.get(at),Ot=oe.createMockRequest(this,at,Tt,wr);pr=lr.some(function(ht){return ht.constraint(Ot)})}return!pr&&this.parent&&(pr=this.parent.isBoundTagged(at,Tt,wr)),pr},wt.prototype.snapshot=function(){this._snapshots.push(bt.ContainerSnapshot.of(this._bindingDictionary.clone(),this._middleware))},wt.prototype.restore=function(){var at=this._snapshots.pop();if(at===void 0)throw new Error(Z.NO_MORE_SNAPSHOTS_AVAILABLE);this._bindingDictionary=at.bindings,this._middleware=at.middleware},wt.prototype.createChild=function(at){var Tt=new wt(at||this.options);return Tt.parent=this,Tt},wt.prototype.applyMiddleware=function(){for(var at=[],Tt=0;Tt<arguments.length;Tt++)at[Tt]=arguments[Tt];this._appliedMiddleware=this._appliedMiddleware.concat(at);var wr=this._middleware?this._middleware:this._planAndResolve();this._middleware=at.reduce(function(pr,lr){return lr(pr)},wr)},wt.prototype.applyCustomMetadataReader=function(at){this._metadataReader=at},wt.prototype.get=function(at){return this._get(!1,!1,he.TargetTypeEnum.Variable,at)},wt.prototype.getTagged=function(at,Tt,wr){return this._get(!1,!1,he.TargetTypeEnum.Variable,at,Tt,wr)},wt.prototype.getNamed=function(at,Tt){return this.getTagged(at,ce.NAMED_TAG,Tt)},wt.prototype.getAll=function(at){return this._get(!0,!0,he.TargetTypeEnum.Variable,at)},wt.prototype.getAllTagged=function(at,Tt,wr){return this._get(!1,!0,he.TargetTypeEnum.Variable,at,Tt,wr)},wt.prototype.getAllNamed=function(at,Tt){return this.getAllTagged(at,ce.NAMED_TAG,Tt)},wt.prototype.resolve=function(at){var Tt=this.createChild();return Tt.bind(at).toSelf(),this._appliedMiddleware.forEach(function(wr){Tt.applyMiddleware(wr)}),Tt.get(at)},wt.prototype._getContainerModuleHelpersFactory=function(){var at=this,Tt=function(ht,Ft){ht._binding.moduleId=Ft},wr=function(ht){return function(Ft){var Qe=at.bind.bind(at),Nt=Qe(Ft);return Tt(Nt,ht),Nt}},pr=function(ht){return function(Ft){var Qe=at.unbind.bind(at);Qe(Ft)}},lr=function(ht){return function(Ft){var Qe=at.isBound.bind(at);return Qe(Ft)}},Ot=function(ht){return function(Ft){var Qe=at.rebind.bind(at),Nt=Qe(Ft);return Tt(Nt,ht),Nt}};return function(ht){return{bindFunction:wr(ht),isboundFunction:lr(ht),rebindFunction:Ot(ht),unbindFunction:pr(ht)}}},wt.prototype._get=function(at,Tt,wr,pr,lr,Ot){var ht=null,Ft={avoidConstraints:at,contextInterceptor:function(Qe){return Qe},isMultiInject:Tt,key:lr,serviceIdentifier:pr,targetType:wr,value:Ot};if(this._middleware){if(ht=this._middleware(Ft),ht==null)throw new Error(Z.INVALID_MIDDLEWARE_RETURN)}else ht=this._planAndResolve()(Ft);return ht},wt.prototype._planAndResolve=function(){var at=this;return function(Tt){var wr=oe.plan(at._metadataReader,at,Tt.isMultiInject,Tt.targetType,Tt.serviceIdentifier,Tt.key,Tt.value,Tt.avoidConstraints);wr=Tt.contextInterceptor(wr);var pr=We.resolve(wr);return pr}},wt}();re.Container=Dt},66440:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.AsyncContainerModule=re.ContainerModule=void 0;var ee=U(92452),ve=function(){function fe(Z){this.id=ee.id(),this.registry=Z}return fe}();re.ContainerModule=ve;var _=function(){function fe(Z){this.id=ee.id(),this.registry=Z}return fe}();re.AsyncContainerModule=_},527:function(Qt,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.ContainerSnapshot=void 0;var U=function(){function ee(){}return ee.of=function(ve,_){var fe=new ee;return fe.bindings=ve,fe.middleware=_,fe},ee}();re.ContainerSnapshot=U},7026:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Lookup=void 0;var ee=U(81463),ve=function(){function _(){this._map=new Map}return _.prototype.getMap=function(){return this._map},_.prototype.add=function(fe,Z){if(fe==null)throw new Error(ee.NULL_ARGUMENT);if(Z==null)throw new Error(ee.NULL_ARGUMENT);var he=this._map.get(fe);he!==void 0?(he.push(Z),this._map.set(fe,he)):this._map.set(fe,[Z])},_.prototype.get=function(fe){if(fe==null)throw new Error(ee.NULL_ARGUMENT);var Z=this._map.get(fe);if(Z!==void 0)return Z;throw new Error(ee.KEY_NOT_FOUND)},_.prototype.remove=function(fe){if(fe==null)throw new Error(ee.NULL_ARGUMENT);if(!this._map.delete(fe))throw new Error(ee.KEY_NOT_FOUND)},_.prototype.removeByCondition=function(fe){var Z=this;this._map.forEach(function(he,ce){var Ge=he.filter(function(oe){return!fe(oe)});Ge.length>0?Z._map.set(ce,Ge):Z._map.delete(ce)})},_.prototype.hasKey=function(fe){if(fe==null)throw new Error(ee.NULL_ARGUMENT);return this._map.has(fe)},_.prototype.clone=function(){var fe=new _;return this._map.forEach(function(Z,he){Z.forEach(function(ce){return fe.add(he,ce.clone())})}),fe},_.prototype.traverse=function(fe){this._map.forEach(function(Z,he){fe(he,Z)})},_}();re.Lookup=ve},14156:function(Qt,re,U){"use strict";var ee;ee={value:!0},ee=ee=ee=ee=ee=ee=re.GW=ee=ee=re.zY=ee=ee=ee=ee=ee=re.f3=ee=ee=re.b2=ee=ee=ee=ee=ee=re.W2=ee=void 0;var ve=U(17597);ee=ve;var _=U(27877);Object.defineProperty(re,"W2",{enumerable:!0,get:function(){return _.Container}});var fe=U(71297);ee={enumerable:!0,get:function(){return fe.BindingScopeEnum}},ee={enumerable:!0,get:function(){return fe.BindingTypeEnum}},ee={enumerable:!0,get:function(){return fe.TargetTypeEnum}};var Z=U(66440);ee={enumerable:!0,get:function(){return Z.AsyncContainerModule}},ee={enumerable:!0,get:function(){return Z.ContainerModule}};var he=U(66733);Object.defineProperty(re,"b2",{enumerable:!0,get:function(){return he.injectable}});var ce=U(76316);ee={enumerable:!0,get:function(){return ce.tagged}};var Ge=U(23769);ee={enumerable:!0,get:function(){return Ge.named}};var oe=U(71791);Object.defineProperty(re,"f3",{enumerable:!0,get:function(){return oe.inject}}),ee={enumerable:!0,get:function(){return oe.LazyServiceIdentifer}};var We=U(57758);ee={enumerable:!0,get:function(){return We.optional}};var qe=U(39868);ee={enumerable:!0,get:function(){return qe.unmanaged}};var pt=U(33406);ee={enumerable:!0,get:function(){return pt.multiInject}};var vt=U(26805);ee={enumerable:!0,get:function(){return vt.targetName}};var bt=U(82935);Object.defineProperty(re,"zY",{enumerable:!0,get:function(){return bt.postConstruct}});var Et=U(51288);ee={enumerable:!0,get:function(){return Et.MetadataReader}};var Dt=U(92452);ee={enumerable:!0,get:function(){return Dt.id}};var wt=U(38362);Object.defineProperty(re,"GW",{enumerable:!0,get:function(){return wt.decorate}});var at=U(95093);ee={enumerable:!0,get:function(){return at.traverseAncerstors}},ee={enumerable:!0,get:function(){return at.taggedConstraint}},ee={enumerable:!0,get:function(){return at.namedConstraint}},ee={enumerable:!0,get:function(){return at.typeConstraint}};var Tt=U(96783);ee={enumerable:!0,get:function(){return Tt.getServiceIdentifierAsString}};var wr=U(6024);ee={enumerable:!0,get:function(){return wr.multiBindToService}}},68338:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Context=void 0;var ee=U(92452),ve=function(){function _(fe){this.id=ee.id(),this.container=fe}return _.prototype.addPlan=function(fe){this.plan=fe},_.prototype.setCurrentRequest=function(fe){this.currentRequest=fe},_}();re.Context=ve},4957:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Metadata=void 0;var ee=U(17597),ve=function(){function _(fe,Z){this.key=fe,this.value=Z}return _.prototype.toString=function(){return this.key===ee.NAMED_TAG?"named: "+this.value.toString()+" ":"tagged: { key:"+this.key.toString()+", value: "+this.value+" }"},_}();re.Metadata=ve},51288:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.MetadataReader=void 0;var ee=U(17597),ve=function(){function _(){}return _.prototype.getConstructorMetadata=function(fe){var Z=Reflect.getMetadata(ee.PARAM_TYPES,fe),he=Reflect.getMetadata(ee.TAGGED,fe);return{compilerGeneratedMetadata:Z,userGeneratedMetadata:he||{}}},_.prototype.getPropertiesMetadata=function(fe){var Z=Reflect.getMetadata(ee.TAGGED_PROP,fe)||[];return Z},_}();re.MetadataReader=ve},30515:function(Qt,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Plan=void 0;var U=function(){function ee(ve,_){this.parentContext=ve,this.rootRequest=_}return ee}();re.Plan=U},14346:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.getBindingDictionary=re.createMockRequest=re.plan=void 0;var ee=U(53837),ve=U(81463),_=U(71297),fe=U(17597),Z=U(99438),he=U(96783),ce=U(68338),Ge=U(4957),oe=U(30515),We=U(4793),qe=U(39373),pt=U(90700);function vt(pr){return pr._bindingDictionary}re.getBindingDictionary=vt;function bt(pr,lr,Ot,ht,Ft,Qe){var Nt=pr?fe.MULTI_INJECT_TAG:fe.INJECT_TAG,sr=new Ge.Metadata(Nt,Ot),ie=new pt.Target(lr,ht,Ot,sr);if(Ft!==void 0){var W=new Ge.Metadata(Ft,Qe);ie.metadata.push(W)}return ie}function Et(pr,lr,Ot,ht,Ft){var Qe=at(Ot.container,Ft.serviceIdentifier),Nt=[];return Qe.length===ee.BindingCount.NoBindingsAvailable&&Ot.container.options.autoBindInjectable&&typeof Ft.serviceIdentifier=="function"&&pr.getConstructorMetadata(Ft.serviceIdentifier).compilerGeneratedMetadata&&(Ot.container.bind(Ft.serviceIdentifier).toSelf(),Qe=at(Ot.container,Ft.serviceIdentifier)),lr?Nt=Qe:Nt=Qe.filter(function(sr){var ie=new qe.Request(sr.serviceIdentifier,Ot,ht,sr,Ft);return sr.constraint(ie)}),Dt(Ft.serviceIdentifier,Nt,Ft,Ot.container),Nt}function Dt(pr,lr,Ot,ht){switch(lr.length){case ee.BindingCount.NoBindingsAvailable:if(Ot.isOptional())return lr;var Ft=he.getServiceIdentifierAsString(pr),Qe=ve.NOT_REGISTERED;throw Qe+=he.listMetadataForTarget(Ft,Ot),Qe+=he.listRegisteredBindingsForServiceIdentifier(ht,Ft,at),new Error(Qe);case ee.BindingCount.OnlyOneBindingAvailable:if(!Ot.isArray())return lr;case ee.BindingCount.MultipleBindingsAvailable:default:if(Ot.isArray())return lr;var Ft=he.getServiceIdentifierAsString(pr),Qe=ve.AMBIGUOUS_MATCH+" "+Ft;throw Qe+=he.listRegisteredBindingsForServiceIdentifier(ht,Ft,at),new Error(Qe)}}function wt(pr,lr,Ot,ht,Ft,Qe){var Nt,sr;if(Ft===null){Nt=Et(pr,lr,ht,null,Qe),sr=new qe.Request(Ot,ht,null,Nt,Qe);var ie=new oe.Plan(ht,sr);ht.addPlan(ie)}else Nt=Et(pr,lr,ht,Ft,Qe),sr=Ft.addChildRequest(Qe.serviceIdentifier,Nt,Qe);Nt.forEach(function(W){var te=null;if(Qe.isArray())te=sr.addChildRequest(W.serviceIdentifier,W,Qe);else{if(W.cache)return;te=sr}if(W.type===_.BindingTypeEnum.Instance&&W.implementationType!==null){var Oe=We.getDependencies(pr,W.implementationType);if(!ht.container.options.skipBaseClassChecks){var Te=We.getBaseClassDependencyCount(pr,W.implementationType);if(Oe.length<Te){var nt=ve.ARGUMENTS_LENGTH_MISMATCH(We.getFunctionName(W.implementationType));throw new Error(nt)}}Oe.forEach(function(De){wt(pr,!1,De.serviceIdentifier,ht,te,De)})}})}function at(pr,lr){var Ot=[],ht=vt(pr);return ht.hasKey(lr)?Ot=ht.get(lr):pr.parent!==null&&(Ot=at(pr.parent,lr)),Ot}function Tt(pr,lr,Ot,ht,Ft,Qe,Nt,sr){sr===void 0&&(sr=!1);var ie=new ce.Context(lr),W=bt(Ot,ht,Ft,"",Qe,Nt);try{return wt(pr,sr,Ft,ie,null,W),ie}catch(te){throw Z.isStackOverflowExeption(te)&&ie.plan&&he.circularDependencyToException(ie.plan.rootRequest),te}}re.plan=Tt;function wr(pr,lr,Ot,ht){var Ft=new pt.Target(_.TargetTypeEnum.Variable,"",lr,new Ge.Metadata(Ot,ht)),Qe=new ce.Context(pr),Nt=new qe.Request(lr,Qe,null,[],Ft);return Nt}re.createMockRequest=wr},41141:function(Qt,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.QueryableString=void 0;var U=function(){function ee(ve){this.str=ve}return ee.prototype.startsWith=function(ve){return this.str.indexOf(ve)===0},ee.prototype.endsWith=function(ve){var _="",fe=ve.split("").reverse().join("");return _=this.str.split("").reverse().join(""),this.startsWith.call({str:_},fe)},ee.prototype.contains=function(ve){return this.str.indexOf(ve)!==-1},ee.prototype.equals=function(ve){return this.str===ve},ee.prototype.value=function(){return this.str},ee}();re.QueryableString=U},4793:function(Qt,re,U){"use strict";var ee=this&&this.__spreadArray||function(Et,Dt){for(var wt=0,at=Dt.length,Tt=Et.length;wt<at;wt++,Tt++)Et[Tt]=Dt[wt];return Et};Object.defineProperty(re,"__esModule",{value:!0}),re.getFunctionName=re.getBaseClassDependencyCount=re.getDependencies=void 0;var ve=U(71791),_=U(81463),fe=U(71297),Z=U(17597),he=U(96783);Object.defineProperty(re,"getFunctionName",{enumerable:!0,get:function(){return he.getFunctionName}});var ce=U(90700);function Ge(Et,Dt){var wt=he.getFunctionName(Dt),at=oe(Et,wt,Dt,!1);return at}re.getDependencies=Ge;function oe(Et,Dt,wt,at){var Tt=Et.getConstructorMetadata(wt),wr=Tt.compilerGeneratedMetadata;if(wr===void 0){var pr=_.MISSING_INJECTABLE_ANNOTATION+" "+Dt+".";throw new Error(pr)}var lr=Tt.userGeneratedMetadata,Ot=Object.keys(lr),ht=wt.length===0&&Ot.length>0,Ft=Ot.length>wt.length,Qe=ht||Ft?Ot.length:wt.length,Nt=qe(at,Dt,wr,lr,Qe),sr=pt(Et,wt),ie=ee(ee([],Nt),sr);return ie}function We(Et,Dt,wt,at,Tt){var wr=Tt[Et.toString()]||[],pr=bt(wr),lr=pr.unmanaged!==!0,Ot=at[Et],ht=pr.inject||pr.multiInject;if(Ot=ht||Ot,Ot instanceof ve.LazyServiceIdentifer&&(Ot=Ot.unwrap()),lr){var Ft=Ot===Object,Qe=Ot===Function,Nt=Ot===void 0,sr=Ft||Qe||Nt;if(!Dt&&sr){var ie=_.MISSING_INJECT_ANNOTATION+" argument "+Et+" in class "+wt+".";throw new Error(ie)}var W=new ce.Target(fe.TargetTypeEnum.ConstructorArgument,pr.targetName,Ot);return W.metadata=wr,W}return null}function qe(Et,Dt,wt,at,Tt){for(var wr=[],pr=0;pr<Tt;pr++){var lr=pr,Ot=We(lr,Et,Dt,wt,at);Ot!==null&&wr.push(Ot)}return wr}function pt(Et,Dt){for(var wt=Et.getPropertiesMetadata(Dt),at=[],Tt=Object.keys(wt),wr=0,pr=Tt;wr<pr.length;wr++){var lr=pr[wr],Ot=wt[lr],ht=bt(wt[lr]),Ft=ht.targetName||lr,Qe=ht.inject||ht.multiInject,Nt=new ce.Target(fe.TargetTypeEnum.ClassProperty,Ft,Qe);Nt.metadata=Ot,at.push(Nt)}var sr=Object.getPrototypeOf(Dt.prototype).constructor;if(sr!==Object){var ie=pt(Et,sr);at=ee(ee([],at),ie)}return at}function vt(Et,Dt){var wt=Object.getPrototypeOf(Dt.prototype).constructor;if(wt!==Object){var at=he.getFunctionName(wt),Tt=oe(Et,at,wt,!0),wr=Tt.map(function(Ot){return Ot.metadata.filter(function(ht){return ht.key===Z.UNMANAGED_TAG})}),pr=[].concat.apply([],wr).length,lr=Tt.length-pr;return lr>0?lr:vt(Et,wt)}else return 0}re.getBaseClassDependencyCount=vt;function bt(Et){var Dt={};return Et.forEach(function(wt){Dt[wt.key.toString()]=wt.value}),{inject:Dt[Z.INJECT_TAG],multiInject:Dt[Z.MULTI_INJECT_TAG],targetName:Dt[Z.NAME_TAG],unmanaged:Dt[Z.UNMANAGED_TAG]}}},39373:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Request=void 0;var ee=U(92452),ve=function(){function _(fe,Z,he,ce,Ge){this.id=ee.id(),this.serviceIdentifier=fe,this.parentContext=Z,this.parentRequest=he,this.target=Ge,this.childRequests=[],this.bindings=Array.isArray(ce)?ce:[ce],this.requestScope=he===null?new Map:null}return _.prototype.addChildRequest=function(fe,Z,he){var ce=new _(fe,this.parentContext,this,Z,he);return this.childRequests.push(ce),ce},_}();re.Request=ve},90700:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.Target=void 0;var ee=U(17597),ve=U(92452),_=U(4957),fe=U(41141),Z=function(){function he(ce,Ge,oe,We){this.id=ve.id(),this.type=ce,this.serviceIdentifier=oe,this.name=new fe.QueryableString(Ge||""),this.metadata=new Array;var qe=null;typeof We=="string"?qe=new _.Metadata(ee.NAMED_TAG,We):We instanceof _.Metadata&&(qe=We),qe!==null&&this.metadata.push(qe)}return he.prototype.hasTag=function(ce){for(var Ge=0,oe=this.metadata;Ge<oe.length;Ge++){var We=oe[Ge];if(We.key===ce)return!0}return!1},he.prototype.isArray=function(){return this.hasTag(ee.MULTI_INJECT_TAG)},he.prototype.matchesArray=function(ce){return this.matchesTag(ee.MULTI_INJECT_TAG)(ce)},he.prototype.isNamed=function(){return this.hasTag(ee.NAMED_TAG)},he.prototype.isTagged=function(){return this.metadata.some(function(ce){return ee.NON_CUSTOM_TAG_KEYS.every(function(Ge){return ce.key!==Ge})})},he.prototype.isOptional=function(){return this.matchesTag(ee.OPTIONAL_TAG)(!0)},he.prototype.getNamedTag=function(){return this.isNamed()?this.metadata.filter(function(ce){return ce.key===ee.NAMED_TAG})[0]:null},he.prototype.getCustomTags=function(){return this.isTagged()?this.metadata.filter(function(ce){return ee.NON_CUSTOM_TAG_KEYS.every(function(Ge){return ce.key!==Ge})}):null},he.prototype.matchesNamedTag=function(ce){return this.matchesTag(ee.NAMED_TAG)(ce)},he.prototype.matchesTag=function(ce){var Ge=this;return function(oe){for(var We=0,qe=Ge.metadata;We<qe.length;We++){var pt=qe[We];if(pt.key===ce&&pt.value===oe)return!0}return!1}},he}();re.Target=Z},31831:function(Qt,re,U){"use strict";var ee=this&&this.__spreadArray||function(oe,We){for(var qe=0,pt=We.length,vt=oe.length;qe<pt;qe++,vt++)oe[vt]=We[qe];return oe};Object.defineProperty(re,"__esModule",{value:!0}),re.resolveInstance=void 0;var ve=U(81463),_=U(71297),fe=U(17597);function Z(oe,We,qe){var pt=We.filter(function(bt){return bt.target!==null&&bt.target.type===_.TargetTypeEnum.ClassProperty}),vt=pt.map(qe);return pt.forEach(function(bt,Et){var Dt="";Dt=bt.target.name.value();var wt=vt[Et];oe[Dt]=wt}),oe}function he(oe,We){return new(oe.bind.apply(oe,ee([void 0],We)))}function ce(oe,We){if(Reflect.hasMetadata(fe.POST_CONSTRUCT,oe)){var qe=Reflect.getMetadata(fe.POST_CONSTRUCT,oe);try{We[qe.value]()}catch(pt){throw new Error(ve.POST_CONSTRUCT_ERROR(oe.name,pt.message))}}}function Ge(oe,We,qe){var pt=null;if(We.length>0){var vt=We.filter(function(Et){return Et.target!==null&&Et.target.type===_.TargetTypeEnum.ConstructorArgument}),bt=vt.map(qe);pt=he(oe,bt),pt=Z(pt,We,qe)}else pt=new oe;return ce(oe,pt),pt}re.resolveInstance=Ge},50857:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.resolve=void 0;var ee=U(81463),ve=U(71297),_=U(99438),fe=U(96783),Z=U(31831),he=function(oe,We,qe){try{return qe()}catch(pt){throw _.isStackOverflowExeption(pt)?new Error(ee.CIRCULAR_DEPENDENCY_IN_FACTORY(oe,We.toString())):pt}},ce=function(oe){return function(We){We.parentContext.setCurrentRequest(We);var qe=We.bindings,pt=We.childRequests,vt=We.target&&We.target.isArray(),bt=!We.parentRequest||!We.parentRequest.target||!We.target||!We.parentRequest.target.matchesArray(We.target.serviceIdentifier);if(vt&&bt)return pt.map(function(wr){var pr=ce(oe);return pr(wr)});var Et=null;if(We.target.isOptional()&&qe.length===0)return;var Dt=qe[0],wt=Dt.scope===ve.BindingScopeEnum.Singleton,at=Dt.scope===ve.BindingScopeEnum.Request;if(wt&&Dt.activated)return Dt.cache;if(at&&oe!==null&&oe.has(Dt.id))return oe.get(Dt.id);if(Dt.type===ve.BindingTypeEnum.ConstantValue)Et=Dt.cache,Dt.activated=!0;else if(Dt.type===ve.BindingTypeEnum.Function)Et=Dt.cache,Dt.activated=!0;else if(Dt.type===ve.BindingTypeEnum.Constructor)Et=Dt.implementationType;else if(Dt.type===ve.BindingTypeEnum.DynamicValue&&Dt.dynamicValue!==null)Et=he("toDynamicValue",Dt.serviceIdentifier,function(){return Dt.dynamicValue(We.parentContext)});else if(Dt.type===ve.BindingTypeEnum.Factory&&Dt.factory!==null)Et=he("toFactory",Dt.serviceIdentifier,function(){return Dt.factory(We.parentContext)});else if(Dt.type===ve.BindingTypeEnum.Provider&&Dt.provider!==null)Et=he("toProvider",Dt.serviceIdentifier,function(){return Dt.provider(We.parentContext)});else if(Dt.type===ve.BindingTypeEnum.Instance&&Dt.implementationType!==null)Et=Z.resolveInstance(Dt.implementationType,pt,ce(oe));else{var Tt=fe.getServiceIdentifierAsString(We.serviceIdentifier);throw new Error(ee.INVALID_BINDING_TYPE+" "+Tt)}return typeof Dt.onActivation=="function"&&(Et=Dt.onActivation(We.parentContext,Et)),wt&&(Dt.cache=Et,Dt.activated=!0),at&&oe!==null&&!oe.has(Dt.id)&&oe.set(Dt.id,Et),Et}};function Ge(oe){var We=ce(oe.plan.rootRequest.requestScope);return We(oe.plan.rootRequest)}re.resolve=Ge},29664:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingInSyntax=void 0;var ee=U(71297),ve=U(62923),_=function(){function fe(Z){this._binding=Z}return fe.prototype.inRequestScope=function(){return this._binding.scope=ee.BindingScopeEnum.Request,new ve.BindingWhenOnSyntax(this._binding)},fe.prototype.inSingletonScope=function(){return this._binding.scope=ee.BindingScopeEnum.Singleton,new ve.BindingWhenOnSyntax(this._binding)},fe.prototype.inTransientScope=function(){return this._binding.scope=ee.BindingScopeEnum.Transient,new ve.BindingWhenOnSyntax(this._binding)},fe}();re.BindingInSyntax=_},35268:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingInWhenOnSyntax=void 0;var ee=U(29664),ve=U(85370),_=U(76199),fe=function(){function Z(he){this._binding=he,this._bindingWhenSyntax=new _.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ve.BindingOnSyntax(this._binding),this._bindingInSyntax=new ee.BindingInSyntax(he)}return Z.prototype.inRequestScope=function(){return this._bindingInSyntax.inRequestScope()},Z.prototype.inSingletonScope=function(){return this._bindingInSyntax.inSingletonScope()},Z.prototype.inTransientScope=function(){return this._bindingInSyntax.inTransientScope()},Z.prototype.when=function(he){return this._bindingWhenSyntax.when(he)},Z.prototype.whenTargetNamed=function(he){return this._bindingWhenSyntax.whenTargetNamed(he)},Z.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},Z.prototype.whenTargetTagged=function(he,ce){return this._bindingWhenSyntax.whenTargetTagged(he,ce)},Z.prototype.whenInjectedInto=function(he){return this._bindingWhenSyntax.whenInjectedInto(he)},Z.prototype.whenParentNamed=function(he){return this._bindingWhenSyntax.whenParentNamed(he)},Z.prototype.whenParentTagged=function(he,ce){return this._bindingWhenSyntax.whenParentTagged(he,ce)},Z.prototype.whenAnyAncestorIs=function(he){return this._bindingWhenSyntax.whenAnyAncestorIs(he)},Z.prototype.whenNoAncestorIs=function(he){return this._bindingWhenSyntax.whenNoAncestorIs(he)},Z.prototype.whenAnyAncestorNamed=function(he){return this._bindingWhenSyntax.whenAnyAncestorNamed(he)},Z.prototype.whenAnyAncestorTagged=function(he,ce){return this._bindingWhenSyntax.whenAnyAncestorTagged(he,ce)},Z.prototype.whenNoAncestorNamed=function(he){return this._bindingWhenSyntax.whenNoAncestorNamed(he)},Z.prototype.whenNoAncestorTagged=function(he,ce){return this._bindingWhenSyntax.whenNoAncestorTagged(he,ce)},Z.prototype.whenAnyAncestorMatches=function(he){return this._bindingWhenSyntax.whenAnyAncestorMatches(he)},Z.prototype.whenNoAncestorMatches=function(he){return this._bindingWhenSyntax.whenNoAncestorMatches(he)},Z.prototype.onActivation=function(he){return this._bindingOnSyntax.onActivation(he)},Z}();re.BindingInWhenOnSyntax=fe},85370:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingOnSyntax=void 0;var ee=U(76199),ve=function(){function _(fe){this._binding=fe}return _.prototype.onActivation=function(fe){return this._binding.onActivation=fe,new ee.BindingWhenSyntax(this._binding)},_}();re.BindingOnSyntax=ve},98e3:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingToSyntax=void 0;var ee=U(81463),ve=U(71297),_=U(35268),fe=U(62923),Z=function(){function he(ce){this._binding=ce}return he.prototype.to=function(ce){return this._binding.type=ve.BindingTypeEnum.Instance,this._binding.implementationType=ce,new _.BindingInWhenOnSyntax(this._binding)},he.prototype.toSelf=function(){if(typeof this._binding.serviceIdentifier!="function")throw new Error(""+ee.INVALID_TO_SELF_VALUE);var ce=this._binding.serviceIdentifier;return this.to(ce)},he.prototype.toConstantValue=function(ce){return this._binding.type=ve.BindingTypeEnum.ConstantValue,this._binding.cache=ce,this._binding.dynamicValue=null,this._binding.implementationType=null,this._binding.scope=ve.BindingScopeEnum.Singleton,new fe.BindingWhenOnSyntax(this._binding)},he.prototype.toDynamicValue=function(ce){return this._binding.type=ve.BindingTypeEnum.DynamicValue,this._binding.cache=null,this._binding.dynamicValue=ce,this._binding.implementationType=null,new _.BindingInWhenOnSyntax(this._binding)},he.prototype.toConstructor=function(ce){return this._binding.type=ve.BindingTypeEnum.Constructor,this._binding.implementationType=ce,this._binding.scope=ve.BindingScopeEnum.Singleton,new fe.BindingWhenOnSyntax(this._binding)},he.prototype.toFactory=function(ce){return this._binding.type=ve.BindingTypeEnum.Factory,this._binding.factory=ce,this._binding.scope=ve.BindingScopeEnum.Singleton,new fe.BindingWhenOnSyntax(this._binding)},he.prototype.toFunction=function(ce){if(typeof ce!="function")throw new Error(ee.INVALID_FUNCTION_BINDING);var Ge=this.toConstantValue(ce);return this._binding.type=ve.BindingTypeEnum.Function,this._binding.scope=ve.BindingScopeEnum.Singleton,Ge},he.prototype.toAutoFactory=function(ce){return this._binding.type=ve.BindingTypeEnum.Factory,this._binding.factory=function(Ge){var oe=function(){return Ge.container.get(ce)};return oe},this._binding.scope=ve.BindingScopeEnum.Singleton,new fe.BindingWhenOnSyntax(this._binding)},he.prototype.toProvider=function(ce){return this._binding.type=ve.BindingTypeEnum.Provider,this._binding.provider=ce,this._binding.scope=ve.BindingScopeEnum.Singleton,new fe.BindingWhenOnSyntax(this._binding)},he.prototype.toService=function(ce){this.toDynamicValue(function(Ge){return Ge.container.get(ce)})},he}();re.BindingToSyntax=Z},62923:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingWhenOnSyntax=void 0;var ee=U(85370),ve=U(76199),_=function(){function fe(Z){this._binding=Z,this._bindingWhenSyntax=new ve.BindingWhenSyntax(this._binding),this._bindingOnSyntax=new ee.BindingOnSyntax(this._binding)}return fe.prototype.when=function(Z){return this._bindingWhenSyntax.when(Z)},fe.prototype.whenTargetNamed=function(Z){return this._bindingWhenSyntax.whenTargetNamed(Z)},fe.prototype.whenTargetIsDefault=function(){return this._bindingWhenSyntax.whenTargetIsDefault()},fe.prototype.whenTargetTagged=function(Z,he){return this._bindingWhenSyntax.whenTargetTagged(Z,he)},fe.prototype.whenInjectedInto=function(Z){return this._bindingWhenSyntax.whenInjectedInto(Z)},fe.prototype.whenParentNamed=function(Z){return this._bindingWhenSyntax.whenParentNamed(Z)},fe.prototype.whenParentTagged=function(Z,he){return this._bindingWhenSyntax.whenParentTagged(Z,he)},fe.prototype.whenAnyAncestorIs=function(Z){return this._bindingWhenSyntax.whenAnyAncestorIs(Z)},fe.prototype.whenNoAncestorIs=function(Z){return this._bindingWhenSyntax.whenNoAncestorIs(Z)},fe.prototype.whenAnyAncestorNamed=function(Z){return this._bindingWhenSyntax.whenAnyAncestorNamed(Z)},fe.prototype.whenAnyAncestorTagged=function(Z,he){return this._bindingWhenSyntax.whenAnyAncestorTagged(Z,he)},fe.prototype.whenNoAncestorNamed=function(Z){return this._bindingWhenSyntax.whenNoAncestorNamed(Z)},fe.prototype.whenNoAncestorTagged=function(Z,he){return this._bindingWhenSyntax.whenNoAncestorTagged(Z,he)},fe.prototype.whenAnyAncestorMatches=function(Z){return this._bindingWhenSyntax.whenAnyAncestorMatches(Z)},fe.prototype.whenNoAncestorMatches=function(Z){return this._bindingWhenSyntax.whenNoAncestorMatches(Z)},fe.prototype.onActivation=function(Z){return this._bindingOnSyntax.onActivation(Z)},fe}();re.BindingWhenOnSyntax=_},76199:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.BindingWhenSyntax=void 0;var ee=U(85370),ve=U(95093),_=function(){function fe(Z){this._binding=Z}return fe.prototype.when=function(Z){return this._binding.constraint=Z,new ee.BindingOnSyntax(this._binding)},fe.prototype.whenTargetNamed=function(Z){return this._binding.constraint=ve.namedConstraint(Z),new ee.BindingOnSyntax(this._binding)},fe.prototype.whenTargetIsDefault=function(){return this._binding.constraint=function(Z){var he=Z.target!==null&&!Z.target.isNamed()&&!Z.target.isTagged();return he},new ee.BindingOnSyntax(this._binding)},fe.prototype.whenTargetTagged=function(Z,he){return this._binding.constraint=ve.taggedConstraint(Z)(he),new ee.BindingOnSyntax(this._binding)},fe.prototype.whenInjectedInto=function(Z){return this._binding.constraint=function(he){return ve.typeConstraint(Z)(he.parentRequest)},new ee.BindingOnSyntax(this._binding)},fe.prototype.whenParentNamed=function(Z){return this._binding.constraint=function(he){return ve.namedConstraint(Z)(he.parentRequest)},new ee.BindingOnSyntax(this._binding)},fe.prototype.whenParentTagged=function(Z,he){return this._binding.constraint=function(ce){return ve.taggedConstraint(Z)(he)(ce.parentRequest)},new ee.BindingOnSyntax(this._binding)},fe.prototype.whenAnyAncestorIs=function(Z){return this._binding.constraint=function(he){return ve.traverseAncerstors(he,ve.typeConstraint(Z))},new ee.BindingOnSyntax(this._binding)},fe.prototype.whenNoAncestorIs=function(Z){return this._binding.constraint=function(he){return!ve.traverseAncerstors(he,ve.typeConstraint(Z))},new ee.BindingOnSyntax(this._binding)},fe.prototype.whenAnyAncestorNamed=function(Z){return this._binding.constraint=function(he){return ve.traverseAncerstors(he,ve.namedConstraint(Z))},new ee.BindingOnSyntax(this._binding)},fe.prototype.whenNoAncestorNamed=function(Z){return this._binding.constraint=function(he){return!ve.traverseAncerstors(he,ve.namedConstraint(Z))},new ee.BindingOnSyntax(this._binding)},fe.prototype.whenAnyAncestorTagged=function(Z,he){return this._binding.constraint=function(ce){return ve.traverseAncerstors(ce,ve.taggedConstraint(Z)(he))},new ee.BindingOnSyntax(this._binding)},fe.prototype.whenNoAncestorTagged=function(Z,he){return this._binding.constraint=function(ce){return!ve.traverseAncerstors(ce,ve.taggedConstraint(Z)(he))},new ee.BindingOnSyntax(this._binding)},fe.prototype.whenAnyAncestorMatches=function(Z){return this._binding.constraint=function(he){return ve.traverseAncerstors(he,Z)},new ee.BindingOnSyntax(this._binding)},fe.prototype.whenNoAncestorMatches=function(Z){return this._binding.constraint=function(he){return!ve.traverseAncerstors(he,Z)},new ee.BindingOnSyntax(this._binding)},fe}();re.BindingWhenSyntax=_},95093:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.typeConstraint=re.namedConstraint=re.taggedConstraint=re.traverseAncerstors=void 0;var ee=U(17597),ve=U(4957),_=function(ce,Ge){var oe=ce.parentRequest;return oe!==null?Ge(oe)?!0:_(oe,Ge):!1};re.traverseAncerstors=_;var fe=function(ce){return function(Ge){var oe=function(We){return We!==null&&We.target!==null&&We.target.matchesTag(ce)(Ge)};return oe.metaData=new ve.Metadata(ce,Ge),oe}};re.taggedConstraint=fe;var Z=fe(ee.NAMED_TAG);re.namedConstraint=Z;var he=function(ce){return function(Ge){var oe=null;if(Ge!==null)if(oe=Ge.bindings[0],typeof ce=="string"){var We=oe.serviceIdentifier;return We===ce}else{var qe=Ge.bindings[0].implementationType;return ce===qe}return!1}};re.typeConstraint=he},6024:function(Qt,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.multiBindToService=void 0;var U=function(ee){return function(ve){return function(){for(var _=[],fe=0;fe<arguments.length;fe++)_[fe]=arguments[fe];return _.forEach(function(Z){return ee.bind(Z).toService(ve)})}}};re.multiBindToService=U},99438:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.isStackOverflowExeption=void 0;var ee=U(81463);function ve(_){return _ instanceof RangeError||_.message===ee.STACK_OVERFLOW}re.isStackOverflowExeption=ve},92452:function(Qt,re){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.id=void 0;var U=0;function ee(){return U++}re.id=ee},96783:function(Qt,re,U){"use strict";Object.defineProperty(re,"__esModule",{value:!0}),re.circularDependencyToException=re.listMetadataForTarget=re.listRegisteredBindingsForServiceIdentifier=re.getServiceIdentifierAsString=re.getFunctionName=void 0;var ee=U(81463);function ve(oe){if(typeof oe=="function"){var We=oe;return We.name}else{if(typeof oe=="symbol")return oe.toString();var We=oe;return We}}re.getServiceIdentifierAsString=ve;function _(oe,We,qe){var pt="",vt=qe(oe,We);return vt.length!==0&&(pt=`
Registered bindings:`,vt.forEach(function(bt){var Et="Object";bt.implementationType!==null&&(Et=Ge(bt.implementationType)),pt=pt+`
 `+Et,bt.constraint.metaData&&(pt=pt+" - "+bt.constraint.metaData)})),pt}re.listRegisteredBindingsForServiceIdentifier=_;function fe(oe,We){return oe.parentRequest===null?!1:oe.parentRequest.serviceIdentifier===We?!0:fe(oe.parentRequest,We)}function Z(oe){function We(pt,vt){vt===void 0&&(vt=[]);var bt=ve(pt.serviceIdentifier);return vt.push(bt),pt.parentRequest!==null?We(pt.parentRequest,vt):vt}var qe=We(oe);return qe.reverse().join(" --> ")}function he(oe){oe.childRequests.forEach(function(We){if(fe(We,We.serviceIdentifier)){var qe=Z(We);throw new Error(ee.CIRCULAR_DEPENDENCY+" "+qe)}else he(We)})}re.circularDependencyToException=he;function ce(oe,We){if(We.isTagged()||We.isNamed()){var qe="",pt=We.getNamedTag(),vt=We.getCustomTags();return pt!==null&&(qe+=pt.toString()+`
`),vt!==null&&vt.forEach(function(bt){qe+=bt.toString()+`
`})," "+oe+`
 `+oe+" - "+qe}else return" "+oe}re.listMetadataForTarget=ce;function Ge(oe){if(oe.name)return oe.name;var We=oe.toString(),qe=We.match(/^function\s*([^\s(]+)/);return qe?qe[1]:"Anonymous function: "+We}re.getFunctionName=Ge},45170:function(Qt,re,U){var ee=U(13807);function ve(_,fe){var Z=_==null?0:_.length;return!!Z&&ee(_,fe,0)>-1}Qt.exports=ve},94936:function(Qt){function re(U,ee,ve){for(var _=-1,fe=U==null?0:U.length;++_<fe;)if(ve(ee,U[_]))return!0;return!1}Qt.exports=re},54527:function(Qt){function re(U,ee,ve){return U===U&&(ve!==void 0&&(U=U<=ve?U:ve),ee!==void 0&&(U=U>=ee?U:ee)),U}Qt.exports=re},92504:function(Qt){function re(U,ee,ve,_){for(var fe=U.length,Z=ve+(_?1:-1);_?Z--:++Z<fe;)if(ee(U[Z],Z,U))return Z;return-1}Qt.exports=re},13807:function(Qt,re,U){var ee=U(92504),ve=U(99940),_=U(3729);function fe(Z,he,ce){return he===he?_(Z,he,ce):ee(Z,ve,ce)}Qt.exports=fe},70525:function(Qt){function re(U,ee,ve,_){for(var fe=ve-1,Z=U.length;++fe<Z;)if(_(U[fe],ee))return fe;return-1}Qt.exports=re},99940:function(Qt){function re(U){return U!==U}Qt.exports=re},66868:function(Qt,re,U){var ee=U(75697),ve=U(13807),_=U(70525),fe=U(58792),Z=U(47165),he=Array.prototype,ce=he.splice;function Ge(oe,We,qe,pt){var vt=pt?_:ve,bt=-1,Et=We.length,Dt=oe;for(oe===We&&(We=Z(We)),qe&&(Dt=ee(oe,fe(qe)));++bt<Et;)for(var wt=0,at=We[bt],Tt=qe?qe(at):at;(wt=vt(Dt,Tt,wt,pt))>-1;)Dt!==oe&&ce.call(Dt,wt,1),ce.call(oe,wt,1);return oe}Qt.exports=Ge},95453:function(Qt,re,U){var ee=U(78188),ve=U(45170),_=U(94936),fe=U(29880),Z=U(17319),he=U(79967),ce=200;function Ge(oe,We,qe){var pt=-1,vt=ve,bt=oe.length,Et=!0,Dt=[],wt=Dt;if(qe)Et=!1,vt=_;else if(bt>=ce){var at=We?null:Z(oe);if(at)return he(at);Et=!1,vt=fe,wt=new ee}else wt=We?[]:Dt;e:for(;++pt<bt;){var Tt=oe[pt],wr=We?We(Tt):Tt;if(Tt=qe||Tt!==0?Tt:0,Et&&wr===wr){for(var pr=wt.length;pr--;)if(wt[pr]===wr)continue e;We&&wt.push(wr),Dt.push(Tt)}else vt(wt,wr,qe)||(wt!==Dt&&wt.push(wr),Dt.push(Tt))}return Dt}Qt.exports=Ge},17319:function(Qt,re,U){var ee=U(81956),ve=U(43226),_=U(79967),fe=1/0,Z=ee&&1/_(new ee([,-0]))[1]==fe?function(he){return new ee(he)}:ve;Qt.exports=Z},3729:function(Qt){function re(U,ee,ve){for(var _=ve-1,fe=U.length;++_<fe;)if(U[_]===ee)return _;return-1}Qt.exports=re},35636:function(Qt,re,U){var ee=U(54527),ve=U(12448);function _(fe,Z,he){return he===void 0&&(he=Z,Z=void 0),he!==void 0&&(he=ve(he),he=he===he?he:0),Z!==void 0&&(Z=ve(Z),Z=Z===Z?Z:0),ee(ve(fe),Z,he)}Qt.exports=_},98071:function(Qt,re,U){var ee=U(80732),ve=U(55073),_="[object Boolean]";function fe(Z){return Z===!0||Z===!1||ve(Z)&&ee(Z)==_}Qt.exports=fe},31223:function(Qt,re,U){var ee=U(6620);function ve(_,fe){return ee(_,fe)}Qt.exports=ve},46207:function(Qt){function re(U){return U==null}Qt.exports=re},59933:function(Qt,re,U){var ee=U(80732),ve=U(55073),_="[object Number]";function fe(Z){return typeof Z=="number"||ve(Z)&&ee(Z)==_}Qt.exports=fe},89300:function(Qt){function re(U){return U===void 0}Qt.exports=re},53954:function(Qt,re,U){var ee=U(97254),ve=U(77991),_=ve(function(fe,Z,he,ce){ee(fe,Z,he,ce)});Qt.exports=_},43226:function(Qt){function re(){}Qt.exports=re},25066:function(Qt,re,U){var ee=U(5125),ve=U(20396),_=ee(ve);Qt.exports=_},20396:function(Qt,re,U){var ee=U(66868);function ve(_,fe){return _&&_.length&&fe&&fe.length?ee(_,fe):_}Qt.exports=ve},4363:function(Qt,re,U){var ee=U(95453);function ve(_){return _&&_.length?ee(_):[]}Qt.exports=ve},86463:function(Qt){(function(re,U){Qt.exports=U()})(this,function(){"use strict";var re,U,ee;function ve(_,fe){if(!re)re=fe;else if(!U)U=fe;else{var Z="var sharedChunk = {}; ("+re+")(sharedChunk); ("+U+")(sharedChunk);",he={};re(he),ee=fe(he),typeof window!="undefined"&&(ee.workerUrl=window.URL.createObjectURL(new Blob([Z],{type:"text/javascript"})))}}return ve(["exports"],function(_){"use strict";function fe(o,u){return o(u={exports:{}},u.exports),u.exports}var Z=he;function he(o,u,c,m){this.cx=3*o,this.bx=3*(c-o)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*u,this.by=3*(m-u)-this.cy,this.ay=1-this.cy-this.by,this.p1x=o,this.p1y=m,this.p2x=c,this.p2y=m}he.prototype.sampleCurveX=function(o){return((this.ax*o+this.bx)*o+this.cx)*o},he.prototype.sampleCurveY=function(o){return((this.ay*o+this.by)*o+this.cy)*o},he.prototype.sampleCurveDerivativeX=function(o){return(3*this.ax*o+2*this.bx)*o+this.cx},he.prototype.solveCurveX=function(o,u){var c,m,x,E,A;for(u===void 0&&(u=1e-6),x=o,A=0;A<8;A++){if(E=this.sampleCurveX(x)-o,Math.abs(E)<u)return x;var R=this.sampleCurveDerivativeX(x);if(Math.abs(R)<1e-6)break;x-=E/R}if((x=o)<(c=0))return c;if(x>(m=1))return m;for(;c<m;){if(E=this.sampleCurveX(x),Math.abs(E-o)<u)return x;o>E?c=x:m=x,x=.5*(m-c)+c}return x},he.prototype.solve=function(o,u){return this.sampleCurveY(this.solveCurveX(o,u))};var ce=Ge;function Ge(o,u){this.x=o,this.y=u}Ge.prototype={clone:function(){return new Ge(this.x,this.y)},add:function(o){return this.clone()._add(o)},sub:function(o){return this.clone()._sub(o)},multByPoint:function(o){return this.clone()._multByPoint(o)},divByPoint:function(o){return this.clone()._divByPoint(o)},mult:function(o){return this.clone()._mult(o)},div:function(o){return this.clone()._div(o)},rotate:function(o){return this.clone()._rotate(o)},rotateAround:function(o,u){return this.clone()._rotateAround(o,u)},matMult:function(o){return this.clone()._matMult(o)},unit:function(){return this.clone()._unit()},perp:function(){return this.clone()._perp()},round:function(){return this.clone()._round()},mag:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals:function(o){return this.x===o.x&&this.y===o.y},dist:function(o){return Math.sqrt(this.distSqr(o))},distSqr:function(o){var u=o.x-this.x,c=o.y-this.y;return u*u+c*c},angle:function(){return Math.atan2(this.y,this.x)},angleTo:function(o){return Math.atan2(this.y-o.y,this.x-o.x)},angleWith:function(o){return this.angleWithSep(o.x,o.y)},angleWithSep:function(o,u){return Math.atan2(this.x*u-this.y*o,this.x*o+this.y*u)},_matMult:function(o){var u=o[2]*this.x+o[3]*this.y;return this.x=o[0]*this.x+o[1]*this.y,this.y=u,this},_add:function(o){return this.x+=o.x,this.y+=o.y,this},_sub:function(o){return this.x-=o.x,this.y-=o.y,this},_mult:function(o){return this.x*=o,this.y*=o,this},_div:function(o){return this.x/=o,this.y/=o,this},_multByPoint:function(o){return this.x*=o.x,this.y*=o.y,this},_divByPoint:function(o){return this.x/=o.x,this.y/=o.y,this},_unit:function(){return this._div(this.mag()),this},_perp:function(){var o=this.y;return this.y=this.x,this.x=-o,this},_rotate:function(o){var u=Math.cos(o),c=Math.sin(o),m=c*this.x+u*this.y;return this.x=u*this.x-c*this.y,this.y=m,this},_rotateAround:function(o,u){var c=Math.cos(o),m=Math.sin(o),x=u.y+m*(this.x-u.x)+c*(this.y-u.y);return this.x=u.x+c*(this.x-u.x)-m*(this.y-u.y),this.y=x,this},_round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this}},Ge.convert=function(o){return o instanceof Ge?o:Array.isArray(o)?new Ge(o[0],o[1]):o};var oe=typeof self!="undefined"?self:{},We=Math.pow(2,53)-1;function qe(o,u,c,m){var x=new Z(o,u,c,m);return function(E){return x.solve(E)}}var pt=qe(.25,.1,.25,1);function vt(o,u,c){return Math.min(c,Math.max(u,o))}function bt(o,u,c){var m=c-u,x=((o-u)%m+m)%m+u;return x===u?c:x}function Et(o){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];for(var m=0,x=u;m<x.length;m+=1){var E=x[m];for(var A in E)o[A]=E[A]}return o}var Dt=1;function wt(){return Dt++}function at(){return function o(u){return u?(u^16*Math.random()>>u/4).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,o)}()}function Tt(o){return!!o&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(o)}function wr(o,u){o.forEach(function(c){u[c]&&(u[c]=u[c].bind(u))})}function pr(o,u){return o.indexOf(u,o.length-u.length)!==-1}function lr(o,u,c){var m={};for(var x in o)m[x]=u.call(c||this,o[x],x,o);return m}function Ot(o,u,c){var m={};for(var x in o)u.call(c||this,o[x],x,o)&&(m[x]=o[x]);return m}function ht(o){return Array.isArray(o)?o.map(ht):typeof o=="object"&&o?lr(o,ht):o}var Ft={};function Qe(o){Ft[o]||(typeof console!="undefined"&&console.warn(o),Ft[o]=!0)}function Nt(o,u,c){return(c.y-o.y)*(u.x-o.x)>(u.y-o.y)*(c.x-o.x)}function sr(o){for(var u=0,c=0,m=o.length,x=m-1,E=void 0,A=void 0;c<m;x=c++)u+=((A=o[x]).x-(E=o[c]).x)*(E.y+A.y);return u}function ie(){return typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope}function W(o){var u={};if(o.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,function(m,x,E,A){var R=E||A;return u[x]=!R||R.toLowerCase(),""}),u["max-age"]){var c=parseInt(u["max-age"],10);isNaN(c)?delete u["max-age"]:u["max-age"]=c}return u}var te=null;function Oe(o){if(te==null){var u=o.navigator?o.navigator.userAgent:null;te=!!o.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return te}function Te(o){try{var u=oe[o];return u.setItem("_mapbox_test_",1),u.removeItem("_mapbox_test_"),!0}catch(c){return!1}}var nt,De,Ze,Ke,At=oe.performance&&oe.performance.now?oe.performance.now.bind(oe.performance):Date.now.bind(Date),dr=oe.requestAnimationFrame||oe.mozRequestAnimationFrame||oe.webkitRequestAnimationFrame||oe.msRequestAnimationFrame,Pt=oe.cancelAnimationFrame||oe.mozCancelAnimationFrame||oe.webkitCancelAnimationFrame||oe.msCancelAnimationFrame,fn={now:At,frame:function(o){var u=dr(o);return{cancel:function(){return Pt(u)}}},getImageData:function(o,u){u===void 0&&(u=0);var c=oe.document.createElement("canvas"),m=c.getContext("2d");if(!m)throw new Error("failed to create canvas 2d context");return c.width=o.width,c.height=o.height,m.drawImage(o,0,0,o.width,o.height),m.getImageData(-u,-u,o.width+2*u,o.height+2*u)},resolveURL:function(o){return nt||(nt=oe.document.createElement("a")),nt.href=o,nt.href},hardwareConcurrency:oe.navigator&&oe.navigator.hardwareConcurrency||4,get devicePixelRatio(){return oe.devicePixelRatio},get prefersReducedMotion(){return!!oe.matchMedia&&(De==null&&(De=oe.matchMedia("(prefers-reduced-motion: reduce)")),De.matches)}},cn={API_URL:"https://api.mapbox.com",get EVENTS_URL(){return this.API_URL?this.API_URL.indexOf("https://api.mapbox.cn")===0?"https://events.mapbox.cn/events/v2":this.API_URL.indexOf("https://api.mapbox.com")===0?"https://events.mapbox.com/events/v2":null:null},FEEDBACK_URL:"https://apps.mapbox.com/feedback",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,MAX_PARALLEL_IMAGE_REQUESTS:16},Lr={supported:!1,testSupport:function(o){!Fn&&Ke&&(Sn?Jr(o):Ze=o)}},Fn=!1,Sn=!1;function Jr(o){var u=o.createTexture();o.bindTexture(o.TEXTURE_2D,u);try{if(o.texImage2D(o.TEXTURE_2D,0,o.RGBA,o.RGBA,o.UNSIGNED_BYTE,Ke),o.isContextLost())return;Lr.supported=!0}catch(c){}o.deleteTexture(u),Fn=!0}oe.document&&((Ke=oe.document.createElement("img")).onload=function(){Ze&&Jr(Ze),Ze=null,Sn=!0},Ke.onerror=function(){Fn=!0,Ze=null},Ke.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");var bi="01",Gn=function(o,u){this._transformRequestFn=o,this._customAccessToken=u,this._createSkuToken()};function zi(o){return o.indexOf("mapbox:")===0}Gn.prototype._createSkuToken=function(){var o=function(){for(var u="",c=0;c<10;c++)u+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",bi,u].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=o.token,this._skuTokenExpiresAt=o.tokenExpiresAt},Gn.prototype._isSkuTokenExpired=function(){return Date.now()>this._skuTokenExpiresAt},Gn.prototype.transformRequest=function(o,u){return this._transformRequestFn&&this._transformRequestFn(o,u)||{url:o}},Gn.prototype.normalizeStyleURL=function(o,u){if(!zi(o))return o;var c=Zi(o);return c.path="/styles/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||u)},Gn.prototype.normalizeGlyphsURL=function(o,u){if(!zi(o))return o;var c=Zi(o);return c.path="/fonts/v1"+c.path,this._makeAPIURL(c,this._customAccessToken||u)},Gn.prototype.normalizeSourceURL=function(o,u){if(!zi(o))return o;var c=Zi(o);return c.path="/v4/"+c.authority+".json",c.params.push("secure"),this._makeAPIURL(c,this._customAccessToken||u)},Gn.prototype.normalizeSpriteURL=function(o,u,c,m){var x=Zi(o);return zi(o)?(x.path="/styles/v1"+x.path+"/sprite"+u+c,this._makeAPIURL(x,this._customAccessToken||m)):(x.path+=""+u+c,Ma(x))},Gn.prototype.normalizeTileURL=function(o,u){if(this._isSkuTokenExpired()&&this._createSkuToken(),o&&!zi(o))return o;var c=Zi(o);c.path=c.path.replace(/(\.(png|jpg)\d*)(?=$)/,(fn.devicePixelRatio>=2||u===512?"@2x":"")+(Lr.supported?".webp":"$1")),c.path=c.path.replace(/^.+\/v4\//,"/"),c.path="/v4"+c.path;var m=this._customAccessToken||function(x){for(var E=0,A=x;E<A.length;E+=1){var R=A[E].match(/^access_token=(.*)$/);if(R)return R[1]}return null}(c.params)||cn.ACCESS_TOKEN;return cn.REQUIRE_ACCESS_TOKEN&&m&&this._skuToken&&c.params.push("sku="+this._skuToken),this._makeAPIURL(c,m)},Gn.prototype.canonicalizeTileURL=function(o,u){var c=Zi(o);if(!c.path.match(/(^\/v4\/)/)||!c.path.match(/\.[\w]+$/))return o;var m="mapbox://tiles/";m+=c.path.replace("/v4/","");var x=c.params;return u&&(x=x.filter(function(E){return!E.match(/^access_token=/)})),x.length&&(m+="?"+x.join("&")),m},Gn.prototype.canonicalizeTileset=function(o,u){for(var c=!!u&&zi(u),m=[],x=0,E=o.tiles||[];x<E.length;x+=1){var A=E[x];Pn(A)?m.push(this.canonicalizeTileURL(A,c)):m.push(A)}return m},Gn.prototype._makeAPIURL=function(o,u){var c="See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes",m=Zi(cn.API_URL);if(o.protocol=m.protocol,o.authority=m.authority,o.protocol==="http"){var x=o.params.indexOf("secure");x>=0&&o.params.splice(x,1)}if(m.path!=="/"&&(o.path=""+m.path+o.path),!cn.REQUIRE_ACCESS_TOKEN)return Ma(o);if(!(u=u||cn.ACCESS_TOKEN))throw new Error("An API access token is required to use Mapbox GL. "+c);if(u[0]==="s")throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). "+c);return o.params=o.params.filter(function(E){return E.indexOf("access_token")===-1}),o.params.push("access_token="+u),Ma(o)};var bn=/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i;function Pn(o){return bn.test(o)}var Aa=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Zi(o){var u=o.match(Aa);if(!u)throw new Error("Unable to parse URL object");return{protocol:u[1],authority:u[2],path:u[3]||"/",params:u[4]?u[4].split("&"):[]}}function Ma(o){var u=o.params.length?"?"+o.params.join("&"):"";return o.protocol+"://"+o.authority+o.path+u}function To(o){if(!o)return null;var u=o.split(".");if(!u||u.length!==3)return null;try{return JSON.parse(decodeURIComponent(oe.atob(u[1]).split("").map(function(c){return"%"+("00"+c.charCodeAt(0).toString(16)).slice(-2)}).join("")))}catch(c){return null}}var Ce=function(o){this.type=o,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null};Ce.prototype.getStorageKey=function(o){var u,c=To(cn.ACCESS_TOKEN);return u=c&&c.u?oe.btoa(encodeURIComponent(c.u).replace(/%([0-9A-F]{2})/g,function(m,x){return String.fromCharCode(+("0x"+x))})):cn.ACCESS_TOKEN||"",o?"mapbox.eventData."+o+":"+u:"mapbox.eventData:"+u},Ce.prototype.fetchEventData=function(){var o=Te("localStorage"),u=this.getStorageKey(),c=this.getStorageKey("uuid");if(o)try{var m=oe.localStorage.getItem(u);m&&(this.eventData=JSON.parse(m));var x=oe.localStorage.getItem(c);x&&(this.anonId=x)}catch(E){Qe("Unable to read from LocalStorage")}},Ce.prototype.saveEventData=function(){var o=Te("localStorage"),u=this.getStorageKey(),c=this.getStorageKey("uuid");if(o)try{oe.localStorage.setItem(c,this.anonId),Object.keys(this.eventData).length>=1&&oe.localStorage.setItem(u,JSON.stringify(this.eventData))}catch(m){Qe("Unable to write to LocalStorage")}},Ce.prototype.processRequests=function(o){},Ce.prototype.postEvent=function(o,u,c,m){var x=this;if(cn.EVENTS_URL){var E=Zi(cn.EVENTS_URL);E.params.push("access_token="+(m||cn.ACCESS_TOKEN||""));var A={event:this.type,created:new Date(o).toISOString(),sdkIdentifier:"mapbox-gl-js",sdkVersion:"1.13.3",skuId:bi,userId:this.anonId},R=u?Et(A,u):A,L={url:Ma(E),headers:{"Content-Type":"text/plain"},body:JSON.stringify([R])};this.pendingRequest=mt(L,function(V){x.pendingRequest=null,c(V),x.saveEventData(),x.processRequests(m)})}},Ce.prototype.queueRequest=function(o,u){this.queue.push(o),this.processRequests(u)};var Ia,Ta,no=function(o){function u(){o.call(this,"map.load"),this.success={},this.skuToken=""}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.postMapLoadEvent=function(c,m,x,E){this.skuToken=x;var A=!(!E&&!cn.ACCESS_TOKEN),R=Array.isArray(c)&&c.some(function(L){return zi(L)||Pn(L)});cn.EVENTS_URL&&A&&R&&this.queueRequest({id:m,timestamp:Date.now()},E)},u.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){var x=this.queue.shift(),E=x.id,A=x.timestamp;E&&this.success[E]||(this.anonId||this.fetchEventData(),Tt(this.anonId)||(this.anonId=at()),this.postEvent(A,{skuToken:this.skuToken},function(R){R||E&&(m.success[E]=!0)},c))}},u}(Ce),qs=new(function(o){function u(c){o.call(this,"appUserTurnstile"),this._customAccessToken=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.postTurnstileEvent=function(c,m){cn.EVENTS_URL&&cn.ACCESS_TOKEN&&Array.isArray(c)&&c.some(function(x){return zi(x)||Pn(x)})&&this.queueRequest(Date.now(),m)},u.prototype.processRequests=function(c){var m=this;if(!this.pendingRequest&&this.queue.length!==0){this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();var x=To(cn.ACCESS_TOKEN),E=x?x.u:cn.ACCESS_TOKEN,A=E!==this.eventData.tokenU;Tt(this.anonId)||(this.anonId=at(),A=!0);var R=this.queue.shift();if(this.eventData.lastSuccess){var L=new Date(this.eventData.lastSuccess),V=new Date(R),Y=(R-this.eventData.lastSuccess)/864e5;A=A||Y>=1||Y<-1||L.getDate()!==V.getDate()}else A=!0;if(!A)return this.processRequests();this.postEvent(R,{"enabled.telemetry":!1},function(K){K||(m.eventData.lastSuccess=R,m.eventData.tokenU=E)},c)}},u}(Ce)),Rs=qs.postTurnstileEvent.bind(qs),ts=new no,Wt=ts.postMapLoadEvent.bind(ts),xr=500,Gr=50;function nn(){oe.caches&&!Ia&&(Ia=oe.caches.open("mapbox-tiles"))}function Nn(o){var u=o.indexOf("?");return u<0?o:o.slice(0,u)}var Ki,ue=1/0;function D(){return Ki==null&&(Ki=oe.OffscreenCanvas&&new oe.OffscreenCanvas(1,1).getContext("2d")&&typeof oe.createImageBitmap=="function"),Ki}var z={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Image:"Image"};typeof Object.freeze=="function"&&Object.freeze(z);var se=function(o){function u(c,m,x){m===401&&Pn(x)&&(c+=": you may have provided an invalid Mapbox access token. See https://www.mapbox.com/api-documentation/#access-tokens-and-token-scopes"),o.call(this,c),this.status=m,this.url=x,this.name=this.constructor.name,this.message=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.toString=function(){return this.name+": "+this.message+" ("+this.status+"): "+this.url},u}(Error),be=ie()?function(){return self.worker&&self.worker.referrer}:function(){return(oe.location.protocol==="blob:"?oe.parent:oe).location.href},ke,Ht,Mt=function(o,u){if(!(/^file:/.test(c=o.url)||/^file:/.test(be())&&!/^\w+:/.test(c))){if(oe.fetch&&oe.Request&&oe.AbortController&&oe.Request.prototype.hasOwnProperty("signal"))return function(m,x){var E,A=new oe.AbortController,R=new oe.Request(m.url,{method:m.method||"GET",body:m.body,credentials:m.credentials,headers:m.headers,referrer:be(),signal:A.signal}),L=!1,V=!1,Y=(E=R.url).indexOf("sku=")>0&&Pn(E);m.type==="json"&&R.headers.set("Accept","application/json");var K=function(de,Ne,I){if(!V){if(de&&de.message!=="SecurityError"&&Qe(de),Ne&&I)return le(Ne);var ft=Date.now();oe.fetch(R).then(function(tt){if(tt.ok){var Rt=Y?tt.clone():null;return le(tt,Rt,ft)}return x(new se(tt.statusText,tt.status,m.url))}).catch(function(tt){tt.code!==20&&x(new Error(tt.message))})}},le=function(de,Ne,I){(m.type==="arrayBuffer"?de.arrayBuffer():m.type==="json"?de.json():de.text()).then(function(ft){V||(Ne&&I&&function(tt,Rt,zt){if(nn(),Ia){var ir={status:Rt.status,statusText:Rt.statusText,headers:new oe.Headers};Rt.headers.forEach(function(mr,Zr){return ir.headers.set(Zr,mr)});var or=W(Rt.headers.get("Cache-Control")||"");or["no-store"]||(or["max-age"]&&ir.headers.set("Expires",new Date(zt+1e3*or["max-age"]).toUTCString()),new Date(ir.headers.get("Expires")).getTime()-zt<42e4||function(mr,Zr){if(Ta===void 0)try{new Response(new ReadableStream),Ta=!0}catch(qr){Ta=!1}Ta?Zr(mr.body):mr.blob().then(Zr)}(Rt,function(mr){var Zr=new oe.Response(mr,ir);nn(),Ia&&Ia.then(function(qr){return qr.put(Nn(tt.url),Zr)}).catch(function(qr){return Qe(qr.message)})}))}}(R,Ne,I),L=!0,x(null,ft,de.headers.get("Cache-Control"),de.headers.get("Expires")))}).catch(function(ft){V||x(new Error(ft.message))})};return Y?function(de,Ne){if(nn(),!Ia)return Ne(null);var I=Nn(de.url);Ia.then(function(ft){ft.match(I).then(function(tt){var Rt=function(zt){if(!zt)return!1;var ir=new Date(zt.headers.get("Expires")||0),or=W(zt.headers.get("Cache-Control")||"");return ir>Date.now()&&!or["no-cache"]}(tt);ft.delete(I),Rt&&ft.put(I,tt.clone()),Ne(null,tt,Rt)}).catch(Ne)}).catch(Ne)}(R,K):K(null,null),{cancel:function(){V=!0,L||A.abort()}}}(o,u);if(ie()&&self.worker&&self.worker.actor)return self.worker.actor.send("getResource",o,u,void 0,!0)}var c;return function(m,x){var E=new oe.XMLHttpRequest;for(var A in E.open(m.method||"GET",m.url,!0),m.type==="arrayBuffer"&&(E.responseType="arraybuffer"),m.headers)E.setRequestHeader(A,m.headers[A]);return m.type==="json"&&(E.responseType="text",E.setRequestHeader("Accept","application/json")),E.withCredentials=m.credentials==="include",E.onerror=function(){x(new Error(E.statusText))},E.onload=function(){if((E.status>=200&&E.status<300||E.status===0)&&E.response!==null){var R=E.response;if(m.type==="json")try{R=JSON.parse(E.response)}catch(L){return x(L)}x(null,R,E.getResponseHeader("Cache-Control"),E.getResponseHeader("Expires"))}else x(new se(E.statusText,E.status,m.url))},E.send(m.body),{cancel:function(){return E.abort()}}}(o,u)},Lt=function(o,u){return Mt(Et(o,{type:"arrayBuffer"}),u)},mt=function(o,u){return Mt(Et(o,{method:"POST"}),u)},N="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";ke=[],Ht=0;var B=function(o,u){if(Lr.supported&&(o.headers||(o.headers={}),o.headers.accept="image/webp,*/*"),Ht>=cn.MAX_PARALLEL_IMAGE_REQUESTS){var c={requestParameters:o,callback:u,cancelled:!1,cancel:function(){this.cancelled=!0}};return ke.push(c),c}Ht++;var m=!1,x=function(){if(!m)for(m=!0,Ht--;ke.length&&Ht<cn.MAX_PARALLEL_IMAGE_REQUESTS;){var A=ke.shift();A.cancelled||(A.cancel=B(A.requestParameters,A.callback).cancel)}},E=Lt(o,function(A,R,L,V){x(),A?u(A):R&&(D()?function(Y,K){var le=new oe.Blob([new Uint8Array(Y)],{type:"image/png"});oe.createImageBitmap(le).then(function(de){K(null,de)}).catch(function(de){K(new Error("Could not load image because of "+de.message+". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))})}(R,u):function(Y,K,le,de){var Ne=new oe.Image,I=oe.URL;Ne.onload=function(){K(null,Ne),I.revokeObjectURL(Ne.src),Ne.onload=null,oe.requestAnimationFrame(function(){Ne.src=N})},Ne.onerror=function(){return K(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."))};var ft=new oe.Blob([new Uint8Array(Y)],{type:"image/png"});Ne.cacheControl=le,Ne.expires=de,Ne.src=Y.byteLength?I.createObjectURL(ft):N}(R,u,L,V))});return{cancel:function(){E.cancel(),x()}}};function $(o,u,c){c[o]&&c[o].indexOf(u)!==-1||(c[o]=c[o]||[],c[o].push(u))}function ne(o,u,c){if(c&&c[o]){var m=c[o].indexOf(u);m!==-1&&c[o].splice(m,1)}}var xe=function(o,u){u===void 0&&(u={}),Et(this,u),this.type=o},Fe=function(o){function u(c,m){m===void 0&&(m={}),o.call(this,"error",Et({error:c},m))}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(xe),et=function(){};et.prototype.on=function(o,u){return this._listeners=this._listeners||{},$(o,u,this._listeners),this},et.prototype.off=function(o,u){return ne(o,u,this._listeners),ne(o,u,this._oneTimeListeners),this},et.prototype.once=function(o,u){return this._oneTimeListeners=this._oneTimeListeners||{},$(o,u,this._oneTimeListeners),this},et.prototype.fire=function(o,u){typeof o=="string"&&(o=new xe(o,u||{}));var c=o.type;if(this.listens(c)){o.target=this;for(var m=0,x=this._listeners&&this._listeners[c]?this._listeners[c].slice():[];m<x.length;m+=1)x[m].call(this,o);for(var E=0,A=this._oneTimeListeners&&this._oneTimeListeners[c]?this._oneTimeListeners[c].slice():[];E<A.length;E+=1){var R=A[E];ne(c,R,this._oneTimeListeners),R.call(this,o)}var L=this._eventedParent;L&&(Et(o,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),L.fire(o))}else o instanceof Fe&&console.error(o.error);return this},et.prototype.listens=function(o){return this._listeners&&this._listeners[o]&&this._listeners[o].length>0||this._oneTimeListeners&&this._oneTimeListeners[o]&&this._oneTimeListeners[o].length>0||this._eventedParent&&this._eventedParent.listens(o)},et.prototype.setEventedParent=function(o,u){return this._eventedParent=o,this._eventedParentData=u,this};var j={$version:8,$root:{version:{required:!0,type:"enum",values:[8]},name:{type:"string"},metadata:{type:"*"},center:{type:"array",value:"number"},zoom:{type:"number"},bearing:{type:"number",default:0,period:360,units:"degrees"},pitch:{type:"number",default:0,units:"degrees"},light:{type:"light"},sources:{required:!0,type:"sources"},sprite:{type:"string"},glyphs:{type:"string"},transition:{type:"transition"},layers:{required:!0,type:"array",value:"layer"}},sources:{"*":{type:"source"}},source:["source_vector","source_raster","source_raster_dem","source_geojson","source_video","source_image"],source_vector:{type:{required:!0,type:"enum",values:{vector:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},attribution:{type:"string"},promoteId:{type:"promoteId"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster:{type:{required:!0,type:"enum",values:{raster:{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},scheme:{type:"enum",values:{xyz:{},tms:{}},default:"xyz"},attribution:{type:"string"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_raster_dem:{type:{required:!0,type:"enum",values:{"raster-dem":{}}},url:{type:"string"},tiles:{type:"array",value:"string"},bounds:{type:"array",value:"number",length:4,default:[-180,-85.051129,180,85.051129]},minzoom:{type:"number",default:0},maxzoom:{type:"number",default:22},tileSize:{type:"number",default:512,units:"pixels"},attribution:{type:"string"},encoding:{type:"enum",values:{terrarium:{},mapbox:{}},default:"mapbox"},volatile:{type:"boolean",default:!1},"*":{type:"*"}},source_geojson:{type:{required:!0,type:"enum",values:{geojson:{}}},data:{type:"*"},maxzoom:{type:"number",default:18},attribution:{type:"string"},buffer:{type:"number",default:128,maximum:512,minimum:0},filter:{type:"*"},tolerance:{type:"number",default:.375},cluster:{type:"boolean",default:!1},clusterRadius:{type:"number",default:50,minimum:0},clusterMaxZoom:{type:"number"},clusterMinPoints:{type:"number"},clusterProperties:{type:"*"},lineMetrics:{type:"boolean",default:!1},generateId:{type:"boolean",default:!1},promoteId:{type:"promoteId"}},source_video:{type:{required:!0,type:"enum",values:{video:{}}},urls:{required:!0,type:"array",value:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},source_image:{type:{required:!0,type:"enum",values:{image:{}}},url:{required:!0,type:"string"},coordinates:{required:!0,type:"array",length:4,value:{type:"array",length:2,value:"number"}}},layer:{id:{type:"string",required:!0},type:{type:"enum",values:{fill:{},line:{},symbol:{},circle:{},heatmap:{},"fill-extrusion":{},raster:{},hillshade:{},background:{}},required:!0},metadata:{type:"*"},source:{type:"string"},"source-layer":{type:"string"},minzoom:{type:"number",minimum:0,maximum:24},maxzoom:{type:"number",minimum:0,maximum:24},filter:{type:"filter"},layout:{type:"layout"},paint:{type:"paint"}},layout:["layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_symbol","layout_raster","layout_hillshade","layout_background"],layout_background:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_fill:{"fill-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_circle:{"circle-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_heatmap:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},"layout_fill-extrusion":{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_line:{"line-cap":{type:"enum",values:{butt:{},round:{},square:{}},default:"butt",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-join":{type:"enum",values:{bevel:{},round:{},miter:{}},default:"miter",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{type:"number",default:2,requires:[{"line-join":"miter"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-round-limit":{type:"number",default:1.05,requires:[{"line-join":"round"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_symbol:{"symbol-placement":{type:"enum",values:{point:{},line:{},"line-center":{}},default:"point",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-spacing":{type:"number",default:250,minimum:1,units:"pixels",requires:[{"symbol-placement":"line"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"symbol-avoid-edges":{type:"boolean",default:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"symbol-sort-key":{type:"number",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{type:"enum",values:{auto:{},"viewport-y":{},source:{}},default:"auto",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-allow-overlap":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-ignore-placement":{type:"boolean",default:!1,requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-optional":{type:"boolean",default:!1,requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-size":{type:"number",default:1,minimum:0,units:"factor of the original icon size",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit":{type:"enum",values:{none:{},width:{},height:{},both:{}},default:"none",requires:["icon-image","text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-text-fit-padding":{type:"array",value:"number",length:4,default:[0,0,0,0],units:"pixels",requires:["icon-image","text-field",{"icon-text-fit":["both","width","height"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-image":{type:"resolvedImage",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-keep-upright":{type:"boolean",default:!1,requires:["icon-image",{"icon-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"icon-offset":{type:"array",value:"number",length:2,default:[0,0],requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-pitch-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotation-alignment":{type:"enum",values:{map:{},viewport:{},auto:{}},default:"auto",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-field":{type:"formatted",default:"",tokens:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-font":{type:"array",value:"string",default:["Open Sans Regular","Arial Unicode MS Regular"],requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-size":{type:"number",default:16,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-width":{type:"number",default:10,minimum:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{type:"number",default:1.2,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-letter-spacing":{type:"number",default:0,units:"ems",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-justify":{type:"enum",values:{auto:{},left:{},center:{},right:{}},default:"center",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{type:"number",units:"ems",default:0,requires:["text-field"],"property-type":"data-driven",expression:{interpolated:!0,parameters:["zoom","feature"]}},"text-variable-anchor":{type:"array",value:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-anchor":{type:"enum",values:{center:{},left:{},right:{},top:{},bottom:{},"top-left":{},"top-right":{},"bottom-left":{},"bottom-right":{}},default:"center",requires:["text-field",{"!":"text-variable-anchor"}],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{type:"number",default:45,units:"degrees",requires:["text-field",{"symbol-placement":["line","line-center"]}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-writing-mode":{type:"array",value:"enum",values:{horizontal:{},vertical:{}},requires:["text-field",{"symbol-placement":["point"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-rotate":{type:"number",default:0,period:360,units:"degrees",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-padding":{type:"number",default:2,minimum:0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-keep-upright":{type:"boolean",default:!0,requires:["text-field",{"text-rotation-alignment":"map"},{"symbol-placement":["line","line-center"]}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-transform":{type:"enum",values:{none:{},uppercase:{},lowercase:{}},default:"none",requires:["text-field"],expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-offset":{type:"array",value:"number",units:"ems",length:2,default:[0,0],requires:["text-field",{"!":"text-radial-offset"}],expression:{interpolated:!0,parameters:["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-ignore-placement":{type:"boolean",default:!1,requires:["text-field"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-optional":{type:"boolean",default:!1,requires:["text-field","icon-image"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_raster:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},layout_hillshade:{visibility:{type:"enum",values:{visible:{},none:{}},default:"visible","property-type":"constant"}},filter:{type:"array",value:"*"},filter_operator:{type:"enum",values:{"==":{},"!=":{},">":{},">=":{},"<":{},"<=":{},in:{},"!in":{},all:{},any:{},none:{},has:{},"!has":{},within:{}}},geometry_type:{type:"enum",values:{Point:{},LineString:{},Polygon:{}}},function:{expression:{type:"expression"},stops:{type:"array",value:"function_stop"},base:{type:"number",default:1,minimum:0},property:{type:"string",default:"$zoom"},type:{type:"enum",values:{identity:{},exponential:{},interval:{},categorical:{}},default:"exponential"},colorSpace:{type:"enum",values:{rgb:{},lab:{},hcl:{}},default:"rgb"},default:{type:"*",required:!1}},function_stop:{type:"array",minimum:0,maximum:24,value:["number","color"],length:2},expression:{type:"array",value:"*",minimum:1},light:{anchor:{type:"enum",default:"viewport",values:{map:{},viewport:{}},"property-type":"data-constant",transition:!1,expression:{interpolated:!1,parameters:["zoom"]}},position:{type:"array",default:[1.15,210,30],length:3,value:"number","property-type":"data-constant",transition:!0,expression:{interpolated:!0,parameters:["zoom"]}},color:{type:"color","property-type":"data-constant",default:"#ffffff",expression:{interpolated:!0,parameters:["zoom"]},transition:!0},intensity:{type:"number","property-type":"data-constant",default:.5,minimum:0,maximum:1,expression:{interpolated:!0,parameters:["zoom"]},transition:!0}},paint:["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_symbol","paint_raster","paint_hillshade","paint_background"],paint_fill:{"fill-antialias":{type:"boolean",default:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-outline-color":{type:"color",transition:!0,requires:[{"!":"fill-pattern"},{"fill-antialias":!0}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"fill-extrusion-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["fill-extrusion-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"fill-extrusion-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"fill-extrusion-height":{type:"number",default:0,minimum:0,units:"meters",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{type:"number",default:0,minimum:0,units:"meters",transition:!0,requires:["fill-extrusion-height"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-vertical-gradient":{type:"boolean",default:!0,transition:!1,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_line:{"line-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"line-pattern"}],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"line-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["line-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"line-width":{type:"number",default:1,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-gap-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-offset":{type:"number",default:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-dasharray":{type:"array",value:"number",minimum:0,transition:!0,units:"line widths",requires:[{"!":"line-pattern"}],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"line-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"cross-faded-data-driven"},"line-gradient":{type:"color",transition:!1,requires:[{"!":"line-dasharray"},{"!":"line-pattern"},{source:"geojson",has:{lineMetrics:!0}}],expression:{interpolated:!0,parameters:["line-progress"]},"property-type":"color-ramp"}},paint_circle:{"circle-radius":{type:"number",default:5,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-blur":{type:"number",default:0,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"circle-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["circle-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-scale":{type:"enum",values:{map:{},viewport:{}},default:"map",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-pitch-alignment":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"circle-stroke-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"circle-stroke-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"}},paint_heatmap:{"heatmap-radius":{type:"number",default:30,minimum:1,transition:!0,units:"pixels",expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-weight":{type:"number",default:1,minimum:0,transition:!1,expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"heatmap-intensity":{type:"number",default:1,minimum:0,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"heatmap-color":{type:"color",default:["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",.1,"royalblue",.3,"cyan",.5,"lime",.7,"yellow",1,"red"],transition:!1,expression:{interpolated:!0,parameters:["heatmap-density"]},"property-type":"color-ramp"},"heatmap-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_symbol:{"icon-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-color":{type:"color",default:"#000000",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"icon-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["icon-image"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"icon-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["icon-image","icon-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"text-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-color":{type:"color",default:"#000000",transition:!0,overridable:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-color":{type:"color",default:"rgba(0, 0, 0, 0)",transition:!0,requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-width":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-halo-blur":{type:"number",default:0,minimum:0,transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom","feature","feature-state"]},"property-type":"data-driven"},"text-translate":{type:"array",value:"number",length:2,default:[0,0],transition:!0,units:"pixels",requires:["text-field"],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"text-translate-anchor":{type:"enum",values:{map:{},viewport:{}},default:"map",requires:["text-field","text-translate"],expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"}},paint_raster:{"raster-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-hue-rotate":{type:"number",default:0,period:360,transition:!0,units:"degrees",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-min":{type:"number",default:0,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-brightness-max":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-saturation":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-contrast":{type:"number",default:0,minimum:-1,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"raster-resampling":{type:"enum",values:{linear:{},nearest:{}},default:"linear",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"raster-fade-duration":{type:"number",default:300,minimum:0,transition:!1,units:"milliseconds",expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_hillshade:{"hillshade-illumination-direction":{type:"number",default:335,minimum:0,maximum:359,transition:!1,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-illumination-anchor":{type:"enum",values:{map:{},viewport:{}},default:"viewport",expression:{interpolated:!1,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-exaggeration":{type:"number",default:.5,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-shadow-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-highlight-color":{type:"color",default:"#FFFFFF",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"hillshade-accent-color":{type:"color",default:"#000000",transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},paint_background:{"background-color":{type:"color",default:"#000000",transition:!0,requires:[{"!":"background-pattern"}],expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"},"background-pattern":{type:"resolvedImage",transition:!0,expression:{interpolated:!1,parameters:["zoom"]},"property-type":"cross-faded"},"background-opacity":{type:"number",default:1,minimum:0,maximum:1,transition:!0,expression:{interpolated:!0,parameters:["zoom"]},"property-type":"data-constant"}},transition:{duration:{type:"number",default:300,minimum:0,units:"milliseconds"},delay:{type:"number",default:0,minimum:0,units:"milliseconds"}},"property-type":{"data-driven":{type:"property-type"},"cross-faded":{type:"property-type"},"cross-faded-data-driven":{type:"property-type"},"color-ramp":{type:"property-type"},"data-constant":{type:"property-type"},constant:{type:"property-type"}},promoteId:{"*":{type:"string"}}},Q=function(o,u,c,m){this.message=(o?o+": ":"")+c,m&&(this.identifier=m),u!=null&&u.__line__&&(this.line=u.__line__)};function Le(o){var u=o.value;return u?[new Q(o.key,u,"constants have been deprecated as of v8")]:[]}function rt(o){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];for(var m=0,x=u;m<x.length;m+=1){var E=x[m];for(var A in E)o[A]=E[A]}return o}function Ee(o){return o instanceof Number||o instanceof String||o instanceof Boolean?o.valueOf():o}function Yt(o){if(Array.isArray(o))return o.map(Yt);if(o instanceof Object&&!(o instanceof Number||o instanceof String||o instanceof Boolean)){var u={};for(var c in o)u[c]=Yt(o[c]);return u}return Ee(o)}var gr=function(o){function u(c,m){o.call(this,m),this.message=m,this.key=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(Error),tn=function(o,u){u===void 0&&(u=[]),this.parent=o,this.bindings={};for(var c=0,m=u;c<m.length;c+=1){var x=m[c];this.bindings[x[0]]=x[1]}};tn.prototype.concat=function(o){return new tn(this,o)},tn.prototype.get=function(o){if(this.bindings[o])return this.bindings[o];if(this.parent)return this.parent.get(o);throw new Error(o+" not found in scope.")},tn.prototype.has=function(o){return!!this.bindings[o]||!!this.parent&&this.parent.has(o)};var Qr={kind:"null"},rr={kind:"number"},Xr={kind:"string"},zr={kind:"boolean"},Vr={kind:"color"},ei={kind:"object"},sn={kind:"value"},hi={kind:"collator"},Vi={kind:"formatted"},ci={kind:"resolvedImage"};function Di(o,u){return{kind:"array",itemType:o,N:u}}function Ei(o){if(o.kind==="array"){var u=Ei(o.itemType);return typeof o.N=="number"?"array<"+u+", "+o.N+">":o.itemType.kind==="value"?"array":"array<"+u+">"}return o.kind}var rs=[Qr,rr,Xr,zr,Vr,Vi,ei,Di(sn),ci];function Qi(o,u){if(u.kind==="error")return null;if(o.kind==="array"){if(u.kind==="array"&&(u.N===0&&u.itemType.kind==="value"||!Qi(o.itemType,u.itemType))&&(typeof o.N!="number"||o.N===u.N))return null}else{if(o.kind===u.kind)return null;if(o.kind==="value"){for(var c=0,m=rs;c<m.length;c+=1)if(!Qi(m[c],u))return null}}return"Expected "+Ei(o)+" but found "+Ei(u)+" instead."}function Pa(o,u){return u.some(function(c){return c.kind===o.kind})}function Si(o,u){return u.some(function(c){return c==="null"?o===null:c==="array"?Array.isArray(o):c==="object"?o&&!Array.isArray(o)&&typeof o=="object":c===typeof o})}var di=fe(function(o,u){var c={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function m(R){return(R=Math.round(R))<0?0:R>255?255:R}function x(R){return m(R[R.length-1]==="%"?parseFloat(R)/100*255:parseInt(R))}function E(R){return(L=R[R.length-1]==="%"?parseFloat(R)/100:parseFloat(R))<0?0:L>1?1:L;var L}function A(R,L,V){return V<0?V+=1:V>1&&(V-=1),6*V<1?R+(L-R)*V*6:2*V<1?L:3*V<2?R+(L-R)*(2/3-V)*6:R}try{u.parseCSSColor=function(R){var L,V=R.replace(/ /g,"").toLowerCase();if(V in c)return c[V].slice();if(V[0]==="#")return V.length===4?(L=parseInt(V.substr(1),16))>=0&&L<=4095?[(3840&L)>>4|(3840&L)>>8,240&L|(240&L)>>4,15&L|(15&L)<<4,1]:null:V.length===7&&(L=parseInt(V.substr(1),16))>=0&&L<=16777215?[(16711680&L)>>16,(65280&L)>>8,255&L,1]:null;var Y=V.indexOf("("),K=V.indexOf(")");if(Y!==-1&&K+1===V.length){var le=V.substr(0,Y),de=V.substr(Y+1,K-(Y+1)).split(","),Ne=1;switch(le){case"rgba":if(de.length!==4)return null;Ne=E(de.pop());case"rgb":return de.length!==3?null:[x(de[0]),x(de[1]),x(de[2]),Ne];case"hsla":if(de.length!==4)return null;Ne=E(de.pop());case"hsl":if(de.length!==3)return null;var I=(parseFloat(de[0])%360+360)%360/360,ft=E(de[1]),tt=E(de[2]),Rt=tt<=.5?tt*(ft+1):tt+ft-tt*ft,zt=2*tt-Rt;return[m(255*A(zt,Rt,I+1/3)),m(255*A(zt,Rt,I)),m(255*A(zt,Rt,I-1/3)),Ne];default:return null}}return null}}catch(R){}}).parseCSSColor,Ai=function(o,u,c,m){m===void 0&&(m=1),this.r=o,this.g=u,this.b=c,this.a=m};Ai.parse=function(o){if(o){if(o instanceof Ai)return o;if(typeof o=="string"){var u=di(o);if(u)return new Ai(u[0]/255*u[3],u[1]/255*u[3],u[2]/255*u[3],u[3])}}},Ai.prototype.toString=function(){var o=this.toArray(),u=o[1],c=o[2],m=o[3];return"rgba("+Math.round(o[0])+","+Math.round(u)+","+Math.round(c)+","+m+")"},Ai.prototype.toArray=function(){var o=this.a;return o===0?[0,0,0,0]:[255*this.r/o,255*this.g/o,255*this.b/o,o]},Ai.black=new Ai(0,0,0,1),Ai.white=new Ai(1,1,1,1),Ai.transparent=new Ai(0,0,0,0),Ai.red=new Ai(1,0,0,1);var Oa=function(o,u,c){this.sensitivity=o?u?"variant":"case":u?"accent":"base",this.locale=c,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})};Oa.prototype.compare=function(o,u){return this.collator.compare(o,u)},Oa.prototype.resolvedLocale=function(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale};var vu=function(o,u,c,m,x){this.text=o,this.image=u,this.scale=c,this.fontStack=m,this.textColor=x},ca=function(o){this.sections=o};ca.fromString=function(o){return new ca([new vu(o,null,null,null,null)])},ca.prototype.isEmpty=function(){return this.sections.length===0||!this.sections.some(function(o){return o.text.length!==0||o.image&&o.image.name.length!==0})},ca.factory=function(o){return o instanceof ca?o:ca.fromString(o)},ca.prototype.toString=function(){return this.sections.length===0?"":this.sections.map(function(o){return o.text}).join("")},ca.prototype.serialize=function(){for(var o=["format"],u=0,c=this.sections;u<c.length;u+=1){var m=c[u];if(m.image)o.push(["image",m.image.name]);else{o.push(m.text);var x={};m.fontStack&&(x["text-font"]=["literal",m.fontStack.split(",")]),m.scale&&(x["font-scale"]=m.scale),m.textColor&&(x["text-color"]=["rgba"].concat(m.textColor.toArray())),o.push(x)}}return o};var wa=function(o){this.name=o.name,this.available=o.available};function Gl(o,u,c,m){return typeof o=="number"&&o>=0&&o<=255&&typeof u=="number"&&u>=0&&u<=255&&typeof c=="number"&&c>=0&&c<=255?m===void 0||typeof m=="number"&&m>=0&&m<=1?null:"Invalid rgba value ["+[o,u,c,m].join(", ")+"]: 'a' must be between 0 and 1.":"Invalid rgba value ["+(typeof m=="number"?[o,u,c,m]:[o,u,c]).join(", ")+"]: 'r', 'g', and 'b' must be between 0 and 255."}function ds(o){if(o===null||typeof o=="string"||typeof o=="boolean"||typeof o=="number"||o instanceof Ai||o instanceof Oa||o instanceof ca||o instanceof wa)return!0;if(Array.isArray(o)){for(var u=0,c=o;u<c.length;u+=1)if(!ds(c[u]))return!1;return!0}if(typeof o=="object"){for(var m in o)if(!ds(o[m]))return!1;return!0}return!1}function Ca(o){if(o===null)return Qr;if(typeof o=="string")return Xr;if(typeof o=="boolean")return zr;if(typeof o=="number")return rr;if(o instanceof Ai)return Vr;if(o instanceof Oa)return hi;if(o instanceof ca)return Vi;if(o instanceof wa)return ci;if(Array.isArray(o)){for(var u,c=o.length,m=0,x=o;m<x.length;m+=1){var E=Ca(x[m]);if(u){if(u===E)continue;u=sn;break}u=E}return Di(u||sn,c)}return ei}function vi(o){var u=typeof o;return o===null?"":u==="string"||u==="number"||u==="boolean"?String(o):o instanceof Ai||o instanceof ca||o instanceof wa?o.toString():JSON.stringify(o)}wa.prototype.toString=function(){return this.name},wa.fromString=function(o){return o?new wa({name:o,available:!1}):null},wa.prototype.serialize=function(){return["image",this.name]};var ka=function(o,u){this.type=o,this.value=u};ka.parse=function(o,u){if(o.length!==2)return u.error("'literal' expression requires exactly one argument, but found "+(o.length-1)+" instead.");if(!ds(o[1]))return u.error("invalid value");var c=o[1],m=Ca(c),x=u.expectedType;return m.kind!=="array"||m.N!==0||!x||x.kind!=="array"||typeof x.N=="number"&&x.N!==0||(m=x),new ka(m,c)},ka.prototype.evaluate=function(){return this.value},ka.prototype.eachChild=function(){},ka.prototype.outputDefined=function(){return!0},ka.prototype.serialize=function(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ai?["rgba"].concat(this.value.toArray()):this.value instanceof ca?this.value.serialize():this.value};var na=function(o){this.name="ExpressionEvaluationError",this.message=o};na.prototype.toJSON=function(){return this.message};var zo={string:Xr,number:rr,boolean:zr,object:ei},la=function(o,u){this.type=o,this.args=u};la.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var c,m=1,x=o[0];if(x==="array"){var E,A;if(o.length>2){var R=o[1];if(typeof R!="string"||!(R in zo)||R==="object")return u.error('The item type argument of "array" must be one of string, number, boolean',1);E=zo[R],m++}else E=sn;if(o.length>3){if(o[2]!==null&&(typeof o[2]!="number"||o[2]<0||o[2]!==Math.floor(o[2])))return u.error('The length argument to "array" must be a positive integer literal',2);A=o[2],m++}c=Di(E,A)}else c=zo[x];for(var L=[];m<o.length;m++){var V=u.parse(o[m],m,sn);if(!V)return null;L.push(V)}return new la(c,L)},la.prototype.evaluate=function(o){for(var u=0;u<this.args.length;u++){var c=this.args[u].evaluate(o);if(!Qi(this.type,Ca(c)))return c;if(u===this.args.length-1)throw new na("Expected value to be of type "+Ei(this.type)+", but found "+Ei(Ca(c))+" instead.")}return null},la.prototype.eachChild=function(o){this.args.forEach(o)},la.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},la.prototype.serialize=function(){var o=this.type,u=[o.kind];if(o.kind==="array"){var c=o.itemType;if(c.kind==="string"||c.kind==="number"||c.kind==="boolean"){u.push(c.kind);var m=o.N;(typeof m=="number"||this.args.length>1)&&u.push(m)}}return u.concat(this.args.map(function(x){return x.serialize()}))};var ns=function(o){this.type=Vi,this.sections=o};ns.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var c=o[1];if(!Array.isArray(c)&&typeof c=="object")return u.error("First argument must be an image or text section.");for(var m=[],x=!1,E=1;E<=o.length-1;++E){var A=o[E];if(x&&typeof A=="object"&&!Array.isArray(A)){x=!1;var R=null;if(A["font-scale"]&&!(R=u.parse(A["font-scale"],1,rr)))return null;var L=null;if(A["text-font"]&&!(L=u.parse(A["text-font"],1,Di(Xr))))return null;var V=null;if(A["text-color"]&&!(V=u.parse(A["text-color"],1,Vr)))return null;var Y=m[m.length-1];Y.scale=R,Y.font=L,Y.textColor=V}else{var K=u.parse(o[E],1,sn);if(!K)return null;var le=K.type.kind;if(le!=="string"&&le!=="value"&&le!=="null"&&le!=="resolvedImage")return u.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");x=!0,m.push({content:K,scale:null,font:null,textColor:null})}}return new ns(m)},ns.prototype.evaluate=function(o){return new ca(this.sections.map(function(u){var c=u.content.evaluate(o);return Ca(c)===ci?new vu("",c,null,null,null):new vu(vi(c),null,u.scale?u.scale.evaluate(o):null,u.font?u.font.evaluate(o).join(","):null,u.textColor?u.textColor.evaluate(o):null)}))},ns.prototype.eachChild=function(o){for(var u=0,c=this.sections;u<c.length;u+=1){var m=c[u];o(m.content),m.scale&&o(m.scale),m.font&&o(m.font),m.textColor&&o(m.textColor)}},ns.prototype.outputDefined=function(){return!1},ns.prototype.serialize=function(){for(var o=["format"],u=0,c=this.sections;u<c.length;u+=1){var m=c[u];o.push(m.content.serialize());var x={};m.scale&&(x["font-scale"]=m.scale.serialize()),m.font&&(x["text-font"]=m.font.serialize()),m.textColor&&(x["text-color"]=m.textColor.serialize()),o.push(x)}return o};var $o=function(o){this.type=ci,this.input=o};$o.parse=function(o,u){if(o.length!==2)return u.error("Expected two arguments.");var c=u.parse(o[1],1,Xr);return c?new $o(c):u.error("No image name provided.")},$o.prototype.evaluate=function(o){var u=this.input.evaluate(o),c=wa.fromString(u);return c&&o.availableImages&&(c.available=o.availableImages.indexOf(u)>-1),c},$o.prototype.eachChild=function(o){o(this.input)},$o.prototype.outputDefined=function(){return!1},$o.prototype.serialize=function(){return["image",this.input.serialize()]};var Du={"to-boolean":zr,"to-color":Vr,"to-number":rr,"to-string":Xr},vs=function(o,u){this.type=o,this.args=u};vs.parse=function(o,u){if(o.length<2)return u.error("Expected at least one argument.");var c=o[0];if((c==="to-boolean"||c==="to-string")&&o.length!==2)return u.error("Expected one argument.");for(var m=Du[c],x=[],E=1;E<o.length;E++){var A=u.parse(o[E],E,sn);if(!A)return null;x.push(A)}return new vs(m,x)},vs.prototype.evaluate=function(o){if(this.type.kind==="boolean")return!!this.args[0].evaluate(o);if(this.type.kind==="color"){for(var u,c,m=0,x=this.args;m<x.length;m+=1){if(c=null,(u=x[m].evaluate(o))instanceof Ai)return u;if(typeof u=="string"){var E=o.parseColor(u);if(E)return E}else if(Array.isArray(u)&&!(c=u.length<3||u.length>4?"Invalid rbga value "+JSON.stringify(u)+": expected an array containing either three or four numeric values.":Gl(u[0],u[1],u[2],u[3])))return new Ai(u[0]/255,u[1]/255,u[2]/255,u[3])}throw new na(c||"Could not parse color from value '"+(typeof u=="string"?u:String(JSON.stringify(u)))+"'")}if(this.type.kind==="number"){for(var A=null,R=0,L=this.args;R<L.length;R+=1){if((A=L[R].evaluate(o))===null)return 0;var V=Number(A);if(!isNaN(V))return V}throw new na("Could not convert "+JSON.stringify(A)+" to number.")}return this.type.kind==="formatted"?ca.fromString(vi(this.args[0].evaluate(o))):this.type.kind==="resolvedImage"?wa.fromString(vi(this.args[0].evaluate(o))):vi(this.args[0].evaluate(o))},vs.prototype.eachChild=function(o){this.args.forEach(o)},vs.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},vs.prototype.serialize=function(){if(this.type.kind==="formatted")return new ns([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new $o(this.args[0]).serialize();var o=["to-"+this.type.kind];return this.eachChild(function(u){o.push(u.serialize())}),o};var _c=["Unknown","Point","LineString","Polygon"],ya=function(){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null};ya.prototype.id=function(){return this.feature&&"id"in this.feature?this.feature.id:null},ya.prototype.geometryType=function(){return this.feature?typeof this.feature.type=="number"?_c[this.feature.type]:this.feature.type:null},ya.prototype.geometry=function(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null},ya.prototype.canonicalID=function(){return this.canonical},ya.prototype.properties=function(){return this.feature&&this.feature.properties||{}},ya.prototype.parseColor=function(o){var u=this._parseColorCache[o];return u||(u=this._parseColorCache[o]=Ai.parse(o)),u};var Ji=function(o,u,c,m){this.name=o,this.type=u,this._evaluate=c,this.args=m};Ji.prototype.evaluate=function(o){return this._evaluate(o,this.args)},Ji.prototype.eachChild=function(o){this.args.forEach(o)},Ji.prototype.outputDefined=function(){return!1},Ji.prototype.serialize=function(){return[this.name].concat(this.args.map(function(o){return o.serialize()}))},Ji.parse=function(o,u){var c,m=o[0],x=Ji.definitions[m];if(!x)return u.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0);for(var E=Array.isArray(x)?x[0]:x.type,A=Array.isArray(x)?[[x[1],x[2]]]:x.overloads,R=A.filter(function(Zn){var mn=Zn[0];return!Array.isArray(mn)||mn.length===o.length-1}),L=null,V=0,Y=R;V<Y.length;V+=1){var K=Y[V],le=K[0],de=K[1];L=new Ju(u.registry,u.path,null,u.scope);for(var Ne=[],I=!1,ft=1;ft<o.length;ft++){var tt=o[ft],Rt=Array.isArray(le)?le[ft-1]:le.type,zt=L.parse(tt,1+Ne.length,Rt);if(!zt){I=!0;break}Ne.push(zt)}if(!I)if(Array.isArray(le)&&le.length!==Ne.length)L.error("Expected "+le.length+" arguments, but found "+Ne.length+" instead.");else{for(var ir=0;ir<Ne.length;ir++){var or=Array.isArray(le)?le[ir]:le.type,mr=Ne[ir];L.concat(ir+1).checkSubtype(or,mr.type)}if(L.errors.length===0)return new Ji(m,E,de,Ne)}}if(R.length===1)(c=u.errors).push.apply(c,L.errors);else{for(var Zr=(R.length?R:A).map(function(Zn){var mn;return mn=Zn[0],Array.isArray(mn)?"("+mn.map(Ei).join(", ")+")":"("+Ei(mn.type)+"...)"}).join(" | "),qr=[],Bn=1;Bn<o.length;Bn++){var vn=u.parse(o[Bn],1+qr.length);if(!vn)return null;qr.push(Ei(vn.type))}u.error("Expected arguments of type "+Zr+", but found ("+qr.join(", ")+") instead.")}return null},Ji.register=function(o,u){for(var c in Ji.definitions=u,u)o[c]=Ji};var Jt=function(o,u,c){this.type=hi,this.locale=c,this.caseSensitive=o,this.diacriticSensitive=u};function yn(o,u){o[0]=Math.min(o[0],u[0]),o[1]=Math.min(o[1],u[1]),o[2]=Math.max(o[2],u[0]),o[3]=Math.max(o[3],u[1])}function ge(o,u){return!(o[0]<=u[0]||o[2]>=u[2]||o[1]<=u[1]||o[3]>=u[3])}function Pe(o,u){var c=(180+o[0])/360,m=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o[1]*Math.PI/360)))/360,x=Math.pow(2,u.z);return[Math.round(c*x*8192),Math.round(m*x*8192)]}function _t(o,u,c){return u[1]>o[1]!=c[1]>o[1]&&o[0]<(c[0]-u[0])*(o[1]-u[1])/(c[1]-u[1])+u[0]}function cr(o,u){for(var c,m,x,E,A,R,L,V=!1,Y=0,K=u.length;Y<K;Y++)for(var le=u[Y],de=0,Ne=le.length;de<Ne-1;de++){if((E=(c=o)[0]-(m=le[de])[0])*(L=c[1]-(x=le[de+1])[1])-(R=c[0]-x[0])*(A=c[1]-m[1])==0&&E*R<=0&&A*L<=0)return!1;_t(o,le[de],le[de+1])&&(V=!V)}return V}function Kr(o,u){for(var c=0;c<u.length;c++)if(cr(o,u[c]))return!0;return!1}function kn(o,u,c,m){var x=m[0]-c[0],E=m[1]-c[1],A=(o[0]-c[0])*E-x*(o[1]-c[1]),R=(u[0]-c[0])*E-x*(u[1]-c[1]);return A>0&&R<0||A<0&&R>0}function ji(o,u,c){for(var m=0,x=c;m<x.length;m+=1)for(var E=x[m],A=0;A<E.length-1;++A)if((K=[(Y=E[A+1])[0]-(V=E[A])[0],Y[1]-V[1]])[0]*(le=[(L=u)[0]-(R=o)[0],L[1]-R[1]])[1]-K[1]*le[0]!=0&&kn(R,L,V,Y)&&kn(V,Y,R,L))return!0;var R,L,V,Y,K,le;return!1}function vo(o,u){for(var c=0;c<o.length;++c)if(!cr(o[c],u))return!1;for(var m=0;m<o.length-1;++m)if(ji(o[m],o[m+1],u))return!1;return!0}function wo(o,u){for(var c=0;c<u.length;c++)if(vo(o,u[c]))return!0;return!1}function fo(o,u,c){for(var m=[],x=0;x<o.length;x++){for(var E=[],A=0;A<o[x].length;A++){var R=Pe(o[x][A],c);yn(u,R),E.push(R)}m.push(E)}return m}function Ds(o,u,c){for(var m=[],x=0;x<o.length;x++){var E=fo(o[x],u,c);m.push(E)}return m}function Ms(o,u,c,m){if(o[0]<c[0]||o[0]>c[2]){var x=.5*m,E=o[0]-c[0]>x?-m:c[0]-o[0]>x?m:0;E===0&&(E=o[0]-c[2]>x?-m:c[2]-o[0]>x?m:0),o[0]+=E}yn(u,o)}function ep(o,u,c,m){for(var x=8192*Math.pow(2,m.z),E=[8192*m.x,8192*m.y],A=[],R=0,L=o;R<L.length;R+=1)for(var V=0,Y=L[R];V<Y.length;V+=1){var K=Y[V],le=[K.x+E[0],K.y+E[1]];Ms(le,u,c,x),A.push(le)}return A}function Af(o,u,c,m){for(var x,E=8192*Math.pow(2,m.z),A=[8192*m.x,8192*m.y],R=[],L=0,V=o;L<V.length;L+=1){for(var Y=[],K=0,le=V[L];K<le.length;K+=1){var de=le[K],Ne=[de.x+A[0],de.y+A[1]];yn(u,Ne),Y.push(Ne)}R.push(Y)}if(u[2]-u[0]<=E/2){(x=u)[0]=x[1]=1/0,x[2]=x[3]=-1/0;for(var I=0,ft=R;I<ft.length;I+=1)for(var tt=0,Rt=ft[I];tt<Rt.length;tt+=1)Ms(Rt[tt],u,c,E)}return R}Jt.parse=function(o,u){if(o.length!==2)return u.error("Expected one argument.");var c=o[1];if(typeof c!="object"||Array.isArray(c))return u.error("Collator options argument must be an object.");var m=u.parse(c["case-sensitive"]!==void 0&&c["case-sensitive"],1,zr);if(!m)return null;var x=u.parse(c["diacritic-sensitive"]!==void 0&&c["diacritic-sensitive"],1,zr);if(!x)return null;var E=null;return c.locale&&!(E=u.parse(c.locale,1,Xr))?null:new Jt(m,x,E)},Jt.prototype.evaluate=function(o){return new Oa(this.caseSensitive.evaluate(o),this.diacriticSensitive.evaluate(o),this.locale?this.locale.evaluate(o):null)},Jt.prototype.eachChild=function(o){o(this.caseSensitive),o(this.diacriticSensitive),this.locale&&o(this.locale)},Jt.prototype.outputDefined=function(){return!1},Jt.prototype.serialize=function(){var o={};return o["case-sensitive"]=this.caseSensitive.serialize(),o["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(o.locale=this.locale.serialize()),["collator",o]};var Yo=function(o,u){this.type=zr,this.geojson=o,this.geometries=u};function El(o){if(o instanceof Ji&&(o.name==="get"&&o.args.length===1||o.name==="feature-state"||o.name==="has"&&o.args.length===1||o.name==="properties"||o.name==="geometry-type"||o.name==="id"||/^filter-/.test(o.name))||o instanceof Yo)return!1;var u=!0;return o.eachChild(function(c){u&&!El(c)&&(u=!1)}),u}function Sl(o){if(o instanceof Ji&&o.name==="feature-state")return!1;var u=!0;return o.eachChild(function(c){u&&!Sl(c)&&(u=!1)}),u}function Lu(o,u){if(o instanceof Ji&&u.indexOf(o.name)>=0)return!1;var c=!0;return o.eachChild(function(m){c&&!Lu(m,u)&&(c=!1)}),c}Yo.parse=function(o,u){if(o.length!==2)return u.error("'within' expression requires exactly one argument, but found "+(o.length-1)+" instead.");if(ds(o[1])){var c=o[1];if(c.type==="FeatureCollection")for(var m=0;m<c.features.length;++m){var x=c.features[m].geometry.type;if(x==="Polygon"||x==="MultiPolygon")return new Yo(c,c.features[m].geometry)}else if(c.type==="Feature"){var E=c.geometry.type;if(E==="Polygon"||E==="MultiPolygon")return new Yo(c,c.geometry)}else if(c.type==="Polygon"||c.type==="MultiPolygon")return new Yo(c,c)}return u.error("'within' expression requires valid geojson object that contains polygon geometry type.")},Yo.prototype.evaluate=function(o){if(o.geometry()!=null&&o.canonicalID()!=null){if(o.geometryType()==="Point")return function(u,c){var m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(c.type==="Polygon"){var A=fo(c.coordinates,x,E),R=ep(u.geometry(),m,x,E);if(!ge(m,x))return!1;for(var L=0,V=R;L<V.length;L+=1)if(!cr(V[L],A))return!1}if(c.type==="MultiPolygon"){var Y=Ds(c.coordinates,x,E),K=ep(u.geometry(),m,x,E);if(!ge(m,x))return!1;for(var le=0,de=K;le<de.length;le+=1)if(!Kr(de[le],Y))return!1}return!0}(o,this.geometries);if(o.geometryType()==="LineString")return function(u,c){var m=[1/0,1/0,-1/0,-1/0],x=[1/0,1/0,-1/0,-1/0],E=u.canonicalID();if(c.type==="Polygon"){var A=fo(c.coordinates,x,E),R=Af(u.geometry(),m,x,E);if(!ge(m,x))return!1;for(var L=0,V=R;L<V.length;L+=1)if(!vo(V[L],A))return!1}if(c.type==="MultiPolygon"){var Y=Ds(c.coordinates,x,E),K=Af(u.geometry(),m,x,E);if(!ge(m,x))return!1;for(var le=0,de=K;le<de.length;le+=1)if(!wo(de[le],Y))return!1}return!0}(o,this.geometries)}return!1},Yo.prototype.eachChild=function(){},Yo.prototype.outputDefined=function(){return!0},Yo.prototype.serialize=function(){return["within",this.geojson]};var Bu=function(o,u){this.type=u.type,this.name=o,this.boundExpression=u};Bu.parse=function(o,u){if(o.length!==2||typeof o[1]!="string")return u.error("'var' expression requires exactly one string literal argument.");var c=o[1];return u.scope.has(c)?new Bu(c,u.scope.get(c)):u.error('Unknown variable "'+c+'". Make sure "'+c+'" has been bound in an enclosing "let" expression before using it.',1)},Bu.prototype.evaluate=function(o){return this.boundExpression.evaluate(o)},Bu.prototype.eachChild=function(){},Bu.prototype.outputDefined=function(){return!1},Bu.prototype.serialize=function(){return["var",this.name]};var Ju=function(o,u,c,m,x){u===void 0&&(u=[]),m===void 0&&(m=new tn),x===void 0&&(x=[]),this.registry=o,this.path=u,this.key=u.map(function(E){return"["+E+"]"}).join(""),this.scope=m,this.errors=x,this.expectedType=c};function $c(o,u){for(var c,m=o.length-1,x=0,E=m,A=0;x<=E;)if((c=o[A=Math.floor((x+E)/2)])<=u){if(A===m||u<o[A+1])return A;x=A+1}else{if(!(c>u))throw new na("Input is not a number.");E=A-1}return 0}Ju.prototype.parse=function(o,u,c,m,x){return x===void 0&&(x={}),u?this.concat(u,c,m)._parse(o,x):this._parse(o,x)},Ju.prototype._parse=function(o,u){function c(V,Y,K){return K==="assert"?new la(Y,[V]):K==="coerce"?new vs(Y,[V]):V}if(o!==null&&typeof o!="string"&&typeof o!="boolean"&&typeof o!="number"||(o=["literal",o]),Array.isArray(o)){if(o.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');var m=o[0];if(typeof m!="string")return this.error("Expression name must be a string, but found "+typeof m+' instead. If you wanted a literal array, use ["literal", [...]].',0),null;var x=this.registry[m];if(x){var E=x.parse(o,this);if(!E)return null;if(this.expectedType){var A=this.expectedType,R=E.type;if(A.kind!=="string"&&A.kind!=="number"&&A.kind!=="boolean"&&A.kind!=="object"&&A.kind!=="array"||R.kind!=="value")if(A.kind!=="color"&&A.kind!=="formatted"&&A.kind!=="resolvedImage"||R.kind!=="value"&&R.kind!=="string"){if(this.checkSubtype(A,R))return null}else E=c(E,A,u.typeAnnotation||"coerce");else E=c(E,A,u.typeAnnotation||"assert")}if(!(E instanceof ka)&&E.type.kind!=="resolvedImage"&&function V(Y){if(Y instanceof Bu)return V(Y.boundExpression);if(Y instanceof Ji&&Y.name==="error"||Y instanceof Jt||Y instanceof Yo)return!1;var K=Y instanceof vs||Y instanceof la,le=!0;return Y.eachChild(function(de){le=K?le&&V(de):le&&de instanceof ka}),!!le&&El(Y)&&Lu(Y,["zoom","heatmap-density","line-progress","accumulated","is-supported-script"])}(E)){var L=new ya;try{E=new ka(E.type,E.evaluate(L))}catch(V){return this.error(V.message),null}}return E}return this.error('Unknown expression "'+m+'". If you wanted a literal array, use ["literal", [...]].',0)}return this.error(o===void 0?"'undefined' value invalid. Use null instead.":typeof o=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found "+typeof o+" instead.")},Ju.prototype.concat=function(o,u,c){var m=typeof o=="number"?this.path.concat(o):this.path,x=c?this.scope.concat(c):this.scope;return new Ju(this.registry,m,u||null,x,this.errors)},Ju.prototype.error=function(o){for(var u=[],c=arguments.length-1;c-- >0;)u[c]=arguments[c+1];var m=""+this.key+u.map(function(x){return"["+x+"]"}).join("");this.errors.push(new gr(m,o))},Ju.prototype.checkSubtype=function(o,u){var c=Qi(o,u);return c&&this.error(c),c};var Ls=function(o,u,c){this.type=o,this.input=u,this.labels=[],this.outputs=[];for(var m=0,x=c;m<x.length;m+=1){var E=x[m],A=E[1];this.labels.push(E[0]),this.outputs.push(A)}};function Ya(o,u,c){return o*(1-c)+u*c}Ls.parse=function(o,u){if(o.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");var c=u.parse(o[1],1,rr);if(!c)return null;var m=[],x=null;u.expectedType&&u.expectedType.kind!=="value"&&(x=u.expectedType);for(var E=1;E<o.length;E+=2){var A=E===1?-1/0:o[E],R=o[E+1],L=E,V=E+1;if(typeof A!="number")return u.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',L);if(m.length&&m[m.length-1][0]>=A)return u.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',L);var Y=u.parse(R,V,x);if(!Y)return null;x=x||Y.type,m.push([A,Y])}return new Ls(x,c,m)},Ls.prototype.evaluate=function(o){var u=this.labels,c=this.outputs;if(u.length===1)return c[0].evaluate(o);var m=this.input.evaluate(o);if(m<=u[0])return c[0].evaluate(o);var x=u.length;return m>=u[x-1]?c[x-1].evaluate(o):c[$c(u,m)].evaluate(o)},Ls.prototype.eachChild=function(o){o(this.input);for(var u=0,c=this.outputs;u<c.length;u+=1)o(c[u])},Ls.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})},Ls.prototype.serialize=function(){for(var o=["step",this.input.serialize()],u=0;u<this.labels.length;u++)u>0&&o.push(this.labels[u]),o.push(this.outputs[u].serialize());return o};var Al=Object.freeze({__proto__:null,number:Ya,color:function(o,u,c){return new Ai(Ya(o.r,u.r,c),Ya(o.g,u.g,c),Ya(o.b,u.b,c),Ya(o.a,u.a,c))},array:function(o,u,c){return o.map(function(m,x){return Ya(m,u[x],c)})}}),el=6/29*3*(6/29),Tf=Math.PI/180,tp=180/Math.PI;function wf(o){return o>.008856451679035631?Math.pow(o,1/3):o/el+4/29}function hh(o){return o>6/29?o*o*o:el*(o-4/29)}function ph(o){return 255*(o<=.0031308?12.92*o:1.055*Math.pow(o,1/2.4)-.055)}function dh(o){return(o/=255)<=.04045?o/12.92:Math.pow((o+.055)/1.055,2.4)}function rp(o){var u=dh(o.r),c=dh(o.g),m=dh(o.b),x=wf((.4124564*u+.3575761*c+.1804375*m)/.95047),E=wf((.2126729*u+.7151522*c+.072175*m)/1);return{l:116*E-16,a:500*(x-E),b:200*(E-wf((.0193339*u+.119192*c+.9503041*m)/1.08883)),alpha:o.a}}function np(o){var u=(o.l+16)/116,c=isNaN(o.a)?u:u+o.a/500,m=isNaN(o.b)?u:u-o.b/200;return u=1*hh(u),c=.95047*hh(c),m=1.08883*hh(m),new Ai(ph(3.2404542*c-1.5371385*u-.4985314*m),ph(-.969266*c+1.8760108*u+.041556*m),ph(.0556434*c-.2040259*u+1.0572252*m),o.alpha)}function zp(o,u,c){var m=u-o;return o+c*(m>180||m<-180?m-360*Math.round(m/360):m)}var Yc={forward:rp,reverse:np,interpolate:function(o,u,c){return{l:Ya(o.l,u.l,c),a:Ya(o.a,u.a,c),b:Ya(o.b,u.b,c),alpha:Ya(o.alpha,u.alpha,c)}}},Fu={forward:function(o){var u=rp(o),c=u.l,m=u.a,x=u.b,E=Math.atan2(x,m)*tp;return{h:E<0?E+360:E,c:Math.sqrt(m*m+x*x),l:c,alpha:o.a}},reverse:function(o){var u=o.h*Tf,c=o.c;return np({l:o.l,a:Math.cos(u)*c,b:Math.sin(u)*c,alpha:o.alpha})},interpolate:function(o,u,c){return{h:zp(o.h,u.h,c),c:Ya(o.c,u.c,c),l:Ya(o.l,u.l,c),alpha:Ya(o.alpha,u.alpha,c)}}},ip=Object.freeze({__proto__:null,lab:Yc,hcl:Fu}),qo=function(o,u,c,m,x){this.type=o,this.operator=u,this.interpolation=c,this.input=m,this.labels=[],this.outputs=[];for(var E=0,A=x;E<A.length;E+=1){var R=A[E],L=R[1];this.labels.push(R[0]),this.outputs.push(L)}};function Xl(o,u,c,m){var x=m-c,E=o-c;return x===0?0:u===1?E/x:(Math.pow(u,E)-1)/(Math.pow(u,x)-1)}qo.interpolationFactor=function(o,u,c,m){var x=0;if(o.name==="exponential")x=Xl(u,o.base,c,m);else if(o.name==="linear")x=Xl(u,1,c,m);else if(o.name==="cubic-bezier"){var E=o.controlPoints;x=new Z(E[0],E[1],E[2],E[3]).solve(Xl(u,1,c,m))}return x},qo.parse=function(o,u){var c=o[0],m=o[1],x=o[2],E=o.slice(3);if(!Array.isArray(m)||m.length===0)return u.error("Expected an interpolation type expression.",1);if(m[0]==="linear")m={name:"linear"};else if(m[0]==="exponential"){var A=m[1];if(typeof A!="number")return u.error("Exponential interpolation requires a numeric base.",1,1);m={name:"exponential",base:A}}else{if(m[0]!=="cubic-bezier")return u.error("Unknown interpolation type "+String(m[0]),1,0);var R=m.slice(1);if(R.length!==4||R.some(function(ft){return typeof ft!="number"||ft<0||ft>1}))return u.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);m={name:"cubic-bezier",controlPoints:R}}if(o.length-1<4)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if((o.length-1)%2!=0)return u.error("Expected an even number of arguments.");if(!(x=u.parse(x,2,rr)))return null;var L=[],V=null;c==="interpolate-hcl"||c==="interpolate-lab"?V=Vr:u.expectedType&&u.expectedType.kind!=="value"&&(V=u.expectedType);for(var Y=0;Y<E.length;Y+=2){var K=E[Y],le=E[Y+1],de=Y+3,Ne=Y+4;if(typeof K!="number")return u.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',de);if(L.length&&L[L.length-1][0]>=K)return u.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',de);var I=u.parse(le,Ne,V);if(!I)return null;V=V||I.type,L.push([K,I])}return V.kind==="number"||V.kind==="color"||V.kind==="array"&&V.itemType.kind==="number"&&typeof V.N=="number"?new qo(V,c,m,x,L):u.error("Type "+Ei(V)+" is not interpolatable.")},qo.prototype.evaluate=function(o){var u=this.labels,c=this.outputs;if(u.length===1)return c[0].evaluate(o);var m=this.input.evaluate(o);if(m<=u[0])return c[0].evaluate(o);var x=u.length;if(m>=u[x-1])return c[x-1].evaluate(o);var E=$c(u,m),A=qo.interpolationFactor(this.interpolation,m,u[E],u[E+1]),R=c[E].evaluate(o),L=c[E+1].evaluate(o);return this.operator==="interpolate"?Al[this.type.kind.toLowerCase()](R,L,A):this.operator==="interpolate-hcl"?Fu.reverse(Fu.interpolate(Fu.forward(R),Fu.forward(L),A)):Yc.reverse(Yc.interpolate(Yc.forward(R),Yc.forward(L),A))},qo.prototype.eachChild=function(o){o(this.input);for(var u=0,c=this.outputs;u<c.length;u+=1)o(c[u])},qo.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})},qo.prototype.serialize=function(){var o;o=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier"].concat(this.interpolation.controlPoints);for(var u=[this.operator,o,this.input.serialize()],c=0;c<this.labels.length;c++)u.push(this.labels[c],this.outputs[c].serialize());return u};var Tl=function(o,u){this.type=o,this.args=u};Tl.parse=function(o,u){if(o.length<2)return u.error("Expectected at least one argument.");var c=null,m=u.expectedType;m&&m.kind!=="value"&&(c=m);for(var x=[],E=0,A=o.slice(1);E<A.length;E+=1){var R=u.parse(A[E],1+x.length,c,void 0,{typeAnnotation:"omit"});if(!R)return null;c=c||R.type,x.push(R)}var L=m&&x.some(function(V){return Qi(m,V.type)});return new Tl(L?sn:c,x)},Tl.prototype.evaluate=function(o){for(var u,c=null,m=0,x=0,E=this.args;x<E.length&&(m++,(c=E[x].evaluate(o))&&c instanceof wa&&!c.available&&(u||(u=c.name),c=null,m===this.args.length&&(c=u)),c===null);x+=1);return c},Tl.prototype.eachChild=function(o){this.args.forEach(o)},Tl.prototype.outputDefined=function(){return this.args.every(function(o){return o.outputDefined()})},Tl.prototype.serialize=function(){var o=["coalesce"];return this.eachChild(function(u){o.push(u.serialize())}),o};var Ks=function(o,u){this.type=u.type,this.bindings=[].concat(o),this.result=u};Ks.prototype.evaluate=function(o){return this.result.evaluate(o)},Ks.prototype.eachChild=function(o){for(var u=0,c=this.bindings;u<c.length;u+=1)o(c[u][1]);o(this.result)},Ks.parse=function(o,u){if(o.length<4)return u.error("Expected at least 3 arguments, but found "+(o.length-1)+" instead.");for(var c=[],m=1;m<o.length-1;m+=2){var x=o[m];if(typeof x!="string")return u.error("Expected string, but found "+typeof x+" instead.",m);if(/[^a-zA-Z0-9_]/.test(x))return u.error("Variable names must contain only alphanumeric characters or '_'.",m);var E=u.parse(o[m+1],m+1);if(!E)return null;c.push([x,E])}var A=u.parse(o[o.length-1],o.length-1,u.expectedType,c);return A?new Ks(c,A):null},Ks.prototype.outputDefined=function(){return this.result.outputDefined()},Ks.prototype.serialize=function(){for(var o=["let"],u=0,c=this.bindings;u<c.length;u+=1){var m=c[u];o.push(m[0],m[1].serialize())}return o.push(this.result.serialize()),o};var wl=function(o,u,c){this.type=o,this.index=u,this.input=c};wl.parse=function(o,u){if(o.length!==3)return u.error("Expected 2 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,rr),m=u.parse(o[2],2,Di(u.expectedType||sn));return c&&m?new wl(m.type.itemType,c,m):null},wl.prototype.evaluate=function(o){var u=this.index.evaluate(o),c=this.input.evaluate(o);if(u<0)throw new na("Array index out of bounds: "+u+" < 0.");if(u>=c.length)throw new na("Array index out of bounds: "+u+" > "+(c.length-1)+".");if(u!==Math.floor(u))throw new na("Array index must be an integer, but found "+u+" instead.");return c[u]},wl.prototype.eachChild=function(o){o(this.index),o(this.input)},wl.prototype.outputDefined=function(){return!1},wl.prototype.serialize=function(){return["at",this.index.serialize(),this.input.serialize()]};var ui=function(o,u){this.type=zr,this.needle=o,this.haystack=u};ui.parse=function(o,u){if(o.length!==3)return u.error("Expected 2 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,sn),m=u.parse(o[2],2,sn);return c&&m?Pa(c.type,[zr,Xr,rr,Qr,sn])?new ui(c,m):u.error("Expected first argument to be of type boolean, string, number or null, but found "+Ei(c.type)+" instead"):null},ui.prototype.evaluate=function(o){var u=this.needle.evaluate(o),c=this.haystack.evaluate(o);if(!c)return!1;if(!Si(u,["boolean","string","number","null"]))throw new na("Expected first argument to be of type boolean, string, number or null, but found "+Ei(Ca(u))+" instead.");if(!Si(c,["string","array"]))throw new na("Expected second argument to be of type array or string, but found "+Ei(Ca(c))+" instead.");return c.indexOf(u)>=0},ui.prototype.eachChild=function(o){o(this.needle),o(this.haystack)},ui.prototype.outputDefined=function(){return!0},ui.prototype.serialize=function(){return["in",this.needle.serialize(),this.haystack.serialize()]};var tl=function(o,u,c){this.type=rr,this.needle=o,this.haystack=u,this.fromIndex=c};tl.parse=function(o,u){if(o.length<=2||o.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,sn),m=u.parse(o[2],2,sn);if(!c||!m)return null;if(!Pa(c.type,[zr,Xr,rr,Qr,sn]))return u.error("Expected first argument to be of type boolean, string, number or null, but found "+Ei(c.type)+" instead");if(o.length===4){var x=u.parse(o[3],3,rr);return x?new tl(c,m,x):null}return new tl(c,m)},tl.prototype.evaluate=function(o){var u=this.needle.evaluate(o),c=this.haystack.evaluate(o);if(!Si(u,["boolean","string","number","null"]))throw new na("Expected first argument to be of type boolean, string, number or null, but found "+Ei(Ca(u))+" instead.");if(!Si(c,["string","array"]))throw new na("Expected second argument to be of type array or string, but found "+Ei(Ca(c))+" instead.");if(this.fromIndex){var m=this.fromIndex.evaluate(o);return c.indexOf(u,m)}return c.indexOf(u)},tl.prototype.eachChild=function(o){o(this.needle),o(this.haystack),this.fromIndex&&o(this.fromIndex)},tl.prototype.outputDefined=function(){return!1},tl.prototype.serialize=function(){if(this.fromIndex!=null&&this.fromIndex!==void 0){var o=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),o]}return["index-of",this.needle.serialize(),this.haystack.serialize()]};var Bs=function(o,u,c,m,x,E){this.inputType=o,this.type=u,this.input=c,this.cases=m,this.outputs=x,this.otherwise=E};Bs.parse=function(o,u){if(o.length<5)return u.error("Expected at least 4 arguments, but found only "+(o.length-1)+".");if(o.length%2!=1)return u.error("Expected an even number of arguments.");var c,m;u.expectedType&&u.expectedType.kind!=="value"&&(m=u.expectedType);for(var x={},E=[],A=2;A<o.length-1;A+=2){var R=o[A],L=o[A+1];Array.isArray(R)||(R=[R]);var V=u.concat(A);if(R.length===0)return V.error("Expected at least one branch label.");for(var Y=0,K=R;Y<K.length;Y+=1){var le=K[Y];if(typeof le!="number"&&typeof le!="string")return V.error("Branch labels must be numbers or strings.");if(typeof le=="number"&&Math.abs(le)>Number.MAX_SAFE_INTEGER)return V.error("Branch labels must be integers no larger than "+Number.MAX_SAFE_INTEGER+".");if(typeof le=="number"&&Math.floor(le)!==le)return V.error("Numeric branch labels must be integer values.");if(c){if(V.checkSubtype(c,Ca(le)))return null}else c=Ca(le);if(x[String(le)]!==void 0)return V.error("Branch labels must be unique.");x[String(le)]=E.length}var de=u.parse(L,A,m);if(!de)return null;m=m||de.type,E.push(de)}var Ne=u.parse(o[1],1,sn);if(!Ne)return null;var I=u.parse(o[o.length-1],o.length-1,m);return I?Ne.type.kind!=="value"&&u.concat(1).checkSubtype(c,Ne.type)?null:new Bs(c,m,Ne,x,E,I):null},Bs.prototype.evaluate=function(o){var u=this.input.evaluate(o);return(Ca(u)===this.inputType&&this.outputs[this.cases[u]]||this.otherwise).evaluate(o)},Bs.prototype.eachChild=function(o){o(this.input),this.outputs.forEach(o),o(this.otherwise)},Bs.prototype.outputDefined=function(){return this.outputs.every(function(o){return o.outputDefined()})&&this.otherwise.outputDefined()},Bs.prototype.serialize=function(){for(var o=this,u=["match",this.input.serialize()],c=[],m={},x=0,E=Object.keys(this.cases).sort();x<E.length;x+=1){var A=E[x];(K=m[this.cases[A]])===void 0?(m[this.cases[A]]=c.length,c.push([this.cases[A],[A]])):c[K][1].push(A)}for(var R=function(de){return o.inputType.kind==="number"?Number(de):de},L=0,V=c;L<V.length;L+=1){var Y=V[L],K=Y[0],le=Y[1];u.push(le.length===1?R(le[0]):le.map(R)),u.push(this.outputs[outputIndex$1].serialize())}return u.push(this.otherwise.serialize()),u};var Nu=function(o,u,c){this.type=o,this.branches=u,this.otherwise=c};Nu.parse=function(o,u){if(o.length<4)return u.error("Expected at least 3 arguments, but found only "+(o.length-1)+".");if(o.length%2!=0)return u.error("Expected an odd number of arguments.");var c;u.expectedType&&u.expectedType.kind!=="value"&&(c=u.expectedType);for(var m=[],x=1;x<o.length-1;x+=2){var E=u.parse(o[x],x,zr);if(!E)return null;var A=u.parse(o[x+1],x+1,c);if(!A)return null;m.push([E,A]),c=c||A.type}var R=u.parse(o[o.length-1],o.length-1,c);return R?new Nu(c,m,R):null},Nu.prototype.evaluate=function(o){for(var u=0,c=this.branches;u<c.length;u+=1){var m=c[u],x=m[1];if(m[0].evaluate(o))return x.evaluate(o)}return this.otherwise.evaluate(o)},Nu.prototype.eachChild=function(o){for(var u=0,c=this.branches;u<c.length;u+=1){var m=c[u],x=m[1];o(m[0]),o(x)}o(this.otherwise)},Nu.prototype.outputDefined=function(){return this.branches.every(function(o){return o[1].outputDefined()})&&this.otherwise.outputDefined()},Nu.prototype.serialize=function(){var o=["case"];return this.eachChild(function(u){o.push(u.serialize())}),o};var rl=function(o,u,c,m){this.type=o,this.input=u,this.beginIndex=c,this.endIndex=m};function ap(o,u){return o==="=="||o==="!="?u.kind==="boolean"||u.kind==="string"||u.kind==="number"||u.kind==="null"||u.kind==="value":u.kind==="string"||u.kind==="number"||u.kind==="value"}function $i(o,u,c,m){return m.compare(u,c)===0}function Ci(o,u,c){var m=o!=="=="&&o!=="!=";return function(){function x(E,A,R){this.type=zr,this.lhs=E,this.rhs=A,this.collator=R,this.hasUntypedArgument=E.type.kind==="value"||A.type.kind==="value"}return x.parse=function(E,A){if(E.length!==3&&E.length!==4)return A.error("Expected two or three arguments.");var R=E[0],L=A.parse(E[1],1,sn);if(!L)return null;if(!ap(R,L.type))return A.concat(1).error('"'+R+`" comparisons are not supported for type '`+Ei(L.type)+"'.");var V=A.parse(E[2],2,sn);if(!V)return null;if(!ap(R,V.type))return A.concat(2).error('"'+R+`" comparisons are not supported for type '`+Ei(V.type)+"'.");if(L.type.kind!==V.type.kind&&L.type.kind!=="value"&&V.type.kind!=="value")return A.error("Cannot compare types '"+Ei(L.type)+"' and '"+Ei(V.type)+"'.");m&&(L.type.kind==="value"&&V.type.kind!=="value"?L=new la(V.type,[L]):L.type.kind!=="value"&&V.type.kind==="value"&&(V=new la(L.type,[V])));var Y=null;if(E.length===4){if(L.type.kind!=="string"&&V.type.kind!=="string"&&L.type.kind!=="value"&&V.type.kind!=="value")return A.error("Cannot use collator to compare non-string types.");if(!(Y=A.parse(E[3],3,hi)))return null}return new x(L,V,Y)},x.prototype.evaluate=function(E){var A=this.lhs.evaluate(E),R=this.rhs.evaluate(E);if(m&&this.hasUntypedArgument){var L=Ca(A),V=Ca(R);if(L.kind!==V.kind||L.kind!=="string"&&L.kind!=="number")throw new na('Expected arguments for "'+o+'" to be (string, string) or (number, number), but found ('+L.kind+", "+V.kind+") instead.")}if(this.collator&&!m&&this.hasUntypedArgument){var Y=Ca(A),K=Ca(R);if(Y.kind!=="string"||K.kind!=="string")return u(E,A,R)}return this.collator?c(E,A,R,this.collator.evaluate(E)):u(E,A,R)},x.prototype.eachChild=function(E){E(this.lhs),E(this.rhs),this.collator&&E(this.collator)},x.prototype.outputDefined=function(){return!0},x.prototype.serialize=function(){var E=[o];return this.eachChild(function(A){E.push(A.serialize())}),E},x}()}rl.parse=function(o,u){if(o.length<=2||o.length>=5)return u.error("Expected 3 or 4 arguments, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1,sn),m=u.parse(o[2],2,rr);if(!c||!m)return null;if(!Pa(c.type,[Di(sn),Xr,sn]))return u.error("Expected first argument to be of type array or string, but found "+Ei(c.type)+" instead");if(o.length===4){var x=u.parse(o[3],3,rr);return x?new rl(c.type,c,m,x):null}return new rl(c.type,c,m)},rl.prototype.evaluate=function(o){var u=this.input.evaluate(o),c=this.beginIndex.evaluate(o);if(!Si(u,["string","array"]))throw new na("Expected first argument to be of type array or string, but found "+Ei(Ca(u))+" instead.");if(this.endIndex){var m=this.endIndex.evaluate(o);return u.slice(c,m)}return u.slice(c)},rl.prototype.eachChild=function(o){o(this.input),o(this.beginIndex),this.endIndex&&o(this.endIndex)},rl.prototype.outputDefined=function(){return!1},rl.prototype.serialize=function(){if(this.endIndex!=null&&this.endIndex!==void 0){var o=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),o]}return["slice",this.input.serialize(),this.beginIndex.serialize()]};var ou=Ci("==",function(o,u,c){return u===c},$i),mu=Ci("!=",function(o,u,c){return u!==c},function(o,u,c,m){return!$i(0,u,c,m)}),Cf=Ci("<",function(o,u,c){return u<c},function(o,u,c,m){return m.compare(u,c)<0}),Za=Ci(">",function(o,u,c){return u>c},function(o,u,c,m){return m.compare(u,c)>0}),vh=Ci("<=",function(o,u,c){return u<=c},function(o,u,c,m){return m.compare(u,c)<=0}),Rf=Ci(">=",function(o,u,c){return u>=c},function(o,u,c,m){return m.compare(u,c)>=0}),Fs=function(o,u,c,m,x){this.type=Xr,this.number=o,this.locale=u,this.currency=c,this.minFractionDigits=m,this.maxFractionDigits=x};Fs.parse=function(o,u){if(o.length!==3)return u.error("Expected two arguments.");var c=u.parse(o[1],1,rr);if(!c)return null;var m=o[2];if(typeof m!="object"||Array.isArray(m))return u.error("NumberFormat options argument must be an object.");var x=null;if(m.locale&&!(x=u.parse(m.locale,1,Xr)))return null;var E=null;if(m.currency&&!(E=u.parse(m.currency,1,Xr)))return null;var A=null;if(m["min-fraction-digits"]&&!(A=u.parse(m["min-fraction-digits"],1,rr)))return null;var R=null;return m["max-fraction-digits"]&&!(R=u.parse(m["max-fraction-digits"],1,rr))?null:new Fs(c,x,E,A,R)},Fs.prototype.evaluate=function(o){return new Intl.NumberFormat(this.locale?this.locale.evaluate(o):[],{style:this.currency?"currency":"decimal",currency:this.currency?this.currency.evaluate(o):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(o):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(o):void 0}).format(this.number.evaluate(o))},Fs.prototype.eachChild=function(o){o(this.number),this.locale&&o(this.locale),this.currency&&o(this.currency),this.minFractionDigits&&o(this.minFractionDigits),this.maxFractionDigits&&o(this.maxFractionDigits)},Fs.prototype.outputDefined=function(){return!1},Fs.prototype.serialize=function(){var o={};return this.locale&&(o.locale=this.locale.serialize()),this.currency&&(o.currency=this.currency.serialize()),this.minFractionDigits&&(o["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(o["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),o]};var nl=function(o){this.type=rr,this.input=o};nl.parse=function(o,u){if(o.length!==2)return u.error("Expected 1 argument, but found "+(o.length-1)+" instead.");var c=u.parse(o[1],1);return c?c.type.kind!=="array"&&c.type.kind!=="string"&&c.type.kind!=="value"?u.error("Expected argument of type string or array, but found "+Ei(c.type)+" instead."):new nl(c):null},nl.prototype.evaluate=function(o){var u=this.input.evaluate(o);if(typeof u=="string"||Array.isArray(u))return u.length;throw new na("Expected value to be of type string or array, but found "+Ei(Ca(u))+" instead.")},nl.prototype.eachChild=function(o){o(this.input)},nl.prototype.outputDefined=function(){return!1},nl.prototype.serialize=function(){var o=["length"];return this.eachChild(function(u){o.push(u.serialize())}),o};var gu={"==":ou,"!=":mu,">":Za,"<":Cf,">=":Rf,"<=":vh,array:la,at:wl,boolean:la,case:Nu,coalesce:Tl,collator:Jt,format:ns,image:$o,in:ui,"index-of":tl,interpolate:qo,"interpolate-hcl":qo,"interpolate-lab":qo,length:nl,let:Ks,literal:ka,match:Bs,number:la,"number-format":Fs,object:la,slice:rl,step:Ls,string:la,"to-boolean":vs,"to-color":vs,"to-number":vs,"to-string":vs,var:Bu,within:Yo};function Cl(o,u){var c=u[0],m=u[1],x=u[2],E=u[3];c=c.evaluate(o),m=m.evaluate(o),x=x.evaluate(o);var A=E?E.evaluate(o):1,R=Gl(c,m,x,A);if(R)throw new na(R);return new Ai(c/255*A,m/255*A,x/255*A,A)}function mh(o,u){return o in u}function yc(o,u){var c=u[o];return c===void 0?null:c}function sa(o){return{type:o}}function xc(o){return{result:"success",value:o}}function il(o){return{result:"error",value:o}}function Rl(o){return o["property-type"]==="data-driven"||o["property-type"]==="cross-faded-data-driven"}function gh(o){return!!o.expression&&o.expression.parameters.indexOf("zoom")>-1}function qc(o){return!!o.expression&&o.expression.interpolated}function fa(o){return o instanceof Number?"number":o instanceof String?"string":o instanceof Boolean?"boolean":Array.isArray(o)?"array":o===null?"null":typeof o}function Ml(o){return typeof o=="object"&&o!==null&&!Array.isArray(o)}function op(o){return o}function al(o,u,c){return o!==void 0?o:u!==void 0?u:c!==void 0?c:void 0}function Kc(o,u,c,m,x){return al(typeof c===x?m[c]:void 0,o.default,u.default)}function Qc(o,u,c){if(fa(c)!=="number")return al(o.default,u.default);var m=o.stops.length;if(m===1||c<=o.stops[0][0])return o.stops[0][1];if(c>=o.stops[m-1][0])return o.stops[m-1][1];var x=$c(o.stops.map(function(E){return E[0]}),c);return o.stops[x][1]}function Mf(o,u,c){var m=o.base!==void 0?o.base:1;if(fa(c)!=="number")return al(o.default,u.default);var x=o.stops.length;if(x===1||c<=o.stops[0][0])return o.stops[0][1];if(c>=o.stops[x-1][0])return o.stops[x-1][1];var E=$c(o.stops.map(function(K){return K[0]}),c),A=function(K,le,de,Ne){var I=Ne-de,ft=K-de;return I===0?0:le===1?ft/I:(Math.pow(le,ft)-1)/(Math.pow(le,I)-1)}(c,m,o.stops[E][0],o.stops[E+1][0]),R=o.stops[E][1],L=o.stops[E+1][1],V=Al[u.type]||op;if(o.colorSpace&&o.colorSpace!=="rgb"){var Y=ip[o.colorSpace];V=function(K,le){return Y.reverse(Y.interpolate(Y.forward(K),Y.forward(le),A))}}return typeof R.evaluate=="function"?{evaluate:function(){for(var K=[],le=arguments.length;le--;)K[le]=arguments[le];var de=R.evaluate.apply(void 0,K),Ne=L.evaluate.apply(void 0,K);if(de!==void 0&&Ne!==void 0)return V(de,Ne,A)}}:V(R,L,A)}function ol(o,u,c){return u.type==="color"?c=Ai.parse(c):u.type==="formatted"?c=ca.fromString(c.toString()):u.type==="resolvedImage"?c=wa.fromString(c.toString()):fa(c)===u.type||u.type==="enum"&&u.values[c]||(c=void 0),al(c,o.default,u.default)}Ji.register(gu,{error:[{kind:"error"},[Xr],function(o,u){throw new na(u[0].evaluate(o))}],typeof:[Xr,[sn],function(o,u){return Ei(Ca(u[0].evaluate(o)))}],"to-rgba":[Di(rr,4),[Vr],function(o,u){return u[0].evaluate(o).toArray()}],rgb:[Vr,[rr,rr,rr],Cl],rgba:[Vr,[rr,rr,rr,rr],Cl],has:{type:zr,overloads:[[[Xr],function(o,u){return mh(u[0].evaluate(o),o.properties())}],[[Xr,ei],function(o,u){var c=u[1];return mh(u[0].evaluate(o),c.evaluate(o))}]]},get:{type:sn,overloads:[[[Xr],function(o,u){return yc(u[0].evaluate(o),o.properties())}],[[Xr,ei],function(o,u){var c=u[1];return yc(u[0].evaluate(o),c.evaluate(o))}]]},"feature-state":[sn,[Xr],function(o,u){return yc(u[0].evaluate(o),o.featureState||{})}],properties:[ei,[],function(o){return o.properties()}],"geometry-type":[Xr,[],function(o){return o.geometryType()}],id:[sn,[],function(o){return o.id()}],zoom:[rr,[],function(o){return o.globals.zoom}],"heatmap-density":[rr,[],function(o){return o.globals.heatmapDensity||0}],"line-progress":[rr,[],function(o){return o.globals.lineProgress||0}],accumulated:[sn,[],function(o){return o.globals.accumulated===void 0?null:o.globals.accumulated}],"+":[rr,sa(rr),function(o,u){for(var c=0,m=0,x=u;m<x.length;m+=1)c+=x[m].evaluate(o);return c}],"*":[rr,sa(rr),function(o,u){for(var c=1,m=0,x=u;m<x.length;m+=1)c*=x[m].evaluate(o);return c}],"-":{type:rr,overloads:[[[rr,rr],function(o,u){var c=u[1];return u[0].evaluate(o)-c.evaluate(o)}],[[rr],function(o,u){return-u[0].evaluate(o)}]]},"/":[rr,[rr,rr],function(o,u){var c=u[1];return u[0].evaluate(o)/c.evaluate(o)}],"%":[rr,[rr,rr],function(o,u){var c=u[1];return u[0].evaluate(o)%c.evaluate(o)}],ln2:[rr,[],function(){return Math.LN2}],pi:[rr,[],function(){return Math.PI}],e:[rr,[],function(){return Math.E}],"^":[rr,[rr,rr],function(o,u){var c=u[1];return Math.pow(u[0].evaluate(o),c.evaluate(o))}],sqrt:[rr,[rr],function(o,u){return Math.sqrt(u[0].evaluate(o))}],log10:[rr,[rr],function(o,u){return Math.log(u[0].evaluate(o))/Math.LN10}],ln:[rr,[rr],function(o,u){return Math.log(u[0].evaluate(o))}],log2:[rr,[rr],function(o,u){return Math.log(u[0].evaluate(o))/Math.LN2}],sin:[rr,[rr],function(o,u){return Math.sin(u[0].evaluate(o))}],cos:[rr,[rr],function(o,u){return Math.cos(u[0].evaluate(o))}],tan:[rr,[rr],function(o,u){return Math.tan(u[0].evaluate(o))}],asin:[rr,[rr],function(o,u){return Math.asin(u[0].evaluate(o))}],acos:[rr,[rr],function(o,u){return Math.acos(u[0].evaluate(o))}],atan:[rr,[rr],function(o,u){return Math.atan(u[0].evaluate(o))}],min:[rr,sa(rr),function(o,u){return Math.min.apply(Math,u.map(function(c){return c.evaluate(o)}))}],max:[rr,sa(rr),function(o,u){return Math.max.apply(Math,u.map(function(c){return c.evaluate(o)}))}],abs:[rr,[rr],function(o,u){return Math.abs(u[0].evaluate(o))}],round:[rr,[rr],function(o,u){var c=u[0].evaluate(o);return c<0?-Math.round(-c):Math.round(c)}],floor:[rr,[rr],function(o,u){return Math.floor(u[0].evaluate(o))}],ceil:[rr,[rr],function(o,u){return Math.ceil(u[0].evaluate(o))}],"filter-==":[zr,[Xr,sn],function(o,u){var c=u[0],m=u[1];return o.properties()[c.value]===m.value}],"filter-id-==":[zr,[sn],function(o,u){var c=u[0];return o.id()===c.value}],"filter-type-==":[zr,[Xr],function(o,u){var c=u[0];return o.geometryType()===c.value}],"filter-<":[zr,[Xr,sn],function(o,u){var c=u[0],m=u[1],x=o.properties()[c.value],E=m.value;return typeof x==typeof E&&x<E}],"filter-id-<":[zr,[sn],function(o,u){var c=u[0],m=o.id(),x=c.value;return typeof m==typeof x&&m<x}],"filter->":[zr,[Xr,sn],function(o,u){var c=u[0],m=u[1],x=o.properties()[c.value],E=m.value;return typeof x==typeof E&&x>E}],"filter-id->":[zr,[sn],function(o,u){var c=u[0],m=o.id(),x=c.value;return typeof m==typeof x&&m>x}],"filter-<=":[zr,[Xr,sn],function(o,u){var c=u[0],m=u[1],x=o.properties()[c.value],E=m.value;return typeof x==typeof E&&x<=E}],"filter-id-<=":[zr,[sn],function(o,u){var c=u[0],m=o.id(),x=c.value;return typeof m==typeof x&&m<=x}],"filter->=":[zr,[Xr,sn],function(o,u){var c=u[0],m=u[1],x=o.properties()[c.value],E=m.value;return typeof x==typeof E&&x>=E}],"filter-id->=":[zr,[sn],function(o,u){var c=u[0],m=o.id(),x=c.value;return typeof m==typeof x&&m>=x}],"filter-has":[zr,[sn],function(o,u){return u[0].value in o.properties()}],"filter-has-id":[zr,[],function(o){return o.id()!==null&&o.id()!==void 0}],"filter-type-in":[zr,[Di(Xr)],function(o,u){return u[0].value.indexOf(o.geometryType())>=0}],"filter-id-in":[zr,[Di(sn)],function(o,u){return u[0].value.indexOf(o.id())>=0}],"filter-in-small":[zr,[Xr,Di(sn)],function(o,u){var c=u[0];return u[1].value.indexOf(o.properties()[c.value])>=0}],"filter-in-large":[zr,[Xr,Di(sn)],function(o,u){var c=u[0],m=u[1];return function(x,E,A,R){for(;A<=R;){var L=A+R>>1;if(E[L]===x)return!0;E[L]>x?R=L-1:A=L+1}return!1}(o.properties()[c.value],m.value,0,m.value.length-1)}],all:{type:zr,overloads:[[[zr,zr],function(o,u){var c=u[1];return u[0].evaluate(o)&&c.evaluate(o)}],[sa(zr),function(o,u){for(var c=0,m=u;c<m.length;c+=1)if(!m[c].evaluate(o))return!1;return!0}]]},any:{type:zr,overloads:[[[zr,zr],function(o,u){var c=u[1];return u[0].evaluate(o)||c.evaluate(o)}],[sa(zr),function(o,u){for(var c=0,m=u;c<m.length;c+=1)if(m[c].evaluate(o))return!0;return!1}]]},"!":[zr,[zr],function(o,u){return!u[0].evaluate(o)}],"is-supported-script":[zr,[Xr],function(o,u){var c=o.globals&&o.globals.isSupportedScript;return!c||c(u[0].evaluate(o))}],upcase:[Xr,[Xr],function(o,u){return u[0].evaluate(o).toUpperCase()}],downcase:[Xr,[Xr],function(o,u){return u[0].evaluate(o).toLowerCase()}],concat:[Xr,sa(sn),function(o,u){return u.map(function(c){return vi(c.evaluate(o))}).join("")}],"resolved-locale":[Xr,[hi],function(o,u){return u[0].evaluate(o).resolvedLocale()}]});var $l=function(o,u){this.expression=o,this._warningHistory={},this._evaluator=new ya,this._defaultValue=u?function(c){return c.type==="color"&&Ml(c.default)?new Ai(0,0,0,0):c.type==="color"?Ai.parse(c.default)||null:c.default===void 0?null:c.default}(u):null,this._enumValues=u&&u.type==="enum"?u.values:null};function Uu(o){return Array.isArray(o)&&o.length>0&&typeof o[0]=="string"&&o[0]in gu}function Jc(o,u){var c=new Ju(gu,[],u?function(x){var E={color:Vr,string:Xr,number:rr,enum:Xr,boolean:zr,formatted:Vi,resolvedImage:ci};return x.type==="array"?Di(E[x.value]||sn,x.length):E[x.type]}(u):void 0),m=c.parse(o,void 0,void 0,void 0,u&&u.type==="string"?{typeAnnotation:"coerce"}:void 0);return m?xc(new $l(m,u)):il(c.errors)}$l.prototype.evaluateWithoutErrorHandling=function(o,u,c,m,x,E){return this._evaluator.globals=o,this._evaluator.feature=u,this._evaluator.featureState=c,this._evaluator.canonical=m,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E,this.expression.evaluate(this._evaluator)},$l.prototype.evaluate=function(o,u,c,m,x,E){this._evaluator.globals=o,this._evaluator.feature=u||null,this._evaluator.featureState=c||null,this._evaluator.canonical=m,this._evaluator.availableImages=x||null,this._evaluator.formattedSection=E||null;try{var A=this.expression.evaluate(this._evaluator);if(A==null||typeof A=="number"&&A!=A)return this._defaultValue;if(this._enumValues&&!(A in this._enumValues))throw new na("Expected value to be one of "+Object.keys(this._enumValues).map(function(R){return JSON.stringify(R)}).join(", ")+", but found "+JSON.stringify(A)+" instead.");return A}catch(R){return this._warningHistory[R.message]||(this._warningHistory[R.message]=!0,typeof console!="undefined"&&console.warn(R.message)),this._defaultValue}};var bc=function(o,u){this.kind=o,this._styleExpression=u,this.isStateDependent=o!=="constant"&&!Sl(u.expression)};bc.prototype.evaluateWithoutErrorHandling=function(o,u,c,m,x,E){return this._styleExpression.evaluateWithoutErrorHandling(o,u,c,m,x,E)},bc.prototype.evaluate=function(o,u,c,m,x,E){return this._styleExpression.evaluate(o,u,c,m,x,E)};var Yl=function(o,u,c,m){this.kind=o,this.zoomStops=c,this._styleExpression=u,this.isStateDependent=o!=="camera"&&!Sl(u.expression),this.interpolationType=m};function _h(o,u){if((o=Jc(o,u)).result==="error")return o;var c=o.value.expression,m=El(c);if(!m&&!Rl(u))return il([new gr("","data expressions not supported")]);var x=Lu(c,["zoom"]);if(!x&&!gh(u))return il([new gr("","zoom expressions not supported")]);var E=function A(R){var L=null;if(R instanceof Ks)L=A(R.result);else if(R instanceof Tl)for(var V=0,Y=R.args;V<Y.length&&!(L=A(Y[V]));V+=1);else(R instanceof Ls||R instanceof qo)&&R.input instanceof Ji&&R.input.name==="zoom"&&(L=R);return L instanceof gr||R.eachChild(function(K){var le=A(K);le instanceof gr?L=le:!L&&le?L=new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.'):L&&le&&L!==le&&(L=new gr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),L}(c);return E||x?E instanceof gr?il([E]):E instanceof qo&&!qc(u)?il([new gr("",'"interpolate" expressions cannot be used with this property')]):xc(E?new Yl(m?"camera":"composite",o.value,E.labels,E instanceof qo?E.interpolation:void 0):new bc(m?"constant":"source",o.value)):il([new gr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression.')])}Yl.prototype.evaluateWithoutErrorHandling=function(o,u,c,m,x,E){return this._styleExpression.evaluateWithoutErrorHandling(o,u,c,m,x,E)},Yl.prototype.evaluate=function(o,u,c,m,x,E){return this._styleExpression.evaluate(o,u,c,m,x,E)},Yl.prototype.interpolationFactor=function(o,u,c){return this.interpolationType?qo.interpolationFactor(this.interpolationType,o,u,c):0};var Ec=function(o,u){this._parameters=o,this._specification=u,rt(this,function c(m,x){var E,A,R,L=x.type==="color",V=m.stops&&typeof m.stops[0][0]=="object",Y=V||!(V||m.property!==void 0),K=m.type||(qc(x)?"exponential":"interval");if(L&&((m=rt({},m)).stops&&(m.stops=m.stops.map(function(vn){return[vn[0],Ai.parse(vn[1])]})),m.default=Ai.parse(m.default?m.default:x.default)),m.colorSpace&&m.colorSpace!=="rgb"&&!ip[m.colorSpace])throw new Error("Unknown color space: "+m.colorSpace);if(K==="exponential")E=Mf;else if(K==="interval")E=Qc;else if(K==="categorical"){E=Kc,A=Object.create(null);for(var le=0,de=m.stops;le<de.length;le+=1){var Ne=de[le];A[Ne[0]]=Ne[1]}R=typeof m.stops[0][0]}else{if(K!=="identity")throw new Error('Unknown function type "'+K+'"');E=ol}if(V){for(var I={},ft=[],tt=0;tt<m.stops.length;tt++){var Rt=m.stops[tt],zt=Rt[0].zoom;I[zt]===void 0&&(I[zt]={zoom:zt,type:m.type,property:m.property,default:m.default,stops:[]},ft.push(zt)),I[zt].stops.push([Rt[0].value,Rt[1]])}for(var ir=[],or=0,mr=ft;or<mr.length;or+=1){var Zr=mr[or];ir.push([I[Zr].zoom,c(I[Zr],x)])}var qr={name:"linear"};return{kind:"composite",interpolationType:qr,interpolationFactor:qo.interpolationFactor.bind(void 0,qr),zoomStops:ir.map(function(vn){return vn[0]}),evaluate:function(vn,Zn){var mn=vn.zoom;return Mf({stops:ir,base:m.base},x,mn).evaluate(mn,Zn)}}}if(Y){var Bn=K==="exponential"?{name:"exponential",base:m.base!==void 0?m.base:1}:null;return{kind:"camera",interpolationType:Bn,interpolationFactor:qo.interpolationFactor.bind(void 0,Bn),zoomStops:m.stops.map(function(vn){return vn[0]}),evaluate:function(vn){return E(m,x,vn.zoom,A,R)}}}return{kind:"source",evaluate:function(vn,Zn){var mn=Zn&&Zn.properties?Zn.properties[m.property]:void 0;return mn===void 0?al(m.default,x.default):E(m,x,mn,A,R)}}}(this._parameters,this._specification))};function Ns(o){var u=o.key,c=o.value,m=o.valueSpec||{},x=o.objectElementValidators||{},E=o.style,A=o.styleSpec,R=[],L=fa(c);if(L!=="object")return[new Q(u,c,"object expected, "+L+" found")];for(var V in c){var Y=V.split(".")[0],K=m[Y]||m["*"],le=void 0;if(x[Y])le=x[Y];else if(m[Y])le=Li;else if(x["*"])le=x["*"];else{if(!m["*"]){R.push(new Q(u,c[V],'unknown property "'+V+'"'));continue}le=Li}R=R.concat(le({key:(u&&u+".")+V,value:c[V],valueSpec:K,style:E,styleSpec:A,object:c,objectKey:V},c))}for(var de in m)x[de]||m[de].required&&m[de].default===void 0&&c[de]===void 0&&R.push(new Q(u,c,'missing required property "'+de+'"'));return R}function yh(o){var u=o.value,c=o.valueSpec,m=o.style,x=o.styleSpec,E=o.key,A=o.arrayElementValidator||Li;if(fa(u)!=="array")return[new Q(E,u,"array expected, "+fa(u)+" found")];if(c.length&&u.length!==c.length)return[new Q(E,u,"array length "+c.length+" expected, length "+u.length+" found")];if(c["min-length"]&&u.length<c["min-length"])return[new Q(E,u,"array length at least "+c["min-length"]+" expected, length "+u.length+" found")];var R={type:c.value,values:c.values};x.$version<7&&(R.function=c.function),fa(c.value)==="object"&&(R=c.value);for(var L=[],V=0;V<u.length;V++)L=L.concat(A({array:u,arrayIndex:V,value:u[V],valueSpec:R,style:m,styleSpec:x,key:E+"["+V+"]"}));return L}function ef(o){var u=o.key,c=o.value,m=o.valueSpec,x=fa(c);return x==="number"&&c!=c&&(x="NaN"),x!=="number"?[new Q(u,c,"number expected, "+x+" found")]:"minimum"in m&&c<m.minimum?[new Q(u,c,c+" is less than the minimum value "+m.minimum)]:"maximum"in m&&c>m.maximum?[new Q(u,c,c+" is greater than the maximum value "+m.maximum)]:[]}function Sc(o){var u,c,m,x=o.valueSpec,E=Ee(o.value.type),A={},R=E!=="categorical"&&o.value.property===void 0,L=!R,V=fa(o.value.stops)==="array"&&fa(o.value.stops[0])==="array"&&fa(o.value.stops[0][0])==="object",Y=Ns({key:o.key,value:o.value,valueSpec:o.styleSpec.function,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{stops:function(de){if(E==="identity")return[new Q(de.key,de.value,'identity function may not have a "stops" property')];var Ne=[],I=de.value;return Ne=Ne.concat(yh({key:de.key,value:I,valueSpec:de.valueSpec,style:de.style,styleSpec:de.styleSpec,arrayElementValidator:K})),fa(I)==="array"&&I.length===0&&Ne.push(new Q(de.key,I,"array must have at least one stop")),Ne},default:function(de){return Li({key:de.key,value:de.value,valueSpec:x,style:de.style,styleSpec:de.styleSpec})}}});return E==="identity"&&R&&Y.push(new Q(o.key,o.value,'missing required property "property"')),E==="identity"||o.value.stops||Y.push(new Q(o.key,o.value,'missing required property "stops"')),E==="exponential"&&o.valueSpec.expression&&!qc(o.valueSpec)&&Y.push(new Q(o.key,o.value,"exponential functions not supported")),o.styleSpec.$version>=8&&(L&&!Rl(o.valueSpec)?Y.push(new Q(o.key,o.value,"property functions not supported")):R&&!gh(o.valueSpec)&&Y.push(new Q(o.key,o.value,"zoom functions not supported"))),E!=="categorical"&&!V||o.value.property!==void 0||Y.push(new Q(o.key,o.value,'"property" property is required')),Y;function K(de){var Ne=[],I=de.value,ft=de.key;if(fa(I)!=="array")return[new Q(ft,I,"array expected, "+fa(I)+" found")];if(I.length!==2)return[new Q(ft,I,"array length 2 expected, length "+I.length+" found")];if(V){if(fa(I[0])!=="object")return[new Q(ft,I,"object expected, "+fa(I[0])+" found")];if(I[0].zoom===void 0)return[new Q(ft,I,"object stop key must have zoom")];if(I[0].value===void 0)return[new Q(ft,I,"object stop key must have value")];if(m&&m>Ee(I[0].zoom))return[new Q(ft,I[0].zoom,"stop zoom values must appear in ascending order")];Ee(I[0].zoom)!==m&&(m=Ee(I[0].zoom),c=void 0,A={}),Ne=Ne.concat(Ns({key:ft+"[0]",value:I[0],valueSpec:{zoom:{}},style:de.style,styleSpec:de.styleSpec,objectElementValidators:{zoom:ef,value:le}}))}else Ne=Ne.concat(le({key:ft+"[0]",value:I[0],valueSpec:{},style:de.style,styleSpec:de.styleSpec},I));return Uu(Yt(I[1]))?Ne.concat([new Q(ft+"[1]",I[1],"expressions are not allowed in function stops.")]):Ne.concat(Li({key:ft+"[1]",value:I[1],valueSpec:x,style:de.style,styleSpec:de.styleSpec}))}function le(de,Ne){var I=fa(de.value),ft=Ee(de.value),tt=de.value!==null?de.value:Ne;if(u){if(I!==u)return[new Q(de.key,tt,I+" stop domain type must match previous stop domain type "+u)]}else u=I;if(I!=="number"&&I!=="string"&&I!=="boolean")return[new Q(de.key,tt,"stop domain value must be a number, string, or boolean")];if(I!=="number"&&E!=="categorical"){var Rt="number expected, "+I+" found";return Rl(x)&&E===void 0&&(Rt+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new Q(de.key,tt,Rt)]}return E!=="categorical"||I!=="number"||isFinite(ft)&&Math.floor(ft)===ft?E!=="categorical"&&I==="number"&&c!==void 0&&ft<c?[new Q(de.key,tt,"stop domain values must appear in ascending order")]:(c=ft,E==="categorical"&&ft in A?[new Q(de.key,tt,"stop domain values must be unique")]:(A[ft]=!0,[])):[new Q(de.key,tt,"integer expected, found "+ft)]}}function Il(o){var u=(o.expressionContext==="property"?_h:Jc)(Yt(o.value),o.valueSpec);if(u.result==="error")return u.value.map(function(m){return new Q(""+o.key+m.key,o.value,m.message)});var c=u.value.expression||u.value._styleExpression.expression;if(o.expressionContext==="property"&&o.propertyKey==="text-font"&&!c.outputDefined())return[new Q(o.key,o.value,'Invalid data expression for "'+o.propertyKey+'". Output values must be contained as literals within the expression.')];if(o.expressionContext==="property"&&o.propertyType==="layout"&&!Sl(c))return[new Q(o.key,o.value,'"feature-state" data expressions are not supported with layout properties.')];if(o.expressionContext==="filter"&&!Sl(c))return[new Q(o.key,o.value,'"feature-state" data expressions are not supported with filters.')];if(o.expressionContext&&o.expressionContext.indexOf("cluster")===0){if(!Lu(c,["zoom","feature-state"]))return[new Q(o.key,o.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(o.expressionContext==="cluster-initial"&&!El(c))return[new Q(o.key,o.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function zu(o){var u=o.key,c=o.value,m=o.valueSpec,x=[];return Array.isArray(m.values)?m.values.indexOf(Ee(c))===-1&&x.push(new Q(u,c,"expected one of ["+m.values.join(", ")+"], "+JSON.stringify(c)+" found")):Object.keys(m.values).indexOf(Ee(c))===-1&&x.push(new Q(u,c,"expected one of ["+Object.keys(m.values).join(", ")+"], "+JSON.stringify(c)+" found")),x}function ql(o){if(o===!0||o===!1)return!0;if(!Array.isArray(o)||o.length===0)return!1;switch(o[0]){case"has":return o.length>=2&&o[1]!=="$id"&&o[1]!=="$type";case"in":return o.length>=3&&(typeof o[1]!="string"||Array.isArray(o[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return o.length!==3||Array.isArray(o[1])||Array.isArray(o[2]);case"any":case"all":for(var u=0,c=o.slice(1);u<c.length;u+=1){var m=c[u];if(!ql(m)&&typeof m!="boolean")return!1}return!0;default:return!0}}Ec.deserialize=function(o){return new Ec(o._parameters,o._specification)},Ec.serialize=function(o){return{_parameters:o._parameters,_specification:o._specification}};var If={type:"boolean",default:!1,transition:!1,"property-type":"data-driven",expression:{interpolated:!1,parameters:["zoom","feature"]}};function sl(o){if(o==null)return{filter:function(){return!0},needGeometry:!1};ql(o)||(o=bh(o));var u=Jc(o,If);if(u.result==="error")throw new Error(u.value.map(function(c){return c.key+": "+c.message}).join(", "));return{filter:function(c,m,x){return u.value.evaluate(c,m,{},x)},needGeometry:function c(m){if(!Array.isArray(m))return!1;if(m[0]==="within")return!0;for(var x=1;x<m.length;x++)if(c(m[x]))return!0;return!1}(o)}}function xh(o,u){return o<u?-1:o>u?1:0}function bh(o){if(!o)return!0;var u,c=o[0];return o.length<=1?c!=="any":c==="=="?Eh(o[1],o[2],"=="):c==="!="?Va(Eh(o[1],o[2],"==")):c==="<"||c===">"||c==="<="||c===">="?Eh(o[1],o[2],c):c==="any"?(u=o.slice(1),["any"].concat(u.map(bh))):c==="all"?["all"].concat(o.slice(1).map(bh)):c==="none"?["all"].concat(o.slice(1).map(bh).map(Va)):c==="in"?Pf(o[1],o.slice(2)):c==="!in"?Va(Pf(o[1],o.slice(2))):c==="has"?sp(o[1]):c==="!has"?Va(sp(o[1])):c!=="within"||o}function Eh(o,u,c){switch(o){case"$type":return["filter-type-"+c,u];case"$id":return["filter-id-"+c,u];default:return["filter-"+c,o,u]}}function Pf(o,u){if(u.length===0)return!1;switch(o){case"$type":return["filter-type-in",["literal",u]];case"$id":return["filter-id-in",["literal",u]];default:return u.length>200&&!u.some(function(c){return typeof c!=typeof u[0]})?["filter-in-large",o,["literal",u.sort(xh)]]:["filter-in-small",o,["literal",u]]}}function sp(o){switch(o){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",o]}}function Va(o){return["!",o]}function up(o){return ql(Yt(o.value))?Il(rt({},o,{expressionContext:"filter",valueSpec:{value:"boolean"}})):function u(c){var m=c.value,x=c.key;if(fa(m)!=="array")return[new Q(x,m,"array expected, "+fa(m)+" found")];var E,A=c.styleSpec,R=[];if(m.length<1)return[new Q(x,m,"filter array must have at least 1 element")];switch(R=R.concat(zu({key:x+"[0]",value:m[0],valueSpec:A.filter_operator,style:c.style,styleSpec:c.styleSpec})),Ee(m[0])){case"<":case"<=":case">":case">=":m.length>=2&&Ee(m[1])==="$type"&&R.push(new Q(x,m,'"$type" cannot be use with operator "'+m[0]+'"'));case"==":case"!=":m.length!==3&&R.push(new Q(x,m,'filter array for operator "'+m[0]+'" must have 3 elements'));case"in":case"!in":m.length>=2&&(E=fa(m[1]))!=="string"&&R.push(new Q(x+"[1]",m[1],"string expected, "+E+" found"));for(var L=2;L<m.length;L++)E=fa(m[L]),Ee(m[1])==="$type"?R=R.concat(zu({key:x+"["+L+"]",value:m[L],valueSpec:A.geometry_type,style:c.style,styleSpec:c.styleSpec})):E!=="string"&&E!=="number"&&E!=="boolean"&&R.push(new Q(x+"["+L+"]",m[L],"string, number, or boolean expected, "+E+" found"));break;case"any":case"all":case"none":for(var V=1;V<m.length;V++)R=R.concat(u({key:x+"["+V+"]",value:m[V],style:c.style,styleSpec:c.styleSpec}));break;case"has":case"!has":E=fa(m[1]),m.length!==2?R.push(new Q(x,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="string"&&R.push(new Q(x+"[1]",m[1],"string expected, "+E+" found"));break;case"within":E=fa(m[1]),m.length!==2?R.push(new Q(x,m,'filter array for "'+m[0]+'" operator must have 2 elements')):E!=="object"&&R.push(new Q(x+"[1]",m[1],"object expected, "+E+" found"))}return R}(o)}function Of(o,u){var c=o.key,m=o.style,x=o.styleSpec,E=o.value,A=o.objectKey,R=x[u+"_"+o.layerType];if(!R)return[];var L=A.match(/^(.*)-transition$/);if(u==="paint"&&L&&R[L[1]]&&R[L[1]].transition)return Li({key:c,value:E,valueSpec:x.transition,style:m,styleSpec:x});var V,Y=o.valueSpec||R[A];if(!Y)return[new Q(c,E,'unknown property "'+A+'"')];if(fa(E)==="string"&&Rl(Y)&&!Y.tokens&&(V=/^{([^}]+)}$/.exec(E)))return[new Q(c,E,'"'+A+'" does not support interpolation syntax\nUse an identity property function instead: `{ "type": "identity", "property": '+JSON.stringify(V[1])+" }`.")];var K=[];return o.layerType==="symbol"&&(A==="text-field"&&m&&!m.glyphs&&K.push(new Q(c,E,'use of "text-field" requires a style "glyphs" property')),A==="text-font"&&Ml(Yt(E))&&Ee(E.type)==="identity"&&K.push(new Q(c,E,'"text-font" does not support identity functions'))),K.concat(Li({key:o.key,value:E,valueSpec:Y,style:m,styleSpec:x,expressionContext:"property",propertyType:u,propertyKey:A}))}function lp(o){return Of(o,"paint")}function Kl(o){return Of(o,"layout")}function cp(o){var u=[],c=o.value,m=o.key,x=o.style,E=o.styleSpec;c.type||c.ref||u.push(new Q(m,c,'either "type" or "ref" is required'));var A,R=Ee(c.type),L=Ee(c.ref);if(c.id)for(var V=Ee(c.id),Y=0;Y<o.arrayIndex;Y++){var K=x.layers[Y];Ee(K.id)===V&&u.push(new Q(m,c.id,'duplicate layer id "'+c.id+'", previously used at line '+K.id.__line__))}if("ref"in c)["type","source","source-layer","filter","layout"].forEach(function(Ne){Ne in c&&u.push(new Q(m,c[Ne],'"'+Ne+'" is prohibited for ref layers'))}),x.layers.forEach(function(Ne){Ee(Ne.id)===L&&(A=Ne)}),A?A.ref?u.push(new Q(m,c.ref,"ref cannot reference another ref layer")):R=Ee(A.type):u.push(new Q(m,c.ref,'ref layer "'+L+'" not found'));else if(R!=="background")if(c.source){var le=x.sources&&x.sources[c.source],de=le&&Ee(le.type);le?de==="vector"&&R==="raster"?u.push(new Q(m,c.source,'layer "'+c.id+'" requires a raster source')):de==="raster"&&R!=="raster"?u.push(new Q(m,c.source,'layer "'+c.id+'" requires a vector source')):de!=="vector"||c["source-layer"]?de==="raster-dem"&&R!=="hillshade"?u.push(new Q(m,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):R!=="line"||!c.paint||!c.paint["line-gradient"]||de==="geojson"&&le.lineMetrics||u.push(new Q(m,c,'layer "'+c.id+'" specifies a line-gradient, which requires a GeoJSON source with `lineMetrics` enabled.')):u.push(new Q(m,c,'layer "'+c.id+'" must specify a "source-layer"')):u.push(new Q(m,c.source,'source "'+c.source+'" not found'))}else u.push(new Q(m,c,'missing required property "source"'));return u=u.concat(Ns({key:m,value:c,valueSpec:E.layer,style:o.style,styleSpec:o.styleSpec,objectElementValidators:{"*":function(){return[]},type:function(){return Li({key:m+".type",value:c.type,valueSpec:E.layer.type,style:o.style,styleSpec:o.styleSpec,object:c,objectKey:"type"})},filter:up,layout:function(Ne){return Ns({layer:c,key:Ne.key,value:Ne.value,style:Ne.style,styleSpec:Ne.styleSpec,objectElementValidators:{"*":function(I){return Kl(rt({layerType:R},I))}}})},paint:function(Ne){return Ns({layer:c,key:Ne.key,value:Ne.value,style:Ne.style,styleSpec:Ne.styleSpec,objectElementValidators:{"*":function(I){return lp(rt({layerType:R},I))}}})}}}))}function Zu(o){var u=o.value,c=o.key,m=fa(u);return m!=="string"?[new Q(c,u,"string expected, "+m+" found")]:[]}var da={promoteId:function(o){var u=o.key,c=o.value;if(fa(c)==="string")return Zu({key:u,value:c});var m=[];for(var x in c)m.push.apply(m,Zu({key:u+"."+x,value:c[x]}));return m}};function Ql(o){var u=o.value,c=o.key,m=o.styleSpec,x=o.style;if(!u.type)return[new Q(c,u,'"type" is required')];var E,A=Ee(u.type);switch(A){case"vector":case"raster":case"raster-dem":return Ns({key:c,value:u,valueSpec:m["source_"+A.replace("-","_")],style:o.style,styleSpec:m,objectElementValidators:da});case"geojson":if(E=Ns({key:c,value:u,valueSpec:m.source_geojson,style:x,styleSpec:m,objectElementValidators:da}),u.cluster)for(var R in u.clusterProperties){var L=u.clusterProperties[R],V=L[0],Y=typeof V=="string"?[V,["accumulated"],["get",R]]:V;E.push.apply(E,Il({key:c+"."+R+".map",value:L[1],expressionContext:"cluster-map"})),E.push.apply(E,Il({key:c+"."+R+".reduce",value:Y,expressionContext:"cluster-reduce"}))}return E;case"video":return Ns({key:c,value:u,valueSpec:m.source_video,style:x,styleSpec:m});case"image":return Ns({key:c,value:u,valueSpec:m.source_image,style:x,styleSpec:m});case"canvas":return[new Q(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return zu({key:c+".type",value:u.type,valueSpec:{values:["vector","raster","raster-dem","geojson","video","image"]},style:x,styleSpec:m})}}function Vu(o){var u=o.value,c=o.styleSpec,m=c.light,x=o.style,E=[],A=fa(u);if(u===void 0)return E;if(A!=="object")return E.concat([new Q("light",u,"object expected, "+A+" found")]);for(var R in u){var L=R.match(/^(.*)-transition$/);E=E.concat(L&&m[L[1]]&&m[L[1]].transition?Li({key:R,value:u[R],valueSpec:c.transition,style:x,styleSpec:c}):m[R]?Li({key:R,value:u[R],valueSpec:m[R],style:x,styleSpec:c}):[new Q(R,u[R],'unknown property "'+R+'"')])}return E}var ul={"*":function(){return[]},array:yh,boolean:function(o){var u=o.value,c=o.key,m=fa(u);return m!=="boolean"?[new Q(c,u,"boolean expected, "+m+" found")]:[]},number:ef,color:function(o){var u=o.key,c=o.value,m=fa(c);return m!=="string"?[new Q(u,c,"color expected, "+m+" found")]:di(c)===null?[new Q(u,c,'color expected, "'+c+'" found')]:[]},constants:Le,enum:zu,filter:up,function:Sc,layer:cp,object:Ns,source:Ql,light:Vu,string:Zu,formatted:function(o){return Zu(o).length===0?[]:Il(o)},resolvedImage:function(o){return Zu(o).length===0?[]:Il(o)}};function Li(o){var u=o.value,c=o.valueSpec,m=o.styleSpec;return c.expression&&Ml(Ee(u))?Sc(o):c.expression&&Uu(Yt(u))?Il(o):c.type&&ul[c.type]?ul[c.type](o):Ns(rt({},o,{valueSpec:c.type?m[c.type]:c}))}function va(o){var u=o.value,c=o.key,m=Zu(o);return m.length||(u.indexOf("{fontstack}")===-1&&m.push(new Q(c,u,'"glyphs" url must include a "{fontstack}" token')),u.indexOf("{range}")===-1&&m.push(new Q(c,u,'"glyphs" url must include a "{range}" token'))),m}function su(o,u){u===void 0&&(u=j);var c=[];return c=c.concat(Li({key:"",value:o,valueSpec:u.$root,styleSpec:u,style:o,objectElementValidators:{glyphs:va,"*":function(){return[]}}})),o.constants&&(c=c.concat(Le({key:"constants",value:o.constants,style:o,styleSpec:u}))),tf(c)}function tf(o){return[].concat(o).sort(function(u,c){return u.line-c.line})}function rf(o){return function(){for(var u=[],c=arguments.length;c--;)u[c]=arguments[c];return tf(o.apply(this,u))}}su.source=rf(Ql),su.light=rf(Vu),su.layer=rf(cp),su.filter=rf(up),su.paintProperty=rf(lp),su.layoutProperty=rf(Kl);var Qs=su,fp=Qs.light,kf=Qs.paintProperty,Df=Qs.layoutProperty;function Jl(o,u){var c=!1;if(u&&u.length)for(var m=0,x=u;m<x.length;m+=1)o.fire(new Fe(new Error(x[m].message))),c=!0;return c}var Co=ja;function ja(o,u,c){var m=this.cells=[];if(o instanceof ArrayBuffer){this.arrayBuffer=o;var x=new Int32Array(this.arrayBuffer);o=x[0],this.d=(u=x[1])+2*(c=x[2]);for(var E=0;E<this.d*this.d;E++){var A=x[3+E],R=x[3+E+1];m.push(A===R?null:x.subarray(A,R))}var L=x[3+m.length+1];this.keys=x.subarray(x[3+m.length],L),this.bboxes=x.subarray(L),this.insert=this._insertReadonly}else{this.d=u+2*c;for(var V=0;V<this.d*this.d;V++)m.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=o,this.padding=c,this.scale=u/o,this.uid=0;var Y=c/u*o;this.min=-Y,this.max=o+Y}ja.prototype.insert=function(o,u,c,m,x){this._forEachCell(u,c,m,x,this._insertCell,this.uid++),this.keys.push(o),this.bboxes.push(u),this.bboxes.push(c),this.bboxes.push(m),this.bboxes.push(x)},ja.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},ja.prototype._insertCell=function(o,u,c,m,x,E){this.cells[x].push(E)},ja.prototype.query=function(o,u,c,m,x){var E=this.min,A=this.max;if(o<=E&&u<=E&&A<=c&&A<=m&&!x)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(o,u,c,m,this._queryCell,R,{},x),R},ja.prototype._queryCell=function(o,u,c,m,x,E,A,R){var L=this.cells[x];if(L!==null)for(var V=this.keys,Y=this.bboxes,K=0;K<L.length;K++){var le=L[K];if(A[le]===void 0){var de=4*le;(R?R(Y[de+0],Y[de+1],Y[de+2],Y[de+3]):o<=Y[de+2]&&u<=Y[de+3]&&c>=Y[de+0]&&m>=Y[de+1])?(A[le]=!0,E.push(V[le])):A[le]=!1}}},ja.prototype._forEachCell=function(o,u,c,m,x,E,A,R){for(var L=this._convertToCellCoord(o),V=this._convertToCellCoord(u),Y=this._convertToCellCoord(c),K=this._convertToCellCoord(m),le=L;le<=Y;le++)for(var de=V;de<=K;de++){var Ne=this.d*de+le;if((!R||R(this._convertFromCellCoord(le),this._convertFromCellCoord(de),this._convertFromCellCoord(le+1),this._convertFromCellCoord(de+1)))&&x.call(this,o,u,c,m,Ne,E,A,R))return}},ja.prototype._convertFromCellCoord=function(o){return(o-this.padding)/this.scale},ja.prototype._convertToCellCoord=function(o){return Math.max(0,Math.min(this.d-1,Math.floor(o*this.scale)+this.padding))},ja.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var o=this.cells,u=3+this.cells.length+1+1,c=0,m=0;m<this.cells.length;m++)c+=this.cells[m].length;var x=new Int32Array(u+c+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var E=u,A=0;A<o.length;A++){var R=o[A];x[3+A]=E,x.set(R,E),E+=R.length}return x[3+o.length]=E,x.set(this.keys,E),x[3+o.length+1]=E+=this.keys.length,x.set(this.bboxes,E),E+=this.bboxes.length,x.buffer};var nf=oe.ImageData,Ac=oe.ImageBitmap,io={};function xn(o,u,c){c===void 0&&(c={}),Object.defineProperty(u,"_classRegistryKey",{value:o,writeable:!1}),io[o]={klass:u,omit:c.omit||[],shallow:c.shallow||[]}}for(var ms in xn("Object",Object),Co.serialize=function(o,u){var c=o.toArrayBuffer();return u&&u.push(c),{buffer:c}},Co.deserialize=function(o){return new Co(o.buffer)},xn("Grid",Co),xn("Color",Ai),xn("Error",Error),xn("ResolvedImage",wa),xn("StylePropertyFunction",Ec),xn("StyleExpression",$l,{omit:["_evaluator"]}),xn("ZoomDependentExpression",Yl),xn("ZoomConstantExpression",bc),xn("CompoundExpression",Ji,{omit:["_evaluate"]}),gu)gu[ms]._classRegistryKey||xn("Expression_"+ms,gu[ms]);function Lf(o){return o&&typeof ArrayBuffer!="undefined"&&(o instanceof ArrayBuffer||o.constructor&&o.constructor.name==="ArrayBuffer")}function Tc(o){return Ac&&o instanceof Ac}function is(o,u){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp)return o;if(Lf(o)||Tc(o))return u&&u.push(o),o;if(ArrayBuffer.isView(o)){var c=o;return u&&u.push(c.buffer),c}if(o instanceof nf)return u&&u.push(o.data.buffer),o;if(Array.isArray(o)){for(var m=[],x=0,E=o;x<E.length;x+=1)m.push(is(E[x],u));return m}if(typeof o=="object"){var A=o.constructor,R=A._classRegistryKey;if(!R)throw new Error("can't serialize object of unregistered class");var L=A.serialize?A.serialize(o,u):{};if(!A.serialize){for(var V in o)if(o.hasOwnProperty(V)&&!(io[R].omit.indexOf(V)>=0)){var Y=o[V];L[V]=io[R].shallow.indexOf(V)>=0?Y:is(Y,u)}o instanceof Error&&(L.message=o.message)}if(L.$name)throw new Error("$name property is reserved for worker serialization logic.");return R!=="Object"&&(L.$name=R),L}throw new Error("can't serialize object of type "+typeof o)}function ha(o){if(o==null||typeof o=="boolean"||typeof o=="number"||typeof o=="string"||o instanceof Boolean||o instanceof Number||o instanceof String||o instanceof Date||o instanceof RegExp||Lf(o)||Tc(o)||ArrayBuffer.isView(o)||o instanceof nf)return o;if(Array.isArray(o))return o.map(ha);if(typeof o=="object"){var u=o.$name||"Object",c=io[u].klass;if(!c)throw new Error("can't deserialize unregistered class "+u);if(c.deserialize)return c.deserialize(o);for(var m=Object.create(c.prototype),x=0,E=Object.keys(o);x<E.length;x+=1){var A=E[x];if(A!=="$name"){var R=o[A];m[A]=io[u].shallow.indexOf(A)>=0?R:ha(R)}}return m}throw new Error("can't deserialize object of type "+typeof o)}var Bf=function(){this.first=!0};Bf.prototype.update=function(o,u){var c=Math.floor(o);return this.first?(this.first=!1,this.lastIntegerZoom=c,this.lastIntegerZoomTime=0,this.lastZoom=o,this.lastFloorZoom=c,!0):(this.lastFloorZoom>c?(this.lastIntegerZoom=c+1,this.lastIntegerZoomTime=u):this.lastFloorZoom<c&&(this.lastIntegerZoom=c,this.lastIntegerZoomTime=u),o!==this.lastZoom&&(this.lastZoom=o,this.lastFloorZoom=c,!0))};var an={"Latin-1 Supplement":function(o){return o>=128&&o<=255},Arabic:function(o){return o>=1536&&o<=1791},"Arabic Supplement":function(o){return o>=1872&&o<=1919},"Arabic Extended-A":function(o){return o>=2208&&o<=2303},"Hangul Jamo":function(o){return o>=4352&&o<=4607},"Unified Canadian Aboriginal Syllabics":function(o){return o>=5120&&o<=5759},Khmer:function(o){return o>=6016&&o<=6143},"Unified Canadian Aboriginal Syllabics Extended":function(o){return o>=6320&&o<=6399},"General Punctuation":function(o){return o>=8192&&o<=8303},"Letterlike Symbols":function(o){return o>=8448&&o<=8527},"Number Forms":function(o){return o>=8528&&o<=8591},"Miscellaneous Technical":function(o){return o>=8960&&o<=9215},"Control Pictures":function(o){return o>=9216&&o<=9279},"Optical Character Recognition":function(o){return o>=9280&&o<=9311},"Enclosed Alphanumerics":function(o){return o>=9312&&o<=9471},"Geometric Shapes":function(o){return o>=9632&&o<=9727},"Miscellaneous Symbols":function(o){return o>=9728&&o<=9983},"Miscellaneous Symbols and Arrows":function(o){return o>=11008&&o<=11263},"CJK Radicals Supplement":function(o){return o>=11904&&o<=12031},"Kangxi Radicals":function(o){return o>=12032&&o<=12255},"Ideographic Description Characters":function(o){return o>=12272&&o<=12287},"CJK Symbols and Punctuation":function(o){return o>=12288&&o<=12351},Hiragana:function(o){return o>=12352&&o<=12447},Katakana:function(o){return o>=12448&&o<=12543},Bopomofo:function(o){return o>=12544&&o<=12591},"Hangul Compatibility Jamo":function(o){return o>=12592&&o<=12687},Kanbun:function(o){return o>=12688&&o<=12703},"Bopomofo Extended":function(o){return o>=12704&&o<=12735},"CJK Strokes":function(o){return o>=12736&&o<=12783},"Katakana Phonetic Extensions":function(o){return o>=12784&&o<=12799},"Enclosed CJK Letters and Months":function(o){return o>=12800&&o<=13055},"CJK Compatibility":function(o){return o>=13056&&o<=13311},"CJK Unified Ideographs Extension A":function(o){return o>=13312&&o<=19903},"Yijing Hexagram Symbols":function(o){return o>=19904&&o<=19967},"CJK Unified Ideographs":function(o){return o>=19968&&o<=40959},"Yi Syllables":function(o){return o>=40960&&o<=42127},"Yi Radicals":function(o){return o>=42128&&o<=42191},"Hangul Jamo Extended-A":function(o){return o>=43360&&o<=43391},"Hangul Syllables":function(o){return o>=44032&&o<=55215},"Hangul Jamo Extended-B":function(o){return o>=55216&&o<=55295},"Private Use Area":function(o){return o>=57344&&o<=63743},"CJK Compatibility Ideographs":function(o){return o>=63744&&o<=64255},"Arabic Presentation Forms-A":function(o){return o>=64336&&o<=65023},"Vertical Forms":function(o){return o>=65040&&o<=65055},"CJK Compatibility Forms":function(o){return o>=65072&&o<=65103},"Small Form Variants":function(o){return o>=65104&&o<=65135},"Arabic Presentation Forms-B":function(o){return o>=65136&&o<=65279},"Halfwidth and Fullwidth Forms":function(o){return o>=65280&&o<=65519}};function ll(o){for(var u=0,c=o;u<c.length;u+=1)if(af(c[u].charCodeAt(0)))return!0;return!1}function af(o){return!(o!==746&&o!==747&&(o<4352||!(an["Bopomofo Extended"](o)||an.Bopomofo(o)||an["CJK Compatibility Forms"](o)&&!(o>=65097&&o<=65103)||an["CJK Compatibility Ideographs"](o)||an["CJK Compatibility"](o)||an["CJK Radicals Supplement"](o)||an["CJK Strokes"](o)||!(!an["CJK Symbols and Punctuation"](o)||o>=12296&&o<=12305||o>=12308&&o<=12319||o===12336)||an["CJK Unified Ideographs Extension A"](o)||an["CJK Unified Ideographs"](o)||an["Enclosed CJK Letters and Months"](o)||an["Hangul Compatibility Jamo"](o)||an["Hangul Jamo Extended-A"](o)||an["Hangul Jamo Extended-B"](o)||an["Hangul Jamo"](o)||an["Hangul Syllables"](o)||an.Hiragana(o)||an["Ideographic Description Characters"](o)||an.Kanbun(o)||an["Kangxi Radicals"](o)||an["Katakana Phonetic Extensions"](o)||an.Katakana(o)&&o!==12540||!(!an["Halfwidth and Fullwidth Forms"](o)||o===65288||o===65289||o===65293||o>=65306&&o<=65310||o===65339||o===65341||o===65343||o>=65371&&o<=65503||o===65507||o>=65512&&o<=65519)||!(!an["Small Form Variants"](o)||o>=65112&&o<=65118||o>=65123&&o<=65126)||an["Unified Canadian Aboriginal Syllabics"](o)||an["Unified Canadian Aboriginal Syllabics Extended"](o)||an["Vertical Forms"](o)||an["Yijing Hexagram Symbols"](o)||an["Yi Syllables"](o)||an["Yi Radicals"](o))))}function of(o){return!(af(o)||function(u){return!!(an["Latin-1 Supplement"](u)&&(u===167||u===169||u===174||u===177||u===188||u===189||u===190||u===215||u===247)||an["General Punctuation"](u)&&(u===8214||u===8224||u===8225||u===8240||u===8241||u===8251||u===8252||u===8258||u===8263||u===8264||u===8265||u===8273)||an["Letterlike Symbols"](u)||an["Number Forms"](u)||an["Miscellaneous Technical"](u)&&(u>=8960&&u<=8967||u>=8972&&u<=8991||u>=8996&&u<=9e3||u===9003||u>=9085&&u<=9114||u>=9150&&u<=9165||u===9167||u>=9169&&u<=9179||u>=9186&&u<=9215)||an["Control Pictures"](u)&&u!==9251||an["Optical Character Recognition"](u)||an["Enclosed Alphanumerics"](u)||an["Geometric Shapes"](u)||an["Miscellaneous Symbols"](u)&&!(u>=9754&&u<=9759)||an["Miscellaneous Symbols and Arrows"](u)&&(u>=11026&&u<=11055||u>=11088&&u<=11097||u>=11192&&u<=11243)||an["CJK Symbols and Punctuation"](u)||an.Katakana(u)||an["Private Use Area"](u)||an["CJK Compatibility Forms"](u)||an["Small Form Variants"](u)||an["Halfwidth and Fullwidth Forms"](u)||u===8734||u===8756||u===8757||u>=9984&&u<=10087||u>=10102&&u<=10131||u===65532||u===65533)}(o))}function _u(o){return o>=1424&&o<=2303||an["Arabic Presentation Forms-A"](o)||an["Arabic Presentation Forms-B"](o)}function Us(o,u){return!(!u&&_u(o)||o>=2304&&o<=3583||o>=3840&&o<=4255||an.Khmer(o))}function Ff(o){for(var u=0,c=o;u<c.length;u+=1)if(_u(c[u].charCodeAt(0)))return!0;return!1}var Nf=null,gs="unavailable",yu=null,hp=function(o){o&&typeof o=="string"&&o.indexOf("NetworkError")>-1&&(gs="error"),Nf&&Nf(o)};function wc(){Cc.fire(new xe("pluginStateChange",{pluginStatus:gs,pluginURL:yu}))}var Cc=new et,Uf=function(){return gs},Js=function(){if(gs!=="deferred"||!yu)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");gs="loading",wc(),yu&&Lt({url:yu},function(o){o?hp(o):(gs="loaded",wc())})},Zt={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:function(){return gs==="loaded"||Zt.applyArabicShaping!=null},isLoading:function(){return gs==="loading"},setState:function(o){gs=o.pluginStatus,yu=o.pluginURL},isParsed:function(){return Zt.applyArabicShaping!=null&&Zt.processBidirectionalText!=null&&Zt.processStyledBidirectionalText!=null},getPluginURL:function(){return yu}},Re=function(o,u){this.zoom=o,u?(this.now=u.now,this.fadeDuration=u.fadeDuration,this.zoomHistory=u.zoomHistory,this.transition=u.transition):(this.now=0,this.fadeDuration=0,this.zoomHistory=new Bf,this.transition={})};Re.prototype.isSupportedScript=function(o){return function(u,c){for(var m=0,x=u;m<x.length;m+=1)if(!Us(x[m].charCodeAt(0),c))return!1;return!0}(o,Zt.isLoaded())},Re.prototype.crossFadingFactor=function(){return this.fadeDuration===0?1:Math.min((this.now-this.zoomHistory.lastIntegerZoomTime)/this.fadeDuration,1)},Re.prototype.getCrossfadeParameters=function(){var o=this.zoom,u=o-Math.floor(o),c=this.crossFadingFactor();return o>this.zoomHistory.lastIntegerZoom?{fromScale:2,toScale:1,t:u+(1-u)*c}:{fromScale:.5,toScale:1,t:1-(1-c)*u}};var F=function(o,u){this.property=o,this.value=u,this.expression=function(c,m){if(Ml(c))return new Ec(c,m);if(Uu(c)){var x=_h(c,m);if(x.result==="error")throw new Error(x.value.map(function(A){return A.key+": "+A.message}).join(", "));return x.value}var E=c;return typeof c=="string"&&m.type==="color"&&(E=Ai.parse(c)),{kind:"constant",evaluate:function(){return E}}}(u===void 0?o.specification.default:u,o.specification)};F.prototype.isDataDriven=function(){return this.expression.kind==="source"||this.expression.kind==="composite"},F.prototype.possiblyEvaluate=function(o,u,c){return this.property.possiblyEvaluate(this,o,u,c)};var eu=function(o){this.property=o,this.value=new F(o,void 0)};eu.prototype.transitioned=function(o,u){return new Pl(this.property,this.value,u,Et({},o.transition,this.transition),o.now)},eu.prototype.untransitioned=function(){return new Pl(this.property,this.value,null,{},0)};var _e=function(o){this._properties=o,this._values=Object.create(o.defaultTransitionablePropertyValues)};_e.prototype.getValue=function(o){return ht(this._values[o].value.value)},_e.prototype.setValue=function(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new eu(this._values[o].property)),this._values[o].value=new F(this._values[o].property,u===null?void 0:ht(u))},_e.prototype.getTransition=function(o){return ht(this._values[o].transition)},_e.prototype.setTransition=function(o,u){this._values.hasOwnProperty(o)||(this._values[o]=new eu(this._values[o].property)),this._values[o].transition=ht(u)||void 0},_e.prototype.serialize=function(){for(var o={},u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u],x=this.getValue(m);x!==void 0&&(o[m]=x);var E=this.getTransition(m);E!==void 0&&(o[m+"-transition"]=E)}return o},_e.prototype.transitioned=function(o,u){for(var c=new qa(this._properties),m=0,x=Object.keys(this._values);m<x.length;m+=1){var E=x[m];c._values[E]=this._values[E].transitioned(o,u._values[E])}return c},_e.prototype.untransitioned=function(){for(var o=new qa(this._properties),u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u];o._values[m]=this._values[m].untransitioned()}return o};var Pl=function(o,u,c,m,x){this.property=o,this.value=u,this.begin=x+m.delay||0,this.end=this.begin+m.duration||0,o.specification.transition&&(m.delay||m.duration)&&(this.prior=c)};Pl.prototype.possiblyEvaluate=function(o,u,c){var m=o.now||0,x=this.value.possiblyEvaluate(o,u,c),E=this.prior;if(E){if(m>this.end)return this.prior=null,x;if(this.value.isDataDriven())return this.prior=null,x;if(m<this.begin)return E.possiblyEvaluate(o,u,c);var A=(m-this.begin)/(this.end-this.begin);return this.property.interpolate(E.possiblyEvaluate(o,u,c),x,function(R){if(R<=0)return 0;if(R>=1)return 1;var L=R*R,V=L*R;return 4*(R<.5?V:3*(R-L)+V-.75)}(A))}return x};var qa=function(o){this._properties=o,this._values=Object.create(o.defaultTransitioningPropertyValues)};qa.prototype.possiblyEvaluate=function(o,u,c){for(var m=new _s(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var A=E[x];m._values[A]=this._values[A].possiblyEvaluate(o,u,c)}return m},qa.prototype.hasTransition=function(){for(var o=0,u=Object.keys(this._values);o<u.length;o+=1)if(this._values[u[o]].prior)return!0;return!1};var zs=function(o){this._properties=o,this._values=Object.create(o.defaultPropertyValues)};zs.prototype.getValue=function(o){return ht(this._values[o].value)},zs.prototype.setValue=function(o,u){this._values[o]=new F(this._values[o].property,u===null?void 0:ht(u))},zs.prototype.serialize=function(){for(var o={},u=0,c=Object.keys(this._values);u<c.length;u+=1){var m=c[u],x=this.getValue(m);x!==void 0&&(o[m]=x)}return o},zs.prototype.possiblyEvaluate=function(o,u,c){for(var m=new _s(this._properties),x=0,E=Object.keys(this._values);x<E.length;x+=1){var A=E[x];m._values[A]=this._values[A].possiblyEvaluate(o,u,c)}return m};var Ro=function(o,u,c){this.property=o,this.value=u,this.parameters=c};Ro.prototype.isConstant=function(){return this.value.kind==="constant"},Ro.prototype.constantOr=function(o){return this.value.kind==="constant"?this.value.value:o},Ro.prototype.evaluate=function(o,u,c,m){return this.property.evaluate(this.value,this.parameters,o,u,c,m)};var _s=function(o){this._properties=o,this._values=Object.create(o.defaultPossiblyEvaluatedValues)};_s.prototype.get=function(o){return this._values[o]};var Dn=function(o){this.specification=o};Dn.prototype.possiblyEvaluate=function(o,u){return o.expression.evaluate(u)},Dn.prototype.interpolate=function(o,u,c){var m=Al[this.specification.type];return m?m(o,u,c):o};var An=function(o,u){this.specification=o,this.overrides=u};An.prototype.possiblyEvaluate=function(o,u,c,m){return new Ro(this,o.expression.kind==="constant"||o.expression.kind==="camera"?{kind:"constant",value:o.expression.evaluate(u,null,{},c,m)}:o.expression,u)},An.prototype.interpolate=function(o,u,c){if(o.value.kind!=="constant"||u.value.kind!=="constant")return o;if(o.value.value===void 0||u.value.value===void 0)return new Ro(this,{kind:"constant",value:void 0},o.parameters);var m=Al[this.specification.type];return m?new Ro(this,{kind:"constant",value:m(o.value.value,u.value.value,c)},o.parameters):o},An.prototype.evaluate=function(o,u,c,m,x,E){return o.kind==="constant"?o.value:o.evaluate(u,c,m,x,E)};var as=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(c,m,x,E){if(c.value===void 0)return new Ro(this,{kind:"constant",value:void 0},m);if(c.expression.kind==="constant"){var A=c.expression.evaluate(m,null,{},x,E),R=c.property.specification.type==="resolvedImage"&&typeof A!="string"?A.name:A,L=this._calculate(R,R,R,m);return new Ro(this,{kind:"constant",value:L},m)}if(c.expression.kind==="camera"){var V=this._calculate(c.expression.evaluate({zoom:m.zoom-1}),c.expression.evaluate({zoom:m.zoom}),c.expression.evaluate({zoom:m.zoom+1}),m);return new Ro(this,{kind:"constant",value:V},m)}return new Ro(this,c.expression,m)},u.prototype.evaluate=function(c,m,x,E,A,R){if(c.kind==="source"){var L=c.evaluate(m,x,E,A,R);return this._calculate(L,L,L,m)}return c.kind==="composite"?this._calculate(c.evaluate({zoom:Math.floor(m.zoom)-1},x,E),c.evaluate({zoom:Math.floor(m.zoom)},x,E),c.evaluate({zoom:Math.floor(m.zoom)+1},x,E),m):c.value},u.prototype._calculate=function(c,m,x,E){return E.zoom>E.zoomHistory.lastIntegerZoom?{from:c,to:m}:{from:x,to:m}},u.prototype.interpolate=function(c){return c},u}(An),os=function(o){this.specification=o};os.prototype.possiblyEvaluate=function(o,u,c,m){if(o.value!==void 0){if(o.expression.kind==="constant"){var x=o.expression.evaluate(u,null,{},c,m);return this._calculate(x,x,x,u)}return this._calculate(o.expression.evaluate(new Re(Math.floor(u.zoom-1),u)),o.expression.evaluate(new Re(Math.floor(u.zoom),u)),o.expression.evaluate(new Re(Math.floor(u.zoom+1),u)),u)}},os.prototype._calculate=function(o,u,c,m){return m.zoom>m.zoomHistory.lastIntegerZoom?{from:o,to:u}:{from:c,to:u}},os.prototype.interpolate=function(o){return o};var xu=function(o){this.specification=o};xu.prototype.possiblyEvaluate=function(o,u,c,m){return!!o.expression.evaluate(u,null,{},c,m)},xu.prototype.interpolate=function(){return!1};var Ba=function(o){for(var u in this.properties=o,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[],o){var c=o[u];c.specification.overridable&&this.overridableProperties.push(u);var m=this.defaultPropertyValues[u]=new F(c,void 0),x=this.defaultTransitionablePropertyValues[u]=new eu(c);this.defaultTransitioningPropertyValues[u]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=m.possiblyEvaluate({})}};xn("DataDrivenProperty",An),xn("DataConstantProperty",Dn),xn("CrossFadedDataDrivenProperty",as),xn("CrossFadedProperty",os),xn("ColorRampProperty",xu);var tu=function(o){function u(c,m){if(o.call(this),this.id=c.id,this.type=c.type,this._featureFilter={filter:function(){return!0},needGeometry:!1},c.type!=="custom"&&(this.metadata=(c=c).metadata,this.minzoom=c.minzoom,this.maxzoom=c.maxzoom,c.type!=="background"&&(this.source=c.source,this.sourceLayer=c["source-layer"],this.filter=c.filter),m.layout&&(this._unevaluatedLayout=new zs(m.layout)),m.paint)){for(var x in this._transitionablePaint=new _e(m.paint),c.paint)this.setPaintProperty(x,c.paint[x],{validate:!1});for(var E in c.layout)this.setLayoutProperty(E,c.layout[E],{validate:!1});this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new _s(m.paint)}}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getCrossfadeParameters=function(){return this._crossfadeParameters},u.prototype.getLayoutProperty=function(c){return c==="visibility"?this.visibility:this._unevaluatedLayout.getValue(c)},u.prototype.setLayoutProperty=function(c,m,x){x===void 0&&(x={}),m!=null&&this._validate(Df,"layers."+this.id+".layout."+c,c,m,x)||(c!=="visibility"?this._unevaluatedLayout.setValue(c,m):this.visibility=m)},u.prototype.getPaintProperty=function(c){return pr(c,"-transition")?this._transitionablePaint.getTransition(c.slice(0,-11)):this._transitionablePaint.getValue(c)},u.prototype.setPaintProperty=function(c,m,x){if(x===void 0&&(x={}),m!=null&&this._validate(kf,"layers."+this.id+".paint."+c,c,m,x))return!1;if(pr(c,"-transition"))return this._transitionablePaint.setTransition(c.slice(0,-11),m||void 0),!1;var E=this._transitionablePaint._values[c],A=E.property.specification["property-type"]==="cross-faded-data-driven",R=E.value.isDataDriven(),L=E.value;this._transitionablePaint.setValue(c,m),this._handleSpecialPaintPropertyUpdate(c);var V=this._transitionablePaint._values[c].value;return V.isDataDriven()||R||A||this._handleOverridablePaintPropertyUpdate(c,L,V)},u.prototype._handleSpecialPaintPropertyUpdate=function(c){},u.prototype._handleOverridablePaintPropertyUpdate=function(c,m,x){return!1},u.prototype.isHidden=function(c){return!!(this.minzoom&&c<this.minzoom)||!!(this.maxzoom&&c>=this.maxzoom)||this.visibility==="none"},u.prototype.updateTransitions=function(c){this._transitioningPaint=this._transitionablePaint.transitioned(c,this._transitioningPaint)},u.prototype.hasTransition=function(){return this._transitioningPaint.hasTransition()},u.prototype.recalculate=function(c,m){c.getCrossfadeParameters&&(this._crossfadeParameters=c.getCrossfadeParameters()),this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(c,void 0,m)),this.paint=this._transitioningPaint.possiblyEvaluate(c,void 0,m)},u.prototype.serialize=function(){var c={id:this.id,type:this.type,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.visibility&&(c.layout=c.layout||{},c.layout.visibility=this.visibility),Ot(c,function(m,x){return!(m===void 0||x==="layout"&&!Object.keys(m).length||x==="paint"&&!Object.keys(m).length)})},u.prototype._validate=function(c,m,x,E,A){return A===void 0&&(A={}),(!A||A.validate!==!1)&&Jl(this,c.call(Qs,{key:m,layerType:this.type,objectKey:x,value:E,styleSpec:j,style:{glyphs:!0,sprite:!0}}))},u.prototype.is3D=function(){return!1},u.prototype.isTileClipped=function(){return!1},u.prototype.hasOffscreenPass=function(){return!1},u.prototype.resize=function(){},u.prototype.isStateDependent=function(){for(var c in this.paint._values){var m=this.paint.get(c);if(m instanceof Ro&&Rl(m.property.specification)&&(m.value.kind==="source"||m.value.kind==="composite")&&m.value.isStateDependent)return!0}return!1},u}(et),bu={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array},Eu=function(o,u){this._structArray=o,this._pos1=u*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8},oa=function(){this.isTransferred=!1,this.capacity=-1,this.resize(0)};function mo(o,u){u===void 0&&(u=1);var c=0,m=0;return{members:o.map(function(x){var E=bu[x.type].BYTES_PER_ELEMENT,A=c=Sh(c,Math.max(u,E)),R=x.components||1;return m=Math.max(m,E),c+=E*R,{name:x.name,type:x.type,components:R,offset:A}}),size:Sh(c,Math.max(m,u)),alignment:u}}function Sh(o,u){return Math.ceil(o/u)*u}oa.serialize=function(o,u){return o._trim(),u&&(o.isTransferred=!0,u.push(o.arrayBuffer)),{length:o.length,arrayBuffer:o.arrayBuffer}},oa.deserialize=function(o){var u=Object.create(this.prototype);return u.arrayBuffer=o.arrayBuffer,u.length=o.length,u.capacity=o.arrayBuffer.byteLength/u.bytesPerElement,u._refreshViews(),u},oa.prototype._trim=function(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())},oa.prototype.clear=function(){this.length=0},oa.prototype.resize=function(o){this.reserve(o),this.length=o},oa.prototype.reserve=function(o){if(o>this.capacity){this.capacity=Math.max(o,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);var u=this.uint8;this._refreshViews(),u&&this.uint8.set(u)}},oa.prototype._refreshViews=function(){throw new Error("_refreshViews() must be implemented by each concrete StructArray layout")};var Ol=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var x=this.length;return this.resize(x+1),this.emplace(x,c,m)},u.prototype.emplace=function(c,m,x){var E=2*c;return this.int16[E+0]=m,this.int16[E+1]=x,c},u}(oa);Ol.prototype.bytesPerElement=4,xn("StructArrayLayout2i4",Ol);var zf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E){var A=this.length;return this.resize(A+1),this.emplace(A,c,m,x,E)},u.prototype.emplace=function(c,m,x,E,A){var R=4*c;return this.int16[R+0]=m,this.int16[R+1]=x,this.int16[R+2]=E,this.int16[R+3]=A,c},u}(oa);zf.prototype.bytesPerElement=8,xn("StructArrayLayout4i8",zf);var cl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,R){var L=this.length;return this.resize(L+1),this.emplace(L,c,m,x,E,A,R)},u.prototype.emplace=function(c,m,x,E,A,R,L){var V=6*c;return this.int16[V+0]=m,this.int16[V+1]=x,this.int16[V+2]=E,this.int16[V+3]=A,this.int16[V+4]=R,this.int16[V+5]=L,c},u}(oa);cl.prototype.bytesPerElement=12,xn("StructArrayLayout2i4i12",cl);var ys=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,R){var L=this.length;return this.resize(L+1),this.emplace(L,c,m,x,E,A,R)},u.prototype.emplace=function(c,m,x,E,A,R,L){var V=4*c,Y=8*c;return this.int16[V+0]=m,this.int16[V+1]=x,this.uint8[Y+4]=E,this.uint8[Y+5]=A,this.uint8[Y+6]=R,this.uint8[Y+7]=L,c},u}(oa);ys.prototype.bytesPerElement=8,xn("StructArrayLayout2i4ub8",ys);var ec=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var x=this.length;return this.resize(x+1),this.emplace(x,c,m)},u.prototype.emplace=function(c,m,x){var E=2*c;return this.float32[E+0]=m,this.float32[E+1]=x,c},u}(oa);ec.prototype.bytesPerElement=8,xn("StructArrayLayout2f8",ec);var Su=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,R,L,V,Y,K){var le=this.length;return this.resize(le+1),this.emplace(le,c,m,x,E,A,R,L,V,Y,K)},u.prototype.emplace=function(c,m,x,E,A,R,L,V,Y,K,le){var de=10*c;return this.uint16[de+0]=m,this.uint16[de+1]=x,this.uint16[de+2]=E,this.uint16[de+3]=A,this.uint16[de+4]=R,this.uint16[de+5]=L,this.uint16[de+6]=V,this.uint16[de+7]=Y,this.uint16[de+8]=K,this.uint16[de+9]=le,c},u}(oa);Su.prototype.bytesPerElement=20,xn("StructArrayLayout10ui20",Su);var Zf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,R,L,V,Y,K,le,de){var Ne=this.length;return this.resize(Ne+1),this.emplace(Ne,c,m,x,E,A,R,L,V,Y,K,le,de)},u.prototype.emplace=function(c,m,x,E,A,R,L,V,Y,K,le,de,Ne){var I=12*c;return this.int16[I+0]=m,this.int16[I+1]=x,this.int16[I+2]=E,this.int16[I+3]=A,this.uint16[I+4]=R,this.uint16[I+5]=L,this.uint16[I+6]=V,this.uint16[I+7]=Y,this.int16[I+8]=K,this.int16[I+9]=le,this.int16[I+10]=de,this.int16[I+11]=Ne,c},u}(oa);Zf.prototype.bytesPerElement=24,xn("StructArrayLayout4i4ui4i24",Zf);var Rc=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,x)},u.prototype.emplace=function(c,m,x,E){var A=3*c;return this.float32[A+0]=m,this.float32[A+1]=x,this.float32[A+2]=E,c},u}(oa);Rc.prototype.bytesPerElement=12,xn("StructArrayLayout3f12",Rc);var sf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.uint32[1*c+0]=m,c},u}(oa);sf.prototype.bytesPerElement=4,xn("StructArrayLayout1ul4",sf);var Vf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,R,L,V,Y){var K=this.length;return this.resize(K+1),this.emplace(K,c,m,x,E,A,R,L,V,Y)},u.prototype.emplace=function(c,m,x,E,A,R,L,V,Y,K){var le=10*c,de=5*c;return this.int16[le+0]=m,this.int16[le+1]=x,this.int16[le+2]=E,this.int16[le+3]=A,this.int16[le+4]=R,this.int16[le+5]=L,this.uint32[de+3]=V,this.uint16[le+8]=Y,this.uint16[le+9]=K,c},u}(oa);Vf.prototype.bytesPerElement=20,xn("StructArrayLayout6i1ul2ui20",Vf);var tc=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,R){var L=this.length;return this.resize(L+1),this.emplace(L,c,m,x,E,A,R)},u.prototype.emplace=function(c,m,x,E,A,R,L){var V=6*c;return this.int16[V+0]=m,this.int16[V+1]=x,this.int16[V+2]=E,this.int16[V+3]=A,this.int16[V+4]=R,this.int16[V+5]=L,c},u}(oa);tc.prototype.bytesPerElement=12,xn("StructArrayLayout2i2i2i12",tc);var rc=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A){var R=this.length;return this.resize(R+1),this.emplace(R,c,m,x,E,A)},u.prototype.emplace=function(c,m,x,E,A,R){var L=4*c,V=8*c;return this.float32[L+0]=m,this.float32[L+1]=x,this.float32[L+2]=E,this.int16[V+6]=A,this.int16[V+7]=R,c},u}(oa);rc.prototype.bytesPerElement=16,xn("StructArrayLayout2f1f2i16",rc);var Ah=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E){var A=this.length;return this.resize(A+1),this.emplace(A,c,m,x,E)},u.prototype.emplace=function(c,m,x,E,A){var R=12*c,L=3*c;return this.uint8[R+0]=m,this.uint8[R+1]=x,this.float32[L+1]=E,this.float32[L+2]=A,c},u}(oa);Ah.prototype.bytesPerElement=12,xn("StructArrayLayout2ub2f12",Ah);var ss=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,x)},u.prototype.emplace=function(c,m,x,E){var A=3*c;return this.uint16[A+0]=m,this.uint16[A+1]=x,this.uint16[A+2]=E,c},u}(oa);ss.prototype.bytesPerElement=6,xn("StructArrayLayout3ui6",ss);var Au=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,R,L,V,Y,K,le,de,Ne,I,ft,tt,Rt){var zt=this.length;return this.resize(zt+1),this.emplace(zt,c,m,x,E,A,R,L,V,Y,K,le,de,Ne,I,ft,tt,Rt)},u.prototype.emplace=function(c,m,x,E,A,R,L,V,Y,K,le,de,Ne,I,ft,tt,Rt,zt){var ir=24*c,or=12*c,mr=48*c;return this.int16[ir+0]=m,this.int16[ir+1]=x,this.uint16[ir+2]=E,this.uint16[ir+3]=A,this.uint32[or+2]=R,this.uint32[or+3]=L,this.uint32[or+4]=V,this.uint16[ir+10]=Y,this.uint16[ir+11]=K,this.uint16[ir+12]=le,this.float32[or+7]=de,this.float32[or+8]=Ne,this.uint8[mr+36]=I,this.uint8[mr+37]=ft,this.uint8[mr+38]=tt,this.uint32[or+10]=Rt,this.int16[ir+22]=zt,c},u}(oa);Au.prototype.bytesPerElement=48,xn("StructArrayLayout2i2ui3ul3ui2f3ub1ul1i48",Au);var uf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E,A,R,L,V,Y,K,le,de,Ne,I,ft,tt,Rt,zt,ir,or,mr,Zr,qr,Bn,vn,Zn,mn,xi){var ti=this.length;return this.resize(ti+1),this.emplace(ti,c,m,x,E,A,R,L,V,Y,K,le,de,Ne,I,ft,tt,Rt,zt,ir,or,mr,Zr,qr,Bn,vn,Zn,mn,xi)},u.prototype.emplace=function(c,m,x,E,A,R,L,V,Y,K,le,de,Ne,I,ft,tt,Rt,zt,ir,or,mr,Zr,qr,Bn,vn,Zn,mn,xi,ti){var Rn=34*c,Mi=17*c;return this.int16[Rn+0]=m,this.int16[Rn+1]=x,this.int16[Rn+2]=E,this.int16[Rn+3]=A,this.int16[Rn+4]=R,this.int16[Rn+5]=L,this.int16[Rn+6]=V,this.int16[Rn+7]=Y,this.uint16[Rn+8]=K,this.uint16[Rn+9]=le,this.uint16[Rn+10]=de,this.uint16[Rn+11]=Ne,this.uint16[Rn+12]=I,this.uint16[Rn+13]=ft,this.uint16[Rn+14]=tt,this.uint16[Rn+15]=Rt,this.uint16[Rn+16]=zt,this.uint16[Rn+17]=ir,this.uint16[Rn+18]=or,this.uint16[Rn+19]=mr,this.uint16[Rn+20]=Zr,this.uint16[Rn+21]=qr,this.uint16[Rn+22]=Bn,this.uint32[Mi+12]=vn,this.float32[Mi+13]=Zn,this.float32[Mi+14]=mn,this.float32[Mi+15]=xi,this.float32[Mi+16]=ti,c},u}(oa);uf.prototype.bytesPerElement=68,xn("StructArrayLayout8i15ui1ul4f68",uf);var kl=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.float32[1*c+0]=m,c},u}(oa);kl.prototype.bytesPerElement=4,xn("StructArrayLayout1f4",kl);var uu=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,x)},u.prototype.emplace=function(c,m,x,E){var A=3*c;return this.int16[A+0]=m,this.int16[A+1]=x,this.int16[A+2]=E,c},u}(oa);uu.prototype.bytesPerElement=6,xn("StructArrayLayout3i6",uu);var Th=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x){var E=this.length;return this.resize(E+1),this.emplace(E,c,m,x)},u.prototype.emplace=function(c,m,x,E){var A=4*c;return this.uint32[2*c+0]=m,this.uint16[A+2]=x,this.uint16[A+3]=E,c},u}(oa);Th.prototype.bytesPerElement=8,xn("StructArrayLayout1ul2ui8",Th);var ju=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m){var x=this.length;return this.resize(x+1),this.emplace(x,c,m)},u.prototype.emplace=function(c,m,x){var E=2*c;return this.uint16[E+0]=m,this.uint16[E+1]=x,c},u}(oa);ju.prototype.bytesPerElement=4,xn("StructArrayLayout2ui4",ju);var jf=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c){var m=this.length;return this.resize(m+1),this.emplace(m,c)},u.prototype.emplace=function(c,m){return this.uint16[1*c+0]=m,c},u}(oa);jf.prototype.bytesPerElement=2,xn("StructArrayLayout1ui2",jf);var wh=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._refreshViews=function(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)},u.prototype.emplaceBack=function(c,m,x,E){var A=this.length;return this.resize(A+1),this.emplace(A,c,m,x,E)},u.prototype.emplace=function(c,m,x,E,A){var R=4*c;return this.float32[R+0]=m,this.float32[R+1]=x,this.float32[R+2]=E,this.float32[R+3]=A,c},u}(oa);wh.prototype.bytesPerElement=16,xn("StructArrayLayout4f16",wh);var h=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={anchorPointX:{configurable:!0},anchorPointY:{configurable:!0},x1:{configurable:!0},y1:{configurable:!0},x2:{configurable:!0},y2:{configurable:!0},featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0},anchorPoint:{configurable:!0}};return c.anchorPointX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorPointY.get=function(){return this._structArray.int16[this._pos2+1]},c.x1.get=function(){return this._structArray.int16[this._pos2+2]},c.y1.get=function(){return this._structArray.int16[this._pos2+3]},c.x2.get=function(){return this._structArray.int16[this._pos2+4]},c.y2.get=function(){return this._structArray.int16[this._pos2+5]},c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+8]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.anchorPoint.get=function(){return new ce(this.anchorPointX,this.anchorPointY)},Object.defineProperties(u.prototype,c),u}(Eu);h.prototype.size=20;var v=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new h(this,c)},u}(Vf);xn("CollisionBoxArray",v);var p=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},glyphStartIndex:{configurable:!0},numGlyphs:{configurable:!0},vertexStartIndex:{configurable:!0},lineStartIndex:{configurable:!0},lineLength:{configurable:!0},segment:{configurable:!0},lowerSize:{configurable:!0},upperSize:{configurable:!0},lineOffsetX:{configurable:!0},lineOffsetY:{configurable:!0},writingMode:{configurable:!0},placedOrientation:{configurable:!0},hidden:{configurable:!0},crossTileID:{configurable:!0},associatedIconIndex:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.glyphStartIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.numGlyphs.get=function(){return this._structArray.uint16[this._pos2+3]},c.vertexStartIndex.get=function(){return this._structArray.uint32[this._pos4+2]},c.lineStartIndex.get=function(){return this._structArray.uint32[this._pos4+3]},c.lineLength.get=function(){return this._structArray.uint32[this._pos4+4]},c.segment.get=function(){return this._structArray.uint16[this._pos2+10]},c.lowerSize.get=function(){return this._structArray.uint16[this._pos2+11]},c.upperSize.get=function(){return this._structArray.uint16[this._pos2+12]},c.lineOffsetX.get=function(){return this._structArray.float32[this._pos4+7]},c.lineOffsetY.get=function(){return this._structArray.float32[this._pos4+8]},c.writingMode.get=function(){return this._structArray.uint8[this._pos1+36]},c.placedOrientation.get=function(){return this._structArray.uint8[this._pos1+37]},c.placedOrientation.set=function(m){this._structArray.uint8[this._pos1+37]=m},c.hidden.get=function(){return this._structArray.uint8[this._pos1+38]},c.hidden.set=function(m){this._structArray.uint8[this._pos1+38]=m},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+10]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+10]=m},c.associatedIconIndex.get=function(){return this._structArray.int16[this._pos2+22]},Object.defineProperties(u.prototype,c),u}(Eu);p.prototype.size=48;var g=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new p(this,c)},u}(Au);xn("PlacedSymbolArray",g);var S=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={anchorX:{configurable:!0},anchorY:{configurable:!0},rightJustifiedTextSymbolIndex:{configurable:!0},centerJustifiedTextSymbolIndex:{configurable:!0},leftJustifiedTextSymbolIndex:{configurable:!0},verticalPlacedTextSymbolIndex:{configurable:!0},placedIconSymbolIndex:{configurable:!0},verticalPlacedIconSymbolIndex:{configurable:!0},key:{configurable:!0},textBoxStartIndex:{configurable:!0},textBoxEndIndex:{configurable:!0},verticalTextBoxStartIndex:{configurable:!0},verticalTextBoxEndIndex:{configurable:!0},iconBoxStartIndex:{configurable:!0},iconBoxEndIndex:{configurable:!0},verticalIconBoxStartIndex:{configurable:!0},verticalIconBoxEndIndex:{configurable:!0},featureIndex:{configurable:!0},numHorizontalGlyphVertices:{configurable:!0},numVerticalGlyphVertices:{configurable:!0},numIconVertices:{configurable:!0},numVerticalIconVertices:{configurable:!0},useRuntimeCollisionCircles:{configurable:!0},crossTileID:{configurable:!0},textBoxScale:{configurable:!0},textOffset0:{configurable:!0},textOffset1:{configurable:!0},collisionCircleDiameter:{configurable:!0}};return c.anchorX.get=function(){return this._structArray.int16[this._pos2+0]},c.anchorY.get=function(){return this._structArray.int16[this._pos2+1]},c.rightJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+2]},c.centerJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+3]},c.leftJustifiedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+4]},c.verticalPlacedTextSymbolIndex.get=function(){return this._structArray.int16[this._pos2+5]},c.placedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+6]},c.verticalPlacedIconSymbolIndex.get=function(){return this._structArray.int16[this._pos2+7]},c.key.get=function(){return this._structArray.uint16[this._pos2+8]},c.textBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+9]},c.textBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+10]},c.verticalTextBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+11]},c.verticalTextBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+12]},c.iconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+13]},c.iconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+14]},c.verticalIconBoxStartIndex.get=function(){return this._structArray.uint16[this._pos2+15]},c.verticalIconBoxEndIndex.get=function(){return this._structArray.uint16[this._pos2+16]},c.featureIndex.get=function(){return this._structArray.uint16[this._pos2+17]},c.numHorizontalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+18]},c.numVerticalGlyphVertices.get=function(){return this._structArray.uint16[this._pos2+19]},c.numIconVertices.get=function(){return this._structArray.uint16[this._pos2+20]},c.numVerticalIconVertices.get=function(){return this._structArray.uint16[this._pos2+21]},c.useRuntimeCollisionCircles.get=function(){return this._structArray.uint16[this._pos2+22]},c.crossTileID.get=function(){return this._structArray.uint32[this._pos4+12]},c.crossTileID.set=function(m){this._structArray.uint32[this._pos4+12]=m},c.textBoxScale.get=function(){return this._structArray.float32[this._pos4+13]},c.textOffset0.get=function(){return this._structArray.float32[this._pos4+14]},c.textOffset1.get=function(){return this._structArray.float32[this._pos4+15]},c.collisionCircleDiameter.get=function(){return this._structArray.float32[this._pos4+16]},Object.defineProperties(u.prototype,c),u}(Eu);S.prototype.size=68;var w=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new S(this,c)},u}(uf);xn("SymbolInstanceArray",w);var C=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getoffsetX=function(c){return this.float32[1*c+0]},u}(kl);xn("GlyphOffsetArray",C);var O=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.getx=function(c){return this.int16[3*c+0]},u.prototype.gety=function(c){return this.int16[3*c+1]},u.prototype.gettileUnitDistanceFromAnchor=function(c){return this.int16[3*c+2]},u}(uu);xn("SymbolLineVertexArray",O);var X=function(o){function u(){o.apply(this,arguments)}o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u;var c={featureIndex:{configurable:!0},sourceLayerIndex:{configurable:!0},bucketIndex:{configurable:!0}};return c.featureIndex.get=function(){return this._structArray.uint32[this._pos4+0]},c.sourceLayerIndex.get=function(){return this._structArray.uint16[this._pos2+2]},c.bucketIndex.get=function(){return this._structArray.uint16[this._pos2+3]},Object.defineProperties(u.prototype,c),u}(Eu);X.prototype.size=8;var J=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.get=function(c){return new X(this,c)},u}(Th);xn("FeatureIndexArray",J);var me=mo([{name:"a_pos",components:2,type:"Int16"}],4).members,ye=function(o){o===void 0&&(o=[]),this.segments=o};function Ae(o,u){return 256*(o=vt(Math.floor(o),0,255))+vt(Math.floor(u),0,255)}ye.prototype.prepareSegment=function(o,u,c,m){var x=this.segments[this.segments.length-1];return o>ye.MAX_VERTEX_ARRAY_LENGTH&&Qe("Max vertices per segment is "+ye.MAX_VERTEX_ARRAY_LENGTH+": bucket requested "+o),(!x||x.vertexLength+o>ye.MAX_VERTEX_ARRAY_LENGTH||x.sortKey!==m)&&(x={vertexOffset:u.length,primitiveOffset:c.length,vertexLength:0,primitiveLength:0},m!==void 0&&(x.sortKey=m),this.segments.push(x)),x},ye.prototype.get=function(){return this.segments},ye.prototype.destroy=function(){for(var o=0,u=this.segments;o<u.length;o+=1){var c=u[o];for(var m in c.vaos)c.vaos[m].destroy()}},ye.simpleSegment=function(o,u,c,m){return new ye([{vertexOffset:o,primitiveOffset:u,vertexLength:c,primitiveLength:m,vaos:{},sortKey:0}])},ye.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,xn("SegmentVector",ye);var Ve=mo([{name:"a_pattern_from",components:4,type:"Uint16"},{name:"a_pattern_to",components:4,type:"Uint16"},{name:"a_pixel_ratio_from",components:1,type:"Uint16"},{name:"a_pixel_ratio_to",components:1,type:"Uint16"}]),Ue=fe(function(o){o.exports=function(u,c){var m,x,E,A,R,L,V,Y;for(x=u.length-(m=3&u.length),E=c,R=3432918353,L=461845907,Y=0;Y<x;)V=255&u.charCodeAt(Y)|(255&u.charCodeAt(++Y))<<8|(255&u.charCodeAt(++Y))<<16|(255&u.charCodeAt(++Y))<<24,++Y,E=27492+(65535&(A=5*(65535&(E=(E^=V=(65535&(V=(V=(65535&V)*R+(((V>>>16)*R&65535)<<16)&4294967295)<<15|V>>>17))*L+(((V>>>16)*L&65535)<<16)&4294967295)<<13|E>>>19))+((5*(E>>>16)&65535)<<16)&4294967295))+((58964+(A>>>16)&65535)<<16);switch(V=0,m){case 3:V^=(255&u.charCodeAt(Y+2))<<16;case 2:V^=(255&u.charCodeAt(Y+1))<<8;case 1:E^=V=(65535&(V=(V=(65535&(V^=255&u.charCodeAt(Y)))*R+(((V>>>16)*R&65535)<<16)&4294967295)<<15|V>>>17))*L+(((V>>>16)*L&65535)<<16)&4294967295}return E^=u.length,E=2246822507*(65535&(E^=E>>>16))+((2246822507*(E>>>16)&65535)<<16)&4294967295,E=3266489909*(65535&(E^=E>>>13))+((3266489909*(E>>>16)&65535)<<16)&4294967295,(E^=E>>>16)>>>0}}),lt=fe(function(o){o.exports=function(u,c){for(var m,x=u.length,E=c^x,A=0;x>=4;)m=1540483477*(65535&(m=255&u.charCodeAt(A)|(255&u.charCodeAt(++A))<<8|(255&u.charCodeAt(++A))<<16|(255&u.charCodeAt(++A))<<24))+((1540483477*(m>>>16)&65535)<<16),E=1540483477*(65535&E)+((1540483477*(E>>>16)&65535)<<16)^(m=1540483477*(65535&(m^=m>>>24))+((1540483477*(m>>>16)&65535)<<16)),x-=4,++A;switch(x){case 3:E^=(255&u.charCodeAt(A+2))<<16;case 2:E^=(255&u.charCodeAt(A+1))<<8;case 1:E=1540483477*(65535&(E^=255&u.charCodeAt(A)))+((1540483477*(E>>>16)&65535)<<16)}return E=1540483477*(65535&(E^=E>>>13))+((1540483477*(E>>>16)&65535)<<16),(E^=E>>>15)>>>0}}),Be=Ue,st=lt;Be.murmur3=Ue,Be.murmur2=st;var xt=function(){this.ids=[],this.positions=[],this.indexed=!1};xt.prototype.add=function(o,u,c,m){this.ids.push(ar(o)),this.positions.push(u,c,m)},xt.prototype.getPositions=function(o){for(var u=ar(o),c=0,m=this.ids.length-1;c<m;){var x=c+m>>1;this.ids[x]>=u?m=x:c=x+1}for(var E=[];this.ids[c]===u;)E.push({index:this.positions[3*c],start:this.positions[3*c+1],end:this.positions[3*c+2]}),c++;return E},xt.serialize=function(o,u){var c=new Float64Array(o.ids),m=new Uint32Array(o.positions);return function x(E,A,R,L){for(;R<L;){for(var V=E[R+L>>1],Y=R-1,K=L+1;;){do Y++;while(E[Y]<V);do K--;while(E[K]>V);if(Y>=K)break;qt(E,Y,K),qt(A,3*Y,3*K),qt(A,3*Y+1,3*K+1),qt(A,3*Y+2,3*K+2)}K-R<L-K?(x(E,A,R,K),R=K+1):(x(E,A,K+1,L),L=K)}}(c,m,0,c.length-1),u&&u.push(c.buffer,m.buffer),{ids:c,positions:m}},xt.deserialize=function(o){var u=new xt;return u.ids=o.ids,u.positions=o.positions,u.indexed=!0,u};var Ut=Math.pow(2,53)-1;function ar(o){var u=+o;return!isNaN(u)&&u<=Ut?u:Be(String(o))}function qt(o,u,c){var m=o[u];o[u]=o[c],o[c]=m}xn("FeaturePositionMap",xt);var fr=function(o,u){this.gl=o.gl,this.location=u},br=function(o){function u(c,m){o.call(this,c,m),this.current=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1i(this.location,c))},u}(fr),jr=function(o){function u(c,m){o.call(this,c,m),this.current=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){this.current!==c&&(this.current=c,this.gl.uniform1f(this.location,c))},u}(fr),Fr=function(o){function u(c,m){o.call(this,c,m),this.current=[0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]||(this.current=c,this.gl.uniform2f(this.location,c[0],c[1]))},u}(fr),hn=function(o){function u(c,m){o.call(this,c,m),this.current=[0,0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]||(this.current=c,this.gl.uniform3f(this.location,c[0],c[1],c[2]))},u}(fr),Un=function(o){function u(c,m){o.call(this,c,m),this.current=[0,0,0,0]}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c[0]===this.current[0]&&c[1]===this.current[1]&&c[2]===this.current[2]&&c[3]===this.current[3]||(this.current=c,this.gl.uniform4f(this.location,c[0],c[1],c[2],c[3]))},u}(fr),Ln=function(o){function u(c,m){o.call(this,c,m),this.current=Ai.transparent}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){c.r===this.current.r&&c.g===this.current.g&&c.b===this.current.b&&c.a===this.current.a||(this.current=c,this.gl.uniform4f(this.location,c.r,c.g,c.b,c.a))},u}(fr),zn=new Float32Array(16),Ui=function(o){function u(c,m){o.call(this,c,m),this.current=zn}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.set=function(c){if(c[12]!==this.current[12]||c[0]!==this.current[0])return this.current=c,void this.gl.uniformMatrix4fv(this.location,!1,c);for(var m=1;m<16;m++)if(c[m]!==this.current[m]){this.current=c,this.gl.uniformMatrix4fv(this.location,!1,c);break}},u}(fr);function gn(o){return[Ae(255*o.r,255*o.g),Ae(255*o.b,255*o.a)]}var ii=function(o,u,c){this.value=o,this.uniformNames=u.map(function(m){return"u_"+m}),this.type=c};ii.prototype.setUniform=function(o,u,c){o.set(c.constantOr(this.value))},ii.prototype.getBinding=function(o,u,c){return this.type==="color"?new Ln(o,u):new jr(o,u)};var pi=function(o,u){this.uniformNames=u.map(function(c){return"u_"+c}),this.patternFrom=null,this.patternTo=null,this.pixelRatioFrom=1,this.pixelRatioTo=1};pi.prototype.setConstantPatternPositions=function(o,u){this.pixelRatioFrom=u.pixelRatio,this.pixelRatioTo=o.pixelRatio,this.patternFrom=u.tlbr,this.patternTo=o.tlbr},pi.prototype.setUniform=function(o,u,c,m){var x=m==="u_pattern_to"?this.patternTo:m==="u_pattern_from"?this.patternFrom:m==="u_pixel_ratio_to"?this.pixelRatioTo:m==="u_pixel_ratio_from"?this.pixelRatioFrom:null;x&&o.set(x)},pi.prototype.getBinding=function(o,u,c){return c.substr(0,9)==="u_pattern"?new Un(o,u):new jr(o,u)};var ri=function(o,u,c,m){this.expression=o,this.type=c,this.maxValue=0,this.paintVertexAttributes=u.map(function(x){return{name:"a_"+x,type:"Float32",components:c==="color"?2:1,offset:0}}),this.paintVertexArray=new m};ri.prototype.populatePaintArray=function(o,u,c,m,x){var E=this.paintVertexArray.length,A=this.expression.evaluate(new Re(0),u,{},m,[],x);this.paintVertexArray.resize(o),this._setPaintValue(E,o,A)},ri.prototype.updatePaintArray=function(o,u,c,m){var x=this.expression.evaluate({zoom:0},c,m);this._setPaintValue(o,u,x)},ri.prototype._setPaintValue=function(o,u,c){if(this.type==="color")for(var m=gn(c),x=o;x<u;x++)this.paintVertexArray.emplace(x,m[0],m[1]);else{for(var E=o;E<u;E++)this.paintVertexArray.emplace(E,c);this.maxValue=Math.max(this.maxValue,Math.abs(c))}},ri.prototype.upload=function(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},ri.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()};var Qn=function(o,u,c,m,x,E){this.expression=o,this.uniformNames=u.map(function(A){return"u_"+A+"_t"}),this.type=c,this.useIntegerZoom=m,this.zoom=x,this.maxValue=0,this.paintVertexAttributes=u.map(function(A){return{name:"a_"+A,type:"Float32",components:c==="color"?4:2,offset:0}}),this.paintVertexArray=new E};Qn.prototype.populatePaintArray=function(o,u,c,m,x){var E=this.expression.evaluate(new Re(this.zoom),u,{},m,[],x),A=this.expression.evaluate(new Re(this.zoom+1),u,{},m,[],x),R=this.paintVertexArray.length;this.paintVertexArray.resize(o),this._setPaintValue(R,o,E,A)},Qn.prototype.updatePaintArray=function(o,u,c,m){var x=this.expression.evaluate({zoom:this.zoom},c,m),E=this.expression.evaluate({zoom:this.zoom+1},c,m);this._setPaintValue(o,u,x,E)},Qn.prototype._setPaintValue=function(o,u,c,m){if(this.type==="color")for(var x=gn(c),E=gn(m),A=o;A<u;A++)this.paintVertexArray.emplace(A,x[0],x[1],E[0],E[1]);else{for(var R=o;R<u;R++)this.paintVertexArray.emplace(R,c,m);this.maxValue=Math.max(this.maxValue,Math.abs(c),Math.abs(m))}},Qn.prototype.upload=function(o){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=o.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent))},Qn.prototype.destroy=function(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()},Qn.prototype.setUniform=function(o,u){var c=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,m=vt(this.expression.interpolationFactor(c,this.zoom,this.zoom+1),0,1);o.set(m)},Qn.prototype.getBinding=function(o,u,c){return new jr(o,u)};var fi=function(o,u,c,m,x,E){this.expression=o,this.type=u,this.useIntegerZoom=c,this.zoom=m,this.layerId=E,this.zoomInPaintVertexArray=new x,this.zoomOutPaintVertexArray=new x};fi.prototype.populatePaintArray=function(o,u,c){var m=this.zoomInPaintVertexArray.length;this.zoomInPaintVertexArray.resize(o),this.zoomOutPaintVertexArray.resize(o),this._setPaintValues(m,o,u.patterns&&u.patterns[this.layerId],c)},fi.prototype.updatePaintArray=function(o,u,c,m,x){this._setPaintValues(o,u,c.patterns&&c.patterns[this.layerId],x)},fi.prototype._setPaintValues=function(o,u,c,m){if(m&&c){var x=m[c.min],E=m[c.mid],A=m[c.max];if(x&&E&&A)for(var R=o;R<u;R++)this.zoomInPaintVertexArray.emplace(R,E.tl[0],E.tl[1],E.br[0],E.br[1],x.tl[0],x.tl[1],x.br[0],x.br[1],E.pixelRatio,x.pixelRatio),this.zoomOutPaintVertexArray.emplace(R,E.tl[0],E.tl[1],E.br[0],E.br[1],A.tl[0],A.tl[1],A.br[0],A.br[1],E.pixelRatio,A.pixelRatio)}},fi.prototype.upload=function(o){this.zoomInPaintVertexArray&&this.zoomInPaintVertexArray.arrayBuffer&&this.zoomOutPaintVertexArray&&this.zoomOutPaintVertexArray.arrayBuffer&&(this.zoomInPaintVertexBuffer=o.createVertexBuffer(this.zoomInPaintVertexArray,Ve.members,this.expression.isStateDependent),this.zoomOutPaintVertexBuffer=o.createVertexBuffer(this.zoomOutPaintVertexArray,Ve.members,this.expression.isStateDependent))},fi.prototype.destroy=function(){this.zoomOutPaintVertexBuffer&&this.zoomOutPaintVertexBuffer.destroy(),this.zoomInPaintVertexBuffer&&this.zoomInPaintVertexBuffer.destroy()};var Jn=function(o,u,c){this.binders={},this._buffers=[];var m=[];for(var x in o.paint._values)if(c(x)){var E=o.paint.get(x);if(E instanceof Ro&&Rl(E.property.specification)){var A=Mo(x,o.type),R=E.value,L=E.property.specification.type,V=E.property.useIntegerZoom,Y=E.property.specification["property-type"],K=Y==="cross-faded"||Y==="cross-faded-data-driven";if(R.kind==="constant")this.binders[x]=K?new pi(R.value,A):new ii(R.value,A,L),m.push("/u_"+x);else if(R.kind==="source"||K){var le=Ka(x,L,"source");this.binders[x]=K?new fi(R,L,V,u,le,o.id):new ri(R,A,L,le),m.push("/a_"+x)}else{var de=Ka(x,L,"composite");this.binders[x]=new Qn(R,A,L,V,u,de),m.push("/z_"+x)}}}this.cacheKey=m.sort().join("")};Jn.prototype.getMaxValue=function(o){var u=this.binders[o];return u instanceof ri||u instanceof Qn?u.maxValue:0},Jn.prototype.populatePaintArrays=function(o,u,c,m,x){for(var E in this.binders){var A=this.binders[E];(A instanceof ri||A instanceof Qn||A instanceof fi)&&A.populatePaintArray(o,u,c,m,x)}},Jn.prototype.setConstantPatternPositions=function(o,u){for(var c in this.binders){var m=this.binders[c];m instanceof pi&&m.setConstantPatternPositions(o,u)}},Jn.prototype.updatePaintArrays=function(o,u,c,m,x){var E=!1;for(var A in o)for(var R=0,L=u.getPositions(A);R<L.length;R+=1){var V=L[R],Y=c.feature(V.index);for(var K in this.binders){var le=this.binders[K];if((le instanceof ri||le instanceof Qn||le instanceof fi)&&le.expression.isStateDependent===!0){var de=m.paint.get(K);le.expression=de.value,le.updatePaintArray(V.start,V.end,Y,o[A],x),E=!0}}}return E},Jn.prototype.defines=function(){var o=[];for(var u in this.binders){var c=this.binders[u];(c instanceof ii||c instanceof pi)&&o.push.apply(o,c.uniformNames.map(function(m){return"#define HAS_UNIFORM_"+m}))}return o},Jn.prototype.getBinderAttributes=function(){var o=[];for(var u in this.binders){var c=this.binders[u];if(c instanceof ri||c instanceof Qn)for(var m=0;m<c.paintVertexAttributes.length;m++)o.push(c.paintVertexAttributes[m].name);else if(c instanceof fi)for(var x=0;x<Ve.members.length;x++)o.push(Ve.members[x].name)}return o},Jn.prototype.getBinderUniforms=function(){var o=[];for(var u in this.binders){var c=this.binders[u];if(c instanceof ii||c instanceof pi||c instanceof Qn)for(var m=0,x=c.uniformNames;m<x.length;m+=1)o.push(x[m])}return o},Jn.prototype.getPaintVertexBuffers=function(){return this._buffers},Jn.prototype.getUniforms=function(o,u){var c=[];for(var m in this.binders){var x=this.binders[m];if(x instanceof ii||x instanceof pi||x instanceof Qn)for(var E=0,A=x.uniformNames;E<A.length;E+=1){var R=A[E];if(u[R]){var L=x.getBinding(o,u[R],R);c.push({name:R,property:m,binding:L})}}}return c},Jn.prototype.setUniforms=function(o,u,c,m){for(var x=0,E=u;x<E.length;x+=1){var A=E[x],R=A.name,L=A.property;this.binders[L].setUniform(A.binding,m,c.get(L),R)}},Jn.prototype.updatePaintBuffers=function(o){for(var u in this._buffers=[],this.binders){var c=this.binders[u];if(o&&c instanceof fi){var m=o.fromScale===2?c.zoomInPaintVertexBuffer:c.zoomOutPaintVertexBuffer;m&&this._buffers.push(m)}else(c instanceof ri||c instanceof Qn)&&c.paintVertexBuffer&&this._buffers.push(c.paintVertexBuffer)}},Jn.prototype.upload=function(o){for(var u in this.binders){var c=this.binders[u];(c instanceof ri||c instanceof Qn||c instanceof fi)&&c.upload(o)}this.updatePaintBuffers()},Jn.prototype.destroy=function(){for(var o in this.binders){var u=this.binders[o];(u instanceof ri||u instanceof Qn||u instanceof fi)&&u.destroy()}};var Xn=function(o,u,c){c===void 0&&(c=function(){return!0}),this.programConfigurations={};for(var m=0,x=o;m<x.length;m+=1){var E=x[m];this.programConfigurations[E.id]=new Jn(E,u,c)}this.needsUpload=!1,this._featureMap=new xt,this._bufferOffset=0};function Mo(o,u){return{"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"line-gap-width":["gapwidth"],"line-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"],"fill-extrusion-pattern":["pattern_to","pattern_from","pixel_ratio_to","pixel_ratio_from"]}[o]||[o.replace(u+"-","").replace(/-/g,"_")]}function Ka(o,u,c){var m={color:{source:ec,composite:wh},number:{source:kl,composite:ec}},x=function(E){return{"line-pattern":{source:Su,composite:Su},"fill-pattern":{source:Su,composite:Su},"fill-extrusion-pattern":{source:Su,composite:Su}}[E]}(o);return x&&x[c]||m[u][c]}Xn.prototype.populatePaintArrays=function(o,u,c,m,x,E){for(var A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(o,u,m,x,E);u.id!==void 0&&this._featureMap.add(u.id,c,this._bufferOffset,o),this._bufferOffset=o,this.needsUpload=!0},Xn.prototype.updatePaintArrays=function(o,u,c,m){for(var x=0,E=c;x<E.length;x+=1){var A=E[x];this.needsUpload=this.programConfigurations[A.id].updatePaintArrays(o,this._featureMap,u,A,m)||this.needsUpload}},Xn.prototype.get=function(o){return this.programConfigurations[o]},Xn.prototype.upload=function(o){if(this.needsUpload){for(var u in this.programConfigurations)this.programConfigurations[u].upload(o);this.needsUpload=!1}},Xn.prototype.destroy=function(){for(var o in this.programConfigurations)this.programConfigurations[o].destroy()},xn("ConstantBinder",ii),xn("CrossFadedConstantBinder",pi),xn("SourceExpressionBinder",ri),xn("CrossFadedCompositeBinder",fi),xn("CompositeExpressionBinder",Qn),xn("ProgramConfiguration",Jn,{omit:["_buffers"]}),xn("ProgramConfigurationSet",Xn);var Io=Math.pow(2,14)-1,go=-Io-1;function Ha(o){for(var u=8192/o.extent,c=o.loadGeometry(),m=0;m<c.length;m++)for(var x=c[m],E=0;E<x.length;E++){var A=x[E],R=Math.round(A.x*u),L=Math.round(A.y*u);A.x=vt(R,go,Io),A.y=vt(L,go,Io),(R<A.x||R>A.x+1||L<A.y||L>A.y+1)&&Qe("Geometry exceeds allowed extent, reduce your vector tile buffer size")}return c}function Qa(o,u){return{type:o.type,id:o.id,properties:o.properties,geometry:u?Ha(o):[]}}function xs(o,u,c,m,x){o.emplaceBack(2*u+(m+1)/2,2*c+(x+1)/2)}var bs=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new Ol,this.indexArray=new ss,this.segments=new ye,this.programConfigurations=new Xn(o.layers,o.zoom),this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function fl(o,u){for(var c=0;c<o.length;c++)if(cu(u,o[c]))return!0;for(var m=0;m<u.length;m++)if(cu(o,u[m]))return!0;return!!Mc(o,u)}function Es(o,u,c){return!!cu(o,u)||!!Tu(u,o,c)}function lu(o,u){if(o.length===1)return hl(u,o[0]);for(var c=0;c<u.length;c++)for(var m=u[c],x=0;x<m.length;x++)if(cu(o,m[x]))return!0;for(var E=0;E<o.length;E++)if(hl(u,o[E]))return!0;for(var A=0;A<u.length;A++)if(Mc(o,u[A]))return!0;return!1}function Zs(o,u,c){if(o.length>1){if(Mc(o,u))return!0;for(var m=0;m<u.length;m++)if(Tu(u[m],o,c))return!0}for(var x=0;x<o.length;x++)if(Tu(o[x],u,c))return!0;return!1}function Mc(o,u){if(o.length===0||u.length===0)return!1;for(var c=0;c<o.length-1;c++)for(var m=o[c],x=o[c+1],E=0;E<u.length-1;E++)if(Hu(m,x,u[E],u[E+1]))return!0;return!1}function Hu(o,u,c,m){return Nt(o,c,m)!==Nt(u,c,m)&&Nt(o,u,c)!==Nt(o,u,m)}function Tu(o,u,c){var m=c*c;if(u.length===1)return o.distSqr(u[0])<m;for(var x=1;x<u.length;x++)if(nc(o,u[x-1],u[x])<m)return!0;return!1}function nc(o,u,c){var m=u.distSqr(c);if(m===0)return o.distSqr(u);var x=((o.x-u.x)*(c.x-u.x)+(o.y-u.y)*(c.y-u.y))/m;return o.distSqr(x<0?u:x>1?c:c.sub(u)._mult(x)._add(u))}function hl(o,u){for(var c,m,x,E=!1,A=0;A<o.length;A++)for(var R=0,L=(c=o[A]).length-1;R<c.length;L=R++)(m=c[R]).y>u.y!=(x=c[L]).y>u.y&&u.x<(x.x-m.x)*(u.y-m.y)/(x.y-m.y)+m.x&&(E=!E);return E}function cu(o,u){for(var c=!1,m=0,x=o.length-1;m<o.length;x=m++){var E=o[m],A=o[x];E.y>u.y!=A.y>u.y&&u.x<(A.x-E.x)*(u.y-E.y)/(A.y-E.y)+E.x&&(c=!c)}return c}function pl(o,u,c){var m=c[0],x=c[2];if(o.x<m.x&&u.x<m.x||o.x>x.x&&u.x>x.x||o.y<m.y&&u.y<m.y||o.y>x.y&&u.y>x.y)return!1;var E=Nt(o,u,c[0]);return E!==Nt(o,u,c[1])||E!==Nt(o,u,c[2])||E!==Nt(o,u,c[3])}function Po(o,u,c){var m=u.paint.get(o).value;return m.kind==="constant"?m.value:c.programConfigurations.get(u.id).getMaxValue(o)}function ao(o){return Math.sqrt(o[0]*o[0]+o[1]*o[1])}function Is(o,u,c,m,x){if(!u[0]&&!u[1])return o;var E=ce.convert(u)._mult(x);c==="viewport"&&E._rotate(-m);for(var A=[],R=0;R<o.length;R++)A.push(o[R].sub(E));return A}bs.prototype.populate=function(o,u,c){var m=this.layers[0],x=[],E=null;m.type==="circle"&&(E=m.layout.get("circle-sort-key"));for(var A=0,R=o;A<R.length;A+=1){var L=R[A],V=L.feature,Y=L.id,K=L.index,le=L.sourceLayerIndex,de=this.layers[0]._featureFilter.needGeometry,Ne=Qa(V,de);if(this.layers[0]._featureFilter.filter(new Re(this.zoom),Ne,c)){var I=E?E.evaluate(Ne,{},c):void 0,ft={id:Y,properties:V.properties,type:V.type,sourceLayerIndex:le,index:K,geometry:de?Ne.geometry:Ha(V),patterns:{},sortKey:I};x.push(ft)}}E&&x.sort(function(qr,Bn){return qr.sortKey-Bn.sortKey});for(var tt=0,Rt=x;tt<Rt.length;tt+=1){var zt=Rt[tt],ir=zt.geometry,or=zt.index,mr=zt.sourceLayerIndex,Zr=o[or].feature;this.addFeature(zt,ir,or,c),u.featureIndex.insert(Zr,ir,or,mr,this.index)}},bs.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},bs.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},bs.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},bs.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,me),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},bs.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},bs.prototype.addFeature=function(o,u,c,m){for(var x=0,E=u;x<E.length;x+=1)for(var A=0,R=E[x];A<R.length;A+=1){var L=R[A],V=L.x,Y=L.y;if(!(V<0||V>=8192||Y<0||Y>=8192)){var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,o.sortKey),le=K.vertexLength;xs(this.layoutVertexArray,V,Y,-1,-1),xs(this.layoutVertexArray,V,Y,1,-1),xs(this.layoutVertexArray,V,Y,1,1),xs(this.layoutVertexArray,V,Y,-1,1),this.indexArray.emplaceBack(le,le+1,le+2),this.indexArray.emplaceBack(le,le+3,le+2),K.vertexLength+=4,K.primitiveLength+=2}}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,{},m)},xn("CircleBucket",bs,{omit:["layers"]});var fu=new Ba({"circle-sort-key":new An(j.layout_circle["circle-sort-key"])}),wu={paint:new Ba({"circle-radius":new An(j.paint_circle["circle-radius"]),"circle-color":new An(j.paint_circle["circle-color"]),"circle-blur":new An(j.paint_circle["circle-blur"]),"circle-opacity":new An(j.paint_circle["circle-opacity"]),"circle-translate":new Dn(j.paint_circle["circle-translate"]),"circle-translate-anchor":new Dn(j.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Dn(j.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Dn(j.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new An(j.paint_circle["circle-stroke-width"]),"circle-stroke-color":new An(j.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new An(j.paint_circle["circle-stroke-opacity"])}),layout:fu},Bi=typeof Float32Array!="undefined"?Float32Array:Array;function Ko(o){return o[0]=1,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=1,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=1,o[11]=0,o[12]=0,o[13]=0,o[14]=0,o[15]=1,o}function oo(o,u,c){var m=u[0],x=u[1],E=u[2],A=u[3],R=u[4],L=u[5],V=u[6],Y=u[7],K=u[8],le=u[9],de=u[10],Ne=u[11],I=u[12],ft=u[13],tt=u[14],Rt=u[15],zt=c[0],ir=c[1],or=c[2],mr=c[3];return o[0]=zt*m+ir*R+or*K+mr*I,o[1]=zt*x+ir*L+or*le+mr*ft,o[2]=zt*E+ir*V+or*de+mr*tt,o[3]=zt*A+ir*Y+or*Ne+mr*Rt,o[4]=(zt=c[4])*m+(ir=c[5])*R+(or=c[6])*K+(mr=c[7])*I,o[5]=zt*x+ir*L+or*le+mr*ft,o[6]=zt*E+ir*V+or*de+mr*tt,o[7]=zt*A+ir*Y+or*Ne+mr*Rt,o[8]=(zt=c[8])*m+(ir=c[9])*R+(or=c[10])*K+(mr=c[11])*I,o[9]=zt*x+ir*L+or*le+mr*ft,o[10]=zt*E+ir*V+or*de+mr*tt,o[11]=zt*A+ir*Y+or*Ne+mr*Rt,o[12]=(zt=c[12])*m+(ir=c[13])*R+(or=c[14])*K+(mr=c[15])*I,o[13]=zt*x+ir*L+or*le+mr*ft,o[14]=zt*E+ir*V+or*de+mr*tt,o[15]=zt*A+ir*Y+or*Ne+mr*Rt,o}Math.hypot||(Math.hypot=function(){for(var o=arguments,u=0,c=arguments.length;c--;)u+=o[c]*o[c];return Math.sqrt(u)});var hu,Ic=oo;function Wu(o,u,c){var m=u[0],x=u[1],E=u[2],A=u[3];return o[0]=c[0]*m+c[4]*x+c[8]*E+c[12]*A,o[1]=c[1]*m+c[5]*x+c[9]*E+c[13]*A,o[2]=c[2]*m+c[6]*x+c[10]*E+c[14]*A,o[3]=c[3]*m+c[7]*x+c[11]*E+c[15]*A,o}hu=new Bi(3),Bi!=Float32Array&&(hu[0]=0,hu[1]=0,hu[2]=0),function(){var o=new Bi(4);Bi!=Float32Array&&(o[0]=0,o[1]=0,o[2]=0,o[3]=0)}();var Ch=(function(){var o=new Bi(2);Bi!=Float32Array&&(o[0]=0,o[1]=0)}(),function(o){function u(c){o.call(this,c,wu)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(c){return new bs(c)},u.prototype.queryRadius=function(c){var m=c;return Po("circle-radius",this,m)+Po("circle-stroke-width",this,m)+ao(this.paint.get("circle-translate"))},u.prototype.queryIntersectsFeature=function(c,m,x,E,A,R,L,V){for(var Y=Is(c,this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),R.angle,L),K=this.paint.get("circle-radius").evaluate(m,x)+this.paint.get("circle-stroke-width").evaluate(m,x),le=this.paint.get("circle-pitch-alignment")==="map",de=le?Y:function(Zr,qr){return Zr.map(function(Bn){return Oo(Bn,qr)})}(Y,V),Ne=le?K*L:K,I=0,ft=E;I<ft.length;I+=1)for(var tt=0,Rt=ft[I];tt<Rt.length;tt+=1){var zt=Rt[tt],ir=le?zt:Oo(zt,V),or=Ne,mr=Wu([],[zt.x,zt.y,0,1],V);if(this.paint.get("circle-pitch-scale")==="viewport"&&this.paint.get("circle-pitch-alignment")==="map"?or*=mr[3]/R.cameraToCenterDistance:this.paint.get("circle-pitch-scale")==="map"&&this.paint.get("circle-pitch-alignment")==="viewport"&&(or*=R.cameraToCenterDistance/mr[3]),Es(de,ir,or))return!0}return!1},u}(tu));function Oo(o,u){var c=Wu([],[o.x,o.y,0,1],u);return new ce(c[0]/c[3],c[1]/c[3])}var kr=function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(bs);function Vs(o,u,c,m){var x=u.width,E=u.height;if(m){if(m instanceof Uint8ClampedArray)m=new Uint8Array(m.buffer);else if(m.length!==x*E*c)throw new RangeError("mismatched image size")}else m=new Uint8Array(x*E*c);return o.width=x,o.height=E,o.data=m,o}function Rh(o,u,c){var m=u.width,x=u.height;if(m!==o.width||x!==o.height){var E=Vs({},{width:m,height:x},c);ko(o,E,{x:0,y:0},{x:0,y:0},{width:Math.min(o.width,m),height:Math.min(o.height,x)},c),o.width=m,o.height=x,o.data=E.data}}function ko(o,u,c,m,x,E){if(x.width===0||x.height===0)return u;if(x.width>o.width||x.height>o.height||c.x>o.width-x.width||c.y>o.height-x.height)throw new RangeError("out of range source coordinates for image copy");if(x.width>u.width||x.height>u.height||m.x>u.width-x.width||m.y>u.height-x.height)throw new RangeError("out of range destination coordinates for image copy");for(var A=o.data,R=u.data,L=0;L<x.height;L++)for(var V=((c.y+L)*o.width+c.x)*E,Y=((m.y+L)*u.width+m.x)*E,K=0;K<x.width*E;K++)R[Y+K]=A[V+K];return u}xn("HeatmapBucket",kr,{omit:["layers"]});var ru=function(o,u){Vs(this,o,1,u)};ru.prototype.resize=function(o){Rh(this,o,1)},ru.prototype.clone=function(){return new ru({width:this.width,height:this.height},new Uint8Array(this.data))},ru.copy=function(o,u,c,m,x){ko(o,u,c,m,x,1)};var Do=function(o,u){Vs(this,o,4,u)};Do.prototype.resize=function(o){Rh(this,o,4)},Do.prototype.replace=function(o,u){u?this.data.set(o):this.data=o instanceof Uint8ClampedArray?new Uint8Array(o.buffer):o},Do.prototype.clone=function(){return new Do({width:this.width,height:this.height},new Uint8Array(this.data))},Do.copy=function(o,u,c,m,x){ko(o,u,c,m,x,4)},xn("AlphaImage",ru),xn("RGBAImage",Do);var pp={paint:new Ba({"heatmap-radius":new An(j.paint_heatmap["heatmap-radius"]),"heatmap-weight":new An(j.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Dn(j.paint_heatmap["heatmap-intensity"]),"heatmap-color":new xu(j.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Dn(j.paint_heatmap["heatmap-opacity"])})};function ic(o){var u={},c=o.resolution||256,m=o.clips?o.clips.length:1,x=o.image||new Do({width:c,height:m}),E=function(Ne,I,ft){u[o.evaluationKey]=ft;var tt=o.expression.evaluate(u);x.data[Ne+I+0]=Math.floor(255*tt.r/tt.a),x.data[Ne+I+1]=Math.floor(255*tt.g/tt.a),x.data[Ne+I+2]=Math.floor(255*tt.b/tt.a),x.data[Ne+I+3]=Math.floor(255*tt.a)};if(o.clips)for(var A=0,R=0;A<m;++A,R+=4*c)for(var L=0,V=0;L<c;L++,V+=4){var Y=L/(c-1),K=o.clips[A];E(R,V,K.start*(1-Y)+K.end*Y)}else for(var le=0,de=0;le<c;le++,de+=4)E(0,de,le/(c-1));return x}var dl=function(o){function u(c){o.call(this,c,pp),this._updateColorRamp()}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(c){return new kr(c)},u.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="heatmap-color"&&this._updateColorRamp()},u.prototype._updateColorRamp=function(){this.colorRamp=ic({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null},u.prototype.resize=function(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype.hasOffscreenPass=function(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"},u}(tu),Zp={paint:new Ba({"hillshade-illumination-direction":new Dn(j.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Dn(j.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Dn(j.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Dn(j.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Dn(j.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Dn(j.paint_hillshade["hillshade-accent-color"])})},ag=function(o){function u(c){o.call(this,c,Zp)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.hasOffscreenPass=function(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"},u}(tu),zv=mo([{name:"a_pos",components:2,type:"Int16"}],4).members,Hf=Mh,dp=Mh;function Mh(o,u,c){c=c||2;var m,x,E,A,R,L,V,Y=u&&u.length,K=Y?u[0]*c:o.length,le=Dd(o,0,K,c,!0),de=[];if(!le||le.next===le.prev)return de;if(Y&&(le=function(I,ft,tt,Rt){var zt,ir,or,mr=[];for(zt=0,ir=ft.length;zt<ir;zt++)(or=Dd(I,ft[zt]*Rt,zt<ir-1?ft[zt+1]*Rt:I.length,Rt,!1))===or.next&&(or.steiner=!0),mr.push(vp(or));for(mr.sort(Bd),zt=0;zt<mr.length;zt++)Fd(mr[zt],tt),tt=Pc(tt,tt.next);return tt}(o,u,le,c)),o.length>80*c){m=E=o[0],x=A=o[1];for(var Ne=c;Ne<K;Ne+=c)(R=o[Ne])<m&&(m=R),(L=o[Ne+1])<x&&(x=L),R>E&&(E=R),L>A&&(A=L);V=(V=Math.max(E-m,A-x))!==0?1/V:0}return Ih(le,de,c,m,x,V),de}function Dd(o,u,c,m,x){var E,A;if(x===ac(o,u,c,m)>0)for(E=u;E<c;E+=m)A=$f(E,o[E],o[E+1],A);else for(E=c-m;E>=u;E-=m)A=$f(E,o[E],o[E+1],A);return A&&Wf(A,A.next)&&(Dc(A),A=A.next),A}function Pc(o,u){if(!o)return o;u||(u=o);var c,m=o;do if(c=!1,m.steiner||!Wf(m,m.next)&&Ja(m.prev,m,m.next)!==0)m=m.next;else{if(Dc(m),(m=u=m.prev)===m.next)break;c=!0}while(c||m!==u);return u}function Ih(o,u,c,m,x,E,A){if(o){!A&&E&&function(Y,K,le,de){var Ne=Y;do Ne.z===null&&(Ne.z=Dl(Ne.x,Ne.y,K,le,de)),Ne.prevZ=Ne.prev,Ne.nextZ=Ne.next,Ne=Ne.next;while(Ne!==Y);Ne.prevZ.nextZ=null,Ne.prevZ=null,function(I){var ft,tt,Rt,zt,ir,or,mr,Zr,qr=1;do{for(tt=I,I=null,ir=null,or=0;tt;){for(or++,Rt=tt,mr=0,ft=0;ft<qr&&(mr++,Rt=Rt.nextZ);ft++);for(Zr=qr;mr>0||Zr>0&&Rt;)mr!==0&&(Zr===0||!Rt||tt.z<=Rt.z)?(zt=tt,tt=tt.nextZ,mr--):(zt=Rt,Rt=Rt.nextZ,Zr--),ir?ir.nextZ=zt:I=zt,zt.prevZ=ir,ir=zt;tt=Rt}ir.nextZ=null,qr*=2}while(or>1)}(Ne)}(o,m,x,E);for(var R,L,V=o;o.prev!==o.next;)if(R=o.prev,L=o.next,E?Ld(o,m,x,E):Zv(o))u.push(R.i/c),u.push(o.i/c),u.push(L.i/c),Dc(o),o=L.next,V=L.next;else if((o=L)===V){A?A===1?Ih(o=og(Pc(o),u,c),u,c,m,x,E,2):A===2&&Vp(o,u,c,m,x,E):Ih(Pc(o),u,c,m,x,E,1);break}}}function Zv(o){var u=o.prev,c=o,m=o.next;if(Ja(u,c,m)>=0)return!1;for(var x=o.next.next;x!==o.prev;){if(Oc(u.x,u.y,c.x,c.y,m.x,m.y,x.x,x.y)&&Ja(x.prev,x,x.next)>=0)return!1;x=x.next}return!0}function Ld(o,u,c,m){var x=o.prev,E=o,A=o.next;if(Ja(x,E,A)>=0)return!1;for(var R=x.x>E.x?x.x>A.x?x.x:A.x:E.x>A.x?E.x:A.x,L=x.y>E.y?x.y>A.y?x.y:A.y:E.y>A.y?E.y:A.y,V=Dl(x.x<E.x?x.x<A.x?x.x:A.x:E.x<A.x?E.x:A.x,x.y<E.y?x.y<A.y?x.y:A.y:E.y<A.y?E.y:A.y,u,c,m),Y=Dl(R,L,u,c,m),K=o.prevZ,le=o.nextZ;K&&K.z>=V&&le&&le.z<=Y;){if(K!==o.prev&&K!==o.next&&Oc(x.x,x.y,E.x,E.y,A.x,A.y,K.x,K.y)&&Ja(K.prev,K,K.next)>=0||(K=K.prevZ,le!==o.prev&&le!==o.next&&Oc(x.x,x.y,E.x,E.y,A.x,A.y,le.x,le.y)&&Ja(le.prev,le,le.next)>=0))return!1;le=le.nextZ}for(;K&&K.z>=V;){if(K!==o.prev&&K!==o.next&&Oc(x.x,x.y,E.x,E.y,A.x,A.y,K.x,K.y)&&Ja(K.prev,K,K.next)>=0)return!1;K=K.prevZ}for(;le&&le.z<=Y;){if(le!==o.prev&&le!==o.next&&Oc(x.x,x.y,E.x,E.y,A.x,A.y,le.x,le.y)&&Ja(le.prev,le,le.next)>=0)return!1;le=le.nextZ}return!0}function og(o,u,c){var m=o;do{var x=m.prev,E=m.next.next;!Wf(x,E)&&Gf(x,m,m.next,E)&&kc(x,E)&&kc(E,x)&&(u.push(x.i/c),u.push(m.i/c),u.push(E.i/c),Dc(m),Dc(m.next),m=o=E),m=m.next}while(m!==o);return Pc(m)}function Vp(o,u,c,m,x,E){var A=o;do{for(var R=A.next.next;R!==A.prev;){if(A.i!==R.i&&Hp(A,R)){var L=Xf(A,R);return A=Pc(A,A.next),L=Pc(L,L.next),Ih(A,u,c,m,x,E),void Ih(L,u,c,m,x,E)}R=R.next}A=A.next}while(A!==o)}function Bd(o,u){return o.x-u.x}function Fd(o,u){if(u=function(m,x){var E,A=x,R=m.x,L=m.y,V=-1/0;do{if(L<=A.y&&L>=A.next.y&&A.next.y!==A.y){var Y=A.x+(L-A.y)*(A.next.x-A.x)/(A.next.y-A.y);if(Y<=R&&Y>V){if(V=Y,Y===R){if(L===A.y)return A;if(L===A.next.y)return A.next}E=A.x<A.next.x?A:A.next}}A=A.next}while(A!==x);if(!E)return null;if(R===V)return E;var K,le=E,de=E.x,Ne=E.y,I=1/0;A=E;do R>=A.x&&A.x>=de&&R!==A.x&&Oc(L<Ne?R:V,L,de,Ne,L<Ne?V:R,L,A.x,A.y)&&(K=Math.abs(L-A.y)/(R-A.x),kc(A,m)&&(K<I||K===I&&(A.x>E.x||A.x===E.x&&jp(E,A)))&&(E=A,I=K)),A=A.next;while(A!==le);return E}(o,u)){var c=Xf(u,o);Pc(u,u.next),Pc(c,c.next)}}function jp(o,u){return Ja(o.prev,o,u.prev)<0&&Ja(u.next,o,o.next)<0}function Dl(o,u,c,m,x){return(o=1431655765&((o=858993459&((o=252645135&((o=16711935&((o=32767*(o-c)*x)|o<<8))|o<<4))|o<<2))|o<<1))|(u=1431655765&((u=858993459&((u=252645135&((u=16711935&((u=32767*(u-m)*x)|u<<8))|u<<4))|u<<2))|u<<1))<<1}function vp(o){var u=o,c=o;do(u.x<c.x||u.x===c.x&&u.y<c.y)&&(c=u),u=u.next;while(u!==o);return c}function Oc(o,u,c,m,x,E,A,R){return(x-A)*(u-R)-(o-A)*(E-R)>=0&&(o-A)*(m-R)-(c-A)*(u-R)>=0&&(c-A)*(E-R)-(x-A)*(m-R)>=0}function Hp(o,u){return o.next.i!==u.i&&o.prev.i!==u.i&&!function(c,m){var x=c;do{if(x.i!==c.i&&x.next.i!==c.i&&x.i!==m.i&&x.next.i!==m.i&&Gf(x,x.next,c,m))return!0;x=x.next}while(x!==c);return!1}(o,u)&&(kc(o,u)&&kc(u,o)&&function(c,m){var x=c,E=!1,A=(c.x+m.x)/2,R=(c.y+m.y)/2;do x.y>R!=x.next.y>R&&x.next.y!==x.y&&A<(x.next.x-x.x)*(R-x.y)/(x.next.y-x.y)+x.x&&(E=!E),x=x.next;while(x!==c);return E}(o,u)&&(Ja(o.prev,o,u.prev)||Ja(o,u.prev,u))||Wf(o,u)&&Ja(o.prev,o,o.next)>0&&Ja(u.prev,u,u.next)>0)}function Ja(o,u,c){return(u.y-o.y)*(c.x-u.x)-(u.x-o.x)*(c.y-u.y)}function Wf(o,u){return o.x===u.x&&o.y===u.y}function Gf(o,u,c,m){var x=lf(Ja(o,u,c)),E=lf(Ja(o,u,m)),A=lf(Ja(c,m,o)),R=lf(Ja(c,m,u));return x!==E&&A!==R||!(x!==0||!vl(o,c,u))||!(E!==0||!vl(o,m,u))||!(A!==0||!vl(c,o,m))||!(R!==0||!vl(c,u,m))}function vl(o,u,c){return u.x<=Math.max(o.x,c.x)&&u.x>=Math.min(o.x,c.x)&&u.y<=Math.max(o.y,c.y)&&u.y>=Math.min(o.y,c.y)}function lf(o){return o>0?1:o<0?-1:0}function kc(o,u){return Ja(o.prev,o,o.next)<0?Ja(o,u,o.next)>=0&&Ja(o,o.prev,u)>=0:Ja(o,u,o.prev)<0||Ja(o,o.next,u)<0}function Xf(o,u){var c=new Lc(o.i,o.x,o.y),m=new Lc(u.i,u.x,u.y),x=o.next,E=u.prev;return o.next=u,u.prev=o,c.next=x,x.prev=c,m.next=c,c.prev=m,E.next=m,m.prev=E,m}function $f(o,u,c,m){var x=new Lc(o,u,c);return m?(x.next=m.next,x.prev=m,m.next.prev=x,m.next=x):(x.prev=x,x.next=x),x}function Dc(o){o.next.prev=o.prev,o.prev.next=o.next,o.prevZ&&(o.prevZ.nextZ=o.nextZ),o.nextZ&&(o.nextZ.prevZ=o.prevZ)}function Lc(o,u,c){this.i=o,this.x=u,this.y=c,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}function ac(o,u,c,m){for(var x=0,E=u,A=c-m;E<c;E+=m)x+=(o[A]-o[E])*(o[E+1]+o[A+1]),A=E;return x}function Wp(o,u,c,m,x){(function E(A,R,L,V,Y){for(;V>L;){if(V-L>600){var K=V-L+1,le=R-L+1,de=Math.log(K),Ne=.5*Math.exp(2*de/3),I=.5*Math.sqrt(de*Ne*(K-Ne)/K)*(le-K/2<0?-1:1);E(A,R,Math.max(L,Math.floor(R-le*Ne/K+I)),Math.min(V,Math.floor(R+(K-le)*Ne/K+I)),Y)}var ft=A[R],tt=L,Rt=V;for(oc(A,L,R),Y(A[V],ft)>0&&oc(A,L,V);tt<Rt;){for(oc(A,tt,Rt),tt++,Rt--;Y(A[tt],ft)<0;)tt++;for(;Y(A[Rt],ft)>0;)Rt--}Y(A[L],ft)===0?oc(A,L,Rt):oc(A,++Rt,V),Rt<=R&&(L=Rt+1),R<=Rt&&(V=Rt-1)}})(o,u,c||0,m||o.length-1,x||js)}function oc(o,u,c){var m=o[u];o[u]=o[c],o[c]=m}function js(o,u){return o<u?-1:o>u?1:0}function mp(o,u){var c=o.length;if(c<=1)return[o];for(var m,x,E=[],A=0;A<c;A++){var R=sr(o[A]);R!==0&&(o[A].area=Math.abs(R),x===void 0&&(x=R<0),x===R<0?(m&&E.push(m),m=[o[A]]):m.push(o[A]))}if(m&&E.push(m),u>1)for(var L=0;L<E.length;L++)E[L].length<=u||(Wp(E[L],u,1,E[L].length-1,Gp),E[L]=E[L].slice(0,u));return E}function Gp(o,u){return u.area-o.area}function Xp(o,u,c){for(var m=c.patternDependencies,x=!1,E=0,A=u;E<A.length;E+=1){var R=A[E].paint.get(o+"-pattern");R.isConstant()||(x=!0);var L=R.constantOr(null);L&&(x=!0,m[L.to]=!0,m[L.from]=!0)}return x}function Ph(o,u,c,m,x){for(var E=x.patternDependencies,A=0,R=u;A<R.length;A+=1){var L=R[A],V=L.paint.get(o+"-pattern").value;if(V.kind!=="constant"){var Y=V.evaluate({zoom:m-1},c,{},x.availableImages),K=V.evaluate({zoom:m},c,{},x.availableImages),le=V.evaluate({zoom:m+1},c,{},x.availableImages);K=K&&K.name?K.name:K,le=le&&le.name?le.name:le,E[Y=Y&&Y.name?Y.name:Y]=!0,E[K]=!0,E[le]=!0,c.patterns[L.id]={min:Y,mid:K,max:le}}}return c}Mh.deviation=function(o,u,c,m){var x=u&&u.length,E=Math.abs(ac(o,0,x?u[0]*c:o.length,c));if(x)for(var A=0,R=u.length;A<R;A++)E-=Math.abs(ac(o,u[A]*c,A<R-1?u[A+1]*c:o.length,c));var L=0;for(A=0;A<m.length;A+=3){var V=m[A]*c,Y=m[A+1]*c,K=m[A+2]*c;L+=Math.abs((o[V]-o[K])*(o[Y+1]-o[V+1])-(o[V]-o[Y])*(o[K+1]-o[V+1]))}return E===0&&L===0?0:Math.abs((L-E)/E)},Mh.flatten=function(o){for(var u=o[0][0].length,c={vertices:[],holes:[],dimensions:u},m=0,x=0;x<o.length;x++){for(var E=0;E<o[x].length;E++)for(var A=0;A<u;A++)c.vertices.push(o[x][E][A]);x>0&&c.holes.push(m+=o[x-1].length)}return c},Hf.default=dp;var ml=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.layoutVertexArray=new Ol,this.indexArray=new ss,this.indexArray2=new ju,this.programConfigurations=new Xn(o.layers,o.zoom),this.segments=new ye,this.segments2=new ye,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};ml.prototype.populate=function(o,u,c){this.hasPattern=Xp("fill",this.layers,u);for(var m=this.layers[0].layout.get("fill-sort-key"),x=[],E=0,A=o;E<A.length;E+=1){var R=A[E],L=R.feature,V=R.id,Y=R.index,K=R.sourceLayerIndex,le=this.layers[0]._featureFilter.needGeometry,de=Qa(L,le);if(this.layers[0]._featureFilter.filter(new Re(this.zoom),de,c)){var Ne=m?m.evaluate(de,{},c,u.availableImages):void 0,I={id:V,properties:L.properties,type:L.type,sourceLayerIndex:K,index:Y,geometry:le?de.geometry:Ha(L),patterns:{},sortKey:Ne};x.push(I)}}m&&x.sort(function(Zr,qr){return Zr.sortKey-qr.sortKey});for(var ft=0,tt=x;ft<tt.length;ft+=1){var Rt=tt[ft],zt=Rt.geometry,ir=Rt.index,or=Rt.sourceLayerIndex;if(this.hasPattern){var mr=Ph("fill",this.layers,Rt,this.zoom,u);this.patternFeatures.push(mr)}else this.addFeature(Rt,zt,ir,c,{});u.featureIndex.insert(o[ir].feature,zt,ir,or,this.index)}},ml.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},ml.prototype.addFeatures=function(o,u,c){for(var m=0,x=this.patternFeatures;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,c)}},ml.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},ml.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},ml.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,zv),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.indexBuffer2=o.createIndexBuffer(this.indexArray2)),this.programConfigurations.upload(o),this.uploaded=!0},ml.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.indexBuffer2.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.segments2.destroy())},ml.prototype.addFeature=function(o,u,c,m,x){for(var E=0,A=mp(u,500);E<A.length;E+=1){for(var R=A[E],L=0,V=0,Y=R;V<Y.length;V+=1)L+=Y[V].length;for(var K=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray),le=K.vertexLength,de=[],Ne=[],I=0,ft=R;I<ft.length;I+=1){var tt=ft[I];if(tt.length!==0){tt!==R[0]&&Ne.push(de.length/2);var Rt=this.segments2.prepareSegment(tt.length,this.layoutVertexArray,this.indexArray2),zt=Rt.vertexLength;this.layoutVertexArray.emplaceBack(tt[0].x,tt[0].y),this.indexArray2.emplaceBack(zt+tt.length-1,zt),de.push(tt[0].x),de.push(tt[0].y);for(var ir=1;ir<tt.length;ir++)this.layoutVertexArray.emplaceBack(tt[ir].x,tt[ir].y),this.indexArray2.emplaceBack(zt+ir-1,zt+ir),de.push(tt[ir].x),de.push(tt[ir].y);Rt.vertexLength+=tt.length,Rt.primitiveLength+=tt.length}}for(var or=Hf(de,Ne),mr=0;mr<or.length;mr+=3)this.indexArray.emplaceBack(le+or[mr],le+or[mr+1],le+or[mr+2]);K.vertexLength+=L,K.primitiveLength+=or.length/3}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,x,m)},xn("FillBucket",ml,{omit:["layers","patternFeatures"]});var Gu=new Ba({"fill-sort-key":new An(j.layout_fill["fill-sort-key"])}),Nd={paint:new Ba({"fill-antialias":new Dn(j.paint_fill["fill-antialias"]),"fill-opacity":new An(j.paint_fill["fill-opacity"]),"fill-color":new An(j.paint_fill["fill-color"]),"fill-outline-color":new An(j.paint_fill["fill-outline-color"]),"fill-translate":new Dn(j.paint_fill["fill-translate"]),"fill-translate-anchor":new Dn(j.paint_fill["fill-translate-anchor"]),"fill-pattern":new as(j.paint_fill["fill-pattern"])}),layout:Gu},gp=function(o){function u(c){o.call(this,c,Nd)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.recalculate=function(c,m){o.prototype.recalculate.call(this,c,m);var x=this.paint._values["fill-outline-color"];x.value.kind==="constant"&&x.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])},u.prototype.createBucket=function(c){return new ml(c)},u.prototype.queryRadius=function(){return ao(this.paint.get("fill-translate"))},u.prototype.queryIntersectsFeature=function(c,m,x,E,A,R,L){return lu(Is(c,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),R.angle,L),E)},u.prototype.isTileClipped=function(){return!0},u}(tu),Ud=mo([{name:"a_pos",components:2,type:"Int16"},{name:"a_normal_ed",components:4,type:"Int16"}],4).members,Oh=Bc;function Bc(o,u,c,m,x){this.properties={},this.extent=c,this.type=0,this._pbf=o,this._geometry=-1,this._keys=m,this._values=x,o.readFields($p,this,u)}function $p(o,u,c){o==1?u.id=c.readVarint():o==2?function(m,x){for(var E=m.readVarint()+m.pos;m.pos<E;){var A=x._keys[m.readVarint()],R=x._values[m.readVarint()];x.properties[A]=R}}(c,u):o==3?u.type=c.readVarint():o==4&&(u._geometry=c.pos)}function Xu(o){for(var u,c,m=0,x=0,E=o.length,A=E-1;x<E;A=x++)m+=((c=o[A]).x-(u=o[x]).x)*(u.y+c.y);return m}Bc.types=["Unknown","Point","LineString","Polygon"],Bc.prototype.loadGeometry=function(){var o=this._pbf;o.pos=this._geometry;for(var u,c=o.readVarint()+o.pos,m=1,x=0,E=0,A=0,R=[];o.pos<c;){if(x<=0){var L=o.readVarint();m=7&L,x=L>>3}if(x--,m===1||m===2)E+=o.readSVarint(),A+=o.readSVarint(),m===1&&(u&&R.push(u),u=[]),u.push(new ce(E,A));else{if(m!==7)throw new Error("unknown command "+m);u&&u.push(u[0].clone())}}return u&&R.push(u),R},Bc.prototype.bbox=function(){var o=this._pbf;o.pos=this._geometry;for(var u=o.readVarint()+o.pos,c=1,m=0,x=0,E=0,A=1/0,R=-1/0,L=1/0,V=-1/0;o.pos<u;){if(m<=0){var Y=o.readVarint();c=7&Y,m=Y>>3}if(m--,c===1||c===2)(x+=o.readSVarint())<A&&(A=x),x>R&&(R=x),(E+=o.readSVarint())<L&&(L=E),E>V&&(V=E);else if(c!==7)throw new Error("unknown command "+c)}return[A,L,R,V]},Bc.prototype.toGeoJSON=function(o,u,c){var m,x,E=this.extent*Math.pow(2,c),A=this.extent*o,R=this.extent*u,L=this.loadGeometry(),V=Bc.types[this.type];function Y(de){for(var Ne=0;Ne<de.length;Ne++){var I=de[Ne];de[Ne]=[360*(I.x+A)/E-180,360/Math.PI*Math.atan(Math.exp((180-360*(I.y+R)/E)*Math.PI/180))-90]}}switch(this.type){case 1:var K=[];for(m=0;m<L.length;m++)K[m]=L[m][0];Y(L=K);break;case 2:for(m=0;m<L.length;m++)Y(L[m]);break;case 3:for(L=function(de){var Ne=de.length;if(Ne<=1)return[de];for(var I,ft,tt=[],Rt=0;Rt<Ne;Rt++){var zt=Xu(de[Rt]);zt!==0&&(ft===void 0&&(ft=zt<0),ft===zt<0?(I&&tt.push(I),I=[de[Rt]]):I.push(de[Rt]))}return I&&tt.push(I),tt}(L),m=0;m<L.length;m++)for(x=0;x<L[m].length;x++)Y(L[m][x])}L.length===1?L=L[0]:V="Multi"+V;var le={type:"Feature",geometry:{type:V,coordinates:L},properties:this.properties};return"id"in this&&(le.id=this.id),le};var _p=Fc;function Fc(o,u){this.version=1,this.name=null,this.extent=4096,this.length=0,this._pbf=o,this._keys=[],this._values=[],this._features=[],o.readFields(Hs,this,u),this.length=this._features.length}function Hs(o,u,c){o===15?u.version=c.readVarint():o===1?u.name=c.readString():o===5?u.extent=c.readVarint():o===2?u._features.push(c.pos):o===3?u._keys.push(c.readString()):o===4&&u._values.push(function(m){for(var x=null,E=m.readVarint()+m.pos;m.pos<E;){var A=m.readVarint()>>3;x=A===1?m.readString():A===2?m.readFloat():A===3?m.readDouble():A===4?m.readVarint64():A===5?m.readVarint():A===6?m.readSVarint():A===7?m.readBoolean():null}return x}(c))}function zd(o,u,c){if(o===3){var m=new _p(c,c.readVarint()+c.pos);m.length&&(u[m.name]=m)}}Fc.prototype.feature=function(o){if(o<0||o>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[o];var u=this._pbf.readVarint()+this._pbf.pos;return new Oh(this._pbf,u,this.extent,this._keys,this._values)};var sc={VectorTile:function(o,u){this.layers=o.readFields(zd,{},u)},VectorTileFeature:Oh,VectorTileLayer:_p},kh=sc.VectorTileFeature.types,Yf=Math.pow(2,13);function us(o,u,c,m,x,E,A,R){o.emplaceBack(u,c,2*Math.floor(m*Yf)+A,x*Yf*2,E*Yf*2,Math.round(R))}var Ss=function(o){this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(u){return u.id}),this.index=o.index,this.hasPattern=!1,this.layoutVertexArray=new cl,this.indexArray=new ss,this.programConfigurations=new Xn(o.layers,o.zoom),this.segments=new ye,this.stateDependentLayerIds=this.layers.filter(function(u){return u.isStateDependent()}).map(function(u){return u.id})};function Lo(o,u){return o.x===u.x&&(o.x<0||o.x>8192)||o.y===u.y&&(o.y<0||o.y>8192)}Ss.prototype.populate=function(o,u,c){this.features=[],this.hasPattern=Xp("fill-extrusion",this.layers,u);for(var m=0,x=o;m<x.length;m+=1){var E=x[m],A=E.feature,R=E.id,L=E.index,V=E.sourceLayerIndex,Y=this.layers[0]._featureFilter.needGeometry,K=Qa(A,Y);if(this.layers[0]._featureFilter.filter(new Re(this.zoom),K,c)){var le={id:R,sourceLayerIndex:V,index:L,geometry:Y?K.geometry:Ha(A),properties:A.properties,type:A.type,patterns:{}};this.hasPattern?this.features.push(Ph("fill-extrusion",this.layers,le,this.zoom,u)):this.addFeature(le,le.geometry,L,c,{}),u.featureIndex.insert(A,le.geometry,L,V,this.index,!0)}}},Ss.prototype.addFeatures=function(o,u,c){for(var m=0,x=this.features;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,c)}},Ss.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},Ss.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ss.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ss.prototype.upload=function(o){this.uploaded||(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Ud),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},Ss.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ss.prototype.addFeature=function(o,u,c,m,x){for(var E=0,A=mp(u,500);E<A.length;E+=1){for(var R=A[E],L=0,V=0,Y=R;V<Y.length;V+=1)L+=Y[V].length;for(var K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray),le=0,de=R;le<de.length;le+=1){var Ne=de[le];if(Ne.length!==0&&!((Mi=Ne).every(function(mi){return mi.x<0})||Mi.every(function(mi){return mi.x>8192})||Mi.every(function(mi){return mi.y<0})||Mi.every(function(mi){return mi.y>8192})))for(var I=0,ft=0;ft<Ne.length;ft++){var tt=Ne[ft];if(ft>=1){var Rt=Ne[ft-1];if(!Lo(tt,Rt)){K.vertexLength+4>ye.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray));var zt=tt.sub(Rt)._perp()._unit(),ir=Rt.dist(tt);I+ir>32768&&(I=0),us(this.layoutVertexArray,tt.x,tt.y,zt.x,zt.y,0,0,I),us(this.layoutVertexArray,tt.x,tt.y,zt.x,zt.y,0,1,I),us(this.layoutVertexArray,Rt.x,Rt.y,zt.x,zt.y,0,0,I+=ir),us(this.layoutVertexArray,Rt.x,Rt.y,zt.x,zt.y,0,1,I);var or=K.vertexLength;this.indexArray.emplaceBack(or,or+2,or+1),this.indexArray.emplaceBack(or+1,or+2,or+3),K.vertexLength+=4,K.primitiveLength+=2}}}}if(K.vertexLength+L>ye.MAX_VERTEX_ARRAY_LENGTH&&(K=this.segments.prepareSegment(L,this.layoutVertexArray,this.indexArray)),kh[o.type]==="Polygon"){for(var mr=[],Zr=[],qr=K.vertexLength,Bn=0,vn=R;Bn<vn.length;Bn+=1){var Zn=vn[Bn];if(Zn.length!==0){Zn!==R[0]&&Zr.push(mr.length/2);for(var mn=0;mn<Zn.length;mn++){var xi=Zn[mn];us(this.layoutVertexArray,xi.x,xi.y,0,0,1,1,0),mr.push(xi.x),mr.push(xi.y)}}}for(var ti=Hf(mr,Zr),Rn=0;Rn<ti.length;Rn+=3)this.indexArray.emplaceBack(qr+ti[Rn],qr+ti[Rn+2],qr+ti[Rn+1]);K.primitiveLength+=ti.length/3,K.vertexLength+=L}}var Mi;this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,x,m)},xn("FillExtrusionBucket",Ss,{omit:["layers","features"]});var pu={paint:new Ba({"fill-extrusion-opacity":new Dn(j["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new An(j["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Dn(j["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Dn(j["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new as(j["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-height":new An(j["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new An(j["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-vertical-gradient":new Dn(j["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"])})},Yp=function(o){function u(c){o.call(this,c,pu)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.createBucket=function(c){return new Ss(c)},u.prototype.queryRadius=function(){return ao(this.paint.get("fill-extrusion-translate"))},u.prototype.is3D=function(){return!0},u.prototype.queryIntersectsFeature=function(c,m,x,E,A,R,L,V){var Y=Is(c,this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),R.angle,L),K=this.paint.get("fill-extrusion-height").evaluate(m,x),le=this.paint.get("fill-extrusion-base").evaluate(m,x),de=function(I,ft,tt,Rt){for(var zt=[],ir=0,or=I;ir<or.length;ir+=1){var mr=or[ir],Zr=[mr.x,mr.y,0,1];Wu(Zr,Zr,ft),zt.push(new ce(Zr[0]/Zr[3],Zr[1]/Zr[3]))}return zt}(Y,V),Ne=function(I,ft,tt,Rt){for(var zt=[],ir=[],or=Rt[8]*ft,mr=Rt[9]*ft,Zr=Rt[10]*ft,qr=Rt[11]*ft,Bn=Rt[8]*tt,vn=Rt[9]*tt,Zn=Rt[10]*tt,mn=Rt[11]*tt,xi=0,ti=I;xi<ti.length;xi+=1){for(var Rn=[],Mi=[],mi=0,Hi=ti[xi];mi<Hi.length;mi+=1){var Hn=Hi[mi],ea=Hn.x,ba=Hn.y,so=Rt[0]*ea+Rt[4]*ba+Rt[12],to=Rt[1]*ea+Rt[5]*ba+Rt[13],Fa=Rt[2]*ea+Rt[6]*ba+Rt[14],Xa=Rt[3]*ea+Rt[7]*ba+Rt[15],Jo=Fa+Zr,Vo=Xa+qr,Ws=so+Bn,fs=to+vn,Os=Fa+Zn,So=Xa+mn,Ea=new ce((so+or)/Vo,(to+mr)/Vo);Ea.z=Jo/Vo,Rn.push(Ea);var Fi=new ce(Ws/So,fs/So);Fi.z=Os/So,Mi.push(Fi)}zt.push(Rn),ir.push(Mi)}return[zt,ir]}(E,le,K,V);return function(I,ft,tt){var Rt=1/0;lu(tt,ft)&&(Rt=qp(tt,ft[0]));for(var zt=0;zt<ft.length;zt++)for(var ir=ft[zt],or=I[zt],mr=0;mr<ir.length-1;mr++){var Zr=ir[mr],qr=[Zr,ir[mr+1],or[mr+1],or[mr],Zr];fl(tt,qr)&&(Rt=Math.min(Rt,qp(tt,qr)))}return Rt!==1/0&&Rt}(Ne[0],Ne[1],de)},u}(tu);function cf(o,u){return o.x*u.x+o.y*u.y}function qp(o,u){if(o.length===1){for(var c,m=0,x=u[m++];!c||x.equals(c);)if(!(c=u[m++]))return 1/0;for(;m<u.length;m++){var E=u[m],A=o[0],R=c.sub(x),L=E.sub(x),V=A.sub(x),Y=cf(R,R),K=cf(R,L),le=cf(L,L),de=cf(V,R),Ne=cf(V,L),I=Y*le-K*K,ft=(le*de-K*Ne)/I,tt=(Y*Ne-K*de)/I,Rt=x.z*(1-ft-tt)+c.z*ft+E.z*tt;if(isFinite(Rt))return Rt}return 1/0}for(var zt=1/0,ir=0,or=u;ir<or.length;ir+=1)zt=Math.min(zt,or[ir].z);return zt}var Zd=mo([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"}],4).members,Vv=mo([{name:"a_uv_x",components:1,type:"Float32"},{name:"a_split_index",components:1,type:"Float32"}]).members,Vd=sc.VectorTileFeature.types,Kp=Math.cos(Math.PI/180*37.5),jd=Math.pow(2,14)/.5,Ps=function(o){var u=this;this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(c){return c.id}),this.index=o.index,this.hasPattern=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(function(c){u.gradients[c.id]={}}),this.layoutVertexArray=new ys,this.layoutVertexArray2=new ec,this.indexArray=new ss,this.programConfigurations=new Xn(o.layers,o.zoom),this.segments=new ye,this.maxLineLength=0,this.stateDependentLayerIds=this.layers.filter(function(c){return c.isStateDependent()}).map(function(c){return c.id})};Ps.prototype.populate=function(o,u,c){this.hasPattern=Xp("line",this.layers,u);for(var m=this.layers[0].layout.get("line-sort-key"),x=[],E=0,A=o;E<A.length;E+=1){var R=A[E],L=R.feature,V=R.id,Y=R.index,K=R.sourceLayerIndex,le=this.layers[0]._featureFilter.needGeometry,de=Qa(L,le);if(this.layers[0]._featureFilter.filter(new Re(this.zoom),de,c)){var Ne=m?m.evaluate(de,{},c):void 0,I={id:V,properties:L.properties,type:L.type,sourceLayerIndex:K,index:Y,geometry:le?de.geometry:Ha(L),patterns:{},sortKey:Ne};x.push(I)}}m&&x.sort(function(Zr,qr){return Zr.sortKey-qr.sortKey});for(var ft=0,tt=x;ft<tt.length;ft+=1){var Rt=tt[ft],zt=Rt.geometry,ir=Rt.index,or=Rt.sourceLayerIndex;if(this.hasPattern){var mr=Ph("line",this.layers,Rt,this.zoom,u);this.patternFeatures.push(mr)}else this.addFeature(Rt,zt,ir,c,{});u.featureIndex.insert(o[ir].feature,zt,ir,or,this.index)}},Ps.prototype.update=function(o,u,c){this.stateDependentLayers.length&&this.programConfigurations.updatePaintArrays(o,u,this.stateDependentLayers,c)},Ps.prototype.addFeatures=function(o,u,c){for(var m=0,x=this.patternFeatures;m<x.length;m+=1){var E=x[m];this.addFeature(E,E.geometry,E.index,u,c)}},Ps.prototype.isEmpty=function(){return this.layoutVertexArray.length===0},Ps.prototype.uploadPending=function(){return!this.uploaded||this.programConfigurations.needsUpload},Ps.prototype.upload=function(o){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=o.createVertexBuffer(this.layoutVertexArray2,Vv)),this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,Zd),this.indexBuffer=o.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(o),this.uploaded=!0},Ps.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())},Ps.prototype.lineFeatureClips=function(o){if(o.properties&&o.properties.hasOwnProperty("mapbox_clip_start")&&o.properties.hasOwnProperty("mapbox_clip_end"))return{start:+o.properties.mapbox_clip_start,end:+o.properties.mapbox_clip_end}},Ps.prototype.addFeature=function(o,u,c,m,x){var E=this.layers[0].layout,A=E.get("line-join").evaluate(o,{}),R=E.get("line-cap"),L=E.get("line-miter-limit"),V=E.get("line-round-limit");this.lineClips=this.lineFeatureClips(o);for(var Y=0,K=u;Y<K.length;Y+=1)this.addLine(K[Y],o,A,R,L,V);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,o,c,x,m)},Ps.prototype.addLine=function(o,u,c,m,x,E){if(this.distance=0,this.scaledDistance=0,this.totalDistance=0,this.lineClips){this.lineClipsArray.push(this.lineClips);for(var A=0;A<o.length-1;A++)this.totalDistance+=o[A].dist(o[A+1]);this.updateScaledDistance(),this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}for(var R=Vd[u.type]==="Polygon",L=o.length;L>=2&&o[L-1].equals(o[L-2]);)L--;for(var V=0;V<L-1&&o[V].equals(o[V+1]);)V++;if(!(L<(R?3:2))){c==="bevel"&&(x=1.05);var Y,K=this.overscaling<=16?122880/(512*this.overscaling):0,le=this.segments.prepareSegment(10*L,this.layoutVertexArray,this.indexArray),de=void 0,Ne=void 0,I=void 0,ft=void 0;this.e1=this.e2=-1,R&&(ft=o[V].sub(Y=o[L-2])._unit()._perp());for(var tt=V;tt<L;tt++)if(!(Ne=tt===L-1?R?o[V+1]:void 0:o[tt+1])||!o[tt].equals(Ne)){ft&&(I=ft),Y&&(de=Y),Y=o[tt],ft=Ne?Ne.sub(Y)._unit()._perp():I;var Rt=(I=I||ft).add(ft);Rt.x===0&&Rt.y===0||Rt._unit();var zt=I.x*ft.x+I.y*ft.y,ir=Rt.x*ft.x+Rt.y*ft.y,or=ir!==0?1/ir:1/0,mr=2*Math.sqrt(2-2*ir),Zr=ir<Kp&&de&&Ne,qr=I.x*ft.y-I.y*ft.x>0;if(Zr&&tt>V){var Bn=Y.dist(de);if(Bn>2*K){var vn=Y.sub(Y.sub(de)._mult(K/Bn)._round());this.updateDistance(de,vn),this.addCurrentVertex(vn,I,0,0,le),de=vn}}var Zn=de&&Ne,mn=Zn?c:R?"butt":m;if(Zn&&mn==="round"&&(or<E?mn="miter":or<=2&&(mn="fakeround")),mn==="miter"&&or>x&&(mn="bevel"),mn==="bevel"&&(or>2&&(mn="flipbevel"),or<x&&(mn="miter")),de&&this.updateDistance(de,Y),mn==="miter")Rt._mult(or),this.addCurrentVertex(Y,Rt,0,0,le);else if(mn==="flipbevel"){if(or>100)Rt=ft.mult(-1);else{var xi=or*I.add(ft).mag()/I.sub(ft).mag();Rt._perp()._mult(xi*(qr?-1:1))}this.addCurrentVertex(Y,Rt,0,0,le),this.addCurrentVertex(Y,Rt.mult(-1),0,0,le)}else if(mn==="bevel"||mn==="fakeround"){var ti=-Math.sqrt(or*or-1),Rn=qr?ti:0,Mi=qr?0:ti;if(de&&this.addCurrentVertex(Y,I,Rn,Mi,le),mn==="fakeround")for(var mi=Math.round(180*mr/Math.PI/20),Hi=1;Hi<mi;Hi++){var Hn=Hi/mi;if(Hn!==.5){var ea=Hn-.5;Hn+=Hn*ea*(Hn-1)*((1.0904+zt*(zt*(3.55645-1.43519*zt)-3.2452))*ea*ea+(.848013+zt*(.215638*zt-1.06021)))}var ba=ft.sub(I)._mult(Hn)._add(I)._unit()._mult(qr?-1:1);this.addHalfVertex(Y,ba.x,ba.y,!1,qr,0,le)}Ne&&this.addCurrentVertex(Y,ft,-Rn,-Mi,le)}else if(mn==="butt")this.addCurrentVertex(Y,Rt,0,0,le);else if(mn==="square"){var so=de?1:-1;this.addCurrentVertex(Y,Rt,so,so,le)}else mn==="round"&&(de&&(this.addCurrentVertex(Y,I,0,0,le),this.addCurrentVertex(Y,I,1,1,le,!0)),Ne&&(this.addCurrentVertex(Y,ft,-1,-1,le,!0),this.addCurrentVertex(Y,ft,0,0,le)));if(Zr&&tt<L-1){var to=Y.dist(Ne);if(to>2*K){var Fa=Y.add(Ne.sub(Y)._mult(K/to)._round());this.updateDistance(Y,Fa),this.addCurrentVertex(Fa,ft,0,0,le),Y=Fa}}}}},Ps.prototype.addCurrentVertex=function(o,u,c,m,x,E){E===void 0&&(E=!1);var A=u.y*m-u.x,R=-u.y-u.x*m;this.addHalfVertex(o,u.x+u.y*c,u.y-u.x*c,E,!1,c,x),this.addHalfVertex(o,A,R,E,!0,-m,x),this.distance>jd/2&&this.totalDistance===0&&(this.distance=0,this.addCurrentVertex(o,u,c,m,x,E))},Ps.prototype.addHalfVertex=function(o,u,c,m,x,E,A){var R=.5*(this.lineClips?this.scaledDistance*(jd-1):this.scaledDistance);this.layoutVertexArray.emplaceBack((o.x<<1)+(m?1:0),(o.y<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*c)+128,1+(E===0?0:E<0?-1:1)|(63&R)<<2,R>>6),this.lineClips&&this.layoutVertexArray2.emplaceBack((this.scaledDistance-this.lineClips.start)/(this.lineClips.end-this.lineClips.start),this.lineClipsArray.length);var L=A.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,L),A.primitiveLength++),x?this.e2=L:this.e1=L},Ps.prototype.updateScaledDistance=function(){this.scaledDistance=this.lineClips?this.lineClips.start+(this.lineClips.end-this.lineClips.start)*this.distance/this.totalDistance:this.distance},Ps.prototype.updateDistance=function(o,u){this.distance+=o.dist(u),this.updateScaledDistance()},xn("LineBucket",Ps,{omit:["layers","patternFeatures"]});var yp=new Ba({"line-cap":new Dn(j.layout_line["line-cap"]),"line-join":new An(j.layout_line["line-join"]),"line-miter-limit":new Dn(j.layout_line["line-miter-limit"]),"line-round-limit":new Dn(j.layout_line["line-round-limit"]),"line-sort-key":new An(j.layout_line["line-sort-key"])}),xp={paint:new Ba({"line-opacity":new An(j.paint_line["line-opacity"]),"line-color":new An(j.paint_line["line-color"]),"line-translate":new Dn(j.paint_line["line-translate"]),"line-translate-anchor":new Dn(j.paint_line["line-translate-anchor"]),"line-width":new An(j.paint_line["line-width"]),"line-gap-width":new An(j.paint_line["line-gap-width"]),"line-offset":new An(j.paint_line["line-offset"]),"line-blur":new An(j.paint_line["line-blur"]),"line-dasharray":new os(j.paint_line["line-dasharray"]),"line-pattern":new as(j.paint_line["line-pattern"]),"line-gradient":new xu(j.paint_line["line-gradient"])}),layout:yp},Qp=new(function(o){function u(){o.apply(this,arguments)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.possiblyEvaluate=function(c,m){return m=new Re(Math.floor(m.zoom),{now:m.now,fadeDuration:m.fadeDuration,zoomHistory:m.zoomHistory,transition:m.transition}),o.prototype.possiblyEvaluate.call(this,c,m)},u.prototype.evaluate=function(c,m,x,E){return m=Et({},m,{zoom:Math.floor(m.zoom)}),o.prototype.evaluate.call(this,c,m,x,E)},u}(An))(xp.paint.properties["line-width"].specification);Qp.useIntegerZoom=!0;var qf=function(o){function u(c){o.call(this,c,xp),this.gradientVersion=0}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype._handleSpecialPaintPropertyUpdate=function(c){c==="line-gradient"&&(this.stepInterpolant=this._transitionablePaint._values["line-gradient"].value.expression._styleExpression.expression instanceof Ls,this.gradientVersion=(this.gradientVersion+1)%We)},u.prototype.gradientExpression=function(){return this._transitionablePaint._values["line-gradient"].value.expression},u.prototype.recalculate=function(c,m){o.prototype.recalculate.call(this,c,m),this.paint._values["line-floorwidth"]=Qp.possiblyEvaluate(this._transitioningPaint._values["line-width"].value,c)},u.prototype.createBucket=function(c){return new Ps(c)},u.prototype.queryRadius=function(c){var m=c,x=Jp(Po("line-width",this,m),Po("line-gap-width",this,m)),E=Po("line-offset",this,m);return x/2+Math.abs(E)+ao(this.paint.get("line-translate"))},u.prototype.queryIntersectsFeature=function(c,m,x,E,A,R,L){var V=Is(c,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),R.angle,L),Y=L/2*Jp(this.paint.get("line-width").evaluate(m,x),this.paint.get("line-gap-width").evaluate(m,x)),K=this.paint.get("line-offset").evaluate(m,x);return K&&(E=function(le,de){for(var Ne=[],I=new ce(0,0),ft=0;ft<le.length;ft++){for(var tt=le[ft],Rt=[],zt=0;zt<tt.length;zt++){var ir=tt[zt],or=tt[zt+1],mr=zt===0?I:ir.sub(tt[zt-1])._unit()._perp(),Zr=zt===tt.length-1?I:or.sub(ir)._unit()._perp(),qr=mr._add(Zr)._unit();qr._mult(1/(qr.x*Zr.x+qr.y*Zr.y)),Rt.push(qr._mult(de)._add(ir))}Ne.push(Rt)}return Ne}(E,K*L)),function(le,de,Ne){for(var I=0;I<de.length;I++){var ft=de[I];if(le.length>=3){for(var tt=0;tt<ft.length;tt++)if(cu(le,ft[tt]))return!0}if(Zs(le,ft,Ne))return!0}return!1}(V,E,Y)},u.prototype.isTileClipped=function(){return!0},u}(tu);function Jp(o,u){return u>0?u+2*o:o}var jv=mo([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_data",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),Hv=mo([{name:"a_projected_pos",components:3,type:"Float32"}],4),Hd=(mo([{name:"a_fade_opacity",components:1,type:"Uint32"}],4),mo([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"}])),Wd=(mo([{type:"Int16",name:"anchorPointX"},{type:"Int16",name:"anchorPointY"},{type:"Int16",name:"x1"},{type:"Int16",name:"y1"},{type:"Int16",name:"x2"},{type:"Int16",name:"y2"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]),mo([{name:"a_pos",components:2,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4)),G=mo([{name:"a_pos",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);function we(o,u,c){return o.sections.forEach(function(m){m.text=function(x,E,A){var R=E.layout.get("text-transform").evaluate(A,{});return R==="uppercase"?x=x.toLocaleUpperCase():R==="lowercase"&&(x=x.toLocaleLowerCase()),Zt.applyArabicShaping&&(x=Zt.applyArabicShaping(x)),x}(m.text,u,c)}),o}mo([{name:"triangle",components:3,type:"Uint16"}]),mo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"}]),mo([{type:"Int16",name:"anchorX"},{type:"Int16",name:"anchorY"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",name:"textBoxScale"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"}]),mo([{type:"Float32",name:"offsetX"}]),mo([{type:"Int16",name:"x"},{type:"Int16",name:"y"},{type:"Int16",name:"tileUnitDistanceFromAnchor"}]);var Ye={"!":"\uFE15","#":"\uFF03",$:"\uFF04","%":"\uFF05","&":"\uFF06","(":"\uFE35",")":"\uFE36","*":"\uFF0A","+":"\uFF0B",",":"\uFE10","-":"\uFE32",".":"\u30FB","/":"\uFF0F",":":"\uFE13",";":"\uFE14","<":"\uFE3F","=":"\uFF1D",">":"\uFE40","?":"\uFE16","@":"\uFF20","[":"\uFE47","\\":"\uFF3C","]":"\uFE48","^":"\uFF3E",_:"\uFE33","`":"\uFF40","{":"\uFE37","|":"\u2015","}":"\uFE38","~":"\uFF5E","\xA2":"\uFFE0","\xA3":"\uFFE1","\xA5":"\uFFE5","\xA6":"\uFFE4","\xAC":"\uFFE2","\xAF":"\uFFE3","\u2013":"\uFE32","\u2014":"\uFE31","\u2018":"\uFE43","\u2019":"\uFE44","\u201C":"\uFE41","\u201D":"\uFE42","\u2026":"\uFE19","\u2027":"\u30FB","\u20A9":"\uFFE6","\u3001":"\uFE11","\u3002":"\uFE12","\u3008":"\uFE3F","\u3009":"\uFE40","\u300A":"\uFE3D","\u300B":"\uFE3E","\u300C":"\uFE41","\u300D":"\uFE42","\u300E":"\uFE43","\u300F":"\uFE44","\u3010":"\uFE3B","\u3011":"\uFE3C","\u3014":"\uFE39","\u3015":"\uFE3A","\u3016":"\uFE17","\u3017":"\uFE18","\uFF01":"\uFE15","\uFF08":"\uFE35","\uFF09":"\uFE36","\uFF0C":"\uFE10","\uFF0D":"\uFE32","\uFF0E":"\u30FB","\uFF1A":"\uFE13","\uFF1B":"\uFE14","\uFF1C":"\uFE3F","\uFF1E":"\uFE40","\uFF1F":"\uFE16","\uFF3B":"\uFE47","\uFF3D":"\uFE48","\uFF3F":"\uFE33","\uFF5B":"\uFE37","\uFF5C":"\u2015","\uFF5D":"\uFE38","\uFF5F":"\uFE35","\uFF60":"\uFE36","\uFF61":"\uFE12","\uFF62":"\uFE41","\uFF63":"\uFE42"},Kt=function(o,u,c,m,x){var E,A,R=8*x-m-1,L=(1<<R)-1,V=L>>1,Y=-7,K=c?x-1:0,le=c?-1:1,de=o[u+K];for(K+=le,E=de&(1<<-Y)-1,de>>=-Y,Y+=R;Y>0;E=256*E+o[u+K],K+=le,Y-=8);for(A=E&(1<<-Y)-1,E>>=-Y,Y+=m;Y>0;A=256*A+o[u+K],K+=le,Y-=8);if(E===0)E=1-V;else{if(E===L)return A?NaN:1/0*(de?-1:1);A+=Math.pow(2,m),E-=V}return(de?-1:1)*A*Math.pow(2,E-m)},vr=function(o,u,c,m,x,E){var A,R,L,V=8*E-x-1,Y=(1<<V)-1,K=Y>>1,le=x===23?Math.pow(2,-24)-Math.pow(2,-77):0,de=m?0:E-1,Ne=m?1:-1,I=u<0||u===0&&1/u<0?1:0;for(u=Math.abs(u),isNaN(u)||u===1/0?(R=isNaN(u)?1:0,A=Y):(A=Math.floor(Math.log(u)/Math.LN2),u*(L=Math.pow(2,-A))<1&&(A--,L*=2),(u+=A+K>=1?le/L:le*Math.pow(2,1-K))*L>=2&&(A++,L/=2),A+K>=Y?(R=0,A=Y):A+K>=1?(R=(u*L-1)*Math.pow(2,x),A+=K):(R=u*Math.pow(2,K-1)*Math.pow(2,x),A=0));x>=8;o[c+de]=255&R,de+=Ne,R/=256,x-=8);for(A=A<<x|R,V+=x;V>0;o[c+de]=255&A,de+=Ne,A/=256,V-=8);o[c+de-Ne]|=128*I},er=jt;function jt(o){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(o)?o:new Uint8Array(o||0),this.pos=0,this.type=0,this.length=this.buf.length}jt.Varint=0,jt.Fixed64=1,jt.Bytes=2,jt.Fixed32=5;var Br=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");function Pr(o){return o.type===jt.Bytes?o.readVarint()+o.pos:o.pos+1}function Yr(o,u,c){return c?4294967296*u+(o>>>0):4294967296*(u>>>0)+(o>>>0)}function Nr(o,u,c){var m=u<=16383?1:u<=2097151?2:u<=268435455?3:Math.floor(Math.log(u)/(7*Math.LN2));c.realloc(m);for(var x=c.pos-1;x>=o;x--)c.buf[x+m]=c.buf[x]}function Hr(o,u){for(var c=0;c<o.length;c++)u.writeVarint(o[c])}function en(o,u){for(var c=0;c<o.length;c++)u.writeSVarint(o[c])}function Or(o,u){for(var c=0;c<o.length;c++)u.writeFloat(o[c])}function $r(o,u){for(var c=0;c<o.length;c++)u.writeDouble(o[c])}function Bt(o,u){for(var c=0;c<o.length;c++)u.writeBoolean(o[c])}function ur(o,u){for(var c=0;c<o.length;c++)u.writeFixed32(o[c])}function Ur(o,u){for(var c=0;c<o.length;c++)u.writeSFixed32(o[c])}function un(o,u){for(var c=0;c<o.length;c++)u.writeFixed64(o[c])}function Tr(o,u){for(var c=0;c<o.length;c++)u.writeSFixed64(o[c])}function pn(o,u){return(o[u]|o[u+1]<<8|o[u+2]<<16)+16777216*o[u+3]}function Mr(o,u,c){o[c]=u,o[c+1]=u>>>8,o[c+2]=u>>>16,o[c+3]=u>>>24}function ln(o,u){return(o[u]|o[u+1]<<8|o[u+2]<<16)+(o[u+3]<<24)}function Ar(o,u,c){o===1&&c.readMessage(on,u)}function on(o,u,c){if(o===3){var m=c.readMessage(jn,{}),x=m.width,E=m.height,A=m.left,R=m.top,L=m.advance;u.push({id:m.id,bitmap:new ru({width:x+6,height:E+6},m.bitmap),metrics:{width:x,height:E,left:A,top:R,advance:L}})}}function jn(o,u,c){o===1?u.id=c.readVarint():o===2?u.bitmap=c.readBytes():o===3?u.width=c.readVarint():o===4?u.height=c.readVarint():o===5?u.left=c.readSVarint():o===6?u.top=c.readSVarint():o===7&&(u.advance=c.readVarint())}function ai(o){for(var u=0,c=0,m=0,x=o;m<x.length;m+=1){var E=x[m];u+=E.w*E.h,c=Math.max(c,E.w)}o.sort(function(I,ft){return ft.h-I.h});for(var A=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(u/.95)),c),h:1/0}],R=0,L=0,V=0,Y=o;V<Y.length;V+=1)for(var K=Y[V],le=A.length-1;le>=0;le--){var de=A[le];if(!(K.w>de.w||K.h>de.h)){if(K.x=de.x,K.y=de.y,L=Math.max(L,K.y+K.h),R=Math.max(R,K.x+K.w),K.w===de.w&&K.h===de.h){var Ne=A.pop();le<A.length&&(A[le]=Ne)}else K.h===de.h?(de.x+=K.w,de.w-=K.w):K.w===de.w?(de.y+=K.h,de.h-=K.h):(A.push({x:de.x+K.w,y:de.y,w:de.w-K.w,h:K.h}),de.y+=K.h,de.h-=K.h);break}}return{w:R,h:L,fill:u/(R*L)||0}}jt.prototype={destroy:function(){this.buf=null},readFields:function(o,u,c){for(c=c||this.length;this.pos<c;){var m=this.readVarint(),x=m>>3,E=this.pos;this.type=7&m,o(x,u,this),this.pos===E&&this.skip(m)}return u},readMessage:function(o,u){return this.readFields(o,u,this.readVarint()+this.pos)},readFixed32:function(){var o=pn(this.buf,this.pos);return this.pos+=4,o},readSFixed32:function(){var o=ln(this.buf,this.pos);return this.pos+=4,o},readFixed64:function(){var o=pn(this.buf,this.pos)+4294967296*pn(this.buf,this.pos+4);return this.pos+=8,o},readSFixed64:function(){var o=pn(this.buf,this.pos)+4294967296*ln(this.buf,this.pos+4);return this.pos+=8,o},readFloat:function(){var o=Kt(this.buf,this.pos,!0,23,4);return this.pos+=4,o},readDouble:function(){var o=Kt(this.buf,this.pos,!0,52,8);return this.pos+=8,o},readVarint:function(o){var u,c,m=this.buf;return u=127&(c=m[this.pos++]),c<128?u:(u|=(127&(c=m[this.pos++]))<<7,c<128?u:(u|=(127&(c=m[this.pos++]))<<14,c<128?u:(u|=(127&(c=m[this.pos++]))<<21,c<128?u:function(x,E,A){var R,L,V=A.buf;if(R=(112&(L=V[A.pos++]))>>4,L<128||(R|=(127&(L=V[A.pos++]))<<3,L<128)||(R|=(127&(L=V[A.pos++]))<<10,L<128)||(R|=(127&(L=V[A.pos++]))<<17,L<128)||(R|=(127&(L=V[A.pos++]))<<24,L<128)||(R|=(1&(L=V[A.pos++]))<<31,L<128))return Yr(x,R,E);throw new Error("Expected varint not more than 10 bytes")}(u|=(15&(c=m[this.pos]))<<28,o,this))))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var o=this.readVarint();return o%2==1?(o+1)/-2:o/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var o=this.readVarint()+this.pos,u=this.pos;return this.pos=o,o-u>=12&&Br?function(c,m,x){return Br.decode(c.subarray(m,x))}(this.buf,u,o):function(c,m,x){for(var E="",A=m;A<x;){var R,L,V,Y=c[A],K=null,le=Y>239?4:Y>223?3:Y>191?2:1;if(A+le>x)break;le===1?Y<128&&(K=Y):le===2?(192&(R=c[A+1]))==128&&(K=(31&Y)<<6|63&R)<=127&&(K=null):le===3?(L=c[A+2],(192&(R=c[A+1]))==128&&(192&L)==128&&((K=(15&Y)<<12|(63&R)<<6|63&L)<=2047||K>=55296&&K<=57343)&&(K=null)):le===4&&(L=c[A+2],V=c[A+3],(192&(R=c[A+1]))==128&&(192&L)==128&&(192&V)==128&&((K=(15&Y)<<18|(63&R)<<12|(63&L)<<6|63&V)<=65535||K>=1114112)&&(K=null)),K===null?(K=65533,le=1):K>65535&&(K-=65536,E+=String.fromCharCode(K>>>10&1023|55296),K=56320|1023&K),E+=String.fromCharCode(K),A+=le}return E}(this.buf,u,o)},readBytes:function(){var o=this.readVarint()+this.pos,u=this.buf.subarray(this.pos,o);return this.pos=o,u},readPackedVarint:function(o,u){if(this.type!==jt.Bytes)return o.push(this.readVarint(u));var c=Pr(this);for(o=o||[];this.pos<c;)o.push(this.readVarint(u));return o},readPackedSVarint:function(o){if(this.type!==jt.Bytes)return o.push(this.readSVarint());var u=Pr(this);for(o=o||[];this.pos<u;)o.push(this.readSVarint());return o},readPackedBoolean:function(o){if(this.type!==jt.Bytes)return o.push(this.readBoolean());var u=Pr(this);for(o=o||[];this.pos<u;)o.push(this.readBoolean());return o},readPackedFloat:function(o){if(this.type!==jt.Bytes)return o.push(this.readFloat());var u=Pr(this);for(o=o||[];this.pos<u;)o.push(this.readFloat());return o},readPackedDouble:function(o){if(this.type!==jt.Bytes)return o.push(this.readDouble());var u=Pr(this);for(o=o||[];this.pos<u;)o.push(this.readDouble());return o},readPackedFixed32:function(o){if(this.type!==jt.Bytes)return o.push(this.readFixed32());var u=Pr(this);for(o=o||[];this.pos<u;)o.push(this.readFixed32());return o},readPackedSFixed32:function(o){if(this.type!==jt.Bytes)return o.push(this.readSFixed32());var u=Pr(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed32());return o},readPackedFixed64:function(o){if(this.type!==jt.Bytes)return o.push(this.readFixed64());var u=Pr(this);for(o=o||[];this.pos<u;)o.push(this.readFixed64());return o},readPackedSFixed64:function(o){if(this.type!==jt.Bytes)return o.push(this.readSFixed64());var u=Pr(this);for(o=o||[];this.pos<u;)o.push(this.readSFixed64());return o},skip:function(o){var u=7&o;if(u===jt.Varint)for(;this.buf[this.pos++]>127;);else if(u===jt.Bytes)this.pos=this.readVarint()+this.pos;else if(u===jt.Fixed32)this.pos+=4;else{if(u!==jt.Fixed64)throw new Error("Unimplemented type: "+u);this.pos+=8}},writeTag:function(o,u){this.writeVarint(o<<3|u)},realloc:function(o){for(var u=this.length||16;u<this.pos+o;)u*=2;if(u!==this.length){var c=new Uint8Array(u);c.set(this.buf),this.buf=c,this.length=u}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(o){this.realloc(4),Mr(this.buf,o,this.pos),this.pos+=4},writeSFixed32:function(o){this.realloc(4),Mr(this.buf,o,this.pos),this.pos+=4},writeFixed64:function(o){this.realloc(8),Mr(this.buf,-1&o,this.pos),Mr(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeSFixed64:function(o){this.realloc(8),Mr(this.buf,-1&o,this.pos),Mr(this.buf,Math.floor(o*(1/4294967296)),this.pos+4),this.pos+=8},writeVarint:function(o){(o=+o||0)>268435455||o<0?function(u,c){var m,x;if(u>=0?(m=u%4294967296|0,x=u/4294967296|0):(x=~(-u/4294967296),4294967295^(m=~(-u%4294967296))?m=m+1|0:(m=0,x=x+1|0)),u>=18446744073709552e3||u<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");c.realloc(10),function(E,A,R){R.buf[R.pos++]=127&E|128,E>>>=7,R.buf[R.pos++]=127&E|128,E>>>=7,R.buf[R.pos++]=127&E|128,E>>>=7,R.buf[R.pos++]=127&E|128,R.buf[R.pos]=127&(E>>>=7)}(m,0,c),function(E,A){var R=(7&E)<<4;A.buf[A.pos++]|=R|((E>>>=3)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E|((E>>>=7)?128:0),E&&(A.buf[A.pos++]=127&E)))))}(x,c)}(o,this):(this.realloc(4),this.buf[this.pos++]=127&o|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=127&(o>>>=7)|(o>127?128:0),o<=127||(this.buf[this.pos++]=o>>>7&127))))},writeSVarint:function(o){this.writeVarint(o<0?2*-o-1:2*o)},writeBoolean:function(o){this.writeVarint(!!o)},writeString:function(o){o=String(o),this.realloc(4*o.length),this.pos++;var u=this.pos;this.pos=function(m,x,E){for(var A,R,L=0;L<x.length;L++){if((A=x.charCodeAt(L))>55295&&A<57344){if(!R){A>56319||L+1===x.length?(m[E++]=239,m[E++]=191,m[E++]=189):R=A;continue}if(A<56320){m[E++]=239,m[E++]=191,m[E++]=189,R=A;continue}A=R-55296<<10|A-56320|65536,R=null}else R&&(m[E++]=239,m[E++]=191,m[E++]=189,R=null);A<128?m[E++]=A:(A<2048?m[E++]=A>>6|192:(A<65536?m[E++]=A>>12|224:(m[E++]=A>>18|240,m[E++]=A>>12&63|128),m[E++]=A>>6&63|128),m[E++]=63&A|128)}return E}(this.buf,o,this.pos);var c=this.pos-u;c>=128&&Nr(u,c,this),this.pos=u-1,this.writeVarint(c),this.pos+=c},writeFloat:function(o){this.realloc(4),vr(this.buf,o,this.pos,!0,23,4),this.pos+=4},writeDouble:function(o){this.realloc(8),vr(this.buf,o,this.pos,!0,52,8),this.pos+=8},writeBytes:function(o){var u=o.length;this.writeVarint(u),this.realloc(u);for(var c=0;c<u;c++)this.buf[this.pos++]=o[c]},writeRawMessage:function(o,u){this.pos++;var c=this.pos;o(u,this);var m=this.pos-c;m>=128&&Nr(c,m,this),this.pos=c-1,this.writeVarint(m),this.pos+=m},writeMessage:function(o,u,c){this.writeTag(o,jt.Bytes),this.writeRawMessage(u,c)},writePackedVarint:function(o,u){u.length&&this.writeMessage(o,Hr,u)},writePackedSVarint:function(o,u){u.length&&this.writeMessage(o,en,u)},writePackedBoolean:function(o,u){u.length&&this.writeMessage(o,Bt,u)},writePackedFloat:function(o,u){u.length&&this.writeMessage(o,Or,u)},writePackedDouble:function(o,u){u.length&&this.writeMessage(o,$r,u)},writePackedFixed32:function(o,u){u.length&&this.writeMessage(o,ur,u)},writePackedSFixed32:function(o,u){u.length&&this.writeMessage(o,Ur,u)},writePackedFixed64:function(o,u){u.length&&this.writeMessage(o,un,u)},writePackedSFixed64:function(o,u){u.length&&this.writeMessage(o,Tr,u)},writeBytesField:function(o,u){this.writeTag(o,jt.Bytes),this.writeBytes(u)},writeFixed32Field:function(o,u){this.writeTag(o,jt.Fixed32),this.writeFixed32(u)},writeSFixed32Field:function(o,u){this.writeTag(o,jt.Fixed32),this.writeSFixed32(u)},writeFixed64Field:function(o,u){this.writeTag(o,jt.Fixed64),this.writeFixed64(u)},writeSFixed64Field:function(o,u){this.writeTag(o,jt.Fixed64),this.writeSFixed64(u)},writeVarintField:function(o,u){this.writeTag(o,jt.Varint),this.writeVarint(u)},writeSVarintField:function(o,u){this.writeTag(o,jt.Varint),this.writeSVarint(u)},writeStringField:function(o,u){this.writeTag(o,jt.Bytes),this.writeString(u)},writeFloatField:function(o,u){this.writeTag(o,jt.Fixed32),this.writeFloat(u)},writeDoubleField:function(o,u){this.writeTag(o,jt.Fixed64),this.writeDouble(u)},writeBooleanField:function(o,u){this.writeVarintField(o,!!u)}};var rn=function(o,u){var c=u.pixelRatio,m=u.version,x=u.stretchX,E=u.stretchY,A=u.content;this.paddedRect=o,this.pixelRatio=c,this.stretchX=x,this.stretchY=E,this.content=A,this.version=m},Dr={tl:{configurable:!0},br:{configurable:!0},tlbr:{configurable:!0},displaySize:{configurable:!0}};Dr.tl.get=function(){return[this.paddedRect.x+1,this.paddedRect.y+1]},Dr.br.get=function(){return[this.paddedRect.x+this.paddedRect.w-1,this.paddedRect.y+this.paddedRect.h-1]},Dr.tlbr.get=function(){return this.tl.concat(this.br)},Dr.displaySize.get=function(){return[(this.paddedRect.w-2)/this.pixelRatio,(this.paddedRect.h-2)/this.pixelRatio]},Object.defineProperties(rn.prototype,Dr);var yr=function(o,u){var c={},m={};this.haveRenderCallbacks=[];var x=[];this.addImages(o,c,x),this.addImages(u,m,x);var E=ai(x),A=new Do({width:E.w||1,height:E.h||1});for(var R in o){var L=o[R],V=c[R].paddedRect;Do.copy(L.data,A,{x:0,y:0},{x:V.x+1,y:V.y+1},L.data)}for(var Y in u){var K=u[Y],le=m[Y].paddedRect,de=le.x+1,Ne=le.y+1,I=K.data.width,ft=K.data.height;Do.copy(K.data,A,{x:0,y:0},{x:de,y:Ne},K.data),Do.copy(K.data,A,{x:0,y:ft-1},{x:de,y:Ne-1},{width:I,height:1}),Do.copy(K.data,A,{x:0,y:0},{x:de,y:Ne+ft},{width:I,height:1}),Do.copy(K.data,A,{x:I-1,y:0},{x:de-1,y:Ne},{width:1,height:ft}),Do.copy(K.data,A,{x:0,y:0},{x:de+I,y:Ne},{width:1,height:ft})}this.image=A,this.iconPositions=c,this.patternPositions=m};yr.prototype.addImages=function(o,u,c){for(var m in o){var x=o[m],E={x:0,y:0,w:x.data.width+2,h:x.data.height+2};c.push(E),u[m]=new rn(E,x),x.hasRenderCallback&&this.haveRenderCallbacks.push(m)}},yr.prototype.patchUpdatedImages=function(o,u){for(var c in o.dispatchRenderCallbacks(this.haveRenderCallbacks),o.updatedImages)this.patchUpdatedImage(this.iconPositions[c],o.getImage(c),u),this.patchUpdatedImage(this.patternPositions[c],o.getImage(c),u)},yr.prototype.patchUpdatedImage=function(o,u,c){if(o&&u&&o.version!==u.version){o.version=u.version;var m=o.tl;c.update(u.data,void 0,{x:m[0],y:m[1]})}},xn("ImagePosition",rn),xn("ImageAtlas",yr);var tr={horizontal:1,vertical:2,horizontalOnly:3},Ti=function(){this.scale=1,this.fontStack="",this.imageName=null};Ti.forText=function(o,u){var c=new Ti;return c.scale=o||1,c.fontStack=u,c},Ti.forImage=function(o){var u=new Ti;return u.imageName=o,u};var Je=function(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null};function _i(o,u,c,m,x,E,A,R,L,V,Y,K,le,de,Ne,I){var ft,tt=Je.fromFeature(o,x);K===tr.vertical&&tt.verticalizePunctuation();var Rt=Zt.processBidirectionalText,zt=Zt.processStyledBidirectionalText;if(Rt&&tt.sections.length===1){ft=[];for(var ir=0,or=Rt(tt.toString(),_o(tt,V,E,u,m,de,Ne));ir<or.length;ir+=1){var mr=or[ir],Zr=new Je;Zr.text=mr,Zr.sections=tt.sections;for(var qr=0;qr<mr.length;qr++)Zr.sectionIndex.push(0);ft.push(Zr)}}else if(zt){ft=[];for(var Bn=0,vn=zt(tt.text,tt.sectionIndex,_o(tt,V,E,u,m,de,Ne));Bn<vn.length;Bn+=1){var Zn=vn[Bn],mn=new Je;mn.text=Zn[0],mn.sectionIndex=Zn[1],mn.sections=tt.sections,ft.push(mn)}}else ft=function(Rn,Mi){for(var mi=[],Hi=Rn.text,Hn=0,ea=0,ba=Mi;ea<ba.length;ea+=1){var so=ba[ea];mi.push(Rn.substring(Hn,so)),Hn=so}return Hn<Hi.length&&mi.push(Rn.substring(Hn,Hi.length)),mi}(tt,_o(tt,V,E,u,m,de,Ne));var xi=[],ti={positionedLines:xi,text:tt.toString(),top:Y[1],bottom:Y[1],left:Y[0],right:Y[0],writingMode:K,iconsInText:!1,verticalizable:!1};return function(Rn,Mi,mi,Hi,Hn,ea,ba,so,to,Fa,Xa,Jo){for(var Vo=0,Ws=-17,fs=0,Os=0,So=so==="right"?1:so==="left"?0:.5,Ea=0,Fi=0,Sa=Hn;Fi<Sa.length;Fi+=1){var pa=Sa[Fi];pa.trim();var qi=pa.getMaxScale(),hs=24*(qi-1),Ts={positionedGlyphs:[],lineOffset:0};Rn.positionedLines[Ea]=Ts;var Da=Ts.positionedGlyphs,Ao=0;if(pa.length()){for(var ps=0;ps<pa.length();ps++){var ta=pa.getSection(ps),Uc=pa.getSectionIndex(ps),qu=pa.getCharCode(ps),Bl=0,uo=null,Fl=null,Cu=null,pf=24,df=!(to===tr.horizontal||!Xa&&!af(qu)||Xa&&(si[qu]||(vf=qu,an.Arabic(vf)||an["Arabic Supplement"](vf)||an["Arabic Extended-A"](vf)||an["Arabic Presentation Forms-A"](vf)||an["Arabic Presentation Forms-B"](vf))));if(ta.imageName){var eh=Hi[ta.imageName];if(!eh)continue;Cu=ta.imageName,Rn.iconsInText=Rn.iconsInText||!0,Fl=eh.paddedRect;var Nl=eh.displaySize;ta.scale=24*ta.scale/Jo,Bl=hs+(24-Nl[1]*ta.scale),pf=(uo={width:Nl[0],height:Nl[1],left:1,top:-3,advance:df?Nl[1]:Nl[0]}).advance;var zc=df?Nl[0]*ta.scale-24*qi:Nl[1]*ta.scale-24*qi;zc>0&&zc>Ao&&(Ao=zc)}else{var nu=mi[ta.fontStack],th=nu&&nu[qu];if(th&&th.rect)Fl=th.rect,uo=th.metrics;else{var Uh=Mi[ta.fontStack],lc=Uh&&Uh[qu];if(!lc)continue;uo=lc.metrics}Bl=24*(qi-ta.scale)}df?(Rn.verticalizable=!0,Da.push({glyph:qu,imageName:Cu,x:Vo,y:Ws+Bl,vertical:df,scale:ta.scale,fontStack:ta.fontStack,sectionIndex:Uc,metrics:uo,rect:Fl}),Vo+=pf*ta.scale+Fa):(Da.push({glyph:qu,imageName:Cu,x:Vo,y:Ws+Bl,vertical:df,scale:ta.scale,fontStack:ta.fontStack,sectionIndex:Uc,metrics:uo,rect:Fl}),Vo+=uo.advance*ta.scale+Fa)}Da.length!==0&&(fs=Math.max(Vo-Fa,fs),yo(Da,0,Da.length-1,So,Ao)),Vo=0;var Gd=ea*qi+Ao;Ts.lineOffset=Math.max(Ao,hs),Ws+=Gd,Os=Math.max(Gd,Os),++Ea}else Ws+=ea,++Ea}var vf,sd=Ws- -17,zh=xa(ba),mf=zh.horizontalAlign,Zc=zh.verticalAlign;(function(Xd,$d,ud,Ep,Yd,ld,cd,cc,Sp){var gf,Ap=($d-ud)*Yd;gf=ld!==cd?-cc*Ep- -17:(-Ep*Sp+.5)*cd;for(var Vc=0,Zh=Xd;Vc<Zh.length;Vc+=1)for(var _f=0,yf=Zh[Vc].positionedGlyphs;_f<yf.length;_f+=1){var rh=yf[_f];rh.x+=Ap,rh.y+=gf}})(Rn.positionedLines,So,mf,Zc,fs,Os,ea,sd,Hn.length),Rn.top+=-Zc*sd,Rn.bottom=Rn.top+sd,Rn.left+=-mf*fs,Rn.right=Rn.left+fs}(ti,u,c,m,ft,A,R,L,K,V,le,I),!function(Rn){for(var Mi=0,mi=Rn;Mi<mi.length;Mi+=1)if(mi[Mi].positionedGlyphs.length!==0)return!1;return!0}(xi)&&ti}Je.fromFeature=function(o,u){for(var c=new Je,m=0;m<o.sections.length;m++){var x=o.sections[m];x.image?c.addImageSection(x):c.addTextSection(x,u)}return c},Je.prototype.length=function(){return this.text.length},Je.prototype.getSection=function(o){return this.sections[this.sectionIndex[o]]},Je.prototype.getSectionIndex=function(o){return this.sectionIndex[o]},Je.prototype.getCharCode=function(o){return this.text.charCodeAt(o)},Je.prototype.verticalizePunctuation=function(){this.text=function(o){for(var u="",c=0;c<o.length;c++){var m=o.charCodeAt(c+1)||null,x=o.charCodeAt(c-1)||null;u+=m&&of(m)&&!Ye[o[c+1]]||x&&of(x)&&!Ye[o[c-1]]||!Ye[o[c]]?o[c]:Ye[o[c]]}return u}(this.text)},Je.prototype.trim=function(){for(var o=0,u=0;u<this.text.length&&si[this.text.charCodeAt(u)];u++)o++;for(var c=this.text.length,m=this.text.length-1;m>=0&&m>=o&&si[this.text.charCodeAt(m)];m--)c--;this.text=this.text.substring(o,c),this.sectionIndex=this.sectionIndex.slice(o,c)},Je.prototype.substring=function(o,u){var c=new Je;return c.text=this.text.substring(o,u),c.sectionIndex=this.sectionIndex.slice(o,u),c.sections=this.sections,c},Je.prototype.toString=function(){return this.text},Je.prototype.getMaxScale=function(){var o=this;return this.sectionIndex.reduce(function(u,c){return Math.max(u,o.sections[c].scale)},0)},Je.prototype.addTextSection=function(o,u){this.text+=o.text,this.sections.push(Ti.forText(o.scale,o.fontStack||u));for(var c=this.sections.length-1,m=0;m<o.text.length;++m)this.sectionIndex.push(c)},Je.prototype.addImageSection=function(o){var u=o.image?o.image.name:"";if(u.length!==0){var c=this.getNextImageSectionCharCode();c?(this.text+=String.fromCharCode(c),this.sections.push(Ti.forImage(u)),this.sectionIndex.push(this.sections.length-1)):Qe("Reached maximum number of images 6401")}else Qe("Can't add FormattedSection with an empty image.")},Je.prototype.getNextImageSectionCharCode=function(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)};var si={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Kn={};function Yi(o,u,c,m,x,E){if(u.imageName){var A=m[u.imageName];return A?A.displaySize[0]*u.scale*24/E+x:0}var R=c[u.fontStack],L=R&&R[o];return L?L.metrics.advance*u.scale+x:0}function ho(o,u,c,m){var x=Math.pow(o-u,2);return m?o<u?x/2:2*x:x+Math.abs(c)*c}function po(o,u,c){var m=0;return o===10&&(m-=1e4),c&&(m+=150),o!==40&&o!==65288||(m+=50),u!==41&&u!==65289||(m+=50),m}function Ii(o,u,c,m,x,E){for(var A=null,R=ho(u,c,x,E),L=0,V=m;L<V.length;L+=1){var Y=V[L],K=ho(u-Y.x,c,x,E)+Y.badness;K<=R&&(A=Y,R=K)}return{index:o,x:u,priorBreak:A,badness:R}}function _o(o,u,c,m,x,E,A){if(E!=="point")return[];if(!o)return[];for(var R,L=[],V=function(ft,tt,Rt,zt,ir,or){for(var mr=0,Zr=0;Zr<ft.length();Zr++){var qr=ft.getSection(Zr);mr+=Yi(ft.getCharCode(Zr),qr,zt,ir,tt,or)}return mr/Math.max(1,Math.ceil(mr/Rt))}(o,u,c,m,x,A),Y=o.text.indexOf("\u200B")>=0,K=0,le=0;le<o.length();le++){var de=o.getSection(le),Ne=o.getCharCode(le);if(si[Ne]||(K+=Yi(Ne,de,m,x,u,A)),le<o.length()-1){var I=!((R=Ne)<11904||!(an["Bopomofo Extended"](R)||an.Bopomofo(R)||an["CJK Compatibility Forms"](R)||an["CJK Compatibility Ideographs"](R)||an["CJK Compatibility"](R)||an["CJK Radicals Supplement"](R)||an["CJK Strokes"](R)||an["CJK Symbols and Punctuation"](R)||an["CJK Unified Ideographs Extension A"](R)||an["CJK Unified Ideographs"](R)||an["Enclosed CJK Letters and Months"](R)||an["Halfwidth and Fullwidth Forms"](R)||an.Hiragana(R)||an["Ideographic Description Characters"](R)||an["Kangxi Radicals"](R)||an["Katakana Phonetic Extensions"](R)||an.Katakana(R)||an["Vertical Forms"](R)||an["Yi Radicals"](R)||an["Yi Syllables"](R)));(Kn[Ne]||I||de.imageName)&&L.push(Ii(le+1,K,V,L,po(Ne,o.getCharCode(le+1),I&&Y),!1))}}return function ft(tt){return tt?ft(tt.priorBreak).concat(tt.index):[]}(Ii(o.length(),K,V,L,0,!0))}function xa(o){var u=.5,c=.5;switch(o){case"right":case"top-right":case"bottom-right":u=1;break;case"left":case"top-left":case"bottom-left":u=0}switch(o){case"bottom":case"bottom-right":case"bottom-left":c=1;break;case"top":case"top-right":case"top-left":c=0}return{horizontalAlign:u,verticalAlign:c}}function yo(o,u,c,m,x){if(m||x)for(var E=o[c],A=(o[c].x+E.metrics.advance*E.scale)*m,R=u;R<=c;R++)o[R].x-=A,o[R].y+=x}function xo(o,u,c,m,x,E){var A,R=o.image;if(R.content){var L=R.content,V=R.pixelRatio||1;A=[L[0]/V,L[1]/V,R.displaySize[0]-L[2]/V,R.displaySize[1]-L[3]/V]}var Y,K,le,de,Ne=u.left*E,I=u.right*E;c==="width"||c==="both"?(de=x[0]+Ne-m[3],K=x[0]+I+m[1]):K=(de=x[0]+(Ne+I-R.displaySize[0])/2)+R.displaySize[0];var ft=u.top*E,tt=u.bottom*E;return c==="height"||c==="both"?(Y=x[1]+ft-m[0],le=x[1]+tt+m[2]):le=(Y=x[1]+(ft+tt-R.displaySize[1])/2)+R.displaySize[1],{image:R,top:Y,right:K,bottom:le,left:de,collisionPadding:A}}Kn[10]=!0,Kn[32]=!0,Kn[38]=!0,Kn[40]=!0,Kn[41]=!0,Kn[43]=!0,Kn[45]=!0,Kn[47]=!0,Kn[173]=!0,Kn[183]=!0,Kn[8203]=!0,Kn[8208]=!0,Kn[8211]=!0,Kn[8231]=!0;var Wa=function(o){function u(c,m,x,E){o.call(this,c,m),this.angle=x,E!==void 0&&(this.segment=E)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.clone=function(){return new u(this.x,this.y,this.angle,this.segment)},u}(ce);function Bo(o,u){var c=u.expression;if(c.kind==="constant")return{kind:"constant",layoutSize:c.evaluate(new Re(o+1))};if(c.kind==="source")return{kind:"source"};for(var m=c.zoomStops,x=c.interpolationType,E=0;E<m.length&&m[E]<=o;)E++;for(var A=E=Math.max(0,E-1);A<m.length&&m[A]<o+1;)A++;A=Math.min(m.length-1,A);var R=m[E],L=m[A];return c.kind==="composite"?{kind:"composite",minZoom:R,maxZoom:L,interpolationType:x}:{kind:"camera",minZoom:R,maxZoom:L,minSize:c.evaluate(new Re(R)),maxSize:c.evaluate(new Re(L)),interpolationType:x}}function As(o,u,c){var m=u.uSize,x=c.lowerSize;return o.kind==="source"?x/128:o.kind==="composite"?Ya(x/128,c.upperSize/128,u.uSizeT):m}function bo(o,u){var c=0,m=0;if(o.kind==="constant")m=o.layoutSize;else if(o.kind!=="source"){var x=o.interpolationType,E=x?vt(qo.interpolationFactor(x,u,o.minZoom,o.maxZoom),0,1):0;o.kind==="camera"?m=Ya(o.minSize,o.maxSize,E):c=E}return{uSizeT:c,uSize:m}}xn("Anchor",Wa);var gi=Object.freeze({__proto__:null,getSizeData:Bo,evaluateSizeForFeature:As,evaluateSizeForZoom:bo,SIZE_PACK_FACTOR:128});function ls(o,u,c,m,x){if(u.segment===void 0)return!0;for(var E=u,A=u.segment+1,R=0;R>-c/2;){if(--A<0)return!1;R-=o[A].dist(E),E=o[A]}R+=o[A].dist(o[A+1]),A++;for(var L=[],V=0;R<c/2;){var Y=o[A],K=o[A+1];if(!K)return!1;var le=o[A-1].angleTo(Y)-Y.angleTo(K);for(le=Math.abs((le+3*Math.PI)%(2*Math.PI)-Math.PI),L.push({distance:R,angleDelta:le}),V+=le;R-L[0].distance>m;)V-=L.shift().angleDelta;if(V>x)return!1;A++,R+=Y.dist(K)}return!0}function ia(o){for(var u=0,c=0;c<o.length-1;c++)u+=o[c].dist(o[c+1]);return u}function $n(o,u,c){return o?.6*u*c:0}function Ri(o,u){return Math.max(o?o.right-o.left:0,u?u.right-u.left:0)}function Gi(o,u,c,m,x,E){for(var A=$n(c,x,E),R=Ri(c,m)*E,L=0,V=ia(o)/2,Y=0;Y<o.length-1;Y++){var K=o[Y],le=o[Y+1],de=K.dist(le);if(L+de>V){var Ne=(V-L)/de,I=Ya(K.x,le.x,Ne),ft=Ya(K.y,le.y,Ne),tt=new Wa(I,ft,le.angleTo(K),Y);return tt._round(),!A||ls(o,tt,R,A,u)?tt:void 0}L+=de}}function Eo(o,u,c,m,x,E,A,R,L){var V=$n(m,E,A),Y=Ri(m,x),K=Y*A,le=o[0].x===0||o[0].x===L||o[0].y===0||o[0].y===L;return u-K<u/4&&(u=K+u/4),function de(Ne,I,ft,tt,Rt,zt,ir,or,mr){for(var Zr=zt/2,qr=ia(Ne),Bn=0,vn=I-ft,Zn=[],mn=0;mn<Ne.length-1;mn++){for(var xi=Ne[mn],ti=Ne[mn+1],Rn=xi.dist(ti),Mi=ti.angleTo(xi);vn+ft<Bn+Rn;){var mi=((vn+=ft)-Bn)/Rn,Hi=Ya(xi.x,ti.x,mi),Hn=Ya(xi.y,ti.y,mi);if(Hi>=0&&Hi<mr&&Hn>=0&&Hn<mr&&vn-Zr>=0&&vn+Zr<=qr){var ea=new Wa(Hi,Hn,Mi,mn);ea._round(),tt&&!ls(Ne,ea,zt,tt,Rt)||Zn.push(ea)}}Bn+=Rn}return or||Zn.length||ir||(Zn=de(Ne,Bn/2,ft,tt,Rt,zt,ir,!0,mr)),Zn}(o,le?u/2*R%u:(Y/2+2*E)*A*R%u,u,V,c,K,le,!1,L)}function gl(o,u,c,m,x){for(var E=[],A=0;A<o.length;A++)for(var R=o[A],L=void 0,V=0;V<R.length-1;V++){var Y=R[V],K=R[V+1];Y.x<u&&K.x<u||(Y.x<u?Y=new ce(u,Y.y+(u-Y.x)/(K.x-Y.x)*(K.y-Y.y))._round():K.x<u&&(K=new ce(u,Y.y+(u-Y.x)/(K.x-Y.x)*(K.y-Y.y))._round()),Y.y<c&&K.y<c||(Y.y<c?Y=new ce(Y.x+(c-Y.y)/(K.y-Y.y)*(K.x-Y.x),c)._round():K.y<c&&(K=new ce(Y.x+(c-Y.y)/(K.y-Y.y)*(K.x-Y.x),c)._round()),Y.x>=m&&K.x>=m||(Y.x>=m?Y=new ce(m,Y.y+(m-Y.x)/(K.x-Y.x)*(K.y-Y.y))._round():K.x>=m&&(K=new ce(m,Y.y+(m-Y.x)/(K.x-Y.x)*(K.y-Y.y))._round()),Y.y>=x&&K.y>=x||(Y.y>=x?Y=new ce(Y.x+(x-Y.y)/(K.y-Y.y)*(K.x-Y.x),x)._round():K.y>=x&&(K=new ce(Y.x+(x-Y.y)/(K.y-Y.y)*(K.x-Y.x),x)._round()),L&&Y.equals(L[L.length-1])||E.push(L=[Y]),L.push(K)))))}return E}function je(o,u,c,m){var x=[],E=o.image,A=E.pixelRatio,R=E.paddedRect.w-2,L=E.paddedRect.h-2,V=o.right-o.left,Y=o.bottom-o.top,K=E.stretchX||[[0,R]],le=E.stretchY||[[0,L]],de=function(Hi,Hn){return Hi+Hn[1]-Hn[0]},Ne=K.reduce(de,0),I=le.reduce(de,0),ft=R-Ne,tt=L-I,Rt=0,zt=Ne,ir=0,or=I,mr=0,Zr=ft,qr=0,Bn=tt;if(E.content&&m){var vn=E.content;Rt=nr(K,0,vn[0]),ir=nr(le,0,vn[1]),zt=nr(K,vn[0],vn[2]),or=nr(le,vn[1],vn[3]),mr=vn[0]-Rt,qr=vn[1]-ir,Zr=vn[2]-vn[0]-zt,Bn=vn[3]-vn[1]-or}var Zn=function(Hi,Hn,ea,ba){var so=dn(Hi.stretch-Rt,zt,V,o.left),to=yi(Hi.fixed-mr,Zr,Hi.stretch,Ne),Fa=dn(Hn.stretch-ir,or,Y,o.top),Xa=yi(Hn.fixed-qr,Bn,Hn.stretch,I),Jo=dn(ea.stretch-Rt,zt,V,o.left),Vo=yi(ea.fixed-mr,Zr,ea.stretch,Ne),Ws=dn(ba.stretch-ir,or,Y,o.top),fs=yi(ba.fixed-qr,Bn,ba.stretch,I),Os=new ce(so,Fa),So=new ce(Jo,Fa),Ea=new ce(Jo,Ws),Fi=new ce(so,Ws),Sa=new ce(to/A,Xa/A),pa=new ce(Vo/A,fs/A),qi=u*Math.PI/180;if(qi){var hs=Math.sin(qi),Ts=Math.cos(qi),Da=[Ts,-hs,hs,Ts];Os._matMult(Da),So._matMult(Da),Fi._matMult(Da),Ea._matMult(Da)}var Ao=Hi.stretch+Hi.fixed,ps=Hn.stretch+Hn.fixed;return{tl:Os,tr:So,bl:Fi,br:Ea,tex:{x:E.paddedRect.x+1+Ao,y:E.paddedRect.y+1+ps,w:ea.stretch+ea.fixed-Ao,h:ba.stretch+ba.fixed-ps},writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:Sa,pixelOffsetBR:pa,minFontScaleX:Zr/A/V,minFontScaleY:Bn/A/Y,isSDF:c}};if(m&&(E.stretchX||E.stretchY))for(var mn=Gt(K,ft,Ne),xi=Gt(le,tt,I),ti=0;ti<mn.length-1;ti++)for(var Rn=mn[ti],Mi=mn[ti+1],mi=0;mi<xi.length-1;mi++)x.push(Zn(Rn,xi[mi],Mi,xi[mi+1]));else x.push(Zn({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:R+1},{fixed:0,stretch:L+1}));return x}function nr(o,u,c){for(var m=0,x=0,E=o;x<E.length;x+=1){var A=E[x];m+=Math.max(u,Math.min(c,A[1]))-Math.max(u,Math.min(c,A[0]))}return m}function Gt(o,u,c){for(var m=[{fixed:-1,stretch:0}],x=0,E=o;x<E.length;x+=1){var A=E[x],R=A[0],L=A[1],V=m[m.length-1];m.push({fixed:R-V.stretch,stretch:V.stretch}),m.push({fixed:R-V.stretch,stretch:V.stretch+(L-R)})}return m.push({fixed:u+1,stretch:c}),m}function dn(o,u,c,m){return o/u*c+m}function yi(o,u,c,m){return o-u*c/m}var ma=function(o,u,c,m,x,E,A,R,L,V){if(this.boxStartIndex=o.length,L){var Y=E.top,K=E.bottom,le=E.collisionPadding;le&&(Y-=le[1],K+=le[3]);var de=K-Y;de>0&&(de=Math.max(10,de),this.circleDiameter=de)}else{var Ne=E.top*A-R,I=E.bottom*A+R,ft=E.left*A-R,tt=E.right*A+R,Rt=E.collisionPadding;if(Rt&&(ft-=Rt[0]*A,Ne-=Rt[1]*A,tt+=Rt[2]*A,I+=Rt[3]*A),V){var zt=new ce(ft,Ne),ir=new ce(tt,Ne),or=new ce(ft,I),mr=new ce(tt,I),Zr=V*Math.PI/180;zt._rotate(Zr),ir._rotate(Zr),or._rotate(Zr),mr._rotate(Zr),ft=Math.min(zt.x,ir.x,or.x,mr.x),tt=Math.max(zt.x,ir.x,or.x,mr.x),Ne=Math.min(zt.y,ir.y,or.y,mr.y),I=Math.max(zt.y,ir.y,or.y,mr.y)}o.emplaceBack(u.x,u.y,ft,Ne,tt,I,c,m,x)}this.boxEndIndex=o.length},pe=function(o,u){if(o===void 0&&(o=[]),u===void 0&&(u=Ie),this.data=o,this.length=this.data.length,this.compare=u,this.length>0)for(var c=(this.length>>1)-1;c>=0;c--)this._down(c)};function Ie(o,u){return o<u?-1:o>u?1:0}function $e(o,u,c){u===void 0&&(u=1),c===void 0&&(c=!1);for(var m=1/0,x=1/0,E=-1/0,A=-1/0,R=o[0],L=0;L<R.length;L++){var V=R[L];(!L||V.x<m)&&(m=V.x),(!L||V.y<x)&&(x=V.y),(!L||V.x>E)&&(E=V.x),(!L||V.y>A)&&(A=V.y)}var Y=Math.min(E-m,A-x),K=Y/2,le=new pe([],$t);if(Y===0)return new ce(m,x);for(var de=m;de<E;de+=Y)for(var Ne=x;Ne<A;Ne+=Y)le.push(new Vt(de+K,Ne+K,K,o));for(var I=function(Rt){for(var zt=0,ir=0,or=0,mr=Rt[0],Zr=0,qr=mr.length,Bn=qr-1;Zr<qr;Bn=Zr++){var vn=mr[Zr],Zn=mr[Bn],mn=vn.x*Zn.y-Zn.x*vn.y;ir+=(vn.x+Zn.x)*mn,or+=(vn.y+Zn.y)*mn,zt+=3*mn}return new Vt(ir/zt,or/zt,0,Rt)}(o),ft=le.length;le.length;){var tt=le.pop();(tt.d>I.d||!I.d)&&(I=tt,c&&console.log("found best %d after %d probes",Math.round(1e4*tt.d)/1e4,ft)),tt.max-I.d<=u||(le.push(new Vt(tt.p.x-(K=tt.h/2),tt.p.y-K,K,o)),le.push(new Vt(tt.p.x+K,tt.p.y-K,K,o)),le.push(new Vt(tt.p.x-K,tt.p.y+K,K,o)),le.push(new Vt(tt.p.x+K,tt.p.y+K,K,o)),ft+=4)}return c&&(console.log("num probes: "+ft),console.log("best distance: "+I.d)),I.p}function $t(o,u){return u.max-o.max}function Vt(o,u,c,m){this.p=new ce(o,u),this.h=c,this.d=function(x,E){for(var A=!1,R=1/0,L=0;L<E.length;L++)for(var V=E[L],Y=0,K=V.length,le=K-1;Y<K;le=Y++){var de=V[Y],Ne=V[le];de.y>x.y!=Ne.y>x.y&&x.x<(Ne.x-de.x)*(x.y-de.y)/(Ne.y-de.y)+de.x&&(A=!A),R=Math.min(R,nc(x,de,Ne))}return(A?1:-1)*Math.sqrt(R)}(this.p,m),this.max=this.d+this.h*Math.SQRT2}pe.prototype.push=function(o){this.data.push(o),this.length++,this._up(this.length-1)},pe.prototype.pop=function(){if(this.length!==0){var o=this.data[0],u=this.data.pop();return this.length--,this.length>0&&(this.data[0]=u,this._down(0)),o}},pe.prototype.peek=function(){return this.data[0]},pe.prototype._up=function(o){for(var u=this.data,c=this.compare,m=u[o];o>0;){var x=o-1>>1,E=u[x];if(c(m,E)>=0)break;u[o]=E,o=x}u[o]=m},pe.prototype._down=function(o){for(var u=this.data,c=this.compare,m=this.length>>1,x=u[o];o<m;){var E=1+(o<<1),A=u[E],R=E+1;if(R<this.length&&c(u[R],A)<0&&(E=R,A=u[R]),c(A,x)>=0)break;u[o]=A,o=E}u[o]=x};var ct=Number.POSITIVE_INFINITY;function yt(o,u){return u[1]!==ct?function(c,m,x){var E=0,A=0;switch(m=Math.abs(m),x=Math.abs(x),c){case"top-right":case"top-left":case"top":A=x-7;break;case"bottom-right":case"bottom-left":case"bottom":A=7-x}switch(c){case"top-right":case"bottom-right":case"right":E=-m;break;case"top-left":case"bottom-left":case"left":E=m}return[E,A]}(o,u[0],u[1]):function(c,m){var x=0,E=0;m<0&&(m=0);var A=m/Math.sqrt(2);switch(c){case"top-right":case"top-left":E=A-7;break;case"bottom-right":case"bottom-left":E=7-A;break;case"bottom":E=7-m;break;case"top":E=m-7}switch(c){case"top-right":case"bottom-right":x=-A;break;case"top-left":case"bottom-left":x=A;break;case"left":x=m;break;case"right":x=-m}return[x,E]}(o,u[0])}function St(o){switch(o){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function He(o,u,c,m,x,E,A,R,L,V,Y,K,le,de,Ne){var I=function(ir,or,mr,Zr,qr,Bn,vn,Zn){for(var mn=Zr.layout.get("text-rotate").evaluate(Bn,{})*Math.PI/180,xi=[],ti=0,Rn=or.positionedLines;ti<Rn.length;ti+=1)for(var Mi=Rn[ti],mi=0,Hi=Mi.positionedGlyphs;mi<Hi.length;mi+=1){var Hn=Hi[mi];if(Hn.rect){var ea=Hn.rect||{},ba=4,so=!0,to=1,Fa=0,Xa=(qr||Zn)&&Hn.vertical,Jo=Hn.metrics.advance*Hn.scale/2;if(Zn&&or.verticalizable&&(Fa=Mi.lineOffset/2-(Hn.imageName?-(24-Hn.metrics.width*Hn.scale)/2:24*(Hn.scale-1))),Hn.imageName){var Vo=vn[Hn.imageName];so=Vo.sdf,ba=1/(to=Vo.pixelRatio)}var Ws=qr?[Hn.x+Jo,Hn.y]:[0,0],fs=qr?[0,0]:[Hn.x+Jo+mr[0],Hn.y+mr[1]-Fa],Os=[0,0];Xa&&(Os=fs,fs=[0,0]);var So=(Hn.metrics.left-ba)*Hn.scale-Jo+fs[0],Ea=(-Hn.metrics.top-ba)*Hn.scale+fs[1],Fi=So+ea.w*Hn.scale/to,Sa=Ea+ea.h*Hn.scale/to,pa=new ce(So,Ea),qi=new ce(Fi,Ea),hs=new ce(So,Sa),Ts=new ce(Fi,Sa);if(Xa){var Da=new ce(-Jo,Jo- -17),Ao=-Math.PI/2,ps=12-Jo,ta=new ce(22-ps,-(Hn.imageName?ps:0)),Uc=new(Function.prototype.bind.apply(ce,[null].concat(Os)));pa._rotateAround(Ao,Da)._add(ta)._add(Uc),qi._rotateAround(Ao,Da)._add(ta)._add(Uc),hs._rotateAround(Ao,Da)._add(ta)._add(Uc),Ts._rotateAround(Ao,Da)._add(ta)._add(Uc)}if(mn){var qu=Math.sin(mn),Bl=Math.cos(mn),uo=[Bl,-qu,qu,Bl];pa._matMult(uo),qi._matMult(uo),hs._matMult(uo),Ts._matMult(uo)}var Fl=new ce(0,0),Cu=new ce(0,0);xi.push({tl:pa,tr:qi,bl:hs,br:Ts,tex:ea,writingMode:or.writingMode,glyphOffset:Ws,sectionIndex:Hn.sectionIndex,isSDF:so,pixelOffsetTL:Fl,pixelOffsetBR:Cu,minFontScaleX:0,minFontScaleY:0})}}return xi}(0,c,R,x,E,A,m,o.allowVerticalPlacement),ft=o.textSizeData,tt=null;ft.kind==="source"?(tt=[128*x.layout.get("text-size").evaluate(A,{})])[0]>32640&&Qe(o.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'):ft.kind==="composite"&&((tt=[128*de.compositeTextSizes[0].evaluate(A,{},Ne),128*de.compositeTextSizes[1].evaluate(A,{},Ne)])[0]>32640||tt[1]>32640)&&Qe(o.layerIds[0]+': Value for "text-size" is >= 255. Reduce your "text-size".'),o.addSymbols(o.text,I,tt,R,E,A,V,u,L.lineStartIndex,L.lineLength,le,Ne);for(var Rt=0,zt=Y;Rt<zt.length;Rt+=1)K[zt[Rt]]=o.text.placedSymbolArray.length-1;return 4*I.length}function dt(o){for(var u in o)return o[u];return null}function Me(o,u,c,m){var x=o.compareText;if(u in x){for(var E=x[u],A=E.length-1;A>=0;A--)if(m.dist(E[A])<c)return!0}else x[u]=[];return x[u].push(m),!1}var gt=sc.VectorTileFeature.types,It=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function hr(o,u,c,m,x,E,A,R,L,V,Y,K,le){var de=R?Math.min(32640,Math.round(R[0])):0,Ne=R?Math.min(32640,Math.round(R[1])):0;o.emplaceBack(u,c,Math.round(32*m),Math.round(32*x),E,A,(de<<1)+(L?1:0),Ne,16*V,16*Y,256*K,256*le)}function Rr(o,u,c){o.emplaceBack(u.x,u.y,c),o.emplaceBack(u.x,u.y,c),o.emplaceBack(u.x,u.y,c),o.emplaceBack(u.x,u.y,c)}function Er(o){for(var u=0,c=o.sections;u<c.length;u+=1)if(Ff(c[u].text))return!0;return!1}var Cr=function(o){this.layoutVertexArray=new Zf,this.indexArray=new ss,this.programConfigurations=o,this.segments=new ye,this.dynamicLayoutVertexArray=new Rc,this.opacityVertexArray=new sf,this.placedSymbolArray=new g};Cr.prototype.isEmpty=function(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0},Cr.prototype.upload=function(o,u,c,m){this.isEmpty()||(c&&(this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,jv.members),this.indexBuffer=o.createIndexBuffer(this.indexArray,u),this.dynamicLayoutVertexBuffer=o.createVertexBuffer(this.dynamicLayoutVertexArray,Hv.members,!0),this.opacityVertexBuffer=o.createVertexBuffer(this.opacityVertexArray,It,!0),this.opacityVertexBuffer.itemSize=1),(c||m)&&this.programConfigurations.upload(o))},Cr.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy())},xn("SymbolBuffers",Cr);var On=function(o,u,c){this.layoutVertexArray=new o,this.layoutAttributes=u,this.indexArray=new c,this.segments=new ye,this.collisionVertexArray=new Ah};On.prototype.upload=function(o){this.layoutVertexBuffer=o.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=o.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=o.createVertexBuffer(this.collisionVertexArray,Hd.members,!0)},On.prototype.destroy=function(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy())},xn("CollisionBuffers",On);var En=function(o){this.collisionBoxArray=o.collisionBoxArray,this.zoom=o.zoom,this.overscaling=o.overscaling,this.layers=o.layers,this.layerIds=this.layers.map(function(E){return E.id}),this.index=o.index,this.pixelRatio=o.pixelRatio,this.sourceLayerIndex=o.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=Ko([]),this.placementViewportMatrix=Ko([]);var u=this.layers[0]._unevaluatedLayout._values;this.textSizeData=Bo(this.zoom,u["text-size"]),this.iconSizeData=Bo(this.zoom,u["icon-size"]);var c=this.layers[0].layout,m=c.get("symbol-sort-key"),x=c.get("symbol-z-order");this.canOverlap=c.get("text-allow-overlap")||c.get("icon-allow-overlap")||c.get("text-ignore-placement")||c.get("icon-ignore-placement"),this.sortFeaturesByKey=x!=="viewport-y"&&m.constantOr(1)!==void 0,this.sortFeaturesByY=(x==="viewport-y"||x==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,c.get("symbol-placement")==="point"&&(this.writingModes=c.get("text-writing-mode").map(function(E){return tr[E]})),this.stateDependentLayerIds=this.layers.filter(function(E){return E.isStateDependent()}).map(function(E){return E.id}),this.sourceID=o.sourceID};En.prototype.createArrays=function(){this.text=new Cr(new Xn(this.layers,this.zoom,function(o){return/^text/.test(o)})),this.icon=new Cr(new Xn(this.layers,this.zoom,function(o){return/^icon/.test(o)})),this.glyphOffsetArray=new C,this.lineVertexArray=new O,this.symbolInstances=new w},En.prototype.calculateGlyphDependencies=function(o,u,c,m,x){for(var E=0;E<o.length;E++)if(u[o.charCodeAt(E)]=!0,(c||m)&&x){var A=Ye[o.charAt(E)];A&&(u[A.charCodeAt(0)]=!0)}},En.prototype.populate=function(o,u,c){var m=this.layers[0],x=m.layout,E=x.get("text-font"),A=x.get("text-field"),R=x.get("icon-image"),L=(A.value.kind!=="constant"||A.value.value instanceof ca&&!A.value.value.isEmpty()||A.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),V=R.value.kind!=="constant"||!!R.value.value||Object.keys(R.parameters).length>0,Y=x.get("symbol-sort-key");if(this.features=[],L||V){for(var K=u.iconDependencies,le=u.glyphDependencies,de=u.availableImages,Ne=new Re(this.zoom),I=0,ft=o;I<ft.length;I+=1){var tt=ft[I],Rt=tt.feature,zt=tt.id,ir=tt.index,or=tt.sourceLayerIndex,mr=m._featureFilter.needGeometry,Zr=Qa(Rt,mr);if(m._featureFilter.filter(Ne,Zr,c)){mr||(Zr.geometry=Ha(Rt));var qr=void 0;if(L){var Bn=m.getValueAndResolveTokens("text-field",Zr,c,de),vn=ca.factory(Bn);Er(vn)&&(this.hasRTLText=!0),(!this.hasRTLText||Uf()==="unavailable"||this.hasRTLText&&Zt.isParsed())&&(qr=we(vn,m,Zr))}var Zn=void 0;if(V){var mn=m.getValueAndResolveTokens("icon-image",Zr,c,de);Zn=mn instanceof wa?mn:wa.fromString(mn)}if(qr||Zn){var xi=this.sortFeaturesByKey?Y.evaluate(Zr,{},c):void 0;if(this.features.push({id:zt,text:qr,icon:Zn,index:ir,sourceLayerIndex:or,geometry:Zr.geometry,properties:Rt.properties,type:gt[Rt.type],sortKey:xi}),Zn&&(K[Zn.name]=!0),qr){var ti=E.evaluate(Zr,{},c).join(","),Rn=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(tr.vertical)>=0;for(var Mi=0,mi=qr.sections;Mi<mi.length;Mi+=1){var Hi=mi[Mi];if(Hi.image)K[Hi.image.name]=!0;else{var Hn=ll(qr.toString()),ea=Hi.fontStack||ti,ba=le[ea]=le[ea]||{};this.calculateGlyphDependencies(Hi.text,ba,Rn,this.allowVerticalPlacement,Hn)}}}}}}x.get("symbol-placement")==="line"&&(this.features=function(so){var to={},Fa={},Xa=[],Jo=0;function Vo(Da){Xa.push(so[Da]),Jo++}function Ws(Da,Ao,ps){var ta=Fa[Da];return delete Fa[Da],Fa[Ao]=ta,Xa[ta].geometry[0].pop(),Xa[ta].geometry[0]=Xa[ta].geometry[0].concat(ps[0]),ta}function fs(Da,Ao,ps){var ta=to[Ao];return delete to[Ao],to[Da]=ta,Xa[ta].geometry[0].shift(),Xa[ta].geometry[0]=ps[0].concat(Xa[ta].geometry[0]),ta}function Os(Da,Ao,ps){var ta=ps?Ao[0][Ao[0].length-1]:Ao[0][0];return Da+":"+ta.x+":"+ta.y}for(var So=0;So<so.length;So++){var Ea=so[So],Fi=Ea.geometry,Sa=Ea.text?Ea.text.toString():null;if(Sa){var pa=Os(Sa,Fi),qi=Os(Sa,Fi,!0);if(pa in Fa&&qi in to&&Fa[pa]!==to[qi]){var hs=fs(pa,qi,Fi),Ts=Ws(pa,qi,Xa[hs].geometry);delete to[pa],delete Fa[qi],Fa[Os(Sa,Xa[Ts].geometry,!0)]=Ts,Xa[hs].geometry=null}else pa in Fa?Ws(pa,qi,Fi):qi in to?fs(pa,qi,Fi):(Vo(So),to[pa]=Jo-1,Fa[qi]=Jo-1)}else Vo(So)}return Xa.filter(function(Da){return Da.geometry})}(this.features)),this.sortFeaturesByKey&&this.features.sort(function(so,to){return so.sortKey-to.sortKey})}},En.prototype.update=function(o,u,c){this.stateDependentLayers.length&&(this.text.programConfigurations.updatePaintArrays(o,u,this.layers,c),this.icon.programConfigurations.updatePaintArrays(o,u,this.layers,c))},En.prototype.isEmpty=function(){return this.symbolInstances.length===0&&!this.hasRTLText},En.prototype.uploadPending=function(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload},En.prototype.upload=function(o){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(o),this.iconCollisionBox.upload(o)),this.text.upload(o,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload),this.icon.upload(o,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload),this.uploaded=!0},En.prototype.destroyDebugData=function(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()},En.prototype.destroy=function(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()},En.prototype.addToLineVertexArray=function(o,u){var c=this.lineVertexArray.length;if(o.segment!==void 0){for(var m=o.dist(u[o.segment+1]),x=o.dist(u[o.segment]),E={},A=o.segment+1;A<u.length;A++)E[A]={x:u[A].x,y:u[A].y,tileUnitDistanceFromAnchor:m},A<u.length-1&&(m+=u[A+1].dist(u[A]));for(var R=o.segment||0;R>=0;R--)E[R]={x:u[R].x,y:u[R].y,tileUnitDistanceFromAnchor:x},R>0&&(x+=u[R-1].dist(u[R]));for(var L=0;L<u.length;L++){var V=E[L];this.lineVertexArray.emplaceBack(V.x,V.y,V.tileUnitDistanceFromAnchor)}}return{lineStartIndex:c,lineLength:this.lineVertexArray.length-c}},En.prototype.addSymbols=function(o,u,c,m,x,E,A,R,L,V,Y,K){for(var le=o.indexArray,de=o.layoutVertexArray,Ne=o.segments.prepareSegment(4*u.length,de,le,this.canOverlap?E.sortKey:void 0),I=this.glyphOffsetArray.length,ft=Ne.vertexLength,tt=this.allowVerticalPlacement&&A===tr.vertical?Math.PI/2:0,Rt=E.text&&E.text.sections,zt=0;zt<u.length;zt++){var ir=u[zt],or=ir.tl,mr=ir.tr,Zr=ir.bl,qr=ir.br,Bn=ir.tex,vn=ir.pixelOffsetTL,Zn=ir.pixelOffsetBR,mn=ir.minFontScaleX,xi=ir.minFontScaleY,ti=ir.glyphOffset,Rn=ir.isSDF,Mi=ir.sectionIndex,mi=Ne.vertexLength,Hi=ti[1];hr(de,R.x,R.y,or.x,Hi+or.y,Bn.x,Bn.y,c,Rn,vn.x,vn.y,mn,xi),hr(de,R.x,R.y,mr.x,Hi+mr.y,Bn.x+Bn.w,Bn.y,c,Rn,Zn.x,vn.y,mn,xi),hr(de,R.x,R.y,Zr.x,Hi+Zr.y,Bn.x,Bn.y+Bn.h,c,Rn,vn.x,Zn.y,mn,xi),hr(de,R.x,R.y,qr.x,Hi+qr.y,Bn.x+Bn.w,Bn.y+Bn.h,c,Rn,Zn.x,Zn.y,mn,xi),Rr(o.dynamicLayoutVertexArray,R,tt),le.emplaceBack(mi,mi+1,mi+2),le.emplaceBack(mi+1,mi+2,mi+3),Ne.vertexLength+=4,Ne.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(ti[0]),zt!==u.length-1&&Mi===u[zt+1].sectionIndex||o.programConfigurations.populatePaintArrays(de.length,E,E.index,{},K,Rt&&Rt[Mi])}o.placedSymbolArray.emplaceBack(R.x,R.y,I,this.glyphOffsetArray.length-I,ft,L,V,R.segment,c?c[0]:0,c?c[1]:0,m[0],m[1],A,0,!1,0,Y)},En.prototype._addCollisionDebugVertex=function(o,u,c,m,x,E){return u.emplaceBack(0,0),o.emplaceBack(c.x,c.y,m,x,Math.round(E.x),Math.round(E.y))},En.prototype.addCollisionDebugVertices=function(o,u,c,m,x,E,A){var R=x.segments.prepareSegment(4,x.layoutVertexArray,x.indexArray),L=R.vertexLength,V=x.layoutVertexArray,Y=x.collisionVertexArray,K=A.anchorX,le=A.anchorY;this._addCollisionDebugVertex(V,Y,E,K,le,new ce(o,u)),this._addCollisionDebugVertex(V,Y,E,K,le,new ce(c,u)),this._addCollisionDebugVertex(V,Y,E,K,le,new ce(c,m)),this._addCollisionDebugVertex(V,Y,E,K,le,new ce(o,m)),R.vertexLength+=4;var de=x.indexArray;de.emplaceBack(L,L+1),de.emplaceBack(L+1,L+2),de.emplaceBack(L+2,L+3),de.emplaceBack(L+3,L),R.primitiveLength+=4},En.prototype.addDebugCollisionBoxes=function(o,u,c,m){for(var x=o;x<u;x++){var E=this.collisionBoxArray.get(x);this.addCollisionDebugVertices(E.x1,E.y1,E.x2,E.y2,m?this.textCollisionBox:this.iconCollisionBox,E.anchorPoint,c)}},En.prototype.generateCollisionDebugBuffers=function(){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new On(tc,Wd.members,ju),this.iconCollisionBox=new On(tc,Wd.members,ju);for(var o=0;o<this.symbolInstances.length;o++){var u=this.symbolInstances.get(o);this.addDebugCollisionBoxes(u.textBoxStartIndex,u.textBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u,!0),this.addDebugCollisionBoxes(u.iconBoxStartIndex,u.iconBoxEndIndex,u,!1),this.addDebugCollisionBoxes(u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex,u,!1)}},En.prototype._deserializeCollisionBoxesForSymbol=function(o,u,c,m,x,E,A,R,L){for(var V={},Y=u;Y<c;Y++){var K=o.get(Y);V.textBox={x1:K.x1,y1:K.y1,x2:K.x2,y2:K.y2,anchorPointX:K.anchorPointX,anchorPointY:K.anchorPointY},V.textFeatureIndex=K.featureIndex;break}for(var le=m;le<x;le++){var de=o.get(le);V.verticalTextBox={x1:de.x1,y1:de.y1,x2:de.x2,y2:de.y2,anchorPointX:de.anchorPointX,anchorPointY:de.anchorPointY},V.verticalTextFeatureIndex=de.featureIndex;break}for(var Ne=E;Ne<A;Ne++){var I=o.get(Ne);V.iconBox={x1:I.x1,y1:I.y1,x2:I.x2,y2:I.y2,anchorPointX:I.anchorPointX,anchorPointY:I.anchorPointY},V.iconFeatureIndex=I.featureIndex;break}for(var ft=R;ft<L;ft++){var tt=o.get(ft);V.verticalIconBox={x1:tt.x1,y1:tt.y1,x2:tt.x2,y2:tt.y2,anchorPointX:tt.anchorPointX,anchorPointY:tt.anchorPointY},V.verticalIconFeatureIndex=tt.featureIndex;break}return V},En.prototype.deserializeCollisionBoxes=function(o){this.collisionArrays=[];for(var u=0;u<this.symbolInstances.length;u++){var c=this.symbolInstances.get(u);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(o,c.textBoxStartIndex,c.textBoxEndIndex,c.verticalTextBoxStartIndex,c.verticalTextBoxEndIndex,c.iconBoxStartIndex,c.iconBoxEndIndex,c.verticalIconBoxStartIndex,c.verticalIconBoxEndIndex))}},En.prototype.hasTextData=function(){return this.text.segments.get().length>0},En.prototype.hasIconData=function(){return this.icon.segments.get().length>0},En.prototype.hasDebugData=function(){return this.textCollisionBox&&this.iconCollisionBox},En.prototype.hasTextCollisionBoxData=function(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0},En.prototype.hasIconCollisionBoxData=function(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0},En.prototype.addIndicesForPlacedSymbol=function(o,u){for(var c=o.placedSymbolArray.get(u),m=c.vertexStartIndex+4*c.numGlyphs,x=c.vertexStartIndex;x<m;x+=4)o.indexArray.emplaceBack(x,x+1,x+2),o.indexArray.emplaceBack(x+1,x+2,x+3)},En.prototype.getSortedSymbolIndexes=function(o){if(this.sortedAngle===o&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;for(var u=Math.sin(o),c=Math.cos(o),m=[],x=[],E=[],A=0;A<this.symbolInstances.length;++A){E.push(A);var R=this.symbolInstances.get(A);m.push(0|Math.round(u*R.anchorX+c*R.anchorY)),x.push(R.featureIndex)}return E.sort(function(L,V){return m[L]-m[V]||x[V]-x[L]}),E},En.prototype.addToSortKeyRanges=function(o,u){var c=this.sortKeyRanges[this.sortKeyRanges.length-1];c&&c.sortKey===u?c.symbolInstanceEnd=o+1:this.sortKeyRanges.push({sortKey:u,symbolInstanceStart:o,symbolInstanceEnd:o+1})},En.prototype.sortFeatures=function(o){var u=this;if(this.sortFeaturesByY&&this.sortedAngle!==o&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(o),this.sortedAngle=o,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(var c=0,m=this.symbolInstanceIndexes;c<m.length;c+=1){var x=this.symbolInstances.get(m[c]);this.featureSortOrder.push(x.featureIndex),[x.rightJustifiedTextSymbolIndex,x.centerJustifiedTextSymbolIndex,x.leftJustifiedTextSymbolIndex].forEach(function(E,A,R){E>=0&&R.indexOf(E)===A&&u.addIndicesForPlacedSymbol(u.text,E)}),x.verticalPlacedTextSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.text,x.verticalPlacedTextSymbolIndex),x.placedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.placedIconSymbolIndex),x.verticalPlacedIconSymbolIndex>=0&&this.addIndicesForPlacedSymbol(this.icon,x.verticalPlacedIconSymbolIndex)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}},xn("SymbolBucket",En,{omit:["layers","collisionBoxArray","features","compareText"]}),En.MAX_GLYPHS=65535,En.addDynamicAttributes=Rr;var Tn=new Ba({"symbol-placement":new Dn(j.layout_symbol["symbol-placement"]),"symbol-spacing":new Dn(j.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Dn(j.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new An(j.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Dn(j.layout_symbol["symbol-z-order"]),"icon-allow-overlap":new Dn(j.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Dn(j.layout_symbol["icon-ignore-placement"]),"icon-optional":new Dn(j.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Dn(j.layout_symbol["icon-rotation-alignment"]),"icon-size":new An(j.layout_symbol["icon-size"]),"icon-text-fit":new Dn(j.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Dn(j.layout_symbol["icon-text-fit-padding"]),"icon-image":new An(j.layout_symbol["icon-image"]),"icon-rotate":new An(j.layout_symbol["icon-rotate"]),"icon-padding":new Dn(j.layout_symbol["icon-padding"]),"icon-keep-upright":new Dn(j.layout_symbol["icon-keep-upright"]),"icon-offset":new An(j.layout_symbol["icon-offset"]),"icon-anchor":new An(j.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Dn(j.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Dn(j.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Dn(j.layout_symbol["text-rotation-alignment"]),"text-field":new An(j.layout_symbol["text-field"]),"text-font":new An(j.layout_symbol["text-font"]),"text-size":new An(j.layout_symbol["text-size"]),"text-max-width":new An(j.layout_symbol["text-max-width"]),"text-line-height":new Dn(j.layout_symbol["text-line-height"]),"text-letter-spacing":new An(j.layout_symbol["text-letter-spacing"]),"text-justify":new An(j.layout_symbol["text-justify"]),"text-radial-offset":new An(j.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Dn(j.layout_symbol["text-variable-anchor"]),"text-anchor":new An(j.layout_symbol["text-anchor"]),"text-max-angle":new Dn(j.layout_symbol["text-max-angle"]),"text-writing-mode":new Dn(j.layout_symbol["text-writing-mode"]),"text-rotate":new An(j.layout_symbol["text-rotate"]),"text-padding":new Dn(j.layout_symbol["text-padding"]),"text-keep-upright":new Dn(j.layout_symbol["text-keep-upright"]),"text-transform":new An(j.layout_symbol["text-transform"]),"text-offset":new An(j.layout_symbol["text-offset"]),"text-allow-overlap":new Dn(j.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Dn(j.layout_symbol["text-ignore-placement"]),"text-optional":new Dn(j.layout_symbol["text-optional"])}),Yn={paint:new Ba({"icon-opacity":new An(j.paint_symbol["icon-opacity"]),"icon-color":new An(j.paint_symbol["icon-color"]),"icon-halo-color":new An(j.paint_symbol["icon-halo-color"]),"icon-halo-width":new An(j.paint_symbol["icon-halo-width"]),"icon-halo-blur":new An(j.paint_symbol["icon-halo-blur"]),"icon-translate":new Dn(j.paint_symbol["icon-translate"]),"icon-translate-anchor":new Dn(j.paint_symbol["icon-translate-anchor"]),"text-opacity":new An(j.paint_symbol["text-opacity"]),"text-color":new An(j.paint_symbol["text-color"],{runtimeType:Vr,getOverride:function(o){return o.textColor},hasOverride:function(o){return!!o.textColor}}),"text-halo-color":new An(j.paint_symbol["text-halo-color"]),"text-halo-width":new An(j.paint_symbol["text-halo-width"]),"text-halo-blur":new An(j.paint_symbol["text-halo-blur"]),"text-translate":new Dn(j.paint_symbol["text-translate"]),"text-translate-anchor":new Dn(j.paint_symbol["text-translate-anchor"])}),layout:Tn},ni=function(o){this.type=o.property.overrides?o.property.overrides.runtimeType:Qr,this.defaultValue=o};ni.prototype.evaluate=function(o){if(o.formattedSection){var u=this.defaultValue.property.overrides;if(u&&u.hasOverride(o.formattedSection))return u.getOverride(o.formattedSection)}return o.feature&&o.featureState?this.defaultValue.evaluate(o.feature,o.featureState):this.defaultValue.property.specification.default},ni.prototype.eachChild=function(o){this.defaultValue.isConstant()||o(this.defaultValue.value._styleExpression.expression)},ni.prototype.outputDefined=function(){return!1},ni.prototype.serialize=function(){return null},xn("FormatSectionOverride",ni,{omit:["defaultValue"]});var aa=function(o){function u(c){o.call(this,c,Yn)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.recalculate=function(c,m){if(o.prototype.recalculate.call(this,c,m),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment")),this.layout.get("symbol-placement")==="point"){var x=this.layout.get("text-writing-mode");if(x){for(var E=[],A=0,R=x;A<R.length;A+=1){var L=R[A];E.indexOf(L)<0&&E.push(L)}this.layout._values["text-writing-mode"]=E}else this.layout._values["text-writing-mode"]=["horizontal"]}this._setPaintOverrides()},u.prototype.getValueAndResolveTokens=function(c,m,x,E){var A=this.layout.get(c).evaluate(m,{},x,E),R=this._unevaluatedLayout._values[c];return R.isDataDriven()||Uu(R.value)||!A?A:function(L,V){return V.replace(/{([^{}]+)}/g,function(Y,K){return K in L?String(L[K]):""})}(m.properties,A)},u.prototype.createBucket=function(c){return new En(c)},u.prototype.queryRadius=function(){return 0},u.prototype.queryIntersectsFeature=function(){return!1},u.prototype._setPaintOverrides=function(){for(var c=0,m=Yn.paint.overridableProperties;c<m.length;c+=1){var x=m[c];if(u.hasPaintOverride(this.layout,x)){var E,A=this.paint.get(x),R=new ni(A),L=new $l(R,A.property.specification);E=A.value.kind==="constant"||A.value.kind==="source"?new bc("source",L):new Yl("composite",L,A.value.zoomStops,A.value._interpolationType),this.paint._values[x]=new Ro(A.property,E,A.parameters)}}},u.prototype._handleOverridablePaintPropertyUpdate=function(c,m,x){return!(!this.layout||m.isDataDriven()||x.isDataDriven())&&u.hasPaintOverride(this.layout,c)},u.hasPaintOverride=function(c,m){var x=c.get("text-field"),E=Yn.paint.properties[m],A=!1,R=function(Y){for(var K=0,le=Y;K<le.length;K+=1)if(E.overrides&&E.overrides.hasOverride(le[K]))return void(A=!0)};if(x.value.kind==="constant"&&x.value.value instanceof ca)R(x.value.value.sections);else if(x.value.kind==="source"){var L=function(Y){A||(Y instanceof ka&&Ca(Y.value)===Vi?R(Y.value.sections):Y instanceof ns?R(Y.sections):Y.eachChild(L))},V=x.value;V._styleExpression&&L(V._styleExpression.expression)}return A},u}(tu),Fo={paint:new Ba({"background-color":new Dn(j.paint_background["background-color"]),"background-pattern":new os(j.paint_background["background-pattern"]),"background-opacity":new Dn(j.paint_background["background-opacity"])})},$u=function(o){function u(c){o.call(this,c,Fo)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(tu),bp={paint:new Ba({"raster-opacity":new Dn(j.paint_raster["raster-opacity"]),"raster-hue-rotate":new Dn(j.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Dn(j.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Dn(j.paint_raster["raster-brightness-max"]),"raster-saturation":new Dn(j.paint_raster["raster-saturation"]),"raster-contrast":new Dn(j.paint_raster["raster-contrast"]),"raster-resampling":new Dn(j.paint_raster["raster-resampling"]),"raster-fade-duration":new Dn(j.paint_raster["raster-fade-duration"])})},Yu=function(o){function u(c){o.call(this,c,bp)}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u}(tu),ed=function(o){function u(c){o.call(this,c,{}),this.implementation=c}return o&&(u.__proto__=o),(u.prototype=Object.create(o&&o.prototype)).constructor=u,u.prototype.is3D=function(){return this.implementation.renderingMode==="3d"},u.prototype.hasOffscreenPass=function(){return this.implementation.prerender!==void 0},u.prototype.recalculate=function(){},u.prototype.updateTransitions=function(){},u.prototype.hasTransition=function(){},u.prototype.serialize=function(){},u.prototype.onAdd=function(c){this.implementation.onAdd&&this.implementation.onAdd(c,c.painter.context.gl)},u.prototype.onRemove=function(c){this.implementation.onRemove&&this.implementation.onRemove(c,c.painter.context.gl)},u}(tu),Ll={circle:Ch,heatmap:dl,hillshade:ag,fill:gp,"fill-extrusion":Yp,line:qf,symbol:aa,background:$u,raster:Yu},td=oe.HTMLImageElement,ff=oe.HTMLCanvasElement,Kf=oe.HTMLVideoElement,rd=oe.ImageData,Qo=oe.ImageBitmap,Dh=function(o,u,c,m){this.context=o,this.format=c,this.texture=o.gl.createTexture(),this.update(u,m)};Dh.prototype.update=function(o,u,c){var m=o.width,x=o.height,E=!(this.size&&this.size[0]===m&&this.size[1]===x||c),A=this.context,R=A.gl;if(this.useMipmap=!!(u&&u.useMipmap),R.bindTexture(R.TEXTURE_2D,this.texture),A.pixelStoreUnpackFlipY.set(!1),A.pixelStoreUnpack.set(1),A.pixelStoreUnpackPremultiplyAlpha.set(this.format===R.RGBA&&(!u||u.premultiply!==!1)),E)this.size=[m,x],o instanceof td||o instanceof ff||o instanceof Kf||o instanceof rd||Qo&&o instanceof Qo?R.texImage2D(R.TEXTURE_2D,0,this.format,this.format,R.UNSIGNED_BYTE,o):R.texImage2D(R.TEXTURE_2D,0,this.format,m,x,0,this.format,R.UNSIGNED_BYTE,o.data);else{var L=c||{x:0,y:0},V=L.x,Y=L.y;o instanceof td||o instanceof ff||o instanceof Kf||o instanceof rd||Qo&&o instanceof Qo?R.texSubImage2D(R.TEXTURE_2D,0,V,Y,R.RGBA,R.UNSIGNED_BYTE,o):R.texSubImage2D(R.TEXTURE_2D,0,V,Y,m,x,R.RGBA,R.UNSIGNED_BYTE,o.data)}this.useMipmap&&this.isSizePowerOfTwo()&&R.generateMipmap(R.TEXTURE_2D)},Dh.prototype.bind=function(o,u,c){var m=this.context.gl;m.bindTexture(m.TEXTURE_2D,this.texture),c!==m.LINEAR_MIPMAP_NEAREST||this.isSizePowerOfTwo()||(c=m.LINEAR),o!==this.filter&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MAG_FILTER,o),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_MIN_FILTER,c||o),this.filter=o),u!==this.wrap&&(m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_S,u),m.texParameteri(m.TEXTURE_2D,m.TEXTURE_WRAP_T,u),this.wrap=u)},Dh.prototype.isSizePowerOfTwo=function(){return this.size[0]===this.size[1]&&Math.log(this.size[0])/Math.LN2%1==0},Dh.prototype.destroy=function(){this.context.gl.deleteTexture(this.texture),this.texture=null};var Wv=function(o){var u=this;this._callback=o,this._triggered=!1,typeof MessageChannel!="undefined"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=function(){u._triggered=!1,u._callback()})};Wv.prototype.trigger=function(){var o=this;this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(function(){o._triggered=!1,o._callback()},0))},Wv.prototype.remove=function(){delete this._channel,this._callback=function(){}};var Lh=function(o,u,c){this.target=o,this.parent=u,this.mapId=c,this.callbacks={},this.tasks={},this.taskQueue=[],this.cancelCallbacks={},wr(["receive","process"],this),this.invoker=new Wv(this.process),this.target.addEventListener("message",this.receive,!1),this.globalScope=ie()?o:oe};function Gv(o,u,c){var m=2*Math.PI*6378137/256/Math.pow(2,c);return[o*m-2*Math.PI*6378137/2,u*m-2*Math.PI*6378137/2]}Lh.prototype.send=function(o,u,c,m,x){var E=this;x===void 0&&(x=!1);var A=Math.round(1e18*Math.random()).toString(36).substring(0,10);c&&(this.callbacks[A]=c);var R=Oe(this.globalScope)?void 0:[];return this.target.postMessage({id:A,type:o,hasCallback:!!c,targetMapId:m,mustQueue:x,sourceMapId:this.mapId,data:is(u,R)},R),{cancel:function(){c&&delete E.callbacks[A],E.target.postMessage({id:A,type:"<cancel>",targetMapId:m,sourceMapId:E.mapId})}}},Lh.prototype.receive=function(o){var u=o.data,c=u.id;if(c&&(!u.targetMapId||this.mapId===u.targetMapId))if(u.type==="<cancel>"){delete this.tasks[c];var m=this.cancelCallbacks[c];delete this.cancelCallbacks[c],m&&m()}else ie()||u.mustQueue?(this.tasks[c]=u,this.taskQueue.push(c),this.invoker.trigger()):this.processTask(c,u)},Lh.prototype.process=function(){if(this.taskQueue.length){var o=this.taskQueue.shift(),u=this.tasks[o];delete this.tasks[o],this.taskQueue.length&&this.invoker.trigger(),u&&this.processTask(o,u)}},Lh.prototype.processTask=function(o,u){var c=this;if(u.type==="<response>"){var m=this.callbacks[o];delete this.callbacks[o],m&&(u.error?m(ha(u.error)):m(null,ha(u.data)))}else{var x=!1,E=Oe(this.globalScope)?void 0:[],A=u.hasCallback?function(Y,K){x=!0,delete c.cancelCallbacks[o],c.target.postMessage({id:o,type:"<response>",sourceMapId:c.mapId,error:Y?is(Y):null,data:is(K,E)},E)}:function(Y){x=!0},R=null,L=ha(u.data);if(this.parent[u.type])R=this.parent[u.type](u.sourceMapId,L,A);else if(this.parent.getWorkerSource){var V=u.type.split(".");R=this.parent.getWorkerSource(u.sourceMapId,V[0],L.source)[V[1]](L,A)}else A(new Error("Could not find function "+u.type));!x&&R&&R.cancel&&(this.cancelCallbacks[o]=R.cancel)}},Lh.prototype.remove=function(){this.invoker.remove(),this.target.removeEventListener("message",this.receive,!1)};var Zo=function(o,u){o&&(u?this.setSouthWest(o).setNorthEast(u):o.length===4?this.setSouthWest([o[0],o[1]]).setNorthEast([o[2],o[3]]):this.setSouthWest(o[0]).setNorthEast(o[1]))};Zo.prototype.setNorthEast=function(o){return this._ne=o instanceof Ga?new Ga(o.lng,o.lat):Ga.convert(o),this},Zo.prototype.setSouthWest=function(o){return this._sw=o instanceof Ga?new Ga(o.lng,o.lat):Ga.convert(o),this},Zo.prototype.extend=function(o){var u,c,m=this._sw,x=this._ne;if(o instanceof Ga)u=o,c=o;else{if(!(o instanceof Zo))return Array.isArray(o)?o.length===4||o.every(Array.isArray)?this.extend(Zo.convert(o)):this.extend(Ga.convert(o)):this;if(c=o._ne,!(u=o._sw)||!c)return this}return m||x?(m.lng=Math.min(u.lng,m.lng),m.lat=Math.min(u.lat,m.lat),x.lng=Math.max(c.lng,x.lng),x.lat=Math.max(c.lat,x.lat)):(this._sw=new Ga(u.lng,u.lat),this._ne=new Ga(c.lng,c.lat)),this},Zo.prototype.getCenter=function(){return new Ga((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)},Zo.prototype.getSouthWest=function(){return this._sw},Zo.prototype.getNorthEast=function(){return this._ne},Zo.prototype.getNorthWest=function(){return new Ga(this.getWest(),this.getNorth())},Zo.prototype.getSouthEast=function(){return new Ga(this.getEast(),this.getSouth())},Zo.prototype.getWest=function(){return this._sw.lng},Zo.prototype.getSouth=function(){return this._sw.lat},Zo.prototype.getEast=function(){return this._ne.lng},Zo.prototype.getNorth=function(){return this._ne.lat},Zo.prototype.toArray=function(){return[this._sw.toArray(),this._ne.toArray()]},Zo.prototype.toString=function(){return"LngLatBounds("+this._sw.toString()+", "+this._ne.toString()+")"},Zo.prototype.isEmpty=function(){return!(this._sw&&this._ne)},Zo.prototype.contains=function(o){var u=Ga.convert(o),c=u.lng,m=u.lat,x=this._sw.lng<=c&&c<=this._ne.lng;return this._sw.lng>this._ne.lng&&(x=this._sw.lng>=c&&c>=this._ne.lng),this._sw.lat<=m&&m<=this._ne.lat&&x},Zo.convert=function(o){return!o||o instanceof Zo?o:new Zo(o)};var Ga=function(o,u){if(isNaN(o)||isNaN(u))throw new Error("Invalid LngLat object: ("+o+", "+u+")");if(this.lng=+o,this.lat=+u,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")};Ga.prototype.wrap=function(){return new Ga(bt(this.lng,-180,180),this.lat)},Ga.prototype.toArray=function(){return[this.lng,this.lat]},Ga.prototype.toString=function(){return"LngLat("+this.lng+", "+this.lat+")"},Ga.prototype.distanceTo=function(o){var u=Math.PI/180,c=this.lat*u,m=o.lat*u,x=Math.sin(c)*Math.sin(m)+Math.cos(c)*Math.cos(m)*Math.cos((o.lng-this.lng)*u);return 63710088e-1*Math.acos(Math.min(x,1))},Ga.prototype.toBounds=function(o){o===void 0&&(o=0);var u=360*o/40075017,c=u/Math.cos(Math.PI/180*this.lat);return new Zo(new Ga(this.lng-c,this.lat-u),new Ga(this.lng+c,this.lat+u))},Ga.convert=function(o){if(o instanceof Ga)return o;if(Array.isArray(o)&&(o.length===2||o.length===3))return new Ga(Number(o[0]),Number(o[1]));if(!Array.isArray(o)&&typeof o=="object"&&o!==null)return new Ga(Number("lng"in o?o.lng:o.lon),Number(o.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")};var sg=2*Math.PI*63710088e-1;function ug(o){return sg*Math.cos(o*Math.PI/180)}function ki(o){return(180+o)/360}function Pi(o){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+o*Math.PI/360)))/360}function Bh(o,u){return o/ug(u)}function nd(o){return 360/Math.PI*Math.atan(Math.exp((180-360*o)*Math.PI/180))-90}var Fh=function(o,u,c){c===void 0&&(c=0),this.x=+o,this.y=+u,this.z=+c};Fh.fromLngLat=function(o,u){u===void 0&&(u=0);var c=Ga.convert(o);return new Fh(ki(c.lng),Pi(c.lat),Bh(u,c.lat))},Fh.prototype.toLngLat=function(){return new Ga(360*this.x-180,nd(this.y))},Fh.prototype.toAltitude=function(){return this.z*ug(nd(this.y))},Fh.prototype.meterInMercatorCoordinateUnits=function(){return 1/sg*(o=nd(this.y),1/Math.cos(o*Math.PI/180));var o};var Qf=function(o,u,c){this.z=o,this.x=u,this.y=c,this.key=uc(0,o,o,u,c)};Qf.prototype.equals=function(o){return this.z===o.z&&this.x===o.x&&this.y===o.y},Qf.prototype.url=function(o,u){var c,m,x,E,A,R=(m=this.y,x=this.z,E=Gv(256*(c=this.x),256*(m=Math.pow(2,x)-m-1),x),A=Gv(256*(c+1),256*(m+1),x),E[0]+","+E[1]+","+A[0]+","+A[1]),L=function(V,Y,K){for(var le,de="",Ne=V;Ne>0;Ne--)de+=(Y&(le=1<<Ne-1)?1:0)+(K&le?2:0);return de}(this.z,this.x,this.y);return o[(this.x+this.y)%o.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace("{z}",String(this.z)).replace("{x}",String(this.x)).replace("{y}",String(u==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",L).replace("{bbox-epsg-3857}",R)},Qf.prototype.getTilePoint=function(o){var u=Math.pow(2,this.z);return new ce(8192*(o.x*u-this.x),8192*(o.y*u-this.y))},Qf.prototype.toString=function(){return this.z+"/"+this.x+"/"+this.y};var Xv=function(o,u){this.wrap=o,this.canonical=u,this.key=uc(o,u.z,u.z,u.x,u.y)},eo=function(o,u,c,m,x){this.overscaledZ=o,this.wrap=u,this.canonical=new Qf(c,+m,+x),this.key=uc(u,o,c,m,x)};function uc(o,u,c,m,x){(o*=2)<0&&(o=-1*o-1);var E=1<<c;return(E*E*o+E*x+m).toString(36)+c.toString(36)+u.toString(36)}eo.prototype.equals=function(o){return this.overscaledZ===o.overscaledZ&&this.wrap===o.wrap&&this.canonical.equals(o.canonical)},eo.prototype.scaledTo=function(o){var u=this.canonical.z-o;return o>this.canonical.z?new eo(o,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new eo(o,this.wrap,o,this.canonical.x>>u,this.canonical.y>>u)},eo.prototype.calculateScaledKey=function(o,u){var c=this.canonical.z-o;return o>this.canonical.z?uc(this.wrap*+u,o,this.canonical.z,this.canonical.x,this.canonical.y):uc(this.wrap*+u,o,o,this.canonical.x>>c,this.canonical.y>>c)},eo.prototype.isChildOf=function(o){if(o.wrap!==this.wrap)return!1;var u=this.canonical.z-o.canonical.z;return o.overscaledZ===0||o.overscaledZ<this.overscaledZ&&o.canonical.x===this.canonical.x>>u&&o.canonical.y===this.canonical.y>>u},eo.prototype.children=function(o){if(this.overscaledZ>=o)return[new eo(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];var u=this.canonical.z+1,c=2*this.canonical.x,m=2*this.canonical.y;return[new eo(u,this.wrap,u,c,m),new eo(u,this.wrap,u,c+1,m),new eo(u,this.wrap,u,c,m+1),new eo(u,this.wrap,u,c+1,m+1)]},eo.prototype.isLessThan=function(o){return this.wrap<o.wrap||!(this.wrap>o.wrap)&&(this.overscaledZ<o.overscaledZ||!(this.overscaledZ>o.overscaledZ)&&(this.canonical.x<o.canonical.x||!(this.canonical.x>o.canonical.x)&&this.canonical.y<o.canonical.y))},eo.prototype.wrapped=function(){return new eo(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)},eo.prototype.unwrapTo=function(o){return new eo(this.overscaledZ,o,this.canonical.z,this.canonical.x,this.canonical.y)},eo.prototype.overscaleFactor=function(){return Math.pow(2,this.overscaledZ-this.canonical.z)},eo.prototype.toUnwrapped=function(){return new Xv(this.wrap,this.canonical)},eo.prototype.toString=function(){return this.overscaledZ+"/"+this.canonical.x+"/"+this.canonical.y},eo.prototype.getTilePoint=function(o){return this.canonical.getTilePoint(new Fh(o.x-this.wrap,o.y))},xn("CanonicalTileID",Qf),xn("OverscaledTileID",eo,{omit:["posMatrix"]});var Nc=function(o,u,c){if(this.uid=o,u.height!==u.width)throw new RangeError("DEM tiles must be square");if(c&&c!=="mapbox"&&c!=="terrarium")return Qe('"'+c+'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".');this.stride=u.height;var m=this.dim=u.height-2;this.data=new Uint32Array(u.data.buffer),this.encoding=c||"mapbox";for(var x=0;x<m;x++)this.data[this._idx(-1,x)]=this.data[this._idx(0,x)],this.data[this._idx(m,x)]=this.data[this._idx(m-1,x)],this.data[this._idx(x,-1)]=this.data[this._idx(x,0)],this.data[this._idx(x,m)]=this.data[this._idx(x,m-1)];this.data[this._idx(-1,-1)]=this.data[this._idx(0,0)],this.data[this._idx(m,-1)]=this.data[this._idx(m-1,0)],this.data[this._idx(-1,m)]=this.data[this._idx(0,m-1)],this.data[this._idx(m,m)]=this.data[this._idx(m-1,m-1)]};Nc.prototype.get=function(o,u){var c=new Uint8Array(this.data.buffer),m=4*this._idx(o,u);return(this.encoding==="terrarium"?this._unpackTerrarium:this._unpackMapbox)(c[m],c[m+1],c[m+2])},Nc.prototype.getUnpackVector=function(){return this.encoding==="terrarium"?[256,1,1/256,32768]:[6553.6,25.6,.1,1e4]},Nc.prototype._idx=function(o,u){if(o<-1||o>=this.dim+1||u<-1||u>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(u+1)*this.stride+(o+1)},Nc.prototype._unpackMapbox=function(o,u,c){return(256*o*256+256*u+c)/10-1e4},Nc.prototype._unpackTerrarium=function(o,u,c){return 256*o+u+c/256-32768},Nc.prototype.getPixels=function(){return new Do({width:this.stride,height:this.stride},new Uint8Array(this.data.buffer))},Nc.prototype.backfillBorder=function(o,u,c){if(this.dim!==o.dim)throw new Error("dem dimension mismatch");var m=u*this.dim,x=u*this.dim+this.dim,E=c*this.dim,A=c*this.dim+this.dim;switch(u){case-1:m=x-1;break;case 1:x=m+1}switch(c){case-1:E=A-1;break;case 1:A=E+1}for(var R=-u*this.dim,L=-c*this.dim,V=E;V<A;V++)for(var Y=m;Y<x;Y++)this.data[this._idx(Y,V)]=o.data[this._idx(Y+R,V+L)]},xn("DEMData",Nc);var id=function(o){this._stringToNumber={},this._numberToString=[];for(var u=0;u<o.length;u++){var c=o[u];this._stringToNumber[c]=u,this._numberToString[u]=c}};id.prototype.encode=function(o){return this._stringToNumber[o]},id.prototype.decode=function(o){return this._numberToString[o]};var ad=function(o,u,c,m,x){this.type="Feature",this._vectorTileFeature=o,o._z=u,o._x=c,o._y=m,this.properties=o.properties,this.id=x},od={geometry:{configurable:!0}};od.geometry.get=function(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._vectorTileFeature._x,this._vectorTileFeature._y,this._vectorTileFeature._z).geometry),this._geometry},od.geometry.set=function(o){this._geometry=o},ad.prototype.toJSON=function(){var o={geometry:this.geometry};for(var u in this)u!=="_geometry"&&u!=="_vectorTileFeature"&&(o[u]=this[u]);return o},Object.defineProperties(ad.prototype,od);var Nh=function(){this.state={},this.stateChanges={},this.deletedStates={}};Nh.prototype.updateState=function(o,u,c){var m=String(u);if(this.stateChanges[o]=this.stateChanges[o]||{},this.stateChanges[o][m]=this.stateChanges[o][m]||{},Et(this.stateChanges[o][m],c),this.deletedStates[o]===null)for(var x in this.deletedStates[o]={},this.state[o])x!==m&&(this.deletedStates[o][x]=null);else if(this.deletedStates[o]&&this.deletedStates[o][m]===null)for(var E in this.deletedStates[o][m]={},this.state[o][m])c[E]||(this.deletedStates[o][m][E]=null);else for(var A in c)this.deletedStates[o]&&this.deletedStates[o][m]&&this.deletedStates[o][m][A]===null&&delete this.deletedStates[o][m][A]},Nh.prototype.removeFeatureState=function(o,u,c){if(this.deletedStates[o]!==null){var m=String(u);if(this.deletedStates[o]=this.deletedStates[o]||{},c&&u!==void 0)this.deletedStates[o][m]!==null&&(this.deletedStates[o][m]=this.deletedStates[o][m]||{},this.deletedStates[o][m][c]=null);else if(u!==void 0)if(this.stateChanges[o]&&this.stateChanges[o][m])for(c in this.deletedStates[o][m]={},this.stateChanges[o][m])this.deletedStates[o][m][c]=null;else this.deletedStates[o][m]=null;else this.deletedStates[o]=null}},Nh.prototype.getState=function(o,u){var c=String(u),m=Et({},(this.state[o]||{})[c],(this.stateChanges[o]||{})[c]);if(this.deletedStates[o]===null)return{};if(this.deletedStates[o]){var x=this.deletedStates[o][u];if(x===null)return{};for(var E in x)delete m[E]}return m},Nh.prototype.initializeTileState=function(o,u){o.setFeatureState(this.state,u)},Nh.prototype.coalesceChanges=function(o,u){var c={};for(var m in this.stateChanges){this.state[m]=this.state[m]||{};var x={};for(var E in this.stateChanges[m])this.state[m][E]||(this.state[m][E]={}),Et(this.state[m][E],this.stateChanges[m][E]),x[E]=this.state[m][E];c[m]=x}for(var A in this.deletedStates){this.state[A]=this.state[A]||{};var R={};if(this.deletedStates[A]===null)for(var L in this.state[A])R[L]={},this.state[A][L]={};else for(var V in this.deletedStates[A]){if(this.deletedStates[A][V]===null)this.state[A][V]={};else for(var Y=0,K=Object.keys(this.deletedStates[A][V]);Y<K.length;Y+=1)delete this.state[A][V][K[Y]];R[V]=this.state[A][V]}c[A]=c[A]||{},Et(c[A],R)}if(this.stateChanges={},this.deletedStates={},Object.keys(c).length!==0)for(var le in o)o[le].setFeatureState(c,u)};var hf=function(o,u){this.tileID=o,this.x=o.canonical.x,this.y=o.canonical.y,this.z=o.canonical.z,this.grid=new Co(8192,16,0),this.grid3D=new Co(8192,16,0),this.featureIndexArray=new J,this.promoteId=u};function lg(o,u,c,m,x){return lr(o,function(E,A){var R=u instanceof _s?u.get(A):null;return R&&R.evaluate?R.evaluate(c,m,x):R})}function $v(o){for(var u=1/0,c=1/0,m=-1/0,x=-1/0,E=0,A=o;E<A.length;E+=1){var R=A[E];u=Math.min(u,R.x),c=Math.min(c,R.y),m=Math.max(m,R.x),x=Math.max(x,R.y)}return{minX:u,minY:c,maxX:m,maxY:x}}function cg(o,u){return u-o}hf.prototype.insert=function(o,u,c,m,x,E){var A=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(c,m,x);for(var R=E?this.grid3D:this.grid,L=0;L<u.length;L++){for(var V=u[L],Y=[1/0,1/0,-1/0,-1/0],K=0;K<V.length;K++){var le=V[K];Y[0]=Math.min(Y[0],le.x),Y[1]=Math.min(Y[1],le.y),Y[2]=Math.max(Y[2],le.x),Y[3]=Math.max(Y[3],le.y)}Y[0]<8192&&Y[1]<8192&&Y[2]>=0&&Y[3]>=0&&R.insert(A,Y[0],Y[1],Y[2],Y[3])}},hf.prototype.loadVTLayers=function(){return this.vtLayers||(this.vtLayers=new sc.VectorTile(new er(this.rawTileData)).layers,this.sourceLayerCoder=new id(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"])),this.vtLayers},hf.prototype.query=function(o,u,c,m){var x=this;this.loadVTLayers();for(var E=o.params||{},A=8192/o.tileSize/o.scale,R=sl(E.filter),L=o.queryGeometry,V=o.queryPadding*A,Y=$v(L),K=this.grid.query(Y.minX-V,Y.minY-V,Y.maxX+V,Y.maxY+V),le=$v(o.cameraQueryGeometry),de=this.grid3D.query(le.minX-V,le.minY-V,le.maxX+V,le.maxY+V,function(ir,or,mr,Zr){return function(qr,Bn,vn,Zn,mn){for(var xi=0,ti=qr;xi<ti.length;xi+=1){var Rn=ti[xi];if(Bn<=Rn.x&&vn<=Rn.y&&Zn>=Rn.x&&mn>=Rn.y)return!0}var Mi=[new ce(Bn,vn),new ce(Bn,mn),new ce(Zn,mn),new ce(Zn,vn)];if(qr.length>2){for(var mi=0,Hi=Mi;mi<Hi.length;mi+=1)if(cu(qr,Hi[mi]))return!0}for(var Hn=0;Hn<qr.length-1;Hn++)if(pl(qr[Hn],qr[Hn+1],Mi))return!0;return!1}(o.cameraQueryGeometry,ir-V,or-V,mr+V,Zr+V)}),Ne=0,I=de;Ne<I.length;Ne+=1)K.push(I[Ne]);K.sort(cg);for(var ft,tt={},Rt=function(ir){var or=K[ir];if(or!==ft){ft=or;var mr=x.featureIndexArray.get(or),Zr=null;x.loadMatchingFeature(tt,mr.bucketIndex,mr.sourceLayerIndex,mr.featureIndex,R,E.layers,E.availableImages,u,c,m,function(qr,Bn,vn){return Zr||(Zr=Ha(qr)),Bn.queryIntersectsFeature(L,qr,vn,Zr,x.z,o.transform,A,o.pixelPosMatrix)})}},zt=0;zt<K.length;zt++)Rt(zt);return tt},hf.prototype.loadMatchingFeature=function(o,u,c,m,x,E,A,R,L,V,Y){var K=this.bucketLayerIDs[u];if(!E||function(qr,Bn){for(var vn=0;vn<qr.length;vn++)if(Bn.indexOf(qr[vn])>=0)return!0;return!1}(E,K)){var le=this.sourceLayerCoder.decode(c),de=this.vtLayers[le].feature(m);if(x.needGeometry){var Ne=Qa(de,!0);if(!x.filter(new Re(this.tileID.overscaledZ),Ne,this.tileID.canonical))return}else if(!x.filter(new Re(this.tileID.overscaledZ),de))return;for(var I=this.getId(de,le),ft=0;ft<K.length;ft++){var tt=K[ft];if(!(E&&E.indexOf(tt)<0)){var Rt=R[tt];if(Rt){var zt={};I!==void 0&&V&&(zt=V.getState(Rt.sourceLayer||"_geojsonTileLayer",I));var ir=Et({},L[tt]);ir.paint=lg(ir.paint,Rt.paint,de,zt,A),ir.layout=lg(ir.layout,Rt.layout,de,zt,A);var or=!Y||Y(de,Rt,zt);if(or){var mr=new ad(de,this.z,this.x,this.y,I);mr.layer=ir;var Zr=o[tt];Zr===void 0&&(Zr=o[tt]=[]),Zr.push({featureIndex:m,feature:mr,intersectionZ:or})}}}}}},hf.prototype.lookupSymbolFeatures=function(o,u,c,m,x,E,A,R){var L={};this.loadVTLayers();for(var V=sl(x),Y=0,K=o;Y<K.length;Y+=1)this.loadMatchingFeature(L,c,m,K[Y],V,E,A,R,u);return L},hf.prototype.hasLayer=function(o){for(var u=0,c=this.bucketLayerIDs;u<c.length;u+=1)for(var m=0,x=c[u];m<x.length;m+=1)if(o===x[m])return!0;return!1},hf.prototype.getId=function(o,u){var c=o.id;return this.promoteId&&typeof(c=o.properties[typeof this.promoteId=="string"?this.promoteId:this.promoteId[u]])=="boolean"&&(c=Number(c)),c},xn("FeatureIndex",hf,{omit:["rawTileData","sourceLayerCoder"]});var cs=function(o,u){this.tileID=o,this.uid=wt(),this.uses=0,this.tileSize=u,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.expiredRequestCount=0,this.state="loading"};cs.prototype.registerFadeDuration=function(o){var u=o+this.timeAdded;u<fn.now()||this.fadeEndTime&&u<this.fadeEndTime||(this.fadeEndTime=u)},cs.prototype.wasRequested=function(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"},cs.prototype.loadVectorData=function(o,u,c){if(this.hasData()&&this.unloadVectorData(),this.state="loaded",o){for(var m in o.featureIndex&&(this.latestFeatureIndex=o.featureIndex,o.rawTileData?(this.latestRawTileData=o.rawTileData,this.latestFeatureIndex.rawTileData=o.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=o.collisionBoxArray,this.buckets=function(V,Y){var K={};if(!Y)return K;for(var le=function(){var I=Ne[de],ft=I.layerIds.map(function(zt){return Y.getLayer(zt)}).filter(Boolean);if(ft.length!==0){I.layers=ft,I.stateDependentLayerIds&&(I.stateDependentLayers=I.stateDependentLayerIds.map(function(zt){return ft.filter(function(ir){return ir.id===zt})[0]}));for(var tt=0,Rt=ft;tt<Rt.length;tt+=1)K[Rt[tt].id]=I}},de=0,Ne=V;de<Ne.length;de+=1)le();return K}(o.buckets,u.style),this.hasSymbolBuckets=!1,this.buckets){var x=this.buckets[m];if(x instanceof En){if(this.hasSymbolBuckets=!0,!c)break;x.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(var E in this.buckets){var A=this.buckets[E];if(A instanceof En&&A.hasRTLText){this.hasRTLText=!0,Zt.isLoading()||Zt.isLoaded()||Uf()!=="deferred"||Js();break}}for(var R in this.queryPadding=0,this.buckets){var L=this.buckets[R];this.queryPadding=Math.max(this.queryPadding,u.style.getLayer(R).queryRadius(L))}o.imageAtlas&&(this.imageAtlas=o.imageAtlas),o.glyphAtlasImage&&(this.glyphAtlasImage=o.glyphAtlasImage)}else this.collisionBoxArray=new v},cs.prototype.unloadVectorData=function(){for(var o in this.buckets)this.buckets[o].destroy();this.buckets={},this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.imageAtlas&&(this.imageAtlas=null),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.latestFeatureIndex=null,this.state="unloaded"},cs.prototype.getBucket=function(o){return this.buckets[o.id]},cs.prototype.upload=function(o){for(var u in this.buckets){var c=this.buckets[u];c.uploadPending()&&c.upload(o)}var m=o.gl;this.imageAtlas&&!this.imageAtlas.uploaded&&(this.imageAtlasTexture=new Dh(o,this.imageAtlas.image,m.RGBA),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new Dh(o,this.glyphAtlasImage,m.ALPHA),this.glyphAtlasImage=null)},cs.prototype.prepare=function(o){this.imageAtlas&&this.imageAtlas.patchUpdatedImages(o,this.imageAtlasTexture)},cs.prototype.queryRenderedFeatures=function(o,u,c,m,x,E,A,R,L,V){return this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData?this.latestFeatureIndex.query({queryGeometry:m,cameraQueryGeometry:x,scale:E,tileSize:this.tileSize,pixelPosMatrix:V,transform:R,params:A,queryPadding:this.queryPadding*L},o,u,c):{}},cs.prototype.querySourceFeatures=function(o,u){var c=this.latestFeatureIndex;if(c&&c.rawTileData){var m=c.loadVTLayers(),x=u?u.sourceLayer:"",E=m._geojsonTileLayer||m[x];if(E)for(var A=sl(u&&u.filter),R=this.tileID.canonical,L=R.z,V=R.x,Y=R.y,K={z:L,x:V,y:Y},le=0;le<E.length;le++){var de=E.feature(le);if(A.needGeometry){var Ne=Qa(de,!0);if(!A.filter(new Re(this.tileID.overscaledZ),Ne,this.tileID.canonical))continue}else if(!A.filter(new Re(this.tileID.overscaledZ),de))continue;var I=c.getId(de,x),ft=new ad(de,L,V,Y,I);ft.tile=K,o.push(ft)}}},cs.prototype.hasData=function(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"},cs.prototype.patternsLoaded=function(){return this.imageAtlas&&!!Object.keys(this.imageAtlas.patternPositions).length},cs.prototype.setExpiryData=function(o){var u=this.expirationTime;if(o.cacheControl){var c=W(o.cacheControl);c["max-age"]&&(this.expirationTime=Date.now()+1e3*c["max-age"])}else o.expires&&(this.expirationTime=new Date(o.expires).getTime());if(this.expirationTime){var m=Date.now(),x=!1;if(this.expirationTime>m)x=!1;else if(u)if(this.expirationTime<u)x=!0;else{var E=this.expirationTime-u;E?this.expirationTime=m+Math.max(E,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}},cs.prototype.getExpiryTimeout=function(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)},cs.prototype.setFeatureState=function(o,u){if(this.latestFeatureIndex&&this.latestFeatureIndex.rawTileData&&Object.keys(o).length!==0){var c=this.latestFeatureIndex.loadVTLayers();for(var m in this.buckets)if(u.style.hasLayer(m)){var x=this.buckets[m],E=x.layers[0].sourceLayer||"_geojsonTileLayer",A=c[E],R=o[E];if(A&&R&&Object.keys(R).length!==0){x.update(R,A,this.imageAtlas&&this.imageAtlas.patternPositions||{});var L=u&&u.style&&u.style.getLayer(m);L&&(this.queryPadding=Math.max(this.queryPadding,L.queryRadius(x)))}}}},cs.prototype.holdingForFade=function(){return this.symbolFadeHoldUntil!==void 0},cs.prototype.symbolFadeFinished=function(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<fn.now()},cs.prototype.clearFadeHold=function(){this.symbolFadeHoldUntil=void 0},cs.prototype.setHoldDuration=function(o){this.symbolFadeHoldUntil=fn.now()+o},cs.prototype.setDependencies=function(o,u){for(var c={},m=0,x=u;m<x.length;m+=1)c[x[m]]=!0;this.dependencies[o]=c},cs.prototype.hasDependency=function(o,u){for(var c=0,m=o;c<m.length;c+=1){var x=this.dependencies[m[c]];if(x){for(var E=0,A=u;E<A.length;E+=1)if(x[A[E]])return!0}}return!1};var Jf=oe.performance,fg=function(o){this._marks={start:[o.url,"start"].join("#"),end:[o.url,"end"].join("#"),measure:o.url.toString()},Jf.mark(this._marks.start)};fg.prototype.finish=function(){Jf.mark(this._marks.end);var o=Jf.getEntriesByName(this._marks.measure);return o.length===0&&(Jf.measure(this._marks.measure,this._marks.start,this._marks.end),o=Jf.getEntriesByName(this._marks.measure),Jf.clearMarks(this._marks.start),Jf.clearMarks(this._marks.end),Jf.clearMeasures(this._marks.measure)),o},_.Actor=Lh,_.AlphaImage=ru,_.CanonicalTileID=Qf,_.CollisionBoxArray=v,_.Color=Ai,_.DEMData=Nc,_.DataConstantProperty=Dn,_.DictionaryCoder=id,_.EXTENT=8192,_.ErrorEvent=Fe,_.EvaluationParameters=Re,_.Event=xe,_.Evented=et,_.FeatureIndex=hf,_.FillBucket=ml,_.FillExtrusionBucket=Ss,_.ImageAtlas=yr,_.ImagePosition=rn,_.LineBucket=Ps,_.LngLat=Ga,_.LngLatBounds=Zo,_.MercatorCoordinate=Fh,_.ONE_EM=24,_.OverscaledTileID=eo,_.Point=ce,_.Point$1=ce,_.Properties=Ba,_.Protobuf=er,_.RGBAImage=Do,_.RequestManager=Gn,_.RequestPerformance=fg,_.ResourceType=z,_.SegmentVector=ye,_.SourceFeatureState=Nh,_.StructArrayLayout1ui2=jf,_.StructArrayLayout2f1f2i16=rc,_.StructArrayLayout2i4=Ol,_.StructArrayLayout3ui6=ss,_.StructArrayLayout4i8=zf,_.SymbolBucket=En,_.Texture=Dh,_.Tile=cs,_.Transitionable=_e,_.Uniform1f=jr,_.Uniform1i=br,_.Uniform2f=Fr,_.Uniform3f=hn,_.Uniform4f=Un,_.UniformColor=Ln,_.UniformMatrix4f=Ui,_.UnwrappedTileID=Xv,_.ValidationError=Q,_.WritingMode=tr,_.ZoomHistory=Bf,_.add=function(o,u,c){return o[0]=u[0]+c[0],o[1]=u[1]+c[1],o[2]=u[2]+c[2],o},_.addDynamicAttributes=Rr,_.asyncAll=function(o,u,c){if(!o.length)return c(null,[]);var m=o.length,x=new Array(o.length),E=null;o.forEach(function(A,R){u(A,function(L,V){L&&(E=L),x[R]=V,--m==0&&c(E,x)})})},_.bezier=qe,_.bindAll=wr,_.browser=fn,_.cacheEntryPossiblyAdded=function(o){++ue>Gr&&(o.getActor().send("enforceCacheSizeLimit",xr),ue=0)},_.clamp=vt,_.clearTileCache=function(o){var u=oe.caches.delete("mapbox-tiles");o&&u.catch(o).then(function(){return o()})},_.clipLine=gl,_.clone=function(o){var u=new Bi(16);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u[3]=o[3],u[4]=o[4],u[5]=o[5],u[6]=o[6],u[7]=o[7],u[8]=o[8],u[9]=o[9],u[10]=o[10],u[11]=o[11],u[12]=o[12],u[13]=o[13],u[14]=o[14],u[15]=o[15],u},_.clone$1=ht,_.clone$2=function(o){var u=new Bi(3);return u[0]=o[0],u[1]=o[1],u[2]=o[2],u},_.collisionCircleLayout=G,_.config=cn,_.create=function(){var o=new Bi(16);return Bi!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=0,o[12]=0,o[13]=0,o[14]=0),o[0]=1,o[5]=1,o[10]=1,o[15]=1,o},_.create$1=function(){var o=new Bi(9);return Bi!=Float32Array&&(o[1]=0,o[2]=0,o[3]=0,o[5]=0,o[6]=0,o[7]=0),o[0]=1,o[4]=1,o[8]=1,o},_.create$2=function(){var o=new Bi(4);return Bi!=Float32Array&&(o[1]=0,o[2]=0),o[0]=1,o[3]=1,o},_.createCommonjsModule=fe,_.createExpression=Jc,_.createLayout=mo,_.createStyleLayer=function(o){return o.type==="custom"?new ed(o):new Ll[o.type](o)},_.cross=function(o,u,c){var m=u[0],x=u[1],E=u[2],A=c[0],R=c[1],L=c[2];return o[0]=x*L-E*R,o[1]=E*A-m*L,o[2]=m*R-x*A,o},_.deepEqual=function o(u,c){if(Array.isArray(u)){if(!Array.isArray(c)||u.length!==c.length)return!1;for(var m=0;m<u.length;m++)if(!o(u[m],c[m]))return!1;return!0}if(typeof u=="object"&&u!==null&&c!==null){if(typeof c!="object"||Object.keys(u).length!==Object.keys(c).length)return!1;for(var x in u)if(!o(u[x],c[x]))return!1;return!0}return u===c},_.dot=function(o,u){return o[0]*u[0]+o[1]*u[1]+o[2]*u[2]},_.dot$1=function(o,u){return o[0]*u[0]+o[1]*u[1]+o[2]*u[2]+o[3]*u[3]},_.ease=pt,_.emitValidationErrors=Jl,_.endsWith=pr,_.enforceCacheSizeLimit=function(o){nn(),Ia&&Ia.then(function(u){u.keys().then(function(c){for(var m=0;m<c.length-o;m++)u.delete(c[m])})})},_.evaluateSizeForFeature=As,_.evaluateSizeForZoom=bo,_.evaluateVariableOffset=yt,_.evented=Cc,_.extend=Et,_.featureFilter=sl,_.filterObject=Ot,_.fromRotation=function(o,u){var c=Math.sin(u),m=Math.cos(u);return o[0]=m,o[1]=c,o[2]=0,o[3]=-c,o[4]=m,o[5]=0,o[6]=0,o[7]=0,o[8]=1,o},_.getAnchorAlignment=xa,_.getAnchorJustification=St,_.getArrayBuffer=Lt,_.getImage=B,_.getJSON=function(o,u){return Mt(Et(o,{type:"json"}),u)},_.getRTLTextPluginStatus=Uf,_.getReferrer=be,_.getVideo=function(o,u){var c,m,x=oe.document.createElement("video");x.muted=!0,x.onloadstart=function(){u(null,x)};for(var E=0;E<o.length;E++){var A=oe.document.createElement("source");c=o[E],m=void 0,(m=oe.document.createElement("a")).href=c,(m.protocol!==oe.document.location.protocol||m.host!==oe.document.location.host)&&(x.crossOrigin="Anonymous"),A.src=o[E],x.appendChild(A)}return{cancel:function(){}}},_.identity=Ko,_.invert=function(o,u){var c=u[0],m=u[1],x=u[2],E=u[3],A=u[4],R=u[5],L=u[6],V=u[7],Y=u[8],K=u[9],le=u[10],de=u[11],Ne=u[12],I=u[13],ft=u[14],tt=u[15],Rt=c*R-m*A,zt=c*L-x*A,ir=c*V-E*A,or=m*L-x*R,mr=m*V-E*R,Zr=x*V-E*L,qr=Y*I-K*Ne,Bn=Y*ft-le*Ne,vn=Y*tt-de*Ne,Zn=K*ft-le*I,mn=K*tt-de*I,xi=le*tt-de*ft,ti=Rt*xi-zt*mn+ir*Zn+or*vn-mr*Bn+Zr*qr;return ti?(o[0]=(R*xi-L*mn+V*Zn)*(ti=1/ti),o[1]=(x*mn-m*xi-E*Zn)*ti,o[2]=(I*Zr-ft*mr+tt*or)*ti,o[3]=(le*mr-K*Zr-de*or)*ti,o[4]=(L*vn-A*xi-V*Bn)*ti,o[5]=(c*xi-x*vn+E*Bn)*ti,o[6]=(ft*ir-Ne*Zr-tt*zt)*ti,o[7]=(Y*Zr-le*ir+de*zt)*ti,o[8]=(A*mn-R*vn+V*qr)*ti,o[9]=(m*vn-c*mn-E*qr)*ti,o[10]=(Ne*mr-I*ir+tt*Rt)*ti,o[11]=(K*ir-Y*mr-de*Rt)*ti,o[12]=(R*Bn-A*Zn-L*qr)*ti,o[13]=(c*Zn-m*Bn+x*qr)*ti,o[14]=(I*zt-Ne*or-ft*Rt)*ti,o[15]=(Y*or-K*zt+le*Rt)*ti,o):null},_.isChar=an,_.isMapboxURL=zi,_.keysDifference=function(o,u){var c=[];for(var m in o)m in u||c.push(m);return c},_.makeRequest=Mt,_.mapObject=lr,_.mercatorXfromLng=ki,_.mercatorYfromLat=Pi,_.mercatorZfromAltitude=Bh,_.mul=Ic,_.multiply=oo,_.mvt=sc,_.nextPowerOfTwo=function(o){return o<=1?1:Math.pow(2,Math.ceil(Math.log(o)/Math.LN2))},_.normalize=function(o,u){var c=u[0],m=u[1],x=u[2],E=c*c+m*m+x*x;return E>0&&(E=1/Math.sqrt(E)),o[0]=u[0]*E,o[1]=u[1]*E,o[2]=u[2]*E,o},_.number=Ya,_.offscreenCanvasSupported=D,_.ortho=function(o,u,c,m,x,E,A){var R=1/(u-c),L=1/(m-x),V=1/(E-A);return o[0]=-2*R,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=-2*L,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[10]=2*V,o[11]=0,o[12]=(u+c)*R,o[13]=(x+m)*L,o[14]=(A+E)*V,o[15]=1,o},_.parseGlyphPBF=function(o){return new er(o).readFields(Ar,[])},_.pbf=er,_.performSymbolLayout=function(o,u,c,m,x,E,A){o.createArrays(),o.tilePixelRatio=8192/(512*o.overscaling),o.compareText={},o.iconsNeedLinear=!1;var R=o.layers[0].layout,L=o.layers[0]._unevaluatedLayout._values,V={};if(o.textSizeData.kind==="composite"){var Y=o.textSizeData,K=Y.maxZoom;V.compositeTextSizes=[L["text-size"].possiblyEvaluate(new Re(Y.minZoom),A),L["text-size"].possiblyEvaluate(new Re(K),A)]}if(o.iconSizeData.kind==="composite"){var le=o.iconSizeData,de=le.maxZoom;V.compositeIconSizes=[L["icon-size"].possiblyEvaluate(new Re(le.minZoom),A),L["icon-size"].possiblyEvaluate(new Re(de),A)]}V.layoutTextSize=L["text-size"].possiblyEvaluate(new Re(o.zoom+1),A),V.layoutIconSize=L["icon-size"].possiblyEvaluate(new Re(o.zoom+1),A),V.textMaxSize=L["text-size"].possiblyEvaluate(new Re(18));for(var Ne=24*R.get("text-line-height"),I=R.get("text-rotation-alignment")==="map"&&R.get("symbol-placement")!=="point",ft=R.get("text-keep-upright"),tt=R.get("text-size"),Rt=function(){var or=ir[zt],mr=R.get("text-font").evaluate(or,{},A).join(","),Zr=tt.evaluate(or,{},A),qr=V.layoutTextSize.evaluate(or,{},A),Bn=V.layoutIconSize.evaluate(or,{},A),vn={horizontal:{},vertical:void 0},Zn=or.text,mn=[0,0];if(Zn){var xi=Zn.toString(),ti=24*R.get("text-letter-spacing").evaluate(or,{},A),Rn=function(Fi){for(var Sa=0,pa=Fi;Sa<pa.length;Sa+=1)if(qi=pa[Sa].charCodeAt(0),an.Arabic(qi)||an["Arabic Supplement"](qi)||an["Arabic Extended-A"](qi)||an["Arabic Presentation Forms-A"](qi)||an["Arabic Presentation Forms-B"](qi))return!1;var qi;return!0}(xi)?ti:0,Mi=R.get("text-anchor").evaluate(or,{},A),mi=R.get("text-variable-anchor");if(!mi){var Hi=R.get("text-radial-offset").evaluate(or,{},A);mn=Hi?yt(Mi,[24*Hi,ct]):R.get("text-offset").evaluate(or,{},A).map(function(Fi){return 24*Fi})}var Hn=I?"center":R.get("text-justify").evaluate(or,{},A),ea=R.get("symbol-placement"),ba=ea==="point"?24*R.get("text-max-width").evaluate(or,{},A):0,so=function(){o.allowVerticalPlacement&&ll(xi)&&(vn.vertical=_i(Zn,u,c,x,mr,ba,Ne,Mi,"left",Rn,mn,tr.vertical,!0,ea,qr,Zr))};if(!I&&mi){for(var to=Hn==="auto"?mi.map(function(Fi){return St(Fi)}):[Hn],Fa=!1,Xa=0;Xa<to.length;Xa++){var Jo=to[Xa];if(!vn.horizontal[Jo])if(Fa)vn.horizontal[Jo]=vn.horizontal[0];else{var Vo=_i(Zn,u,c,x,mr,ba,Ne,"center",Jo,Rn,mn,tr.horizontal,!1,ea,qr,Zr);Vo&&(vn.horizontal[Jo]=Vo,Fa=Vo.positionedLines.length===1)}}so()}else{Hn==="auto"&&(Hn=St(Mi));var Ws=_i(Zn,u,c,x,mr,ba,Ne,Mi,Hn,Rn,mn,tr.horizontal,!1,ea,qr,Zr);Ws&&(vn.horizontal[Hn]=Ws),so(),ll(xi)&&I&&ft&&(vn.vertical=_i(Zn,u,c,x,mr,ba,Ne,Mi,Hn,Rn,mn,tr.vertical,!1,ea,qr,Zr))}}var fs=void 0,Os=!1;if(or.icon&&or.icon.name){var So=m[or.icon.name];So&&(fs=function(Fi,Sa,pa){var qi=xa(pa),hs=Sa[0]-Fi.displaySize[0]*qi.horizontalAlign,Ts=Sa[1]-Fi.displaySize[1]*qi.verticalAlign;return{image:Fi,top:Ts,bottom:Ts+Fi.displaySize[1],left:hs,right:hs+Fi.displaySize[0]}}(x[or.icon.name],R.get("icon-offset").evaluate(or,{},A),R.get("icon-anchor").evaluate(or,{},A)),Os=So.sdf,o.sdfIcons===void 0?o.sdfIcons=So.sdf:o.sdfIcons!==So.sdf&&Qe("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(So.pixelRatio!==o.pixelRatio||R.get("icon-rotate").constantOr(1)!==0)&&(o.iconsNeedLinear=!0))}var Ea=dt(vn.horizontal)||vn.vertical;o.iconsInText=!!Ea&&Ea.iconsInText,(Ea||fs)&&function(Fi,Sa,pa,qi,hs,Ts,Da,Ao,ps,ta,Uc){var qu=Ts.textMaxSize.evaluate(Sa,{});qu===void 0&&(qu=Da);var Bl,uo=Fi.layers[0].layout,Fl=uo.get("icon-offset").evaluate(Sa,{},Uc),Cu=dt(pa.horizontal),pf=Da/24,df=Fi.tilePixelRatio*pf,eh=Fi.tilePixelRatio*qu/24,Nl=Fi.tilePixelRatio*Ao,zc=Fi.tilePixelRatio*uo.get("symbol-spacing"),nu=uo.get("text-padding")*Fi.tilePixelRatio,th=uo.get("icon-padding")*Fi.tilePixelRatio,Uh=uo.get("text-max-angle")/180*Math.PI,lc=uo.get("text-rotation-alignment")==="map"&&uo.get("symbol-placement")!=="point",Gd=uo.get("icon-rotation-alignment")==="map"&&uo.get("symbol-placement")!=="point",vf=uo.get("symbol-placement"),sd=zc/2,zh=uo.get("icon-text-fit");qi&&zh!=="none"&&(Fi.allowVerticalPlacement&&pa.vertical&&(Bl=xo(qi,pa.vertical,zh,uo.get("icon-text-fit-padding"),Fl,pf)),Cu&&(qi=xo(qi,Cu,zh,uo.get("icon-text-fit-padding"),Fl,pf)));var mf=function(w0,Kd){Kd.x<0||Kd.x>=8192||Kd.y<0||Kd.y>=8192||function(lo,zl,Z_,xf,Yv,hg,Qd,fc,Jd,Tp,pd,dd,ev,qv,wp,Kv,Qv,Jv,em,tm,Ru,vd,rm,hc,pg){var nm,nh,jo,jh,Hh,Wh=lo.addToLineVertexArray(zl,Z_),im=0,am=0,om=0,sm=0,tv=-1,rv=-1,jc={},um=Be(""),nv=0,iv=0;if(fc._unevaluatedLayout.getValue("text-radial-offset")===void 0?(nv=(nm=fc.layout.get("text-offset").evaluate(Ru,{},hc).map(function(_d){return 24*_d}))[0],iv=nm[1]):(nv=24*fc.layout.get("text-radial-offset").evaluate(Ru,{},hc),iv=ct),lo.allowVerticalPlacement&&xf.vertical){var lm=fc.layout.get("text-rotate").evaluate(Ru,{},hc)+90;jh=new ma(Jd,zl,Tp,pd,dd,xf.vertical,ev,qv,wp,lm),Qd&&(Hh=new ma(Jd,zl,Tp,pd,dd,Qd,Qv,Jv,wp,lm))}if(Yv){var av=fc.layout.get("icon-rotate").evaluate(Ru,{}),cm=fc.layout.get("icon-text-fit")!=="none",dg=je(Yv,av,rm,cm),fm=Qd?je(Qd,av,rm,cm):void 0;jo=new ma(Jd,zl,Tp,pd,dd,Yv,Qv,Jv,!1,av),im=4*dg.length;var vg=lo.iconSizeData,md=null;vg.kind==="source"?(md=[128*fc.layout.get("icon-size").evaluate(Ru,{})])[0]>32640&&Qe(lo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'):vg.kind==="composite"&&((md=[128*vd.compositeIconSizes[0].evaluate(Ru,{},hc),128*vd.compositeIconSizes[1].evaluate(Ru,{},hc)])[0]>32640||md[1]>32640)&&Qe(lo.layerIds[0]+': Value for "icon-size" is >= 255. Reduce your "icon-size".'),lo.addSymbols(lo.icon,dg,md,tm,em,Ru,!1,zl,Wh.lineStartIndex,Wh.lineLength,-1,hc),tv=lo.icon.placedSymbolArray.length-1,fm&&(am=4*fm.length,lo.addSymbols(lo.icon,fm,md,tm,em,Ru,tr.vertical,zl,Wh.lineStartIndex,Wh.lineLength,-1,hc),rv=lo.icon.placedSymbolArray.length-1)}for(var hm in xf.horizontal){var gd=xf.horizontal[hm];if(!nh){um=Be(gd.text);var pm=fc.layout.get("text-rotate").evaluate(Ru,{},hc);nh=new ma(Jd,zl,Tp,pd,dd,gd,ev,qv,wp,pm)}var dm=gd.positionedLines.length===1;if(om+=He(lo,zl,gd,hg,fc,wp,Ru,Kv,Wh,xf.vertical?tr.horizontal:tr.horizontalOnly,dm?Object.keys(xf.horizontal):[hm],jc,tv,vd,hc),dm)break}xf.vertical&&(sm+=He(lo,zl,xf.vertical,hg,fc,wp,Ru,Kv,Wh,tr.vertical,["vertical"],jc,rv,vd,hc));var mg=nh?nh.boxStartIndex:lo.collisionBoxArray.length,gg=nh?nh.boxEndIndex:lo.collisionBoxArray.length,C0=jh?jh.boxStartIndex:lo.collisionBoxArray.length,_g=jh?jh.boxEndIndex:lo.collisionBoxArray.length,R0=jo?jo.boxStartIndex:lo.collisionBoxArray.length,yg=jo?jo.boxEndIndex:lo.collisionBoxArray.length,xg=Hh?Hh.boxStartIndex:lo.collisionBoxArray.length,M0=Hh?Hh.boxEndIndex:lo.collisionBoxArray.length,Hc=-1,ov=function(_d,vm){return _d&&_d.circleDiameter?Math.max(_d.circleDiameter,vm):vm};Hc=ov(nh,Hc),Hc=ov(jh,Hc),Hc=ov(jo,Hc);var bg=(Hc=ov(Hh,Hc))>-1?1:0;bg&&(Hc*=pg/24),lo.glyphOffsetArray.length>=En.MAX_GLYPHS&&Qe("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Ru.sortKey!==void 0&&lo.addToSortKeyRanges(lo.symbolInstances.length,Ru.sortKey),lo.symbolInstances.emplaceBack(zl.x,zl.y,jc.right>=0?jc.right:-1,jc.center>=0?jc.center:-1,jc.left>=0?jc.left:-1,jc.vertical||-1,tv,rv,um,mg,gg,C0,_g,R0,yg,xg,M0,Tp,om,sm,im,am,bg,0,ev,nv,iv,Hc)}(Fi,Kd,w0,pa,qi,hs,Bl,Fi.layers[0],Fi.collisionBoxArray,Sa.index,Sa.sourceLayerIndex,Fi.index,df,nu,lc,ps,Nl,th,Gd,Fl,Sa,Ts,ta,Uc,Da)};if(vf==="line")for(var Zc=0,Xd=gl(Sa.geometry,0,0,8192,8192);Zc<Xd.length;Zc+=1)for(var $d=Xd[Zc],ud=0,Ep=Eo($d,zc,Uh,pa.vertical||Cu,qi,24,eh,Fi.overscaling,8192);ud<Ep.length;ud+=1){var Yd=Ep[ud];Cu&&Me(Fi,Cu.text,sd,Yd)||mf($d,Yd)}else if(vf==="line-center")for(var ld=0,cd=Sa.geometry;ld<cd.length;ld+=1){var cc=cd[ld];if(cc.length>1){var Sp=Gi(cc,Uh,pa.vertical||Cu,qi,24,eh);Sp&&mf(cc,Sp)}}else if(Sa.type==="Polygon")for(var gf=0,Ap=mp(Sa.geometry,0);gf<Ap.length;gf+=1){var Vc=Ap[gf],Zh=$e(Vc,16);mf(Vc[0],new Wa(Zh.x,Zh.y,0))}else if(Sa.type==="LineString")for(var _f=0,yf=Sa.geometry;_f<yf.length;_f+=1){var rh=yf[_f];mf(rh,new Wa(rh[0].x,rh[0].y,0))}else if(Sa.type==="Point")for(var Vh=0,fd=Sa.geometry;Vh<fd.length;Vh+=1)for(var Ul=0,qd=fd[Vh];Ul<qd.length;Ul+=1){var hd=qd[Ul];mf([hd],new Wa(hd.x,hd.y,0))}}(o,or,vn,fs,m,V,qr,Bn,mn,Os,A)},zt=0,ir=o.features;zt<ir.length;zt+=1)Rt();E&&o.generateCollisionDebugBuffers()},_.perspective=function(o,u,c,m,x){var E,A=1/Math.tan(u/2);return o[0]=A/c,o[1]=0,o[2]=0,o[3]=0,o[4]=0,o[5]=A,o[6]=0,o[7]=0,o[8]=0,o[9]=0,o[11]=-1,o[12]=0,o[13]=0,o[15]=0,x!=null&&x!==1/0?(o[10]=(x+m)*(E=1/(m-x)),o[14]=2*x*m*E):(o[10]=-1,o[14]=-2*m),o},_.pick=function(o,u){for(var c={},m=0;m<u.length;m++){var x=u[m];x in o&&(c[x]=o[x])}return c},_.plugin=Zt,_.polygonIntersectsPolygon=fl,_.postMapLoadEvent=Wt,_.postTurnstileEvent=Rs,_.potpack=ai,_.refProperties=["type","source","source-layer","minzoom","maxzoom","filter","layout"],_.register=xn,_.registerForPluginStateChange=function(o){return o({pluginStatus:gs,pluginURL:yu}),Cc.on("pluginStateChange",o),o},_.renderColorRamp=ic,_.rotate=function(o,u,c){var m=u[0],x=u[1],E=u[2],A=u[3],R=Math.sin(c),L=Math.cos(c);return o[0]=m*L+E*R,o[1]=x*L+A*R,o[2]=m*-R+E*L,o[3]=x*-R+A*L,o},_.rotateX=function(o,u,c){var m=Math.sin(c),x=Math.cos(c),E=u[4],A=u[5],R=u[6],L=u[7],V=u[8],Y=u[9],K=u[10],le=u[11];return u!==o&&(o[0]=u[0],o[1]=u[1],o[2]=u[2],o[3]=u[3],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[4]=E*x+V*m,o[5]=A*x+Y*m,o[6]=R*x+K*m,o[7]=L*x+le*m,o[8]=V*x-E*m,o[9]=Y*x-A*m,o[10]=K*x-R*m,o[11]=le*x-L*m,o},_.rotateZ=function(o,u,c){var m=Math.sin(c),x=Math.cos(c),E=u[0],A=u[1],R=u[2],L=u[3],V=u[4],Y=u[5],K=u[6],le=u[7];return u!==o&&(o[8]=u[8],o[9]=u[9],o[10]=u[10],o[11]=u[11],o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15]),o[0]=E*x+V*m,o[1]=A*x+Y*m,o[2]=R*x+K*m,o[3]=L*x+le*m,o[4]=V*x-E*m,o[5]=Y*x-A*m,o[6]=K*x-R*m,o[7]=le*x-L*m,o},_.scale=function(o,u,c){var m=c[0],x=c[1],E=c[2];return o[0]=u[0]*m,o[1]=u[1]*m,o[2]=u[2]*m,o[3]=u[3]*m,o[4]=u[4]*x,o[5]=u[5]*x,o[6]=u[6]*x,o[7]=u[7]*x,o[8]=u[8]*E,o[9]=u[9]*E,o[10]=u[10]*E,o[11]=u[11]*E,o[12]=u[12],o[13]=u[13],o[14]=u[14],o[15]=u[15],o},_.scale$1=function(o,u,c){return o[0]=u[0]*c,o[1]=u[1]*c,o[2]=u[2]*c,o[3]=u[3]*c,o},_.scale$2=function(o,u,c){return o[0]=u[0]*c,o[1]=u[1]*c,o[2]=u[2]*c,o},_.setCacheLimits=function(o,u){xr=o,Gr=u},_.setRTLTextPlugin=function(o,u,c){if(c===void 0&&(c=!1),gs==="deferred"||gs==="loading"||gs==="loaded")throw new Error("setRTLTextPlugin cannot be called multiple times.");yu=fn.resolveURL(o),gs="deferred",Nf=u,wc(),c||Js()},_.sphericalToCartesian=function(o){var u=o[0],c=o[1],m=o[2];return c+=90,c*=Math.PI/180,m*=Math.PI/180,{x:u*Math.cos(c)*Math.sin(m),y:u*Math.sin(c)*Math.sin(m),z:u*Math.cos(m)}},_.sqrLen=function(o){var u=o[0],c=o[1];return u*u+c*c},_.styleSpec=j,_.sub=function(o,u,c){return o[0]=u[0]-c[0],o[1]=u[1]-c[1],o[2]=u[2]-c[2],o},_.symbolSize=gi,_.transformMat3=function(o,u,c){var m=u[0],x=u[1],E=u[2];return o[0]=m*c[0]+x*c[3]+E*c[6],o[1]=m*c[1]+x*c[4]+E*c[7],o[2]=m*c[2]+x*c[5]+E*c[8],o},_.transformMat4=Wu,_.translate=function(o,u,c){var m,x,E,A,R,L,V,Y,K,le,de,Ne,I=c[0],ft=c[1],tt=c[2];return u===o?(o[12]=u[0]*I+u[4]*ft+u[8]*tt+u[12],o[13]=u[1]*I+u[5]*ft+u[9]*tt+u[13],o[14]=u[2]*I+u[6]*ft+u[10]*tt+u[14],o[15]=u[3]*I+u[7]*ft+u[11]*tt+u[15]):(x=u[1],E=u[2],A=u[3],R=u[4],L=u[5],V=u[6],Y=u[7],K=u[8],le=u[9],de=u[10],Ne=u[11],o[0]=m=u[0],o[1]=x,o[2]=E,o[3]=A,o[4]=R,o[5]=L,o[6]=V,o[7]=Y,o[8]=K,o[9]=le,o[10]=de,o[11]=Ne,o[12]=m*I+R*ft+K*tt+u[12],o[13]=x*I+L*ft+le*tt+u[13],o[14]=E*I+V*ft+de*tt+u[14],o[15]=A*I+Y*ft+Ne*tt+u[15]),o},_.triggerPluginCompletionEvent=hp,_.uniqueId=wt,_.validateCustomStyleLayer=function(o){var u=[],c=o.id;return c===void 0&&u.push({message:"layers."+c+': missing required property "id"'}),o.render===void 0&&u.push({message:"layers."+c+': missing required method "render"'}),o.renderingMode&&o.renderingMode!=="2d"&&o.renderingMode!=="3d"&&u.push({message:"layers."+c+': property "renderingMode" must be either "2d" or "3d"'}),u},_.validateLight=fp,_.validateStyle=Qs,_.values=function(o){var u=[];for(var c in o)u.push(o[c]);return u},_.vectorTile=sc,_.version="1.13.3",_.warnOnce=Qe,_.webpSupported=Lr,_.window=oe,_.wrap=bt}),ve(["./shared"],function(_){"use strict";function fe(N){var B=typeof N;if(B==="number"||B==="boolean"||B==="string"||N==null)return JSON.stringify(N);if(Array.isArray(N)){for(var $="[",ne=0,xe=N;ne<xe.length;ne+=1)$+=fe(xe[ne])+",";return $+"]"}for(var Fe=Object.keys(N).sort(),et="{",j=0;j<Fe.length;j++)et+=JSON.stringify(Fe[j])+":"+fe(N[Fe[j]])+",";return et+"}"}function Z(N){for(var B="",$=0,ne=_.refProperties;$<ne.length;$+=1)B+="/"+fe(N[ne[$]]);return B}var he=function(N){this.keyCache={},N&&this.replace(N)};he.prototype.replace=function(N){this._layerConfigs={},this._layers={},this.update(N,[])},he.prototype.update=function(N,B){for(var $=this,ne=0,xe=N;ne<xe.length;ne+=1){var Fe=xe[ne];this._layerConfigs[Fe.id]=Fe;var et=this._layers[Fe.id]=_.createStyleLayer(Fe);et._featureFilter=_.featureFilter(et.filter),this.keyCache[Fe.id]&&delete this.keyCache[Fe.id]}for(var j=0,Q=B;j<Q.length;j+=1){var Le=Q[j];delete this.keyCache[Le],delete this._layerConfigs[Le],delete this._layers[Le]}this.familiesBySource={};for(var rt=0,Ee=function(zr,Vr){for(var ei={},sn=0;sn<zr.length;sn++){var hi=Vr&&Vr[zr[sn].id]||Z(zr[sn]);Vr&&(Vr[zr[sn].id]=hi);var Vi=ei[hi];Vi||(Vi=ei[hi]=[]),Vi.push(zr[sn])}var ci=[];for(var Di in ei)ci.push(ei[Di]);return ci}(_.values(this._layerConfigs),this.keyCache);rt<Ee.length;rt+=1){var Yt=Ee[rt].map(function(zr){return $._layers[zr.id]}),gr=Yt[0];if(gr.visibility!=="none"){var tn=gr.source||"",Qr=this.familiesBySource[tn];Qr||(Qr=this.familiesBySource[tn]={});var rr=gr.sourceLayer||"_geojsonTileLayer",Xr=Qr[rr];Xr||(Xr=Qr[rr]=[]),Xr.push(Yt)}}};var ce=function(N){var B={},$=[];for(var ne in N){var xe=N[ne],Fe=B[ne]={};for(var et in xe){var j=xe[+et];if(j&&j.bitmap.width!==0&&j.bitmap.height!==0){var Q={x:0,y:0,w:j.bitmap.width+2,h:j.bitmap.height+2};$.push(Q),Fe[et]={rect:Q,metrics:j.metrics}}}}var Le=_.potpack($),rt=new _.AlphaImage({width:Le.w||1,height:Le.h||1});for(var Ee in N){var Yt=N[Ee];for(var gr in Yt){var tn=Yt[+gr];if(tn&&tn.bitmap.width!==0&&tn.bitmap.height!==0){var Qr=B[Ee][gr].rect;_.AlphaImage.copy(tn.bitmap,rt,{x:0,y:0},{x:Qr.x+1,y:Qr.y+1},tn.bitmap)}}}this.image=rt,this.positions=B};_.register("GlyphAtlas",ce);var Ge=function(N){this.tileID=new _.OverscaledTileID(N.tileID.overscaledZ,N.tileID.wrap,N.tileID.canonical.z,N.tileID.canonical.x,N.tileID.canonical.y),this.uid=N.uid,this.zoom=N.zoom,this.pixelRatio=N.pixelRatio,this.tileSize=N.tileSize,this.source=N.source,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=N.showCollisionBoxes,this.collectResourceTiming=!!N.collectResourceTiming,this.returnDependencies=!!N.returnDependencies,this.promoteId=N.promoteId};function oe(N,B,$){for(var ne=new _.EvaluationParameters(B),xe=0,Fe=N;xe<Fe.length;xe+=1)Fe[xe].recalculate(ne,$)}function We(N,B){var $=_.getArrayBuffer(N.request,function(ne,xe,Fe,et){ne?B(ne):xe&&B(null,{vectorTile:new _.vectorTile.VectorTile(new _.pbf(xe)),rawData:xe,cacheControl:Fe,expires:et})});return function(){$.cancel(),B()}}Ge.prototype.parse=function(N,B,$,ne,xe){var Fe=this;this.status="parsing",this.data=N,this.collisionBoxArray=new _.CollisionBoxArray;var et=new _.DictionaryCoder(Object.keys(N.layers).sort()),j=new _.FeatureIndex(this.tileID,this.promoteId);j.bucketLayerIDs=[];var Q,Le,rt,Ee,Yt={},gr={featureIndex:j,iconDependencies:{},patternDependencies:{},glyphDependencies:{},availableImages:$},tn=B.familiesBySource[this.source];for(var Qr in tn){var rr=N.layers[Qr];if(rr){rr.version===1&&_.warnOnce('Vector tile source "'+this.source+'" layer "'+Qr+'" does not use vector tile spec v2 and therefore may have some rendering errors.');for(var Xr=et.encode(Qr),zr=[],Vr=0;Vr<rr.length;Vr++){var ei=rr.feature(Vr),sn=j.getId(ei,Qr);zr.push({feature:ei,id:sn,index:Vr,sourceLayerIndex:Xr})}for(var hi=0,Vi=tn[Qr];hi<Vi.length;hi+=1){var ci=Vi[hi],Di=ci[0];Di.minzoom&&this.zoom<Math.floor(Di.minzoom)||Di.maxzoom&&this.zoom>=Di.maxzoom||Di.visibility!=="none"&&(oe(ci,this.zoom,$),(Yt[Di.id]=Di.createBucket({index:j.bucketLayerIDs.length,layers:ci,zoom:this.zoom,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Xr,sourceID:this.source})).populate(zr,gr,this.tileID.canonical),j.bucketLayerIDs.push(ci.map(function(Si){return Si.id})))}}}var Ei=_.mapObject(gr.glyphDependencies,function(Si){return Object.keys(Si).map(Number)});Object.keys(Ei).length?ne.send("getGlyphs",{uid:this.uid,stacks:Ei},function(Si,di){Q||(Q=Si,Le=di,Pa.call(Fe))}):Le={};var rs=Object.keys(gr.iconDependencies);rs.length?ne.send("getImages",{icons:rs,source:this.source,tileID:this.tileID,type:"icons"},function(Si,di){Q||(Q=Si,rt=di,Pa.call(Fe))}):rt={};var Qi=Object.keys(gr.patternDependencies);function Pa(){if(Q)return xe(Q);if(Le&&rt&&Ee){var Si=new ce(Le),di=new _.ImageAtlas(rt,Ee);for(var Ai in Yt){var Oa=Yt[Ai];Oa instanceof _.SymbolBucket?(oe(Oa.layers,this.zoom,$),_.performSymbolLayout(Oa,Le,Si.positions,rt,di.iconPositions,this.showCollisionBoxes,this.tileID.canonical)):Oa.hasPattern&&(Oa instanceof _.LineBucket||Oa instanceof _.FillBucket||Oa instanceof _.FillExtrusionBucket)&&(oe(Oa.layers,this.zoom,$),Oa.addFeatures(gr,this.tileID.canonical,di.patternPositions))}this.status="done",xe(null,{buckets:_.values(Yt).filter(function(vu){return!vu.isEmpty()}),featureIndex:j,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Si.image,imageAtlas:di,glyphMap:this.returnDependencies?Le:null,iconMap:this.returnDependencies?rt:null,glyphPositions:this.returnDependencies?Si.positions:null})}}Qi.length?ne.send("getImages",{icons:Qi,source:this.source,tileID:this.tileID,type:"patterns"},function(Si,di){Q||(Q=Si,Ee=di,Pa.call(Fe))}):Ee={},Pa.call(this)};var qe=function(N,B,$,ne){this.actor=N,this.layerIndex=B,this.availableImages=$,this.loadVectorData=ne||We,this.loading={},this.loaded={}};qe.prototype.loadTile=function(N,B){var $=this,ne=N.uid;this.loading||(this.loading={});var xe=!!(N&&N.request&&N.request.collectResourceTiming)&&new _.RequestPerformance(N.request),Fe=this.loading[ne]=new Ge(N);Fe.abort=this.loadVectorData(N,function(et,j){if(delete $.loading[ne],et||!j)return Fe.status="done",$.loaded[ne]=Fe,B(et);var Q=j.rawData,Le={};j.expires&&(Le.expires=j.expires),j.cacheControl&&(Le.cacheControl=j.cacheControl);var rt={};if(xe){var Ee=xe.finish();Ee&&(rt.resourceTiming=JSON.parse(JSON.stringify(Ee)))}Fe.vectorTile=j.vectorTile,Fe.parse(j.vectorTile,$.layerIndex,$.availableImages,$.actor,function(Yt,gr){if(Yt||!gr)return B(Yt);B(null,_.extend({rawTileData:Q.slice(0)},gr,Le,rt))}),$.loaded=$.loaded||{},$.loaded[ne]=Fe})},qe.prototype.reloadTile=function(N,B){var $=this,ne=this.loaded,xe=N.uid,Fe=this;if(ne&&ne[xe]){var et=ne[xe];et.showCollisionBoxes=N.showCollisionBoxes;var j=function(Q,Le){var rt=et.reloadCallback;rt&&(delete et.reloadCallback,et.parse(et.vectorTile,Fe.layerIndex,$.availableImages,Fe.actor,rt)),B(Q,Le)};et.status==="parsing"?et.reloadCallback=j:et.status==="done"&&(et.vectorTile?et.parse(et.vectorTile,this.layerIndex,this.availableImages,this.actor,j):j())}},qe.prototype.abortTile=function(N,B){var $=this.loading,ne=N.uid;$&&$[ne]&&$[ne].abort&&($[ne].abort(),delete $[ne]),B()},qe.prototype.removeTile=function(N,B){var $=this.loaded,ne=N.uid;$&&$[ne]&&delete $[ne],B()};var pt=_.window.ImageBitmap,vt=function(){this.loaded={}};function bt(N,B){if(N.length!==0){Et(N[0],B);for(var $=1;$<N.length;$++)Et(N[$],!B)}}function Et(N,B){for(var $=0,ne=0,xe=0,Fe=N.length,et=Fe-1;xe<Fe;et=xe++){var j=(N[xe][0]-N[et][0])*(N[et][1]+N[xe][1]),Q=$+j;ne+=Math.abs($)>=Math.abs(j)?$-Q+j:j-Q+$,$=Q}$+ne>=0!=!!B&&N.reverse()}vt.prototype.loadTile=function(N,B){var $=N.uid,ne=N.encoding,xe=N.rawImageData,Fe=pt&&xe instanceof pt?this.getImageData(xe):xe,et=new _.DEMData($,Fe,ne);this.loaded=this.loaded||{},this.loaded[$]=et,B(null,et)},vt.prototype.getImageData=function(N){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(N.width,N.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d")),this.offscreenCanvas.width=N.width,this.offscreenCanvas.height=N.height,this.offscreenCanvasContext.drawImage(N,0,0,N.width,N.height);var B=this.offscreenCanvasContext.getImageData(-1,-1,N.width+2,N.height+2);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),new _.RGBAImage({width:B.width,height:B.height},B.data)},vt.prototype.removeTile=function(N){var B=this.loaded,$=N.uid;B&&B[$]&&delete B[$]};var Dt=_.vectorTile.VectorTileFeature.prototype.toGeoJSON,wt=function(N){this._feature=N,this.extent=_.EXTENT,this.type=N.type,this.properties=N.tags,"id"in N&&!isNaN(N.id)&&(this.id=parseInt(N.id,10))};wt.prototype.loadGeometry=function(){if(this._feature.type===1){for(var N=[],B=0,$=this._feature.geometry;B<$.length;B+=1){var ne=$[B];N.push([new _.Point$1(ne[0],ne[1])])}return N}for(var xe=[],Fe=0,et=this._feature.geometry;Fe<et.length;Fe+=1){for(var j=[],Q=0,Le=et[Fe];Q<Le.length;Q+=1){var rt=Le[Q];j.push(new _.Point$1(rt[0],rt[1]))}xe.push(j)}return xe},wt.prototype.toGeoJSON=function(N,B,$){return Dt.call(this,N,B,$)};var at=function(N){this.layers={_geojsonTileLayer:this},this.name="_geojsonTileLayer",this.extent=_.EXTENT,this.length=N.length,this._features=N};at.prototype.feature=function(N){return new wt(this._features[N])};var Tt=_.vectorTile.VectorTileFeature,wr=pr;function pr(N,B){this.options=B||{},this.features=N,this.length=N.length}function lr(N,B){this.id=typeof N.id=="number"?N.id:void 0,this.type=N.type,this.rawGeometry=N.type===1?[N.geometry]:N.geometry,this.properties=N.tags,this.extent=B||4096}pr.prototype.feature=function(N){return new lr(this.features[N],this.options.extent)},lr.prototype.loadGeometry=function(){var N=this.rawGeometry;this.geometry=[];for(var B=0;B<N.length;B++){for(var $=N[B],ne=[],xe=0;xe<$.length;xe++)ne.push(new _.Point$1($[xe][0],$[xe][1]));this.geometry.push(ne)}return this.geometry},lr.prototype.bbox=function(){this.geometry||this.loadGeometry();for(var N=this.geometry,B=1/0,$=-1/0,ne=1/0,xe=-1/0,Fe=0;Fe<N.length;Fe++)for(var et=N[Fe],j=0;j<et.length;j++){var Q=et[j];B=Math.min(B,Q.x),$=Math.max($,Q.x),ne=Math.min(ne,Q.y),xe=Math.max(xe,Q.y)}return[B,ne,$,xe]},lr.prototype.toGeoJSON=Tt.prototype.toGeoJSON;var Ot=Ft,ht=wr;function Ft(N){var B=new _.pbf;return function($,ne){for(var xe in $.layers)ne.writeMessage(3,Qe,$.layers[xe])}(N,B),B.finish()}function Qe(N,B){var $;B.writeVarintField(15,N.version||1),B.writeStringField(1,N.name||""),B.writeVarintField(5,N.extent||4096);var ne={keys:[],values:[],keycache:{},valuecache:{}};for($=0;$<N.length;$++)ne.feature=N.feature($),B.writeMessage(2,Nt,ne);var xe=ne.keys;for($=0;$<xe.length;$++)B.writeStringField(3,xe[$]);var Fe=ne.values;for($=0;$<Fe.length;$++)B.writeMessage(4,Oe,Fe[$])}function Nt(N,B){var $=N.feature;$.id!==void 0&&B.writeVarintField(1,$.id),B.writeMessage(2,sr,N),B.writeVarintField(3,$.type),B.writeMessage(4,te,$)}function sr(N,B){var $=N.feature,ne=N.keys,xe=N.values,Fe=N.keycache,et=N.valuecache;for(var j in $.properties){var Q=Fe[j];Q===void 0&&(ne.push(j),Fe[j]=Q=ne.length-1),B.writeVarint(Q);var Le=$.properties[j],rt=typeof Le;rt!=="string"&&rt!=="boolean"&&rt!=="number"&&(Le=JSON.stringify(Le));var Ee=rt+":"+Le,Yt=et[Ee];Yt===void 0&&(xe.push(Le),et[Ee]=Yt=xe.length-1),B.writeVarint(Yt)}}function ie(N,B){return(B<<3)+(7&N)}function W(N){return N<<1^N>>31}function te(N,B){for(var $=N.loadGeometry(),ne=N.type,xe=0,Fe=0,et=$.length,j=0;j<et;j++){var Q=$[j],Le=1;ne===1&&(Le=Q.length),B.writeVarint(ie(1,Le));for(var rt=ne===3?Q.length-1:Q.length,Ee=0;Ee<rt;Ee++){Ee===1&&ne!==1&&B.writeVarint(ie(2,rt-1));var Yt=Q[Ee].x-xe,gr=Q[Ee].y-Fe;B.writeVarint(W(Yt)),B.writeVarint(W(gr)),xe+=Yt,Fe+=gr}ne===3&&B.writeVarint(ie(7,1))}}function Oe(N,B){var $=typeof N;$==="string"?B.writeStringField(1,N):$==="boolean"?B.writeBooleanField(7,N):$==="number"&&(N%1!=0?B.writeDoubleField(3,N):N<0?B.writeSVarintField(6,N):B.writeVarintField(5,N))}function Te(N,B,$,ne){nt(N,$,ne),nt(B,2*$,2*ne),nt(B,2*$+1,2*ne+1)}function nt(N,B,$){var ne=N[B];N[B]=N[$],N[$]=ne}function De(N,B,$,ne){var xe=N-$,Fe=B-ne;return xe*xe+Fe*Fe}Ot.fromVectorTileJs=Ft,Ot.fromGeojsonVt=function(N,B){B=B||{};var $={};for(var ne in N)$[ne]=new wr(N[ne].features,B),$[ne].name=ne,$[ne].version=B.version,$[ne].extent=B.extent;return Ft({layers:$})},Ot.GeoJSONWrapper=ht;var Ze=function(N){return N[0]},Ke=function(N){return N[1]},At=function(N,B,$,ne,xe){B===void 0&&(B=Ze),$===void 0&&($=Ke),ne===void 0&&(ne=64),xe===void 0&&(xe=Float64Array),this.nodeSize=ne,this.points=N;for(var Fe=N.length<65536?Uint16Array:Uint32Array,et=this.ids=new Fe(N.length),j=this.coords=new xe(2*N.length),Q=0;Q<N.length;Q++)et[Q]=Q,j[2*Q]=B(N[Q]),j[2*Q+1]=$(N[Q]);(function Le(rt,Ee,Yt,gr,tn,Qr){if(!(tn-gr<=Yt)){var rr=gr+tn>>1;(function Xr(zr,Vr,ei,sn,hi,Vi){for(;hi>sn;){if(hi-sn>600){var ci=hi-sn+1,Di=ei-sn+1,Ei=Math.log(ci),rs=.5*Math.exp(2*Ei/3),Qi=.5*Math.sqrt(Ei*rs*(ci-rs)/ci)*(Di-ci/2<0?-1:1);Xr(zr,Vr,ei,Math.max(sn,Math.floor(ei-Di*rs/ci+Qi)),Math.min(hi,Math.floor(ei+(ci-Di)*rs/ci+Qi)),Vi)}var Pa=Vr[2*ei+Vi],Si=sn,di=hi;for(Te(zr,Vr,sn,ei),Vr[2*hi+Vi]>Pa&&Te(zr,Vr,sn,hi);Si<di;){for(Te(zr,Vr,Si,di),Si++,di--;Vr[2*Si+Vi]<Pa;)Si++;for(;Vr[2*di+Vi]>Pa;)di--}Vr[2*sn+Vi]===Pa?Te(zr,Vr,sn,di):Te(zr,Vr,++di,hi),di<=ei&&(sn=di+1),ei<=di&&(hi=di-1)}})(rt,Ee,rr,gr,tn,Qr%2),Le(rt,Ee,Yt,gr,rr-1,Qr+1),Le(rt,Ee,Yt,rr+1,tn,Qr+1)}})(et,j,ne,0,et.length-1,0)};At.prototype.range=function(N,B,$,ne){return function(xe,Fe,et,j,Q,Le,rt){for(var Ee,Yt,gr=[0,xe.length-1,0],tn=[];gr.length;){var Qr=gr.pop(),rr=gr.pop(),Xr=gr.pop();if(rr-Xr<=rt)for(var zr=Xr;zr<=rr;zr++)Yt=Fe[2*zr+1],(Ee=Fe[2*zr])>=et&&Ee<=Q&&Yt>=j&&Yt<=Le&&tn.push(xe[zr]);else{var Vr=Math.floor((Xr+rr)/2);Yt=Fe[2*Vr+1],(Ee=Fe[2*Vr])>=et&&Ee<=Q&&Yt>=j&&Yt<=Le&&tn.push(xe[Vr]);var ei=(Qr+1)%2;(Qr===0?et<=Ee:j<=Yt)&&(gr.push(Xr),gr.push(Vr-1),gr.push(ei)),(Qr===0?Q>=Ee:Le>=Yt)&&(gr.push(Vr+1),gr.push(rr),gr.push(ei))}}return tn}(this.ids,this.coords,N,B,$,ne,this.nodeSize)},At.prototype.within=function(N,B,$){return function(ne,xe,Fe,et,j,Q){for(var Le=[0,ne.length-1,0],rt=[],Ee=j*j;Le.length;){var Yt=Le.pop(),gr=Le.pop(),tn=Le.pop();if(gr-tn<=Q)for(var Qr=tn;Qr<=gr;Qr++)De(xe[2*Qr],xe[2*Qr+1],Fe,et)<=Ee&&rt.push(ne[Qr]);else{var rr=Math.floor((tn+gr)/2),Xr=xe[2*rr],zr=xe[2*rr+1];De(Xr,zr,Fe,et)<=Ee&&rt.push(ne[rr]);var Vr=(Yt+1)%2;(Yt===0?Fe-j<=Xr:et-j<=zr)&&(Le.push(tn),Le.push(rr-1),Le.push(Vr)),(Yt===0?Fe+j>=Xr:et+j>=zr)&&(Le.push(rr+1),Le.push(gr),Le.push(Vr))}}return rt}(this.ids,this.coords,N,B,$,this.nodeSize)};var dr={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(N){return N}},Pt=function(N){this.options=bi(Object.create(dr),N),this.trees=new Array(this.options.maxZoom+1)};function fn(N,B,$,ne,xe){return{x:N,y:B,zoom:1/0,id:$,parentId:-1,numPoints:ne,properties:xe}}function cn(N,B){var $=N.geometry.coordinates,ne=$[1];return{x:Sn($[0]),y:Jr(ne),zoom:1/0,index:B,parentId:-1}}function Lr(N){return{type:"Feature",id:N.id,properties:Fn(N),geometry:{type:"Point",coordinates:[(ne=N.x,360*(ne-.5)),(B=N.y,$=(180-360*B)*Math.PI/180,360*Math.atan(Math.exp($))/Math.PI-90)]}};var B,$,ne}function Fn(N){var B=N.numPoints,$=B>=1e4?Math.round(B/1e3)+"k":B>=1e3?Math.round(B/100)/10+"k":B;return bi(bi({},N.properties),{cluster:!0,cluster_id:N.id,point_count:B,point_count_abbreviated:$})}function Sn(N){return N/360+.5}function Jr(N){var B=Math.sin(N*Math.PI/180),$=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return $<0?0:$>1?1:$}function bi(N,B){for(var $ in B)N[$]=B[$];return N}function Gn(N){return N.x}function zi(N){return N.y}function bn(N,B,$,ne,xe,Fe){var et=xe-$,j=Fe-ne;if(et!==0||j!==0){var Q=((N-$)*et+(B-ne)*j)/(et*et+j*j);Q>1?($=xe,ne=Fe):Q>0&&($+=et*Q,ne+=j*Q)}return(et=N-$)*et+(j=B-ne)*j}function Pn(N,B,$,ne){var xe={id:N===void 0?null:N,type:B,geometry:$,tags:ne,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};return function(Fe){var et=Fe.geometry,j=Fe.type;if(j==="Point"||j==="MultiPoint"||j==="LineString")Aa(Fe,et);else if(j==="Polygon"||j==="MultiLineString")for(var Q=0;Q<et.length;Q++)Aa(Fe,et[Q]);else if(j==="MultiPolygon")for(Q=0;Q<et.length;Q++)for(var Le=0;Le<et[Q].length;Le++)Aa(Fe,et[Q][Le])}(xe),xe}function Aa(N,B){for(var $=0;$<B.length;$+=3)N.minX=Math.min(N.minX,B[$]),N.minY=Math.min(N.minY,B[$+1]),N.maxX=Math.max(N.maxX,B[$]),N.maxY=Math.max(N.maxY,B[$+1])}function Zi(N,B,$,ne){if(B.geometry){var xe=B.geometry.coordinates,Fe=B.geometry.type,et=Math.pow($.tolerance/((1<<$.maxZoom)*$.extent),2),j=[],Q=B.id;if($.promoteId?Q=B.properties[$.promoteId]:$.generateId&&(Q=ne||0),Fe==="Point")Ma(xe,j);else if(Fe==="MultiPoint")for(var Le=0;Le<xe.length;Le++)Ma(xe[Le],j);else if(Fe==="LineString")To(xe,j,et,!1);else if(Fe==="MultiLineString"){if($.lineMetrics){for(Le=0;Le<xe.length;Le++)To(xe[Le],j=[],et,!1),N.push(Pn(Q,"LineString",j,B.properties));return}Ce(xe,j,et,!1)}else if(Fe==="Polygon")Ce(xe,j,et,!0);else{if(Fe!=="MultiPolygon"){if(Fe==="GeometryCollection"){for(Le=0;Le<B.geometry.geometries.length;Le++)Zi(N,{id:Q,geometry:B.geometry.geometries[Le],properties:B.properties},$,ne);return}throw new Error("Input data is not a valid GeoJSON object.")}for(Le=0;Le<xe.length;Le++){var rt=[];Ce(xe[Le],rt,et,!0),j.push(rt)}}N.push(Pn(Q,Fe,j,B.properties))}}function Ma(N,B){B.push(Ia(N[0])),B.push(Ta(N[1])),B.push(0)}function To(N,B,$,ne){for(var xe,Fe,et=0,j=0;j<N.length;j++){var Q=Ia(N[j][0]),Le=Ta(N[j][1]);B.push(Q),B.push(Le),B.push(0),j>0&&(et+=ne?(xe*Le-Q*Fe)/2:Math.sqrt(Math.pow(Q-xe,2)+Math.pow(Le-Fe,2))),xe=Q,Fe=Le}var rt=B.length-3;B[2]=1,function Ee(Yt,gr,tn,Qr){for(var rr,Xr=Qr,zr=tn-gr>>1,Vr=tn-gr,ei=Yt[gr],sn=Yt[gr+1],hi=Yt[tn],Vi=Yt[tn+1],ci=gr+3;ci<tn;ci+=3){var Di=bn(Yt[ci],Yt[ci+1],ei,sn,hi,Vi);if(Di>Xr)rr=ci,Xr=Di;else if(Di===Xr){var Ei=Math.abs(ci-zr);Ei<Vr&&(rr=ci,Vr=Ei)}}Xr>Qr&&(rr-gr>3&&Ee(Yt,gr,rr,Qr),Yt[rr+2]=Xr,tn-rr>3&&Ee(Yt,rr,tn,Qr))}(B,0,rt,$),B[rt+2]=1,B.size=Math.abs(et),B.start=0,B.end=B.size}function Ce(N,B,$,ne){for(var xe=0;xe<N.length;xe++){var Fe=[];To(N[xe],Fe,$,ne),B.push(Fe)}}function Ia(N){return N/360+.5}function Ta(N){var B=Math.sin(N*Math.PI/180),$=.5-.25*Math.log((1+B)/(1-B))/Math.PI;return $<0?0:$>1?1:$}function no(N,B,$,ne,xe,Fe,et,j){if(ne/=B,Fe>=($/=B)&&et<ne)return N;if(et<$||Fe>=ne)return null;for(var Q=[],Le=0;Le<N.length;Le++){var rt=N[Le],Ee=rt.geometry,Yt=rt.type,gr=xe===0?rt.minX:rt.minY,tn=xe===0?rt.maxX:rt.maxY;if(gr>=$&&tn<ne)Q.push(rt);else if(!(tn<$||gr>=ne)){var Qr=[];if(Yt==="Point"||Yt==="MultiPoint")qs(Ee,Qr,$,ne,xe);else if(Yt==="LineString")Rs(Ee,Qr,$,ne,xe,!1,j.lineMetrics);else if(Yt==="MultiLineString")Wt(Ee,Qr,$,ne,xe,!1);else if(Yt==="Polygon")Wt(Ee,Qr,$,ne,xe,!0);else if(Yt==="MultiPolygon")for(var rr=0;rr<Ee.length;rr++){var Xr=[];Wt(Ee[rr],Xr,$,ne,xe,!0),Xr.length&&Qr.push(Xr)}if(Qr.length){if(j.lineMetrics&&Yt==="LineString"){for(rr=0;rr<Qr.length;rr++)Q.push(Pn(rt.id,Yt,Qr[rr],rt.tags));continue}Yt!=="LineString"&&Yt!=="MultiLineString"||(Qr.length===1?(Yt="LineString",Qr=Qr[0]):Yt="MultiLineString"),Yt!=="Point"&&Yt!=="MultiPoint"||(Yt=Qr.length===3?"Point":"MultiPoint"),Q.push(Pn(rt.id,Yt,Qr,rt.tags))}}}return Q.length?Q:null}function qs(N,B,$,ne,xe){for(var Fe=0;Fe<N.length;Fe+=3){var et=N[Fe+xe];et>=$&&et<=ne&&(B.push(N[Fe]),B.push(N[Fe+1]),B.push(N[Fe+2]))}}function Rs(N,B,$,ne,xe,Fe,et){for(var j,Q,Le=ts(N),rt=xe===0?Gr:nn,Ee=N.start,Yt=0;Yt<N.length-3;Yt+=3){var gr=N[Yt],tn=N[Yt+1],Qr=N[Yt+2],rr=N[Yt+3],Xr=N[Yt+4],zr=xe===0?gr:tn,Vr=xe===0?rr:Xr,ei=!1;et&&(j=Math.sqrt(Math.pow(gr-rr,2)+Math.pow(tn-Xr,2))),zr<$?Vr>$&&(Q=rt(Le,gr,tn,rr,Xr,$),et&&(Le.start=Ee+j*Q)):zr>ne?Vr<ne&&(Q=rt(Le,gr,tn,rr,Xr,ne),et&&(Le.start=Ee+j*Q)):xr(Le,gr,tn,Qr),Vr<$&&zr>=$&&(Q=rt(Le,gr,tn,rr,Xr,$),ei=!0),Vr>ne&&zr<=ne&&(Q=rt(Le,gr,tn,rr,Xr,ne),ei=!0),!Fe&&ei&&(et&&(Le.end=Ee+j*Q),B.push(Le),Le=ts(N)),et&&(Ee+=j)}var sn=N.length-3;gr=N[sn],tn=N[sn+1],Qr=N[sn+2],(zr=xe===0?gr:tn)>=$&&zr<=ne&&xr(Le,gr,tn,Qr),sn=Le.length-3,Fe&&sn>=3&&(Le[sn]!==Le[0]||Le[sn+1]!==Le[1])&&xr(Le,Le[0],Le[1],Le[2]),Le.length&&B.push(Le)}function ts(N){var B=[];return B.size=N.size,B.start=N.start,B.end=N.end,B}function Wt(N,B,$,ne,xe,Fe){for(var et=0;et<N.length;et++)Rs(N[et],B,$,ne,xe,Fe,!1)}function xr(N,B,$,ne){N.push(B),N.push($),N.push(ne)}function Gr(N,B,$,ne,xe,Fe){var et=(Fe-B)/(ne-B);return N.push(Fe),N.push($+(xe-$)*et),N.push(1),et}function nn(N,B,$,ne,xe,Fe){var et=(Fe-$)/(xe-$);return N.push(B+(ne-B)*et),N.push(Fe),N.push(1),et}function Nn(N,B){for(var $=[],ne=0;ne<N.length;ne++){var xe,Fe=N[ne],et=Fe.type;if(et==="Point"||et==="MultiPoint"||et==="LineString")xe=Ki(Fe.geometry,B);else if(et==="MultiLineString"||et==="Polygon"){xe=[];for(var j=0;j<Fe.geometry.length;j++)xe.push(Ki(Fe.geometry[j],B))}else if(et==="MultiPolygon")for(xe=[],j=0;j<Fe.geometry.length;j++){for(var Q=[],Le=0;Le<Fe.geometry[j].length;Le++)Q.push(Ki(Fe.geometry[j][Le],B));xe.push(Q)}$.push(Pn(Fe.id,et,xe,Fe.tags))}return $}function Ki(N,B){var $=[];$.size=N.size,N.start!==void 0&&($.start=N.start,$.end=N.end);for(var ne=0;ne<N.length;ne+=3)$.push(N[ne]+B,N[ne+1],N[ne+2]);return $}function ue(N,B){if(N.transformed)return N;var $,ne,xe,Fe=1<<N.z,et=N.x,j=N.y;for($=0;$<N.features.length;$++){var Q=N.features[$],Le=Q.geometry,rt=Q.type;if(Q.geometry=[],rt===1)for(ne=0;ne<Le.length;ne+=2)Q.geometry.push(D(Le[ne],Le[ne+1],B,Fe,et,j));else for(ne=0;ne<Le.length;ne++){var Ee=[];for(xe=0;xe<Le[ne].length;xe+=2)Ee.push(D(Le[ne][xe],Le[ne][xe+1],B,Fe,et,j));Q.geometry.push(Ee)}}return N.transformed=!0,N}function D(N,B,$,ne,xe,Fe){return[Math.round($*(N*ne-xe)),Math.round($*(B*ne-Fe))]}function z(N,B,$,ne,xe){for(var Fe=B===xe.maxZoom?0:xe.tolerance/((1<<B)*xe.extent),et={features:[],numPoints:0,numSimplified:0,numFeatures:0,source:null,x:$,y:ne,z:B,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0},j=0;j<N.length;j++){et.numFeatures++,se(et,N[j],Fe,xe);var Q=N[j].minX,Le=N[j].minY,rt=N[j].maxX,Ee=N[j].maxY;Q<et.minX&&(et.minX=Q),Le<et.minY&&(et.minY=Le),rt>et.maxX&&(et.maxX=rt),Ee>et.maxY&&(et.maxY=Ee)}return et}function se(N,B,$,ne){var xe=B.geometry,Fe=B.type,et=[];if(Fe==="Point"||Fe==="MultiPoint")for(var j=0;j<xe.length;j+=3)et.push(xe[j]),et.push(xe[j+1]),N.numPoints++,N.numSimplified++;else if(Fe==="LineString")be(et,xe,N,$,!1,!1);else if(Fe==="MultiLineString"||Fe==="Polygon")for(j=0;j<xe.length;j++)be(et,xe[j],N,$,Fe==="Polygon",j===0);else if(Fe==="MultiPolygon")for(var Q=0;Q<xe.length;Q++){var Le=xe[Q];for(j=0;j<Le.length;j++)be(et,Le[j],N,$,!0,j===0)}if(et.length){var rt=B.tags||null;if(Fe==="LineString"&&ne.lineMetrics){for(var Ee in rt={},B.tags)rt[Ee]=B.tags[Ee];rt.mapbox_clip_start=xe.start/xe.size,rt.mapbox_clip_end=xe.end/xe.size}var Yt={geometry:et,type:Fe==="Polygon"||Fe==="MultiPolygon"?3:Fe==="LineString"||Fe==="MultiLineString"?2:1,tags:rt};B.id!==null&&(Yt.id=B.id),N.features.push(Yt)}}function be(N,B,$,ne,xe,Fe){var et=ne*ne;if(ne>0&&B.size<(xe?et:ne))$.numPoints+=B.length/3;else{for(var j=[],Q=0;Q<B.length;Q+=3)(ne===0||B[Q+2]>et)&&($.numSimplified++,j.push(B[Q]),j.push(B[Q+1])),$.numPoints++;xe&&function(Le,rt){for(var Ee=0,Yt=0,gr=Le.length,tn=gr-2;Yt<gr;tn=Yt,Yt+=2)Ee+=(Le[Yt]-Le[tn])*(Le[Yt+1]+Le[tn+1]);if(Ee>0===rt)for(Yt=0,gr=Le.length;Yt<gr/2;Yt+=2){var Qr=Le[Yt],rr=Le[Yt+1];Le[Yt]=Le[gr-2-Yt],Le[Yt+1]=Le[gr-1-Yt],Le[gr-2-Yt]=Qr,Le[gr-1-Yt]=rr}}(j,Fe),N.push(j)}}function ke(N,B){var $=(B=this.options=function(xe,Fe){for(var et in Fe)xe[et]=Fe[et];return xe}(Object.create(this.options),B)).debug;if($&&console.time("preprocess data"),B.maxZoom<0||B.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(B.promoteId&&B.generateId)throw new Error("promoteId and generateId cannot be used together.");var ne=function(xe,Fe){var et=[];if(xe.type==="FeatureCollection")for(var j=0;j<xe.features.length;j++)Zi(et,xe.features[j],Fe,j);else Zi(et,xe.type==="Feature"?xe:{geometry:xe},Fe);return et}(N,B);this.tiles={},this.tileCoords=[],$&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",B.indexMaxZoom,B.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),(ne=function(xe,Fe){var et=Fe.buffer/Fe.extent,j=xe,Q=no(xe,1,-1-et,et,0,-1,2,Fe),Le=no(xe,1,1-et,2+et,0,-1,2,Fe);return(Q||Le)&&(j=no(xe,1,-et,1+et,0,-1,2,Fe)||[],Q&&(j=Nn(Q,1).concat(j)),Le&&(j=j.concat(Nn(Le,-1)))),j}(ne,B)).length&&this.splitTile(ne,0,0,0),$&&(ne.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}function Ht(N,B,$){return 32*((1<<N)*$+B)+N}function Mt(N,B){var $=N.tileID.canonical;if(!this._geoJSONIndex)return B(null,null);var ne=this._geoJSONIndex.getTile($.z,$.x,$.y);if(!ne)return B(null,null);var xe=new at(ne.features),Fe=Ot(xe);Fe.byteOffset===0&&Fe.byteLength===Fe.buffer.byteLength||(Fe=new Uint8Array(Fe)),B(null,{vectorTile:xe,rawData:Fe.buffer})}Pt.prototype.load=function(N){var B=this.options,$=B.log,ne=B.minZoom,xe=B.maxZoom,Fe=B.nodeSize;$&&console.time("total time");var et="prepare "+N.length+" points";$&&console.time(et),this.points=N;for(var j=[],Q=0;Q<N.length;Q++)N[Q].geometry&&j.push(cn(N[Q],Q));this.trees[xe+1]=new At(j,Gn,zi,Fe,Float32Array),$&&console.timeEnd(et);for(var Le=xe;Le>=ne;Le--){var rt=+Date.now();j=this._cluster(j,Le),this.trees[Le]=new At(j,Gn,zi,Fe,Float32Array),$&&console.log("z%d: %d clusters in %dms",Le,j.length,+Date.now()-rt)}return $&&console.timeEnd("total time"),this},Pt.prototype.getClusters=function(N,B){var $=((N[0]+180)%360+360)%360-180,ne=Math.max(-90,Math.min(90,N[1])),xe=N[2]===180?180:((N[2]+180)%360+360)%360-180,Fe=Math.max(-90,Math.min(90,N[3]));if(N[2]-N[0]>=360)$=-180,xe=180;else if($>xe){var et=this.getClusters([$,ne,180,Fe],B),j=this.getClusters([-180,ne,xe,Fe],B);return et.concat(j)}for(var Q=this.trees[this._limitZoom(B)],Le=[],rt=0,Ee=Q.range(Sn($),Jr(Fe),Sn(xe),Jr(ne));rt<Ee.length;rt+=1){var Yt=Q.points[Ee[rt]];Le.push(Yt.numPoints?Lr(Yt):this.points[Yt.index])}return Le},Pt.prototype.getChildren=function(N){var B=this._getOriginId(N),$=this._getOriginZoom(N),ne="No cluster with the specified id.",xe=this.trees[$];if(!xe)throw new Error(ne);var Fe=xe.points[B];if(!Fe)throw new Error(ne);for(var et=this.options.radius/(this.options.extent*Math.pow(2,$-1)),j=[],Q=0,Le=xe.within(Fe.x,Fe.y,et);Q<Le.length;Q+=1){var rt=xe.points[Le[Q]];rt.parentId===N&&j.push(rt.numPoints?Lr(rt):this.points[rt.index])}if(j.length===0)throw new Error(ne);return j},Pt.prototype.getLeaves=function(N,B,$){var ne=[];return this._appendLeaves(ne,N,B=B||10,$=$||0,0),ne},Pt.prototype.getTile=function(N,B,$){var ne=this.trees[this._limitZoom(N)],xe=Math.pow(2,N),Fe=this.options,et=Fe.radius/Fe.extent,j=($-et)/xe,Q=($+1+et)/xe,Le={features:[]};return this._addTileFeatures(ne.range((B-et)/xe,j,(B+1+et)/xe,Q),ne.points,B,$,xe,Le),B===0&&this._addTileFeatures(ne.range(1-et/xe,j,1,Q),ne.points,xe,$,xe,Le),B===xe-1&&this._addTileFeatures(ne.range(0,j,et/xe,Q),ne.points,-1,$,xe,Le),Le.features.length?Le:null},Pt.prototype.getClusterExpansionZoom=function(N){for(var B=this._getOriginZoom(N)-1;B<=this.options.maxZoom;){var $=this.getChildren(N);if(B++,$.length!==1)break;N=$[0].properties.cluster_id}return B},Pt.prototype._appendLeaves=function(N,B,$,ne,xe){for(var Fe=0,et=this.getChildren(B);Fe<et.length;Fe+=1){var j=et[Fe],Q=j.properties;if(Q&&Q.cluster?xe+Q.point_count<=ne?xe+=Q.point_count:xe=this._appendLeaves(N,Q.cluster_id,$,ne,xe):xe<ne?xe++:N.push(j),N.length===$)break}return xe},Pt.prototype._addTileFeatures=function(N,B,$,ne,xe,Fe){for(var et=0,j=N;et<j.length;et+=1){var Q=B[j[et]],Le=Q.numPoints,rt={type:1,geometry:[[Math.round(this.options.extent*(Q.x*xe-$)),Math.round(this.options.extent*(Q.y*xe-ne))]],tags:Le?Fn(Q):this.points[Q.index].properties},Ee=void 0;Le?Ee=Q.id:this.options.generateId?Ee=Q.index:this.points[Q.index].id&&(Ee=this.points[Q.index].id),Ee!==void 0&&(rt.id=Ee),Fe.features.push(rt)}},Pt.prototype._limitZoom=function(N){return Math.max(this.options.minZoom,Math.min(+N,this.options.maxZoom+1))},Pt.prototype._cluster=function(N,B){for(var $=[],ne=this.options,xe=ne.reduce,Fe=ne.minPoints,et=ne.radius/(ne.extent*Math.pow(2,B)),j=0;j<N.length;j++){var Q=N[j];if(!(Q.zoom<=B)){Q.zoom=B;for(var Le=this.trees[B+1],rt=Le.within(Q.x,Q.y,et),Ee=Q.numPoints||1,Yt=Ee,gr=0,tn=rt;gr<tn.length;gr+=1){var Qr=Le.points[tn[gr]];Qr.zoom>B&&(Yt+=Qr.numPoints||1)}if(Yt>=Fe){for(var rr=Q.x*Ee,Xr=Q.y*Ee,zr=xe&&Ee>1?this._map(Q,!0):null,Vr=(j<<5)+(B+1)+this.points.length,ei=0,sn=rt;ei<sn.length;ei+=1){var hi=Le.points[sn[ei]];if(!(hi.zoom<=B)){hi.zoom=B;var Vi=hi.numPoints||1;rr+=hi.x*Vi,Xr+=hi.y*Vi,hi.parentId=Vr,xe&&(zr||(zr=this._map(Q,!0)),xe(zr,this._map(hi)))}}Q.parentId=Vr,$.push(fn(rr/Yt,Xr/Yt,Vr,Yt,zr))}else if($.push(Q),Yt>1)for(var ci=0,Di=rt;ci<Di.length;ci+=1){var Ei=Le.points[Di[ci]];Ei.zoom<=B||(Ei.zoom=B,$.push(Ei))}}}return $},Pt.prototype._getOriginId=function(N){return N-this.points.length>>5},Pt.prototype._getOriginZoom=function(N){return(N-this.points.length)%32},Pt.prototype._map=function(N,B){if(N.numPoints)return B?bi({},N.properties):N.properties;var $=this.points[N.index].properties,ne=this.options.map($);return B&&ne===$?bi({},ne):ne},ke.prototype.options={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0},ke.prototype.splitTile=function(N,B,$,ne,xe,Fe,et){for(var j=[N,B,$,ne],Q=this.options,Le=Q.debug;j.length;){ne=j.pop(),$=j.pop(),B=j.pop(),N=j.pop();var rt=1<<B,Ee=Ht(B,$,ne),Yt=this.tiles[Ee];if(!Yt&&(Le>1&&console.time("creation"),Yt=this.tiles[Ee]=z(N,B,$,ne,Q),this.tileCoords.push({z:B,x:$,y:ne}),Le)){Le>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",B,$,ne,Yt.numFeatures,Yt.numPoints,Yt.numSimplified),console.timeEnd("creation"));var gr="z"+B;this.stats[gr]=(this.stats[gr]||0)+1,this.total++}if(Yt.source=N,xe){if(B===Q.maxZoom||B===xe)continue;var tn=1<<xe-B;if($!==Math.floor(Fe/tn)||ne!==Math.floor(et/tn))continue}else if(B===Q.indexMaxZoom||Yt.numPoints<=Q.indexMaxPoints)continue;if(Yt.source=null,N.length!==0){Le>1&&console.time("clipping");var Qr,rr,Xr,zr,Vr,ei,sn=.5*Q.buffer/Q.extent,hi=.5-sn,Vi=.5+sn,ci=1+sn;Qr=rr=Xr=zr=null,Vr=no(N,rt,$-sn,$+Vi,0,Yt.minX,Yt.maxX,Q),ei=no(N,rt,$+hi,$+ci,0,Yt.minX,Yt.maxX,Q),N=null,Vr&&(Qr=no(Vr,rt,ne-sn,ne+Vi,1,Yt.minY,Yt.maxY,Q),rr=no(Vr,rt,ne+hi,ne+ci,1,Yt.minY,Yt.maxY,Q),Vr=null),ei&&(Xr=no(ei,rt,ne-sn,ne+Vi,1,Yt.minY,Yt.maxY,Q),zr=no(ei,rt,ne+hi,ne+ci,1,Yt.minY,Yt.maxY,Q),ei=null),Le>1&&console.timeEnd("clipping"),j.push(Qr||[],B+1,2*$,2*ne),j.push(rr||[],B+1,2*$,2*ne+1),j.push(Xr||[],B+1,2*$+1,2*ne),j.push(zr||[],B+1,2*$+1,2*ne+1)}}},ke.prototype.getTile=function(N,B,$){var ne=this.options,xe=ne.extent,Fe=ne.debug;if(N<0||N>24)return null;var et=1<<N,j=Ht(N,B=(B%et+et)%et,$);if(this.tiles[j])return ue(this.tiles[j],xe);Fe>1&&console.log("drilling down to z%d-%d-%d",N,B,$);for(var Q,Le=N,rt=B,Ee=$;!Q&&Le>0;)Le--,rt=Math.floor(rt/2),Ee=Math.floor(Ee/2),Q=this.tiles[Ht(Le,rt,Ee)];return Q&&Q.source?(Fe>1&&console.log("found parent tile z%d-%d-%d",Le,rt,Ee),Fe>1&&console.time("drilling down"),this.splitTile(Q.source,Le,rt,Ee,N,B,$),Fe>1&&console.timeEnd("drilling down"),this.tiles[j]?ue(this.tiles[j],xe):null):null};var Lt=function(N){function B($,ne,xe,Fe){N.call(this,$,ne,xe,Mt),Fe&&(this.loadGeoJSON=Fe)}return N&&(B.__proto__=N),(B.prototype=Object.create(N&&N.prototype)).constructor=B,B.prototype.loadData=function($,ne){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),this._pendingCallback=ne,this._pendingLoadDataParams=$,this._state&&this._state!=="Idle"?this._state="NeedsLoadData":(this._state="Coalescing",this._loadData())},B.prototype._loadData=function(){var $=this;if(this._pendingCallback&&this._pendingLoadDataParams){var ne=this._pendingCallback,xe=this._pendingLoadDataParams;delete this._pendingCallback,delete this._pendingLoadDataParams;var Fe=!!(xe&&xe.request&&xe.request.collectResourceTiming)&&new _.RequestPerformance(xe.request);this.loadGeoJSON(xe,function(et,j){if(et||!j)return ne(et);if(typeof j!="object")return ne(new Error("Input data given to '"+xe.source+"' is not a valid GeoJSON object."));(function Yt(gr,tn){var Qr,rr=gr&&gr.type;if(rr==="FeatureCollection")for(Qr=0;Qr<gr.features.length;Qr++)Yt(gr.features[Qr],tn);else if(rr==="GeometryCollection")for(Qr=0;Qr<gr.geometries.length;Qr++)Yt(gr.geometries[Qr],tn);else if(rr==="Feature")Yt(gr.geometry,tn);else if(rr==="Polygon")bt(gr.coordinates,tn);else if(rr==="MultiPolygon")for(Qr=0;Qr<gr.coordinates.length;Qr++)bt(gr.coordinates[Qr],tn);return gr})(j,!0);try{if(xe.filter){var Q=_.createExpression(xe.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Q.result==="error")throw new Error(Q.value.map(function(Yt){return Yt.key+": "+Yt.message}).join(", "));var Le=j.features.filter(function(Yt){return Q.value.evaluate({zoom:0},Yt)});j={type:"FeatureCollection",features:Le}}$._geoJSONIndex=xe.cluster?new Pt(function(Yt){var gr=Yt.superclusterOptions,tn=Yt.clusterProperties;if(!tn||!gr)return gr;for(var Qr={},rr={},Xr={accumulated:null,zoom:0},zr={properties:null},Vr=Object.keys(tn),ei=0,sn=Vr;ei<sn.length;ei+=1){var hi=sn[ei],Vi=tn[hi],ci=Vi[0],Di=_.createExpression(Vi[1]),Ei=_.createExpression(typeof ci=="string"?[ci,["accumulated"],["get",hi]]:ci);Qr[hi]=Di.value,rr[hi]=Ei.value}return gr.map=function(rs){zr.properties=rs;for(var Qi={},Pa=0,Si=Vr;Pa<Si.length;Pa+=1){var di=Si[Pa];Qi[di]=Qr[di].evaluate(Xr,zr)}return Qi},gr.reduce=function(rs,Qi){zr.properties=Qi;for(var Pa=0,Si=Vr;Pa<Si.length;Pa+=1){var di=Si[Pa];Xr.accumulated=rs[di],rs[di]=rr[di].evaluate(Xr,zr)}},gr}(xe)).load(j.features):function(Yt,gr){return new ke(Yt,gr)}(j,xe.geojsonVtOptions)}catch(Yt){return ne(Yt)}$.loaded={};var rt={};if(Fe){var Ee=Fe.finish();Ee&&(rt.resourceTiming={},rt.resourceTiming[xe.source]=JSON.parse(JSON.stringify(Ee)))}ne(null,rt)})}},B.prototype.coalesce=function(){this._state==="Coalescing"?this._state="Idle":this._state==="NeedsLoadData"&&(this._state="Coalescing",this._loadData())},B.prototype.reloadTile=function($,ne){var xe=this.loaded;return xe&&xe[$.uid]?N.prototype.reloadTile.call(this,$,ne):this.loadTile($,ne)},B.prototype.loadGeoJSON=function($,ne){if($.request)_.getJSON($.request,ne);else{if(typeof $.data!="string")return ne(new Error("Input data given to '"+$.source+"' is not a valid GeoJSON object."));try{return ne(null,JSON.parse($.data))}catch(xe){return ne(new Error("Input data given to '"+$.source+"' is not a valid GeoJSON object."))}}},B.prototype.removeSource=function($,ne){this._pendingCallback&&this._pendingCallback(null,{abandoned:!0}),ne()},B.prototype.getClusterExpansionZoom=function($,ne){try{ne(null,this._geoJSONIndex.getClusterExpansionZoom($.clusterId))}catch(xe){ne(xe)}},B.prototype.getClusterChildren=function($,ne){try{ne(null,this._geoJSONIndex.getChildren($.clusterId))}catch(xe){ne(xe)}},B.prototype.getClusterLeaves=function($,ne){try{ne(null,this._geoJSONIndex.getLeaves($.clusterId,$.limit,$.offset))}catch(xe){ne(xe)}},B}(qe),mt=function(N){var B=this;this.self=N,this.actor=new _.Actor(N,this),this.layerIndexes={},this.availableImages={},this.workerSourceTypes={vector:qe,geojson:Lt},this.workerSources={},this.demWorkerSources={},this.self.registerWorkerSource=function($,ne){if(B.workerSourceTypes[$])throw new Error('Worker source with name "'+$+'" already registered.');B.workerSourceTypes[$]=ne},this.self.registerRTLTextPlugin=function($){if(_.plugin.isParsed())throw new Error("RTL text plugin already registered.");_.plugin.applyArabicShaping=$.applyArabicShaping,_.plugin.processBidirectionalText=$.processBidirectionalText,_.plugin.processStyledBidirectionalText=$.processStyledBidirectionalText}};return mt.prototype.setReferrer=function(N,B){this.referrer=B},mt.prototype.setImages=function(N,B,$){for(var ne in this.availableImages[N]=B,this.workerSources[N]){var xe=this.workerSources[N][ne];for(var Fe in xe)xe[Fe].availableImages=B}$()},mt.prototype.setLayers=function(N,B,$){this.getLayerIndex(N).replace(B),$()},mt.prototype.updateLayers=function(N,B,$){this.getLayerIndex(N).update(B.layers,B.removedIds),$()},mt.prototype.loadTile=function(N,B,$){this.getWorkerSource(N,B.type,B.source).loadTile(B,$)},mt.prototype.loadDEMTile=function(N,B,$){this.getDEMWorkerSource(N,B.source).loadTile(B,$)},mt.prototype.reloadTile=function(N,B,$){this.getWorkerSource(N,B.type,B.source).reloadTile(B,$)},mt.prototype.abortTile=function(N,B,$){this.getWorkerSource(N,B.type,B.source).abortTile(B,$)},mt.prototype.removeTile=function(N,B,$){this.getWorkerSource(N,B.type,B.source).removeTile(B,$)},mt.prototype.removeDEMTile=function(N,B){this.getDEMWorkerSource(N,B.source).removeTile(B)},mt.prototype.removeSource=function(N,B,$){if(this.workerSources[N]&&this.workerSources[N][B.type]&&this.workerSources[N][B.type][B.source]){var ne=this.workerSources[N][B.type][B.source];delete this.workerSources[N][B.type][B.source],ne.removeSource!==void 0?ne.removeSource(B,$):$()}},mt.prototype.loadWorkerSource=function(N,B,$){try{this.self.importScripts(B.url),$()}catch(ne){$(ne.toString())}},mt.prototype.syncRTLPluginState=function(N,B,$){try{_.plugin.setState(B);var ne=_.plugin.getPluginURL();if(_.plugin.isLoaded()&&!_.plugin.isParsed()&&ne!=null){this.self.importScripts(ne);var xe=_.plugin.isParsed();$(xe?void 0:new Error("RTL Text Plugin failed to import scripts from "+ne),xe)}}catch(Fe){$(Fe.toString())}},mt.prototype.getAvailableImages=function(N){var B=this.availableImages[N];return B||(B=[]),B},mt.prototype.getLayerIndex=function(N){var B=this.layerIndexes[N];return B||(B=this.layerIndexes[N]=new he),B},mt.prototype.getWorkerSource=function(N,B,$){var ne=this;return this.workerSources[N]||(this.workerSources[N]={}),this.workerSources[N][B]||(this.workerSources[N][B]={}),this.workerSources[N][B][$]||(this.workerSources[N][B][$]=new this.workerSourceTypes[B]({send:function(xe,Fe,et){ne.actor.send(xe,Fe,et,N)}},this.getLayerIndex(N),this.getAvailableImages(N))),this.workerSources[N][B][$]},mt.prototype.getDEMWorkerSource=function(N,B){return this.demWorkerSources[N]||(this.demWorkerSources[N]={}),this.demWorkerSources[N][B]||(this.demWorkerSources[N][B]=new vt),this.demWorkerSources[N][B]},mt.prototype.enforceCacheSizeLimit=function(N,B){_.enforceCacheSizeLimit(B)},typeof WorkerGlobalScope!="undefined"&&typeof self!="undefined"&&self instanceof WorkerGlobalScope&&(self.worker=new mt(self)),mt}),ve(["./shared"],function(_){"use strict";var fe=_.createCommonjsModule(function(h){function v(S){return!p(S)}function p(S){return typeof window=="undefined"||typeof document=="undefined"?"not a browser":Array.prototype&&Array.prototype.every&&Array.prototype.filter&&Array.prototype.forEach&&Array.prototype.indexOf&&Array.prototype.lastIndexOf&&Array.prototype.map&&Array.prototype.some&&Array.prototype.reduce&&Array.prototype.reduceRight&&Array.isArray?Function.prototype&&Function.prototype.bind?Object.keys&&Object.create&&Object.getPrototypeOf&&Object.getOwnPropertyNames&&Object.isSealed&&Object.isFrozen&&Object.isExtensible&&Object.getOwnPropertyDescriptor&&Object.defineProperty&&Object.defineProperties&&Object.seal&&Object.freeze&&Object.preventExtensions?"JSON"in window&&"parse"in JSON&&"stringify"in JSON?function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var C,O,X=new Blob([""],{type:"text/javascript"}),J=URL.createObjectURL(X);try{O=new Worker(J),C=!0}catch(me){C=!1}return O&&O.terminate(),URL.revokeObjectURL(J),C}()?"Uint8ClampedArray"in window?ArrayBuffer.isView?function(){var C=document.createElement("canvas");C.width=C.height=1;var O=C.getContext("2d");if(!O)return!1;var X=O.getImageData(0,0,1,1);return X&&X.width===C.width}()?(g[w=S&&S.failIfMajorPerformanceCaveat]===void 0&&(g[w]=function(C){var O=function(J){var me=document.createElement("canvas"),ye=Object.create(v.webGLContextAttributes);return ye.failIfMajorPerformanceCaveat=J,me.probablySupportsContext?me.probablySupportsContext("webgl",ye)||me.probablySupportsContext("experimental-webgl",ye):me.supportsContext?me.supportsContext("webgl",ye)||me.supportsContext("experimental-webgl",ye):me.getContext("webgl",ye)||me.getContext("experimental-webgl",ye)}(C);if(!O)return!1;var X=O.createShader(O.VERTEX_SHADER);return!(!X||O.isContextLost())&&(O.shaderSource(X,"void main() {}"),O.compileShader(X),O.getShaderParameter(X,O.COMPILE_STATUS)===!0)}(w)),g[w]?void 0:"insufficient WebGL support"):"insufficient Canvas/getImageData support":"insufficient ArrayBuffer support":"insufficient Uint8ClampedArray support":"insufficient worker support":"insufficient JSON support":"insufficient Object support":"insufficient Function support":"insufficent Array support";var w}h.exports?h.exports=v:window&&(window.mapboxgl=window.mapboxgl||{},window.mapboxgl.supported=v,window.mapboxgl.notSupportedReason=p);var g={};v.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0}}),Z={create:function(h,v,p){var g=_.window.document.createElement(h);return v!==void 0&&(g.className=v),p&&p.appendChild(g),g},createNS:function(h,v){return _.window.document.createElementNS(h,v)}},he=_.window.document&&_.window.document.documentElement.style;function ce(h){if(!he)return h[0];for(var v=0;v<h.length;v++)if(h[v]in he)return h[v];return h[0]}var Ge,oe=ce(["userSelect","MozUserSelect","WebkitUserSelect","msUserSelect"]);Z.disableDrag=function(){he&&oe&&(Ge=he[oe],he[oe]="none")},Z.enableDrag=function(){he&&oe&&(he[oe]=Ge)};var We=ce(["transform","WebkitTransform"]);Z.setTransform=function(h,v){h.style[We]=v};var qe=!1;try{var pt=Object.defineProperty({},"passive",{get:function(){qe=!0}});_.window.addEventListener("test",pt,pt),_.window.removeEventListener("test",pt,pt)}catch(h){qe=!1}Z.addEventListener=function(h,v,p,g){g===void 0&&(g={}),h.addEventListener(v,p,"passive"in g&&qe?g:g.capture)},Z.removeEventListener=function(h,v,p,g){g===void 0&&(g={}),h.removeEventListener(v,p,"passive"in g&&qe?g:g.capture)};var vt=function(h){h.preventDefault(),h.stopPropagation(),_.window.removeEventListener("click",vt,!0)};function bt(h){var v=h.userImage;return!!(v&&v.render&&v.render())&&(h.data.replace(new Uint8Array(v.data.buffer)),!0)}Z.suppressClick=function(){_.window.addEventListener("click",vt,!0),_.window.setTimeout(function(){_.window.removeEventListener("click",vt,!0)},0)},Z.mousePos=function(h,v){var p=h.getBoundingClientRect();return new _.Point(v.clientX-p.left-h.clientLeft,v.clientY-p.top-h.clientTop)},Z.touchPos=function(h,v){for(var p=h.getBoundingClientRect(),g=[],S=0;S<v.length;S++)g.push(new _.Point(v[S].clientX-p.left-h.clientLeft,v[S].clientY-p.top-h.clientTop));return g},Z.mouseButton=function(h){return _.window.InstallTrigger!==void 0&&h.button===2&&h.ctrlKey&&_.window.navigator.platform.toUpperCase().indexOf("MAC")>=0?0:h.button},Z.remove=function(h){h.parentNode&&h.parentNode.removeChild(h)};var Et=function(h){function v(){h.call(this),this.images={},this.updatedImages={},this.callbackDispatchedThisFrame={},this.loaded=!1,this.requestors=[],this.patterns={},this.atlasImage=new _.RGBAImage({width:1,height:1}),this.dirty=!0}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.isLoaded=function(){return this.loaded},v.prototype.setLoaded=function(p){if(this.loaded!==p&&(this.loaded=p,p)){for(var g=0,S=this.requestors;g<S.length;g+=1){var w=S[g];this._notify(w.ids,w.callback)}this.requestors=[]}},v.prototype.getImage=function(p){return this.images[p]},v.prototype.addImage=function(p,g){this._validate(p,g)&&(this.images[p]=g)},v.prototype._validate=function(p,g){var S=!0;return this._validateStretch(g.stretchX,g.data&&g.data.width)||(this.fire(new _.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchX" value'))),S=!1),this._validateStretch(g.stretchY,g.data&&g.data.height)||(this.fire(new _.ErrorEvent(new Error('Image "'+p+'" has invalid "stretchY" value'))),S=!1),this._validateContent(g.content,g)||(this.fire(new _.ErrorEvent(new Error('Image "'+p+'" has invalid "content" value'))),S=!1),S},v.prototype._validateStretch=function(p,g){if(!p)return!0;for(var S=0,w=0,C=p;w<C.length;w+=1){var O=C[w];if(O[0]<S||O[1]<O[0]||g<O[1])return!1;S=O[1]}return!0},v.prototype._validateContent=function(p,g){return!(p&&(p.length!==4||p[0]<0||g.data.width<p[0]||p[1]<0||g.data.height<p[1]||p[2]<0||g.data.width<p[2]||p[3]<0||g.data.height<p[3]||p[2]<p[0]||p[3]<p[1]))},v.prototype.updateImage=function(p,g){g.version=this.images[p].version+1,this.images[p]=g,this.updatedImages[p]=!0},v.prototype.removeImage=function(p){var g=this.images[p];delete this.images[p],delete this.patterns[p],g.userImage&&g.userImage.onRemove&&g.userImage.onRemove()},v.prototype.listImages=function(){return Object.keys(this.images)},v.prototype.getImages=function(p,g){var S=!0;if(!this.isLoaded())for(var w=0,C=p;w<C.length;w+=1)this.images[C[w]]||(S=!1);this.isLoaded()||S?this._notify(p,g):this.requestors.push({ids:p,callback:g})},v.prototype._notify=function(p,g){for(var S={},w=0,C=p;w<C.length;w+=1){var O=C[w];this.images[O]||this.fire(new _.Event("styleimagemissing",{id:O}));var X=this.images[O];X?S[O]={data:X.data.clone(),pixelRatio:X.pixelRatio,sdf:X.sdf,version:X.version,stretchX:X.stretchX,stretchY:X.stretchY,content:X.content,hasRenderCallback:!!(X.userImage&&X.userImage.render)}:_.warnOnce('Image "'+O+'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.')}g(null,S)},v.prototype.getPixelSize=function(){var p=this.atlasImage;return{width:p.width,height:p.height}},v.prototype.getPattern=function(p){var g=this.patterns[p],S=this.getImage(p);if(!S)return null;if(g&&g.position.version===S.version)return g.position;if(g)g.position.version=S.version;else{var w={w:S.data.width+2,h:S.data.height+2,x:0,y:0},C=new _.ImagePosition(w,S);this.patterns[p]={bin:w,position:C}}return this._updatePatternAtlas(),this.patterns[p].position},v.prototype.bind=function(p){var g=p.gl;this.atlasTexture?this.dirty&&(this.atlasTexture.update(this.atlasImage),this.dirty=!1):this.atlasTexture=new _.Texture(p,this.atlasImage,g.RGBA),this.atlasTexture.bind(g.LINEAR,g.CLAMP_TO_EDGE)},v.prototype._updatePatternAtlas=function(){var p=[];for(var g in this.patterns)p.push(this.patterns[g].bin);var S=_.potpack(p),w=S.w,C=S.h,O=this.atlasImage;for(var X in O.resize({width:w||1,height:C||1}),this.patterns){var J=this.patterns[X].bin,me=J.x+1,ye=J.y+1,Ae=this.images[X].data,Ve=Ae.width,Ue=Ae.height;_.RGBAImage.copy(Ae,O,{x:0,y:0},{x:me,y:ye},{width:Ve,height:Ue}),_.RGBAImage.copy(Ae,O,{x:0,y:Ue-1},{x:me,y:ye-1},{width:Ve,height:1}),_.RGBAImage.copy(Ae,O,{x:0,y:0},{x:me,y:ye+Ue},{width:Ve,height:1}),_.RGBAImage.copy(Ae,O,{x:Ve-1,y:0},{x:me-1,y:ye},{width:1,height:Ue}),_.RGBAImage.copy(Ae,O,{x:0,y:0},{x:me+Ve,y:ye},{width:1,height:Ue})}this.dirty=!0},v.prototype.beginFrame=function(){this.callbackDispatchedThisFrame={}},v.prototype.dispatchRenderCallbacks=function(p){for(var g=0,S=p;g<S.length;g+=1){var w=S[g];if(!this.callbackDispatchedThisFrame[w]){this.callbackDispatchedThisFrame[w]=!0;var C=this.images[w];bt(C)&&this.updateImage(w,C)}}},v}(_.Evented),Dt=Tt,wt=Tt,at=1e20;function Tt(h,v,p,g,S,w){this.fontSize=h||24,this.buffer=v===void 0?3:v,this.cutoff=g||.25,this.fontFamily=S||"sans-serif",this.fontWeight=w||"normal",this.radius=p||8;var C=this.size=this.fontSize+2*this.buffer;this.canvas=document.createElement("canvas"),this.canvas.width=this.canvas.height=C,this.ctx=this.canvas.getContext("2d"),this.ctx.font=this.fontWeight+" "+this.fontSize+"px "+this.fontFamily,this.ctx.textBaseline="middle",this.ctx.fillStyle="black",this.gridOuter=new Float64Array(C*C),this.gridInner=new Float64Array(C*C),this.f=new Float64Array(C),this.d=new Float64Array(C),this.z=new Float64Array(C+1),this.v=new Int16Array(C),this.middle=Math.round(C/2*(navigator.userAgent.indexOf("Gecko/")>=0?1.2:1))}function wr(h,v,p,g,S,w,C){for(var O=0;O<v;O++){for(var X=0;X<p;X++)g[X]=h[X*v+O];for(pr(g,S,w,C,p),X=0;X<p;X++)h[X*v+O]=S[X]}for(X=0;X<p;X++){for(O=0;O<v;O++)g[O]=h[X*v+O];for(pr(g,S,w,C,v),O=0;O<v;O++)h[X*v+O]=Math.sqrt(S[O])}}function pr(h,v,p,g,S){p[0]=0,g[0]=-at,g[1]=+at;for(var w=1,C=0;w<S;w++){for(var O=(h[w]+w*w-(h[p[C]]+p[C]*p[C]))/(2*w-2*p[C]);O<=g[C];)C--,O=(h[w]+w*w-(h[p[C]]+p[C]*p[C]))/(2*w-2*p[C]);p[++C]=w,g[C]=O,g[C+1]=+at}for(w=0,C=0;w<S;w++){for(;g[C+1]<w;)C++;v[w]=(w-p[C])*(w-p[C])+h[p[C]]}}Tt.prototype.draw=function(h){this.ctx.clearRect(0,0,this.size,this.size),this.ctx.fillText(h,this.buffer,this.middle);for(var v=this.ctx.getImageData(0,0,this.size,this.size),p=new Uint8ClampedArray(this.size*this.size),g=0;g<this.size*this.size;g++){var S=v.data[4*g+3]/255;this.gridOuter[g]=S===1?0:S===0?at:Math.pow(Math.max(0,.5-S),2),this.gridInner[g]=S===1?at:S===0?0:Math.pow(Math.max(0,S-.5),2)}for(wr(this.gridOuter,this.size,this.size,this.f,this.d,this.v,this.z),wr(this.gridInner,this.size,this.size,this.f,this.d,this.v,this.z),g=0;g<this.size*this.size;g++)p[g]=Math.max(0,Math.min(255,Math.round(255-255*((this.gridOuter[g]-this.gridInner[g])/this.radius+this.cutoff))));return p},Dt.default=wt;var lr=function(h,v){this.requestManager=h,this.localIdeographFontFamily=v,this.entries={}};lr.prototype.setURL=function(h){this.url=h},lr.prototype.getGlyphs=function(h,v){var p=this,g=[];for(var S in h)for(var w=0,C=h[S];w<C.length;w+=1)g.push({stack:S,id:C[w]});_.asyncAll(g,function(O,X){var J=O.stack,me=O.id,ye=p.entries[J];ye||(ye=p.entries[J]={glyphs:{},requests:{},ranges:{}});var Ae=ye.glyphs[me];if(Ae===void 0){if(Ae=p._tinySDF(ye,J,me))return ye.glyphs[me]=Ae,void X(null,{stack:J,id:me,glyph:Ae});var Ve=Math.floor(me/256);if(256*Ve>65535)X(new Error("glyphs > 65535 not supported"));else if(ye.ranges[Ve])X(null,{stack:J,id:me,glyph:Ae});else{var Ue=ye.requests[Ve];Ue||(Ue=ye.requests[Ve]=[],lr.loadGlyphRange(J,Ve,p.url,p.requestManager,function(lt,Be){if(Be){for(var st in Be)p._doesCharSupportLocalGlyph(+st)||(ye.glyphs[+st]=Be[+st]);ye.ranges[Ve]=!0}for(var xt=0,Ut=Ue;xt<Ut.length;xt+=1)(0,Ut[xt])(lt,Be);delete ye.requests[Ve]})),Ue.push(function(lt,Be){lt?X(lt):Be&&X(null,{stack:J,id:me,glyph:Be[me]||null})})}}else X(null,{stack:J,id:me,glyph:Ae})},function(O,X){if(O)v(O);else if(X){for(var J={},me=0,ye=X;me<ye.length;me+=1){var Ae=ye[me],Ve=Ae.stack,Ue=Ae.id,lt=Ae.glyph;(J[Ve]||(J[Ve]={}))[Ue]=lt&&{id:lt.id,bitmap:lt.bitmap.clone(),metrics:lt.metrics}}v(null,J)}})},lr.prototype._doesCharSupportLocalGlyph=function(h){return!!this.localIdeographFontFamily&&(_.isChar["CJK Unified Ideographs"](h)||_.isChar["Hangul Syllables"](h)||_.isChar.Hiragana(h)||_.isChar.Katakana(h))},lr.prototype._tinySDF=function(h,v,p){var g=this.localIdeographFontFamily;if(g&&this._doesCharSupportLocalGlyph(p)){var S=h.tinySDF;if(!S){var w="400";/bold/i.test(v)?w="900":/medium/i.test(v)?w="500":/light/i.test(v)&&(w="200"),S=h.tinySDF=new lr.TinySDF(24,3,8,.25,g,w)}return{id:p,bitmap:new _.AlphaImage({width:30,height:30},S.draw(String.fromCharCode(p))),metrics:{width:24,height:24,left:0,top:-8,advance:24}}}},lr.loadGlyphRange=function(h,v,p,g,S){var w=256*v,C=w+255,O=g.transformRequest(g.normalizeGlyphsURL(p).replace("{fontstack}",h).replace("{range}",w+"-"+C),_.ResourceType.Glyphs);_.getArrayBuffer(O,function(X,J){if(X)S(X);else if(J){for(var me={},ye=0,Ae=_.parseGlyphPBF(J);ye<Ae.length;ye+=1){var Ve=Ae[ye];me[Ve.id]=Ve}S(null,me)}})},lr.TinySDF=Dt;var Ot=function(){this.specification=_.styleSpec.light.position};Ot.prototype.possiblyEvaluate=function(h,v){return _.sphericalToCartesian(h.expression.evaluate(v))},Ot.prototype.interpolate=function(h,v,p){return{x:_.number(h.x,v.x,p),y:_.number(h.y,v.y,p),z:_.number(h.z,v.z,p)}};var ht=new _.Properties({anchor:new _.DataConstantProperty(_.styleSpec.light.anchor),position:new Ot,color:new _.DataConstantProperty(_.styleSpec.light.color),intensity:new _.DataConstantProperty(_.styleSpec.light.intensity)}),Ft=function(h){function v(p){h.call(this),this._transitionable=new _.Transitionable(ht),this.setLight(p),this._transitioning=this._transitionable.untransitioned()}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getLight=function(){return this._transitionable.serialize()},v.prototype.setLight=function(p,g){if(g===void 0&&(g={}),!this._validate(_.validateLight,p,g))for(var S in p){var w=p[S];_.endsWith(S,"-transition")?this._transitionable.setTransition(S.slice(0,-11),w):this._transitionable.setValue(S,w)}},v.prototype.updateTransitions=function(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)},v.prototype.hasTransition=function(){return this._transitioning.hasTransition()},v.prototype.recalculate=function(p){this.properties=this._transitioning.possiblyEvaluate(p)},v.prototype._validate=function(p,g,S){return(!S||S.validate!==!1)&&_.emitValidationErrors(this,p.call(_.validateStyle,_.extend({value:g,style:{glyphs:!0,sprite:!0},styleSpec:_.styleSpec})))},v}(_.Evented),Qe=function(h,v){this.width=h,this.height=v,this.nextRow=0,this.data=new Uint8Array(this.width*this.height),this.dashEntry={}};Qe.prototype.getDash=function(h,v){var p=h.join(",")+String(v);return this.dashEntry[p]||(this.dashEntry[p]=this.addDash(h,v)),this.dashEntry[p]},Qe.prototype.getDashRanges=function(h,v,p){var g=[],S=h.length%2==1?-h[h.length-1]*p:0,w=h[0]*p,C=!0;g.push({left:S,right:w,isDash:C,zeroLength:h[0]===0});for(var O=h[0],X=1;X<h.length;X++){var J=h[X];g.push({left:S=O*p,right:w=(O+=J)*p,isDash:C=!C,zeroLength:J===0})}return g},Qe.prototype.addRoundDash=function(h,v,p){for(var g=v/2,S=-p;S<=p;S++)for(var w=this.width*(this.nextRow+p+S),C=0,O=h[C],X=0;X<this.width;X++){X/O.right>1&&(O=h[++C]);var J=Math.abs(X-O.left),me=Math.abs(X-O.right),ye=Math.min(J,me),Ae=void 0,Ve=S/p*(g+1);if(O.isDash){var Ue=g-Math.abs(Ve);Ae=Math.sqrt(ye*ye+Ue*Ue)}else Ae=g-Math.sqrt(ye*ye+Ve*Ve);this.data[w+X]=Math.max(0,Math.min(255,Ae+128))}},Qe.prototype.addRegularDash=function(h){for(var v=h.length-1;v>=0;--v){var p=h[v],g=h[v+1];p.zeroLength?h.splice(v,1):g&&g.isDash===p.isDash&&(g.left=p.left,h.splice(v,1))}var S=h[0],w=h[h.length-1];S.isDash===w.isDash&&(S.left=w.left-this.width,w.right=S.right+this.width);for(var C=this.width*this.nextRow,O=0,X=h[O],J=0;J<this.width;J++){J/X.right>1&&(X=h[++O]);var me=Math.abs(J-X.left),ye=Math.abs(J-X.right),Ae=Math.min(me,ye);this.data[C+J]=Math.max(0,Math.min(255,(X.isDash?Ae:-Ae)+128))}},Qe.prototype.addDash=function(h,v){var p=v?7:0,g=2*p+1;if(this.nextRow+g>this.height)return _.warnOnce("LineAtlas out of space"),null;for(var S=0,w=0;w<h.length;w++)S+=h[w];if(S!==0){var C=this.width/S,O=this.getDashRanges(h,this.width,C);v?this.addRoundDash(O,C,p):this.addRegularDash(O)}var X={y:(this.nextRow+p+.5)/this.height,height:2*p/this.height,width:S};return this.nextRow+=g,this.dirty=!0,X},Qe.prototype.bind=function(h){var v=h.gl;this.texture?(v.bindTexture(v.TEXTURE_2D,this.texture),this.dirty&&(this.dirty=!1,v.texSubImage2D(v.TEXTURE_2D,0,0,0,this.width,this.height,v.ALPHA,v.UNSIGNED_BYTE,this.data))):(this.texture=v.createTexture(),v.bindTexture(v.TEXTURE_2D,this.texture),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_S,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_WRAP_T,v.REPEAT),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MIN_FILTER,v.LINEAR),v.texParameteri(v.TEXTURE_2D,v.TEXTURE_MAG_FILTER,v.LINEAR),v.texImage2D(v.TEXTURE_2D,0,v.ALPHA,this.width,this.height,0,v.ALPHA,v.UNSIGNED_BYTE,this.data))};var Nt=function h(v,p){this.workerPool=v,this.actors=[],this.currentActor=0,this.id=_.uniqueId();for(var g=this.workerPool.acquire(this.id),S=0;S<g.length;S++){var w=new h.Actor(g[S],p,this.id);w.name="Worker "+S,this.actors.push(w)}};function sr(h,v,p){var g=function(S,w){if(S)return p(S);if(w){var C=_.pick(_.extend(w,h),["tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","scheme","tileSize","encoding"]);w.vector_layers&&(C.vectorLayers=w.vector_layers,C.vectorLayerIds=C.vectorLayers.map(function(O){return O.id})),C.tiles=v.canonicalizeTileset(C,h.url),p(null,C)}};return h.url?_.getJSON(v.transformRequest(v.normalizeSourceURL(h.url),_.ResourceType.Source),g):_.browser.frame(function(){return g(null,h)})}Nt.prototype.broadcast=function(h,v,p){_.asyncAll(this.actors,function(g,S){g.send(h,v,S)},p=p||function(){})},Nt.prototype.getActor=function(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]},Nt.prototype.remove=function(){this.actors.forEach(function(h){h.remove()}),this.actors=[],this.workerPool.release(this.id)},Nt.Actor=_.Actor;var ie=function(h,v,p){this.bounds=_.LngLatBounds.convert(this.validateBounds(h)),this.minzoom=v||0,this.maxzoom=p||24};ie.prototype.validateBounds=function(h){return Array.isArray(h)&&h.length===4?[Math.max(-180,h[0]),Math.max(-90,h[1]),Math.min(180,h[2]),Math.min(90,h[3])]:[-180,-90,180,90]},ie.prototype.contains=function(h){var v=Math.pow(2,h.z),p=Math.floor(_.mercatorXfromLng(this.bounds.getWest())*v),g=Math.floor(_.mercatorYfromLat(this.bounds.getNorth())*v),S=Math.ceil(_.mercatorXfromLng(this.bounds.getEast())*v),w=Math.ceil(_.mercatorYfromLat(this.bounds.getSouth())*v);return h.x>=p&&h.x<S&&h.y>=g&&h.y<w};var W=function(h){function v(p,g,S,w){if(h.call(this),this.id=p,this.dispatcher=S,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,_.extend(this,_.pick(g,["url","scheme","tileSize","promoteId"])),this._options=_.extend({type:"vector"},g),this._collectResourceTiming=g.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(w)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=sr(this._options,this.map._requestManager,function(g,S){p._tileJSONRequest=null,p._loaded=!0,g?p.fire(new _.ErrorEvent(g)):S&&(_.extend(p,S),S.bounds&&(p.tileBounds=new ie(S.bounds,p.minzoom,p.maxzoom)),_.postTurnstileEvent(S.tiles,p.map._requestManager._customAccessToken),_.postMapLoadEvent(S.tiles,p.map._getMapId(),p.map._requestManager._skuToken,p.map._requestManager._customAccessToken),p.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.setSourceProperty=function(p){this._tileJSONRequest&&this._tileJSONRequest.cancel(),p(),this.map.style.sourceCaches[this.id].clearTiles(),this.load()},v.prototype.setTiles=function(p){var g=this;return this.setSourceProperty(function(){g._options.tiles=p}),this},v.prototype.setUrl=function(p){var g=this;return this.setSourceProperty(function(){g.url=p,g._options.url=p}),this},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return _.extend({},this._options)},v.prototype.loadTile=function(p,g){var S=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),w={request:this.map._requestManager.transformRequest(S,_.ResourceType.Tile),uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,pixelRatio:_.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId};function C(O,X){return delete p.request,p.aborted?g(null):O&&O.status!==404?g(O):(X&&X.resourceTiming&&(p.resourceTiming=X.resourceTiming),this.map._refreshExpiredTiles&&X&&p.setExpiryData(X),p.loadVectorData(X,this.map.painter),_.cacheEntryPossiblyAdded(this.dispatcher),g(null),void(p.reloadCallback&&(this.loadTile(p,p.reloadCallback),p.reloadCallback=null)))}w.request.collectResourceTiming=this._collectResourceTiming,p.actor&&p.state!=="expired"?p.state==="loading"?p.reloadCallback=g:p.request=p.actor.send("reloadTile",w,C.bind(this)):(p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",w,C.bind(this)))},v.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.actor&&p.actor.send("abortTile",{uid:p.uid,type:this.type,source:this.id},void 0)},v.prototype.unloadTile=function(p){p.unloadVectorData(),p.actor&&p.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id},void 0)},v.prototype.hasTransition=function(){return!1},v}(_.Evented),te=function(h){function v(p,g,S,w){h.call(this),this.id=p,this.dispatcher=S,this.setEventedParent(w),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=_.extend({type:"raster"},g),_.extend(this,_.pick(g,["url","scheme","tileSize"]))}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this._tileJSONRequest=sr(this._options,this.map._requestManager,function(g,S){p._tileJSONRequest=null,p._loaded=!0,g?p.fire(new _.ErrorEvent(g)):S&&(_.extend(p,S),S.bounds&&(p.tileBounds=new ie(S.bounds,p.minzoom,p.maxzoom)),_.postTurnstileEvent(S.tiles),_.postMapLoadEvent(S.tiles,p.map._getMapId(),p.map._requestManager._skuToken),p.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})),p.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})))})},v.prototype.loaded=function(){return this._loaded},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.onRemove=function(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)},v.prototype.serialize=function(){return _.extend({},this._options)},v.prototype.hasTile=function(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)},v.prototype.loadTile=function(p,g){var S=this,w=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);p.request=_.getImage(this.map._requestManager.transformRequest(w,_.ResourceType.Tile),function(C,O){if(delete p.request,p.aborted)p.state="unloaded",g(null);else if(C)p.state="errored",g(C);else if(O){S.map._refreshExpiredTiles&&p.setExpiryData(O),delete O.cacheControl,delete O.expires;var X=S.map.painter.context,J=X.gl;p.texture=S.map.painter.getTileTexture(O.width),p.texture?p.texture.update(O,{useMipmap:!0}):(p.texture=new _.Texture(X,O,J.RGBA,{useMipmap:!0}),p.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE,J.LINEAR_MIPMAP_NEAREST),X.extTextureFilterAnisotropic&&J.texParameterf(J.TEXTURE_2D,X.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,X.extTextureFilterAnisotropicMax)),p.state="loaded",_.cacheEntryPossiblyAdded(S.dispatcher),g(null)}})},v.prototype.abortTile=function(p,g){p.request&&(p.request.cancel(),delete p.request),g()},v.prototype.unloadTile=function(p,g){p.texture&&this.map.painter.saveTileTexture(p.texture),g()},v.prototype.hasTransition=function(){return!1},v}(_.Evented),Oe=function(h){function v(p,g,S,w){h.call(this,p,g,S,w),this.type="raster-dem",this.maxzoom=22,this._options=_.extend({type:"raster-dem"},g),this.encoding=g.encoding||"mapbox"}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.serialize=function(){return{type:"raster-dem",url:this.url,tileSize:this.tileSize,tiles:this.tiles,bounds:this.bounds,encoding:this.encoding}},v.prototype.loadTile=function(p,g){var S=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),this.tileSize);function w(C,O){C&&(p.state="errored",g(C)),O&&(p.dem=O,p.needsHillshadePrepare=!0,p.state="loaded",g(null))}p.request=_.getImage(this.map._requestManager.transformRequest(S,_.ResourceType.Tile),function(C,O){if(delete p.request,p.aborted)p.state="unloaded",g(null);else if(C)p.state="errored",g(C);else if(O){this.map._refreshExpiredTiles&&p.setExpiryData(O),delete O.cacheControl,delete O.expires;var X=_.window.ImageBitmap&&O instanceof _.window.ImageBitmap&&_.offscreenCanvasSupported()?O:_.browser.getImageData(O,1),J={uid:p.uid,coord:p.tileID,source:this.id,rawImageData:X,encoding:this.encoding};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadDEMTile",J,w.bind(this)))}}.bind(this)),p.neighboringTiles=this._getNeighboringTiles(p.tileID)},v.prototype._getNeighboringTiles=function(p){var g=p.canonical,S=Math.pow(2,g.z),w=(g.x-1+S)%S,C=g.x===0?p.wrap-1:p.wrap,O=(g.x+1+S)%S,X=g.x+1===S?p.wrap+1:p.wrap,J={};return J[new _.OverscaledTileID(p.overscaledZ,C,g.z,w,g.y).key]={backfilled:!1},J[new _.OverscaledTileID(p.overscaledZ,X,g.z,O,g.y).key]={backfilled:!1},g.y>0&&(J[new _.OverscaledTileID(p.overscaledZ,C,g.z,w,g.y-1).key]={backfilled:!1},J[new _.OverscaledTileID(p.overscaledZ,p.wrap,g.z,g.x,g.y-1).key]={backfilled:!1},J[new _.OverscaledTileID(p.overscaledZ,X,g.z,O,g.y-1).key]={backfilled:!1}),g.y+1<S&&(J[new _.OverscaledTileID(p.overscaledZ,C,g.z,w,g.y+1).key]={backfilled:!1},J[new _.OverscaledTileID(p.overscaledZ,p.wrap,g.z,g.x,g.y+1).key]={backfilled:!1},J[new _.OverscaledTileID(p.overscaledZ,X,g.z,O,g.y+1).key]={backfilled:!1}),J},v.prototype.unloadTile=function(p){p.demTexture&&this.map.painter.saveTileTexture(p.demTexture),p.fbo&&(p.fbo.destroy(),delete p.fbo),p.dem&&delete p.dem,delete p.neighboringTiles,p.state="unloaded",p.actor&&p.actor.send("removeDEMTile",{uid:p.uid,source:this.id})},v}(te),Te=function(h){function v(p,g,S,w){h.call(this),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._removed=!1,this._loaded=!1,this.actor=S.getActor(),this.setEventedParent(w),this._data=g.data,this._options=_.extend({},g),this._collectResourceTiming=g.collectResourceTiming,this._resourceTiming=[],g.maxzoom!==void 0&&(this.maxzoom=g.maxzoom),g.type&&(this.type=g.type),g.attribution&&(this.attribution=g.attribution),this.promoteId=g.promoteId;var C=_.EXTENT/this.tileSize;this.workerOptions=_.extend({source:this.id,cluster:g.cluster||!1,geojsonVtOptions:{buffer:(g.buffer!==void 0?g.buffer:128)*C,tolerance:(g.tolerance!==void 0?g.tolerance:.375)*C,extent:_.EXTENT,maxZoom:this.maxzoom,lineMetrics:g.lineMetrics||!1,generateId:g.generateId||!1},superclusterOptions:{maxZoom:g.clusterMaxZoom!==void 0?Math.min(g.clusterMaxZoom,this.maxzoom-1):this.maxzoom-1,minPoints:Math.max(2,g.clusterMinPoints||2),extent:_.EXTENT,radius:(g.clusterRadius||50)*C,log:!1,generateId:g.generateId||!1},clusterProperties:g.clusterProperties,filter:g.filter},g.workerOptions)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this.fire(new _.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(g){if(g)p.fire(new _.ErrorEvent(g));else{var S={dataType:"source",sourceDataType:"metadata"};p._collectResourceTiming&&p._resourceTiming&&p._resourceTiming.length>0&&(S.resourceTiming=p._resourceTiming,p._resourceTiming=[]),p.fire(new _.Event("data",S))}})},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.setData=function(p){var g=this;return this._data=p,this.fire(new _.Event("dataloading",{dataType:"source"})),this._updateWorkerData(function(S){if(S)g.fire(new _.ErrorEvent(S));else{var w={dataType:"source",sourceDataType:"content"};g._collectResourceTiming&&g._resourceTiming&&g._resourceTiming.length>0&&(w.resourceTiming=g._resourceTiming,g._resourceTiming=[]),g.fire(new _.Event("data",w))}}),this},v.prototype.getClusterExpansionZoom=function(p,g){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id},g),this},v.prototype.getClusterChildren=function(p,g){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id},g),this},v.prototype.getClusterLeaves=function(p,g,S,w){return this.actor.send("geojson.getClusterLeaves",{source:this.id,clusterId:p,limit:g,offset:S},w),this},v.prototype._updateWorkerData=function(p){var g=this;this._loaded=!1;var S=_.extend({},this.workerOptions),w=this._data;typeof w=="string"?(S.request=this.map._requestManager.transformRequest(_.browser.resolveURL(w),_.ResourceType.Source),S.request.collectResourceTiming=this._collectResourceTiming):S.data=JSON.stringify(w),this.actor.send(this.type+".loadData",S,function(C,O){g._removed||O&&O.abandoned||(g._loaded=!0,O&&O.resourceTiming&&O.resourceTiming[g.id]&&(g._resourceTiming=O.resourceTiming[g.id].slice(0)),g.actor.send(g.type+".coalesce",{source:S.source},null),p(C))})},v.prototype.loaded=function(){return this._loaded},v.prototype.loadTile=function(p,g){var S=this,w=p.actor?"reloadTile":"loadTile";p.actor=this.actor,p.request=this.actor.send(w,{type:this.type,uid:p.uid,tileID:p.tileID,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,pixelRatio:_.browser.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId},function(C,O){return delete p.request,p.unloadVectorData(),p.aborted?g(null):C?g(C):(p.loadVectorData(O,S.map.painter,w==="reloadTile"),g(null))})},v.prototype.abortTile=function(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0},v.prototype.unloadTile=function(p){p.unloadVectorData(),this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id})},v.prototype.onRemove=function(){this._removed=!0,this.actor.send("removeSource",{type:this.type,source:this.id})},v.prototype.serialize=function(){return _.extend({},this._options,{type:this.type,data:this._data})},v.prototype.hasTransition=function(){return!1},v}(_.Evented),nt=_.createLayout([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]),De=function(h){function v(p,g,S,w){h.call(this),this.id=p,this.dispatcher=S,this.coordinates=g.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.setEventedParent(w),this.options=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(p,g){var S=this;this._loaded=!1,this.fire(new _.Event("dataloading",{dataType:"source"})),this.url=this.options.url,_.getImage(this.map._requestManager.transformRequest(this.url,_.ResourceType.Image),function(w,C){S._loaded=!0,w?S.fire(new _.ErrorEvent(w)):C&&(S.image=C,p&&(S.coordinates=p),g&&g(),S._finishLoading())})},v.prototype.loaded=function(){return this._loaded},v.prototype.updateImage=function(p){var g=this;return this.image&&p.url?(this.options.url=p.url,this.load(p.coordinates,function(){g.texture=null}),this):this},v.prototype._finishLoading=function(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"metadata"})))},v.prototype.onAdd=function(p){this.map=p,this.load()},v.prototype.setCoordinates=function(p){var g=this;this.coordinates=p;var S=p.map(_.MercatorCoordinate.fromLngLat);this.tileID=function(C){for(var O=1/0,X=1/0,J=-1/0,me=-1/0,ye=0,Ae=C;ye<Ae.length;ye+=1){var Ve=Ae[ye];O=Math.min(O,Ve.x),X=Math.min(X,Ve.y),J=Math.max(J,Ve.x),me=Math.max(me,Ve.y)}var Ue=Math.max(J-O,me-X),lt=Math.max(0,Math.floor(-Math.log(Ue)/Math.LN2)),Be=Math.pow(2,lt);return new _.CanonicalTileID(lt,Math.floor((O+J)/2*Be),Math.floor((X+me)/2*Be))}(S),this.minzoom=this.maxzoom=this.tileID.z;var w=S.map(function(C){return g.tileID.getTilePoint(C)._round()});return this._boundsArray=new _.StructArrayLayout4i8,this._boundsArray.emplaceBack(w[0].x,w[0].y,0,0),this._boundsArray.emplaceBack(w[1].x,w[1].y,_.EXTENT,0),this._boundsArray.emplaceBack(w[3].x,w[3].y,0,_.EXTENT),this._boundsArray.emplaceBack(w[2].x,w[2].y,_.EXTENT,_.EXTENT),this.boundsBuffer&&(this.boundsBuffer.destroy(),delete this.boundsBuffer),this.fire(new _.Event("data",{dataType:"source",sourceDataType:"content"})),this},v.prototype.prepare=function(){if(Object.keys(this.tiles).length!==0&&this.image){var p=this.map.painter.context,g=p.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,nt.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture||(this.texture=new _.Texture(p,this.image,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[S];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},v.prototype.loadTile=function(p,g){this.tileID&&this.tileID.equals(p.tileID.canonical)?(this.tiles[String(p.tileID.wrap)]=p,p.buckets={},g(null)):(p.state="errored",g(null))},v.prototype.serialize=function(){return{type:"image",url:this.options.url,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return!1},v}(_.Evented),Ze=function(h){function v(p,g,S,w){h.call(this,p,g,S,w),this.roundZoom=!0,this.type="video",this.options=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){var p=this;this._loaded=!1;var g=this.options;this.urls=[];for(var S=0,w=g.urls;S<w.length;S+=1)this.urls.push(this.map._requestManager.transformRequest(w[S],_.ResourceType.Source).url);_.getVideo(this.urls,function(C,O){p._loaded=!0,C?p.fire(new _.ErrorEvent(C)):O&&(p.video=O,p.video.loop=!0,p.video.setAttribute("playsinline",""),p.video.addEventListener("playing",function(){p.map.triggerRepaint()}),p.map&&p.video.play(),p._finishLoading())})},v.prototype.pause=function(){this.video&&this.video.pause()},v.prototype.play=function(){this.video&&this.video.play()},v.prototype.seek=function(p){if(this.video){var g=this.video.seekable;p<g.start(0)||p>g.end(0)?this.fire(new _.ErrorEvent(new _.ValidationError("sources."+this.id,null,"Playback for this video can be set only between the "+g.start(0)+" and "+g.end(0)+"-second mark."))):this.video.currentTime=p}},v.prototype.getVideo=function(){return this.video},v.prototype.onAdd=function(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))},v.prototype.prepare=function(){if(!(Object.keys(this.tiles).length===0||this.video.readyState<2)){var p=this.map.painter.context,g=p.gl;for(var S in this.boundsBuffer||(this.boundsBuffer=p.createVertexBuffer(this._boundsArray,nt.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture?this.video.paused||(this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE),g.texSubImage2D(g.TEXTURE_2D,0,0,0,g.RGBA,g.UNSIGNED_BYTE,this.video)):(this.texture=new _.Texture(p,this.video,g.RGBA),this.texture.bind(g.LINEAR,g.CLAMP_TO_EDGE)),this.tiles){var w=this.tiles[S];w.state!=="loaded"&&(w.state="loaded",w.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"video",urls:this.urls,coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this.video&&!this.video.paused},v}(De),Ke=function(h){function v(p,g,S,w){h.call(this,p,g,S,w),g.coordinates?Array.isArray(g.coordinates)&&g.coordinates.length===4&&!g.coordinates.some(function(C){return!Array.isArray(C)||C.length!==2||C.some(function(O){return typeof O!="number"})})||this.fire(new _.ErrorEvent(new _.ValidationError("sources."+p,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new _.ErrorEvent(new _.ValidationError("sources."+p,null,'missing required property "coordinates"'))),g.animate&&typeof g.animate!="boolean"&&this.fire(new _.ErrorEvent(new _.ValidationError("sources."+p,null,'optional "animate" property must be a boolean value'))),g.canvas?typeof g.canvas=="string"||g.canvas instanceof _.window.HTMLCanvasElement||this.fire(new _.ErrorEvent(new _.ValidationError("sources."+p,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new _.ErrorEvent(new _.ValidationError("sources."+p,null,'missing required property "canvas"'))),this.options=g,this.animate=g.animate===void 0||g.animate}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.load=function(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof _.window.HTMLCanvasElement?this.options.canvas:_.window.document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new _.ErrorEvent(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())},v.prototype.getCanvas=function(){return this.canvas},v.prototype.onAdd=function(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()},v.prototype.onRemove=function(){this.pause()},v.prototype.prepare=function(){var p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),!this._hasInvalidDimensions()&&Object.keys(this.tiles).length!==0){var g=this.map.painter.context,S=g.gl;for(var w in this.boundsBuffer||(this.boundsBuffer=g.createVertexBuffer(this._boundsArray,nt.members)),this.boundsSegments||(this.boundsSegments=_.SegmentVector.simpleSegment(0,0,4,2)),this.texture?(p||this._playing)&&this.texture.update(this.canvas,{premultiply:!0}):this.texture=new _.Texture(g,this.canvas,S.RGBA,{premultiply:!0}),this.tiles){var C=this.tiles[w];C.state!=="loaded"&&(C.state="loaded",C.texture=this.texture)}}},v.prototype.serialize=function(){return{type:"canvas",coordinates:this.coordinates}},v.prototype.hasTransition=function(){return this._playing},v.prototype._hasInvalidDimensions=function(){for(var p=0,g=[this.canvas.width,this.canvas.height];p<g.length;p+=1){var S=g[p];if(isNaN(S)||S<=0)return!0}return!1},v}(De),At={vector:W,raster:te,"raster-dem":Oe,geojson:Te,video:Ze,image:De,canvas:Ke};function dr(h,v){var p=_.identity([]);return _.translate(p,p,[1,1,0]),_.scale(p,p,[.5*h.width,.5*h.height,1]),_.multiply(p,p,h.calculatePosMatrix(v.toUnwrapped()))}function Pt(h,v,p,g,S,w){var C=function(lt,Be,st){if(lt)for(var xt=0,Ut=lt;xt<Ut.length;xt+=1){var ar=Be[Ut[xt]];if(ar&&ar.source===st&&ar.type==="fill-extrusion")return!0}else for(var qt in Be){var fr=Be[qt];if(fr.source===st&&fr.type==="fill-extrusion")return!0}return!1}(S&&S.layers,v,h.id),O=w.maxPitchScaleFactor(),X=h.tilesIn(g,O,C);X.sort(fn);for(var J=[],me=0,ye=X;me<ye.length;me+=1){var Ae=ye[me];J.push({wrappedTileID:Ae.tileID.wrapped().key,queryResults:Ae.tile.queryRenderedFeatures(v,p,h._state,Ae.queryGeometry,Ae.cameraQueryGeometry,Ae.scale,S,w,O,dr(h.transform,Ae.tileID))})}var Ve=function(lt){for(var Be={},st={},xt=0,Ut=lt;xt<Ut.length;xt+=1){var ar=Ut[xt],qt=ar.queryResults,fr=ar.wrappedTileID,br=st[fr]=st[fr]||{};for(var jr in qt)for(var Fr=qt[jr],hn=br[jr]=br[jr]||{},Un=Be[jr]=Be[jr]||[],Ln=0,zn=Fr;Ln<zn.length;Ln+=1){var Ui=zn[Ln];hn[Ui.featureIndex]||(hn[Ui.featureIndex]=!0,Un.push(Ui))}}return Be}(J);for(var Ue in Ve)Ve[Ue].forEach(function(lt){var Be=lt.feature,st=h.getFeatureState(Be.layer["source-layer"],Be.id);Be.source=Be.layer.source,Be.layer["source-layer"]&&(Be.sourceLayer=Be.layer["source-layer"]),Be.state=st});return Ve}function fn(h,v){var p=h.tileID,g=v.tileID;return p.overscaledZ-g.overscaledZ||p.canonical.y-g.canonical.y||p.wrap-g.wrap||p.canonical.x-g.canonical.x}var cn=function(h,v){this.max=h,this.onRemove=v,this.reset()};cn.prototype.reset=function(){for(var h in this.data)for(var v=0,p=this.data[h];v<p.length;v+=1){var g=p[v];g.timeout&&clearTimeout(g.timeout),this.onRemove(g.value)}return this.data={},this.order=[],this},cn.prototype.add=function(h,v,p){var g=this,S=h.wrapped().key;this.data[S]===void 0&&(this.data[S]=[]);var w={value:v,timeout:void 0};if(p!==void 0&&(w.timeout=setTimeout(function(){g.remove(h,w)},p)),this.data[S].push(w),this.order.push(S),this.order.length>this.max){var C=this._getAndRemoveByKey(this.order[0]);C&&this.onRemove(C)}return this},cn.prototype.has=function(h){return h.wrapped().key in this.data},cn.prototype.getAndRemove=function(h){return this.has(h)?this._getAndRemoveByKey(h.wrapped().key):null},cn.prototype._getAndRemoveByKey=function(h){var v=this.data[h].shift();return v.timeout&&clearTimeout(v.timeout),this.data[h].length===0&&delete this.data[h],this.order.splice(this.order.indexOf(h),1),v.value},cn.prototype.getByKey=function(h){var v=this.data[h];return v?v[0].value:null},cn.prototype.get=function(h){return this.has(h)?this.data[h.wrapped().key][0].value:null},cn.prototype.remove=function(h,v){if(!this.has(h))return this;var p=h.wrapped().key,g=v===void 0?0:this.data[p].indexOf(v),S=this.data[p][g];return this.data[p].splice(g,1),S.timeout&&clearTimeout(S.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(S.value),this.order.splice(this.order.indexOf(p),1),this},cn.prototype.setMaxSize=function(h){for(this.max=h;this.order.length>this.max;){var v=this._getAndRemoveByKey(this.order[0]);v&&this.onRemove(v)}return this},cn.prototype.filter=function(h){var v=[];for(var p in this.data)for(var g=0,S=this.data[p];g<S.length;g+=1){var w=S[g];h(w.value)||v.push(w)}for(var C=0,O=v;C<O.length;C+=1){var X=O[C];this.remove(X.value.tileID,X)}};var Lr=function(h,v,p){this.context=h;var g=h.gl;this.buffer=g.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),h.bindElementBuffer.set(this.buffer),g.bufferData(g.ELEMENT_ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?g.DYNAMIC_DRAW:g.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};Lr.prototype.bind=function(){this.context.bindElementBuffer.set(this.buffer)},Lr.prototype.updateData=function(h){var v=this.context.gl;this.context.unbindVAO(),this.bind(),v.bufferSubData(v.ELEMENT_ARRAY_BUFFER,0,h.arrayBuffer)},Lr.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Fn={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"},Sn=function(h,v,p,g){this.length=v.length,this.attributes=p,this.itemSize=v.bytesPerElement,this.dynamicDraw=g,this.context=h;var S=h.gl;this.buffer=S.createBuffer(),h.bindVertexBuffer.set(this.buffer),S.bufferData(S.ARRAY_BUFFER,v.arrayBuffer,this.dynamicDraw?S.DYNAMIC_DRAW:S.STATIC_DRAW),this.dynamicDraw||delete v.arrayBuffer};Sn.prototype.bind=function(){this.context.bindVertexBuffer.set(this.buffer)},Sn.prototype.updateData=function(h){var v=this.context.gl;this.bind(),v.bufferSubData(v.ARRAY_BUFFER,0,h.arrayBuffer)},Sn.prototype.enableAttributes=function(h,v){for(var p=0;p<this.attributes.length;p++){var g=v.attributes[this.attributes[p].name];g!==void 0&&h.enableVertexAttribArray(g)}},Sn.prototype.setVertexAttribPointers=function(h,v,p){for(var g=0;g<this.attributes.length;g++){var S=this.attributes[g],w=v.attributes[S.name];w!==void 0&&h.vertexAttribPointer(w,S.components,h[Fn[S.type]],!1,this.itemSize,S.offset+this.itemSize*(p||0))}},Sn.prototype.destroy=function(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)};var Jr=function(h){this.gl=h.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1};Jr.prototype.get=function(){return this.current},Jr.prototype.set=function(h){},Jr.prototype.getDefault=function(){return this.default},Jr.prototype.setDefault=function(){this.set(this.default)};var bi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return _.Color.transparent},v.prototype.set=function(p){var g=this.current;(p.r!==g.r||p.g!==g.g||p.b!==g.b||p.a!==g.a||this.dirty)&&(this.gl.clearColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},v}(Jr),Gn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 1},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearDepth(p),this.current=p,this.dirty=!1)},v}(Jr),zi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 0},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.clearStencil(p),this.current=p,this.dirty=!1)},v}(Jr),bn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return[!0,!0,!0,!0]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||p[3]!==g[3]||this.dirty)&&(this.gl.colorMask(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},v}(Jr),Pn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!0},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthMask(p),this.current=p,this.dirty=!1)},v}(Jr),Aa=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 255},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.stencilMask(p),this.current=p,this.dirty=!1)},v}(Jr),Zi=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return{func:this.gl.ALWAYS,ref:0,mask:255}},v.prototype.set=function(p){var g=this.current;(p.func!==g.func||p.ref!==g.ref||p.mask!==g.mask||this.dirty)&&(this.gl.stencilFunc(p.func,p.ref,p.mask),this.current=p,this.dirty=!1)},v}(Jr),Ma=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var p=this.gl;return[p.KEEP,p.KEEP,p.KEEP]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||this.dirty)&&(this.gl.stencilOp(p[0],p[1],p[2]),this.current=p,this.dirty=!1)},v}(Jr),To=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.STENCIL_TEST):g.disable(g.STENCIL_TEST),this.current=p,this.dirty=!1}},v}(Jr),Ce=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return[0,1]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||this.dirty)&&(this.gl.depthRange(p[0],p[1]),this.current=p,this.dirty=!1)},v}(Jr),Ia=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.DEPTH_TEST):g.disable(g.DEPTH_TEST),this.current=p,this.dirty=!1}},v}(Jr),Ta=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.LESS},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.depthFunc(p),this.current=p,this.dirty=!1)},v}(Jr),no=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.BLEND):g.disable(g.BLEND),this.current=p,this.dirty=!1}},v}(Jr),qs=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var p=this.gl;return[p.ONE,p.ZERO]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||this.dirty)&&(this.gl.blendFunc(p[0],p[1]),this.current=p,this.dirty=!1)},v}(Jr),Rs=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return _.Color.transparent},v.prototype.set=function(p){var g=this.current;(p.r!==g.r||p.g!==g.g||p.b!==g.b||p.a!==g.a||this.dirty)&&(this.gl.blendColor(p.r,p.g,p.b,p.a),this.current=p,this.dirty=!1)},v}(Jr),ts=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.FUNC_ADD},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.blendEquation(p),this.current=p,this.dirty=!1)},v}(Jr),Wt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;p?g.enable(g.CULL_FACE):g.disable(g.CULL_FACE),this.current=p,this.dirty=!1}},v}(Jr),xr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.BACK},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.cullFace(p),this.current=p,this.dirty=!1)},v}(Jr),Gr=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.CCW},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.frontFace(p),this.current=p,this.dirty=!1)},v}(Jr),nn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)},v}(Jr),Nn=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return this.gl.TEXTURE0},v.prototype.set=function(p){(p!==this.current||this.dirty)&&(this.gl.activeTexture(p),this.current=p,this.dirty=!1)},v}(Jr),Ki=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){var p=this.gl;return[0,0,p.drawingBufferWidth,p.drawingBufferHeight]},v.prototype.set=function(p){var g=this.current;(p[0]!==g[0]||p[1]!==g[1]||p[2]!==g[2]||p[3]!==g[3]||this.dirty)&&(this.gl.viewport(p[0],p[1],p[2],p[3]),this.current=p,this.dirty=!1)},v}(Jr),ue=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindFramebuffer(g.FRAMEBUFFER,p),this.current=p,this.dirty=!1}},v}(Jr),D=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindRenderbuffer(g.RENDERBUFFER,p),this.current=p,this.dirty=!1}},v}(Jr),z=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindTexture(g.TEXTURE_2D,p),this.current=p,this.dirty=!1}},v}(Jr),se=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.bindBuffer(g.ARRAY_BUFFER,p),this.current=p,this.dirty=!1}},v}(Jr),be=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){var g=this.gl;g.bindBuffer(g.ELEMENT_ARRAY_BUFFER,p),this.current=p,this.dirty=!1},v}(Jr),ke=function(h){function v(p){h.call(this,p),this.vao=p.extVertexArrayObject}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v.prototype.set=function(p){this.vao&&(p!==this.current||this.dirty)&&(this.vao.bindVertexArrayOES(p),this.current=p,this.dirty=!1)},v}(Jr),Ht=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return 4},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_ALIGNMENT,p),this.current=p,this.dirty=!1}},v}(Jr),Mt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_PREMULTIPLY_ALPHA_WEBGL,p),this.current=p,this.dirty=!1}},v}(Jr),Lt=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return!1},v.prototype.set=function(p){if(p!==this.current||this.dirty){var g=this.gl;g.pixelStorei(g.UNPACK_FLIP_Y_WEBGL,p),this.current=p,this.dirty=!1}},v}(Jr),mt=function(h){function v(p,g){h.call(this,p),this.context=p,this.parent=g}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getDefault=function(){return null},v}(Jr),N=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.setDirty=function(){this.dirty=!0},v.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferTexture2D(g.FRAMEBUFFER,g.COLOR_ATTACHMENT0,g.TEXTURE_2D,p,0),this.current=p,this.dirty=!1}},v}(mt),B=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.set=function(p){if(p!==this.current||this.dirty){this.context.bindFramebuffer.set(this.parent);var g=this.gl;g.framebufferRenderbuffer(g.FRAMEBUFFER,g.DEPTH_ATTACHMENT,g.RENDERBUFFER,p),this.current=p,this.dirty=!1}},v}(mt),$=function(h,v,p,g){this.context=h,this.width=v,this.height=p;var S=this.framebuffer=h.gl.createFramebuffer();this.colorAttachment=new N(h,S),g&&(this.depthAttachment=new B(h,S))};$.prototype.destroy=function(){var h=this.context.gl,v=this.colorAttachment.get();if(v&&h.deleteTexture(v),this.depthAttachment){var p=this.depthAttachment.get();p&&h.deleteRenderbuffer(p)}h.deleteFramebuffer(this.framebuffer)};var ne=function(h,v,p){this.func=h,this.mask=v,this.range=p};ne.ReadOnly=!1,ne.ReadWrite=!0,ne.disabled=new ne(519,ne.ReadOnly,[0,1]);var xe=function(h,v,p,g,S,w){this.test=h,this.ref=v,this.mask=p,this.fail=g,this.depthFail=S,this.pass=w};xe.disabled=new xe({func:519,mask:0},0,0,7680,7680,7680);var Fe=function(h,v,p){this.blendFunction=h,this.blendColor=v,this.mask=p};Fe.disabled=new Fe(Fe.Replace=[1,0],_.Color.transparent,[!1,!1,!1,!1]),Fe.unblended=new Fe(Fe.Replace,_.Color.transparent,[!0,!0,!0,!0]),Fe.alphaBlended=new Fe([1,771],_.Color.transparent,[!0,!0,!0,!0]);var et=function(h,v,p){this.enable=h,this.mode=v,this.frontFace=p};et.disabled=new et(!1,1029,2305),et.backCCW=new et(!0,1029,2305);var j=function(h){this.gl=h,this.extVertexArrayObject=this.gl.getExtension("OES_vertex_array_object"),this.clearColor=new bi(this),this.clearDepth=new Gn(this),this.clearStencil=new zi(this),this.colorMask=new bn(this),this.depthMask=new Pn(this),this.stencilMask=new Aa(this),this.stencilFunc=new Zi(this),this.stencilOp=new Ma(this),this.stencilTest=new To(this),this.depthRange=new Ce(this),this.depthTest=new Ia(this),this.depthFunc=new Ta(this),this.blend=new no(this),this.blendFunc=new qs(this),this.blendColor=new Rs(this),this.blendEquation=new ts(this),this.cullFace=new Wt(this),this.cullFaceSide=new xr(this),this.frontFace=new Gr(this),this.program=new nn(this),this.activeTexture=new Nn(this),this.viewport=new Ki(this),this.bindFramebuffer=new ue(this),this.bindRenderbuffer=new D(this),this.bindTexture=new z(this),this.bindVertexBuffer=new se(this),this.bindElementBuffer=new be(this),this.bindVertexArrayOES=this.extVertexArrayObject&&new ke(this),this.pixelStoreUnpack=new Ht(this),this.pixelStoreUnpackPremultiplyAlpha=new Mt(this),this.pixelStoreUnpackFlipY=new Lt(this),this.extTextureFilterAnisotropic=h.getExtension("EXT_texture_filter_anisotropic")||h.getExtension("MOZ_EXT_texture_filter_anisotropic")||h.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=h.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT)),this.extTextureHalfFloat=h.getExtension("OES_texture_half_float"),this.extTextureHalfFloat&&(h.getExtension("OES_texture_half_float_linear"),this.extRenderToTextureHalfFloat=h.getExtension("EXT_color_buffer_half_float")),this.extTimerQuery=h.getExtension("EXT_disjoint_timer_query"),this.maxTextureSize=h.getParameter(h.MAX_TEXTURE_SIZE)};j.prototype.setDefault=function(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()},j.prototype.setDirty=function(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.extVertexArrayObject&&(this.bindVertexArrayOES.dirty=!0),this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0},j.prototype.createIndexBuffer=function(h,v){return new Lr(this,h,v)},j.prototype.createVertexBuffer=function(h,v,p){return new Sn(this,h,v,p)},j.prototype.createRenderbuffer=function(h,v,p){var g=this.gl,S=g.createRenderbuffer();return this.bindRenderbuffer.set(S),g.renderbufferStorage(g.RENDERBUFFER,h,v,p),this.bindRenderbuffer.set(null),S},j.prototype.createFramebuffer=function(h,v,p){return new $(this,h,v,p)},j.prototype.clear=function(h){var v=h.color,p=h.depth,g=this.gl,S=0;v&&(S|=g.COLOR_BUFFER_BIT,this.clearColor.set(v),this.colorMask.set([!0,!0,!0,!0])),p!==void 0&&(S|=g.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(p),this.depthMask.set(!0)),g.clear(S)},j.prototype.setCullFace=function(h){h.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(h.mode),this.frontFace.set(h.frontFace))},j.prototype.setDepthMode=function(h){h.func!==this.gl.ALWAYS||h.mask?(this.depthTest.set(!0),this.depthFunc.set(h.func),this.depthMask.set(h.mask),this.depthRange.set(h.range)):this.depthTest.set(!1)},j.prototype.setStencilMode=function(h){h.test.func!==this.gl.ALWAYS||h.mask?(this.stencilTest.set(!0),this.stencilMask.set(h.mask),this.stencilOp.set([h.fail,h.depthFail,h.pass]),this.stencilFunc.set({func:h.test.func,ref:h.ref,mask:h.test.mask})):this.stencilTest.set(!1)},j.prototype.setColorMode=function(h){_.deepEqual(h.blendFunction,Fe.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(h.blendFunction),this.blendColor.set(h.blendColor)),this.colorMask.set(h.mask)},j.prototype.unbindVAO=function(){this.extVertexArrayObject&&this.bindVertexArrayOES.set(null)};var Q=function(h){function v(p,g,S){var w=this;h.call(this),this.id=p,this.dispatcher=S,this.on("data",function(C){C.dataType==="source"&&C.sourceDataType==="metadata"&&(w._sourceLoaded=!0),w._sourceLoaded&&!w._paused&&C.dataType==="source"&&C.sourceDataType==="content"&&(w.reload(),w.transform&&w.update(w.transform))}),this.on("error",function(){w._sourceErrored=!0}),this._source=function(C,O,X,J){var me=new At[O.type](C,O,X,J);if(me.id!==C)throw new Error("Expected Source id to be "+C+" instead of "+me.id);return _.bindAll(["load","abort","unload","serialize","prepare"],me),me}(p,g,S,this),this._tiles={},this._cache=new cn(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._maxTileCacheSize=null,this._loadedParentTiles={},this._coveredTiles={},this._state=new _.SourceFeatureState}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.onAdd=function(p){this.map=p,this._maxTileCacheSize=p?p._maxTileCacheSize:null,this._source&&this._source.onAdd&&this._source.onAdd(p)},v.prototype.onRemove=function(p){this._source&&this._source.onRemove&&this._source.onRemove(p)},v.prototype.loaded=function(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(var p in this._tiles){var g=this._tiles[p];if(g.state!=="loaded"&&g.state!=="errored")return!1}return!0},v.prototype.getSource=function(){return this._source},v.prototype.pause=function(){this._paused=!0},v.prototype.resume=function(){if(this._paused){var p=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,p&&this.reload(),this.transform&&this.update(this.transform)}},v.prototype._loadTile=function(p,g){return this._source.loadTile(p,g)},v.prototype._unloadTile=function(p){if(this._source.unloadTile)return this._source.unloadTile(p,function(){})},v.prototype._abortTile=function(p){if(this._source.abortTile)return this._source.abortTile(p,function(){})},v.prototype.serialize=function(){return this._source.serialize()},v.prototype.prepare=function(p){for(var g in this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null),this._tiles){var S=this._tiles[g];S.upload(p),S.prepare(this.map.style.imageManager)}},v.prototype.getIds=function(){return _.values(this._tiles).map(function(p){return p.tileID}).sort(Le).map(function(p){return p.key})},v.prototype.getRenderableIds=function(p){var g=this,S=[];for(var w in this._tiles)this._isIdRenderable(w,p)&&S.push(this._tiles[w]);return p?S.sort(function(C,O){var X=C.tileID,J=O.tileID,me=new _.Point(X.canonical.x,X.canonical.y)._rotate(g.transform.angle),ye=new _.Point(J.canonical.x,J.canonical.y)._rotate(g.transform.angle);return X.overscaledZ-J.overscaledZ||ye.y-me.y||ye.x-me.x}).map(function(C){return C.tileID.key}):S.map(function(C){return C.tileID}).sort(Le).map(function(C){return C.key})},v.prototype.hasRenderableParent=function(p){var g=this.findLoadedParent(p,0);return!!g&&this._isIdRenderable(g.tileID.key)},v.prototype._isIdRenderable=function(p,g){return this._tiles[p]&&this._tiles[p].hasData()&&!this._coveredTiles[p]&&(g||!this._tiles[p].holdingForFade())},v.prototype.reload=function(){if(this._paused)this._shouldReloadOnResume=!0;else for(var p in this._cache.reset(),this._tiles)this._tiles[p].state!=="errored"&&this._reloadTile(p,"reloading")},v.prototype._reloadTile=function(p,g){var S=this._tiles[p];S&&(S.state!=="loading"&&(S.state=g),this._loadTile(S,this._tileLoaded.bind(this,S,p,g)))},v.prototype._tileLoaded=function(p,g,S,w){if(w)return p.state="errored",void(w.status!==404?this._source.fire(new _.ErrorEvent(w,{tile:p})):this.update(this.transform));p.timeAdded=_.browser.now(),S==="expired"&&(p.refreshedUponExpiration=!0),this._setTileReloadTimer(g,p),this.getSource().type==="raster-dem"&&p.dem&&this._backfillDEM(p),this._state.initializeTileState(p,this.map?this.map.painter:null),this._source.fire(new _.Event("data",{dataType:"source",tile:p,coord:p.tileID}))},v.prototype._backfillDEM=function(p){for(var g=this.getRenderableIds(),S=0;S<g.length;S++){var w=g[S];if(p.neighboringTiles&&p.neighboringTiles[w]){var C=this.getTileByID(w);O(p,C),O(C,p)}}function O(X,J){X.needsHillshadePrepare=!0;var me=J.tileID.canonical.x-X.tileID.canonical.x,ye=J.tileID.canonical.y-X.tileID.canonical.y,Ae=Math.pow(2,X.tileID.canonical.z),Ve=J.tileID.key;me===0&&ye===0||Math.abs(ye)>1||(Math.abs(me)>1&&(Math.abs(me+Ae)===1?me+=Ae:Math.abs(me-Ae)===1&&(me-=Ae)),J.dem&&X.dem&&(X.dem.backfillBorder(J.dem,me,ye),X.neighboringTiles&&X.neighboringTiles[Ve]&&(X.neighboringTiles[Ve].backfilled=!0)))}},v.prototype.getTile=function(p){return this.getTileByID(p.key)},v.prototype.getTileByID=function(p){return this._tiles[p]},v.prototype._retainLoadedChildren=function(p,g,S,w){for(var C in this._tiles){var O=this._tiles[C];if(!(w[C]||!O.hasData()||O.tileID.overscaledZ<=g||O.tileID.overscaledZ>S)){for(var X=O.tileID;O&&O.tileID.overscaledZ>g+1;){var J=O.tileID.scaledTo(O.tileID.overscaledZ-1);(O=this._tiles[J.key])&&O.hasData()&&(X=J)}for(var me=X;me.overscaledZ>g;)if(p[(me=me.scaledTo(me.overscaledZ-1)).key]){w[X.key]=X;break}}}},v.prototype.findLoadedParent=function(p,g){if(p.key in this._loadedParentTiles){var S=this._loadedParentTiles[p.key];return S&&S.tileID.overscaledZ>=g?S:null}for(var w=p.overscaledZ-1;w>=g;w--){var C=p.scaledTo(w),O=this._getLoadedTile(C);if(O)return O}},v.prototype._getLoadedTile=function(p){var g=this._tiles[p.key];return g&&g.hasData()?g:this._cache.getByKey(p.wrapped().key)},v.prototype.updateCacheSize=function(p){var g=Math.ceil(p.width/this._source.tileSize)+1,S=Math.ceil(p.height/this._source.tileSize)+1,w=Math.floor(g*S*5),C=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,w):w;this._cache.setMaxSize(C)},v.prototype.handleWrapJump=function(p){var g=Math.round((p-(this._prevLng===void 0?p:this._prevLng))/360);if(this._prevLng=p,g){var S={};for(var w in this._tiles){var C=this._tiles[w];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+g),S[C.tileID.key]=C}for(var O in this._tiles=S,this._timers)clearTimeout(this._timers[O]),delete this._timers[O];for(var X in this._tiles)this._setTileReloadTimer(X,this._tiles[X])}},v.prototype.update=function(p){var g=this;if(this.transform=p,this._sourceLoaded&&!this._paused){var S;this.updateCacheSize(p),this.handleWrapJump(this.transform.center.lng),this._coveredTiles={},this.used?this._source.tileID?S=p.getVisibleUnwrappedCoordinates(this._source.tileID).map(function(br){return new _.OverscaledTileID(br.canonical.z,br.wrap,br.canonical.z,br.canonical.x,br.canonical.y)}):(S=p.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}),this._source.hasTile&&(S=S.filter(function(br){return g._source.hasTile(br)}))):S=[];var w=p.coveringZoomLevel(this._source),C=Math.max(w-v.maxOverzooming,this._source.minzoom),O=Math.max(w+v.maxUnderzooming,this._source.minzoom),X=this._updateRetainedTiles(S,w);if(rt(this._source.type)){for(var J={},me={},ye=0,Ae=Object.keys(X);ye<Ae.length;ye+=1){var Ve=Ae[ye],Ue=X[Ve],lt=this._tiles[Ve];if(lt&&!(lt.fadeEndTime&&lt.fadeEndTime<=_.browser.now())){var Be=this.findLoadedParent(Ue,C);Be&&(this._addTile(Be.tileID),J[Be.tileID.key]=Be.tileID),me[Ve]=Ue}}for(var st in this._retainLoadedChildren(me,w,O,X),J)X[st]||(this._coveredTiles[st]=!0,X[st]=J[st])}for(var xt in X)this._tiles[xt].clearFadeHold();for(var Ut=0,ar=_.keysDifference(this._tiles,X);Ut<ar.length;Ut+=1){var qt=ar[Ut],fr=this._tiles[qt];fr.hasSymbolBuckets&&!fr.holdingForFade()?fr.setHoldDuration(this.map._fadeDuration):fr.hasSymbolBuckets&&!fr.symbolFadeFinished()||this._removeTile(qt)}this._updateLoadedParentTileCache()}},v.prototype.releaseSymbolFadeTiles=function(){for(var p in this._tiles)this._tiles[p].holdingForFade()&&this._removeTile(p)},v.prototype._updateRetainedTiles=function(p,g){for(var S={},w={},C=Math.max(g-v.maxOverzooming,this._source.minzoom),O=Math.max(g+v.maxUnderzooming,this._source.minzoom),X={},J=0,me=p;J<me.length;J+=1){var ye=me[J],Ae=this._addTile(ye);S[ye.key]=ye,Ae.hasData()||g<this._source.maxzoom&&(X[ye.key]=ye)}this._retainLoadedChildren(X,g,O,S);for(var Ve=0,Ue=p;Ve<Ue.length;Ve+=1){var lt=Ue[Ve],Be=this._tiles[lt.key];if(!Be.hasData()){if(g+1>this._source.maxzoom){var st=lt.children(this._source.maxzoom)[0],xt=this.getTile(st);if(xt&&xt.hasData()){S[st.key]=st;continue}}else{var Ut=lt.children(this._source.maxzoom);if(S[Ut[0].key]&&S[Ut[1].key]&&S[Ut[2].key]&&S[Ut[3].key])continue}for(var ar=Be.wasRequested(),qt=lt.overscaledZ-1;qt>=C;--qt){var fr=lt.scaledTo(qt);if(w[fr.key]||(w[fr.key]=!0,!(Be=this.getTile(fr))&&ar&&(Be=this._addTile(fr)),Be&&(S[fr.key]=fr,ar=Be.wasRequested(),Be.hasData())))break}}}return S},v.prototype._updateLoadedParentTileCache=function(){for(var p in this._loadedParentTiles={},this._tiles){for(var g=[],S=void 0,w=this._tiles[p].tileID;w.overscaledZ>0;){if(w.key in this._loadedParentTiles){S=this._loadedParentTiles[w.key];break}g.push(w.key);var C=w.scaledTo(w.overscaledZ-1);if(S=this._getLoadedTile(C))break;w=C}for(var O=0,X=g;O<X.length;O+=1)this._loadedParentTiles[X[O]]=S}},v.prototype._addTile=function(p){var g=this._tiles[p.key];if(g)return g;(g=this._cache.getAndRemove(p))&&(this._setTileReloadTimer(p.key,g),g.tileID=p,this._state.initializeTileState(g,this.map?this.map.painter:null),this._cacheTimers[p.key]&&(clearTimeout(this._cacheTimers[p.key]),delete this._cacheTimers[p.key],this._setTileReloadTimer(p.key,g)));var S=!!g;return S||(g=new _.Tile(p,this._source.tileSize*p.overscaleFactor()),this._loadTile(g,this._tileLoaded.bind(this,g,p.key,g.state))),g?(g.uses++,this._tiles[p.key]=g,S||this._source.fire(new _.Event("dataloading",{tile:g,coord:g.tileID,dataType:"source"})),g):null},v.prototype._setTileReloadTimer=function(p,g){var S=this;p in this._timers&&(clearTimeout(this._timers[p]),delete this._timers[p]);var w=g.getExpiryTimeout();w&&(this._timers[p]=setTimeout(function(){S._reloadTile(p,"expired"),delete S._timers[p]},w))},v.prototype._removeTile=function(p){var g=this._tiles[p];g&&(g.uses--,delete this._tiles[p],this._timers[p]&&(clearTimeout(this._timers[p]),delete this._timers[p]),g.uses>0||(g.hasData()&&g.state!=="reloading"?this._cache.add(g.tileID,g,g.getExpiryTimeout()):(g.aborted=!0,this._abortTile(g),this._unloadTile(g))))},v.prototype.clearTiles=function(){for(var p in this._shouldReloadOnResume=!1,this._paused=!1,this._tiles)this._removeTile(p);this._cache.reset()},v.prototype.tilesIn=function(p,g,S){var w=this,C=[],O=this.transform;if(!O)return C;for(var X=S?O.getCameraQueryGeometry(p):p,J=p.map(function(qt){return O.pointCoordinate(qt)}),me=X.map(function(qt){return O.pointCoordinate(qt)}),ye=this.getIds(),Ae=1/0,Ve=1/0,Ue=-1/0,lt=-1/0,Be=0,st=me;Be<st.length;Be+=1){var xt=st[Be];Ae=Math.min(Ae,xt.x),Ve=Math.min(Ve,xt.y),Ue=Math.max(Ue,xt.x),lt=Math.max(lt,xt.y)}for(var Ut=function(qt){var fr=w._tiles[ye[qt]];if(!fr.holdingForFade()){var br=fr.tileID,jr=Math.pow(2,O.zoom-fr.tileID.overscaledZ),Fr=g*fr.queryPadding*_.EXTENT/fr.tileSize/jr,hn=[br.getTilePoint(new _.MercatorCoordinate(Ae,Ve)),br.getTilePoint(new _.MercatorCoordinate(Ue,lt))];if(hn[0].x-Fr<_.EXTENT&&hn[0].y-Fr<_.EXTENT&&hn[1].x+Fr>=0&&hn[1].y+Fr>=0){var Un=J.map(function(zn){return br.getTilePoint(zn)}),Ln=me.map(function(zn){return br.getTilePoint(zn)});C.push({tile:fr,tileID:br,queryGeometry:Un,cameraQueryGeometry:Ln,scale:jr})}}},ar=0;ar<ye.length;ar++)Ut(ar);return C},v.prototype.getVisibleCoordinates=function(p){for(var g=this,S=this.getRenderableIds(p).map(function(X){return g._tiles[X].tileID}),w=0,C=S;w<C.length;w+=1){var O=C[w];O.posMatrix=this.transform.calculatePosMatrix(O.toUnwrapped())}return S},v.prototype.hasTransition=function(){if(this._source.hasTransition())return!0;if(rt(this._source.type))for(var p in this._tiles){var g=this._tiles[p];if(g.fadeEndTime!==void 0&&g.fadeEndTime>=_.browser.now())return!0}return!1},v.prototype.setFeatureState=function(p,g,S){this._state.updateState(p=p||"_geojsonTileLayer",g,S)},v.prototype.removeFeatureState=function(p,g,S){this._state.removeFeatureState(p=p||"_geojsonTileLayer",g,S)},v.prototype.getFeatureState=function(p,g){return this._state.getState(p=p||"_geojsonTileLayer",g)},v.prototype.setDependencies=function(p,g,S){var w=this._tiles[p];w&&w.setDependencies(g,S)},v.prototype.reloadTilesForDependencies=function(p,g){for(var S in this._tiles)this._tiles[S].hasDependency(p,g)&&this._reloadTile(S,"reloading");this._cache.filter(function(w){return!w.hasDependency(p,g)})},v}(_.Evented);function Le(h,v){var p=Math.abs(2*h.wrap)-+(h.wrap<0),g=Math.abs(2*v.wrap)-+(v.wrap<0);return h.overscaledZ-v.overscaledZ||g-p||v.canonical.y-h.canonical.y||v.canonical.x-h.canonical.x}function rt(h){return h==="raster"||h==="image"||h==="video"}function Ee(){return new _.window.Worker(wh.workerUrl)}Q.maxOverzooming=10,Q.maxUnderzooming=3;var Yt="mapboxgl_preloaded_worker_pool",gr=function(){this.active={}};gr.prototype.acquire=function(h){if(!this.workers)for(this.workers=[];this.workers.length<gr.workerCount;)this.workers.push(new Ee);return this.active[h]=!0,this.workers.slice()},gr.prototype.release=function(h){delete this.active[h],this.numActive()===0&&(this.workers.forEach(function(v){v.terminate()}),this.workers=null)},gr.prototype.isPreloaded=function(){return!!this.active[Yt]},gr.prototype.numActive=function(){return Object.keys(this.active).length};var tn,Qr=Math.floor(_.browser.hardwareConcurrency/2);function rr(){return tn||(tn=new gr),tn}function Xr(h,v){var p={};for(var g in h)g!=="ref"&&(p[g]=h[g]);return _.refProperties.forEach(function(S){S in v&&(p[S]=v[S])}),p}function zr(h){h=h.slice();for(var v=Object.create(null),p=0;p<h.length;p++)v[h[p].id]=h[p];for(var g=0;g<h.length;g++)"ref"in h[g]&&(h[g]=Xr(h[g],v[h[g].ref]));return h}gr.workerCount=Math.max(Math.min(Qr,6),1);var Vr={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight"};function ei(h,v,p){p.push({command:Vr.addSource,args:[h,v[h]]})}function sn(h,v,p){v.push({command:Vr.removeSource,args:[h]}),p[h]=!0}function hi(h,v,p,g){sn(h,p,g),ei(h,v,p)}function Vi(h,v,p){var g;for(g in h[p])if(h[p].hasOwnProperty(g)&&g!=="data"&&!_.deepEqual(h[p][g],v[p][g]))return!1;for(g in v[p])if(v[p].hasOwnProperty(g)&&g!=="data"&&!_.deepEqual(h[p][g],v[p][g]))return!1;return!0}function ci(h,v,p,g,S,w){var C;for(C in v=v||{},h=h||{})h.hasOwnProperty(C)&&(_.deepEqual(h[C],v[C])||p.push({command:w,args:[g,C,v[C],S]}));for(C in v)v.hasOwnProperty(C)&&!h.hasOwnProperty(C)&&(_.deepEqual(h[C],v[C])||p.push({command:w,args:[g,C,v[C],S]}))}function Di(h){return h.id}function Ei(h,v){return h[v.id]=v,h}var rs=function(h,v){this.reset(h,v)};rs.prototype.reset=function(h,v){this.points=h||[],this._distances=[0];for(var p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(v||0,.5*this.length),this.paddedLength=this.length-2*this.padding},rs.prototype.lerp=function(h){if(this.points.length===1)return this.points[0];h=_.clamp(h,0,1);for(var v=1,p=this._distances[v],g=h*this.paddedLength+this.padding;p<g&&v<this._distances.length;)p=this._distances[++v];var S=v-1,w=this._distances[S],C=p-w,O=C>0?(g-w)/C:0;return this.points[S].mult(1-O).add(this.points[v].mult(O))};var Qi=function(h,v,p){var g=this.boxCells=[],S=this.circleCells=[];this.xCellCount=Math.ceil(h/p),this.yCellCount=Math.ceil(v/p);for(var w=0;w<this.xCellCount*this.yCellCount;w++)g.push([]),S.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=h,this.height=v,this.xScale=this.xCellCount/h,this.yScale=this.yCellCount/v,this.boxUid=0,this.circleUid=0};function Pa(h,v,p,g,S){var w=_.create();return v?(_.scale(w,w,[1/S,1/S,1]),p||_.rotateZ(w,w,g.angle)):_.multiply(w,g.labelPlaneMatrix,h),w}function Si(h,v,p,g,S){if(v){var w=_.clone(h);return _.scale(w,w,[S,S,1]),p||_.rotateZ(w,w,-g.angle),w}return g.glCoordMatrix}function di(h,v){var p=[h.x,h.y,0,1];na(p,p,v);var g=p[3];return{point:new _.Point(p[0]/g,p[1]/g),signedDistanceFromCamera:g}}function Ai(h,v){return .5+h/v*.5}function Oa(h,v){var p=h[0]/h[3],g=h[1]/h[3];return p>=-v[0]&&p<=v[0]&&g>=-v[1]&&g<=v[1]}function vu(h,v,p,g,S,w,C,O){var X=g?h.textSizeData:h.iconSizeData,J=_.evaluateSizeForZoom(X,p.transform.zoom),me=[256/p.width*2+1,256/p.height*2+1],ye=g?h.text.dynamicLayoutVertexArray:h.icon.dynamicLayoutVertexArray;ye.clear();for(var Ae=h.lineVertexArray,Ve=g?h.text.placedSymbolArray:h.icon.placedSymbolArray,Ue=p.transform.width/p.transform.height,lt=!1,Be=0;Be<Ve.length;Be++){var st=Ve.get(Be);if(st.hidden||st.writingMode===_.WritingMode.vertical&&!lt)ka(st.numGlyphs,ye);else{lt=!1;var xt=[st.anchorX,st.anchorY,0,1];if(_.transformMat4(xt,xt,v),Oa(xt,me)){var Ut=Ai(p.transform.cameraToCenterDistance,xt[3]),ar=_.evaluateSizeForFeature(X,J,st),qt=C?ar/Ut:ar*Ut,fr=new _.Point(st.anchorX,st.anchorY),br=di(fr,S).point,jr={},Fr=Gl(st,qt,!1,O,v,S,w,h.glyphOffsetArray,Ae,ye,br,fr,jr,Ue);lt=Fr.useVertical,(Fr.notEnoughRoom||lt||Fr.needsFlipping&&Gl(st,qt,!0,O,v,S,w,h.glyphOffsetArray,Ae,ye,br,fr,jr,Ue).notEnoughRoom)&&ka(st.numGlyphs,ye)}else ka(st.numGlyphs,ye)}}g?h.text.dynamicLayoutVertexBuffer.updateData(ye):h.icon.dynamicLayoutVertexBuffer.updateData(ye)}function ca(h,v,p,g,S,w,C,O,X,J,me){var ye=O.glyphStartIndex+O.numGlyphs,Ae=O.lineStartIndex,Ve=O.lineStartIndex+O.lineLength,Ue=v.getoffsetX(O.glyphStartIndex),lt=v.getoffsetX(ye-1),Be=Ca(h*Ue,p,g,S,w,C,O.segment,Ae,Ve,X,J,me);if(!Be)return null;var st=Ca(h*lt,p,g,S,w,C,O.segment,Ae,Ve,X,J,me);return st?{first:Be,last:st}:null}function wa(h,v,p,g){return h===_.WritingMode.horizontal&&Math.abs(p.y-v.y)>Math.abs(p.x-v.x)*g?{useVertical:!0}:(h===_.WritingMode.vertical?v.y<p.y:v.x>p.x)?{needsFlipping:!0}:null}function Gl(h,v,p,g,S,w,C,O,X,J,me,ye,Ae,Ve){var Ue,lt=v/24,Be=h.lineOffsetX*lt,st=h.lineOffsetY*lt;if(h.numGlyphs>1){var xt=h.glyphStartIndex+h.numGlyphs,Ut=h.lineStartIndex,ar=h.lineStartIndex+h.lineLength,qt=ca(lt,O,Be,st,p,me,ye,h,X,w,Ae);if(!qt)return{notEnoughRoom:!0};var fr=di(qt.first.point,C).point,br=di(qt.last.point,C).point;if(g&&!p){var jr=wa(h.writingMode,fr,br,Ve);if(jr)return jr}Ue=[qt.first];for(var Fr=h.glyphStartIndex+1;Fr<xt-1;Fr++)Ue.push(Ca(lt*O.getoffsetX(Fr),Be,st,p,me,ye,h.segment,Ut,ar,X,w,Ae));Ue.push(qt.last)}else{if(g&&!p){var hn=di(ye,S).point,Un=h.lineStartIndex+h.segment+1,Ln=new _.Point(X.getx(Un),X.gety(Un)),zn=di(Ln,S),Ui=zn.signedDistanceFromCamera>0?zn.point:ds(ye,Ln,hn,1,S),gn=wa(h.writingMode,hn,Ui,Ve);if(gn)return gn}var ii=Ca(lt*O.getoffsetX(h.glyphStartIndex),Be,st,p,me,ye,h.segment,h.lineStartIndex,h.lineStartIndex+h.lineLength,X,w,Ae);if(!ii)return{notEnoughRoom:!0};Ue=[ii]}for(var pi=0,ri=Ue;pi<ri.length;pi+=1){var Qn=ri[pi];_.addDynamicAttributes(J,Qn.point,Qn.angle)}return{}}function ds(h,v,p,g,S){var w=di(h.add(h.sub(v)._unit()),S).point,C=p.sub(w);return p.add(C._mult(g/C.mag()))}function Ca(h,v,p,g,S,w,C,O,X,J,me,ye){var Ae=g?h-v:h+v,Ve=Ae>0?1:-1,Ue=0;g&&(Ve*=-1,Ue=Math.PI),Ve<0&&(Ue+=Math.PI);for(var lt=Ve>0?O+C:O+C+1,Be=S,st=S,xt=0,Ut=0,ar=Math.abs(Ae),qt=[];xt+Ut<=ar;){if((lt+=Ve)<O||lt>=X)return null;if(st=Be,qt.push(Be),(Be=ye[lt])===void 0){var fr=new _.Point(J.getx(lt),J.gety(lt)),br=di(fr,me);if(br.signedDistanceFromCamera>0)Be=ye[lt]=br.point;else{var jr=lt-Ve;Be=ds(xt===0?w:new _.Point(J.getx(jr),J.gety(jr)),fr,st,ar-xt+1,me)}}xt+=Ut,Ut=st.dist(Be)}var Fr=(ar-xt)/Ut,hn=Be.sub(st),Un=hn.mult(Fr)._add(st);Un._add(hn._unit()._perp()._mult(p*Ve));var Ln=Ue+Math.atan2(Be.y-st.y,Be.x-st.x);return qt.push(Un),{point:Un,angle:Ln,path:qt}}Qi.prototype.keysLength=function(){return this.boxKeys.length+this.circleKeys.length},Qi.prototype.insert=function(h,v,p,g,S){this._forEachCell(v,p,g,S,this._insertBoxCell,this.boxUid++),this.boxKeys.push(h),this.bboxes.push(v),this.bboxes.push(p),this.bboxes.push(g),this.bboxes.push(S)},Qi.prototype.insertCircle=function(h,v,p,g){this._forEachCell(v-g,p-g,v+g,p+g,this._insertCircleCell,this.circleUid++),this.circleKeys.push(h),this.circles.push(v),this.circles.push(p),this.circles.push(g)},Qi.prototype._insertBoxCell=function(h,v,p,g,S,w){this.boxCells[S].push(w)},Qi.prototype._insertCircleCell=function(h,v,p,g,S,w){this.circleCells[S].push(w)},Qi.prototype._query=function(h,v,p,g,S,w){if(p<0||h>this.width||g<0||v>this.height)return!S&&[];var C=[];if(h<=0&&v<=0&&this.width<=p&&this.height<=g){if(S)return!0;for(var O=0;O<this.boxKeys.length;O++)C.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(var X=0;X<this.circleKeys.length;X++){var J=this.circles[3*X],me=this.circles[3*X+1],ye=this.circles[3*X+2];C.push({key:this.circleKeys[X],x1:J-ye,y1:me-ye,x2:J+ye,y2:me+ye})}return w?C.filter(w):C}return this._forEachCell(h,v,p,g,this._queryCell,C,{hitTest:S,seenUids:{box:{},circle:{}}},w),S?C.length>0:C},Qi.prototype._queryCircle=function(h,v,p,g,S){var w=h-p,C=h+p,O=v-p,X=v+p;if(C<0||w>this.width||X<0||O>this.height)return!g&&[];var J=[];return this._forEachCell(w,O,C,X,this._queryCellCircle,J,{hitTest:g,circle:{x:h,y:v,radius:p},seenUids:{box:{},circle:{}}},S),g?J.length>0:J},Qi.prototype.query=function(h,v,p,g,S){return this._query(h,v,p,g,!1,S)},Qi.prototype.hitTest=function(h,v,p,g,S){return this._query(h,v,p,g,!0,S)},Qi.prototype.hitTestCircle=function(h,v,p,g){return this._queryCircle(h,v,p,!0,g)},Qi.prototype._queryCell=function(h,v,p,g,S,w,C,O){var X=C.seenUids,J=this.boxCells[S];if(J!==null)for(var me=this.bboxes,ye=0,Ae=J;ye<Ae.length;ye+=1){var Ve=Ae[ye];if(!X.box[Ve]){X.box[Ve]=!0;var Ue=4*Ve;if(h<=me[Ue+2]&&v<=me[Ue+3]&&p>=me[Ue+0]&&g>=me[Ue+1]&&(!O||O(this.boxKeys[Ve]))){if(C.hitTest)return w.push(!0),!0;w.push({key:this.boxKeys[Ve],x1:me[Ue],y1:me[Ue+1],x2:me[Ue+2],y2:me[Ue+3]})}}}var lt=this.circleCells[S];if(lt!==null)for(var Be=this.circles,st=0,xt=lt;st<xt.length;st+=1){var Ut=xt[st];if(!X.circle[Ut]){X.circle[Ut]=!0;var ar=3*Ut;if(this._circleAndRectCollide(Be[ar],Be[ar+1],Be[ar+2],h,v,p,g)&&(!O||O(this.circleKeys[Ut]))){if(C.hitTest)return w.push(!0),!0;var qt=Be[ar],fr=Be[ar+1],br=Be[ar+2];w.push({key:this.circleKeys[Ut],x1:qt-br,y1:fr-br,x2:qt+br,y2:fr+br})}}}},Qi.prototype._queryCellCircle=function(h,v,p,g,S,w,C,O){var X=C.circle,J=C.seenUids,me=this.boxCells[S];if(me!==null)for(var ye=this.bboxes,Ae=0,Ve=me;Ae<Ve.length;Ae+=1){var Ue=Ve[Ae];if(!J.box[Ue]){J.box[Ue]=!0;var lt=4*Ue;if(this._circleAndRectCollide(X.x,X.y,X.radius,ye[lt+0],ye[lt+1],ye[lt+2],ye[lt+3])&&(!O||O(this.boxKeys[Ue])))return w.push(!0),!0}}var Be=this.circleCells[S];if(Be!==null)for(var st=this.circles,xt=0,Ut=Be;xt<Ut.length;xt+=1){var ar=Ut[xt];if(!J.circle[ar]){J.circle[ar]=!0;var qt=3*ar;if(this._circlesCollide(st[qt],st[qt+1],st[qt+2],X.x,X.y,X.radius)&&(!O||O(this.circleKeys[ar])))return w.push(!0),!0}}},Qi.prototype._forEachCell=function(h,v,p,g,S,w,C,O){for(var X=this._convertToXCellCoord(h),J=this._convertToYCellCoord(v),me=this._convertToXCellCoord(p),ye=this._convertToYCellCoord(g),Ae=X;Ae<=me;Ae++)for(var Ve=J;Ve<=ye;Ve++)if(S.call(this,h,v,p,g,this.xCellCount*Ve+Ae,w,C,O))return},Qi.prototype._convertToXCellCoord=function(h){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(h*this.xScale)))},Qi.prototype._convertToYCellCoord=function(h){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(h*this.yScale)))},Qi.prototype._circlesCollide=function(h,v,p,g,S,w){var C=g-h,O=S-v,X=p+w;return X*X>C*C+O*O},Qi.prototype._circleAndRectCollide=function(h,v,p,g,S,w,C){var O=(w-g)/2,X=Math.abs(h-(g+O));if(X>O+p)return!1;var J=(C-S)/2,me=Math.abs(v-(S+J));if(me>J+p)return!1;if(X<=O||me<=J)return!0;var ye=X-O,Ae=me-J;return ye*ye+Ae*Ae<=p*p};var vi=new Float32Array([-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0,-1/0,-1/0,0]);function ka(h,v){for(var p=0;p<h;p++){var g=v.length;v.resize(g+4),v.float32.set(vi,3*g)}}function na(h,v,p){var g=v[0],S=v[1];return h[0]=p[0]*g+p[4]*S+p[12],h[1]=p[1]*g+p[5]*S+p[13],h[3]=p[3]*g+p[7]*S+p[15],h}var zo=function(h,v,p){v===void 0&&(v=new Qi(h.width+200,h.height+200,25)),p===void 0&&(p=new Qi(h.width+200,h.height+200,25)),this.transform=h,this.grid=v,this.ignoredGrid=p,this.pitchfactor=Math.cos(h._pitch)*h.cameraToCenterDistance,this.screenRightBoundary=h.width+100,this.screenBottomBoundary=h.height+100,this.gridRightBoundary=h.width+200,this.gridBottomBoundary=h.height+200};function la(h,v,p){return v*(_.EXTENT/(h.tileSize*Math.pow(2,p-h.tileID.overscaledZ)))}zo.prototype.placeCollisionBox=function(h,v,p,g,S){var w=this.projectAndGetPerspectiveRatio(g,h.anchorPointX,h.anchorPointY),C=p*w.perspectiveRatio,O=h.x1*C+w.point.x,X=h.y1*C+w.point.y,J=h.x2*C+w.point.x,me=h.y2*C+w.point.y;return!this.isInsideGrid(O,X,J,me)||!v&&this.grid.hitTest(O,X,J,me,S)?{box:[],offscreen:!1}:{box:[O,X,J,me],offscreen:this.isOffscreen(O,X,J,me)}},zo.prototype.placeCollisionCircles=function(h,v,p,g,S,w,C,O,X,J,me,ye,Ae){var Ve=[],Ue=new _.Point(v.anchorX,v.anchorY),lt=di(Ue,w),Be=Ai(this.transform.cameraToCenterDistance,lt.signedDistanceFromCamera),st=(J?S/Be:S*Be)/_.ONE_EM,xt=di(Ue,C).point,Ut=ca(st,g,v.lineOffsetX*st,v.lineOffsetY*st,!1,xt,Ue,v,p,C,{}),ar=!1,qt=!1,fr=!0;if(Ut){for(var br=.5*ye*Be+Ae,jr=new _.Point(-100,-100),Fr=new _.Point(this.screenRightBoundary,this.screenBottomBoundary),hn=new rs,Un=Ut.first,Ln=Ut.last,zn=[],Ui=Un.path.length-1;Ui>=1;Ui--)zn.push(Un.path[Ui]);for(var gn=1;gn<Ln.path.length;gn++)zn.push(Ln.path[gn]);var ii=2.5*br;if(O){var pi=zn.map(function(Zs){return di(Zs,O)});zn=pi.some(function(Zs){return Zs.signedDistanceFromCamera<=0})?[]:pi.map(function(Zs){return Zs.point})}var ri=[];if(zn.length>0){for(var Qn=zn[0].clone(),fi=zn[0].clone(),Jn=1;Jn<zn.length;Jn++)Qn.x=Math.min(Qn.x,zn[Jn].x),Qn.y=Math.min(Qn.y,zn[Jn].y),fi.x=Math.max(fi.x,zn[Jn].x),fi.y=Math.max(fi.y,zn[Jn].y);ri=Qn.x>=jr.x&&fi.x<=Fr.x&&Qn.y>=jr.y&&fi.y<=Fr.y?[zn]:fi.x<jr.x||Qn.x>Fr.x||fi.y<jr.y||Qn.y>Fr.y?[]:_.clipLine([zn],jr.x,jr.y,Fr.x,Fr.y)}for(var Xn=0,Mo=ri;Xn<Mo.length;Xn+=1){var Ka;hn.reset(Mo[Xn],.25*br),Ka=hn.length<=.5*br?1:Math.ceil(hn.paddedLength/ii)+1;for(var Io=0;Io<Ka;Io++){var go=Io/Math.max(Ka-1,1),Ha=hn.lerp(go),Qa=Ha.x+100,xs=Ha.y+100;Ve.push(Qa,xs,br,0);var bs=Qa-br,fl=xs-br,Es=Qa+br,lu=xs+br;if(fr=fr&&this.isOffscreen(bs,fl,Es,lu),qt=qt||this.isInsideGrid(bs,fl,Es,lu),!h&&this.grid.hitTestCircle(Qa,xs,br,me)&&(ar=!0,!X))return{circles:[],offscreen:!1,collisionDetected:ar}}}}return{circles:!X&&ar||!qt?[]:Ve,offscreen:fr,collisionDetected:ar}},zo.prototype.queryRenderedSymbols=function(h){if(h.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};for(var v=[],p=1/0,g=1/0,S=-1/0,w=-1/0,C=0,O=h;C<O.length;C+=1){var X=O[C],J=new _.Point(X.x+100,X.y+100);p=Math.min(p,J.x),g=Math.min(g,J.y),S=Math.max(S,J.x),w=Math.max(w,J.y),v.push(J)}for(var me={},ye={},Ae=0,Ve=this.grid.query(p,g,S,w).concat(this.ignoredGrid.query(p,g,S,w));Ae<Ve.length;Ae+=1){var Ue=Ve[Ae],lt=Ue.key;if(me[lt.bucketInstanceId]===void 0&&(me[lt.bucketInstanceId]={}),!me[lt.bucketInstanceId][lt.featureIndex]){var Be=[new _.Point(Ue.x1,Ue.y1),new _.Point(Ue.x2,Ue.y1),new _.Point(Ue.x2,Ue.y2),new _.Point(Ue.x1,Ue.y2)];_.polygonIntersectsPolygon(v,Be)&&(me[lt.bucketInstanceId][lt.featureIndex]=!0,ye[lt.bucketInstanceId]===void 0&&(ye[lt.bucketInstanceId]=[]),ye[lt.bucketInstanceId].push(lt.featureIndex))}}return ye},zo.prototype.insertCollisionBox=function(h,v,p,g,S){(v?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:g,collisionGroupID:S},h[0],h[1],h[2],h[3])},zo.prototype.insertCollisionCircles=function(h,v,p,g,S){for(var w=v?this.ignoredGrid:this.grid,C={bucketInstanceId:p,featureIndex:g,collisionGroupID:S},O=0;O<h.length;O+=4)w.insertCircle(C,h[O],h[O+1],h[O+2])},zo.prototype.projectAndGetPerspectiveRatio=function(h,v,p){var g=[v,p,0,1];return na(g,g,h),{point:new _.Point((g[0]/g[3]+1)/2*this.transform.width+100,(-g[1]/g[3]+1)/2*this.transform.height+100),perspectiveRatio:.5+this.transform.cameraToCenterDistance/g[3]*.5}},zo.prototype.isOffscreen=function(h,v,p,g){return p<100||h>=this.screenRightBoundary||g<100||v>this.screenBottomBoundary},zo.prototype.isInsideGrid=function(h,v,p,g){return p>=0&&h<this.gridRightBoundary&&g>=0&&v<this.gridBottomBoundary},zo.prototype.getViewportMatrix=function(){var h=_.identity([]);return _.translate(h,h,[-100,-100,0]),h};var ns=function(h,v,p,g){this.opacity=h?Math.max(0,Math.min(1,h.opacity+(h.placed?v:-v))):g&&p?1:0,this.placed=p};ns.prototype.isHidden=function(){return this.opacity===0&&!this.placed};var $o=function(h,v,p,g,S){this.text=new ns(h?h.text:null,v,p,S),this.icon=new ns(h?h.icon:null,v,g,S)};$o.prototype.isHidden=function(){return this.text.isHidden()&&this.icon.isHidden()};var Du=function(h,v,p){this.text=h,this.icon=v,this.skipFade=p},vs=function(){this.invProjMatrix=_.create(),this.viewportMatrix=_.create(),this.circles=[]},_c=function(h,v,p,g,S){this.bucketInstanceId=h,this.featureIndex=v,this.sourceLayerIndex=p,this.bucketIndex=g,this.tileID=S},ya=function(h){this.crossSourceCollisions=h,this.maxGroupID=0,this.collisionGroups={}};function Ji(h,v,p,g,S){var w=_.getAnchorAlignment(h),C=-(w.horizontalAlign-.5)*v,O=-(w.verticalAlign-.5)*p,X=_.evaluateVariableOffset(h,g);return new _.Point(C+X[0]*S,O+X[1]*S)}function Jt(h,v,p,g,S,w){var C=h.x1,O=h.x2,X=h.y1,J=h.y2,me=h.anchorPointX,ye=h.anchorPointY,Ae=new _.Point(v,p);return g&&Ae._rotate(S?w:-w),{x1:C+Ae.x,y1:X+Ae.y,x2:O+Ae.x,y2:J+Ae.y,anchorPointX:me,anchorPointY:ye}}ya.prototype.get=function(h){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[h]){var v=++this.maxGroupID;this.collisionGroups[h]={ID:v,predicate:function(p){return p.collisionGroupID===v}}}return this.collisionGroups[h]};var yn=function(h,v,p,g){this.transform=h.clone(),this.collisionIndex=new zo(this.transform),this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=v,this.retainedQueryData={},this.collisionGroups=new ya(p),this.collisionCircleArrays={},this.prevPlacement=g,g&&(g.prevPlacement=void 0),this.placedOrientations={}};function ge(h,v,p,g,S){h.emplaceBack(v?1:0,p?1:0,g||0,S||0),h.emplaceBack(v?1:0,p?1:0,g||0,S||0),h.emplaceBack(v?1:0,p?1:0,g||0,S||0),h.emplaceBack(v?1:0,p?1:0,g||0,S||0)}yn.prototype.getBucketParts=function(h,v,p,g){var S=p.getBucket(v),w=p.latestFeatureIndex;if(S&&w&&v.id===S.layerIds[0]){var C=p.collisionBoxArray,O=S.layers[0].layout,X=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),J=p.tileSize/_.EXTENT,me=this.transform.calculatePosMatrix(p.tileID.toUnwrapped()),ye=O.get("text-pitch-alignment")==="map",Ae=O.get("text-rotation-alignment")==="map",Ve=la(p,1,this.transform.zoom),Ue=Pa(me,ye,Ae,this.transform,Ve),lt=null;if(ye){var Be=Si(me,ye,Ae,this.transform,Ve);lt=_.multiply([],this.transform.labelPlaneMatrix,Be)}this.retainedQueryData[S.bucketInstanceId]=new _c(S.bucketInstanceId,w,S.sourceLayerIndex,S.index,p.tileID);var st={bucket:S,layout:O,posMatrix:me,textLabelPlaneMatrix:Ue,labelToScreenMatrix:lt,scale:X,textPixelRatio:J,holdingForFade:p.holdingForFade(),collisionBoxArray:C,partiallyEvaluatedTextSize:_.evaluateSizeForZoom(S.textSizeData,this.transform.zoom),collisionGroup:this.collisionGroups.get(S.sourceID)};if(g)for(var xt=0,Ut=S.sortKeyRanges;xt<Ut.length;xt+=1){var ar=Ut[xt];h.push({sortKey:ar.sortKey,symbolInstanceStart:ar.symbolInstanceStart,symbolInstanceEnd:ar.symbolInstanceEnd,parameters:st})}else h.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:st})}},yn.prototype.attemptAnchorPlacement=function(h,v,p,g,S,w,C,O,X,J,me,ye,Ae,Ve,Ue){var lt,Be=[ye.textOffset0,ye.textOffset1],st=Ji(h,p,g,Be,S),xt=this.collisionIndex.placeCollisionBox(Jt(v,st.x,st.y,w,C,this.transform.angle),me,O,X,J.predicate);if(!Ue||this.collisionIndex.placeCollisionBox(Jt(Ue,st.x,st.y,w,C,this.transform.angle),me,O,X,J.predicate).box.length!==0)return xt.box.length>0?(this.prevPlacement&&this.prevPlacement.variableOffsets[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID]&&this.prevPlacement.placements[ye.crossTileID].text&&(lt=this.prevPlacement.variableOffsets[ye.crossTileID].anchor),this.variableOffsets[ye.crossTileID]={textOffset:Be,width:p,height:g,anchor:h,textBoxScale:S,prevAnchor:lt},this.markUsedJustification(Ae,h,ye,Ve),Ae.allowVerticalPlacement&&(this.markUsedOrientation(Ae,Ve,ye),this.placedOrientations[ye.crossTileID]=Ve),{shift:st,placedGlyphBoxes:xt}):void 0},yn.prototype.placeLayerBucketPart=function(h,v,p){var g=this,S=h.parameters,w=S.bucket,C=S.layout,O=S.posMatrix,X=S.textLabelPlaneMatrix,J=S.labelToScreenMatrix,me=S.textPixelRatio,ye=S.holdingForFade,Ae=S.collisionBoxArray,Ve=S.partiallyEvaluatedTextSize,Ue=S.collisionGroup,lt=C.get("text-optional"),Be=C.get("icon-optional"),st=C.get("text-allow-overlap"),xt=C.get("icon-allow-overlap"),Ut=C.get("text-rotation-alignment")==="map",ar=C.get("text-pitch-alignment")==="map",qt=C.get("icon-text-fit")!=="none",fr=C.get("symbol-z-order")==="viewport-y",br=st&&(xt||!w.hasIconData()||Be),jr=xt&&(st||!w.hasTextData()||lt);!w.collisionArrays&&Ae&&w.deserializeCollisionBoxes(Ae);var Fr=function(gn,ii){if(!v[gn.crossTileID])if(ye)g.placements[gn.crossTileID]=new Du(!1,!1,!1);else{var pi,ri=!1,Qn=!1,fi=!0,Jn=null,Xn={box:null,offscreen:null},Mo={box:null,offscreen:null},Ka=null,Io=null,go=0,Ha=0,Qa=0;ii.textFeatureIndex?go=ii.textFeatureIndex:gn.useRuntimeCollisionCircles&&(go=gn.featureIndex),ii.verticalTextFeatureIndex&&(Ha=ii.verticalTextFeatureIndex);var xs=ii.textBox;if(xs){var bs=function(Bi){var Ko=_.WritingMode.horizontal;if(w.allowVerticalPlacement&&!Bi&&g.prevPlacement){var oo=g.prevPlacement.placedOrientations[gn.crossTileID];oo&&(g.placedOrientations[gn.crossTileID]=oo,g.markUsedOrientation(w,Ko=oo,gn))}return Ko},fl=function(Bi,Ko){if(w.allowVerticalPlacement&&gn.numVerticalGlyphVertices>0&&ii.verticalTextBox)for(var oo=0,hu=w.writingModes;oo<hu.length&&(hu[oo]===_.WritingMode.vertical?(Xn=Ko(),Mo=Xn):Xn=Bi(),!(Xn&&Xn.box&&Xn.box.length));oo+=1);else Xn=Bi()};if(C.get("text-variable-anchor")){var Es=C.get("text-variable-anchor");if(g.prevPlacement&&g.prevPlacement.variableOffsets[gn.crossTileID]){var lu=g.prevPlacement.variableOffsets[gn.crossTileID];Es.indexOf(lu.anchor)>0&&(Es=Es.filter(function(Bi){return Bi!==lu.anchor})).unshift(lu.anchor)}var Zs=function(Bi,Ko,oo){for(var hu=Bi.x2-Bi.x1,Ic=Bi.y2-Bi.y1,Wu=gn.textBoxScale,Ch=qt&&!xt?Ko:null,Oo={box:[],offscreen:!1},kr=st?2*Es.length:Es.length,Vs=0;Vs<kr;++Vs){var Rh=g.attemptAnchorPlacement(Es[Vs%Es.length],Bi,hu,Ic,Wu,Ut,ar,me,O,Ue,Vs>=Es.length,gn,w,oo,Ch);if(Rh&&(Oo=Rh.placedGlyphBoxes)&&Oo.box&&Oo.box.length){ri=!0,Jn=Rh.shift;break}}return Oo};fl(function(){return Zs(xs,ii.iconBox,_.WritingMode.horizontal)},function(){var Bi=ii.verticalTextBox;return w.allowVerticalPlacement&&!(Xn&&Xn.box&&Xn.box.length)&&gn.numVerticalGlyphVertices>0&&Bi?Zs(Bi,ii.verticalIconBox,_.WritingMode.vertical):{box:null,offscreen:null}}),Xn&&(ri=Xn.box,fi=Xn.offscreen);var Mc=bs(Xn&&Xn.box);if(!ri&&g.prevPlacement){var Hu=g.prevPlacement.variableOffsets[gn.crossTileID];Hu&&(g.variableOffsets[gn.crossTileID]=Hu,g.markUsedJustification(w,Hu.anchor,gn,Mc))}}else{var Tu=function(Bi,Ko){var oo=g.collisionIndex.placeCollisionBox(Bi,st,me,O,Ue.predicate);return oo&&oo.box&&oo.box.length&&(g.markUsedOrientation(w,Ko,gn),g.placedOrientations[gn.crossTileID]=Ko),oo};fl(function(){return Tu(xs,_.WritingMode.horizontal)},function(){var Bi=ii.verticalTextBox;return w.allowVerticalPlacement&&gn.numVerticalGlyphVertices>0&&Bi?Tu(Bi,_.WritingMode.vertical):{box:null,offscreen:null}}),bs(Xn&&Xn.box&&Xn.box.length)}}if(ri=(pi=Xn)&&pi.box&&pi.box.length>0,fi=pi&&pi.offscreen,gn.useRuntimeCollisionCircles){var nc=w.text.placedSymbolArray.get(gn.centerJustifiedTextSymbolIndex),hl=_.evaluateSizeForFeature(w.textSizeData,Ve,nc),cu=C.get("text-padding");Ka=g.collisionIndex.placeCollisionCircles(st,nc,w.lineVertexArray,w.glyphOffsetArray,hl,O,X,J,p,ar,Ue.predicate,gn.collisionCircleDiameter,cu),ri=st||Ka.circles.length>0&&!Ka.collisionDetected,fi=fi&&Ka.offscreen}if(ii.iconFeatureIndex&&(Qa=ii.iconFeatureIndex),ii.iconBox){var pl=function(Bi){var Ko=qt&&Jn?Jt(Bi,Jn.x,Jn.y,Ut,ar,g.transform.angle):Bi;return g.collisionIndex.placeCollisionBox(Ko,xt,me,O,Ue.predicate)};Qn=Mo&&Mo.box&&Mo.box.length&&ii.verticalIconBox?(Io=pl(ii.verticalIconBox)).box.length>0:(Io=pl(ii.iconBox)).box.length>0,fi=fi&&Io.offscreen}var Po=lt||gn.numHorizontalGlyphVertices===0&&gn.numVerticalGlyphVertices===0,ao=Be||gn.numIconVertices===0;if(Po||ao?ao?Po||(Qn=Qn&&ri):ri=Qn&&ri:Qn=ri=Qn&&ri,ri&&pi&&pi.box&&g.collisionIndex.insertCollisionBox(pi.box,C.get("text-ignore-placement"),w.bucketInstanceId,Mo&&Mo.box&&Ha?Ha:go,Ue.ID),Qn&&Io&&g.collisionIndex.insertCollisionBox(Io.box,C.get("icon-ignore-placement"),w.bucketInstanceId,Qa,Ue.ID),Ka&&(ri&&g.collisionIndex.insertCollisionCircles(Ka.circles,C.get("text-ignore-placement"),w.bucketInstanceId,go,Ue.ID),p)){var Is=w.bucketInstanceId,fu=g.collisionCircleArrays[Is];fu===void 0&&(fu=g.collisionCircleArrays[Is]=new vs);for(var wu=0;wu<Ka.circles.length;wu+=4)fu.circles.push(Ka.circles[wu+0]),fu.circles.push(Ka.circles[wu+1]),fu.circles.push(Ka.circles[wu+2]),fu.circles.push(Ka.collisionDetected?1:0)}g.placements[gn.crossTileID]=new Du(ri||br,Qn||jr,fi||w.justReloaded),v[gn.crossTileID]=!0}};if(fr)for(var hn=w.getSortedSymbolIndexes(this.transform.angle),Un=hn.length-1;Un>=0;--Un){var Ln=hn[Un];Fr(w.symbolInstances.get(Ln),w.collisionArrays[Ln])}else for(var zn=h.symbolInstanceStart;zn<h.symbolInstanceEnd;zn++)Fr(w.symbolInstances.get(zn),w.collisionArrays[zn]);if(p&&w.bucketInstanceId in this.collisionCircleArrays){var Ui=this.collisionCircleArrays[w.bucketInstanceId];_.invert(Ui.invProjMatrix,O),Ui.viewportMatrix=this.collisionIndex.getViewportMatrix()}w.justReloaded=!1},yn.prototype.markUsedJustification=function(h,v,p,g){var S;S=g===_.WritingMode.vertical?p.verticalPlacedTextSymbolIndex:{left:p.leftJustifiedTextSymbolIndex,center:p.centerJustifiedTextSymbolIndex,right:p.rightJustifiedTextSymbolIndex}[_.getAnchorJustification(v)];for(var w=0,C=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex,p.verticalPlacedTextSymbolIndex];w<C.length;w+=1){var O=C[w];O>=0&&(h.text.placedSymbolArray.get(O).crossTileID=S>=0&&O!==S?0:p.crossTileID)}},yn.prototype.markUsedOrientation=function(h,v,p){for(var g=v===_.WritingMode.horizontal||v===_.WritingMode.horizontalOnly?v:0,S=v===_.WritingMode.vertical?v:0,w=0,C=[p.leftJustifiedTextSymbolIndex,p.centerJustifiedTextSymbolIndex,p.rightJustifiedTextSymbolIndex];w<C.length;w+=1)h.text.placedSymbolArray.get(C[w]).placedOrientation=g;p.verticalPlacedTextSymbolIndex&&(h.text.placedSymbolArray.get(p.verticalPlacedTextSymbolIndex).placedOrientation=S)},yn.prototype.commit=function(h){this.commitTime=h,this.zoomAtLastRecencyCheck=this.transform.zoom;var v=this.prevPlacement,p=!1;this.prevZoomAdjustment=v?v.zoomAdjustment(this.transform.zoom):0;var g=v?v.symbolFadeChange(h):1,S=v?v.opacities:{},w=v?v.variableOffsets:{},C=v?v.placedOrientations:{};for(var O in this.placements){var X=this.placements[O],J=S[O];J?(this.opacities[O]=new $o(J,g,X.text,X.icon),p=p||X.text!==J.text.placed||X.icon!==J.icon.placed):(this.opacities[O]=new $o(null,g,X.text,X.icon,X.skipFade),p=p||X.text||X.icon)}for(var me in S){var ye=S[me];if(!this.opacities[me]){var Ae=new $o(ye,g,!1,!1);Ae.isHidden()||(this.opacities[me]=Ae,p=p||ye.text.placed||ye.icon.placed)}}for(var Ve in w)this.variableOffsets[Ve]||!this.opacities[Ve]||this.opacities[Ve].isHidden()||(this.variableOffsets[Ve]=w[Ve]);for(var Ue in C)this.placedOrientations[Ue]||!this.opacities[Ue]||this.opacities[Ue].isHidden()||(this.placedOrientations[Ue]=C[Ue]);p?this.lastPlacementChangeTime=h:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=v?v.lastPlacementChangeTime:h)},yn.prototype.updateLayerOpacities=function(h,v){for(var p={},g=0,S=v;g<S.length;g+=1){var w=S[g],C=w.getBucket(h);C&&w.latestFeatureIndex&&h.id===C.layerIds[0]&&this.updateBucketOpacities(C,p,w.collisionBoxArray)}},yn.prototype.updateBucketOpacities=function(h,v,p){var g=this;h.hasTextData()&&h.text.opacityVertexArray.clear(),h.hasIconData()&&h.icon.opacityVertexArray.clear(),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexArray.clear(),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexArray.clear();var S=h.layers[0].layout,w=new $o(null,0,!1,!1,!0),C=S.get("text-allow-overlap"),O=S.get("icon-allow-overlap"),X=S.get("text-variable-anchor"),J=S.get("text-rotation-alignment")==="map",me=S.get("text-pitch-alignment")==="map",ye=S.get("icon-text-fit")!=="none",Ae=new $o(null,0,C&&(O||!h.hasIconData()||S.get("icon-optional")),O&&(C||!h.hasTextData()||S.get("text-optional")),!0);!h.collisionArrays&&p&&(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData())&&h.deserializeCollisionBoxes(p);for(var Ve=function(st,xt,Ut){for(var ar=0;ar<xt/4;ar++)st.opacityVertexArray.emplaceBack(Ut)},Ue=function(st){var xt=h.symbolInstances.get(st),Ut=xt.numHorizontalGlyphVertices,ar=xt.numVerticalGlyphVertices,qt=xt.crossTileID,fr=g.opacities[qt];v[qt]?fr=w:fr||(g.opacities[qt]=fr=Ae),v[qt]=!0;var br=xt.numIconVertices>0,jr=g.placedOrientations[xt.crossTileID],Fr=jr===_.WritingMode.vertical,hn=jr===_.WritingMode.horizontal||jr===_.WritingMode.horizontalOnly;if(Ut>0||ar>0){var Un=wo(fr.text);Ve(h.text,Ut,Fr?fo:Un),Ve(h.text,ar,hn?fo:Un);var Ln=fr.text.isHidden();[xt.rightJustifiedTextSymbolIndex,xt.centerJustifiedTextSymbolIndex,xt.leftJustifiedTextSymbolIndex].forEach(function(Xn){Xn>=0&&(h.text.placedSymbolArray.get(Xn).hidden=Ln||Fr?1:0)}),xt.verticalPlacedTextSymbolIndex>=0&&(h.text.placedSymbolArray.get(xt.verticalPlacedTextSymbolIndex).hidden=Ln||hn?1:0);var zn=g.variableOffsets[xt.crossTileID];zn&&g.markUsedJustification(h,zn.anchor,xt,jr);var Ui=g.placedOrientations[xt.crossTileID];Ui&&(g.markUsedJustification(h,"left",xt,Ui),g.markUsedOrientation(h,Ui,xt))}if(br){var gn=wo(fr.icon),ii=!(ye&&xt.verticalPlacedIconSymbolIndex&&Fr);xt.placedIconSymbolIndex>=0&&(Ve(h.icon,xt.numIconVertices,ii?gn:fo),h.icon.placedSymbolArray.get(xt.placedIconSymbolIndex).hidden=fr.icon.isHidden()),xt.verticalPlacedIconSymbolIndex>=0&&(Ve(h.icon,xt.numVerticalIconVertices,ii?fo:gn),h.icon.placedSymbolArray.get(xt.verticalPlacedIconSymbolIndex).hidden=fr.icon.isHidden())}if(h.hasIconCollisionBoxData()||h.hasTextCollisionBoxData()){var pi=h.collisionArrays[st];if(pi){var ri=new _.Point(0,0);if(pi.textBox||pi.verticalTextBox){var Qn=!0;if(X){var fi=g.variableOffsets[qt];fi?(ri=Ji(fi.anchor,fi.width,fi.height,fi.textOffset,fi.textBoxScale),J&&ri._rotate(me?g.transform.angle:-g.transform.angle)):Qn=!1}pi.textBox&&ge(h.textCollisionBox.collisionVertexArray,fr.text.placed,!Qn||Fr,ri.x,ri.y),pi.verticalTextBox&&ge(h.textCollisionBox.collisionVertexArray,fr.text.placed,!Qn||hn,ri.x,ri.y)}var Jn=!!(!hn&&pi.verticalIconBox);pi.iconBox&&ge(h.iconCollisionBox.collisionVertexArray,fr.icon.placed,Jn,ye?ri.x:0,ye?ri.y:0),pi.verticalIconBox&&ge(h.iconCollisionBox.collisionVertexArray,fr.icon.placed,!Jn,ye?ri.x:0,ye?ri.y:0)}}},lt=0;lt<h.symbolInstances.length;lt++)Ue(lt);if(h.sortFeatures(this.transform.angle),this.retainedQueryData[h.bucketInstanceId]&&(this.retainedQueryData[h.bucketInstanceId].featureSortOrder=h.featureSortOrder),h.hasTextData()&&h.text.opacityVertexBuffer&&h.text.opacityVertexBuffer.updateData(h.text.opacityVertexArray),h.hasIconData()&&h.icon.opacityVertexBuffer&&h.icon.opacityVertexBuffer.updateData(h.icon.opacityVertexArray),h.hasIconCollisionBoxData()&&h.iconCollisionBox.collisionVertexBuffer&&h.iconCollisionBox.collisionVertexBuffer.updateData(h.iconCollisionBox.collisionVertexArray),h.hasTextCollisionBoxData()&&h.textCollisionBox.collisionVertexBuffer&&h.textCollisionBox.collisionVertexBuffer.updateData(h.textCollisionBox.collisionVertexArray),h.bucketInstanceId in this.collisionCircleArrays){var Be=this.collisionCircleArrays[h.bucketInstanceId];h.placementInvProjMatrix=Be.invProjMatrix,h.placementViewportMatrix=Be.viewportMatrix,h.collisionCircleArray=Be.circles,delete this.collisionCircleArrays[h.bucketInstanceId]}},yn.prototype.symbolFadeChange=function(h){return this.fadeDuration===0?1:(h-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment},yn.prototype.zoomAdjustment=function(h){return Math.max(0,(this.transform.zoom-h)/1.5)},yn.prototype.hasTransitions=function(h){return this.stale||h-this.lastPlacementChangeTime<this.fadeDuration},yn.prototype.stillRecent=function(h,v){var p=this.zoomAtLastRecencyCheck===v?1-this.zoomAdjustment(v):1;return this.zoomAtLastRecencyCheck=v,this.commitTime+this.fadeDuration*p>h},yn.prototype.setStale=function(){this.stale=!0};var Pe=Math.pow(2,25),_t=Math.pow(2,24),cr=Math.pow(2,17),Kr=Math.pow(2,16),kn=Math.pow(2,9),ji=Math.pow(2,8),vo=Math.pow(2,1);function wo(h){if(h.opacity===0&&!h.placed)return 0;if(h.opacity===1&&h.placed)return 4294967295;var v=h.placed?1:0,p=Math.floor(127*h.opacity);return p*Pe+v*_t+p*cr+v*Kr+p*kn+v*ji+p*vo+v}var fo=0,Ds=function(h){this._sortAcrossTiles=h.layout.get("symbol-z-order")!=="viewport-y"&&h.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs={},this._bucketParts=[]};Ds.prototype.continuePlacement=function(h,v,p,g,S){for(var w=this._bucketParts;this._currentTileIndex<h.length;)if(v.getBucketParts(w,g,h[this._currentTileIndex],this._sortAcrossTiles),this._currentTileIndex++,S())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,w.sort(function(C,O){return C.sortKey-O.sortKey}));this._currentPartIndex<w.length;)if(v.placeLayerBucketPart(w[this._currentPartIndex],this._seenCrossTileIDs,p),this._currentPartIndex++,S())return!0;return!1};var Ms=function(h,v,p,g,S,w,C){this.placement=new yn(h,S,w,C),this._currentPlacementIndex=v.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=g,this._done=!1};Ms.prototype.isDone=function(){return this._done},Ms.prototype.continuePlacement=function(h,v,p){for(var g=this,S=_.browser.now(),w=function(){var X=_.browser.now()-S;return!g._forceFullPlacement&&X>2};this._currentPlacementIndex>=0;){var C=v[h[this._currentPlacementIndex]],O=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=O)&&(!C.maxzoom||C.maxzoom>O)){if(this._inProgressLayer||(this._inProgressLayer=new Ds(C)),this._inProgressLayer.continuePlacement(p[C.source],this.placement,this._showCollisionBoxes,C,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0},Ms.prototype.commit=function(h){return this.placement.commit(h),this.placement};var ep=512/_.EXTENT/2,Af=function(h,v,p){this.tileID=h,this.indexedSymbolInstances={},this.bucketInstanceId=p;for(var g=0;g<v.length;g++){var S=v.get(g),w=S.key;this.indexedSymbolInstances[w]||(this.indexedSymbolInstances[w]=[]),this.indexedSymbolInstances[w].push({crossTileID:S.crossTileID,coord:this.getScaledCoordinates(S,h)})}};Af.prototype.getScaledCoordinates=function(h,v){var p=ep/Math.pow(2,v.canonical.z-this.tileID.canonical.z);return{x:Math.floor((v.canonical.x*_.EXTENT+h.anchorX)*p),y:Math.floor((v.canonical.y*_.EXTENT+h.anchorY)*p)}},Af.prototype.findMatches=function(h,v,p){for(var g=this.tileID.canonical.z<v.canonical.z?1:Math.pow(2,this.tileID.canonical.z-v.canonical.z),S=0;S<h.length;S++){var w=h.get(S);if(!w.crossTileID){var C=this.indexedSymbolInstances[w.key];if(C)for(var O=this.getScaledCoordinates(w,v),X=0,J=C;X<J.length;X+=1){var me=J[X];if(Math.abs(me.coord.x-O.x)<=g&&Math.abs(me.coord.y-O.y)<=g&&!p[me.crossTileID]){p[me.crossTileID]=!0,w.crossTileID=me.crossTileID;break}}}}};var Yo=function(){this.maxCrossTileID=0};Yo.prototype.generate=function(){return++this.maxCrossTileID};var El=function(){this.indexes={},this.usedCrossTileIDs={},this.lng=0};El.prototype.handleWrapJump=function(h){var v=Math.round((h-this.lng)/360);if(v!==0)for(var p in this.indexes){var g=this.indexes[p],S={};for(var w in g){var C=g[w];C.tileID=C.tileID.unwrapTo(C.tileID.wrap+v),S[C.tileID.key]=C}this.indexes[p]=S}this.lng=h},El.prototype.addBucket=function(h,v,p){if(this.indexes[h.overscaledZ]&&this.indexes[h.overscaledZ][h.key]){if(this.indexes[h.overscaledZ][h.key].bucketInstanceId===v.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(h.overscaledZ,this.indexes[h.overscaledZ][h.key])}for(var g=0;g<v.symbolInstances.length;g++)v.symbolInstances.get(g).crossTileID=0;this.usedCrossTileIDs[h.overscaledZ]||(this.usedCrossTileIDs[h.overscaledZ]={});var S=this.usedCrossTileIDs[h.overscaledZ];for(var w in this.indexes){var C=this.indexes[w];if(Number(w)>h.overscaledZ)for(var O in C){var X=C[O];X.tileID.isChildOf(h)&&X.findMatches(v.symbolInstances,h,S)}else{var J=C[h.scaledTo(Number(w)).key];J&&J.findMatches(v.symbolInstances,h,S)}}for(var me=0;me<v.symbolInstances.length;me++){var ye=v.symbolInstances.get(me);ye.crossTileID||(ye.crossTileID=p.generate(),S[ye.crossTileID]=!0)}return this.indexes[h.overscaledZ]===void 0&&(this.indexes[h.overscaledZ]={}),this.indexes[h.overscaledZ][h.key]=new Af(h,v.symbolInstances,v.bucketInstanceId),!0},El.prototype.removeBucketCrossTileIDs=function(h,v){for(var p in v.indexedSymbolInstances)for(var g=0,S=v.indexedSymbolInstances[p];g<S.length;g+=1)delete this.usedCrossTileIDs[h][S[g].crossTileID]},El.prototype.removeStaleBuckets=function(h){var v=!1;for(var p in this.indexes){var g=this.indexes[p];for(var S in g)h[g[S].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,g[S]),delete g[S],v=!0)}return v};var Sl=function(){this.layerIndexes={},this.crossTileIDs=new Yo,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}};Sl.prototype.addLayer=function(h,v,p){var g=this.layerIndexes[h.id];g===void 0&&(g=this.layerIndexes[h.id]=new El);var S=!1,w={};g.handleWrapJump(p);for(var C=0,O=v;C<O.length;C+=1){var X=O[C],J=X.getBucket(h);J&&h.id===J.layerIds[0]&&(J.bucketInstanceId||(J.bucketInstanceId=++this.maxBucketInstanceId),g.addBucket(X.tileID,J,this.crossTileIDs)&&(S=!0),w[J.bucketInstanceId]=!0)}return g.removeStaleBuckets(w)&&(S=!0),S},Sl.prototype.pruneUnusedLayers=function(h){var v={};for(var p in h.forEach(function(g){v[g]=!0}),this.layerIndexes)v[p]||delete this.layerIndexes[p]};var Lu=function(h,v){return _.emitValidationErrors(h,v&&v.filter(function(p){return p.identifier!=="source.canvas"}))},Bu=_.pick(Vr,["addLayer","removeLayer","setPaintProperty","setLayoutProperty","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData"]),Ju=_.pick(Vr,["setCenter","setZoom","setBearing","setPitch"]),$c=function(){var h={},v=_.styleSpec.$version;for(var p in _.styleSpec.$root){var g,S=_.styleSpec.$root[p];S.required&&(g=p==="version"?v:S.type==="array"?[]:{})!=null&&(h[p]=g)}return h}(),Ls=function(h){function v(p,g){var S=this;g===void 0&&(g={}),h.call(this),this.map=p,this.dispatcher=new Nt(rr(),this),this.imageManager=new Et,this.imageManager.setEventedParent(this),this.glyphManager=new lr(p._requestManager,g.localIdeographFontFamily),this.lineAtlas=new Qe(256,512),this.crossTileSymbolIndex=new Sl,this._layers={},this._serializedLayers={},this._order=[],this.sourceCaches={},this.zoomHistory=new _.ZoomHistory,this._loaded=!1,this._availableImages=[],this._resetUpdates(),this.dispatcher.broadcast("setReferrer",_.getReferrer());var w=this;this._rtlTextPluginCallback=v.registerForPluginStateChange(function(C){w.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:C.pluginStatus,pluginURL:C.pluginURL},function(O,X){if(_.triggerPluginCompletionEvent(O),X&&X.every(function(me){return me}))for(var J in w.sourceCaches)w.sourceCaches[J].reload()})}),this.on("data",function(C){if(C.dataType==="source"&&C.sourceDataType==="metadata"){var O=S.sourceCaches[C.sourceId];if(O){var X=O.getSource();if(X&&X.vectorLayerIds)for(var J in S._layers){var me=S._layers[J];me.source===X.id&&S._validateLayer(me)}}}})}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.loadURL=function(p,g){var S=this;g===void 0&&(g={}),this.fire(new _.Event("dataloading",{dataType:"style"}));var w=typeof g.validate=="boolean"?g.validate:!_.isMapboxURL(p);p=this.map._requestManager.normalizeStyleURL(p,g.accessToken);var C=this.map._requestManager.transformRequest(p,_.ResourceType.Style);this._request=_.getJSON(C,function(O,X){S._request=null,O?S.fire(new _.ErrorEvent(O)):X&&S._load(X,w)})},v.prototype.loadJSON=function(p,g){var S=this;g===void 0&&(g={}),this.fire(new _.Event("dataloading",{dataType:"style"})),this._request=_.browser.frame(function(){S._request=null,S._load(p,g.validate!==!1)})},v.prototype.loadEmpty=function(){this.fire(new _.Event("dataloading",{dataType:"style"})),this._load($c,!1)},v.prototype._load=function(p,g){if(!g||!Lu(this,_.validateStyle(p))){for(var S in this._loaded=!0,this.stylesheet=p,p.sources)this.addSource(S,p.sources[S],{validate:!1});p.sprite?this._loadSprite(p.sprite):this.imageManager.setLoaded(!0),this.glyphManager.setURL(p.glyphs);var w=zr(this.stylesheet.layers);this._order=w.map(function(J){return J.id}),this._layers={},this._serializedLayers={};for(var C=0,O=w;C<O.length;C+=1){var X=O[C];(X=_.createStyleLayer(X)).setEventedParent(this,{layer:{id:X.id}}),this._layers[X.id]=X,this._serializedLayers[X.id]=X.serialize()}this.dispatcher.broadcast("setLayers",this._serializeLayers(this._order)),this.light=new Ft(this.stylesheet.light),this.fire(new _.Event("data",{dataType:"style"})),this.fire(new _.Event("style.load"))}},v.prototype._loadSprite=function(p){var g=this;this._spriteRequest=function(S,w,C){var O,X,J,me=_.browser.devicePixelRatio>1?"@2x":"",ye=_.getJSON(w.transformRequest(w.normalizeSpriteURL(S,me,".json"),_.ResourceType.SpriteJSON),function(Ue,lt){ye=null,J||(J=Ue,O=lt,Ve())}),Ae=_.getImage(w.transformRequest(w.normalizeSpriteURL(S,me,".png"),_.ResourceType.SpriteImage),function(Ue,lt){Ae=null,J||(J=Ue,X=lt,Ve())});function Ve(){if(J)C(J);else if(O&&X){var Ue=_.browser.getImageData(X),lt={};for(var Be in O){var st=O[Be],xt=st.width,Ut=st.height,ar=st.x,qt=st.y,fr=st.sdf,br=st.pixelRatio,jr=st.stretchX,Fr=st.stretchY,hn=st.content,Un=new _.RGBAImage({width:xt,height:Ut});_.RGBAImage.copy(Ue,Un,{x:ar,y:qt},{x:0,y:0},{width:xt,height:Ut}),lt[Be]={data:Un,pixelRatio:br,sdf:fr,stretchX:jr,stretchY:Fr,content:hn}}C(null,lt)}}return{cancel:function(){ye&&(ye.cancel(),ye=null),Ae&&(Ae.cancel(),Ae=null)}}}(p,this.map._requestManager,function(S,w){if(g._spriteRequest=null,S)g.fire(new _.ErrorEvent(S));else if(w)for(var C in w)g.imageManager.addImage(C,w[C]);g.imageManager.setLoaded(!0),g._availableImages=g.imageManager.listImages(),g.dispatcher.broadcast("setImages",g._availableImages),g.fire(new _.Event("data",{dataType:"style"}))})},v.prototype._validateLayer=function(p){var g=this.sourceCaches[p.source];if(g){var S=p.sourceLayer;if(S){var w=g.getSource();(w.type==="geojson"||w.vectorLayerIds&&w.vectorLayerIds.indexOf(S)===-1)&&this.fire(new _.ErrorEvent(new Error('Source layer "'+S+'" does not exist on source "'+w.id+'" as specified by style layer "'+p.id+'"')))}}},v.prototype.loaded=function(){if(!this._loaded||Object.keys(this._updatedSources).length)return!1;for(var p in this.sourceCaches)if(!this.sourceCaches[p].loaded())return!1;return!!this.imageManager.isLoaded()},v.prototype._serializeLayers=function(p){for(var g=[],S=0,w=p;S<w.length;S+=1){var C=this._layers[w[S]];C.type!=="custom"&&g.push(C.serialize())}return g},v.prototype.hasTransitions=function(){if(this.light&&this.light.hasTransition())return!0;for(var p in this.sourceCaches)if(this.sourceCaches[p].hasTransition())return!0;for(var g in this._layers)if(this._layers[g].hasTransition())return!0;return!1},v.prototype._checkLoaded=function(){if(!this._loaded)throw new Error("Style is not done loading")},v.prototype.update=function(p){if(this._loaded){var g=this._changed;if(this._changed){var S=Object.keys(this._updatedLayers),w=Object.keys(this._removedLayers);for(var C in(S.length||w.length)&&this._updateWorkerLayers(S,w),this._updatedSources){var O=this._updatedSources[C];O==="reload"?this._reloadSource(C):O==="clear"&&this._clearSource(C)}for(var X in this._updateTilesForChangedImages(),this._updatedPaintProps)this._layers[X].updateTransitions(p);this.light.updateTransitions(p),this._resetUpdates()}var J={};for(var me in this.sourceCaches){var ye=this.sourceCaches[me];J[me]=ye.used,ye.used=!1}for(var Ae=0,Ve=this._order;Ae<Ve.length;Ae+=1){var Ue=this._layers[Ve[Ae]];Ue.recalculate(p,this._availableImages),!Ue.isHidden(p.zoom)&&Ue.source&&(this.sourceCaches[Ue.source].used=!0)}for(var lt in J){var Be=this.sourceCaches[lt];J[lt]!==Be.used&&Be.fire(new _.Event("data",{sourceDataType:"visibility",dataType:"source",sourceId:lt}))}this.light.recalculate(p),this.z=p.zoom,g&&this.fire(new _.Event("data",{dataType:"style"}))}},v.prototype._updateTilesForChangedImages=function(){var p=Object.keys(this._changedImages);if(p.length){for(var g in this.sourceCaches)this.sourceCaches[g].reloadTilesForDependencies(["icons","patterns"],p);this._changedImages={}}},v.prototype._updateWorkerLayers=function(p,g){this.dispatcher.broadcast("updateLayers",{layers:this._serializeLayers(p),removedIds:g})},v.prototype._resetUpdates=function(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSources={},this._updatedPaintProps={},this._changedImages={}},v.prototype.setState=function(p){var g=this;if(this._checkLoaded(),Lu(this,_.validateStyle(p)))return!1;(p=_.clone$1(p)).layers=zr(p.layers);var S=function(C,O){if(!C)return[{command:Vr.setStyle,args:[O]}];var X=[];try{if(!_.deepEqual(C.version,O.version))return[{command:Vr.setStyle,args:[O]}];_.deepEqual(C.center,O.center)||X.push({command:Vr.setCenter,args:[O.center]}),_.deepEqual(C.zoom,O.zoom)||X.push({command:Vr.setZoom,args:[O.zoom]}),_.deepEqual(C.bearing,O.bearing)||X.push({command:Vr.setBearing,args:[O.bearing]}),_.deepEqual(C.pitch,O.pitch)||X.push({command:Vr.setPitch,args:[O.pitch]}),_.deepEqual(C.sprite,O.sprite)||X.push({command:Vr.setSprite,args:[O.sprite]}),_.deepEqual(C.glyphs,O.glyphs)||X.push({command:Vr.setGlyphs,args:[O.glyphs]}),_.deepEqual(C.transition,O.transition)||X.push({command:Vr.setTransition,args:[O.transition]}),_.deepEqual(C.light,O.light)||X.push({command:Vr.setLight,args:[O.light]});var J={},me=[];(function(Ae,Ve,Ue,lt){var Be;for(Be in Ve=Ve||{},Ae=Ae||{})Ae.hasOwnProperty(Be)&&(Ve.hasOwnProperty(Be)||sn(Be,Ue,lt));for(Be in Ve)Ve.hasOwnProperty(Be)&&(Ae.hasOwnProperty(Be)?_.deepEqual(Ae[Be],Ve[Be])||(Ae[Be].type==="geojson"&&Ve[Be].type==="geojson"&&Vi(Ae,Ve,Be)?Ue.push({command:Vr.setGeoJSONSourceData,args:[Be,Ve[Be].data]}):hi(Be,Ve,Ue,lt)):ei(Be,Ve,Ue))})(C.sources,O.sources,me,J);var ye=[];C.layers&&C.layers.forEach(function(Ae){J[Ae.source]?X.push({command:Vr.removeLayer,args:[Ae.id]}):ye.push(Ae)}),X=X.concat(me),function(Ae,Ve,Ue){Ve=Ve||[];var lt,Be,st,xt,Ut,ar,qt,fr=(Ae=Ae||[]).map(Di),br=Ve.map(Di),jr=Ae.reduce(Ei,{}),Fr=Ve.reduce(Ei,{}),hn=fr.slice(),Un=Object.create(null);for(lt=0,Be=0;lt<fr.length;lt++)Fr.hasOwnProperty(st=fr[lt])?Be++:(Ue.push({command:Vr.removeLayer,args:[st]}),hn.splice(hn.indexOf(st,Be),1));for(lt=0,Be=0;lt<br.length;lt++)hn[hn.length-1-lt]!==(st=br[br.length-1-lt])&&(jr.hasOwnProperty(st)?(Ue.push({command:Vr.removeLayer,args:[st]}),hn.splice(hn.lastIndexOf(st,hn.length-Be),1)):Be++,Ue.push({command:Vr.addLayer,args:[Fr[st],ar=hn[hn.length-lt]]}),hn.splice(hn.length-lt,0,st),Un[st]=!0);for(lt=0;lt<br.length;lt++)if(xt=jr[st=br[lt]],Ut=Fr[st],!Un[st]&&!_.deepEqual(xt,Ut))if(_.deepEqual(xt.source,Ut.source)&&_.deepEqual(xt["source-layer"],Ut["source-layer"])&&_.deepEqual(xt.type,Ut.type)){for(qt in ci(xt.layout,Ut.layout,Ue,st,null,Vr.setLayoutProperty),ci(xt.paint,Ut.paint,Ue,st,null,Vr.setPaintProperty),_.deepEqual(xt.filter,Ut.filter)||Ue.push({command:Vr.setFilter,args:[st,Ut.filter]}),_.deepEqual(xt.minzoom,Ut.minzoom)&&_.deepEqual(xt.maxzoom,Ut.maxzoom)||Ue.push({command:Vr.setLayerZoomRange,args:[st,Ut.minzoom,Ut.maxzoom]}),xt)xt.hasOwnProperty(qt)&&qt!=="layout"&&qt!=="paint"&&qt!=="filter"&&qt!=="metadata"&&qt!=="minzoom"&&qt!=="maxzoom"&&(qt.indexOf("paint.")===0?ci(xt[qt],Ut[qt],Ue,st,qt.slice(6),Vr.setPaintProperty):_.deepEqual(xt[qt],Ut[qt])||Ue.push({command:Vr.setLayerProperty,args:[st,qt,Ut[qt]]}));for(qt in Ut)Ut.hasOwnProperty(qt)&&!xt.hasOwnProperty(qt)&&qt!=="layout"&&qt!=="paint"&&qt!=="filter"&&qt!=="metadata"&&qt!=="minzoom"&&qt!=="maxzoom"&&(qt.indexOf("paint.")===0?ci(xt[qt],Ut[qt],Ue,st,qt.slice(6),Vr.setPaintProperty):_.deepEqual(xt[qt],Ut[qt])||Ue.push({command:Vr.setLayerProperty,args:[st,qt,Ut[qt]]}))}else Ue.push({command:Vr.removeLayer,args:[st]}),ar=hn[hn.lastIndexOf(st)+1],Ue.push({command:Vr.addLayer,args:[Ut,ar]})}(ye,O.layers,X)}catch(Ae){console.warn("Unable to compute style diff:",Ae),X=[{command:Vr.setStyle,args:[O]}]}return X}(this.serialize(),p).filter(function(C){return!(C.command in Ju)});if(S.length===0)return!1;var w=S.filter(function(C){return!(C.command in Bu)});if(w.length>0)throw new Error("Unimplemented: "+w.map(function(C){return C.command}).join(", ")+".");return S.forEach(function(C){C.command!=="setTransition"&&g[C.command].apply(g,C.args)}),this.stylesheet=p,!0},v.prototype.addImage=function(p,g){if(this.getImage(p))return this.fire(new _.ErrorEvent(new Error("An image with this name already exists.")));this.imageManager.addImage(p,g),this._afterImageUpdated(p)},v.prototype.updateImage=function(p,g){this.imageManager.updateImage(p,g)},v.prototype.getImage=function(p){return this.imageManager.getImage(p)},v.prototype.removeImage=function(p){if(!this.getImage(p))return this.fire(new _.ErrorEvent(new Error("No image with this name exists.")));this.imageManager.removeImage(p),this._afterImageUpdated(p)},v.prototype._afterImageUpdated=function(p){this._availableImages=this.imageManager.listImages(),this._changedImages[p]=!0,this._changed=!0,this.dispatcher.broadcast("setImages",this._availableImages),this.fire(new _.Event("data",{dataType:"style"}))},v.prototype.listImages=function(){return this._checkLoaded(),this.imageManager.listImages()},v.prototype.addSource=function(p,g,S){var w=this;if(S===void 0&&(S={}),this._checkLoaded(),this.sourceCaches[p]!==void 0)throw new Error("There is already a source with this ID");if(!g.type)throw new Error("The type property must be defined, but only the following properties were given: "+Object.keys(g).join(", ")+".");if(!(["vector","raster","geojson","video","image"].indexOf(g.type)>=0&&this._validate(_.validateStyle.source,"sources."+p,g,null,S))){this.map&&this.map._collectResourceTiming&&(g.collectResourceTiming=!0);var C=this.sourceCaches[p]=new Q(p,g,this.dispatcher);C.style=this,C.setEventedParent(this,function(){return{isSourceLoaded:w.loaded(),source:C.serialize(),sourceId:p}}),C.onAdd(this.map),this._changed=!0}},v.prototype.removeSource=function(p){if(this._checkLoaded(),this.sourceCaches[p]===void 0)throw new Error("There is no source with this ID");for(var g in this._layers)if(this._layers[g].source===p)return this.fire(new _.ErrorEvent(new Error('Source "'+p+'" cannot be removed while layer "'+g+'" is using it.')));var S=this.sourceCaches[p];delete this.sourceCaches[p],delete this._updatedSources[p],S.fire(new _.Event("data",{sourceDataType:"metadata",dataType:"source",sourceId:p})),S.setEventedParent(null),S.clearTiles(),S.onRemove&&S.onRemove(this.map),this._changed=!0},v.prototype.setGeoJSONSourceData=function(p,g){this._checkLoaded(),this.sourceCaches[p].getSource().setData(g),this._changed=!0},v.prototype.getSource=function(p){return this.sourceCaches[p]&&this.sourceCaches[p].getSource()},v.prototype.addLayer=function(p,g,S){S===void 0&&(S={}),this._checkLoaded();var w=p.id;if(this.getLayer(w))this.fire(new _.ErrorEvent(new Error('Layer with id "'+w+'" already exists on this map')));else{var C;if(p.type==="custom"){if(Lu(this,_.validateCustomStyleLayer(p)))return;C=_.createStyleLayer(p)}else{if(typeof p.source=="object"&&(this.addSource(w,p.source),p=_.clone$1(p),p=_.extend(p,{source:w})),this._validate(_.validateStyle.layer,"layers."+w,p,{arrayIndex:-1},S))return;C=_.createStyleLayer(p),this._validateLayer(C),C.setEventedParent(this,{layer:{id:w}}),this._serializedLayers[C.id]=C.serialize()}var O=g?this._order.indexOf(g):this._order.length;if(g&&O===-1)this.fire(new _.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.')));else{if(this._order.splice(O,0,w),this._layerOrderChanged=!0,this._layers[w]=C,this._removedLayers[w]&&C.source&&C.type!=="custom"){var X=this._removedLayers[w];delete this._removedLayers[w],X.type!==C.type?this._updatedSources[C.source]="clear":(this._updatedSources[C.source]="reload",this.sourceCaches[C.source].pause())}this._updateLayer(C),C.onAdd&&C.onAdd(this.map)}}},v.prototype.moveLayer=function(p,g){if(this._checkLoaded(),this._changed=!0,this._layers[p]){if(p!==g){var S=this._order.indexOf(p);this._order.splice(S,1);var w=g?this._order.indexOf(g):this._order.length;g&&w===-1?this.fire(new _.ErrorEvent(new Error('Layer with id "'+g+'" does not exist on this map.'))):(this._order.splice(w,0,p),this._layerOrderChanged=!0)}}else this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be moved.")))},v.prototype.removeLayer=function(p){this._checkLoaded();var g=this._layers[p];if(g){g.setEventedParent(null);var S=this._order.indexOf(p);this._order.splice(S,1),this._layerOrderChanged=!0,this._changed=!0,this._removedLayers[p]=g,delete this._layers[p],delete this._serializedLayers[p],delete this._updatedLayers[p],delete this._updatedPaintProps[p],g.onRemove&&g.onRemove(this.map)}else this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be removed.")))},v.prototype.getLayer=function(p){return this._layers[p]},v.prototype.hasLayer=function(p){return p in this._layers},v.prototype.setLayerZoomRange=function(p,g,S){this._checkLoaded();var w=this.getLayer(p);w?w.minzoom===g&&w.maxzoom===S||(g!=null&&(w.minzoom=g),S!=null&&(w.maxzoom=S),this._updateLayer(w)):this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot have zoom extent.")))},v.prototype.setFilter=function(p,g,S){S===void 0&&(S={}),this._checkLoaded();var w=this.getLayer(p);if(w){if(!_.deepEqual(w.filter,g))return g==null?(w.filter=void 0,void this._updateLayer(w)):void(this._validate(_.validateStyle.filter,"layers."+w.id+".filter",g,null,S)||(w.filter=_.clone$1(g),this._updateLayer(w)))}else this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be filtered.")))},v.prototype.getFilter=function(p){return _.clone$1(this.getLayer(p).filter)},v.prototype.setLayoutProperty=function(p,g,S,w){w===void 0&&(w={}),this._checkLoaded();var C=this.getLayer(p);C?_.deepEqual(C.getLayoutProperty(g),S)||(C.setLayoutProperty(g,S,w),this._updateLayer(C)):this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getLayoutProperty=function(p,g){var S=this.getLayer(p);if(S)return S.getLayoutProperty(g);this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style.")))},v.prototype.setPaintProperty=function(p,g,S,w){w===void 0&&(w={}),this._checkLoaded();var C=this.getLayer(p);C?_.deepEqual(C.getPaintProperty(g),S)||(C.setPaintProperty(g,S,w)&&this._updateLayer(C),this._changed=!0,this._updatedPaintProps[p]=!0):this.fire(new _.ErrorEvent(new Error("The layer '"+p+"' does not exist in the map's style and cannot be styled.")))},v.prototype.getPaintProperty=function(p,g){return this.getLayer(p).getPaintProperty(g)},v.prototype.setFeatureState=function(p,g){this._checkLoaded();var S=p.source,w=p.sourceLayer,C=this.sourceCaches[S];if(C!==void 0){var O=C.getSource().type;O==="geojson"&&w?this.fire(new _.ErrorEvent(new Error("GeoJSON sources cannot have a sourceLayer parameter."))):O!=="vector"||w?(p.id===void 0&&this.fire(new _.ErrorEvent(new Error("The feature id parameter must be provided."))),C.setFeatureState(w,p.id,g)):this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new _.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},v.prototype.removeFeatureState=function(p,g){this._checkLoaded();var S=p.source,w=this.sourceCaches[S];if(w!==void 0){var C=w.getSource().type,O=C==="vector"?p.sourceLayer:void 0;C!=="vector"||O?g&&typeof p.id!="string"&&typeof p.id!="number"?this.fire(new _.ErrorEvent(new Error("A feature id is required to remove its specific state property."))):w.removeFeatureState(O,p.id,g):this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new _.ErrorEvent(new Error("The source '"+S+"' does not exist in the map's style.")))},v.prototype.getFeatureState=function(p){this._checkLoaded();var g=p.source,S=p.sourceLayer,w=this.sourceCaches[g];if(w!==void 0){if(w.getSource().type!=="vector"||S)return p.id===void 0&&this.fire(new _.ErrorEvent(new Error("The feature id parameter must be provided."))),w.getFeatureState(S,p.id);this.fire(new _.ErrorEvent(new Error("The sourceLayer parameter must be provided for vector source types.")))}else this.fire(new _.ErrorEvent(new Error("The source '"+g+"' does not exist in the map's style.")))},v.prototype.getTransition=function(){return _.extend({duration:300,delay:0},this.stylesheet&&this.stylesheet.transition)},v.prototype.serialize=function(){return _.filterObject({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,light:this.stylesheet.light,center:this.stylesheet.center,zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,sources:_.mapObject(this.sourceCaches,function(p){return p.serialize()}),layers:this._serializeLayers(this._order)},function(p){return p!==void 0})},v.prototype._updateLayer=function(p){this._updatedLayers[p.id]=!0,p.source&&!this._updatedSources[p.source]&&this.sourceCaches[p.source].getSource().type!=="raster"&&(this._updatedSources[p.source]="reload",this.sourceCaches[p.source].pause()),this._changed=!0},v.prototype._flattenAndSortRenderedFeatures=function(p){for(var g=this,S=function(jr){return g._layers[jr].type==="fill-extrusion"},w={},C=[],O=this._order.length-1;O>=0;O--){var X=this._order[O];if(S(X)){w[X]=O;for(var J=0,me=p;J<me.length;J+=1){var ye=me[J][X];if(ye)for(var Ae=0,Ve=ye;Ae<Ve.length;Ae+=1)C.push(Ve[Ae])}}}C.sort(function(jr,Fr){return Fr.intersectionZ-jr.intersectionZ});for(var Ue=[],lt=this._order.length-1;lt>=0;lt--){var Be=this._order[lt];if(S(Be))for(var st=C.length-1;st>=0;st--){var xt=C[st].feature;if(w[xt.layer.id]<lt)break;Ue.push(xt),C.pop()}else for(var Ut=0,ar=p;Ut<ar.length;Ut+=1){var qt=ar[Ut][Be];if(qt)for(var fr=0,br=qt;fr<br.length;fr+=1)Ue.push(br[fr].feature)}}return Ue},v.prototype.queryRenderedFeatures=function(p,g,S){g&&g.filter&&this._validate(_.validateStyle.filter,"queryRenderedFeatures.filter",g.filter,null,g);var w={};if(g&&g.layers){if(!Array.isArray(g.layers))return this.fire(new _.ErrorEvent(new Error("parameters.layers must be an Array."))),[];for(var C=0,O=g.layers;C<O.length;C+=1){var X=O[C],J=this._layers[X];if(!J)return this.fire(new _.ErrorEvent(new Error("The layer '"+X+"' does not exist in the map's style and cannot be queried for features."))),[];w[J.source]=!0}}var me=[];for(var ye in g.availableImages=this._availableImages,this.sourceCaches)g.layers&&!w[ye]||me.push(Pt(this.sourceCaches[ye],this._layers,this._serializedLayers,p,g,S));return this.placement&&me.push(function(Ae,Ve,Ue,lt,Be,st,xt){for(var Ut={},ar=st.queryRenderedSymbols(lt),qt=[],fr=0,br=Object.keys(ar).map(Number);fr<br.length;fr+=1)qt.push(xt[br[fr]]);qt.sort(fn);for(var jr=function(){var zn=hn[Fr],Ui=zn.featureIndex.lookupSymbolFeatures(ar[zn.bucketInstanceId],Ve,zn.bucketIndex,zn.sourceLayerIndex,Be.filter,Be.layers,Be.availableImages,Ae);for(var gn in Ui){var ii=Ut[gn]=Ut[gn]||[],pi=Ui[gn];pi.sort(function(fi,Jn){var Xn=zn.featureSortOrder;if(Xn){var Mo=Xn.indexOf(fi.featureIndex);return Xn.indexOf(Jn.featureIndex)-Mo}return Jn.featureIndex-fi.featureIndex});for(var ri=0,Qn=pi;ri<Qn.length;ri+=1)ii.push(Qn[ri])}},Fr=0,hn=qt;Fr<hn.length;Fr+=1)jr();var Un=function(zn){Ut[zn].forEach(function(Ui){var gn=Ui.feature,ii=Ue[Ae[zn].source].getFeatureState(gn.layer["source-layer"],gn.id);gn.source=gn.layer.source,gn.layer["source-layer"]&&(gn.sourceLayer=gn.layer["source-layer"]),gn.state=ii})};for(var Ln in Ut)Un(Ln);return Ut}(this._layers,this._serializedLayers,this.sourceCaches,p,g,this.placement.collisionIndex,this.placement.retainedQueryData)),this._flattenAndSortRenderedFeatures(me)},v.prototype.querySourceFeatures=function(p,g){g&&g.filter&&this._validate(_.validateStyle.filter,"querySourceFeatures.filter",g.filter,null,g);var S=this.sourceCaches[p];return S?function(w,C){for(var O=w.getRenderableIds().map(function(Ve){return w.getTileByID(Ve)}),X=[],J={},me=0;me<O.length;me++){var ye=O[me],Ae=ye.tileID.canonical.key;J[Ae]||(J[Ae]=!0,ye.querySourceFeatures(X,C))}return X}(S,g):[]},v.prototype.addSourceType=function(p,g,S){return v.getSourceType(p)?S(new Error('A source type called "'+p+'" already exists.')):(v.setSourceType(p,g),g.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:p,url:g.workerSourceURL},S):S(null,null))},v.prototype.getLight=function(){return this.light.getLight()},v.prototype.setLight=function(p,g){g===void 0&&(g={}),this._checkLoaded();var S=this.light.getLight(),w=!1;for(var C in p)if(!_.deepEqual(p[C],S[C])){w=!0;break}if(w){var O={now:_.browser.now(),transition:_.extend({duration:300,delay:0},this.stylesheet.transition)};this.light.setLight(p,g),this.light.updateTransitions(O)}},v.prototype._validate=function(p,g,S,w,C){return C===void 0&&(C={}),(!C||C.validate!==!1)&&Lu(this,p.call(_.validateStyle,_.extend({key:g,style:this.serialize(),value:S,styleSpec:_.styleSpec},w)))},v.prototype._remove=function(){for(var p in this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),_.evented.off("pluginStateChange",this._rtlTextPluginCallback),this._layers)this._layers[p].setEventedParent(null);for(var g in this.sourceCaches)this.sourceCaches[g].clearTiles(),this.sourceCaches[g].setEventedParent(null);this.imageManager.setEventedParent(null),this.setEventedParent(null),this.dispatcher.remove()},v.prototype._clearSource=function(p){this.sourceCaches[p].clearTiles()},v.prototype._reloadSource=function(p){this.sourceCaches[p].resume(),this.sourceCaches[p].reload()},v.prototype._updateSources=function(p){for(var g in this.sourceCaches)this.sourceCaches[g].update(p)},v.prototype._generateCollisionBoxes=function(){for(var p in this.sourceCaches)this._reloadSource(p)},v.prototype._updatePlacement=function(p,g,S,w,C){C===void 0&&(C=!1);for(var O=!1,X=!1,J={},me=0,ye=this._order;me<ye.length;me+=1){var Ae=this._layers[ye[me]];if(Ae.type==="symbol"){if(!J[Ae.source]){var Ve=this.sourceCaches[Ae.source];J[Ae.source]=Ve.getRenderableIds(!0).map(function(xt){return Ve.getTileByID(xt)}).sort(function(xt,Ut){return Ut.tileID.overscaledZ-xt.tileID.overscaledZ||(xt.tileID.isLessThan(Ut.tileID)?-1:1)})}var Ue=this.crossTileSymbolIndex.addLayer(Ae,J[Ae.source],p.center.lng);O=O||Ue}}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._order),((C=C||this._layerOrderChanged||S===0)||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(_.browser.now(),p.zoom))&&(this.pauseablePlacement=new Ms(p,this._order,C,g,S,w,this.placement),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._order,this._layers,J),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(_.browser.now()),X=!0),O&&this.pauseablePlacement.placement.setStale()),X||O)for(var lt=0,Be=this._order;lt<Be.length;lt+=1){var st=this._layers[Be[lt]];st.type==="symbol"&&this.placement.updateLayerOpacities(st,J[st.source])}return!this.pauseablePlacement.isDone()||this.placement.hasTransitions(_.browser.now())},v.prototype._releaseSymbolFadeTiles=function(){for(var p in this.sourceCaches)this.sourceCaches[p].releaseSymbolFadeTiles()},v.prototype.getImages=function(p,g,S){this.imageManager.getImages(g.icons,S),this._updateTilesForChangedImages();var w=this.sourceCaches[g.source];w&&w.setDependencies(g.tileID.key,g.type,g.icons)},v.prototype.getGlyphs=function(p,g,S){this.glyphManager.getGlyphs(g.stacks,S)},v.prototype.getResource=function(p,g,S){return _.makeRequest(g,S)},v}(_.Evented);Ls.getSourceType=function(h){return At[h]},Ls.setSourceType=function(h,v){At[h]=v},Ls.registerForPluginStateChange=_.registerForPluginStateChange;var Ya=_.createLayout([{name:"a_pos",type:"Int16",components:2}]),Al=Ci(`#ifdef GL_ES
precision mediump float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif`,`#ifdef GL_ES
precision highp float;
#else
#if !defined(lowp)
#define lowp
#endif
#if !defined(mediump)
#define mediump
#endif
#if !defined(highp)
#define highp
#endif
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (tile_units_to_pixels*pos+offset)/pattern_size;}`),el=Ci(`uniform vec4 u_color;uniform float u_opacity;void main() {gl_FragColor=u_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),Tf=Ci(`uniform vec2 u_pattern_tl_a;uniform vec2 u_pattern_br_a;uniform vec2 u_pattern_tl_b;uniform vec2 u_pattern_br_b;uniform vec2 u_texsize;uniform float u_mix;uniform float u_opacity;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(u_pattern_tl_a/u_texsize,u_pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(u_pattern_tl_b/u_texsize,u_pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_mix)*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_pattern_size_a;uniform vec2 u_pattern_size_b;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_scale_a;uniform float u_scale_b;uniform float u_tile_units_to_pixels;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_a*u_pattern_size_a,u_tile_units_to_pixels,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_scale_b*u_pattern_size_b,u_tile_units_to_pixels,a_pos);}"),tp=Ci(`varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float extrude_length=length(extrude);lowp float antialiasblur=v_data.z;float antialiased_blur=-max(blur,antialiasblur);float opacity_t=smoothstep(0.0,antialiased_blur,extrude_length-1.0);float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width));gl_FragColor=opacity_t*mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform bool u_scale_with_map;uniform bool u_pitch_with_map;uniform vec2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;attribute vec2 a_pos;varying vec3 v_data;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);if (u_pitch_with_map) {vec2 corner_position=circle_center;if (u_scale_with_map) {corner_position+=extrude*(radius+stroke_width)*u_extrude_scale;} else {vec4 projected_center=u_matrix*vec4(circle_center,0,1);corner_position+=extrude*(radius+stroke_width)*u_extrude_scale*(projected_center.w/u_camera_to_center_distance);}gl_Position=u_matrix*vec4(corner_position,0,1);} else {gl_Position=u_matrix*vec4(circle_center,0,1);if (u_scale_with_map) {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*u_camera_to_center_distance;} else {gl_Position.xy+=extrude*(radius+stroke_width)*u_extrude_scale*gl_Position.w;}}lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);}`),wf=Ci("void main() {gl_FragColor=vec4(1.0);}","attribute vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),hh=Ci(`uniform highp float u_intensity;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);gl_FragColor=vec4(val,1.0,1.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;attribute vec2 a_pos;varying vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec4 pos=vec4(floor(a_pos*0.5)+extrude,0,1);gl_Position=u_matrix*pos;}`),ph=Ci(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;varying vec2 v_pos;void main() {float t=texture2D(u_image,v_pos).r;vec4 color=texture2D(u_color_ramp,vec2(t,0.5));gl_FragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(0.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_world;attribute vec2 a_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos*u_world,0,1);v_pos.x=a_pos.x;v_pos.y=1.0-a_pos.y;}"),dh=Ci("varying float v_placed;varying float v_notUsed;void main() {float alpha=0.5;gl_FragColor=vec4(1.0,0.0,0.0,1.0)*alpha;if (v_placed > 0.5) {gl_FragColor=vec4(0.0,0.0,1.0,0.5)*alpha;}if (v_notUsed > 0.5) {gl_FragColor*=.1;}}","attribute vec2 a_pos;attribute vec2 a_anchor_pos;attribute vec2 a_extrude;attribute vec2 a_placed;attribute vec2 a_shift;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;varying float v_placed;varying float v_notUsed;void main() {vec4 projectedPoint=u_matrix*vec4(a_anchor_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);gl_Position=u_matrix*vec4(a_pos,0.0,1.0);gl_Position.xy+=(a_extrude+a_shift)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}"),rp=Ci("varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);gl_FragColor=color*alpha*opacity_t;}","attribute vec2 a_pos;attribute float a_radius;attribute vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;varying float v_radius;varying vec2 v_extrude;varying float v_perspective_ratio;varying float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),np=Ci("uniform highp vec4 u_color;uniform sampler2D u_overlay;varying vec2 v_uv;void main() {vec4 overlay_color=texture2D(u_overlay,v_uv);gl_FragColor=mix(u_color,overlay_color,overlay_color.a);}","attribute vec2 a_pos;varying vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {v_uv=a_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,0,1);}"),zp=Ci(`#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_FragColor=color*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);}`),Yc=Ci(`varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=outline_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`attribute vec2 a_pos;uniform mat4 u_matrix;uniform vec2 u_world;varying vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),Fu=Ci(`uniform vec2 u_texsize;uniform sampler2D u_image;uniform float u_fade;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);gl_FragColor=mix(color1,color2,u_fade)*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;gl_Position=u_matrix*vec4(a_pos,0,1);vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,a_pos);v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;}`),ip=Ci(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);gl_FragColor=mix(color1,color2,u_fade)*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec3 u_scale;attribute vec2 a_pos;varying vec2 v_pos_a;varying vec2 v_pos_b;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;gl_Position=u_matrix*vec4(a_pos,0,1);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileZoomRatio,a_pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileZoomRatio,a_pos);}`),qo=Ci(`varying vec4 v_color;void main() {gl_FragColor=v_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec4 v_color;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
vec3 normal=a_normal_ed.xyz;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);gl_Position=u_matrix*vec4(a_pos,t > 0.0 ? height : base,1);float colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;v_color=vec4(0.0,0.0,0.0,1.0);vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;float directional=clamp(dot(normal/16384.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_color.r+=clamp(color.r*directional*u_lightcolor.r,mix(0.0,0.3,1.0-u_lightcolor.r),1.0);v_color.g+=clamp(color.g*directional*u_lightcolor.g,mix(0.0,0.3,1.0-u_lightcolor.g),1.0);v_color.b+=clamp(color.b*directional*u_lightcolor.b,mix(0.0,0.3,1.0-u_lightcolor.b),1.0);v_color*=u_opacity;}`),Xl=Ci(`uniform vec2 u_texsize;uniform float u_fade;uniform sampler2D u_image;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;vec2 imagecoord=mod(v_pos_a,1.0);vec2 pos=mix(pattern_tl_a/u_texsize,pattern_br_a/u_texsize,imagecoord);vec4 color1=texture2D(u_image,pos);vec2 imagecoord_b=mod(v_pos_b,1.0);vec2 pos2=mix(pattern_tl_b/u_texsize,pattern_br_b/u_texsize,imagecoord_b);vec4 color2=texture2D(u_image,pos2);vec4 mixedColor=mix(color1,color2,u_fade);gl_FragColor=mixedColor*v_lighting;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform vec3 u_scale;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;attribute vec2 a_pos;attribute vec4 a_normal_ed;varying vec2 v_pos_a;varying vec2 v_pos_b;varying vec4 v_lighting;
#pragma mapbox: define lowp float base
#pragma mapbox: define lowp float height
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float base
#pragma mapbox: initialize lowp float height
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec3 normal=a_normal_ed.xyz;float edgedistance=a_normal_ed.w;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;base=max(0.0,base);height=max(0.0,height);float t=mod(normal.x,2.0);float z=t > 0.0 ? height : base;gl_Position=u_matrix*vec4(a_pos,z,1);vec2 pos=normal.x==1.0 && normal.y==0.0 && normal.z==16384.0
? a_pos
: vec2(edgedistance,z*u_height_factor);v_pos_a=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,fromScale*display_size_a,tileRatio,pos);v_pos_b=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,toScale*display_size_b,tileRatio,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float directional=clamp(dot(normal/16383.0,u_lightpos),0.0,1.0);directional=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),directional);if (normal.y !=0.0) {directional*=((1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),mix(0.7,0.98,1.0-u_lightintensity),1.0)));}v_lighting.rgb+=clamp(directional*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;}`),Tl=Ci(`#ifdef GL_ES
precision highp float;
#endif
uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;uniform vec4 u_unpack;float getElevation(vec2 coord,float bias) {vec4 data=texture2D(u_image,coord)*255.0;data.a=-1.0;return dot(data,u_unpack)/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y),0.0);float b=getElevation(v_pos+vec2(0,-epsilon.y),0.0);float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y),0.0);float d=getElevation(v_pos+vec2(-epsilon.x,0),0.0);float e=getElevation(v_pos,0.0);float f=getElevation(v_pos+vec2(epsilon.x,0),0.0);float g=getElevation(v_pos+vec2(-epsilon.x,epsilon.y),0.0);float h=getElevation(v_pos+vec2(0,epsilon.y),0.0);float i=getElevation(v_pos+vec2(epsilon.x,epsilon.y),0.0);float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2((c+f+f+i)-(a+d+d+g),(g+h+h+i)-(a+b+b+c))/pow(2.0,exaggeration+(19.2562-u_zoom));gl_FragColor=clamp(vec4(deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),Ks=Ci(`uniform sampler2D u_image;varying vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;
#define PI 3.141592653589793
void main() {vec4 pixel=texture2D(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);gl_FragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;}"),wl=Ci(`uniform lowp float u_device_pixel_ratio;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp float v_linesofar;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;v_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*2.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),ui=Ci(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;varying vec2 v_width2;varying vec2 v_normal;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);vec4 color=texture2D(u_image,v_uv);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
attribute vec2 a_pos_normal;attribute vec4 a_data;attribute float a_uv_x;attribute float a_split_index;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_units_to_pixels;uniform float u_image_height;varying vec2 v_normal;varying vec2 v_width2;varying float v_gamma_scale;varying highp vec2 v_uv;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec2(a_uv_x,a_split_index*texel_height-half_texel_height);vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_width2=vec2(outset,inset);}`),tl=Ci(`uniform lowp float u_device_pixel_ratio;uniform vec2 u_texsize;uniform float u_fade;uniform mediump vec3 u_scale;uniform sampler2D u_image;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
vec2 pattern_tl_a=pattern_from.xy;vec2 pattern_br_a=pattern_from.zw;vec2 pattern_tl_b=pattern_to.xy;vec2 pattern_br_b=pattern_to.zw;float tileZoomRatio=u_scale.x;float fromScale=u_scale.y;float toScale=u_scale.z;vec2 display_size_a=(pattern_br_a-pattern_tl_a)/pixel_ratio_from;vec2 display_size_b=(pattern_br_b-pattern_tl_b)/pixel_ratio_to;vec2 pattern_size_a=vec2(display_size_a.x*fromScale/tileZoomRatio,display_size_a.y);vec2 pattern_size_b=vec2(display_size_b.x*toScale/tileZoomRatio,display_size_b.y);float aspect_a=display_size_a.y/v_width;float aspect_b=display_size_b.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float x_a=mod(v_linesofar/pattern_size_a.x*aspect_a,1.0);float x_b=mod(v_linesofar/pattern_size_b.x*aspect_b,1.0);float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;vec2 pos_a=mix(pattern_tl_a*texel_size-texel_size,pattern_br_a*texel_size+texel_size,vec2(x_a,y));vec2 pos_b=mix(pattern_tl_b*texel_size-texel_size,pattern_br_b*texel_size+texel_size,vec2(x_b,y));vec4 color=mix(texture2D(u_image,pos_a),texture2D(u_image,pos_b),u_fade);gl_FragColor=color*alpha*opacity;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform vec2 u_units_to_pixels;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;varying vec2 v_normal;varying vec2 v_width2;varying float v_linesofar;varying float v_gamma_scale;varying float v_width;
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 pattern_from
#pragma mapbox: define lowp vec4 pattern_to
#pragma mapbox: define lowp float pixel_ratio_from
#pragma mapbox: define lowp float pixel_ratio_to
void main() {
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize mediump vec4 pattern_from
#pragma mapbox: initialize mediump vec4 pattern_to
#pragma mapbox: initialize lowp float pixel_ratio_from
#pragma mapbox: initialize lowp float pixel_ratio_to
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=floorwidth;}`),Bs=Ci(`uniform lowp float u_device_pixel_ratio;uniform sampler2D u_image;uniform float u_sdfgamma;uniform float u_mix;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float dist=length(v_normal)*v_width2.s;float blur2=(blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);float sdfdist_a=texture2D(u_image,v_tex_a).a;float sdfdist_b=texture2D(u_image,v_tex_b).a;float sdfdist=mix(sdfdist_a,sdfdist_b,u_mix);alpha*=smoothstep(0.5-u_sdfgamma/floorwidth,0.5+u_sdfgamma/floorwidth,sdfdist);gl_FragColor=color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`
#define scale 0.015873016
#define LINE_DISTANCE_SCALE 2.0
attribute vec2 a_pos_normal;attribute vec4 a_data;uniform mat4 u_matrix;uniform mediump float u_ratio;uniform lowp float u_device_pixel_ratio;uniform vec2 u_patternscale_a;uniform float u_tex_y_a;uniform vec2 u_patternscale_b;uniform float u_tex_y_b;uniform vec2 u_units_to_pixels;varying vec2 v_normal;varying vec2 v_width2;varying vec2 v_tex_a;varying vec2 v_tex_b;varying float v_gamma_scale;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float floorwidth
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float floorwidth
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;float a_linesofar=(floor(a_data.z/4.0)+a_data.w*64.0)*LINE_DISTANCE_SCALE;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=width/2.0;offset=-1.0*offset;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*scale;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);vec4 projected_extrude=u_matrix*vec4(dist/u_ratio,0.0,0.0);gl_Position=u_matrix*vec4(pos+offset2/u_ratio,0.0,1.0)+projected_extrude;float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude.xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=extrude_length_without_perspective/extrude_length_with_perspective;v_tex_a=vec2(a_linesofar*u_patternscale_a.x/floorwidth,normal.y*u_patternscale_a.y+u_tex_y_a);v_tex_b=vec2(a_linesofar*u_patternscale_b.x/floorwidth,normal.y*u_patternscale_b.y+u_tex_y_b);v_width2=vec2(outset,inset);}`),Nu=Ci(`uniform float u_fade_t;uniform float u_opacity;uniform sampler2D u_image0;uniform sampler2D u_image1;varying vec2 v_pos0;varying vec2 v_pos1;uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;void main() {vec4 color0=texture2D(u_image0,v_pos0);vec4 color1=texture2D(u_image1,v_pos1);if (color0.a > 0.0) {color0.rgb=color0.rgb/color0.a;}if (color1.a > 0.0) {color1.rgb=color1.rgb/color1.a;}vec4 color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 rgb=color.rgb;rgb=vec3(dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);gl_FragColor=vec4(mix(u_high_vec,u_low_vec,rgb)*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,"uniform mat4 u_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_buffer_scale;attribute vec2 a_pos;attribute vec2 a_texture_pos;varying vec2 v_pos0;varying vec2 v_pos1;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos0=(((a_texture_pos/8192.0)-0.5)/u_buffer_scale )+0.5;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}"),rl=Ci(`uniform sampler2D u_texture;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
lowp float alpha=opacity*v_fade_opacity;gl_FragColor=texture2D(u_texture,v_tex)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform highp float u_camera_to_center_distance;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform float u_fade_change;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform vec2 u_texsize;varying vec2 v_tex;varying float v_fade_opacity;
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize lowp float opacity
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_minFontScale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*max(a_minFontScale,fontScale)+a_pxoffset/16.0),0.0,1.0);v_tex=a_tex/u_texsize;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;v_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));}`),ap=Ci(`#define SDF_PX 8.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float EDGE_GAMMA=0.105/u_device_pixel_ratio;vec2 tex=v_data0.xy;float gamma_scale=v_data1.x;float size=v_data1.y;float fade_opacity=v_data1[2];float fontScale=u_is_text ? size/24.0 : size;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec4 a_pixeloffset;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;varying vec2 v_data0;varying vec3 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale+a_pxoffset),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0=a_tex/u_texsize;v_data1=vec3(gamma_scale,size,interpolated_fade_opacity);}`),$i=Ci(`#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform bool u_is_halo;uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
float fade_opacity=v_data1[2];if (v_data1.w==ICON) {vec2 tex_icon=v_data0.zw;lowp float alpha=opacity*fade_opacity;gl_FragColor=texture2D(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
return;}vec2 tex=v_data0.xy;float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_data1.x;float size=v_data1.y;float fontScale=size/24.0;lowp vec4 color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;if (u_is_halo) {color=halo_color;gamma=(halo_blur*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width/fontScale)/SDF_PX;}lowp float dist=texture2D(u_texture,tex).a;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);gl_FragColor=color*(alpha*opacity*fade_opacity);
#ifdef OVERDRAW_INSPECTOR
gl_FragColor=vec4(1.0);
#endif
}`,`const float PI=3.141592653589793;attribute vec4 a_pos_offset;attribute vec4 a_data;attribute vec3 a_projected_pos;attribute float a_fade_opacity;uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_pitch_with_map;uniform highp float u_pitch;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec2 u_texsize_icon;varying vec4 v_data0;varying vec4 v_data1;
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_data.xy;vec2 a_size=a_data.zw;float a_size_min=floor(a_size[0]*0.5);float is_sdf=a_size[0]-2.0*a_size_min;highp float segment_angle=-a_projected_pos[2];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec4 projectedPoint=u_matrix*vec4(a_pos,0,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(0.5+0.5*distance_ratio,0.0,4.0);size*=perspective_ratio;float fontScale=size/24.0;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetProjectedPoint=u_matrix*vec4(a_pos+vec2(1,0),0,1);vec2 a=projectedPoint.xy/projectedPoint.w;vec2 b=offsetProjectedPoint.xy/offsetProjectedPoint.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);vec4 projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,0.0,1.0);gl_Position=u_coord_matrix*vec4(projected_pos.xy/projected_pos.w+rotation_matrix*(a_offset/32.0*fontScale),0.0,1.0);float gamma_scale=gl_Position.w;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float interpolated_fade_opacity=max(0.0,min(1.0,fade_opacity[0]+fade_change));v_data0.xy=a_tex/u_texsize;v_data0.zw=a_tex/u_texsize_icon;v_data1=vec4(gamma_scale,size,interpolated_fade_opacity,is_sdf);}`);function Ci(h,v){var p=/#pragma mapbox: ([\w]+) ([\w]+) ([\w]+) ([\w]+)/g,g=v.match(/attribute ([\w]+) ([\w]+)/g),S=h.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),w=v.match(/uniform ([\w]+) ([\w]+)([\s]*)([\w]*)/g),C=w?w.concat(S):S,O={};return{fragmentSource:h=h.replace(p,function(X,J,me,ye,Ae){return O[Ae]=!0,J==="define"?`
#ifndef HAS_UNIFORM_u_`+Ae+`
varying `+me+" "+ye+" "+Ae+`;
#else
uniform `+me+" "+ye+" u_"+Ae+`;
#endif
`:`
#ifdef HAS_UNIFORM_u_`+Ae+`
    `+me+" "+ye+" "+Ae+" = u_"+Ae+`;
#endif
`}),vertexSource:v=v.replace(p,function(X,J,me,ye,Ae){var Ve=ye==="float"?"vec2":"vec4",Ue=Ae.match(/color/)?"color":Ve;return O[Ae]?J==="define"?`
#ifndef HAS_UNIFORM_u_`+Ae+`
uniform lowp float u_`+Ae+`_t;
attribute `+me+" "+Ve+" a_"+Ae+`;
varying `+me+" "+ye+" "+Ae+`;
#else
uniform `+me+" "+ye+" u_"+Ae+`;
#endif
`:Ue==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ae+`
    `+Ae+" = a_"+Ae+`;
#else
    `+me+" "+ye+" "+Ae+" = u_"+Ae+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ae+`
    `+Ae+" = unpack_mix_"+Ue+"(a_"+Ae+", u_"+Ae+`_t);
#else
    `+me+" "+ye+" "+Ae+" = u_"+Ae+`;
#endif
`:J==="define"?`
#ifndef HAS_UNIFORM_u_`+Ae+`
uniform lowp float u_`+Ae+`_t;
attribute `+me+" "+Ve+" a_"+Ae+`;
#else
uniform `+me+" "+ye+" u_"+Ae+`;
#endif
`:Ue==="vec4"?`
#ifndef HAS_UNIFORM_u_`+Ae+`
    `+me+" "+ye+" "+Ae+" = a_"+Ae+`;
#else
    `+me+" "+ye+" "+Ae+" = u_"+Ae+`;
#endif
`:`
#ifndef HAS_UNIFORM_u_`+Ae+`
    `+me+" "+ye+" "+Ae+" = unpack_mix_"+Ue+"(a_"+Ae+", u_"+Ae+`_t);
#else
    `+me+" "+ye+" "+Ae+" = u_"+Ae+`;
#endif
`}),staticAttributes:g,staticUniforms:C}}var ou=Object.freeze({__proto__:null,prelude:Al,background:el,backgroundPattern:Tf,circle:tp,clippingMask:wf,heatmap:hh,heatmapTexture:ph,collisionBox:dh,collisionCircle:rp,debug:np,fill:zp,fillOutline:Yc,fillOutlinePattern:Fu,fillPattern:ip,fillExtrusion:qo,fillExtrusionPattern:Xl,hillshadePrepare:Tl,hillshade:Ks,line:wl,lineGradient:ui,linePattern:tl,lineSDF:Bs,raster:Nu,symbolIcon:rl,symbolSDF:ap,symbolTextAndIcon:$i}),mu=function(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffer=null,this.vao=null};function Cf(h){for(var v=[],p=0;p<h.length;p++)if(h[p]!==null){var g=h[p].split(" ");v.push(g.pop())}return v}mu.prototype.bind=function(h,v,p,g,S,w,C,O){this.context=h;for(var X=this.boundPaintVertexBuffers.length!==g.length,J=0;!X&&J<g.length;J++)this.boundPaintVertexBuffers[J]!==g[J]&&(X=!0);h.extVertexArrayObject&&this.vao&&this.boundProgram===v&&this.boundLayoutVertexBuffer===p&&!X&&this.boundIndexBuffer===S&&this.boundVertexOffset===w&&this.boundDynamicVertexBuffer===C&&this.boundDynamicVertexBuffer2===O?(h.bindVertexArrayOES.set(this.vao),C&&C.bind(),S&&S.dynamicDraw&&S.bind(),O&&O.bind()):this.freshBind(v,p,g,S,w,C,O)},mu.prototype.freshBind=function(h,v,p,g,S,w,C){var O,X=h.numAttributes,J=this.context,me=J.gl;if(J.extVertexArrayObject)this.vao&&this.destroy(),this.vao=J.extVertexArrayObject.createVertexArrayOES(),J.bindVertexArrayOES.set(this.vao),O=0,this.boundProgram=h,this.boundLayoutVertexBuffer=v,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=g,this.boundVertexOffset=S,this.boundDynamicVertexBuffer=w,this.boundDynamicVertexBuffer2=C;else{O=J.currentNumAttributes||0;for(var ye=X;ye<O;ye++)me.disableVertexAttribArray(ye)}v.enableAttributes(me,h);for(var Ae=0,Ve=p;Ae<Ve.length;Ae+=1)Ve[Ae].enableAttributes(me,h);w&&w.enableAttributes(me,h),C&&C.enableAttributes(me,h),v.bind(),v.setVertexAttribPointers(me,h,S);for(var Ue=0,lt=p;Ue<lt.length;Ue+=1){var Be=lt[Ue];Be.bind(),Be.setVertexAttribPointers(me,h,S)}w&&(w.bind(),w.setVertexAttribPointers(me,h,S)),g&&g.bind(),C&&(C.bind(),C.setVertexAttribPointers(me,h,S)),J.currentNumAttributes=X},mu.prototype.destroy=function(){this.vao&&(this.context.extVertexArrayObject.deleteVertexArrayOES(this.vao),this.vao=null)};var Za=function(h,v,p,g,S,w){var C=h.gl;this.program=C.createProgram();for(var O=Cf(p.staticAttributes),X=g?g.getBinderAttributes():[],J=O.concat(X),me=p.staticUniforms?Cf(p.staticUniforms):[],ye=g?g.getBinderUniforms():[],Ae=[],Ve=0,Ue=me.concat(ye);Ve<Ue.length;Ve+=1){var lt=Ue[Ve];Ae.indexOf(lt)<0&&Ae.push(lt)}var Be=g?g.defines():[];w&&Be.push("#define OVERDRAW_INSPECTOR;");var st=Be.concat(Al.fragmentSource,p.fragmentSource).join(`
`),xt=Be.concat(Al.vertexSource,p.vertexSource).join(`
`),Ut=C.createShader(C.FRAGMENT_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(Ut,st),C.compileShader(Ut),C.attachShader(this.program,Ut);var ar=C.createShader(C.VERTEX_SHADER);if(C.isContextLost())this.failedToCreate=!0;else{C.shaderSource(ar,xt),C.compileShader(ar),C.attachShader(this.program,ar),this.attributes={};var qt={};this.numAttributes=J.length;for(var fr=0;fr<this.numAttributes;fr++)J[fr]&&(C.bindAttribLocation(this.program,fr,J[fr]),this.attributes[J[fr]]=fr);C.linkProgram(this.program),C.deleteShader(ar),C.deleteShader(Ut);for(var br=0;br<Ae.length;br++){var jr=Ae[br];if(jr&&!qt[jr]){var Fr=C.getUniformLocation(this.program,jr);Fr&&(qt[jr]=Fr)}}this.fixedUniforms=S(h,qt),this.binderUniforms=g?g.getUniforms(h,qt):[]}}};function vh(h,v,p){var g=1/la(p,1,v.transform.tileZoom),S=Math.pow(2,p.tileID.overscaledZ),w=p.tileSize*Math.pow(2,v.transform.tileZoom)/S,C=w*(p.tileID.canonical.x+p.tileID.wrap*S),O=w*p.tileID.canonical.y;return{u_image:0,u_texsize:p.imageAtlasTexture.size,u_scale:[g,h.fromScale,h.toScale],u_fade:h.t,u_pixel_coord_upper:[C>>16,O>>16],u_pixel_coord_lower:[65535&C,65535&O]}}Za.prototype.draw=function(h,v,p,g,S,w,C,O,X,J,me,ye,Ae,Ve,Ue,lt){var Be,st=h.gl;if(!this.failedToCreate){for(var xt in h.program.set(this.program),h.setDepthMode(p),h.setStencilMode(g),h.setColorMode(S),h.setCullFace(w),this.fixedUniforms)this.fixedUniforms[xt].set(C[xt]);Ve&&Ve.setUniforms(h,this.binderUniforms,ye,{zoom:Ae});for(var Ut=(Be={},Be[st.LINES]=2,Be[st.TRIANGLES]=3,Be[st.LINE_STRIP]=1,Be)[v],ar=0,qt=me.get();ar<qt.length;ar+=1){var fr=qt[ar],br=fr.vaos||(fr.vaos={});(br[O]||(br[O]=new mu)).bind(h,this,X,Ve?Ve.getPaintVertexBuffers():[],J,fr.vertexOffset,Ue,lt),st.drawElements(v,fr.primitiveLength*Ut,st.UNSIGNED_SHORT,fr.primitiveOffset*Ut*2)}}};var Rf=function(h,v,p,g){var S=v.style.light,w=S.properties.get("position"),C=[w.x,w.y,w.z],O=_.create$1();S.properties.get("anchor")==="viewport"&&_.fromRotation(O,-v.transform.angle),_.transformMat3(C,C,O);var X=S.properties.get("color");return{u_matrix:h,u_lightpos:C,u_lightintensity:S.properties.get("intensity"),u_lightcolor:[X.r,X.g,X.b],u_vertical_gradient:+p,u_opacity:g}},Fs=function(h,v,p,g,S,w,C){return _.extend(Rf(h,v,p,g),vh(w,v,C),{u_height_factor:-Math.pow(2,S.overscaledZ)/C.tileSize/8})},nl=function(h){return{u_matrix:h}},gu=function(h,v,p,g){return _.extend(nl(h),vh(p,v,g))},Cl=function(h,v){return{u_matrix:h,u_world:v}},mh=function(h,v,p,g,S){return _.extend(gu(h,v,p,g),{u_world:S})},yc=function(h,v,p,g){var S,w,C=h.transform;if(g.paint.get("circle-pitch-alignment")==="map"){var O=la(p,1,C.zoom);S=!0,w=[O,O]}else S=!1,w=C.pixelsToGLUnits;return{u_camera_to_center_distance:C.cameraToCenterDistance,u_scale_with_map:+(g.paint.get("circle-pitch-scale")==="map"),u_matrix:h.translatePosMatrix(v.posMatrix,p,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_pitch_with_map:+S,u_device_pixel_ratio:_.browser.devicePixelRatio,u_extrude_scale:w}},sa=function(h,v,p){var g=la(p,1,v.zoom),S=Math.pow(2,v.zoom-p.tileID.overscaledZ),w=p.tileID.overscaleFactor();return{u_matrix:h,u_camera_to_center_distance:v.cameraToCenterDistance,u_pixels_to_tile_units:g,u_extrude_scale:[v.pixelsToGLUnits[0]/(g*S),v.pixelsToGLUnits[1]/(g*S)],u_overscale_factor:w}},xc=function(h,v,p){return{u_matrix:h,u_inv_matrix:v,u_camera_to_center_distance:p.cameraToCenterDistance,u_viewport_size:[p.width,p.height]}},il=function(h,v,p){return p===void 0&&(p=1),{u_matrix:h,u_color:v,u_overlay:0,u_overlay_scale:p}},Rl=function(h){return{u_matrix:h}},gh=function(h,v,p,g){return{u_matrix:h,u_extrude_scale:la(v,1,p),u_intensity:g}},qc=function(h,v,p){var g=h.transform;return{u_matrix:Kc(h,v,p),u_ratio:1/la(v,1,g.zoom),u_device_pixel_ratio:_.browser.devicePixelRatio,u_units_to_pixels:[1/g.pixelsToGLUnits[0],1/g.pixelsToGLUnits[1]]}},fa=function(h,v,p,g){return _.extend(qc(h,v,p),{u_image:0,u_image_height:g})},Ml=function(h,v,p,g){var S=h.transform,w=al(v,S);return{u_matrix:Kc(h,v,p),u_texsize:v.imageAtlasTexture.size,u_ratio:1/la(v,1,S.zoom),u_device_pixel_ratio:_.browser.devicePixelRatio,u_image:0,u_scale:[w,g.fromScale,g.toScale],u_fade:g.t,u_units_to_pixels:[1/S.pixelsToGLUnits[0],1/S.pixelsToGLUnits[1]]}},op=function(h,v,p,g,S){var w=h.lineAtlas,C=al(v,h.transform),O=p.layout.get("line-cap")==="round",X=w.getDash(g.from,O),J=w.getDash(g.to,O),me=X.width*S.fromScale,ye=J.width*S.toScale;return _.extend(qc(h,v,p),{u_patternscale_a:[C/me,-X.height/2],u_patternscale_b:[C/ye,-J.height/2],u_sdfgamma:w.width/(256*Math.min(me,ye)*_.browser.devicePixelRatio)/2,u_image:0,u_tex_y_a:X.y,u_tex_y_b:J.y,u_mix:S.t})};function al(h,v){return 1/la(h,1,v.tileZoom)}function Kc(h,v,p){return h.translatePosMatrix(v.tileID.posMatrix,v,p.paint.get("line-translate"),p.paint.get("line-translate-anchor"))}var Qc=function(h,v,p,g,S){return{u_matrix:h,u_tl_parent:v,u_scale_parent:p,u_buffer_scale:1,u_fade_t:g.mix,u_opacity:g.opacity*S.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:S.paint.get("raster-brightness-min"),u_brightness_high:S.paint.get("raster-brightness-max"),u_saturation_factor:(C=S.paint.get("raster-saturation"),C>0?1-1/(1.001-C):-C),u_contrast_factor:(w=S.paint.get("raster-contrast"),w>0?1/(1-w):1+w),u_spin_weights:Mf(S.paint.get("raster-hue-rotate"))};var w,C};function Mf(h){h*=Math.PI/180;var v=Math.sin(h),p=Math.cos(h);return[(2*p+1)/3,(-Math.sqrt(3)*v-p+1)/3,(Math.sqrt(3)*v-p+1)/3]}var ol,$l=function(h,v,p,g,S,w,C,O,X,J){var me=S.transform;return{u_is_size_zoom_constant:+(h==="constant"||h==="source"),u_is_size_feature_constant:+(h==="constant"||h==="camera"),u_size_t:v?v.uSizeT:0,u_size:v?v.uSize:0,u_camera_to_center_distance:me.cameraToCenterDistance,u_pitch:me.pitch/360*2*Math.PI,u_rotate_symbol:+p,u_aspect_ratio:me.width/me.height,u_fade_change:S.options.fadeDuration?S.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:C,u_coord_matrix:O,u_is_text:+X,u_pitch_with_map:+g,u_texsize:J,u_texture:0}},Uu=function(h,v,p,g,S,w,C,O,X,J,me){var ye=S.transform;return _.extend($l(h,v,p,g,S,w,C,O,X,J),{u_gamma_scale:g?Math.cos(ye._pitch)*ye.cameraToCenterDistance:1,u_device_pixel_ratio:_.browser.devicePixelRatio,u_is_halo:+me})},Jc=function(h,v,p,g,S,w,C,O,X,J){return _.extend(Uu(h,v,p,g,S,w,C,O,!0,X,!0),{u_texsize_icon:J,u_texture_icon:1})},bc=function(h,v,p){return{u_matrix:h,u_opacity:v,u_color:p}},Yl=function(h,v,p,g,S,w){return _.extend(function(C,O,X,J){var me=X.imageManager.getPattern(C.from.toString()),ye=X.imageManager.getPattern(C.to.toString()),Ae=X.imageManager.getPixelSize(),Ve=Ae.width,Ue=Ae.height,lt=Math.pow(2,J.tileID.overscaledZ),Be=J.tileSize*Math.pow(2,X.transform.tileZoom)/lt,st=Be*(J.tileID.canonical.x+J.tileID.wrap*lt),xt=Be*J.tileID.canonical.y;return{u_image:0,u_pattern_tl_a:me.tl,u_pattern_br_a:me.br,u_pattern_tl_b:ye.tl,u_pattern_br_b:ye.br,u_texsize:[Ve,Ue],u_mix:O.t,u_pattern_size_a:me.displaySize,u_pattern_size_b:ye.displaySize,u_scale_a:O.fromScale,u_scale_b:O.toScale,u_tile_units_to_pixels:1/la(J,1,X.transform.tileZoom),u_pixel_coord_upper:[st>>16,xt>>16],u_pixel_coord_lower:[65535&st,65535&xt]}}(g,w,p,S),{u_matrix:h,u_opacity:v})},_h={fillExtrusion:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_lightpos:new _.Uniform3f(h,v.u_lightpos),u_lightintensity:new _.Uniform1f(h,v.u_lightintensity),u_lightcolor:new _.Uniform3f(h,v.u_lightcolor),u_vertical_gradient:new _.Uniform1f(h,v.u_vertical_gradient),u_opacity:new _.Uniform1f(h,v.u_opacity)}},fillExtrusionPattern:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_lightpos:new _.Uniform3f(h,v.u_lightpos),u_lightintensity:new _.Uniform1f(h,v.u_lightintensity),u_lightcolor:new _.Uniform3f(h,v.u_lightcolor),u_vertical_gradient:new _.Uniform1f(h,v.u_vertical_gradient),u_height_factor:new _.Uniform1f(h,v.u_height_factor),u_image:new _.Uniform1i(h,v.u_image),u_texsize:new _.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new _.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new _.Uniform3f(h,v.u_scale),u_fade:new _.Uniform1f(h,v.u_fade),u_opacity:new _.Uniform1f(h,v.u_opacity)}},fill:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix)}},fillPattern:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_image:new _.Uniform1i(h,v.u_image),u_texsize:new _.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new _.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new _.Uniform3f(h,v.u_scale),u_fade:new _.Uniform1f(h,v.u_fade)}},fillOutline:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_world:new _.Uniform2f(h,v.u_world)}},fillOutlinePattern:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_world:new _.Uniform2f(h,v.u_world),u_image:new _.Uniform1i(h,v.u_image),u_texsize:new _.Uniform2f(h,v.u_texsize),u_pixel_coord_upper:new _.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(h,v.u_pixel_coord_lower),u_scale:new _.Uniform3f(h,v.u_scale),u_fade:new _.Uniform1f(h,v.u_fade)}},circle:function(h,v){return{u_camera_to_center_distance:new _.Uniform1f(h,v.u_camera_to_center_distance),u_scale_with_map:new _.Uniform1i(h,v.u_scale_with_map),u_pitch_with_map:new _.Uniform1i(h,v.u_pitch_with_map),u_extrude_scale:new _.Uniform2f(h,v.u_extrude_scale),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_matrix:new _.UniformMatrix4f(h,v.u_matrix)}},collisionBox:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_camera_to_center_distance:new _.Uniform1f(h,v.u_camera_to_center_distance),u_pixels_to_tile_units:new _.Uniform1f(h,v.u_pixels_to_tile_units),u_extrude_scale:new _.Uniform2f(h,v.u_extrude_scale),u_overscale_factor:new _.Uniform1f(h,v.u_overscale_factor)}},collisionCircle:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_inv_matrix:new _.UniformMatrix4f(h,v.u_inv_matrix),u_camera_to_center_distance:new _.Uniform1f(h,v.u_camera_to_center_distance),u_viewport_size:new _.Uniform2f(h,v.u_viewport_size)}},debug:function(h,v){return{u_color:new _.UniformColor(h,v.u_color),u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_overlay:new _.Uniform1i(h,v.u_overlay),u_overlay_scale:new _.Uniform1f(h,v.u_overlay_scale)}},clippingMask:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix)}},heatmap:function(h,v){return{u_extrude_scale:new _.Uniform1f(h,v.u_extrude_scale),u_intensity:new _.Uniform1f(h,v.u_intensity),u_matrix:new _.UniformMatrix4f(h,v.u_matrix)}},heatmapTexture:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_world:new _.Uniform2f(h,v.u_world),u_image:new _.Uniform1i(h,v.u_image),u_color_ramp:new _.Uniform1i(h,v.u_color_ramp),u_opacity:new _.Uniform1f(h,v.u_opacity)}},hillshade:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_image:new _.Uniform1i(h,v.u_image),u_latrange:new _.Uniform2f(h,v.u_latrange),u_light:new _.Uniform2f(h,v.u_light),u_shadow:new _.UniformColor(h,v.u_shadow),u_highlight:new _.UniformColor(h,v.u_highlight),u_accent:new _.UniformColor(h,v.u_accent)}},hillshadePrepare:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_image:new _.Uniform1i(h,v.u_image),u_dimension:new _.Uniform2f(h,v.u_dimension),u_zoom:new _.Uniform1f(h,v.u_zoom),u_unpack:new _.Uniform4f(h,v.u_unpack)}},line:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_ratio:new _.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(h,v.u_units_to_pixels)}},lineGradient:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_ratio:new _.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(h,v.u_units_to_pixels),u_image:new _.Uniform1i(h,v.u_image),u_image_height:new _.Uniform1f(h,v.u_image_height)}},linePattern:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_texsize:new _.Uniform2f(h,v.u_texsize),u_ratio:new _.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_image:new _.Uniform1i(h,v.u_image),u_units_to_pixels:new _.Uniform2f(h,v.u_units_to_pixels),u_scale:new _.Uniform3f(h,v.u_scale),u_fade:new _.Uniform1f(h,v.u_fade)}},lineSDF:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_ratio:new _.Uniform1f(h,v.u_ratio),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_units_to_pixels:new _.Uniform2f(h,v.u_units_to_pixels),u_patternscale_a:new _.Uniform2f(h,v.u_patternscale_a),u_patternscale_b:new _.Uniform2f(h,v.u_patternscale_b),u_sdfgamma:new _.Uniform1f(h,v.u_sdfgamma),u_image:new _.Uniform1i(h,v.u_image),u_tex_y_a:new _.Uniform1f(h,v.u_tex_y_a),u_tex_y_b:new _.Uniform1f(h,v.u_tex_y_b),u_mix:new _.Uniform1f(h,v.u_mix)}},raster:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_tl_parent:new _.Uniform2f(h,v.u_tl_parent),u_scale_parent:new _.Uniform1f(h,v.u_scale_parent),u_buffer_scale:new _.Uniform1f(h,v.u_buffer_scale),u_fade_t:new _.Uniform1f(h,v.u_fade_t),u_opacity:new _.Uniform1f(h,v.u_opacity),u_image0:new _.Uniform1i(h,v.u_image0),u_image1:new _.Uniform1i(h,v.u_image1),u_brightness_low:new _.Uniform1f(h,v.u_brightness_low),u_brightness_high:new _.Uniform1f(h,v.u_brightness_high),u_saturation_factor:new _.Uniform1f(h,v.u_saturation_factor),u_contrast_factor:new _.Uniform1f(h,v.u_contrast_factor),u_spin_weights:new _.Uniform3f(h,v.u_spin_weights)}},symbolIcon:function(h,v){return{u_is_size_zoom_constant:new _.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new _.Uniform1f(h,v.u_size_t),u_size:new _.Uniform1f(h,v.u_size),u_camera_to_center_distance:new _.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new _.Uniform1f(h,v.u_pitch),u_rotate_symbol:new _.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new _.Uniform1f(h,v.u_fade_change),u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new _.Uniform1i(h,v.u_is_text),u_pitch_with_map:new _.Uniform1i(h,v.u_pitch_with_map),u_texsize:new _.Uniform2f(h,v.u_texsize),u_texture:new _.Uniform1i(h,v.u_texture)}},symbolSDF:function(h,v){return{u_is_size_zoom_constant:new _.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new _.Uniform1f(h,v.u_size_t),u_size:new _.Uniform1f(h,v.u_size),u_camera_to_center_distance:new _.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new _.Uniform1f(h,v.u_pitch),u_rotate_symbol:new _.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new _.Uniform1f(h,v.u_fade_change),u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new _.Uniform1i(h,v.u_is_text),u_pitch_with_map:new _.Uniform1i(h,v.u_pitch_with_map),u_texsize:new _.Uniform2f(h,v.u_texsize),u_texture:new _.Uniform1i(h,v.u_texture),u_gamma_scale:new _.Uniform1f(h,v.u_gamma_scale),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_is_halo:new _.Uniform1i(h,v.u_is_halo)}},symbolTextAndIcon:function(h,v){return{u_is_size_zoom_constant:new _.Uniform1i(h,v.u_is_size_zoom_constant),u_is_size_feature_constant:new _.Uniform1i(h,v.u_is_size_feature_constant),u_size_t:new _.Uniform1f(h,v.u_size_t),u_size:new _.Uniform1f(h,v.u_size),u_camera_to_center_distance:new _.Uniform1f(h,v.u_camera_to_center_distance),u_pitch:new _.Uniform1f(h,v.u_pitch),u_rotate_symbol:new _.Uniform1i(h,v.u_rotate_symbol),u_aspect_ratio:new _.Uniform1f(h,v.u_aspect_ratio),u_fade_change:new _.Uniform1f(h,v.u_fade_change),u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_label_plane_matrix:new _.UniformMatrix4f(h,v.u_label_plane_matrix),u_coord_matrix:new _.UniformMatrix4f(h,v.u_coord_matrix),u_is_text:new _.Uniform1i(h,v.u_is_text),u_pitch_with_map:new _.Uniform1i(h,v.u_pitch_with_map),u_texsize:new _.Uniform2f(h,v.u_texsize),u_texsize_icon:new _.Uniform2f(h,v.u_texsize_icon),u_texture:new _.Uniform1i(h,v.u_texture),u_texture_icon:new _.Uniform1i(h,v.u_texture_icon),u_gamma_scale:new _.Uniform1f(h,v.u_gamma_scale),u_device_pixel_ratio:new _.Uniform1f(h,v.u_device_pixel_ratio),u_is_halo:new _.Uniform1i(h,v.u_is_halo)}},background:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_opacity:new _.Uniform1f(h,v.u_opacity),u_color:new _.UniformColor(h,v.u_color)}},backgroundPattern:function(h,v){return{u_matrix:new _.UniformMatrix4f(h,v.u_matrix),u_opacity:new _.Uniform1f(h,v.u_opacity),u_image:new _.Uniform1i(h,v.u_image),u_pattern_tl_a:new _.Uniform2f(h,v.u_pattern_tl_a),u_pattern_br_a:new _.Uniform2f(h,v.u_pattern_br_a),u_pattern_tl_b:new _.Uniform2f(h,v.u_pattern_tl_b),u_pattern_br_b:new _.Uniform2f(h,v.u_pattern_br_b),u_texsize:new _.Uniform2f(h,v.u_texsize),u_mix:new _.Uniform1f(h,v.u_mix),u_pattern_size_a:new _.Uniform2f(h,v.u_pattern_size_a),u_pattern_size_b:new _.Uniform2f(h,v.u_pattern_size_b),u_scale_a:new _.Uniform1f(h,v.u_scale_a),u_scale_b:new _.Uniform1f(h,v.u_scale_b),u_pixel_coord_upper:new _.Uniform2f(h,v.u_pixel_coord_upper),u_pixel_coord_lower:new _.Uniform2f(h,v.u_pixel_coord_lower),u_tile_units_to_pixels:new _.Uniform1f(h,v.u_tile_units_to_pixels)}}};function Ec(h,v,p,g,S,w,C){for(var O=h.context,X=O.gl,J=h.useProgram("collisionBox"),me=[],ye=0,Ae=0,Ve=0;Ve<g.length;Ve++){var Ue=g[Ve],lt=v.getTile(Ue),Be=lt.getBucket(p);if(Be){var st=Ue.posMatrix;S[0]===0&&S[1]===0||(st=h.translatePosMatrix(Ue.posMatrix,lt,S,w));var xt=C?Be.textCollisionBox:Be.iconCollisionBox,Ut=Be.collisionCircleArray;if(Ut.length>0){var ar=_.create(),qt=st;_.mul(ar,Be.placementInvProjMatrix,h.transform.glCoordMatrix),_.mul(ar,ar,Be.placementViewportMatrix),me.push({circleArray:Ut,circleOffset:Ae,transform:qt,invTransform:ar}),Ae=ye+=Ut.length/4}xt&&J.draw(O,X.LINES,ne.disabled,xe.disabled,h.colorModeForRenderPass(),et.disabled,sa(st,h.transform,lt),p.id,xt.layoutVertexBuffer,xt.indexBuffer,xt.segments,null,h.transform.zoom,null,null,xt.collisionVertexBuffer)}}if(C&&me.length){var fr=h.useProgram("collisionCircle"),br=new _.StructArrayLayout2f1f2i16;br.resize(4*ye),br._trim();for(var jr=0,Fr=0,hn=me;Fr<hn.length;Fr+=1)for(var Un=hn[Fr],Ln=0;Ln<Un.circleArray.length/4;Ln++){var zn=4*Ln,Ui=Un.circleArray[zn+0],gn=Un.circleArray[zn+1],ii=Un.circleArray[zn+2],pi=Un.circleArray[zn+3];br.emplace(jr++,Ui,gn,ii,pi,0),br.emplace(jr++,Ui,gn,ii,pi,1),br.emplace(jr++,Ui,gn,ii,pi,2),br.emplace(jr++,Ui,gn,ii,pi,3)}(!ol||ol.length<2*ye)&&(ol=function(Ka){var Io=2*Ka,go=new _.StructArrayLayout3ui6;go.resize(Io),go._trim();for(var Ha=0;Ha<Io;Ha++){var Qa=6*Ha;go.uint16[Qa+0]=4*Ha+0,go.uint16[Qa+1]=4*Ha+1,go.uint16[Qa+2]=4*Ha+2,go.uint16[Qa+3]=4*Ha+2,go.uint16[Qa+4]=4*Ha+3,go.uint16[Qa+5]=4*Ha+0}return go}(ye));for(var ri=O.createIndexBuffer(ol,!0),Qn=O.createVertexBuffer(br,_.collisionCircleLayout.members,!0),fi=0,Jn=me;fi<Jn.length;fi+=1){var Xn=Jn[fi],Mo=xc(Xn.transform,Xn.invTransform,h.transform);fr.draw(O,X.TRIANGLES,ne.disabled,xe.disabled,h.colorModeForRenderPass(),et.disabled,Mo,p.id,Qn,ri,_.SegmentVector.simpleSegment(0,2*Xn.circleOffset,Xn.circleArray.length,Xn.circleArray.length/2),null,h.transform.zoom,null,null,null)}Qn.destroy(),ri.destroy()}}var Ns=_.identity(new Float32Array(16));function yh(h,v,p,g,S,w){var C=_.getAnchorAlignment(h),O=-(C.horizontalAlign-.5)*v,X=-(C.verticalAlign-.5)*p,J=_.evaluateVariableOffset(h,g);return new _.Point((O/S+J[0])*w,(X/S+J[1])*w)}function ef(h,v,p,g,S,w,C,O,X,J,me){var ye=h.text.placedSymbolArray,Ae=h.text.dynamicLayoutVertexArray,Ve=h.icon.dynamicLayoutVertexArray,Ue={};Ae.clear();for(var lt=0;lt<ye.length;lt++){var Be=ye.get(lt),st=Be.hidden||!Be.crossTileID||h.allowVerticalPlacement&&!Be.placedOrientation?null:g[Be.crossTileID];if(st){var xt=new _.Point(Be.anchorX,Be.anchorY),Ut=di(xt,p?O:C),ar=Ai(w.cameraToCenterDistance,Ut.signedDistanceFromCamera),qt=S.evaluateSizeForFeature(h.textSizeData,J,Be)*ar/_.ONE_EM;p&&(qt*=h.tilePixelRatio/X);for(var fr=yh(st.anchor,st.width,st.height,st.textOffset,st.textBoxScale,qt),br=p?di(xt.add(fr),C).point:Ut.point.add(v?fr.rotate(-w.angle):fr),jr=h.allowVerticalPlacement&&Be.placedOrientation===_.WritingMode.vertical?Math.PI/2:0,Fr=0;Fr<Be.numGlyphs;Fr++)_.addDynamicAttributes(Ae,br,jr);me&&Be.associatedIconIndex>=0&&(Ue[Be.associatedIconIndex]={shiftedAnchor:br,angle:jr})}else ka(Be.numGlyphs,Ae)}if(me){Ve.clear();for(var hn=h.icon.placedSymbolArray,Un=0;Un<hn.length;Un++){var Ln=hn.get(Un);if(Ln.hidden)ka(Ln.numGlyphs,Ve);else{var zn=Ue[Un];if(zn)for(var Ui=0;Ui<Ln.numGlyphs;Ui++)_.addDynamicAttributes(Ve,zn.shiftedAnchor,zn.angle);else ka(Ln.numGlyphs,Ve)}}h.icon.dynamicLayoutVertexBuffer.updateData(Ve)}h.text.dynamicLayoutVertexBuffer.updateData(Ae)}function Sc(h,v,p){return p.iconsInText&&v?"symbolTextAndIcon":h?"symbolSDF":"symbolIcon"}function Il(h,v,p,g,S,w,C,O,X,J,me,ye){for(var Ae=h.context,Ve=Ae.gl,Ue=h.transform,lt=O==="map",Be=X==="map",st=lt&&p.layout.get("symbol-placement")!=="point",xt=lt&&!Be&&!st,Ut=p.layout.get("symbol-sort-key").constantOr(1)!==void 0,ar=!1,qt=h.depthModeForSublayer(0,ne.ReadOnly),fr=p.layout.get("text-variable-anchor"),br=[],jr=0,Fr=g;jr<Fr.length;jr+=1){var hn=Fr[jr],Un=v.getTile(hn),Ln=Un.getBucket(p);if(Ln){var zn=S?Ln.text:Ln.icon;if(zn&&zn.segments.get().length){var Ui=zn.programConfigurations.get(p.id),gn=S||Ln.sdfIcons,ii=S?Ln.textSizeData:Ln.iconSizeData,pi=Be||Ue.pitch!==0,ri=h.useProgram(Sc(gn,S,Ln),Ui),Qn=_.evaluateSizeForZoom(ii,Ue.zoom),fi=void 0,Jn=[0,0],Xn=void 0,Mo=void 0,Ka=null,Io=void 0;if(S)Xn=Un.glyphAtlasTexture,Mo=Ve.LINEAR,fi=Un.glyphAtlasTexture.size,Ln.iconsInText&&(Jn=Un.imageAtlasTexture.size,Ka=Un.imageAtlasTexture,Io=pi||h.options.rotating||h.options.zooming||ii.kind==="composite"||ii.kind==="camera"?Ve.LINEAR:Ve.NEAREST);else{var go=p.layout.get("icon-size").constantOr(0)!==1||Ln.iconsNeedLinear;Xn=Un.imageAtlasTexture,Mo=gn||h.options.rotating||h.options.zooming||go||pi?Ve.LINEAR:Ve.NEAREST,fi=Un.imageAtlasTexture.size}var Ha=la(Un,1,h.transform.zoom),Qa=Pa(hn.posMatrix,Be,lt,h.transform,Ha),xs=Si(hn.posMatrix,Be,lt,h.transform,Ha),bs=fr&&Ln.hasTextData(),fl=p.layout.get("icon-text-fit")!=="none"&&bs&&Ln.hasIconData();st&&vu(Ln,hn.posMatrix,h,S,Qa,xs,Be,J);var Es=h.translatePosMatrix(hn.posMatrix,Un,w,C),lu=st||S&&fr||fl?Ns:Qa,Zs=h.translatePosMatrix(xs,Un,w,C,!0),Mc=gn&&p.paint.get(S?"text-halo-width":"icon-halo-width").constantOr(1)!==0,Hu={program:ri,buffers:zn,uniformValues:gn?Ln.iconsInText?Jc(ii.kind,Qn,xt,Be,h,Es,lu,Zs,fi,Jn):Uu(ii.kind,Qn,xt,Be,h,Es,lu,Zs,S,fi,!0):$l(ii.kind,Qn,xt,Be,h,Es,lu,Zs,S,fi),atlasTexture:Xn,atlasTextureIcon:Ka,atlasInterpolation:Mo,atlasInterpolationIcon:Io,isSDF:gn,hasHalo:Mc};if(Ut&&Ln.canOverlap){ar=!0;for(var Tu=0,nc=zn.segments.get();Tu<nc.length;Tu+=1){var hl=nc[Tu];br.push({segments:new _.SegmentVector([hl]),sortKey:hl.sortKey,state:Hu})}}else br.push({segments:zn.segments,sortKey:0,state:Hu})}}}ar&&br.sort(function(fu,wu){return fu.sortKey-wu.sortKey});for(var cu=0,pl=br;cu<pl.length;cu+=1){var Po=pl[cu],ao=Po.state;if(Ae.activeTexture.set(Ve.TEXTURE0),ao.atlasTexture.bind(ao.atlasInterpolation,Ve.CLAMP_TO_EDGE),ao.atlasTextureIcon&&(Ae.activeTexture.set(Ve.TEXTURE1),ao.atlasTextureIcon&&ao.atlasTextureIcon.bind(ao.atlasInterpolationIcon,Ve.CLAMP_TO_EDGE)),ao.isSDF){var Is=ao.uniformValues;ao.hasHalo&&(Is.u_is_halo=1,zu(ao.buffers,Po.segments,p,h,ao.program,qt,me,ye,Is)),Is.u_is_halo=0}zu(ao.buffers,Po.segments,p,h,ao.program,qt,me,ye,ao.uniformValues)}}function zu(h,v,p,g,S,w,C,O,X){var J=g.context;S.draw(J,J.gl.TRIANGLES,w,C,O,et.disabled,X,p.id,h.layoutVertexBuffer,h.indexBuffer,v,p.paint,g.transform.zoom,h.programConfigurations.get(p.id),h.dynamicLayoutVertexBuffer,h.opacityVertexBuffer)}function ql(h,v,p,g,S,w,C){var O,X,J,me,ye,Ae=h.context.gl,Ve=p.paint.get("fill-pattern"),Ue=Ve&&Ve.constantOr(1),lt=p.getCrossfadeParameters();C?(X=Ue&&!p.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",O=Ae.LINES):(X=Ue?"fillPattern":"fill",O=Ae.TRIANGLES);for(var Be=0,st=g;Be<st.length;Be+=1){var xt=st[Be],Ut=v.getTile(xt);if(!Ue||Ut.patternsLoaded()){var ar=Ut.getBucket(p);if(ar){var qt=ar.programConfigurations.get(p.id),fr=h.useProgram(X,qt);Ue&&(h.context.activeTexture.set(Ae.TEXTURE0),Ut.imageAtlasTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE),qt.updatePaintBuffers(lt));var br=Ve.constantOr(null);if(br&&Ut.imageAtlas){var jr=Ut.imageAtlas,Fr=jr.patternPositions[br.to.toString()],hn=jr.patternPositions[br.from.toString()];Fr&&hn&&qt.setConstantPatternPositions(Fr,hn)}var Un=h.translatePosMatrix(xt.posMatrix,Ut,p.paint.get("fill-translate"),p.paint.get("fill-translate-anchor"));if(C){me=ar.indexBuffer2,ye=ar.segments2;var Ln=[Ae.drawingBufferWidth,Ae.drawingBufferHeight];J=X==="fillOutlinePattern"&&Ue?mh(Un,h,lt,Ut,Ln):Cl(Un,Ln)}else me=ar.indexBuffer,ye=ar.segments,J=Ue?gu(Un,h,lt,Ut):nl(Un);fr.draw(h.context,O,S,h.stencilModeForClipping(xt),w,et.disabled,J,p.id,ar.layoutVertexBuffer,me,ye,p.paint,h.transform.zoom,qt)}}}}function If(h,v,p,g,S,w,C){for(var O=h.context,X=O.gl,J=p.paint.get("fill-extrusion-pattern"),me=J.constantOr(1),ye=p.getCrossfadeParameters(),Ae=p.paint.get("fill-extrusion-opacity"),Ve=0,Ue=g;Ve<Ue.length;Ve+=1){var lt=Ue[Ve],Be=v.getTile(lt),st=Be.getBucket(p);if(st){var xt=st.programConfigurations.get(p.id),Ut=h.useProgram(me?"fillExtrusionPattern":"fillExtrusion",xt);me&&(h.context.activeTexture.set(X.TEXTURE0),Be.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),xt.updatePaintBuffers(ye));var ar=J.constantOr(null);if(ar&&Be.imageAtlas){var qt=Be.imageAtlas,fr=qt.patternPositions[ar.to.toString()],br=qt.patternPositions[ar.from.toString()];fr&&br&&xt.setConstantPatternPositions(fr,br)}var jr=h.translatePosMatrix(lt.posMatrix,Be,p.paint.get("fill-extrusion-translate"),p.paint.get("fill-extrusion-translate-anchor")),Fr=p.paint.get("fill-extrusion-vertical-gradient"),hn=me?Fs(jr,h,Fr,Ae,lt,ye,Be):Rf(jr,h,Fr,Ae);Ut.draw(O,O.gl.TRIANGLES,S,w,C,et.backCCW,hn,p.id,st.layoutVertexBuffer,st.indexBuffer,st.segments,p.paint,h.transform.zoom,xt)}}}function sl(h,v,p,g,S,w){var C=h.context,O=C.gl,X=v.fbo;if(X){var J=h.useProgram("hillshade");C.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,X.colorAttachment.get());var me=function(ye,Ae,Ve){var Ue=Ve.paint.get("hillshade-shadow-color"),lt=Ve.paint.get("hillshade-highlight-color"),Be=Ve.paint.get("hillshade-accent-color"),st=Ve.paint.get("hillshade-illumination-direction")*(Math.PI/180);Ve.paint.get("hillshade-illumination-anchor")==="viewport"&&(st-=ye.transform.angle);var xt,Ut,ar,qt=!ye.options.moving;return{u_matrix:ye.transform.calculatePosMatrix(Ae.tileID.toUnwrapped(),qt),u_image:0,u_latrange:(xt=Ae.tileID,Ut=Math.pow(2,xt.canonical.z),ar=xt.canonical.y,[new _.MercatorCoordinate(0,ar/Ut).toLngLat().lat,new _.MercatorCoordinate(0,(ar+1)/Ut).toLngLat().lat]),u_light:[Ve.paint.get("hillshade-exaggeration"),st],u_shadow:Ue,u_highlight:lt,u_accent:Be}}(h,v,p);J.draw(C,O.TRIANGLES,g,S,w,et.disabled,me,p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}}function xh(h,v,p,g,S,w){var C=h.context,O=C.gl,X=v.dem;if(X&&X.data){var J=X.dim,me=X.stride,ye=X.getPixels();if(C.activeTexture.set(O.TEXTURE1),C.pixelStoreUnpackPremultiplyAlpha.set(!1),v.demTexture=v.demTexture||h.getTileTexture(me),v.demTexture){var Ae=v.demTexture;Ae.update(ye,{premultiply:!1}),Ae.bind(O.NEAREST,O.CLAMP_TO_EDGE)}else v.demTexture=new _.Texture(C,ye,O.RGBA,{premultiply:!1}),v.demTexture.bind(O.NEAREST,O.CLAMP_TO_EDGE);C.activeTexture.set(O.TEXTURE0);var Ve=v.fbo;if(!Ve){var Ue=new _.Texture(C,{width:J,height:J,data:null},O.RGBA);Ue.bind(O.LINEAR,O.CLAMP_TO_EDGE),(Ve=v.fbo=C.createFramebuffer(J,J,!0)).colorAttachment.set(Ue.texture)}C.bindFramebuffer.set(Ve.framebuffer),C.viewport.set([0,0,J,J]),h.useProgram("hillshadePrepare").draw(C,O.TRIANGLES,g,S,w,et.disabled,function(lt,Be){var st=Be.stride,xt=_.create();return _.ortho(xt,0,_.EXTENT,-_.EXTENT,0,0,1),_.translate(xt,xt,[0,-_.EXTENT,0]),{u_matrix:xt,u_image:1,u_dimension:[st,st],u_zoom:lt.overscaledZ,u_unpack:Be.getUnpackVector()}}(v.tileID,X),p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments),v.needsHillshadePrepare=!1}}function bh(h,v,p,g,S){var w=g.paint.get("raster-fade-duration");if(w>0){var C=_.browser.now(),O=(C-h.timeAdded)/w,X=v?(C-v.timeAdded)/w:-1,J=p.getSource(),me=S.coveringZoomLevel({tileSize:J.tileSize,roundZoom:J.roundZoom}),ye=!v||Math.abs(v.tileID.overscaledZ-me)>Math.abs(h.tileID.overscaledZ-me),Ae=ye&&h.refreshedUponExpiration?1:_.clamp(ye?O:1-X,0,1);return h.refreshedUponExpiration&&O>=1&&(h.refreshedUponExpiration=!1),v?{opacity:1,mix:1-Ae}:{opacity:Ae,mix:0}}return{opacity:1,mix:0}}var Eh=new _.Color(1,0,0,1),Pf=new _.Color(0,1,0,1),sp=new _.Color(0,0,1,1),Va=new _.Color(1,0,1,1),up=new _.Color(0,1,1,1);function Of(h,v,p,g){Kl(h,0,v+p/2,h.transform.width,p,g)}function lp(h,v,p,g){Kl(h,v-p/2,0,p,h.transform.height,g)}function Kl(h,v,p,g,S,w){var C=h.context,O=C.gl;O.enable(O.SCISSOR_TEST),O.scissor(v*_.browser.devicePixelRatio,p*_.browser.devicePixelRatio,g*_.browser.devicePixelRatio,S*_.browser.devicePixelRatio),C.clear({color:w}),O.disable(O.SCISSOR_TEST)}function cp(h,v,p){var g=h.context,S=g.gl,w=p.posMatrix,C=h.useProgram("debug"),O=ne.disabled,X=xe.disabled,J=h.colorModeForRenderPass();g.activeTexture.set(S.TEXTURE0),h.emptyTexture.bind(S.LINEAR,S.CLAMP_TO_EDGE),C.draw(g,S.LINE_STRIP,O,X,J,et.disabled,il(w,_.Color.red),"$debug",h.debugBuffer,h.tileBorderIndexBuffer,h.debugSegments);var me=v.getTileByID(p.key).latestRawTileData,ye=Math.floor((me&&me.byteLength||0)/1024),Ae=v.getTile(p).tileSize,Ve=512/Math.min(Ae,512)*(p.overscaledZ/h.transform.zoom)*.5,Ue=p.canonical.toString();p.overscaledZ!==p.canonical.z&&(Ue+=" => "+p.overscaledZ),function(lt,Be){lt.initDebugOverlayCanvas();var st=lt.debugOverlayCanvas,xt=lt.context.gl,Ut=lt.debugOverlayCanvas.getContext("2d");Ut.clearRect(0,0,st.width,st.height),Ut.shadowColor="white",Ut.shadowBlur=2,Ut.lineWidth=1.5,Ut.strokeStyle="white",Ut.textBaseline="top",Ut.font="bold 36px Open Sans, sans-serif",Ut.fillText(Be,5,5),Ut.strokeText(Be,5,5),lt.debugOverlayTexture.update(st),lt.debugOverlayTexture.bind(xt.LINEAR,xt.CLAMP_TO_EDGE)}(h,Ue+" "+ye+"kb"),C.draw(g,S.TRIANGLES,O,X,Fe.alphaBlended,et.disabled,il(w,_.Color.transparent,Ve),"$debug",h.debugBuffer,h.quadTriangleIndexBuffer,h.debugSegments)}var Zu={symbol:function(h,v,p,g,S){if(h.renderPass==="translucent"){var w=xe.disabled,C=h.colorModeForRenderPass();p.layout.get("text-variable-anchor")&&function(O,X,J,me,ye,Ae,Ve){for(var Ue=X.transform,lt=ye==="map",Be=Ae==="map",st=0,xt=O;st<xt.length;st+=1){var Ut=xt[st],ar=me.getTile(Ut),qt=ar.getBucket(J);if(qt&&qt.text&&qt.text.segments.get().length){var fr=_.evaluateSizeForZoom(qt.textSizeData,Ue.zoom),br=la(ar,1,X.transform.zoom),jr=Pa(Ut.posMatrix,Be,lt,X.transform,br),Fr=J.layout.get("icon-text-fit")!=="none"&&qt.hasIconData();if(fr){var hn=Math.pow(2,Ue.zoom-ar.tileID.overscaledZ);ef(qt,lt,Be,Ve,_.symbolSize,Ue,jr,Ut.posMatrix,hn,fr,Fr)}}}}(g,h,p,v,p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),S),p.paint.get("icon-opacity").constantOr(1)!==0&&Il(h,v,p,g,!1,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),p.layout.get("icon-rotation-alignment"),p.layout.get("icon-pitch-alignment"),p.layout.get("icon-keep-upright"),w,C),p.paint.get("text-opacity").constantOr(1)!==0&&Il(h,v,p,g,!0,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),p.layout.get("text-rotation-alignment"),p.layout.get("text-pitch-alignment"),p.layout.get("text-keep-upright"),w,C),v.map.showCollisionBoxes&&(Ec(h,v,p,g,p.paint.get("text-translate"),p.paint.get("text-translate-anchor"),!0),Ec(h,v,p,g,p.paint.get("icon-translate"),p.paint.get("icon-translate-anchor"),!1))}},circle:function(h,v,p,g){if(h.renderPass==="translucent"){var S=p.paint.get("circle-opacity"),w=p.paint.get("circle-stroke-width"),C=p.paint.get("circle-stroke-opacity"),O=p.layout.get("circle-sort-key").constantOr(1)!==void 0;if(S.constantOr(1)!==0||w.constantOr(1)!==0&&C.constantOr(1)!==0){for(var X=h.context,J=X.gl,me=h.depthModeForSublayer(0,ne.ReadOnly),ye=xe.disabled,Ae=h.colorModeForRenderPass(),Ve=[],Ue=0;Ue<g.length;Ue++){var lt=g[Ue],Be=v.getTile(lt),st=Be.getBucket(p);if(st){var xt=st.programConfigurations.get(p.id),Ut={programConfiguration:xt,program:h.useProgram("circle",xt),layoutVertexBuffer:st.layoutVertexBuffer,indexBuffer:st.indexBuffer,uniformValues:yc(h,lt,Be,p)};if(O)for(var ar=0,qt=st.segments.get();ar<qt.length;ar+=1){var fr=qt[ar];Ve.push({segments:new _.SegmentVector([fr]),sortKey:fr.sortKey,state:Ut})}else Ve.push({segments:st.segments,sortKey:0,state:Ut})}}O&&Ve.sort(function(Un,Ln){return Un.sortKey-Ln.sortKey});for(var br=0,jr=Ve;br<jr.length;br+=1){var Fr=jr[br],hn=Fr.state;hn.program.draw(X,J.TRIANGLES,me,ye,Ae,et.disabled,hn.uniformValues,p.id,hn.layoutVertexBuffer,hn.indexBuffer,Fr.segments,p.paint,h.transform.zoom,hn.programConfiguration)}}}},heatmap:function(h,v,p,g){if(p.paint.get("heatmap-opacity")!==0)if(h.renderPass==="offscreen"){var S=h.context,w=S.gl,C=xe.disabled,O=new Fe([w.ONE,w.ONE],_.Color.transparent,[!0,!0,!0,!0]);(function(Ve,Ue,lt){var Be=Ve.gl;Ve.activeTexture.set(Be.TEXTURE1),Ve.viewport.set([0,0,Ue.width/4,Ue.height/4]);var st=lt.heatmapFbo;if(st)Be.bindTexture(Be.TEXTURE_2D,st.colorAttachment.get()),Ve.bindFramebuffer.set(st.framebuffer);else{var xt=Be.createTexture();Be.bindTexture(Be.TEXTURE_2D,xt),Be.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_WRAP_S,Be.CLAMP_TO_EDGE),Be.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_WRAP_T,Be.CLAMP_TO_EDGE),Be.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_MIN_FILTER,Be.LINEAR),Be.texParameteri(Be.TEXTURE_2D,Be.TEXTURE_MAG_FILTER,Be.LINEAR),st=lt.heatmapFbo=Ve.createFramebuffer(Ue.width/4,Ue.height/4,!1),function(Ut,ar,qt,fr){var br=Ut.gl;br.texImage2D(br.TEXTURE_2D,0,br.RGBA,ar.width/4,ar.height/4,0,br.RGBA,Ut.extRenderToTextureHalfFloat?Ut.extTextureHalfFloat.HALF_FLOAT_OES:br.UNSIGNED_BYTE,null),fr.colorAttachment.set(qt)}(Ve,Ue,xt,st)}})(S,h,p),S.clear({color:_.Color.transparent});for(var X=0;X<g.length;X++){var J=g[X];if(!v.hasRenderableParent(J)){var me=v.getTile(J),ye=me.getBucket(p);if(ye){var Ae=ye.programConfigurations.get(p.id);h.useProgram("heatmap",Ae).draw(S,w.TRIANGLES,ne.disabled,C,O,et.disabled,gh(J.posMatrix,me,h.transform.zoom,p.paint.get("heatmap-intensity")),p.id,ye.layoutVertexBuffer,ye.indexBuffer,ye.segments,p.paint,h.transform.zoom,Ae)}}}S.viewport.set([0,0,h.width,h.height])}else h.renderPass==="translucent"&&(h.context.setColorMode(h.colorModeForRenderPass()),function(Ve,Ue){var lt=Ve.context,Be=lt.gl,st=Ue.heatmapFbo;if(st){lt.activeTexture.set(Be.TEXTURE0),Be.bindTexture(Be.TEXTURE_2D,st.colorAttachment.get()),lt.activeTexture.set(Be.TEXTURE1);var xt=Ue.colorRampTexture;xt||(xt=Ue.colorRampTexture=new _.Texture(lt,Ue.colorRamp,Be.RGBA)),xt.bind(Be.LINEAR,Be.CLAMP_TO_EDGE),Ve.useProgram("heatmapTexture").draw(lt,Be.TRIANGLES,ne.disabled,xe.disabled,Ve.colorModeForRenderPass(),et.disabled,function(Ut,ar,qt,fr){var br=_.create();_.ortho(br,0,Ut.width,Ut.height,0,0,1);var jr=Ut.context.gl;return{u_matrix:br,u_world:[jr.drawingBufferWidth,jr.drawingBufferHeight],u_image:0,u_color_ramp:1,u_opacity:ar.paint.get("heatmap-opacity")}}(Ve,Ue),Ue.id,Ve.viewportBuffer,Ve.quadTriangleIndexBuffer,Ve.viewportSegments,Ue.paint,Ve.transform.zoom)}}(h,p))},line:function(h,v,p,g){if(h.renderPass==="translucent"){var S=p.paint.get("line-opacity"),w=p.paint.get("line-width");if(S.constantOr(1)!==0&&w.constantOr(1)!==0)for(var C=h.depthModeForSublayer(0,ne.ReadOnly),O=h.colorModeForRenderPass(),X=p.paint.get("line-dasharray"),J=p.paint.get("line-pattern"),me=J.constantOr(1),ye=p.paint.get("line-gradient"),Ae=p.getCrossfadeParameters(),Ve=me?"linePattern":X?"lineSDF":ye?"lineGradient":"line",Ue=h.context,lt=Ue.gl,Be=!0,st=0,xt=g;st<xt.length;st+=1){var Ut=xt[st],ar=v.getTile(Ut);if(!me||ar.patternsLoaded()){var qt=ar.getBucket(p);if(qt){var fr=qt.programConfigurations.get(p.id),br=h.context.program.get(),jr=h.useProgram(Ve,fr),Fr=Be||jr.program!==br,hn=J.constantOr(null);if(hn&&ar.imageAtlas){var Un=ar.imageAtlas,Ln=Un.patternPositions[hn.to.toString()],zn=Un.patternPositions[hn.from.toString()];Ln&&zn&&fr.setConstantPatternPositions(Ln,zn)}var Ui=me?Ml(h,ar,p,Ae):X?op(h,ar,p,X,Ae):ye?fa(h,ar,p,qt.lineClipsArray.length):qc(h,ar,p);if(me)Ue.activeTexture.set(lt.TEXTURE0),ar.imageAtlasTexture.bind(lt.LINEAR,lt.CLAMP_TO_EDGE),fr.updatePaintBuffers(Ae);else if(X&&(Fr||h.lineAtlas.dirty))Ue.activeTexture.set(lt.TEXTURE0),h.lineAtlas.bind(Ue);else if(ye){var gn=qt.gradients[p.id],ii=gn.texture;if(p.gradientVersion!==gn.version){var pi=256;if(p.stepInterpolant){var ri=v.getSource().maxzoom,Qn=Ut.canonical.z===ri?Math.ceil(1<<h.transform.maxZoom-Ut.canonical.z):1;pi=_.clamp(_.nextPowerOfTwo(qt.maxLineLength/_.EXTENT*1024*Qn),256,Ue.maxTextureSize)}gn.gradient=_.renderColorRamp({expression:p.gradientExpression(),evaluationKey:"lineProgress",resolution:pi,image:gn.gradient||void 0,clips:qt.lineClipsArray}),gn.texture?gn.texture.update(gn.gradient):gn.texture=new _.Texture(Ue,gn.gradient,lt.RGBA),gn.version=p.gradientVersion,ii=gn.texture}Ue.activeTexture.set(lt.TEXTURE0),ii.bind(p.stepInterpolant?lt.NEAREST:lt.LINEAR,lt.CLAMP_TO_EDGE)}jr.draw(Ue,lt.TRIANGLES,C,h.stencilModeForClipping(Ut),O,et.disabled,Ui,p.id,qt.layoutVertexBuffer,qt.indexBuffer,qt.segments,p.paint,h.transform.zoom,fr,qt.layoutVertexBuffer2),Be=!1}}}}},fill:function(h,v,p,g){var S=p.paint.get("fill-color"),w=p.paint.get("fill-opacity");if(w.constantOr(1)!==0){var C=h.colorModeForRenderPass(),O=p.paint.get("fill-pattern"),X=h.opaquePassEnabledForLayer()&&!O.constantOr(1)&&S.constantOr(_.Color.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";if(h.renderPass===X){var J=h.depthModeForSublayer(1,h.renderPass==="opaque"?ne.ReadWrite:ne.ReadOnly);ql(h,v,p,g,J,C,!1)}if(h.renderPass==="translucent"&&p.paint.get("fill-antialias")){var me=h.depthModeForSublayer(p.getPaintProperty("fill-outline-color")?2:0,ne.ReadOnly);ql(h,v,p,g,me,C,!0)}}},"fill-extrusion":function(h,v,p,g){var S=p.paint.get("fill-extrusion-opacity");if(S!==0&&h.renderPass==="translucent"){var w=new ne(h.context.gl.LEQUAL,ne.ReadWrite,h.depthRangeFor3D);if(S!==1||p.paint.get("fill-extrusion-pattern").constantOr(1))If(h,v,p,g,w,xe.disabled,Fe.disabled),If(h,v,p,g,w,h.stencilModeFor3D(),h.colorModeForRenderPass());else{var C=h.colorModeForRenderPass();If(h,v,p,g,w,xe.disabled,C)}}},hillshade:function(h,v,p,g){if(h.renderPass==="offscreen"||h.renderPass==="translucent"){for(var S=h.context,w=h.depthModeForSublayer(0,ne.ReadOnly),C=h.colorModeForRenderPass(),O=h.renderPass==="translucent"?h.stencilConfigForOverlap(g):[{},g],X=O[0],J=0,me=O[1];J<me.length;J+=1){var ye=me[J],Ae=v.getTile(ye);Ae.needsHillshadePrepare&&h.renderPass==="offscreen"?xh(h,Ae,p,w,xe.disabled,C):h.renderPass==="translucent"&&sl(h,Ae,p,w,X[ye.overscaledZ],C)}S.viewport.set([0,0,h.width,h.height])}},raster:function(h,v,p,g){if(h.renderPass==="translucent"&&p.paint.get("raster-opacity")!==0&&g.length)for(var S=h.context,w=S.gl,C=v.getSource(),O=h.useProgram("raster"),X=h.colorModeForRenderPass(),J=C instanceof De?[{},g]:h.stencilConfigForOverlap(g),me=J[0],ye=J[1],Ae=ye[ye.length-1].overscaledZ,Ve=!h.options.moving,Ue=0,lt=ye;Ue<lt.length;Ue+=1){var Be=lt[Ue],st=h.depthModeForSublayer(Be.overscaledZ-Ae,p.paint.get("raster-opacity")===1?ne.ReadWrite:ne.ReadOnly,w.LESS),xt=v.getTile(Be),Ut=h.transform.calculatePosMatrix(Be.toUnwrapped(),Ve);xt.registerFadeDuration(p.paint.get("raster-fade-duration"));var ar=v.findLoadedParent(Be,0),qt=bh(xt,ar,v,p,h.transform),fr=void 0,br=void 0,jr=p.paint.get("raster-resampling")==="nearest"?w.NEAREST:w.LINEAR;S.activeTexture.set(w.TEXTURE0),xt.texture.bind(jr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),S.activeTexture.set(w.TEXTURE1),ar?(ar.texture.bind(jr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST),fr=Math.pow(2,ar.tileID.overscaledZ-xt.tileID.overscaledZ),br=[xt.tileID.canonical.x*fr%1,xt.tileID.canonical.y*fr%1]):xt.texture.bind(jr,w.CLAMP_TO_EDGE,w.LINEAR_MIPMAP_NEAREST);var Fr=Qc(Ut,br||[0,0],fr||1,qt,p);C instanceof De?O.draw(S,w.TRIANGLES,st,xe.disabled,X,et.disabled,Fr,p.id,C.boundsBuffer,h.quadTriangleIndexBuffer,C.boundsSegments):O.draw(S,w.TRIANGLES,st,me[Be.overscaledZ],X,et.disabled,Fr,p.id,h.rasterBoundsBuffer,h.quadTriangleIndexBuffer,h.rasterBoundsSegments)}},background:function(h,v,p){var g=p.paint.get("background-color"),S=p.paint.get("background-opacity");if(S!==0){var w=h.context,C=w.gl,O=h.transform,X=O.tileSize,J=p.paint.get("background-pattern");if(!h.isPatternMissing(J)){var me=!J&&g.a===1&&S===1&&h.opaquePassEnabledForLayer()?"opaque":"translucent";if(h.renderPass===me){var ye=xe.disabled,Ae=h.depthModeForSublayer(0,me==="opaque"?ne.ReadWrite:ne.ReadOnly),Ve=h.colorModeForRenderPass(),Ue=h.useProgram(J?"backgroundPattern":"background"),lt=O.coveringTiles({tileSize:X});J&&(w.activeTexture.set(C.TEXTURE0),h.imageManager.bind(h.context));for(var Be=p.getCrossfadeParameters(),st=0,xt=lt;st<xt.length;st+=1){var Ut=xt[st],ar=h.transform.calculatePosMatrix(Ut.toUnwrapped()),qt=J?Yl(ar,S,h,J,{tileID:Ut,tileSize:X},Be):bc(ar,S,g);Ue.draw(w,C.TRIANGLES,Ae,ye,Ve,et.disabled,qt,p.id,h.tileExtentBuffer,h.quadTriangleIndexBuffer,h.tileExtentSegments)}}}}},debug:function(h,v,p){for(var g=0;g<p.length;g++)cp(h,v,p[g])},custom:function(h,v,p){var g=h.context,S=p.implementation;if(h.renderPass==="offscreen"){var w=S.prerender;w&&(h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),w.call(S,g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState())}else if(h.renderPass==="translucent"){h.setCustomLayerDefaults(),g.setColorMode(h.colorModeForRenderPass()),g.setStencilMode(xe.disabled);var C=S.renderingMode==="3d"?new ne(h.context.gl.LEQUAL,ne.ReadWrite,h.depthRangeFor3D):h.depthModeForSublayer(0,ne.ReadOnly);g.setDepthMode(C),S.render(g.gl,h.transform.customLayerMatrix()),g.setDirty(),h.setBaseState(),g.bindFramebuffer.set(null)}}},da=function(h,v){this.context=new j(h),this.transform=v,this._tileTextures={},this.setup(),this.numSublayers=Q.maxUnderzooming+Q.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.crossTileSymbolIndex=new Sl,this.gpuTimers={}};da.prototype.resize=function(h,v){if(this.width=h*_.browser.devicePixelRatio,this.height=v*_.browser.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(var p=0,g=this.style._order;p<g.length;p+=1)this.style._layers[g[p]].resize()},da.prototype.setup=function(){var h=this.context,v=new _.StructArrayLayout2i4;v.emplaceBack(0,0),v.emplaceBack(_.EXTENT,0),v.emplaceBack(0,_.EXTENT),v.emplaceBack(_.EXTENT,_.EXTENT),this.tileExtentBuffer=h.createVertexBuffer(v,Ya.members),this.tileExtentSegments=_.SegmentVector.simpleSegment(0,0,4,2);var p=new _.StructArrayLayout2i4;p.emplaceBack(0,0),p.emplaceBack(_.EXTENT,0),p.emplaceBack(0,_.EXTENT),p.emplaceBack(_.EXTENT,_.EXTENT),this.debugBuffer=h.createVertexBuffer(p,Ya.members),this.debugSegments=_.SegmentVector.simpleSegment(0,0,4,5);var g=new _.StructArrayLayout4i8;g.emplaceBack(0,0,0,0),g.emplaceBack(_.EXTENT,0,_.EXTENT,0),g.emplaceBack(0,_.EXTENT,0,_.EXTENT),g.emplaceBack(_.EXTENT,_.EXTENT,_.EXTENT,_.EXTENT),this.rasterBoundsBuffer=h.createVertexBuffer(g,nt.members),this.rasterBoundsSegments=_.SegmentVector.simpleSegment(0,0,4,2);var S=new _.StructArrayLayout2i4;S.emplaceBack(0,0),S.emplaceBack(1,0),S.emplaceBack(0,1),S.emplaceBack(1,1),this.viewportBuffer=h.createVertexBuffer(S,Ya.members),this.viewportSegments=_.SegmentVector.simpleSegment(0,0,4,2);var w=new _.StructArrayLayout1ui2;w.emplaceBack(0),w.emplaceBack(1),w.emplaceBack(3),w.emplaceBack(2),w.emplaceBack(0),this.tileBorderIndexBuffer=h.createIndexBuffer(w);var C=new _.StructArrayLayout3ui6;C.emplaceBack(0,1,2),C.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=h.createIndexBuffer(C),this.emptyTexture=new _.Texture(h,{width:1,height:1,data:new Uint8Array([0,0,0,0])},h.gl.RGBA);var O=this.context.gl;this.stencilClearMode=new xe({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO)},da.prototype.clearStencil=function(){var h=this.context,v=h.gl;this.nextStencilID=1,this.currentStencilSource=void 0;var p=_.create();_.ortho(p,0,this.width,this.height,0,0,1),_.scale(p,p,[v.drawingBufferWidth,v.drawingBufferHeight,0]),this.useProgram("clippingMask").draw(h,v.TRIANGLES,ne.disabled,this.stencilClearMode,Fe.disabled,et.disabled,Rl(p),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)},da.prototype._renderTileClippingMasks=function(h,v){if(this.currentStencilSource!==h.source&&h.isTileClipped()&&v&&v.length){this.currentStencilSource=h.source;var p=this.context,g=p.gl;this.nextStencilID+v.length>256&&this.clearStencil(),p.setColorMode(Fe.disabled),p.setDepthMode(ne.disabled);var S=this.useProgram("clippingMask");this._tileClippingMaskIDs={};for(var w=0,C=v;w<C.length;w+=1){var O=C[w],X=this._tileClippingMaskIDs[O.key]=this.nextStencilID++;S.draw(p,g.TRIANGLES,ne.disabled,new xe({func:g.ALWAYS,mask:0},X,255,g.KEEP,g.KEEP,g.REPLACE),Fe.disabled,et.disabled,Rl(O.posMatrix),"$clipping",this.tileExtentBuffer,this.quadTriangleIndexBuffer,this.tileExtentSegments)}}},da.prototype.stencilModeFor3D=function(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();var h=this.nextStencilID++,v=this.context.gl;return new xe({func:v.NOTEQUAL,mask:255},h,255,v.KEEP,v.KEEP,v.REPLACE)},da.prototype.stencilModeForClipping=function(h){var v=this.context.gl;return new xe({func:v.EQUAL,mask:255},this._tileClippingMaskIDs[h.key],0,v.KEEP,v.KEEP,v.REPLACE)},da.prototype.stencilConfigForOverlap=function(h){var v,p=this.context.gl,g=h.sort(function(X,J){return J.overscaledZ-X.overscaledZ}),S=g[g.length-1].overscaledZ,w=g[0].overscaledZ-S+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();for(var C={},O=0;O<w;O++)C[O+S]=new xe({func:p.GEQUAL,mask:255},O+this.nextStencilID,255,p.KEEP,p.KEEP,p.REPLACE);return this.nextStencilID+=w,[C,g]}return[(v={},v[S]=xe.disabled,v),g]},da.prototype.colorModeForRenderPass=function(){var h=this.context.gl;return this._showOverdrawInspector?new Fe([h.CONSTANT_COLOR,h.ONE],new _.Color(1/8,1/8,1/8,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Fe.unblended:Fe.alphaBlended},da.prototype.depthModeForSublayer=function(h,v,p){if(!this.opaquePassEnabledForLayer())return ne.disabled;var g=1-((1+this.currentLayer)*this.numSublayers+h)*this.depthEpsilon;return new ne(p||this.context.gl.LEQUAL,v,[g,g])},da.prototype.opaquePassEnabledForLayer=function(){return this.currentLayer<this.opaquePassCutoff},da.prototype.render=function(h,v){var p=this;this.style=h,this.options=v,this.lineAtlas=h.lineAtlas,this.imageManager=h.imageManager,this.glyphManager=h.glyphManager,this.symbolFadeChange=h.placement.symbolFadeChange(_.browser.now()),this.imageManager.beginFrame();var g=this.style._order,S=this.style.sourceCaches;for(var w in S){var C=S[w];C.used&&C.prepare(this.context)}var O,X,J={},me={},ye={};for(var Ae in S){var Ve=S[Ae];J[Ae]=Ve.getVisibleCoordinates(),me[Ae]=J[Ae].slice().reverse(),ye[Ae]=Ve.getVisibleCoordinates(!0).reverse()}this.opaquePassCutoff=1/0;for(var Ue=0;Ue<g.length;Ue++)if(this.style._layers[g[Ue]].is3D()){this.opaquePassCutoff=Ue;break}this.renderPass="offscreen";for(var lt=0,Be=g;lt<Be.length;lt+=1){var st=this.style._layers[Be[lt]];if(st.hasOffscreenPass()&&!st.isHidden(this.transform.zoom)){var xt=me[st.source];(st.type==="custom"||xt.length)&&this.renderLayer(this,S[st.source],st,xt)}}for(this.context.bindFramebuffer.set(null),this.context.clear({color:v.showOverdrawInspector?_.Color.black:_.Color.transparent,depth:1}),this.clearStencil(),this._showOverdrawInspector=v.showOverdrawInspector,this.depthRangeFor3D=[0,1-(h._order.length+2)*this.numSublayers*this.depthEpsilon],this.renderPass="opaque",this.currentLayer=g.length-1;this.currentLayer>=0;this.currentLayer--){var Ut=this.style._layers[g[this.currentLayer]],ar=S[Ut.source],qt=J[Ut.source];this._renderTileClippingMasks(Ut,qt),this.renderLayer(this,ar,Ut,qt)}for(this.renderPass="translucent",this.currentLayer=0;this.currentLayer<g.length;this.currentLayer++){var fr=this.style._layers[g[this.currentLayer]],br=S[fr.source],jr=(fr.type==="symbol"?ye:me)[fr.source];this._renderTileClippingMasks(fr,J[fr.source]),this.renderLayer(this,br,fr,jr)}this.options.showTileBoundaries&&(_.values(this.style._layers).forEach(function(Fr){Fr.source&&!Fr.isHidden(p.transform.zoom)&&(Fr.source!==(X&&X.id)&&(X=p.style.sourceCaches[Fr.source]),(!O||O.getSource().maxzoom<X.getSource().maxzoom)&&(O=X))}),O&&Zu.debug(this,O,O.getVisibleCoordinates())),this.options.showPadding&&function(Fr){var hn=Fr.transform.padding;Of(Fr,Fr.transform.height-(hn.top||0),3,Eh),Of(Fr,hn.bottom||0,3,Pf),lp(Fr,hn.left||0,3,sp),lp(Fr,Fr.transform.width-(hn.right||0),3,Va);var Un=Fr.transform.centerPoint;(function(Ln,zn,Ui,gn){Kl(Ln,zn-1,Ui-10,2,20,gn),Kl(Ln,zn-10,Ui-1,20,2,gn)})(Fr,Un.x,Fr.transform.height-Un.y,up)}(this),this.context.setDefault()},da.prototype.renderLayer=function(h,v,p,g){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="custom"||g.length)&&(this.id=p.id,this.gpuTimingStart(p),Zu[p.type](h,v,p,g,this.style.placement.variableOffsets),this.gpuTimingEnd())},da.prototype.gpuTimingStart=function(h){if(this.options.gpuTiming){var v=this.context.extTimerQuery,p=this.gpuTimers[h.id];p||(p=this.gpuTimers[h.id]={calls:0,cpuTime:0,query:v.createQueryEXT()}),p.calls++,v.beginQueryEXT(v.TIME_ELAPSED_EXT,p.query)}},da.prototype.gpuTimingEnd=function(){if(this.options.gpuTiming){var h=this.context.extTimerQuery;h.endQueryEXT(h.TIME_ELAPSED_EXT)}},da.prototype.collectGpuTimers=function(){var h=this.gpuTimers;return this.gpuTimers={},h},da.prototype.queryGpuTimers=function(h){var v={};for(var p in h){var g=h[p],S=this.context.extTimerQuery,w=S.getQueryObjectEXT(g.query,S.QUERY_RESULT_EXT)/1e6;S.deleteQueryEXT(g.query),v[p]=w}return v},da.prototype.translatePosMatrix=function(h,v,p,g,S){if(!p[0]&&!p[1])return h;var w=S?g==="map"?this.transform.angle:0:g==="viewport"?-this.transform.angle:0;if(w){var C=Math.sin(w),O=Math.cos(w);p=[p[0]*O-p[1]*C,p[0]*C+p[1]*O]}var X=[S?p[0]:la(v,p[0],this.transform.zoom),S?p[1]:la(v,p[1],this.transform.zoom),0],J=new Float32Array(16);return _.translate(J,h,X),J},da.prototype.saveTileTexture=function(h){var v=this._tileTextures[h.size[0]];v?v.push(h):this._tileTextures[h.size[0]]=[h]},da.prototype.getTileTexture=function(h){var v=this._tileTextures[h];return v&&v.length>0?v.pop():null},da.prototype.isPatternMissing=function(h){if(!h)return!1;if(!h.from||!h.to)return!0;var v=this.imageManager.getPattern(h.from.toString()),p=this.imageManager.getPattern(h.to.toString());return!v||!p},da.prototype.useProgram=function(h,v){this.cache=this.cache||{};var p=""+h+(v?v.cacheKey:"")+(this._showOverdrawInspector?"/overdraw":"");return this.cache[p]||(this.cache[p]=new Za(this.context,h,ou[h],v,_h[h],this._showOverdrawInspector)),this.cache[p]},da.prototype.setCustomLayerDefaults=function(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()},da.prototype.setBaseState=function(){var h=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(h.FUNC_ADD)},da.prototype.initDebugOverlayCanvas=function(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=_.window.document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new _.Texture(this.context,this.debugOverlayCanvas,this.context.gl.RGBA))},da.prototype.destroy=function(){this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy()};var Ql=function(h,v){this.points=h,this.planes=v};Ql.fromInvProjectionMatrix=function(h,v,p){var g=Math.pow(2,p),S=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(function(C){return _.transformMat4([],C,h)}).map(function(C){return _.scale$1([],C,1/C[3]/v*g)}),w=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(function(C){var O=_.sub([],S[C[0]],S[C[1]]),X=_.sub([],S[C[2]],S[C[1]]),J=_.normalize([],_.cross([],O,X)),me=-_.dot(J,S[C[1]]);return J.concat(me)});return new Ql(S,w)};var Vu=function(h,v){this.min=h,this.max=v,this.center=_.scale$2([],_.add([],this.min,this.max),.5)};Vu.prototype.quadrant=function(h){for(var v=[h%2==0,h<2],p=_.clone$2(this.min),g=_.clone$2(this.max),S=0;S<v.length;S++)p[S]=v[S]?this.min[S]:this.center[S],g[S]=v[S]?this.center[S]:this.max[S];return g[2]=this.max[2],new Vu(p,g)},Vu.prototype.distanceX=function(h){return Math.max(Math.min(this.max[0],h[0]),this.min[0])-h[0]},Vu.prototype.distanceY=function(h){return Math.max(Math.min(this.max[1],h[1]),this.min[1])-h[1]},Vu.prototype.intersects=function(h){for(var v=[[this.min[0],this.min[1],0,1],[this.max[0],this.min[1],0,1],[this.max[0],this.max[1],0,1],[this.min[0],this.max[1],0,1]],p=!0,g=0;g<h.planes.length;g++){for(var S=h.planes[g],w=0,C=0;C<v.length;C++)w+=_.dot$1(S,v[C])>=0;if(w===0)return 0;w!==v.length&&(p=!1)}if(p)return 2;for(var O=0;O<3;O++){for(var X=Number.MAX_VALUE,J=-Number.MAX_VALUE,me=0;me<h.points.length;me++){var ye=h.points[me][O]-this.min[O];X=Math.min(X,ye),J=Math.max(J,ye)}if(J<0||X>this.max[O]-this.min[O])return 0}return 1};var ul=function(h,v,p,g){if(h===void 0&&(h=0),v===void 0&&(v=0),p===void 0&&(p=0),g===void 0&&(g=0),isNaN(h)||h<0||isNaN(v)||v<0||isNaN(p)||p<0||isNaN(g)||g<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=h,this.bottom=v,this.left=p,this.right=g};ul.prototype.interpolate=function(h,v,p){return v.top!=null&&h.top!=null&&(this.top=_.number(h.top,v.top,p)),v.bottom!=null&&h.bottom!=null&&(this.bottom=_.number(h.bottom,v.bottom,p)),v.left!=null&&h.left!=null&&(this.left=_.number(h.left,v.left,p)),v.right!=null&&h.right!=null&&(this.right=_.number(h.right,v.right,p)),this},ul.prototype.getCenter=function(h,v){var p=_.clamp((this.left+h-this.right)/2,0,h),g=_.clamp((this.top+v-this.bottom)/2,0,v);return new _.Point(p,g)},ul.prototype.equals=function(h){return this.top===h.top&&this.bottom===h.bottom&&this.left===h.left&&this.right===h.right},ul.prototype.clone=function(){return new ul(this.top,this.bottom,this.left,this.right)},ul.prototype.toJSON=function(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}};var Li=function(h,v,p,g,S){this.tileSize=512,this.maxValidLatitude=85.051129,this._renderWorldCopies=S===void 0||S,this._minZoom=h||0,this._maxZoom=v||22,this._minPitch=p==null?0:p,this._maxPitch=g==null?60:g,this.setMaxBounds(),this.width=0,this.height=0,this._center=new _.LngLat(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._unmodified=!0,this._edgeInsets=new ul,this._posMatrixCache={},this._alignedPosMatrixCache={}},va={minZoom:{configurable:!0},maxZoom:{configurable:!0},minPitch:{configurable:!0},maxPitch:{configurable:!0},renderWorldCopies:{configurable:!0},worldSize:{configurable:!0},centerOffset:{configurable:!0},size:{configurable:!0},bearing:{configurable:!0},pitch:{configurable:!0},fov:{configurable:!0},zoom:{configurable:!0},center:{configurable:!0},padding:{configurable:!0},centerPoint:{configurable:!0},unmodified:{configurable:!0},point:{configurable:!0}};Li.prototype.clone=function(){var h=new Li(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies);return h.tileSize=this.tileSize,h.latRange=this.latRange,h.width=this.width,h.height=this.height,h._center=this._center,h.zoom=this.zoom,h.angle=this.angle,h._fov=this._fov,h._pitch=this._pitch,h._unmodified=this._unmodified,h._edgeInsets=this._edgeInsets.clone(),h._calcMatrices(),h},va.minZoom.get=function(){return this._minZoom},va.minZoom.set=function(h){this._minZoom!==h&&(this._minZoom=h,this.zoom=Math.max(this.zoom,h))},va.maxZoom.get=function(){return this._maxZoom},va.maxZoom.set=function(h){this._maxZoom!==h&&(this._maxZoom=h,this.zoom=Math.min(this.zoom,h))},va.minPitch.get=function(){return this._minPitch},va.minPitch.set=function(h){this._minPitch!==h&&(this._minPitch=h,this.pitch=Math.max(this.pitch,h))},va.maxPitch.get=function(){return this._maxPitch},va.maxPitch.set=function(h){this._maxPitch!==h&&(this._maxPitch=h,this.pitch=Math.min(this.pitch,h))},va.renderWorldCopies.get=function(){return this._renderWorldCopies},va.renderWorldCopies.set=function(h){h===void 0?h=!0:h===null&&(h=!1),this._renderWorldCopies=h},va.worldSize.get=function(){return this.tileSize*this.scale},va.centerOffset.get=function(){return this.centerPoint._sub(this.size._div(2))},va.size.get=function(){return new _.Point(this.width,this.height)},va.bearing.get=function(){return-this.angle/Math.PI*180},va.bearing.set=function(h){var v=-_.wrap(h,-180,180)*Math.PI/180;this.angle!==v&&(this._unmodified=!1,this.angle=v,this._calcMatrices(),this.rotationMatrix=_.create$2(),_.rotate(this.rotationMatrix,this.rotationMatrix,this.angle))},va.pitch.get=function(){return this._pitch/Math.PI*180},va.pitch.set=function(h){var v=_.clamp(h,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==v&&(this._unmodified=!1,this._pitch=v,this._calcMatrices())},va.fov.get=function(){return this._fov/Math.PI*180},va.fov.set=function(h){h=Math.max(.01,Math.min(60,h)),this._fov!==h&&(this._unmodified=!1,this._fov=h/180*Math.PI,this._calcMatrices())},va.zoom.get=function(){return this._zoom},va.zoom.set=function(h){var v=Math.min(Math.max(h,this.minZoom),this.maxZoom);this._zoom!==v&&(this._unmodified=!1,this._zoom=v,this.scale=this.zoomScale(v),this.tileZoom=Math.floor(v),this.zoomFraction=v-this.tileZoom,this._constrain(),this._calcMatrices())},va.center.get=function(){return this._center},va.center.set=function(h){h.lat===this._center.lat&&h.lng===this._center.lng||(this._unmodified=!1,this._center=h,this._constrain(),this._calcMatrices())},va.padding.get=function(){return this._edgeInsets.toJSON()},va.padding.set=function(h){this._edgeInsets.equals(h)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,h,1),this._calcMatrices())},va.centerPoint.get=function(){return this._edgeInsets.getCenter(this.width,this.height)},Li.prototype.isPaddingEqual=function(h){return this._edgeInsets.equals(h)},Li.prototype.interpolatePadding=function(h,v,p){this._unmodified=!1,this._edgeInsets.interpolate(h,v,p),this._constrain(),this._calcMatrices()},Li.prototype.coveringZoomLevel=function(h){var v=(h.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/h.tileSize));return Math.max(0,v)},Li.prototype.getVisibleUnwrappedCoordinates=function(h){var v=[new _.UnwrappedTileID(0,h)];if(this._renderWorldCopies)for(var p=this.pointCoordinate(new _.Point(0,0)),g=this.pointCoordinate(new _.Point(this.width,0)),S=this.pointCoordinate(new _.Point(this.width,this.height)),w=this.pointCoordinate(new _.Point(0,this.height)),C=Math.floor(Math.min(p.x,g.x,S.x,w.x)),O=Math.floor(Math.max(p.x,g.x,S.x,w.x)),X=C-1;X<=O+1;X++)X!==0&&v.push(new _.UnwrappedTileID(X,h));return v},Li.prototype.coveringTiles=function(h){var v=this.coveringZoomLevel(h),p=v;if(h.minzoom!==void 0&&v<h.minzoom)return[];h.maxzoom!==void 0&&v>h.maxzoom&&(v=h.maxzoom);var g=_.MercatorCoordinate.fromLngLat(this.center),S=Math.pow(2,v),w=[S*g.x,S*g.y,0],C=Ql.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,v),O=h.minzoom||0;this.pitch<=60&&this._edgeInsets.top<.1&&(O=v);var X=function(Fr){return{aabb:new Vu([Fr*S,0,0],[(Fr+1)*S,S,0]),zoom:0,x:0,y:0,wrap:Fr,fullyVisible:!1}},J=[],me=[],ye=v,Ae=h.reparseOverscaled?p:v;if(this._renderWorldCopies)for(var Ve=1;Ve<=3;Ve++)J.push(X(-Ve)),J.push(X(Ve));for(J.push(X(0));J.length>0;){var Ue=J.pop(),lt=Ue.x,Be=Ue.y,st=Ue.fullyVisible;if(!st){var xt=Ue.aabb.intersects(C);if(xt===0)continue;st=xt===2}var Ut=Ue.aabb.distanceX(w),ar=Ue.aabb.distanceY(w),qt=Math.max(Math.abs(Ut),Math.abs(ar));if(Ue.zoom===ye||qt>3+(1<<ye-Ue.zoom)-2&&Ue.zoom>=O)me.push({tileID:new _.OverscaledTileID(Ue.zoom===ye?Ae:Ue.zoom,Ue.wrap,Ue.zoom,lt,Be),distanceSq:_.sqrLen([w[0]-.5-lt,w[1]-.5-Be])});else for(var fr=0;fr<4;fr++){var br=(lt<<1)+fr%2,jr=(Be<<1)+(fr>>1);J.push({aabb:Ue.aabb.quadrant(fr),zoom:Ue.zoom+1,x:br,y:jr,wrap:Ue.wrap,fullyVisible:st})}}return me.sort(function(Fr,hn){return Fr.distanceSq-hn.distanceSq}).map(function(Fr){return Fr.tileID})},Li.prototype.resize=function(h,v){this.width=h,this.height=v,this.pixelsToGLUnits=[2/h,-2/v],this._constrain(),this._calcMatrices()},va.unmodified.get=function(){return this._unmodified},Li.prototype.zoomScale=function(h){return Math.pow(2,h)},Li.prototype.scaleZoom=function(h){return Math.log(h)/Math.LN2},Li.prototype.project=function(h){var v=_.clamp(h.lat,-this.maxValidLatitude,this.maxValidLatitude);return new _.Point(_.mercatorXfromLng(h.lng)*this.worldSize,_.mercatorYfromLat(v)*this.worldSize)},Li.prototype.unproject=function(h){return new _.MercatorCoordinate(h.x/this.worldSize,h.y/this.worldSize).toLngLat()},va.point.get=function(){return this.project(this.center)},Li.prototype.setLocationAtPoint=function(h,v){var p=this.pointCoordinate(v),g=this.pointCoordinate(this.centerPoint),S=this.locationCoordinate(h),w=new _.MercatorCoordinate(S.x-(p.x-g.x),S.y-(p.y-g.y));this.center=this.coordinateLocation(w),this._renderWorldCopies&&(this.center=this.center.wrap())},Li.prototype.locationPoint=function(h){return this.coordinatePoint(this.locationCoordinate(h))},Li.prototype.pointLocation=function(h){return this.coordinateLocation(this.pointCoordinate(h))},Li.prototype.locationCoordinate=function(h){return _.MercatorCoordinate.fromLngLat(h)},Li.prototype.coordinateLocation=function(h){return h.toLngLat()},Li.prototype.pointCoordinate=function(h){var v=[h.x,h.y,0,1],p=[h.x,h.y,1,1];_.transformMat4(v,v,this.pixelMatrixInverse),_.transformMat4(p,p,this.pixelMatrixInverse);var g=v[3],S=p[3],w=v[1]/g,C=p[1]/S,O=v[2]/g,X=p[2]/S,J=O===X?0:(0-O)/(X-O);return new _.MercatorCoordinate(_.number(v[0]/g,p[0]/S,J)/this.worldSize,_.number(w,C,J)/this.worldSize)},Li.prototype.coordinatePoint=function(h){var v=[h.x*this.worldSize,h.y*this.worldSize,0,1];return _.transformMat4(v,v,this.pixelMatrix),new _.Point(v[0]/v[3],v[1]/v[3])},Li.prototype.getBounds=function(){return new _.LngLatBounds().extend(this.pointLocation(new _.Point(0,0))).extend(this.pointLocation(new _.Point(this.width,0))).extend(this.pointLocation(new _.Point(this.width,this.height))).extend(this.pointLocation(new _.Point(0,this.height)))},Li.prototype.getMaxBounds=function(){return this.latRange&&this.latRange.length===2&&this.lngRange&&this.lngRange.length===2?new _.LngLatBounds([this.lngRange[0],this.latRange[0]],[this.lngRange[1],this.latRange[1]]):null},Li.prototype.setMaxBounds=function(h){h?(this.lngRange=[h.getWest(),h.getEast()],this.latRange=[h.getSouth(),h.getNorth()],this._constrain()):(this.lngRange=null,this.latRange=[-this.maxValidLatitude,this.maxValidLatitude])},Li.prototype.calculatePosMatrix=function(h,v){v===void 0&&(v=!1);var p=h.key,g=v?this._alignedPosMatrixCache:this._posMatrixCache;if(g[p])return g[p];var S=h.canonical,w=this.worldSize/this.zoomScale(S.z),C=S.x+Math.pow(2,S.z)*h.wrap,O=_.identity(new Float64Array(16));return _.translate(O,O,[C*w,S.y*w,0]),_.scale(O,O,[w/_.EXTENT,w/_.EXTENT,1]),_.multiply(O,v?this.alignedProjMatrix:this.projMatrix,O),g[p]=new Float32Array(O),g[p]},Li.prototype.customLayerMatrix=function(){return this.mercatorMatrix.slice()},Li.prototype._constrain=function(){if(this.center&&this.width&&this.height&&!this._constraining){this._constraining=!0;var h,v,p,g,S=-90,w=90,C=-180,O=180,X=this.size,J=this._unmodified;if(this.latRange){var me=this.latRange;S=_.mercatorYfromLat(me[1])*this.worldSize,h=(w=_.mercatorYfromLat(me[0])*this.worldSize)-S<X.y?X.y/(w-S):0}if(this.lngRange){var ye=this.lngRange;C=_.mercatorXfromLng(ye[0])*this.worldSize,v=(O=_.mercatorXfromLng(ye[1])*this.worldSize)-C<X.x?X.x/(O-C):0}var Ae=this.point,Ve=Math.max(v||0,h||0);if(Ve)return this.center=this.unproject(new _.Point(v?(O+C)/2:Ae.x,h?(w+S)/2:Ae.y)),this.zoom+=this.scaleZoom(Ve),this._unmodified=J,void(this._constraining=!1);if(this.latRange){var Ue=Ae.y,lt=X.y/2;Ue-lt<S&&(g=S+lt),Ue+lt>w&&(g=w-lt)}if(this.lngRange){var Be=Ae.x,st=X.x/2;Be-st<C&&(p=C+st),Be+st>O&&(p=O-st)}p===void 0&&g===void 0||(this.center=this.unproject(new _.Point(p!==void 0?p:Ae.x,g!==void 0?g:Ae.y))),this._unmodified=J,this._constraining=!1}},Li.prototype._calcMatrices=function(){if(this.height){var h=this.centerOffset;this.cameraToCenterDistance=.5/Math.tan(this._fov/2)*this.height;var v=Math.PI/2+this._pitch,p=this._fov*(.5+h.y/this.height),g=Math.sin(p)*this.cameraToCenterDistance/Math.sin(_.clamp(Math.PI-v-p,.01,Math.PI-.01)),S=this.point,w=S.x,C=S.y,O=1.01*(Math.cos(Math.PI/2-this._pitch)*g+this.cameraToCenterDistance),X=this.height/50,J=new Float64Array(16);_.perspective(J,this._fov,this.width/this.height,X,O),J[8]=2*-h.x/this.width,J[9]=2*h.y/this.height,_.scale(J,J,[1,-1,1]),_.translate(J,J,[0,0,-this.cameraToCenterDistance]),_.rotateX(J,J,this._pitch),_.rotateZ(J,J,this.angle),_.translate(J,J,[-w,-C,0]),this.mercatorMatrix=_.scale([],J,[this.worldSize,this.worldSize,this.worldSize]),_.scale(J,J,[1,1,_.mercatorZfromAltitude(1,this.center.lat)*this.worldSize,1]),this.projMatrix=J,this.invProjMatrix=_.invert([],this.projMatrix);var me=this.width%2/2,ye=this.height%2/2,Ae=Math.cos(this.angle),Ve=Math.sin(this.angle),Ue=w-Math.round(w)+Ae*me+Ve*ye,lt=C-Math.round(C)+Ae*ye+Ve*me,Be=new Float64Array(J);if(_.translate(Be,Be,[Ue>.5?Ue-1:Ue,lt>.5?lt-1:lt,0]),this.alignedProjMatrix=Be,J=_.create(),_.scale(J,J,[this.width/2,-this.height/2,1]),_.translate(J,J,[1,-1,0]),this.labelPlaneMatrix=J,J=_.create(),_.scale(J,J,[1,-1,1]),_.translate(J,J,[-1,-1,0]),_.scale(J,J,[2/this.width,2/this.height,1]),this.glCoordMatrix=J,this.pixelMatrix=_.multiply(new Float64Array(16),this.labelPlaneMatrix,this.projMatrix),!(J=_.invert(new Float64Array(16),this.pixelMatrix)))throw new Error("failed to invert matrix");this.pixelMatrixInverse=J,this._posMatrixCache={},this._alignedPosMatrixCache={}}},Li.prototype.maxPitchScaleFactor=function(){if(!this.pixelMatrixInverse)return 1;var h=this.pointCoordinate(new _.Point(0,0)),v=[h.x*this.worldSize,h.y*this.worldSize,0,1];return _.transformMat4(v,v,this.pixelMatrix)[3]/this.cameraToCenterDistance},Li.prototype.getCameraPoint=function(){var h=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new _.Point(0,h))},Li.prototype.getCameraQueryGeometry=function(h){var v=this.getCameraPoint();if(h.length===1)return[h[0],v];for(var p=v.x,g=v.y,S=v.x,w=v.y,C=0,O=h;C<O.length;C+=1){var X=O[C];p=Math.min(p,X.x),g=Math.min(g,X.y),S=Math.max(S,X.x),w=Math.max(w,X.y)}return[new _.Point(p,g),new _.Point(S,g),new _.Point(S,w),new _.Point(p,w),new _.Point(p,g)]},Object.defineProperties(Li.prototype,va);var su=function(h){var v,p,g,S;this._hashName=h&&encodeURIComponent(h),_.bindAll(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=(v=this._updateHashUnthrottled.bind(this),p=!1,g=null,S=function(){g=null,p&&(v(),g=setTimeout(S,300),p=!1)},function(){return p=!0,g||S(),g})};su.prototype.addTo=function(h){return this._map=h,_.window.addEventListener("hashchange",this._onHashChange,!1),this._map.on("moveend",this._updateHash),this},su.prototype.remove=function(){return _.window.removeEventListener("hashchange",this._onHashChange,!1),this._map.off("moveend",this._updateHash),clearTimeout(this._updateHash()),delete this._map,this},su.prototype.getHashString=function(h){var v=this._map.getCenter(),p=Math.round(100*this._map.getZoom())/100,g=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),S=Math.pow(10,g),w=Math.round(v.lng*S)/S,C=Math.round(v.lat*S)/S,O=this._map.getBearing(),X=this._map.getPitch(),J="";if(J+=h?"/"+w+"/"+C+"/"+p:p+"/"+C+"/"+w,(O||X)&&(J+="/"+Math.round(10*O)/10),X&&(J+="/"+Math.round(X)),this._hashName){var me=this._hashName,ye=!1,Ae=_.window.location.hash.slice(1).split("&").map(function(Ve){var Ue=Ve.split("=")[0];return Ue===me?(ye=!0,Ue+"="+J):Ve}).filter(function(Ve){return Ve});return ye||Ae.push(me+"="+J),"#"+Ae.join("&")}return"#"+J},su.prototype._getCurrentHash=function(){var h,v=this,p=_.window.location.hash.replace("#","");return this._hashName?(p.split("&").map(function(g){return g.split("=")}).forEach(function(g){g[0]===v._hashName&&(h=g)}),(h&&h[1]||"").split("/")):p.split("/")},su.prototype._onHashChange=function(){var h=this._getCurrentHash();if(h.length>=3&&!h.some(function(p){return isNaN(p)})){var v=this._map.dragRotate.isEnabled()&&this._map.touchZoomRotate.isEnabled()?+(h[3]||0):this._map.getBearing();return this._map.jumpTo({center:[+h[2],+h[1]],zoom:+h[0],bearing:v,pitch:+(h[4]||0)}),!0}return!1},su.prototype._updateHashUnthrottled=function(){var h=_.window.location.href.replace(/(#.+)?$/,this.getHashString());try{_.window.history.replaceState(_.window.history.state,null,h)}catch(v){}};var tf={linearity:.3,easing:_.bezier(0,0,.3,1)},rf=_.extend({deceleration:2500,maxSpeed:1400},tf),Qs=_.extend({deceleration:20,maxSpeed:1400},tf),fp=_.extend({deceleration:1e3,maxSpeed:360},tf),kf=_.extend({deceleration:1e3,maxSpeed:90},tf),Df=function(h){this._map=h,this.clear()};function Jl(h,v){(!h.duration||h.duration<v.duration)&&(h.duration=v.duration,h.easing=v.easing)}function Co(h,v,p){var g=p.maxSpeed,S=p.linearity,w=p.deceleration,C=_.clamp(h*S/(v/1e3),-g,g),O=Math.abs(C)/(w*S);return{easing:p.easing,duration:1e3*O,amount:C*(O/2)}}Df.prototype.clear=function(){this._inertiaBuffer=[]},Df.prototype.record=function(h){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:_.browser.now(),settings:h})},Df.prototype._drainInertiaBuffer=function(){for(var h=this._inertiaBuffer,v=_.browser.now();h.length>0&&v-h[0].time>160;)h.shift()},Df.prototype._onMoveEnd=function(h){if(this._drainInertiaBuffer(),!(this._inertiaBuffer.length<2)){for(var v={zoom:0,bearing:0,pitch:0,pan:new _.Point(0,0),pinchAround:void 0,around:void 0},p=0,g=this._inertiaBuffer;p<g.length;p+=1){var S=g[p].settings;v.zoom+=S.zoomDelta||0,v.bearing+=S.bearingDelta||0,v.pitch+=S.pitchDelta||0,S.panDelta&&v.pan._add(S.panDelta),S.around&&(v.around=S.around),S.pinchAround&&(v.pinchAround=S.pinchAround)}var w=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,C={};if(v.pan.mag()){var O=Co(v.pan.mag(),w,_.extend({},rf,h||{}));C.offset=v.pan.mult(O.amount/v.pan.mag()),C.center=this._map.transform.center,Jl(C,O)}if(v.zoom){var X=Co(v.zoom,w,Qs);C.zoom=this._map.transform.zoom+X.amount,Jl(C,X)}if(v.bearing){var J=Co(v.bearing,w,fp);C.bearing=this._map.transform.bearing+_.clamp(J.amount,-179,179),Jl(C,J)}if(v.pitch){var me=Co(v.pitch,w,kf);C.pitch=this._map.transform.pitch+me.amount,Jl(C,me)}if(C.zoom||C.bearing){var ye=v.pinchAround===void 0?v.around:v.pinchAround;C.around=ye?this._map.unproject(ye):this._map.getCenter()}return this.clear(),_.extend(C,{noMoveStart:!0})}};var ja=function(h){function v(g,S,w,C){C===void 0&&(C={});var O=Z.mousePos(S.getCanvasContainer(),w),X=S.unproject(O);h.call(this,g,_.extend({point:O,lngLat:X,originalEvent:w},C)),this._defaultPrevented=!1,this.target=S}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,p),v}(_.Event),nf=function(h){function v(g,S,w){var C=g==="touchend"?w.changedTouches:w.touches,O=Z.touchPos(S.getCanvasContainer(),C),X=O.map(function(ye){return S.unproject(ye)}),J=O.reduce(function(ye,Ae,Ve,Ue){return ye.add(Ae.div(Ue.length))},new _.Point(0,0)),me=S.unproject(J);h.call(this,g,{points:O,point:J,lngLats:X,lngLat:me,originalEvent:w}),this._defaultPrevented=!1}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,p),v}(_.Event),Ac=function(h){function v(g,S,w){h.call(this,g,{originalEvent:w}),this._defaultPrevented=!1}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={defaultPrevented:{configurable:!0}};return v.prototype.preventDefault=function(){this._defaultPrevented=!0},p.defaultPrevented.get=function(){return this._defaultPrevented},Object.defineProperties(v.prototype,p),v}(_.Event),io=function(h,v){this._map=h,this._clickTolerance=v.clickTolerance};io.prototype.reset=function(){delete this._mousedownPos},io.prototype.wheel=function(h){return this._firePreventable(new Ac(h.type,this._map,h))},io.prototype.mousedown=function(h,v){return this._mousedownPos=v,this._firePreventable(new ja(h.type,this._map,h))},io.prototype.mouseup=function(h){this._map.fire(new ja(h.type,this._map,h))},io.prototype.click=function(h,v){this._mousedownPos&&this._mousedownPos.dist(v)>=this._clickTolerance||this._map.fire(new ja(h.type,this._map,h))},io.prototype.dblclick=function(h){return this._firePreventable(new ja(h.type,this._map,h))},io.prototype.mouseover=function(h){this._map.fire(new ja(h.type,this._map,h))},io.prototype.mouseout=function(h){this._map.fire(new ja(h.type,this._map,h))},io.prototype.touchstart=function(h){return this._firePreventable(new nf(h.type,this._map,h))},io.prototype.touchmove=function(h){this._map.fire(new nf(h.type,this._map,h))},io.prototype.touchend=function(h){this._map.fire(new nf(h.type,this._map,h))},io.prototype.touchcancel=function(h){this._map.fire(new nf(h.type,this._map,h))},io.prototype._firePreventable=function(h){if(this._map.fire(h),h.defaultPrevented)return{}},io.prototype.isEnabled=function(){return!0},io.prototype.isActive=function(){return!1},io.prototype.enable=function(){},io.prototype.disable=function(){};var xn=function(h){this._map=h};xn.prototype.reset=function(){this._delayContextMenu=!1,delete this._contextMenuEvent},xn.prototype.mousemove=function(h){this._map.fire(new ja(h.type,this._map,h))},xn.prototype.mousedown=function(){this._delayContextMenu=!0},xn.prototype.mouseup=function(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ja("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)},xn.prototype.contextmenu=function(h){this._delayContextMenu?this._contextMenuEvent=h:this._map.fire(new ja(h.type,this._map,h)),this._map.listens("contextmenu")&&h.preventDefault()},xn.prototype.isEnabled=function(){return!0},xn.prototype.isActive=function(){return!1},xn.prototype.enable=function(){},xn.prototype.disable=function(){};var ms=function(h,v){this._map=h,this._el=h.getCanvasContainer(),this._container=h.getContainer(),this._clickTolerance=v.clickTolerance||1};function Lf(h,v){for(var p={},g=0;g<h.length;g++)p[h[g].identifier]=v[g];return p}ms.prototype.isEnabled=function(){return!!this._enabled},ms.prototype.isActive=function(){return!!this._active},ms.prototype.enable=function(){this.isEnabled()||(this._enabled=!0)},ms.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},ms.prototype.mousedown=function(h,v){this.isEnabled()&&h.shiftKey&&h.button===0&&(Z.disableDrag(),this._startPos=this._lastPos=v,this._active=!0)},ms.prototype.mousemoveWindow=function(h,v){if(this._active){var p=v;if(!(this._lastPos.equals(p)||!this._box&&p.dist(this._startPos)<this._clickTolerance)){var g=this._startPos;this._lastPos=p,this._box||(this._box=Z.create("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",h));var S=Math.min(g.x,p.x),w=Math.max(g.x,p.x),C=Math.min(g.y,p.y),O=Math.max(g.y,p.y);Z.setTransform(this._box,"translate("+S+"px,"+C+"px)"),this._box.style.width=w-S+"px",this._box.style.height=O-C+"px"}}},ms.prototype.mouseupWindow=function(h,v){var p=this;if(this._active&&h.button===0){var g=this._startPos,S=v;if(this.reset(),Z.suppressClick(),g.x!==S.x||g.y!==S.y)return this._map.fire(new _.Event("boxzoomend",{originalEvent:h})),{cameraAnimation:function(w){return w.fitScreenCoordinates(g,S,p._map.getBearing(),{linear:!0})}};this._fireEvent("boxzoomcancel",h)}},ms.prototype.keydown=function(h){this._active&&h.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",h))},ms.prototype.blur=function(){this.reset()},ms.prototype.reset=function(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(Z.remove(this._box),this._box=null),Z.enableDrag(),delete this._startPos,delete this._lastPos},ms.prototype._fireEvent=function(h,v){return this._map.fire(new _.Event(h,{originalEvent:v}))};var Tc=function(h){this.reset(),this.numTouches=h.numTouches};Tc.prototype.reset=function(){delete this.centroid,delete this.startTime,delete this.touches,this.aborted=!1},Tc.prototype.touchstart=function(h,v,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===void 0&&(this.startTime=h.timeStamp),p.length===this.numTouches&&(this.centroid=function(g){for(var S=new _.Point(0,0),w=0,C=g;w<C.length;w+=1)S._add(C[w]);return S.div(g.length)}(v),this.touches=Lf(p,v)))},Tc.prototype.touchmove=function(h,v,p){if(!this.aborted&&this.centroid){var g=Lf(p,v);for(var S in this.touches){var w=g[S];(!w||w.dist(this.touches[S])>30)&&(this.aborted=!0)}}},Tc.prototype.touchend=function(h,v,p){if((!this.centroid||h.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){var g=!this.aborted&&this.centroid;if(this.reset(),g)return g}};var is=function(h){this.singleTap=new Tc(h),this.numTaps=h.numTaps,this.reset()};is.prototype.reset=function(){this.lastTime=1/0,delete this.lastTap,this.count=0,this.singleTap.reset()},is.prototype.touchstart=function(h,v,p){this.singleTap.touchstart(h,v,p)},is.prototype.touchmove=function(h,v,p){this.singleTap.touchmove(h,v,p)},is.prototype.touchend=function(h,v,p){var g=this.singleTap.touchend(h,v,p);if(g){var S=h.timeStamp-this.lastTime<500,w=!this.lastTap||this.lastTap.dist(g)<30;if(S&&w||this.reset(),this.count++,this.lastTime=h.timeStamp,this.lastTap=g,this.count===this.numTaps)return this.reset(),g}};var ha=function(){this._zoomIn=new is({numTouches:1,numTaps:2}),this._zoomOut=new is({numTouches:2,numTaps:1}),this.reset()};ha.prototype.reset=function(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()},ha.prototype.touchstart=function(h,v,p){this._zoomIn.touchstart(h,v,p),this._zoomOut.touchstart(h,v,p)},ha.prototype.touchmove=function(h,v,p){this._zoomIn.touchmove(h,v,p),this._zoomOut.touchmove(h,v,p)},ha.prototype.touchend=function(h,v,p){var g=this,S=this._zoomIn.touchend(h,v,p),w=this._zoomOut.touchend(h,v,p);return S?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(C){return C.easeTo({duration:300,zoom:C.getZoom()+1,around:C.unproject(S)},{originalEvent:h})}}):w?(this._active=!0,h.preventDefault(),setTimeout(function(){return g.reset()},0),{cameraAnimation:function(C){return C.easeTo({duration:300,zoom:C.getZoom()-1,around:C.unproject(w)},{originalEvent:h})}}):void 0},ha.prototype.touchcancel=function(){this.reset()},ha.prototype.enable=function(){this._enabled=!0},ha.prototype.disable=function(){this._enabled=!1,this.reset()},ha.prototype.isEnabled=function(){return this._enabled},ha.prototype.isActive=function(){return this._active};var Bf={0:1,2:2},an=function(h){this.reset(),this._clickTolerance=h.clickTolerance||1};an.prototype.blur=function(){this.reset()},an.prototype.reset=function(){this._active=!1,this._moved=!1,delete this._lastPoint,delete this._eventButton},an.prototype._correctButton=function(h,v){return!1},an.prototype._move=function(h,v){return{}},an.prototype.mousedown=function(h,v){if(!this._lastPoint){var p=Z.mouseButton(h);this._correctButton(h,p)&&(this._lastPoint=v,this._eventButton=p)}},an.prototype.mousemoveWindow=function(h,v){var p=this._lastPoint;if(p){if(h.preventDefault(),function(g,S){var w=Bf[S];return g.buttons===void 0||(g.buttons&w)!==w}(h,this._eventButton))this.reset();else if(this._moved||!(v.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=v,this._move(p,v)}},an.prototype.mouseupWindow=function(h){this._lastPoint&&Z.mouseButton(h)===this._eventButton&&(this._moved&&Z.suppressClick(),this.reset())},an.prototype.enable=function(){this._enabled=!0},an.prototype.disable=function(){this._enabled=!1,this.reset()},an.prototype.isEnabled=function(){return this._enabled},an.prototype.isActive=function(){return this._active};var ll=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.mousedown=function(p,g){h.prototype.mousedown.call(this,p,g),this._lastPoint&&(this._active=!0)},v.prototype._correctButton=function(p,g){return g===0&&!p.ctrlKey},v.prototype._move=function(p,g){return{around:g,panDelta:g.sub(p)}},v}(an),af=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype._correctButton=function(p,g){return g===0&&p.ctrlKey||g===2},v.prototype._move=function(p,g){var S=.8*(g.x-p.x);if(S)return this._active=!0,{bearingDelta:S}},v.prototype.contextmenu=function(p){p.preventDefault()},v}(an),of=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype._correctButton=function(p,g){return g===0&&p.ctrlKey||g===2},v.prototype._move=function(p,g){var S=-.5*(g.y-p.y);if(S)return this._active=!0,{pitchDelta:S}},v.prototype.contextmenu=function(p){p.preventDefault()},v}(an),_u=function(h){this._minTouches=1,this._clickTolerance=h.clickTolerance||1,this.reset()};_u.prototype.reset=function(){this._active=!1,this._touches={},this._sum=new _.Point(0,0)},_u.prototype.touchstart=function(h,v,p){return this._calculateTransform(h,v,p)},_u.prototype.touchmove=function(h,v,p){if(this._active&&!(p.length<this._minTouches))return h.preventDefault(),this._calculateTransform(h,v,p)},_u.prototype.touchend=function(h,v,p){this._calculateTransform(h,v,p),this._active&&p.length<this._minTouches&&this.reset()},_u.prototype.touchcancel=function(){this.reset()},_u.prototype._calculateTransform=function(h,v,p){p.length>0&&(this._active=!0);var g=Lf(p,v),S=new _.Point(0,0),w=new _.Point(0,0),C=0;for(var O in g){var X=g[O],J=this._touches[O];J&&(S._add(X),w._add(X.sub(J)),C++,g[O]=X)}if(this._touches=g,!(C<this._minTouches)&&w.mag()){var me=w.div(C);if(this._sum._add(me),!(this._sum.mag()<this._clickTolerance))return{around:S.div(C),panDelta:me}}},_u.prototype.enable=function(){this._enabled=!0},_u.prototype.disable=function(){this._enabled=!1,this.reset()},_u.prototype.isEnabled=function(){return this._enabled},_u.prototype.isActive=function(){return this._active};var Us=function(){this.reset()};function Ff(h,v,p){for(var g=0;g<h.length;g++)if(h[g].identifier===p)return v[g]}function Nf(h,v){return Math.log(h/v)/Math.LN2}Us.prototype.reset=function(){this._active=!1,delete this._firstTwoTouches},Us.prototype._start=function(h){},Us.prototype._move=function(h,v,p){return{}},Us.prototype.touchstart=function(h,v,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([v[0],v[1]]))},Us.prototype.touchmove=function(h,v,p){if(this._firstTwoTouches){h.preventDefault();var g=this._firstTwoTouches,S=g[1],w=Ff(p,v,g[0]),C=Ff(p,v,S);if(w&&C){var O=this._aroundCenter?null:w.add(C).div(2);return this._move([w,C],O,h)}}},Us.prototype.touchend=function(h,v,p){if(this._firstTwoTouches){var g=this._firstTwoTouches,S=g[1],w=Ff(p,v,g[0]),C=Ff(p,v,S);w&&C||(this._active&&Z.suppressClick(),this.reset())}},Us.prototype.touchcancel=function(){this.reset()},Us.prototype.enable=function(h){this._enabled=!0,this._aroundCenter=!!h&&h.around==="center"},Us.prototype.disable=function(){this._enabled=!1,this.reset()},Us.prototype.isEnabled=function(){return this._enabled},Us.prototype.isActive=function(){return this._active};var gs=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),delete this._distance,delete this._startDistance},v.prototype._start=function(p){this._startDistance=this._distance=p[0].dist(p[1])},v.prototype._move=function(p,g){var S=this._distance;if(this._distance=p[0].dist(p[1]),this._active||!(Math.abs(Nf(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Nf(this._distance,S),pinchAround:g}},v}(Us);function yu(h,v){return 180*h.angleWith(v)/Math.PI}var hp=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),delete this._minDiameter,delete this._startVector,delete this._vector},v.prototype._start=function(p){this._startVector=this._vector=p[0].sub(p[1]),this._minDiameter=p[0].dist(p[1])},v.prototype._move=function(p,g){var S=this._vector;if(this._vector=p[0].sub(p[1]),this._active||!this._isBelowThreshold(this._vector))return this._active=!0,{bearingDelta:yu(this._vector,S),pinchAround:g}},v.prototype._isBelowThreshold=function(p){this._minDiameter=Math.min(this._minDiameter,p.mag());var g=25/(Math.PI*this._minDiameter)*360,S=yu(p,this._startVector);return Math.abs(S)<g},v}(Us);function wc(h){return Math.abs(h.y)>Math.abs(h.x)}var Cc=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.reset=function(){h.prototype.reset.call(this),this._valid=void 0,delete this._firstMove,delete this._lastPoints},v.prototype._start=function(p){this._lastPoints=p,wc(p[0].sub(p[1]))&&(this._valid=!1)},v.prototype._move=function(p,g,S){var w=p[0].sub(this._lastPoints[0]),C=p[1].sub(this._lastPoints[1]);if(this._valid=this.gestureBeginsVertically(w,C,S.timeStamp),this._valid)return this._lastPoints=p,this._active=!0,{pitchDelta:(w.y+C.y)/2*-.5}},v.prototype.gestureBeginsVertically=function(p,g,S){if(this._valid!==void 0)return this._valid;var w=p.mag()>=2,C=g.mag()>=2;if(w||C){if(!w||!C)return this._firstMove===void 0&&(this._firstMove=S),S-this._firstMove<100&&void 0;var O=p.y>0==g.y>0;return wc(p)&&wc(g)&&O}},v}(Us),Uf={panStep:100,bearingStep:15,pitchStep:10},Js=function(){var h=Uf;this._panStep=h.panStep,this._bearingStep=h.bearingStep,this._pitchStep=h.pitchStep,this._rotationDisabled=!1};function Zt(h){return h*(2-h)}Js.prototype.blur=function(){this.reset()},Js.prototype.reset=function(){this._active=!1},Js.prototype.keydown=function(h){var v=this;if(!(h.altKey||h.ctrlKey||h.metaKey)){var p=0,g=0,S=0,w=0,C=0;switch(h.keyCode){case 61:case 107:case 171:case 187:p=1;break;case 189:case 109:case 173:p=-1;break;case 37:h.shiftKey?g=-1:(h.preventDefault(),w=-1);break;case 39:h.shiftKey?g=1:(h.preventDefault(),w=1);break;case 38:h.shiftKey?S=1:(h.preventDefault(),C=-1);break;case 40:h.shiftKey?S=-1:(h.preventDefault(),C=1);break;default:return}return this._rotationDisabled&&(g=0,S=0),{cameraAnimation:function(O){var X=O.getZoom();O.easeTo({duration:300,easeId:"keyboardHandler",easing:Zt,zoom:p?Math.round(X)+p*(h.shiftKey?2:1):X,bearing:O.getBearing()+g*v._bearingStep,pitch:O.getPitch()+S*v._pitchStep,offset:[-w*v._panStep,-C*v._panStep],center:O.getCenter()},{originalEvent:h})}}}},Js.prototype.enable=function(){this._enabled=!0},Js.prototype.disable=function(){this._enabled=!1,this.reset()},Js.prototype.isEnabled=function(){return this._enabled},Js.prototype.isActive=function(){return this._active},Js.prototype.disableRotation=function(){this._rotationDisabled=!0},Js.prototype.enableRotation=function(){this._rotationDisabled=!1};var Re=function(h,v){this._map=h,this._el=h.getCanvasContainer(),this._handler=v,this._delta=0,this._defaultZoomRate=.01,this._wheelZoomRate=1/450,_.bindAll(["_onTimeout"],this)};Re.prototype.setZoomRate=function(h){this._defaultZoomRate=h},Re.prototype.setWheelZoomRate=function(h){this._wheelZoomRate=h},Re.prototype.isEnabled=function(){return!!this._enabled},Re.prototype.isActive=function(){return!!this._active||this._finishTimeout!==void 0},Re.prototype.isZooming=function(){return!!this._zooming},Re.prototype.enable=function(h){this.isEnabled()||(this._enabled=!0,this._aroundCenter=h&&h.around==="center")},Re.prototype.disable=function(){this.isEnabled()&&(this._enabled=!1)},Re.prototype.wheel=function(h){if(this.isEnabled()){var v=h.deltaMode===_.window.WheelEvent.DOM_DELTA_LINE?40*h.deltaY:h.deltaY,p=_.browser.now(),g=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,v!==0&&v%4.000244140625==0?this._type="wheel":v!==0&&Math.abs(v)<4?this._type="trackpad":g>400?(this._type=null,this._lastValue=v,this._timeout=setTimeout(this._onTimeout,40,h)):this._type||(this._type=Math.abs(g*v)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,v+=this._lastValue)),h.shiftKey&&v&&(v/=4),this._type&&(this._lastWheelEvent=h,this._delta-=v,this._active||this._start(h)),h.preventDefault()}},Re.prototype._onTimeout=function(h){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(h)},Re.prototype._start=function(h){if(this._delta){this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);var v=Z.mousePos(this._el,h);this._around=_.LngLat.convert(this._aroundCenter?this._map.getCenter():this._map.unproject(v)),this._aroundPoint=this._map.transform.locationPoint(this._around),this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}},Re.prototype.renderFrame=function(){var h=this;if(this._frameId&&(this._frameId=null,this.isActive())){var v=this._map.transform;if(this._delta!==0){var p=this._type==="wheel"&&Math.abs(this._delta)>4.000244140625?this._wheelZoomRate:this._defaultZoomRate,g=2/(1+Math.exp(-Math.abs(this._delta*p)));this._delta<0&&g!==0&&(g=1/g);var S=typeof this._targetZoom=="number"?v.zoomScale(this._targetZoom):v.scale;this._targetZoom=Math.min(v.maxZoom,Math.max(v.minZoom,v.scaleZoom(S*g))),this._type==="wheel"&&(this._startZoom=v.zoom,this._easing=this._smoothOutEasing(200)),this._delta=0}var w,C=typeof this._targetZoom=="number"?this._targetZoom:v.zoom,O=this._startZoom,X=this._easing,J=!1;if(this._type==="wheel"&&O&&X){var me=Math.min((_.browser.now()-this._lastWheelEventTime)/200,1),ye=X(me);w=_.number(O,C,ye),me<1?this._frameId||(this._frameId=!0):J=!0}else w=C,J=!0;return this._active=!0,J&&(this._active=!1,this._finishTimeout=setTimeout(function(){h._zooming=!1,h._handler._triggerRenderFrame(),delete h._targetZoom,delete h._finishTimeout},200)),{noInertia:!0,needsRenderFrame:!J,zoomDelta:w-v.zoom,around:this._aroundPoint,originalEvent:this._lastWheelEvent}}},Re.prototype._smoothOutEasing=function(h){var v=_.ease;if(this._prevEase){var p=this._prevEase,g=(_.browser.now()-p.start)/p.duration,S=p.easing(g+.01)-p.easing(g),w=.27/Math.sqrt(S*S+1e-4)*.01,C=Math.sqrt(.0729-w*w);v=_.bezier(w,C,.25,1)}return this._prevEase={start:_.browser.now(),duration:h,easing:v},v},Re.prototype.blur=function(){this.reset()},Re.prototype.reset=function(){this._active=!1};var F=function(h,v){this._clickZoom=h,this._tapZoom=v};F.prototype.enable=function(){this._clickZoom.enable(),this._tapZoom.enable()},F.prototype.disable=function(){this._clickZoom.disable(),this._tapZoom.disable()},F.prototype.isEnabled=function(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()},F.prototype.isActive=function(){return this._clickZoom.isActive()||this._tapZoom.isActive()};var eu=function(){this.reset()};eu.prototype.reset=function(){this._active=!1},eu.prototype.blur=function(){this.reset()},eu.prototype.dblclick=function(h,v){return h.preventDefault(),{cameraAnimation:function(p){p.easeTo({duration:300,zoom:p.getZoom()+(h.shiftKey?-1:1),around:p.unproject(v)},{originalEvent:h})}}},eu.prototype.enable=function(){this._enabled=!0},eu.prototype.disable=function(){this._enabled=!1,this.reset()},eu.prototype.isEnabled=function(){return this._enabled},eu.prototype.isActive=function(){return this._active};var _e=function(){this._tap=new is({numTouches:1,numTaps:1}),this.reset()};_e.prototype.reset=function(){this._active=!1,delete this._swipePoint,delete this._swipeTouch,delete this._tapTime,this._tap.reset()},_e.prototype.touchstart=function(h,v,p){this._swipePoint||(this._tapTime&&h.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=v[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(h,v,p))},_e.prototype.touchmove=function(h,v,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;var g=v[0],S=g.y-this._swipePoint.y;return this._swipePoint=g,h.preventDefault(),this._active=!0,{zoomDelta:S/128}}}else this._tap.touchmove(h,v,p)},_e.prototype.touchend=function(h,v,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(h,v,p)&&(this._tapTime=h.timeStamp)},_e.prototype.touchcancel=function(){this.reset()},_e.prototype.enable=function(){this._enabled=!0},_e.prototype.disable=function(){this._enabled=!1,this.reset()},_e.prototype.isEnabled=function(){return this._enabled},_e.prototype.isActive=function(){return this._active};var Pl=function(h,v,p){this._el=h,this._mousePan=v,this._touchPan=p};Pl.prototype.enable=function(h){this._inertiaOptions=h||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")},Pl.prototype.disable=function(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")},Pl.prototype.isEnabled=function(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()},Pl.prototype.isActive=function(){return this._mousePan.isActive()||this._touchPan.isActive()};var qa=function(h,v,p){this._pitchWithRotate=h.pitchWithRotate,this._mouseRotate=v,this._mousePitch=p};qa.prototype.enable=function(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()},qa.prototype.disable=function(){this._mouseRotate.disable(),this._mousePitch.disable()},qa.prototype.isEnabled=function(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())},qa.prototype.isActive=function(){return this._mouseRotate.isActive()||this._mousePitch.isActive()};var zs=function(h,v,p,g){this._el=h,this._touchZoom=v,this._touchRotate=p,this._tapDragZoom=g,this._rotationDisabled=!1,this._enabled=!0};zs.prototype.enable=function(h){this._touchZoom.enable(h),this._rotationDisabled||this._touchRotate.enable(h),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")},zs.prototype.disable=function(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")},zs.prototype.isEnabled=function(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()},zs.prototype.isActive=function(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()},zs.prototype.disableRotation=function(){this._rotationDisabled=!0,this._touchRotate.disable()},zs.prototype.enableRotation=function(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()};var Ro=function(h){return h.zoom||h.drag||h.pitch||h.rotate},_s=function(h){function v(){h.apply(this,arguments)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v}(_.Event);function Dn(h){return h.panDelta&&h.panDelta.mag()||h.zoomDelta||h.bearingDelta||h.pitchDelta}var An=function(h,v){this._map=h,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Df(h),this._bearingSnap=v.bearingSnap,this._previousActiveHandlers={},this._eventsInProgress={},this._addDefaultHandlers(v),_.bindAll(["handleEvent","handleWindowEvent"],this);var p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[_.window.document,"mousemove",{capture:!0}],[_.window.document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[_.window,"blur",void 0]];for(var g=0,S=this._listeners;g<S.length;g+=1){var w=S[g],C=w[0];Z.addEventListener(C,w[1],C===_.window.document?this.handleWindowEvent:this.handleEvent,w[2])}};An.prototype.destroy=function(){for(var h=0,v=this._listeners;h<v.length;h+=1){var p=v[h],g=p[0];Z.removeEventListener(g,p[1],g===_.window.document?this.handleWindowEvent:this.handleEvent,p[2])}},An.prototype._addDefaultHandlers=function(h){var v=this._map,p=v.getCanvasContainer();this._add("mapEvent",new io(v,h));var g=v.boxZoom=new ms(v,h);this._add("boxZoom",g);var S=new ha,w=new eu;v.doubleClickZoom=new F(w,S),this._add("tapZoom",S),this._add("clickZoom",w);var C=new _e;this._add("tapDragZoom",C);var O=v.touchPitch=new Cc;this._add("touchPitch",O);var X=new af(h),J=new of(h);v.dragRotate=new qa(h,X,J),this._add("mouseRotate",X,["mousePitch"]),this._add("mousePitch",J,["mouseRotate"]);var me=new ll(h),ye=new _u(h);v.dragPan=new Pl(p,me,ye),this._add("mousePan",me),this._add("touchPan",ye,["touchZoom","touchRotate"]);var Ae=new hp,Ve=new gs;v.touchZoomRotate=new zs(p,Ve,Ae,C),this._add("touchRotate",Ae,["touchPan","touchZoom"]),this._add("touchZoom",Ve,["touchPan","touchRotate"]);var Ue=v.scrollZoom=new Re(v,this);this._add("scrollZoom",Ue,["mousePan"]);var lt=v.keyboard=new Js;this._add("keyboard",lt),this._add("blockableMapEvent",new xn(v));for(var Be=0,st=["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"];Be<st.length;Be+=1){var xt=st[Be];h.interactive&&h[xt]&&v[xt].enable(h[xt])}},An.prototype._add=function(h,v,p){this._handlers.push({handlerName:h,handler:v,allowed:p}),this._handlersById[h]=v},An.prototype.stop=function(h){if(!this._updatingCamera){for(var v=0,p=this._handlers;v<p.length;v+=1)p[v].handler.reset();this._inertia.clear(),this._fireEvents({},{},h),this._changes=[]}},An.prototype.isActive=function(){for(var h=0,v=this._handlers;h<v.length;h+=1)if(v[h].handler.isActive())return!0;return!1},An.prototype.isZooming=function(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()},An.prototype.isRotating=function(){return!!this._eventsInProgress.rotate},An.prototype.isMoving=function(){return!!Ro(this._eventsInProgress)||this.isZooming()},An.prototype._blockedByActive=function(h,v,p){for(var g in h)if(g!==p&&(!v||v.indexOf(g)<0))return!0;return!1},An.prototype.handleWindowEvent=function(h){this.handleEvent(h,h.type+"Window")},An.prototype._getMapTouches=function(h){for(var v=[],p=0,g=h;p<g.length;p+=1){var S=g[p];this._el.contains(S.target)&&v.push(S)}return v},An.prototype.handleEvent=function(h,v){this._updatingCamera=!0;for(var p=h.type==="renderFrame"?void 0:h,g={needsRenderFrame:!1},S={},w={},C=h.touches?this._getMapTouches(h.touches):void 0,O=C?Z.touchPos(this._el,C):Z.mousePos(this._el,h),X=0,J=this._handlers;X<J.length;X+=1){var me=J[X],ye=me.handlerName,Ae=me.handler,Ve=me.allowed;if(Ae.isEnabled()){var Ue=void 0;this._blockedByActive(w,Ve,ye)?Ae.reset():Ae[v||h.type]&&(Ue=Ae[v||h.type](h,O,C),this.mergeHandlerResult(g,S,Ue,ye,p),Ue&&Ue.needsRenderFrame&&this._triggerRenderFrame()),(Ue||Ae.isActive())&&(w[ye]=Ae)}}var lt={};for(var Be in this._previousActiveHandlers)w[Be]||(lt[Be]=p);this._previousActiveHandlers=w,(Object.keys(lt).length||Dn(g))&&(this._changes.push([g,S,lt]),this._triggerRenderFrame()),(Object.keys(w).length||Dn(g))&&this._map._stop(!0),this._updatingCamera=!1;var st=g.cameraAnimation;st&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],st(this._map))},An.prototype.mergeHandlerResult=function(h,v,p,g,S){if(p){_.extend(h,p);var w={handlerName:g,originalEvent:p.originalEvent||S};p.zoomDelta!==void 0&&(v.zoom=w),p.panDelta!==void 0&&(v.drag=w),p.pitchDelta!==void 0&&(v.pitch=w),p.bearingDelta!==void 0&&(v.rotate=w)}},An.prototype._applyChanges=function(){for(var h={},v={},p={},g=0,S=this._changes;g<S.length;g+=1){var w=S[g],C=w[0],O=w[1],X=w[2];C.panDelta&&(h.panDelta=(h.panDelta||new _.Point(0,0))._add(C.panDelta)),C.zoomDelta&&(h.zoomDelta=(h.zoomDelta||0)+C.zoomDelta),C.bearingDelta&&(h.bearingDelta=(h.bearingDelta||0)+C.bearingDelta),C.pitchDelta&&(h.pitchDelta=(h.pitchDelta||0)+C.pitchDelta),C.around!==void 0&&(h.around=C.around),C.pinchAround!==void 0&&(h.pinchAround=C.pinchAround),C.noInertia&&(h.noInertia=C.noInertia),_.extend(v,O),_.extend(p,X)}this._updateMapTransform(h,v,p),this._changes=[]},An.prototype._updateMapTransform=function(h,v,p){var g=this._map,S=g.transform;if(!Dn(h))return this._fireEvents(v,p,!0);var w=h.panDelta,C=h.zoomDelta,O=h.bearingDelta,X=h.pitchDelta,J=h.around,me=h.pinchAround;me!==void 0&&(J=me),g._stop(!0),J=J||g.transform.centerPoint;var ye=S.pointLocation(w?J.sub(w):J);O&&(S.bearing+=O),X&&(S.pitch+=X),C&&(S.zoom+=C),S.setLocationAtPoint(ye,J),this._map._update(),h.noInertia||this._inertia.record(h),this._fireEvents(v,p,!0)},An.prototype._fireEvents=function(h,v,p){var g=this,S=Ro(this._eventsInProgress),w=Ro(h),C={};for(var O in h)this._eventsInProgress[O]||(C[O+"start"]=h[O].originalEvent),this._eventsInProgress[O]=h[O];for(var X in!S&&w&&this._fireEvent("movestart",w.originalEvent),C)this._fireEvent(X,C[X]);for(var J in w&&this._fireEvent("move",w.originalEvent),h)this._fireEvent(J,h[J].originalEvent);var me,ye={};for(var Ae in this._eventsInProgress){var Ve=this._eventsInProgress[Ae],Ue=Ve.handlerName,lt=Ve.originalEvent;this._handlersById[Ue].isActive()||(delete this._eventsInProgress[Ae],ye[Ae+"end"]=me=v[Ue]||lt)}for(var Be in ye)this._fireEvent(Be,ye[Be]);var st=Ro(this._eventsInProgress);if(p&&(S||w)&&!st){this._updatingCamera=!0;var xt=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),Ut=function(ar){return ar!==0&&-g._bearingSnap<ar&&ar<g._bearingSnap};xt?(Ut(xt.bearing||this._map.getBearing())&&(xt.bearing=0),this._map.easeTo(xt,{originalEvent:me})):(this._map.fire(new _.Event("moveend",{originalEvent:me})),Ut(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}},An.prototype._fireEvent=function(h,v){this._map.fire(new _.Event(h,v?{originalEvent:v}:{}))},An.prototype._requestFrame=function(){var h=this;return this._map.triggerRepaint(),this._map._renderTaskQueue.add(function(v){delete h._frameId,h.handleEvent(new _s("renderFrame",{timeStamp:v})),h._applyChanges()})},An.prototype._triggerRenderFrame=function(){this._frameId===void 0&&(this._frameId=this._requestFrame())};var as=function(h){function v(p,g){h.call(this),this._moving=!1,this._zooming=!1,this.transform=p,this._bearingSnap=g.bearingSnap,_.bindAll(["_renderFrameCallback"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.getCenter=function(){return new _.LngLat(this.transform.center.lng,this.transform.center.lat)},v.prototype.setCenter=function(p,g){return this.jumpTo({center:p},g)},v.prototype.panBy=function(p,g,S){return p=_.Point.convert(p).mult(-1),this.panTo(this.transform.center,_.extend({offset:p},g),S)},v.prototype.panTo=function(p,g,S){return this.easeTo(_.extend({center:p},g),S)},v.prototype.getZoom=function(){return this.transform.zoom},v.prototype.setZoom=function(p,g){return this.jumpTo({zoom:p},g),this},v.prototype.zoomTo=function(p,g,S){return this.easeTo(_.extend({zoom:p},g),S)},v.prototype.zoomIn=function(p,g){return this.zoomTo(this.getZoom()+1,p,g),this},v.prototype.zoomOut=function(p,g){return this.zoomTo(this.getZoom()-1,p,g),this},v.prototype.getBearing=function(){return this.transform.bearing},v.prototype.setBearing=function(p,g){return this.jumpTo({bearing:p},g),this},v.prototype.getPadding=function(){return this.transform.padding},v.prototype.setPadding=function(p,g){return this.jumpTo({padding:p},g),this},v.prototype.rotateTo=function(p,g,S){return this.easeTo(_.extend({bearing:p},g),S)},v.prototype.resetNorth=function(p,g){return this.rotateTo(0,_.extend({duration:1e3},p),g),this},v.prototype.resetNorthPitch=function(p,g){return this.easeTo(_.extend({bearing:0,pitch:0,duration:1e3},p),g),this},v.prototype.snapToNorth=function(p,g){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(p,g):this},v.prototype.getPitch=function(){return this.transform.pitch},v.prototype.setPitch=function(p,g){return this.jumpTo({pitch:p},g),this},v.prototype.cameraForBounds=function(p,g){p=_.LngLatBounds.convert(p);var S=g&&g.bearing||0;return this._cameraForBoxAndBearing(p.getNorthWest(),p.getSouthEast(),S,g)},v.prototype._cameraForBoxAndBearing=function(p,g,S,w){var C={top:0,bottom:0,right:0,left:0};if(typeof(w=_.extend({padding:C,offset:[0,0],maxZoom:this.transform.maxZoom},w)).padding=="number"){var O=w.padding;w.padding={top:O,bottom:O,right:O,left:O}}w.padding=_.extend(C,w.padding);var X=this.transform,J=X.padding,me=X.project(_.LngLat.convert(p)),ye=X.project(_.LngLat.convert(g)),Ae=me.rotate(-S*Math.PI/180),Ve=ye.rotate(-S*Math.PI/180),Ue=new _.Point(Math.max(Ae.x,Ve.x),Math.max(Ae.y,Ve.y)),lt=new _.Point(Math.min(Ae.x,Ve.x),Math.min(Ae.y,Ve.y)),Be=Ue.sub(lt),st=(X.width-(J.left+J.right+w.padding.left+w.padding.right))/Be.x,xt=(X.height-(J.top+J.bottom+w.padding.top+w.padding.bottom))/Be.y;if(!(xt<0||st<0)){var Ut=Math.min(X.scaleZoom(X.scale*Math.min(st,xt)),w.maxZoom),ar=typeof w.offset.x=="number"?new _.Point(w.offset.x,w.offset.y):_.Point.convert(w.offset),qt=new _.Point((w.padding.left-w.padding.right)/2,(w.padding.top-w.padding.bottom)/2).rotate(S*Math.PI/180),fr=ar.add(qt).mult(X.scale/X.zoomScale(Ut));return{center:X.unproject(me.add(ye).div(2).sub(fr)),zoom:Ut,bearing:S}}_.warnOnce("Map cannot fit within canvas with the given bounds, padding, and/or offset.")},v.prototype.fitBounds=function(p,g,S){return this._fitInternal(this.cameraForBounds(p,g),g,S)},v.prototype.fitScreenCoordinates=function(p,g,S,w,C){return this._fitInternal(this._cameraForBoxAndBearing(this.transform.pointLocation(_.Point.convert(p)),this.transform.pointLocation(_.Point.convert(g)),S,w),w,C)},v.prototype._fitInternal=function(p,g,S){return p?(delete(g=_.extend(p,g)).padding,g.linear?this.easeTo(g,S):this.flyTo(g,S)):this},v.prototype.jumpTo=function(p,g){this.stop();var S=this.transform,w=!1,C=!1,O=!1;return"zoom"in p&&S.zoom!==+p.zoom&&(w=!0,S.zoom=+p.zoom),p.center!==void 0&&(S.center=_.LngLat.convert(p.center)),"bearing"in p&&S.bearing!==+p.bearing&&(C=!0,S.bearing=+p.bearing),"pitch"in p&&S.pitch!==+p.pitch&&(O=!0,S.pitch=+p.pitch),p.padding==null||S.isPaddingEqual(p.padding)||(S.padding=p.padding),this.fire(new _.Event("movestart",g)).fire(new _.Event("move",g)),w&&this.fire(new _.Event("zoomstart",g)).fire(new _.Event("zoom",g)).fire(new _.Event("zoomend",g)),C&&this.fire(new _.Event("rotatestart",g)).fire(new _.Event("rotate",g)).fire(new _.Event("rotateend",g)),O&&this.fire(new _.Event("pitchstart",g)).fire(new _.Event("pitch",g)).fire(new _.Event("pitchend",g)),this.fire(new _.Event("moveend",g))},v.prototype.easeTo=function(p,g){var S=this;this._stop(!1,p.easeId),((p=_.extend({offset:[0,0],duration:500,easing:_.ease},p)).animate===!1||!p.essential&&_.browser.prefersReducedMotion)&&(p.duration=0);var w=this.transform,C=this.getZoom(),O=this.getBearing(),X=this.getPitch(),J=this.getPadding(),me="zoom"in p?+p.zoom:C,ye="bearing"in p?this._normalizeBearing(p.bearing,O):O,Ae="pitch"in p?+p.pitch:X,Ve="padding"in p?p.padding:w.padding,Ue=_.Point.convert(p.offset),lt=w.centerPoint.add(Ue),Be=w.pointLocation(lt),st=_.LngLat.convert(p.center||Be);this._normalizeCenter(st);var xt,Ut,ar=w.project(Be),qt=w.project(st).sub(ar),fr=w.zoomScale(me-C);p.around&&(xt=_.LngLat.convert(p.around),Ut=w.locationPoint(xt));var br={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=this._zooming||me!==C,this._rotating=this._rotating||O!==ye,this._pitching=this._pitching||Ae!==X,this._padding=!w.isPaddingEqual(Ve),this._easeId=p.easeId,this._prepareEase(g,p.noMoveStart,br),this._ease(function(jr){if(S._zooming&&(w.zoom=_.number(C,me,jr)),S._rotating&&(w.bearing=_.number(O,ye,jr)),S._pitching&&(w.pitch=_.number(X,Ae,jr)),S._padding&&(w.interpolatePadding(J,Ve,jr),lt=w.centerPoint.add(Ue)),xt)w.setLocationAtPoint(xt,Ut);else{var Fr=w.zoomScale(w.zoom-C),hn=me>C?Math.min(2,fr):Math.max(.5,fr),Un=Math.pow(hn,1-jr),Ln=w.unproject(ar.add(qt.mult(jr*Un)).mult(Fr));w.setLocationAtPoint(w.renderWorldCopies?Ln.wrap():Ln,lt)}S._fireMoveEvents(g)},function(jr){S._afterEase(g,jr)},p),this},v.prototype._prepareEase=function(p,g,S){S===void 0&&(S={}),this._moving=!0,g||S.moving||this.fire(new _.Event("movestart",p)),this._zooming&&!S.zooming&&this.fire(new _.Event("zoomstart",p)),this._rotating&&!S.rotating&&this.fire(new _.Event("rotatestart",p)),this._pitching&&!S.pitching&&this.fire(new _.Event("pitchstart",p))},v.prototype._fireMoveEvents=function(p){this.fire(new _.Event("move",p)),this._zooming&&this.fire(new _.Event("zoom",p)),this._rotating&&this.fire(new _.Event("rotate",p)),this._pitching&&this.fire(new _.Event("pitch",p))},v.prototype._afterEase=function(p,g){if(!this._easeId||!g||this._easeId!==g){delete this._easeId;var S=this._zooming,w=this._rotating,C=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,S&&this.fire(new _.Event("zoomend",p)),w&&this.fire(new _.Event("rotateend",p)),C&&this.fire(new _.Event("pitchend",p)),this.fire(new _.Event("moveend",p))}},v.prototype.flyTo=function(p,g){var S=this;if(!p.essential&&_.browser.prefersReducedMotion){var w=_.pick(p,["center","zoom","bearing","pitch","around"]);return this.jumpTo(w,g)}this.stop(),p=_.extend({offset:[0,0],speed:1.2,curve:1.42,easing:_.ease},p);var C=this.transform,O=this.getZoom(),X=this.getBearing(),J=this.getPitch(),me=this.getPadding(),ye="zoom"in p?_.clamp(+p.zoom,C.minZoom,C.maxZoom):O,Ae="bearing"in p?this._normalizeBearing(p.bearing,X):X,Ve="pitch"in p?+p.pitch:J,Ue="padding"in p?p.padding:C.padding,lt=C.zoomScale(ye-O),Be=_.Point.convert(p.offset),st=C.centerPoint.add(Be),xt=C.pointLocation(st),Ut=_.LngLat.convert(p.center||xt);this._normalizeCenter(Ut);var ar=C.project(xt),qt=C.project(Ut).sub(ar),fr=p.curve,br=Math.max(C.width,C.height),jr=br/lt,Fr=qt.mag();if("minZoom"in p){var hn=_.clamp(Math.min(p.minZoom,O,ye),C.minZoom,C.maxZoom),Un=br/C.zoomScale(hn-O);fr=Math.sqrt(Un/Fr*2)}var Ln=fr*fr;function zn(Jn){var Xn=(jr*jr-br*br+(Jn?-1:1)*Ln*Ln*Fr*Fr)/(2*(Jn?jr:br)*Ln*Fr);return Math.log(Math.sqrt(Xn*Xn+1)-Xn)}function Ui(Jn){return(Math.exp(Jn)-Math.exp(-Jn))/2}function gn(Jn){return(Math.exp(Jn)+Math.exp(-Jn))/2}var ii=zn(0),pi=function(Jn){return gn(ii)/gn(ii+fr*Jn)},ri=function(Jn){return br*((gn(ii)*(Ui(Xn=ii+fr*Jn)/gn(Xn))-Ui(ii))/Ln)/Fr;var Xn},Qn=(zn(1)-ii)/fr;if(Math.abs(Fr)<1e-6||!isFinite(Qn)){if(Math.abs(br-jr)<1e-6)return this.easeTo(p,g);var fi=jr<br?-1:1;Qn=Math.abs(Math.log(jr/br))/fr,ri=function(){return 0},pi=function(Jn){return Math.exp(fi*fr*Jn)}}return p.duration="duration"in p?+p.duration:1e3*Qn/("screenSpeed"in p?+p.screenSpeed/fr:+p.speed),p.maxDuration&&p.duration>p.maxDuration&&(p.duration=0),this._zooming=!0,this._rotating=X!==Ae,this._pitching=Ve!==J,this._padding=!C.isPaddingEqual(Ue),this._prepareEase(g,!1),this._ease(function(Jn){var Xn=Jn*Qn,Mo=1/pi(Xn);C.zoom=Jn===1?ye:O+C.scaleZoom(Mo),S._rotating&&(C.bearing=_.number(X,Ae,Jn)),S._pitching&&(C.pitch=_.number(J,Ve,Jn)),S._padding&&(C.interpolatePadding(me,Ue,Jn),st=C.centerPoint.add(Be));var Ka=Jn===1?Ut:C.unproject(ar.add(qt.mult(ri(Xn))).mult(Mo));C.setLocationAtPoint(C.renderWorldCopies?Ka.wrap():Ka,st),S._fireMoveEvents(g)},function(){return S._afterEase(g)},p),this},v.prototype.isEasing=function(){return!!this._easeFrameId},v.prototype.stop=function(){return this._stop()},v.prototype._stop=function(p,g){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),delete this._easeFrameId,delete this._onEaseFrame),this._onEaseEnd){var S=this._onEaseEnd;delete this._onEaseEnd,S.call(this,g)}if(!p){var w=this.handlers;w&&w.stop(!1)}return this},v.prototype._ease=function(p,g,S){S.animate===!1||S.duration===0?(p(1),g()):(this._easeStart=_.browser.now(),this._easeOptions=S,this._onEaseFrame=p,this._onEaseEnd=g,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))},v.prototype._renderFrameCallback=function(){var p=Math.min((_.browser.now()-this._easeStart)/this._easeOptions.duration,1);this._onEaseFrame(this._easeOptions.easing(p)),p<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()},v.prototype._normalizeBearing=function(p,g){p=_.wrap(p,-180,180);var S=Math.abs(p-g);return Math.abs(p-360-g)<S&&(p-=360),Math.abs(p+360-g)<S&&(p+=360),p},v.prototype._normalizeCenter=function(p){var g=this.transform;if(g.renderWorldCopies&&!g.lngRange){var S=p.lng-g.center.lng;p.lng+=S>180?-360:S<-180?360:0}},v}(_.Evented),os=function(h){h===void 0&&(h={}),this.options=h,_.bindAll(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)};os.prototype.getDefaultPosition=function(){return"bottom-right"},os.prototype.onAdd=function(h){var v=this.options&&this.options.compact;return this._map=h,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=Z.create("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.addEventListener("click",this._toggleAttribution),this._setElementTitle(this._compactButton,"ToggleAttribution"),this._innerContainer=Z.create("div","mapboxgl-ctrl-attrib-inner",this._container),this._innerContainer.setAttribute("role","list"),v&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),v===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container},os.prototype.onRemove=function(){Z.remove(this._container),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0},os.prototype._setElementTitle=function(h,v){var p=this._map._getUIString("AttributionControl."+v);h.title=p,h.setAttribute("aria-label",p)},os.prototype._toggleAttribution=function(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-pressed","true"))},os.prototype._updateEditLink=function(){var h=this._editLink;h||(h=this._editLink=this._container.querySelector(".mapbox-improve-map"));var v=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||_.config.ACCESS_TOKEN}];if(h){var p=v.reduce(function(g,S,w){return S.value&&(g+=S.key+"="+S.value+(w<v.length-1?"&":"")),g},"?");h.href=_.config.FEEDBACK_URL+"/"+p+(this._map._hash?this._map._hash.getHashString(!0):""),h.rel="noopener nofollow",this._setElementTitle(h,"MapFeedback")}},os.prototype._updateData=function(h){!h||h.sourceDataType!=="metadata"&&h.sourceDataType!=="visibility"&&h.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())},os.prototype._updateAttributions=function(){if(this._map.style){var h=[];if(this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?h=h.concat(this.options.customAttribution.map(function(O){return typeof O!="string"?"":O})):typeof this.options.customAttribution=="string"&&h.push(this.options.customAttribution)),this._map.style.stylesheet){var v=this._map.style.stylesheet;this.styleOwner=v.owner,this.styleId=v.id}var p=this._map.style.sourceCaches;for(var g in p){var S=p[g];if(S.used){var w=S.getSource();w.attribution&&h.indexOf(w.attribution)<0&&h.push(w.attribution)}}h.sort(function(O,X){return O.length-X.length});var C=(h=h.filter(function(O,X){for(var J=X+1;J<h.length;J++)if(h[J].indexOf(O)>=0)return!1;return!0})).join(" | ");C!==this._attribHTML&&(this._attribHTML=C,h.length?(this._innerContainer.innerHTML=C,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}},os.prototype._updateCompact=function(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")};var xu=function(){_.bindAll(["_updateLogo"],this),_.bindAll(["_updateCompact"],this)};xu.prototype.onAdd=function(h){this._map=h,this._container=Z.create("div","mapboxgl-ctrl");var v=Z.create("a","mapboxgl-ctrl-logo");return v.target="_blank",v.rel="noopener nofollow",v.href="https://www.mapbox.com/",v.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),v.setAttribute("rel","noopener nofollow"),this._container.appendChild(v),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container},xu.prototype.onRemove=function(){Z.remove(this._container),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)},xu.prototype.getDefaultPosition=function(){return"bottom-left"},xu.prototype._updateLogo=function(h){h&&h.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")},xu.prototype._logoRequired=function(){if(this._map.style){var h=this._map.style.sourceCaches;for(var v in h)if(h[v].getSource().mapbox_logo)return!0;return!1}},xu.prototype._updateCompact=function(){var h=this._container.children;if(h.length){var v=h[0];this._map.getCanvasContainer().offsetWidth<250?v.classList.add("mapboxgl-compact"):v.classList.remove("mapboxgl-compact")}};var Ba=function(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1};Ba.prototype.add=function(h){var v=++this._id;return this._queue.push({callback:h,id:v,cancelled:!1}),v},Ba.prototype.remove=function(h){for(var v=this._currentlyRunning,p=0,g=v?this._queue.concat(v):this._queue;p<g.length;p+=1){var S=g[p];if(S.id===h)return void(S.cancelled=!0)}},Ba.prototype.run=function(h){h===void 0&&(h=0);var v=this._currentlyRunning=this._queue;this._queue=[];for(var p=0,g=v;p<g.length;p+=1){var S=g[p];if(!S.cancelled&&(S.callback(h),this._cleared))break}this._cleared=!1,this._currentlyRunning=!1},Ba.prototype.clear=function(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]};var tu={"AttributionControl.ToggleAttribution":"Toggle attribution","AttributionControl.MapFeedback":"Map feedback","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox logo","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScaleControl.Feet":"ft","ScaleControl.Meters":"m","ScaleControl.Kilometers":"km","ScaleControl.Miles":"mi","ScaleControl.NauticalMiles":"nm"},bu=_.window.HTMLImageElement,Eu=_.window.HTMLElement,oa=_.window.ImageBitmap,mo={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:60,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",transformRequest:null,accessToken:null,fadeDuration:300,crossSourceCollisions:!0},Sh=function(h){function v(g){var S=this;if((g=_.extend({},mo,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>60)throw new Error("maxPitch must be less than or equal to 60");var w=new Li(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies);if(h.call(this,w,g),this._interactive=g.interactive,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._crossSourceCollisions=g.crossSourceCollisions,this._crossFadingFactor=1,this._collectResourceTiming=g.collectResourceTiming,this._renderTaskQueue=new Ba,this._controls=[],this._mapId=_.uniqueId(),this._locale=_.extend({},tu,g.locale),this._clickTolerance=g.clickTolerance,this._requestManager=new _.RequestManager(g.transformRequest,g.accessToken),typeof g.container=="string"){if(this._container=_.window.document.getElementById(g.container),!this._container)throw new Error("Container '"+g.container+"' not found.")}else{if(!(g.container instanceof Eu))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(g.maxBounds&&this.setMaxBounds(g.maxBounds),_.bindAll(["_onWindowOnline","_onWindowResize","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");this.on("move",function(){return S._update(!1)}),this.on("moveend",function(){return S._update(!1)}),this.on("zoom",function(){return S._update(!0)}),_.window!==void 0&&(_.window.addEventListener("online",this._onWindowOnline,!1),_.window.addEventListener("resize",this._onWindowResize,!1),_.window.addEventListener("orientationchange",this._onWindowResize,!1)),this.handlers=new An(this,g),this._hash=g.hash&&new su(typeof g.hash=="string"&&g.hash||void 0).addTo(this),this._hash&&this._hash._onHashChange()||(this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch}),g.bounds&&(this.resize(),this.fitBounds(g.bounds,_.extend({},g.fitBoundsOptions,{duration:0})))),this.resize(),this._localIdeographFontFamily=g.localIdeographFontFamily,g.style&&this.setStyle(g.style,{localIdeographFontFamily:g.localIdeographFontFamily}),g.attributionControl&&this.addControl(new os({customAttribution:g.customAttribution})),this.addControl(new xu,g.logoPosition),this.on("style.load",function(){S.transform.unmodified&&S.jumpTo(S.style.stylesheet)}),this.on("data",function(C){S._update(C.dataType==="style"),S.fire(new _.Event(C.dataType+"data",C))}),this.on("dataloading",function(C){S.fire(new _.Event(C.dataType+"dataloading",C))})}h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v;var p={showTileBoundaries:{configurable:!0},showPadding:{configurable:!0},showCollisionBoxes:{configurable:!0},showOverdrawInspector:{configurable:!0},repaint:{configurable:!0},vertices:{configurable:!0},version:{configurable:!0}};return v.prototype._getMapId=function(){return this._mapId},v.prototype.addControl=function(g,S){if(S===void 0&&(S=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new _.ErrorEvent(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));var w=g.onAdd(this);this._controls.push(g);var C=this._controlPositions[S];return S.indexOf("bottom")!==-1?C.insertBefore(w,C.firstChild):C.appendChild(w),this},v.prototype.removeControl=function(g){if(!g||!g.onRemove)return this.fire(new _.ErrorEvent(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));var S=this._controls.indexOf(g);return S>-1&&this._controls.splice(S,1),g.onRemove(this),this},v.prototype.hasControl=function(g){return this._controls.indexOf(g)>-1},v.prototype.resize=function(g){var S=this._containerDimensions(),w=S[0],C=S[1];if(w===this.transform.width&&C===this.transform.height)return this;this._resizeCanvas(w,C),this.transform.resize(w,C),this.painter.resize(w,C);var O=!this._moving;return O&&this.fire(new _.Event("movestart",g)).fire(new _.Event("move",g)),this.fire(new _.Event("resize",g)),O&&this.fire(new _.Event("moveend",g)),this},v.prototype.getBounds=function(){return this.transform.getBounds()},v.prototype.getMaxBounds=function(){return this.transform.getMaxBounds()},v.prototype.setMaxBounds=function(g){return this.transform.setMaxBounds(_.LngLatBounds.convert(g)),this._update()},v.prototype.setMinZoom=function(g){if((g=g==null?-2:g)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g&&this.setZoom(g),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")},v.prototype.getMinZoom=function(){return this.transform.minZoom},v.prototype.setMaxZoom=function(g){if((g=g==null?22:g)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g&&this.setZoom(g),this;throw new Error("maxZoom must be greater than the current minZoom")},v.prototype.getMaxZoom=function(){return this.transform.maxZoom},v.prototype.setMinPitch=function(g){if((g=g==null?0:g)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g&&this.setPitch(g),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")},v.prototype.getMinPitch=function(){return this.transform.minPitch},v.prototype.setMaxPitch=function(g){if((g=g==null?60:g)>60)throw new Error("maxPitch must be less than or equal to 60");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g&&this.setPitch(g),this;throw new Error("maxPitch must be greater than the current minPitch")},v.prototype.getMaxPitch=function(){return this.transform.maxPitch},v.prototype.getRenderWorldCopies=function(){return this.transform.renderWorldCopies},v.prototype.setRenderWorldCopies=function(g){return this.transform.renderWorldCopies=g,this._update()},v.prototype.project=function(g){return this.transform.locationPoint(_.LngLat.convert(g))},v.prototype.unproject=function(g){return this.transform.pointLocation(_.Point.convert(g))},v.prototype.isMoving=function(){return this._moving||this.handlers.isMoving()},v.prototype.isZooming=function(){return this._zooming||this.handlers.isZooming()},v.prototype.isRotating=function(){return this._rotating||this.handlers.isRotating()},v.prototype._createDelegatedListener=function(g,S,w){var C,O=this;if(g==="mouseenter"||g==="mouseover"){var X=!1;return{layer:S,listener:w,delegates:{mousemove:function(me){var ye=O.getLayer(S)?O.queryRenderedFeatures(me.point,{layers:[S]}):[];ye.length?X||(X=!0,w.call(O,new ja(g,O,me.originalEvent,{features:ye}))):X=!1},mouseout:function(){X=!1}}}}if(g==="mouseleave"||g==="mouseout"){var J=!1;return{layer:S,listener:w,delegates:{mousemove:function(me){(O.getLayer(S)?O.queryRenderedFeatures(me.point,{layers:[S]}):[]).length?J=!0:J&&(J=!1,w.call(O,new ja(g,O,me.originalEvent)))},mouseout:function(me){J&&(J=!1,w.call(O,new ja(g,O,me.originalEvent)))}}}}return{layer:S,listener:w,delegates:(C={},C[g]=function(me){var ye=O.getLayer(S)?O.queryRenderedFeatures(me.point,{layers:[S]}):[];ye.length&&(me.features=ye,w.call(O,me),delete me.features)},C)}},v.prototype.on=function(g,S,w){if(w===void 0)return h.prototype.on.call(this,g,S);var C=this._createDelegatedListener(g,S,w);for(var O in this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(C),C.delegates)this.on(O,C.delegates[O]);return this},v.prototype.once=function(g,S,w){if(w===void 0)return h.prototype.once.call(this,g,S);var C=this._createDelegatedListener(g,S,w);for(var O in C.delegates)this.once(O,C.delegates[O]);return this},v.prototype.off=function(g,S,w){var C=this;return w===void 0?h.prototype.off.call(this,g,S):(this._delegatedListeners&&this._delegatedListeners[g]&&function(O){for(var X=O[g],J=0;J<X.length;J++){var me=X[J];if(me.layer===S&&me.listener===w){for(var ye in me.delegates)C.off(ye,me.delegates[ye]);return X.splice(J,1),C}}}(this._delegatedListeners),this)},v.prototype.queryRenderedFeatures=function(g,S){if(!this.style)return[];var w;if(S!==void 0||g===void 0||g instanceof _.Point||Array.isArray(g)||(S=g,g=void 0),S=S||{},(g=g||[[0,0],[this.transform.width,this.transform.height]])instanceof _.Point||typeof g[0]=="number")w=[_.Point.convert(g)];else{var C=_.Point.convert(g[0]),O=_.Point.convert(g[1]);w=[C,new _.Point(O.x,C.y),O,new _.Point(C.x,O.y),C]}return this.style.queryRenderedFeatures(w,S,this.transform)},v.prototype.querySourceFeatures=function(g,S){return this.style.querySourceFeatures(g,S)},v.prototype.setStyle=function(g,S){return(S=_.extend({},{localIdeographFontFamily:this._localIdeographFontFamily},S)).diff!==!1&&S.localIdeographFontFamily===this._localIdeographFontFamily&&this.style&&g?(this._diffStyle(g,S),this):(this._localIdeographFontFamily=S.localIdeographFontFamily,this._updateStyle(g,S))},v.prototype._getUIString=function(g){var S=this._locale[g];if(S==null)throw new Error("Missing UI string '"+g+"'");return S},v.prototype._updateStyle=function(g,S){return this.style&&(this.style.setEventedParent(null),this.style._remove()),g?(this.style=new Ls(this,S||{}),this.style.setEventedParent(this,{style:this.style}),typeof g=="string"?this.style.loadURL(g):this.style.loadJSON(g),this):(delete this.style,this)},v.prototype._lazyInitEmptyStyle=function(){this.style||(this.style=new Ls(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())},v.prototype._diffStyle=function(g,S){var w=this;if(typeof g=="string"){var C=this._requestManager.normalizeStyleURL(g),O=this._requestManager.transformRequest(C,_.ResourceType.Style);_.getJSON(O,function(X,J){X?w.fire(new _.ErrorEvent(X)):J&&w._updateDiff(J,S)})}else typeof g=="object"&&this._updateDiff(g,S)},v.prototype._updateDiff=function(g,S){try{this.style.setState(g)&&this._update(!0)}catch(w){_.warnOnce("Unable to perform style diff: "+(w.message||w.error||w)+".  Rebuilding the style from scratch."),this._updateStyle(g,S)}},v.prototype.getStyle=function(){if(this.style)return this.style.serialize()},v.prototype.isStyleLoaded=function(){return this.style?this.style.loaded():_.warnOnce("There is no style added to the map.")},v.prototype.addSource=function(g,S){return this._lazyInitEmptyStyle(),this.style.addSource(g,S),this._update(!0)},v.prototype.isSourceLoaded=function(g){var S=this.style&&this.style.sourceCaches[g];if(S!==void 0)return S.loaded();this.fire(new _.ErrorEvent(new Error("There is no source with ID '"+g+"'")))},v.prototype.areTilesLoaded=function(){var g=this.style&&this.style.sourceCaches;for(var S in g){var w=g[S]._tiles;for(var C in w){var O=w[C];if(O.state!=="loaded"&&O.state!=="errored")return!1}}return!0},v.prototype.addSourceType=function(g,S,w){return this._lazyInitEmptyStyle(),this.style.addSourceType(g,S,w)},v.prototype.removeSource=function(g){return this.style.removeSource(g),this._update(!0)},v.prototype.getSource=function(g){return this.style.getSource(g)},v.prototype.addImage=function(g,S,w){w===void 0&&(w={});var C=w.pixelRatio;C===void 0&&(C=1);var O=w.sdf;O===void 0&&(O=!1);var X=w.stretchX,J=w.stretchY,me=w.content;if(this._lazyInitEmptyStyle(),S instanceof bu||oa&&S instanceof oa){var ye=_.browser.getImageData(S);this.style.addImage(g,{data:new _.RGBAImage({width:ye.width,height:ye.height},ye.data),pixelRatio:C,stretchX:X,stretchY:J,content:me,sdf:O,version:0})}else{if(S.width===void 0||S.height===void 0)return this.fire(new _.ErrorEvent(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));var Ae=S;this.style.addImage(g,{data:new _.RGBAImage({width:S.width,height:S.height},new Uint8Array(S.data)),pixelRatio:C,stretchX:X,stretchY:J,content:me,sdf:O,version:0,userImage:Ae}),Ae.onAdd&&Ae.onAdd(this,g)}},v.prototype.updateImage=function(g,S){var w=this.style.getImage(g);if(!w)return this.fire(new _.ErrorEvent(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));var C=S instanceof bu||oa&&S instanceof oa?_.browser.getImageData(S):S,O=C.width,X=C.height,J=C.data;return O===void 0||X===void 0?this.fire(new _.ErrorEvent(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`"))):O!==w.data.width||X!==w.data.height?this.fire(new _.ErrorEvent(new Error("The width and height of the updated image must be that same as the previous version of the image"))):(w.data.replace(J,!(S instanceof bu||oa&&S instanceof oa)),void this.style.updateImage(g,w))},v.prototype.hasImage=function(g){return g?!!this.style.getImage(g):(this.fire(new _.ErrorEvent(new Error("Missing required image id"))),!1)},v.prototype.removeImage=function(g){this.style.removeImage(g)},v.prototype.loadImage=function(g,S){_.getImage(this._requestManager.transformRequest(g,_.ResourceType.Image),S)},v.prototype.listImages=function(){return this.style.listImages()},v.prototype.addLayer=function(g,S){return this._lazyInitEmptyStyle(),this.style.addLayer(g,S),this._update(!0)},v.prototype.moveLayer=function(g,S){return this.style.moveLayer(g,S),this._update(!0)},v.prototype.removeLayer=function(g){return this.style.removeLayer(g),this._update(!0)},v.prototype.getLayer=function(g){return this.style.getLayer(g)},v.prototype.setLayerZoomRange=function(g,S,w){return this.style.setLayerZoomRange(g,S,w),this._update(!0)},v.prototype.setFilter=function(g,S,w){return w===void 0&&(w={}),this.style.setFilter(g,S,w),this._update(!0)},v.prototype.getFilter=function(g){return this.style.getFilter(g)},v.prototype.setPaintProperty=function(g,S,w,C){return C===void 0&&(C={}),this.style.setPaintProperty(g,S,w,C),this._update(!0)},v.prototype.getPaintProperty=function(g,S){return this.style.getPaintProperty(g,S)},v.prototype.setLayoutProperty=function(g,S,w,C){return C===void 0&&(C={}),this.style.setLayoutProperty(g,S,w,C),this._update(!0)},v.prototype.getLayoutProperty=function(g,S){return this.style.getLayoutProperty(g,S)},v.prototype.setLight=function(g,S){return S===void 0&&(S={}),this._lazyInitEmptyStyle(),this.style.setLight(g,S),this._update(!0)},v.prototype.getLight=function(){return this.style.getLight()},v.prototype.setFeatureState=function(g,S){return this.style.setFeatureState(g,S),this._update()},v.prototype.removeFeatureState=function(g,S){return this.style.removeFeatureState(g,S),this._update()},v.prototype.getFeatureState=function(g){return this.style.getFeatureState(g)},v.prototype.getContainer=function(){return this._container},v.prototype.getCanvasContainer=function(){return this._canvasContainer},v.prototype.getCanvas=function(){return this._canvas},v.prototype._containerDimensions=function(){var g=0,S=0;return this._container&&(g=this._container.clientWidth||400,S=this._container.clientHeight||300),[g,S]},v.prototype._detectMissingCSS=function(){_.window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&_.warnOnce("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")},v.prototype._setupContainer=function(){var g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=Z.create("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();var S=this._canvasContainer=Z.create("div","mapboxgl-canvas-container",g);this._interactive&&S.classList.add("mapboxgl-interactive"),this._canvas=Z.create("canvas","mapboxgl-canvas",S),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("tabindex","0"),this._canvas.setAttribute("aria-label","Map"),this._canvas.setAttribute("role","region");var w=this._containerDimensions();this._resizeCanvas(w[0],w[1]);var C=this._controlContainer=Z.create("div","mapboxgl-control-container",g),O=this._controlPositions={};["top-left","top-right","bottom-left","bottom-right"].forEach(function(X){O[X]=Z.create("div","mapboxgl-ctrl-"+X,C)}),this._container.addEventListener("scroll",this._onMapScroll,!1)},v.prototype._resizeCanvas=function(g,S){var w=_.browser.devicePixelRatio||1;this._canvas.width=w*g,this._canvas.height=w*S,this._canvas.style.width=g+"px",this._canvas.style.height=S+"px"},v.prototype._setupPainter=function(){var g=_.extend({},fe.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),S=this._canvas.getContext("webgl",g)||this._canvas.getContext("experimental-webgl",g);S?(this.painter=new da(S,this.transform),_.webpSupported.testSupport(S)):this.fire(new _.ErrorEvent(new Error("Failed to initialize WebGL")))},v.prototype._contextLost=function(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new _.Event("webglcontextlost",{originalEvent:g}))},v.prototype._contextRestored=function(g){this._setupPainter(),this.resize(),this._update(),this.fire(new _.Event("webglcontextrestored",{originalEvent:g}))},v.prototype._onMapScroll=function(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1},v.prototype.loaded=function(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()},v.prototype._update=function(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this},v.prototype._requestRenderFrame=function(g){return this._update(),this._renderTaskQueue.add(g)},v.prototype._cancelRenderFrame=function(g){this._renderTaskQueue.remove(g)},v.prototype._render=function(g){var S,w=this,C=0,O=this.painter.context.extTimerQuery;if(this.listens("gpu-timing-frame")&&(S=O.createQueryEXT(),O.beginQueryEXT(O.TIME_ELAPSED_EXT,S),C=_.browser.now()),this.painter.context.setDirty(),this.painter.setBaseState(),this._renderTaskQueue.run(g),!this._removed){var X=!1;if(this.style&&this._styleDirty){this._styleDirty=!1;var J=this.transform.zoom,me=_.browser.now();this.style.zoomHistory.update(J,me);var ye=new _.EvaluationParameters(J,{now:me,fadeDuration:this._fadeDuration,zoomHistory:this.style.zoomHistory,transition:this.style.getTransition()}),Ae=ye.crossFadingFactor();Ae===1&&Ae===this._crossFadingFactor||(X=!0,this._crossFadingFactor=Ae),this.style.update(ye)}if(this.style&&this._sourcesDirty&&(this._sourcesDirty=!1,this.style._updateSources(this.transform)),this._placementDirty=this.style&&this.style._updatePlacement(this.painter.transform,this.showCollisionBoxes,this._fadeDuration,this._crossSourceCollisions),this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showOverdrawInspector:this._showOverdrawInspector,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:this._fadeDuration,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer")}),this.fire(new _.Event("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,this.fire(new _.Event("load"))),this.style&&(this.style.hasTransitions()||X)&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),this.listens("gpu-timing-frame")){var Ve=_.browser.now()-C;O.endQueryEXT(O.TIME_ELAPSED_EXT,S),setTimeout(function(){var Be=O.getQueryObjectEXT(S,O.QUERY_RESULT_EXT)/1e6;O.deleteQueryEXT(S),w.fire(new _.Event("gpu-timing-frame",{cpuTime:Ve,gpuTime:Be}))},50)}if(this.listens("gpu-timing-layer")){var Ue=this.painter.collectGpuTimers();setTimeout(function(){var Be=w.painter.queryGpuTimers(Ue);w.fire(new _.Event("gpu-timing-layer",{layerTimes:Be}))},50)}var lt=this._sourcesDirty||this._styleDirty||this._placementDirty;return lt||this._repaint?this.triggerRepaint():!this.isMoving()&&this.loaded()&&this.fire(new _.Event("idle")),!this._loaded||this._fullyLoaded||lt||(this._fullyLoaded=!0),this}},v.prototype.remove=function(){this._hash&&this._hash.remove();for(var g=0,S=this._controls;g<S.length;g+=1)S[g].onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this.painter.destroy(),this.handlers.destroy(),delete this.handlers,this.setStyle(null),_.window!==void 0&&(_.window.removeEventListener("resize",this._onWindowResize,!1),_.window.removeEventListener("orientationchange",this._onWindowResize,!1),_.window.removeEventListener("online",this._onWindowOnline,!1));var w=this.painter.context.gl.getExtension("WEBGL_lose_context");w&&w.loseContext(),Ol(this._canvasContainer),Ol(this._controlContainer),Ol(this._missingCSSCanary),this._container.classList.remove("mapboxgl-map"),this._removed=!0,this.fire(new _.Event("remove"))},v.prototype.triggerRepaint=function(){var g=this;this.style&&!this._frame&&(this._frame=_.browser.frame(function(S){g._frame=null,g._render(S)}))},v.prototype._onWindowOnline=function(){this._update()},v.prototype._onWindowResize=function(g){this._trackResize&&this.resize({originalEvent:g})._update()},p.showTileBoundaries.get=function(){return!!this._showTileBoundaries},p.showTileBoundaries.set=function(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._update())},p.showPadding.get=function(){return!!this._showPadding},p.showPadding.set=function(g){this._showPadding!==g&&(this._showPadding=g,this._update())},p.showCollisionBoxes.get=function(){return!!this._showCollisionBoxes},p.showCollisionBoxes.set=function(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,g?this.style._generateCollisionBoxes():this._update())},p.showOverdrawInspector.get=function(){return!!this._showOverdrawInspector},p.showOverdrawInspector.set=function(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._update())},p.repaint.get=function(){return!!this._repaint},p.repaint.set=function(g){this._repaint!==g&&(this._repaint=g,this.triggerRepaint())},p.vertices.get=function(){return!!this._vertices},p.vertices.set=function(g){this._vertices=g,this._update()},v.prototype._setCacheLimits=function(g,S){_.setCacheLimits(g,S)},p.version.get=function(){return _.version},Object.defineProperties(v.prototype,p),v}(as);function Ol(h){h.parentNode&&h.parentNode.removeChild(h)}var zf={showCompass:!0,showZoom:!0,visualizePitch:!1},cl=function(h){var v=this;this.options=_.extend({},zf,h),this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",function(p){return p.preventDefault()}),this.options.showZoom&&(_.bindAll(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",function(p){return v._map.zoomIn({},{originalEvent:p})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden",!0),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",function(p){return v._map.zoomOut({},{originalEvent:p})}),Z.create("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden",!0)),this.options.showCompass&&(_.bindAll(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",function(p){v.options.visualizePitch?v._map.resetNorthPitch({},{originalEvent:p}):v._map.resetNorth({},{originalEvent:p})}),this._compassIcon=Z.create("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden",!0))};cl.prototype._updateZoomButtons=function(){var h=this._map.getZoom(),v=h===this._map.getMaxZoom(),p=h===this._map.getMinZoom();this._zoomInButton.disabled=v,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",v.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())},cl.prototype._rotateCompassArrow=function(){var h=this.options.visualizePitch?"scale("+1/Math.pow(Math.cos(this._map.transform.pitch*(Math.PI/180)),.5)+") rotateX("+this._map.transform.pitch+"deg) rotateZ("+this._map.transform.angle*(180/Math.PI)+"deg)":"rotate("+this._map.transform.angle*(180/Math.PI)+"deg)";this._compassIcon.style.transform=h},cl.prototype.onAdd=function(h){return this._map=h,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),this._map.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&this._map.on("pitch",this._rotateCompassArrow),this._map.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new ys(this._map,this._compass,this.options.visualizePitch)),this._container},cl.prototype.onRemove=function(){Z.remove(this._container),this.options.showZoom&&this._map.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&this._map.off("pitch",this._rotateCompassArrow),this._map.off("rotate",this._rotateCompassArrow),this._handler.off(),delete this._handler),delete this._map},cl.prototype._createButton=function(h,v){var p=Z.create("button",h,this._container);return p.type="button",p.addEventListener("click",v),p},cl.prototype._setButtonTitle=function(h,v){var p=this._map._getUIString("NavigationControl."+v);h.title=p,h.setAttribute("aria-label",p)};var ys=function(h,v,p){p===void 0&&(p=!1),this._clickTolerance=10,this.element=v,this.mouseRotate=new af({clickTolerance:h.dragRotate._mouseRotate._clickTolerance}),this.map=h,p&&(this.mousePitch=new of({clickTolerance:h.dragRotate._mousePitch._clickTolerance})),_.bindAll(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),Z.addEventListener(v,"mousedown",this.mousedown),Z.addEventListener(v,"touchstart",this.touchstart,{passive:!1}),Z.addEventListener(v,"touchmove",this.touchmove),Z.addEventListener(v,"touchend",this.touchend),Z.addEventListener(v,"touchcancel",this.reset)};function ec(h,v,p){if(h=new _.LngLat(h.lng,h.lat),v){var g=new _.LngLat(h.lng-360,h.lat),S=new _.LngLat(h.lng+360,h.lat),w=p.locationPoint(h).distSqr(v);p.locationPoint(g).distSqr(v)<w?h=g:p.locationPoint(S).distSqr(v)<w&&(h=S)}for(;Math.abs(h.lng-p.center.lng)>180;){var C=p.locationPoint(h);if(C.x>=0&&C.y>=0&&C.x<=p.width&&C.y<=p.height)break;h.lng>p.center.lng?h.lng-=360:h.lng+=360}return h}ys.prototype.down=function(h,v){this.mouseRotate.mousedown(h,v),this.mousePitch&&this.mousePitch.mousedown(h,v),Z.disableDrag()},ys.prototype.move=function(h,v){var p=this.map,g=this.mouseRotate.mousemoveWindow(h,v);if(g&&g.bearingDelta&&p.setBearing(p.getBearing()+g.bearingDelta),this.mousePitch){var S=this.mousePitch.mousemoveWindow(h,v);S&&S.pitchDelta&&p.setPitch(p.getPitch()+S.pitchDelta)}},ys.prototype.off=function(){var h=this.element;Z.removeEventListener(h,"mousedown",this.mousedown),Z.removeEventListener(h,"touchstart",this.touchstart,{passive:!1}),Z.removeEventListener(h,"touchmove",this.touchmove),Z.removeEventListener(h,"touchend",this.touchend),Z.removeEventListener(h,"touchcancel",this.reset),this.offTemp()},ys.prototype.offTemp=function(){Z.enableDrag(),Z.removeEventListener(_.window,"mousemove",this.mousemove),Z.removeEventListener(_.window,"mouseup",this.mouseup)},ys.prototype.mousedown=function(h){this.down(_.extend({},h,{ctrlKey:!0,preventDefault:function(){return h.preventDefault()}}),Z.mousePos(this.element,h)),Z.addEventListener(_.window,"mousemove",this.mousemove),Z.addEventListener(_.window,"mouseup",this.mouseup)},ys.prototype.mousemove=function(h){this.move(h,Z.mousePos(this.element,h))},ys.prototype.mouseup=function(h){this.mouseRotate.mouseupWindow(h),this.mousePitch&&this.mousePitch.mouseupWindow(h),this.offTemp()},ys.prototype.touchstart=function(h){h.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Z.touchPos(this.element,h.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:function(){return h.preventDefault()}},this._startPos))},ys.prototype.touchmove=function(h){h.targetTouches.length!==1?this.reset():(this._lastPos=Z.touchPos(this.element,h.targetTouches)[0],this.move({preventDefault:function(){return h.preventDefault()}},this._lastPos))},ys.prototype.touchend=function(h){h.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()},ys.prototype.reset=function(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()};var Su={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"};function Zf(h,v,p){var g=h.classList;for(var S in Su)g.remove("mapboxgl-"+p+"-anchor-"+S);g.add("mapboxgl-"+p+"-anchor-"+v)}var Rc,sf=function(h){function v(p,g){if(h.call(this),(p instanceof _.window.HTMLElement||g)&&(p=_.extend({element:p},g)),_.bindAll(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress"],this),this._anchor=p&&p.anchor||"center",this._color=p&&p.color||"#3FB1CE",this._scale=p&&p.scale||1,this._draggable=p&&p.draggable||!1,this._clickTolerance=p&&p.clickTolerance||0,this._isDragging=!1,this._state="inactive",this._rotation=p&&p.rotation||0,this._rotationAlignment=p&&p.rotationAlignment||"auto",this._pitchAlignment=p&&p.pitchAlignment&&p.pitchAlignment!=="auto"?p.pitchAlignment:this._rotationAlignment,p&&p.element)this._element=p.element,this._offset=_.Point.convert(p&&p.offset||[0,0]);else{this._defaultMarker=!0,this._element=Z.create("div"),this._element.setAttribute("aria-label","Map marker");var S=Z.createNS("http://www.w3.org/2000/svg","svg");S.setAttributeNS(null,"display","block"),S.setAttributeNS(null,"height","41px"),S.setAttributeNS(null,"width","27px"),S.setAttributeNS(null,"viewBox","0 0 27 41");var w=Z.createNS("http://www.w3.org/2000/svg","g");w.setAttributeNS(null,"stroke","none"),w.setAttributeNS(null,"stroke-width","1"),w.setAttributeNS(null,"fill","none"),w.setAttributeNS(null,"fill-rule","evenodd");var C=Z.createNS("http://www.w3.org/2000/svg","g");C.setAttributeNS(null,"fill-rule","nonzero");var O=Z.createNS("http://www.w3.org/2000/svg","g");O.setAttributeNS(null,"transform","translate(3.0, 29.0)"),O.setAttributeNS(null,"fill","#000000");for(var X=0,J=[{rx:"10.5",ry:"5.25002273"},{rx:"10.5",ry:"5.25002273"},{rx:"9.5",ry:"4.77275007"},{rx:"8.5",ry:"4.29549936"},{rx:"7.5",ry:"3.81822308"},{rx:"6.5",ry:"3.34094679"},{rx:"5.5",ry:"2.86367051"},{rx:"4.5",ry:"2.38636864"}];X<J.length;X+=1){var me=J[X],ye=Z.createNS("http://www.w3.org/2000/svg","ellipse");ye.setAttributeNS(null,"opacity","0.04"),ye.setAttributeNS(null,"cx","10.5"),ye.setAttributeNS(null,"cy","5.80029008"),ye.setAttributeNS(null,"rx",me.rx),ye.setAttributeNS(null,"ry",me.ry),O.appendChild(ye)}var Ae=Z.createNS("http://www.w3.org/2000/svg","g");Ae.setAttributeNS(null,"fill",this._color);var Ve=Z.createNS("http://www.w3.org/2000/svg","path");Ve.setAttributeNS(null,"d","M27,13.5 C27,19.074644 20.250001,27.000002 14.75,34.500002 C14.016665,35.500004 12.983335,35.500004 12.25,34.500002 C6.7499993,27.000002 0,19.222562 0,13.5 C0,6.0441559 6.0441559,0 13.5,0 C20.955844,0 27,6.0441559 27,13.5 Z"),Ae.appendChild(Ve);var Ue=Z.createNS("http://www.w3.org/2000/svg","g");Ue.setAttributeNS(null,"opacity","0.25"),Ue.setAttributeNS(null,"fill","#000000");var lt=Z.createNS("http://www.w3.org/2000/svg","path");lt.setAttributeNS(null,"d","M13.5,0 C6.0441559,0 0,6.0441559 0,13.5 C0,19.222562 6.7499993,27 12.25,34.5 C13,35.522727 14.016664,35.500004 14.75,34.5 C20.250001,27 27,19.074644 27,13.5 C27,6.0441559 20.955844,0 13.5,0 Z M13.5,1 C20.415404,1 26,6.584596 26,13.5 C26,15.898657 24.495584,19.181431 22.220703,22.738281 C19.945823,26.295132 16.705119,30.142167 13.943359,33.908203 C13.743445,34.180814 13.612715,34.322738 13.5,34.441406 C13.387285,34.322738 13.256555,34.180814 13.056641,33.908203 C10.284481,30.127985 7.4148684,26.314159 5.015625,22.773438 C2.6163816,19.232715 1,15.953538 1,13.5 C1,6.584596 6.584596,1 13.5,1 Z"),Ue.appendChild(lt);var Be=Z.createNS("http://www.w3.org/2000/svg","g");Be.setAttributeNS(null,"transform","translate(6.0, 7.0)"),Be.setAttributeNS(null,"fill","#FFFFFF");var st=Z.createNS("http://www.w3.org/2000/svg","g");st.setAttributeNS(null,"transform","translate(8.0, 8.0)");var xt=Z.createNS("http://www.w3.org/2000/svg","circle");xt.setAttributeNS(null,"fill","#000000"),xt.setAttributeNS(null,"opacity","0.25"),xt.setAttributeNS(null,"cx","5.5"),xt.setAttributeNS(null,"cy","5.5"),xt.setAttributeNS(null,"r","5.4999962");var Ut=Z.createNS("http://www.w3.org/2000/svg","circle");Ut.setAttributeNS(null,"fill","#FFFFFF"),Ut.setAttributeNS(null,"cx","5.5"),Ut.setAttributeNS(null,"cy","5.5"),Ut.setAttributeNS(null,"r","5.4999962"),st.appendChild(xt),st.appendChild(Ut),C.appendChild(O),C.appendChild(Ae),C.appendChild(Ue),C.appendChild(Be),C.appendChild(st),S.appendChild(C),S.setAttributeNS(null,"height",41*this._scale+"px"),S.setAttributeNS(null,"width",27*this._scale+"px"),this._element.appendChild(S),this._offset=_.Point.convert(p&&p.offset||[0,-14])}this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",function(ar){ar.preventDefault()}),this._element.addEventListener("mousedown",function(ar){ar.preventDefault()}),Zf(this._element,this._anchor,"marker"),this._popup=null}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.addTo=function(p){return this.remove(),this._map=p,p.getCanvasContainer().appendChild(this._element),p.on("move",this._update),p.on("moveend",this._update),this.setDraggable(this._draggable),this._update(),this._map.on("click",this._onMapClick),this},v.prototype.remove=function(){return this._map&&(this._map.off("click",this._onMapClick),this._map.off("move",this._update),this._map.off("moveend",this._update),this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler),this._map.off("mouseup",this._onUp),this._map.off("touchend",this._onUp),this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),delete this._map),Z.remove(this._element),this._popup&&this._popup.remove(),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(p){return this._lngLat=_.LngLat.convert(p),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(),this},v.prototype.getElement=function(){return this._element},v.prototype.setPopup=function(p){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),p){if(!("offset"in p.options)){var g=Math.sqrt(Math.pow(13.5,2)/2);p.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[g,-1*(24.6+g)],"bottom-right":[-g,-1*(24.6+g)],left:[13.5,-24.6],right:[-13.5,-24.6]}:this._offset}this._popup=p,this._lngLat&&this._popup.setLngLat(this._lngLat),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress)}return this},v.prototype._onKeyPress=function(p){var g=p.code,S=p.charCode||p.keyCode;g!=="Space"&&g!=="Enter"&&S!==32&&S!==13||this.togglePopup()},v.prototype._onMapClick=function(p){var g=p.originalEvent.target,S=this._element;this._popup&&(g===S||S.contains(g))&&this.togglePopup()},v.prototype.getPopup=function(){return this._popup},v.prototype.togglePopup=function(){var p=this._popup;return p?(p.isOpen()?p.remove():p.addTo(this._map),this):this},v.prototype._update=function(p){if(this._map){this._map.transform.renderWorldCopies&&(this._lngLat=ec(this._lngLat,this._pos,this._map.transform)),this._pos=this._map.project(this._lngLat)._add(this._offset);var g="";this._rotationAlignment==="viewport"||this._rotationAlignment==="auto"?g="rotateZ("+this._rotation+"deg)":this._rotationAlignment==="map"&&(g="rotateZ("+(this._rotation-this._map.getBearing())+"deg)");var S="";this._pitchAlignment==="viewport"||this._pitchAlignment==="auto"?S="rotateX(0deg)":this._pitchAlignment==="map"&&(S="rotateX("+this._map.getPitch()+"deg)"),p&&p.type!=="moveend"||(this._pos=this._pos.round()),Z.setTransform(this._element,Su[this._anchor]+" translate("+this._pos.x+"px, "+this._pos.y+"px) "+S+" "+g)}},v.prototype.getOffset=function(){return this._offset},v.prototype.setOffset=function(p){return this._offset=_.Point.convert(p),this._update(),this},v.prototype._onMove=function(p){if(!this._isDragging){var g=this._clickTolerance||this._map._clickTolerance;this._isDragging=p.point.dist(this._pointerdownPos)>=g}this._isDragging&&(this._pos=p.point.sub(this._positionDelta),this._lngLat=this._map.unproject(this._pos),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new _.Event("dragstart"))),this.fire(new _.Event("drag")))},v.prototype._onUp=function(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1,this._map.off("mousemove",this._onMove),this._map.off("touchmove",this._onMove),this._state==="active"&&this.fire(new _.Event("dragend")),this._state="inactive"},v.prototype._addDragHandler=function(p){this._element.contains(p.originalEvent.target)&&(p.preventDefault(),this._positionDelta=p.point.sub(this._pos).add(this._offset),this._pointerdownPos=p.point,this._state="pending",this._map.on("mousemove",this._onMove),this._map.on("touchmove",this._onMove),this._map.once("mouseup",this._onUp),this._map.once("touchend",this._onUp))},v.prototype.setDraggable=function(p){return this._draggable=!!p,this._map&&(p?(this._map.on("mousedown",this._addDragHandler),this._map.on("touchstart",this._addDragHandler)):(this._map.off("mousedown",this._addDragHandler),this._map.off("touchstart",this._addDragHandler))),this},v.prototype.isDraggable=function(){return this._draggable},v.prototype.setRotation=function(p){return this._rotation=p||0,this._update(),this},v.prototype.getRotation=function(){return this._rotation},v.prototype.setRotationAlignment=function(p){return this._rotationAlignment=p||"auto",this._update(),this},v.prototype.getRotationAlignment=function(){return this._rotationAlignment},v.prototype.setPitchAlignment=function(p){return this._pitchAlignment=p&&p!=="auto"?p:this._rotationAlignment,this._update(),this},v.prototype.getPitchAlignment=function(){return this._pitchAlignment},v}(_.Evented),Vf={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0},tc=0,rc=!1,Ah=function(h){function v(p){h.call(this),this.options=_.extend({},Vf,p),_.bindAll(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.onAdd=function(p){var g;return this._map=p,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),g=this._setupUI,Rc!==void 0?g(Rc):_.window.navigator.permissions!==void 0?_.window.navigator.permissions.query({name:"geolocation"}).then(function(S){g(Rc=S.state!=="denied")}):g(Rc=!!_.window.navigator.geolocation),this._container},v.prototype.onRemove=function(){this._geolocationWatchID!==void 0&&(_.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),Z.remove(this._container),this._map.off("zoom",this._onZoom),this._map=void 0,tc=0,rc=!1},v.prototype._isOutOfMapMaxBounds=function(p){var g=this._map.getMaxBounds(),S=p.coords;return g&&(S.longitude<g.getWest()||S.longitude>g.getEast()||S.latitude<g.getSouth()||S.latitude>g.getNorth())},v.prototype._setErrorState=function(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}},v.prototype._onSuccess=function(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new _.Event("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._dotElement.classList.remove("mapboxgl-user-location-dot-stale"),this.fire(new _.Event("geolocate",p)),this._finish()}},v.prototype._updateCamera=function(p){var g=new _.LngLat(p.coords.longitude,p.coords.latitude),S=p.coords.accuracy,w=this._map.getBearing(),C=_.extend({bearing:w},this.options.fitBoundsOptions);this._map.fitBounds(g.toBounds(S),C,{geolocateSource:!0})},v.prototype._updateMarker=function(p){if(p){var g=new _.LngLat(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(g).addTo(this._map),this._userLocationDotMarker.setLngLat(g).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()},v.prototype._updateCircleRadius=function(){var p=this._map._container.clientHeight/2,g=this._map.unproject([0,p]),S=this._map.unproject([1,p]),w=g.distanceTo(S),C=Math.ceil(2*this._accuracy/w);this._circleElement.style.width=C+"px",this._circleElement.style.height=C+"px"},v.prototype._onZoom=function(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()},v.prototype._onError=function(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;var g=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.title=g,this._geolocateButton.setAttribute("aria-label",g),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&rc)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._dotElement.classList.add("mapboxgl-user-location-dot-stale"),this.fire(new _.Event("error",p)),this._finish()}},v.prototype._finish=function(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0},v.prototype._setupUI=function(p){var g=this;if(this._container.addEventListener("contextmenu",function(C){return C.preventDefault()}),this._geolocateButton=Z.create("button","mapboxgl-ctrl-geolocate",this._container),Z.create("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden",!0),this._geolocateButton.type="button",p===!1){_.warnOnce("Geolocation support is not available so the GeolocateControl will be disabled.");var S=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.title=S,this._geolocateButton.setAttribute("aria-label",S)}else{var w=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.title=w,this._geolocateButton.setAttribute("aria-label",w)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=Z.create("div","mapboxgl-user-location-dot"),this._userLocationDotMarker=new sf(this._dotElement),this._circleElement=Z.create("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new sf({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",function(C){C.geolocateSource||g._watchState!=="ACTIVE_LOCK"||C.originalEvent&&C.originalEvent.type==="resize"||(g._watchState="BACKGROUND",g._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),g._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),g.fire(new _.Event("trackuserlocationend")))})},v.prototype.trigger=function(){if(!this._setup)return _.warnOnce("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new _.Event("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":tc--,rc=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new _.Event("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new _.Event("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){var p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),++tc>1?(p={maximumAge:6e5,timeout:0},rc=!0):(p=this.options.positionOptions,rc=!1),this._geolocationWatchID=_.window.navigator.geolocation.watchPosition(this._onSuccess,this._onError,p)}}else _.window.navigator.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=setTimeout(this._finish,1e4);return!0},v.prototype._clearWatch=function(){_.window.navigator.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)},v}(_.Evented),ss={maxWidth:100,unit:"metric"},Au=function(h){this.options=_.extend({},ss,h),_.bindAll(["_onMove","setUnit"],this)};function uf(h,v,p){var g=p&&p.maxWidth||100,S=h._container.clientHeight/2,w=h.unproject([0,S]),C=h.unproject([g,S]),O=w.distanceTo(C);if(p&&p.unit==="imperial"){var X=3.2808*O;X>5280?kl(v,g,X/5280,h._getUIString("ScaleControl.Miles")):kl(v,g,X,h._getUIString("ScaleControl.Feet"))}else p&&p.unit==="nautical"?kl(v,g,O/1852,h._getUIString("ScaleControl.NauticalMiles")):O>=1e3?kl(v,g,O/1e3,h._getUIString("ScaleControl.Kilometers")):kl(v,g,O,h._getUIString("ScaleControl.Meters"))}function kl(h,v,p,g){var S,w,C,O=(S=p,(w=Math.pow(10,(""+Math.floor(S)).length-1))*(C=(C=S/w)>=10?10:C>=5?5:C>=3?3:C>=2?2:C>=1?1:function(X){var J=Math.pow(10,Math.ceil(-Math.log(X)/Math.LN10));return Math.round(X*J)/J}(C)));h.style.width=v*(O/p)+"px",h.innerHTML=O+"&nbsp;"+g}Au.prototype.getDefaultPosition=function(){return"bottom-left"},Au.prototype._onMove=function(){uf(this._map,this._container,this.options)},Au.prototype.onAdd=function(h){return this._map=h,this._container=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-scale",h.getContainer()),this._map.on("move",this._onMove),this._onMove(),this._container},Au.prototype.onRemove=function(){Z.remove(this._container),this._map.off("move",this._onMove),this._map=void 0},Au.prototype.setUnit=function(h){this.options.unit=h,uf(this._map,this._container,this.options)};var uu=function(h){this._fullscreen=!1,h&&h.container&&(h.container instanceof _.window.HTMLElement?this._container=h.container:_.warnOnce("Full screen control 'container' must be a DOM element.")),_.bindAll(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in _.window.document?this._fullscreenchange="fullscreenchange":"onmozfullscreenchange"in _.window.document?this._fullscreenchange="mozfullscreenchange":"onwebkitfullscreenchange"in _.window.document?this._fullscreenchange="webkitfullscreenchange":"onmsfullscreenchange"in _.window.document&&(this._fullscreenchange="MSFullscreenChange")};uu.prototype.onAdd=function(h){return this._map=h,this._container||(this._container=this._map.getContainer()),this._controlContainer=Z.create("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",_.warnOnce("This device does not support fullscreen mode.")),this._controlContainer},uu.prototype.onRemove=function(){Z.remove(this._controlContainer),this._map=null,_.window.document.removeEventListener(this._fullscreenchange,this._changeIcon)},uu.prototype._checkFullscreenSupport=function(){return!!(_.window.document.fullscreenEnabled||_.window.document.mozFullScreenEnabled||_.window.document.msFullscreenEnabled||_.window.document.webkitFullscreenEnabled)},uu.prototype._setupUI=function(){var h=this._fullscreenButton=Z.create("button","mapboxgl-ctrl-fullscreen",this._controlContainer);Z.create("span","mapboxgl-ctrl-icon",h).setAttribute("aria-hidden",!0),h.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),_.window.document.addEventListener(this._fullscreenchange,this._changeIcon)},uu.prototype._updateTitle=function(){var h=this._getTitle();this._fullscreenButton.setAttribute("aria-label",h),this._fullscreenButton.title=h},uu.prototype._getTitle=function(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")},uu.prototype._isFullscreen=function(){return this._fullscreen},uu.prototype._changeIcon=function(){(_.window.document.fullscreenElement||_.window.document.mozFullScreenElement||_.window.document.webkitFullscreenElement||_.window.document.msFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())},uu.prototype._onClickFullscreen=function(){this._isFullscreen()?_.window.document.exitFullscreen?_.window.document.exitFullscreen():_.window.document.mozCancelFullScreen?_.window.document.mozCancelFullScreen():_.window.document.msExitFullscreen?_.window.document.msExitFullscreen():_.window.document.webkitCancelFullScreen&&_.window.document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.mozRequestFullScreen?this._container.mozRequestFullScreen():this._container.msRequestFullscreen?this._container.msRequestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()};var Th={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px"},ju=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", "),jf=function(h){function v(p){h.call(this),this.options=_.extend(Object.create(Th),p),_.bindAll(["_update","_onClose","remove","_onMouseMove","_onMouseUp","_onDrag"],this)}return h&&(v.__proto__=h),(v.prototype=Object.create(h&&h.prototype)).constructor=v,v.prototype.addTo=function(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&this._map.on("click",this._onClose),this.options.closeOnMove&&this._map.on("move",this._onClose),this._map.on("remove",this.remove),this._update(),this._focusFirstElement(),this._trackPointer?(this._map.on("mousemove",this._onMouseMove),this._map.on("mouseup",this._onMouseUp),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")):this._map.on("move",this._update),this.fire(new _.Event("open")),this},v.prototype.isOpen=function(){return!!this._map},v.prototype.remove=function(){return this._content&&Z.remove(this._content),this._container&&(Z.remove(this._container),delete this._container),this._map&&(this._map.off("move",this._update),this._map.off("move",this._onClose),this._map.off("click",this._onClose),this._map.off("remove",this.remove),this._map.off("mousemove",this._onMouseMove),this._map.off("mouseup",this._onMouseUp),this._map.off("drag",this._onDrag),delete this._map),this.fire(new _.Event("close")),this},v.prototype.getLngLat=function(){return this._lngLat},v.prototype.setLngLat=function(p){return this._lngLat=_.LngLat.convert(p),this._pos=null,this._trackPointer=!1,this._update(),this._map&&(this._map.on("move",this._update),this._map.off("mousemove",this._onMouseMove),this._container&&this._container.classList.remove("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.remove("mapboxgl-track-pointer")),this},v.prototype.trackPointer=function(){return this._trackPointer=!0,this._pos=null,this._update(),this._map&&(this._map.off("move",this._update),this._map.on("mousemove",this._onMouseMove),this._map.on("drag",this._onDrag),this._container&&this._container.classList.add("mapboxgl-popup-track-pointer"),this._map._canvasContainer.classList.add("mapboxgl-track-pointer")),this},v.prototype.getElement=function(){return this._container},v.prototype.setText=function(p){return this.setDOMContent(_.window.document.createTextNode(p))},v.prototype.setHTML=function(p){var g,S=_.window.document.createDocumentFragment(),w=_.window.document.createElement("body");for(w.innerHTML=p;g=w.firstChild;)S.appendChild(g);return this.setDOMContent(S)},v.prototype.getMaxWidth=function(){return this._container&&this._container.style.maxWidth},v.prototype.setMaxWidth=function(p){return this.options.maxWidth=p,this._update(),this},v.prototype.setDOMContent=function(p){if(this._content)for(;this._content.hasChildNodes();)this._content.firstChild&&this._content.removeChild(this._content.firstChild);else this._content=Z.create("div","mapboxgl-popup-content",this._container);return this._content.appendChild(p),this._createCloseButton(),this._update(),this._focusFirstElement(),this},v.prototype.addClassName=function(p){this._container&&this._container.classList.add(p)},v.prototype.removeClassName=function(p){this._container&&this._container.classList.remove(p)},v.prototype.setOffset=function(p){return this.options.offset=p,this._update(),this},v.prototype.toggleClassName=function(p){if(this._container)return this._container.classList.toggle(p)},v.prototype._createCloseButton=function(){this.options.closeButton&&(this._closeButton=Z.create("button","mapboxgl-popup-close-button",this._content),this._closeButton.type="button",this._closeButton.setAttribute("aria-label","Close popup"),this._closeButton.innerHTML="&#215;",this._closeButton.addEventListener("click",this._onClose))},v.prototype._onMouseUp=function(p){this._update(p.point)},v.prototype._onMouseMove=function(p){this._update(p.point)},v.prototype._onDrag=function(p){this._update(p.point)},v.prototype._update=function(p){var g=this;if(this._map&&(this._lngLat||this._trackPointer)&&this._content&&(this._container||(this._container=Z.create("div","mapboxgl-popup",this._map.getContainer()),this._tip=Z.create("div","mapboxgl-popup-tip",this._container),this._container.appendChild(this._content),this.options.className&&this.options.className.split(" ").forEach(function(ye){return g._container.classList.add(ye)}),this._trackPointer&&this._container.classList.add("mapboxgl-popup-track-pointer")),this.options.maxWidth&&this._container.style.maxWidth!==this.options.maxWidth&&(this._container.style.maxWidth=this.options.maxWidth),this._map.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=ec(this._lngLat,this._pos,this._map.transform)),!this._trackPointer||p)){var S=this._pos=this._trackPointer&&p?p:this._map.project(this._lngLat),w=this.options.anchor,C=function ye(Ae){if(Ae){if(typeof Ae=="number"){var Ve=Math.round(Math.sqrt(.5*Math.pow(Ae,2)));return{center:new _.Point(0,0),top:new _.Point(0,Ae),"top-left":new _.Point(Ve,Ve),"top-right":new _.Point(-Ve,Ve),bottom:new _.Point(0,-Ae),"bottom-left":new _.Point(Ve,-Ve),"bottom-right":new _.Point(-Ve,-Ve),left:new _.Point(Ae,0),right:new _.Point(-Ae,0)}}if(Ae instanceof _.Point||Array.isArray(Ae)){var Ue=_.Point.convert(Ae);return{center:Ue,top:Ue,"top-left":Ue,"top-right":Ue,bottom:Ue,"bottom-left":Ue,"bottom-right":Ue,left:Ue,right:Ue}}return{center:_.Point.convert(Ae.center||[0,0]),top:_.Point.convert(Ae.top||[0,0]),"top-left":_.Point.convert(Ae["top-left"]||[0,0]),"top-right":_.Point.convert(Ae["top-right"]||[0,0]),bottom:_.Point.convert(Ae.bottom||[0,0]),"bottom-left":_.Point.convert(Ae["bottom-left"]||[0,0]),"bottom-right":_.Point.convert(Ae["bottom-right"]||[0,0]),left:_.Point.convert(Ae.left||[0,0]),right:_.Point.convert(Ae.right||[0,0])}}return ye(new _.Point(0,0))}(this.options.offset);if(!w){var O,X=this._container.offsetWidth,J=this._container.offsetHeight;O=S.y+C.bottom.y<J?["top"]:S.y>this._map.transform.height-J?["bottom"]:[],S.x<X/2?O.push("left"):S.x>this._map.transform.width-X/2&&O.push("right"),w=O.length===0?"bottom":O.join("-")}var me=S.add(C[w]).round();Z.setTransform(this._container,Su[w]+" translate("+me.x+"px,"+me.y+"px)"),Zf(this._container,w,"popup")}},v.prototype._focusFirstElement=function(){if(this.options.focusAfterOpen&&this._container){var p=this._container.querySelector(ju);p&&p.focus()}},v.prototype._onClose=function(){this.remove()},v}(_.Evented),wh={version:_.version,supported:fe,setRTLTextPlugin:_.setRTLTextPlugin,getRTLTextPluginStatus:_.getRTLTextPluginStatus,Map:Sh,NavigationControl:cl,GeolocateControl:Ah,AttributionControl:os,ScaleControl:Au,FullscreenControl:uu,Popup:jf,Marker:sf,Style:Ls,LngLat:_.LngLat,LngLatBounds:_.LngLatBounds,Point:_.Point,MercatorCoordinate:_.MercatorCoordinate,Evented:_.Evented,config:_.config,prewarm:function(){rr().acquire(Yt)},clearPrewarmedResources:function(){var h=tn;h&&(h.isPreloaded()&&h.numActive()===1?(h.release(Yt),tn=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},get accessToken(){return _.config.ACCESS_TOKEN},set accessToken(h){_.config.ACCESS_TOKEN=h},get baseApiUrl(){return _.config.API_URL},set baseApiUrl(h){_.config.API_URL=h},get workerCount(){return gr.workerCount},set workerCount(h){gr.workerCount=h},get maxParallelImageRequests(){return _.config.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(h){_.config.MAX_PARALLEL_IMAGE_REQUESTS=h},clearStorage:function(h){_.clearTileCache(h)},workerUrl:""};return wh}),ee})},63713:function(Qt,re,U){"use strict";Qt.exports=ve;var ee=U(30551);function ve(ie){this.buf=ArrayBuffer.isView&&ArrayBuffer.isView(ie)?ie:new Uint8Array(ie||0),this.pos=0,this.type=0,this.length=this.buf.length}ve.Varint=0,ve.Fixed64=1,ve.Bytes=2,ve.Fixed32=5;var _=65536*65536,fe=1/_,Z=12,he=typeof TextDecoder=="undefined"?null:new TextDecoder("utf8");ve.prototype={destroy:function(){this.buf=null},readFields:function(ie,W,te){for(te=te||this.length;this.pos<te;){var Oe=this.readVarint(),Te=Oe>>3,nt=this.pos;this.type=Oe&7,ie(Te,W,this),this.pos===nt&&this.skip(Oe)}return W},readMessage:function(ie,W){return this.readFields(ie,W,this.readVarint()+this.pos)},readFixed32:function(){var ie=Ot(this.buf,this.pos);return this.pos+=4,ie},readSFixed32:function(){var ie=Ft(this.buf,this.pos);return this.pos+=4,ie},readFixed64:function(){var ie=Ot(this.buf,this.pos)+Ot(this.buf,this.pos+4)*_;return this.pos+=8,ie},readSFixed64:function(){var ie=Ot(this.buf,this.pos)+Ft(this.buf,this.pos+4)*_;return this.pos+=8,ie},readFloat:function(){var ie=ee.read(this.buf,this.pos,!0,23,4);return this.pos+=4,ie},readDouble:function(){var ie=ee.read(this.buf,this.pos,!0,52,8);return this.pos+=8,ie},readVarint:function(ie){var W=this.buf,te,Oe;return Oe=W[this.pos++],te=Oe&127,Oe<128||(Oe=W[this.pos++],te|=(Oe&127)<<7,Oe<128)||(Oe=W[this.pos++],te|=(Oe&127)<<14,Oe<128)||(Oe=W[this.pos++],te|=(Oe&127)<<21,Oe<128)?te:(Oe=W[this.pos],te|=(Oe&15)<<28,ce(te,ie,this))},readVarint64:function(){return this.readVarint(!0)},readSVarint:function(){var ie=this.readVarint();return ie%2===1?(ie+1)/-2:ie/2},readBoolean:function(){return!!this.readVarint()},readString:function(){var ie=this.readVarint()+this.pos,W=this.pos;return this.pos=ie,ie-W>=Z&&he?Nt(this.buf,W,ie):Qe(this.buf,W,ie)},readBytes:function(){var ie=this.readVarint()+this.pos,W=this.buf.subarray(this.pos,ie);return this.pos=ie,W},readPackedVarint:function(ie,W){if(this.type!==ve.Bytes)return ie.push(this.readVarint(W));var te=Ge(this);for(ie=ie||[];this.pos<te;)ie.push(this.readVarint(W));return ie},readPackedSVarint:function(ie){if(this.type!==ve.Bytes)return ie.push(this.readSVarint());var W=Ge(this);for(ie=ie||[];this.pos<W;)ie.push(this.readSVarint());return ie},readPackedBoolean:function(ie){if(this.type!==ve.Bytes)return ie.push(this.readBoolean());var W=Ge(this);for(ie=ie||[];this.pos<W;)ie.push(this.readBoolean());return ie},readPackedFloat:function(ie){if(this.type!==ve.Bytes)return ie.push(this.readFloat());var W=Ge(this);for(ie=ie||[];this.pos<W;)ie.push(this.readFloat());return ie},readPackedDouble:function(ie){if(this.type!==ve.Bytes)return ie.push(this.readDouble());var W=Ge(this);for(ie=ie||[];this.pos<W;)ie.push(this.readDouble());return ie},readPackedFixed32:function(ie){if(this.type!==ve.Bytes)return ie.push(this.readFixed32());var W=Ge(this);for(ie=ie||[];this.pos<W;)ie.push(this.readFixed32());return ie},readPackedSFixed32:function(ie){if(this.type!==ve.Bytes)return ie.push(this.readSFixed32());var W=Ge(this);for(ie=ie||[];this.pos<W;)ie.push(this.readSFixed32());return ie},readPackedFixed64:function(ie){if(this.type!==ve.Bytes)return ie.push(this.readFixed64());var W=Ge(this);for(ie=ie||[];this.pos<W;)ie.push(this.readFixed64());return ie},readPackedSFixed64:function(ie){if(this.type!==ve.Bytes)return ie.push(this.readSFixed64());var W=Ge(this);for(ie=ie||[];this.pos<W;)ie.push(this.readSFixed64());return ie},skip:function(ie){var W=ie&7;if(W===ve.Varint)for(;this.buf[this.pos++]>127;);else if(W===ve.Bytes)this.pos=this.readVarint()+this.pos;else if(W===ve.Fixed32)this.pos+=4;else if(W===ve.Fixed64)this.pos+=8;else throw new Error("Unimplemented type: "+W)},writeTag:function(ie,W){this.writeVarint(ie<<3|W)},realloc:function(ie){for(var W=this.length||16;W<this.pos+ie;)W*=2;if(W!==this.length){var te=new Uint8Array(W);te.set(this.buf),this.buf=te,this.length=W}},finish:function(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)},writeFixed32:function(ie){this.realloc(4),ht(this.buf,ie,this.pos),this.pos+=4},writeSFixed32:function(ie){this.realloc(4),ht(this.buf,ie,this.pos),this.pos+=4},writeFixed64:function(ie){this.realloc(8),ht(this.buf,ie&-1,this.pos),ht(this.buf,Math.floor(ie*fe),this.pos+4),this.pos+=8},writeSFixed64:function(ie){this.realloc(8),ht(this.buf,ie&-1,this.pos),ht(this.buf,Math.floor(ie*fe),this.pos+4),this.pos+=8},writeVarint:function(ie){if(ie=+ie||0,ie>268435455||ie<0){We(ie,this);return}this.realloc(4),this.buf[this.pos++]=ie&127|(ie>127?128:0),!(ie<=127)&&(this.buf[this.pos++]=(ie>>>=7)&127|(ie>127?128:0),!(ie<=127)&&(this.buf[this.pos++]=(ie>>>=7)&127|(ie>127?128:0),!(ie<=127)&&(this.buf[this.pos++]=ie>>>7&127)))},writeSVarint:function(ie){this.writeVarint(ie<0?-ie*2-1:ie*2)},writeBoolean:function(ie){this.writeVarint(!!ie)},writeString:function(ie){ie=String(ie),this.realloc(ie.length*4),this.pos++;var W=this.pos;this.pos=sr(this.buf,ie,this.pos);var te=this.pos-W;te>=128&&vt(W,te,this),this.pos=W-1,this.writeVarint(te),this.pos+=te},writeFloat:function(ie){this.realloc(4),ee.write(this.buf,ie,this.pos,!0,23,4),this.pos+=4},writeDouble:function(ie){this.realloc(8),ee.write(this.buf,ie,this.pos,!0,52,8),this.pos+=8},writeBytes:function(ie){var W=ie.length;this.writeVarint(W),this.realloc(W);for(var te=0;te<W;te++)this.buf[this.pos++]=ie[te]},writeRawMessage:function(ie,W){this.pos++;var te=this.pos;ie(W,this);var Oe=this.pos-te;Oe>=128&&vt(te,Oe,this),this.pos=te-1,this.writeVarint(Oe),this.pos+=Oe},writeMessage:function(ie,W,te){this.writeTag(ie,ve.Bytes),this.writeRawMessage(W,te)},writePackedVarint:function(ie,W){W.length&&this.writeMessage(ie,bt,W)},writePackedSVarint:function(ie,W){W.length&&this.writeMessage(ie,Et,W)},writePackedBoolean:function(ie,W){W.length&&this.writeMessage(ie,at,W)},writePackedFloat:function(ie,W){W.length&&this.writeMessage(ie,Dt,W)},writePackedDouble:function(ie,W){W.length&&this.writeMessage(ie,wt,W)},writePackedFixed32:function(ie,W){W.length&&this.writeMessage(ie,Tt,W)},writePackedSFixed32:function(ie,W){W.length&&this.writeMessage(ie,wr,W)},writePackedFixed64:function(ie,W){W.length&&this.writeMessage(ie,pr,W)},writePackedSFixed64:function(ie,W){W.length&&this.writeMessage(ie,lr,W)},writeBytesField:function(ie,W){this.writeTag(ie,ve.Bytes),this.writeBytes(W)},writeFixed32Field:function(ie,W){this.writeTag(ie,ve.Fixed32),this.writeFixed32(W)},writeSFixed32Field:function(ie,W){this.writeTag(ie,ve.Fixed32),this.writeSFixed32(W)},writeFixed64Field:function(ie,W){this.writeTag(ie,ve.Fixed64),this.writeFixed64(W)},writeSFixed64Field:function(ie,W){this.writeTag(ie,ve.Fixed64),this.writeSFixed64(W)},writeVarintField:function(ie,W){this.writeTag(ie,ve.Varint),this.writeVarint(W)},writeSVarintField:function(ie,W){this.writeTag(ie,ve.Varint),this.writeSVarint(W)},writeStringField:function(ie,W){this.writeTag(ie,ve.Bytes),this.writeString(W)},writeFloatField:function(ie,W){this.writeTag(ie,ve.Fixed32),this.writeFloat(W)},writeDoubleField:function(ie,W){this.writeTag(ie,ve.Fixed64),this.writeDouble(W)},writeBooleanField:function(ie,W){this.writeVarintField(ie,!!W)}};function ce(ie,W,te){var Oe=te.buf,Te,nt;if(nt=Oe[te.pos++],Te=(nt&112)>>4,nt<128||(nt=Oe[te.pos++],Te|=(nt&127)<<3,nt<128)||(nt=Oe[te.pos++],Te|=(nt&127)<<10,nt<128)||(nt=Oe[te.pos++],Te|=(nt&127)<<17,nt<128)||(nt=Oe[te.pos++],Te|=(nt&127)<<24,nt<128)||(nt=Oe[te.pos++],Te|=(nt&1)<<31,nt<128))return oe(ie,Te,W);throw new Error("Expected varint not more than 10 bytes")}function Ge(ie){return ie.type===ve.Bytes?ie.readVarint()+ie.pos:ie.pos+1}function oe(ie,W,te){return te?W*4294967296+(ie>>>0):(W>>>0)*4294967296+(ie>>>0)}function We(ie,W){var te,Oe;if(ie>=0?(te=ie%4294967296|0,Oe=ie/4294967296|0):(te=~(-ie%4294967296),Oe=~(-ie/4294967296),te^4294967295?te=te+1|0:(te=0,Oe=Oe+1|0)),ie>=18446744073709552e3||ie<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");W.realloc(10),qe(te,Oe,W),pt(Oe,W)}function qe(ie,W,te){te.buf[te.pos++]=ie&127|128,ie>>>=7,te.buf[te.pos++]=ie&127|128,ie>>>=7,te.buf[te.pos++]=ie&127|128,ie>>>=7,te.buf[te.pos++]=ie&127|128,ie>>>=7,te.buf[te.pos]=ie&127}function pt(ie,W){var te=(ie&7)<<4;W.buf[W.pos++]|=te|((ie>>>=3)?128:0),ie&&(W.buf[W.pos++]=ie&127|((ie>>>=7)?128:0),ie&&(W.buf[W.pos++]=ie&127|((ie>>>=7)?128:0),ie&&(W.buf[W.pos++]=ie&127|((ie>>>=7)?128:0),ie&&(W.buf[W.pos++]=ie&127|((ie>>>=7)?128:0),ie&&(W.buf[W.pos++]=ie&127)))))}function vt(ie,W,te){var Oe=W<=16383?1:W<=2097151?2:W<=268435455?3:Math.floor(Math.log(W)/(Math.LN2*7));te.realloc(Oe);for(var Te=te.pos-1;Te>=ie;Te--)te.buf[Te+Oe]=te.buf[Te]}function bt(ie,W){for(var te=0;te<ie.length;te++)W.writeVarint(ie[te])}function Et(ie,W){for(var te=0;te<ie.length;te++)W.writeSVarint(ie[te])}function Dt(ie,W){for(var te=0;te<ie.length;te++)W.writeFloat(ie[te])}function wt(ie,W){for(var te=0;te<ie.length;te++)W.writeDouble(ie[te])}function at(ie,W){for(var te=0;te<ie.length;te++)W.writeBoolean(ie[te])}function Tt(ie,W){for(var te=0;te<ie.length;te++)W.writeFixed32(ie[te])}function wr(ie,W){for(var te=0;te<ie.length;te++)W.writeSFixed32(ie[te])}function pr(ie,W){for(var te=0;te<ie.length;te++)W.writeFixed64(ie[te])}function lr(ie,W){for(var te=0;te<ie.length;te++)W.writeSFixed64(ie[te])}function Ot(ie,W){return(ie[W]|ie[W+1]<<8|ie[W+2]<<16)+ie[W+3]*16777216}function ht(ie,W,te){ie[te]=W,ie[te+1]=W>>>8,ie[te+2]=W>>>16,ie[te+3]=W>>>24}function Ft(ie,W){return(ie[W]|ie[W+1]<<8|ie[W+2]<<16)+(ie[W+3]<<24)}function Qe(ie,W,te){for(var Oe="",Te=W;Te<te;){var nt=ie[Te],De=null,Ze=nt>239?4:nt>223?3:nt>191?2:1;if(Te+Ze>te)break;var Ke,At,dr;Ze===1?nt<128&&(De=nt):Ze===2?(Ke=ie[Te+1],(Ke&192)===128&&(De=(nt&31)<<6|Ke&63,De<=127&&(De=null))):Ze===3?(Ke=ie[Te+1],At=ie[Te+2],(Ke&192)===128&&(At&192)===128&&(De=(nt&15)<<12|(Ke&63)<<6|At&63,(De<=2047||De>=55296&&De<=57343)&&(De=null))):Ze===4&&(Ke=ie[Te+1],At=ie[Te+2],dr=ie[Te+3],(Ke&192)===128&&(At&192)===128&&(dr&192)===128&&(De=(nt&15)<<18|(Ke&63)<<12|(At&63)<<6|dr&63,(De<=65535||De>=1114112)&&(De=null))),De===null?(De=65533,Ze=1):De>65535&&(De-=65536,Oe+=String.fromCharCode(De>>>10&1023|55296),De=56320|De&1023),Oe+=String.fromCharCode(De),Te+=Ze}return Oe}function Nt(ie,W,te){return he.decode(ie.subarray(W,te))}function sr(ie,W,te){for(var Oe=0,Te,nt;Oe<W.length;Oe++){if(Te=W.charCodeAt(Oe),Te>55295&&Te<57344)if(nt)if(Te<56320){ie[te++]=239,ie[te++]=191,ie[te++]=189,nt=Te;continue}else Te=nt-55296<<10|Te-56320|65536,nt=null;else{Te>56319||Oe+1===W.length?(ie[te++]=239,ie[te++]=191,ie[te++]=189):nt=Te;continue}else nt&&(ie[te++]=239,ie[te++]=191,ie[te++]=189,nt=null);Te<128?ie[te++]=Te:(Te<2048?ie[te++]=Te>>6|192:(Te<65536?ie[te++]=Te>>12|224:(ie[te++]=Te>>18|240,ie[te++]=Te>>12&63|128),ie[te++]=Te>>6&63|128),ie[te++]=Te&63|128)}return te}},41227:function(Qt,re,U){var ee=U(14224);(function(ve,_){Qt.exports=_()})(this,function(){"use strict";function ve(ue,D){var z={label:0,sent:function(){if(ke[0]&1)throw ke[1];return ke[1]},trys:[],ops:[]},se,be,ke,Ht;return Ht={next:Mt(0),throw:Mt(1),return:Mt(2)},typeof Symbol=="function"&&(Ht[Symbol.iterator]=function(){return this}),Ht;function Mt(mt){return function(N){return Lt([mt,N])}}function Lt(mt){if(se)throw new TypeError("Generator is already executing.");for(;z;)try{if(se=1,be&&(ke=mt[0]&2?be.return:mt[0]?be.throw||((ke=be.return)&&ke.call(be),0):be.next)&&!(ke=ke.call(be,mt[1])).done)return ke;switch(be=0,ke&&(mt=[mt[0]&2,ke.value]),mt[0]){case 0:case 1:ke=mt;break;case 4:return z.label++,{value:mt[1],done:!1};case 5:z.label++,be=mt[1],mt=[0];continue;case 7:mt=z.ops.pop(),z.trys.pop();continue;default:if(ke=z.trys,!(ke=ke.length>0&&ke[ke.length-1])&&(mt[0]===6||mt[0]===2)){z=0;continue}if(mt[0]===3&&(!ke||mt[1]>ke[0]&&mt[1]<ke[3])){z.label=mt[1];break}if(mt[0]===6&&z.label<ke[1]){z.label=ke[1],ke=mt;break}if(ke&&z.label<ke[2]){z.label=ke[2],z.ops.push(mt);break}ke[2]&&z.ops.pop(),z.trys.pop();continue}mt=D.call(ue,z)}catch(N){mt=[6,N],be=0}finally{se=ke=0}if(mt[0]&5)throw mt[1];return{value:mt[0]?mt[1]:void 0,done:!0}}}var _=function(){function ue(D,z){this.next=null,this.key=D,this.data=z,this.left=null,this.right=null}return ue}();function fe(ue,D){return ue>D?1:ue<D?-1:0}function Z(ue,D,z){for(var se=new _(null,null),be=se,ke=se;;){var Ht=z(ue,D.key);if(Ht<0){if(D.left===null)break;if(z(ue,D.left.key)<0){var Mt=D.left;if(D.left=Mt.right,Mt.right=D,D=Mt,D.left===null)break}ke.left=D,ke=D,D=D.left}else if(Ht>0){if(D.right===null)break;if(z(ue,D.right.key)>0){var Mt=D.right;if(D.right=Mt.left,Mt.left=D,D=Mt,D.right===null)break}be.right=D,be=D,D=D.right}else break}return be.right=D.left,ke.left=D.right,D.left=se.right,D.right=se.left,D}function he(ue,D,z,se){var be=new _(ue,D);if(z===null)return be.left=be.right=null,be;z=Z(ue,z,se);var ke=se(ue,z.key);return ke<0?(be.left=z.left,be.right=z,z.left=null):ke>=0&&(be.right=z.right,be.left=z,z.right=null),be}function ce(ue,D,z){var se=null,be=null;if(D){D=Z(ue,D,z);var ke=z(D.key,ue);ke===0?(se=D.left,be=D.right):ke<0?(be=D.right,D.right=null,se=D):(se=D.left,D.left=null,be=D)}return{left:se,right:be}}function Ge(ue,D,z){return D===null?ue:(ue===null||(D=Z(ue.key,D,z),D.left=ue),D)}function oe(ue,D,z,se,be){if(ue){se(""+D+(z?"\u2514\u2500\u2500 ":"\u251C\u2500\u2500 ")+be(ue)+`
`);var ke=D+(z?"    ":"\u2502   ");ue.left&&oe(ue.left,ke,!1,se,be),ue.right&&oe(ue.right,ke,!0,se,be)}}var We=function(){function ue(D){D===void 0&&(D=fe),this._root=null,this._size=0,this._comparator=D}return ue.prototype.insert=function(D,z){return this._size++,this._root=he(D,z,this._root,this._comparator)},ue.prototype.add=function(D,z){var se=new _(D,z);this._root===null&&(se.left=se.right=null,this._size++,this._root=se);var be=this._comparator,ke=Z(D,this._root,be),Ht=be(D,ke.key);return Ht===0?this._root=ke:(Ht<0?(se.left=ke.left,se.right=ke,ke.left=null):Ht>0&&(se.right=ke.right,se.left=ke,ke.right=null),this._size++,this._root=se),this._root},ue.prototype.remove=function(D){this._root=this._remove(D,this._root,this._comparator)},ue.prototype._remove=function(D,z,se){var be;if(z===null)return null;z=Z(D,z,se);var ke=se(D,z.key);return ke===0?(z.left===null?be=z.right:(be=Z(D,z.left,se),be.right=z.right),this._size--,be):z},ue.prototype.pop=function(){var D=this._root;if(D){for(;D.left;)D=D.left;return this._root=Z(D.key,this._root,this._comparator),this._root=this._remove(D.key,this._root,this._comparator),{key:D.key,data:D.data}}return null},ue.prototype.findStatic=function(D){for(var z=this._root,se=this._comparator;z;){var be=se(D,z.key);if(be===0)return z;be<0?z=z.left:z=z.right}return null},ue.prototype.find=function(D){return this._root&&(this._root=Z(D,this._root,this._comparator),this._comparator(D,this._root.key)!==0)?null:this._root},ue.prototype.contains=function(D){for(var z=this._root,se=this._comparator;z;){var be=se(D,z.key);if(be===0)return!0;be<0?z=z.left:z=z.right}return!1},ue.prototype.forEach=function(D,z){for(var se=this._root,be=[],ke=!1;!ke;)se!==null?(be.push(se),se=se.left):be.length!==0?(se=be.pop(),D.call(z,se),se=se.right):ke=!0;return this},ue.prototype.range=function(D,z,se,be){for(var ke=[],Ht=this._comparator,Mt=this._root,Lt;ke.length!==0||Mt;)if(Mt)ke.push(Mt),Mt=Mt.left;else{if(Mt=ke.pop(),Lt=Ht(Mt.key,z),Lt>0)break;if(Ht(Mt.key,D)>=0&&se.call(be,Mt))return this;Mt=Mt.right}return this},ue.prototype.keys=function(){var D=[];return this.forEach(function(z){var se=z.key;return D.push(se)}),D},ue.prototype.values=function(){var D=[];return this.forEach(function(z){var se=z.data;return D.push(se)}),D},ue.prototype.min=function(){return this._root?this.minNode(this._root).key:null},ue.prototype.max=function(){return this._root?this.maxNode(this._root).key:null},ue.prototype.minNode=function(D){if(D===void 0&&(D=this._root),D)for(;D.left;)D=D.left;return D},ue.prototype.maxNode=function(D){if(D===void 0&&(D=this._root),D)for(;D.right;)D=D.right;return D},ue.prototype.at=function(D){for(var z=this._root,se=!1,be=0,ke=[];!se;)if(z)ke.push(z),z=z.left;else if(ke.length>0){if(z=ke.pop(),be===D)return z;be++,z=z.right}else se=!0;return null},ue.prototype.next=function(D){var z=this._root,se=null;if(D.right){for(se=D.right;se.left;)se=se.left;return se}for(var be=this._comparator;z;){var ke=be(D.key,z.key);if(ke===0)break;ke<0?(se=z,z=z.left):z=z.right}return se},ue.prototype.prev=function(D){var z=this._root,se=null;if(D.left!==null){for(se=D.left;se.right;)se=se.right;return se}for(var be=this._comparator;z;){var ke=be(D.key,z.key);if(ke===0)break;ke<0?z=z.left:(se=z,z=z.right)}return se},ue.prototype.clear=function(){return this._root=null,this._size=0,this},ue.prototype.toList=function(){return vt(this._root)},ue.prototype.load=function(D,z,se){z===void 0&&(z=[]),se===void 0&&(se=!1);var be=D.length,ke=this._comparator;if(se&&Dt(D,z,0,be-1,ke),this._root===null)this._root=qe(D,z,0,be),this._size=be;else{var Ht=Et(this.toList(),pt(D,z),ke);be=this._size+be,this._root=bt({head:Ht},0,be)}return this},ue.prototype.isEmpty=function(){return this._root===null},Object.defineProperty(ue.prototype,"size",{get:function(){return this._size},enumerable:!0,configurable:!0}),Object.defineProperty(ue.prototype,"root",{get:function(){return this._root},enumerable:!0,configurable:!0}),ue.prototype.toString=function(D){D===void 0&&(D=function(se){return String(se.key)});var z=[];return oe(this._root,"",!0,function(se){return z.push(se)},D),z.join("")},ue.prototype.update=function(D,z,se){var be=this._comparator,ke=ce(D,this._root,be),Ht=ke.left,Mt=ke.right;be(D,z)<0?Mt=he(z,se,Mt,be):Ht=he(z,se,Ht,be),this._root=Ge(Ht,Mt,be)},ue.prototype.split=function(D){return ce(D,this._root,this._comparator)},ue.prototype[Symbol.iterator]=function(){var D,z,se;return ve(this,function(be){switch(be.label){case 0:D=this._root,z=[],se=!1,be.label=1;case 1:return se?[3,6]:D===null?[3,2]:(z.push(D),D=D.left,[3,5]);case 2:return z.length===0?[3,4]:(D=z.pop(),[4,D]);case 3:return be.sent(),D=D.right,[3,5];case 4:se=!0,be.label=5;case 5:return[3,1];case 6:return[2]}})},ue}();function qe(ue,D,z,se){var be=se-z;if(be>0){var ke=z+Math.floor(be/2),Ht=ue[ke],Mt=D[ke],Lt=new _(Ht,Mt);return Lt.left=qe(ue,D,z,ke),Lt.right=qe(ue,D,ke+1,se),Lt}return null}function pt(ue,D){for(var z=new _(null,null),se=z,be=0;be<ue.length;be++)se=se.next=new _(ue[be],D[be]);return se.next=null,z.next}function vt(ue){for(var D=ue,z=[],se=!1,be=new _(null,null),ke=be;!se;)D?(z.push(D),D=D.left):z.length>0?(D=ke=ke.next=z.pop(),D=D.right):se=!0;return ke.next=null,be.next}function bt(ue,D,z){var se=z-D;if(se>0){var be=D+Math.floor(se/2),ke=bt(ue,D,be),Ht=ue.head;return Ht.left=ke,ue.head=ue.head.next,Ht.right=bt(ue,be+1,z),Ht}return null}function Et(ue,D,z){for(var se=new _(null,null),be=se,ke=ue,Ht=D;ke!==null&&Ht!==null;)z(ke.key,Ht.key)<0?(be.next=ke,ke=ke.next):(be.next=Ht,Ht=Ht.next),be=be.next;return ke!==null?be.next=ke:Ht!==null&&(be.next=Ht),se.next}function Dt(ue,D,z,se,be){if(!(z>=se)){for(var ke=ue[z+se>>1],Ht=z-1,Mt=se+1;;){do Ht++;while(be(ue[Ht],ke)<0);do Mt--;while(be(ue[Mt],ke)>0);if(Ht>=Mt)break;var Lt=ue[Ht];ue[Ht]=ue[Mt],ue[Mt]=Lt,Lt=D[Ht],D[Ht]=D[Mt],D[Mt]=Lt}Dt(ue,D,z,Mt,be),Dt(ue,D,Mt+1,se,be)}}const wt=(ue,D)=>ue.ll.x<=D.x&&D.x<=ue.ur.x&&ue.ll.y<=D.y&&D.y<=ue.ur.y,at=(ue,D)=>{if(D.ur.x<ue.ll.x||ue.ur.x<D.ll.x||D.ur.y<ue.ll.y||ue.ur.y<D.ll.y)return null;const z=ue.ll.x<D.ll.x?D.ll.x:ue.ll.x,se=ue.ur.x<D.ur.x?ue.ur.x:D.ur.x,be=ue.ll.y<D.ll.y?D.ll.y:ue.ll.y,ke=ue.ur.y<D.ur.y?ue.ur.y:D.ur.y;return{ll:{x:z,y:be},ur:{x:se,y:ke}}};let Tt=Number.EPSILON;Tt===void 0&&(Tt=Math.pow(2,-52));const wr=Tt*Tt,pr=(ue,D)=>{if(-Tt<ue&&ue<Tt&&-Tt<D&&D<Tt)return 0;const z=ue-D;return z*z<wr*ue*D?0:ue<D?-1:1};class lr{constructor(){this.reset()}reset(){this.xRounder=new Ot,this.yRounder=new Ot}round(D,z){return{x:this.xRounder.round(D),y:this.yRounder.round(z)}}}class Ot{constructor(){this.tree=new We,this.round(0)}round(D){const z=this.tree.add(D),se=this.tree.prev(z);if(se!==null&&pr(z.key,se.key)===0)return this.tree.remove(D),se.key;const be=this.tree.next(z);return be!==null&&pr(z.key,be.key)===0?(this.tree.remove(D),be.key):D}}const ht=new lr,Ft=11102230246251565e-32,Qe=134217729,Nt=(3+8*Ft)*Ft;function sr(ue,D,z,se,be){let ke,Ht,Mt,Lt,mt=D[0],N=se[0],B=0,$=0;N>mt==N>-mt?(ke=mt,mt=D[++B]):(ke=N,N=se[++$]);let ne=0;if(B<ue&&$<z)for(N>mt==N>-mt?(Ht=mt+ke,Mt=ke-(Ht-mt),mt=D[++B]):(Ht=N+ke,Mt=ke-(Ht-N),N=se[++$]),ke=Ht,Mt!==0&&(be[ne++]=Mt);B<ue&&$<z;)N>mt==N>-mt?(Ht=ke+mt,Lt=Ht-ke,Mt=ke-(Ht-Lt)+(mt-Lt),mt=D[++B]):(Ht=ke+N,Lt=Ht-ke,Mt=ke-(Ht-Lt)+(N-Lt),N=se[++$]),ke=Ht,Mt!==0&&(be[ne++]=Mt);for(;B<ue;)Ht=ke+mt,Lt=Ht-ke,Mt=ke-(Ht-Lt)+(mt-Lt),mt=D[++B],ke=Ht,Mt!==0&&(be[ne++]=Mt);for(;$<z;)Ht=ke+N,Lt=Ht-ke,Mt=ke-(Ht-Lt)+(N-Lt),N=se[++$],ke=Ht,Mt!==0&&(be[ne++]=Mt);return(ke!==0||ne===0)&&(be[ne++]=ke),ne}function ie(ue,D){let z=D[0];for(let se=1;se<ue;se++)z+=D[se];return z}function W(ue){return new Float64Array(ue)}const te=(3+16*Ft)*Ft,Oe=(2+12*Ft)*Ft,Te=(9+64*Ft)*Ft*Ft,nt=W(4),De=W(8),Ze=W(12),Ke=W(16),At=W(4);function dr(ue,D,z,se,be,ke,Ht){let Mt,Lt,mt,N,B,$,ne,xe,Fe,et,j,Q,Le,rt,Ee,Yt,gr,tn;const Qr=ue-be,rr=z-be,Xr=D-ke,zr=se-ke;rt=Qr*zr,$=Qe*Qr,ne=$-($-Qr),xe=Qr-ne,$=Qe*zr,Fe=$-($-zr),et=zr-Fe,Ee=xe*et-(rt-ne*Fe-xe*Fe-ne*et),Yt=Xr*rr,$=Qe*Xr,ne=$-($-Xr),xe=Xr-ne,$=Qe*rr,Fe=$-($-rr),et=rr-Fe,gr=xe*et-(Yt-ne*Fe-xe*Fe-ne*et),j=Ee-gr,B=Ee-j,nt[0]=Ee-(j+B)+(B-gr),Q=rt+j,B=Q-rt,Le=rt-(Q-B)+(j-B),j=Le-Yt,B=Le-j,nt[1]=Le-(j+B)+(B-Yt),tn=Q+j,B=tn-Q,nt[2]=Q-(tn-B)+(j-B),nt[3]=tn;let Vr=ie(4,nt),ei=Oe*Ht;if(Vr>=ei||-Vr>=ei||(B=ue-Qr,Mt=ue-(Qr+B)+(B-be),B=z-rr,mt=z-(rr+B)+(B-be),B=D-Xr,Lt=D-(Xr+B)+(B-ke),B=se-zr,N=se-(zr+B)+(B-ke),Mt===0&&Lt===0&&mt===0&&N===0)||(ei=Te*Ht+Nt*Math.abs(Vr),Vr+=Qr*N+zr*Mt-(Xr*mt+rr*Lt),Vr>=ei||-Vr>=ei))return Vr;rt=Mt*zr,$=Qe*Mt,ne=$-($-Mt),xe=Mt-ne,$=Qe*zr,Fe=$-($-zr),et=zr-Fe,Ee=xe*et-(rt-ne*Fe-xe*Fe-ne*et),Yt=Lt*rr,$=Qe*Lt,ne=$-($-Lt),xe=Lt-ne,$=Qe*rr,Fe=$-($-rr),et=rr-Fe,gr=xe*et-(Yt-ne*Fe-xe*Fe-ne*et),j=Ee-gr,B=Ee-j,At[0]=Ee-(j+B)+(B-gr),Q=rt+j,B=Q-rt,Le=rt-(Q-B)+(j-B),j=Le-Yt,B=Le-j,At[1]=Le-(j+B)+(B-Yt),tn=Q+j,B=tn-Q,At[2]=Q-(tn-B)+(j-B),At[3]=tn;const sn=sr(4,nt,4,At,De);rt=Qr*N,$=Qe*Qr,ne=$-($-Qr),xe=Qr-ne,$=Qe*N,Fe=$-($-N),et=N-Fe,Ee=xe*et-(rt-ne*Fe-xe*Fe-ne*et),Yt=Xr*mt,$=Qe*Xr,ne=$-($-Xr),xe=Xr-ne,$=Qe*mt,Fe=$-($-mt),et=mt-Fe,gr=xe*et-(Yt-ne*Fe-xe*Fe-ne*et),j=Ee-gr,B=Ee-j,At[0]=Ee-(j+B)+(B-gr),Q=rt+j,B=Q-rt,Le=rt-(Q-B)+(j-B),j=Le-Yt,B=Le-j,At[1]=Le-(j+B)+(B-Yt),tn=Q+j,B=tn-Q,At[2]=Q-(tn-B)+(j-B),At[3]=tn;const hi=sr(sn,De,4,At,Ze);rt=Mt*N,$=Qe*Mt,ne=$-($-Mt),xe=Mt-ne,$=Qe*N,Fe=$-($-N),et=N-Fe,Ee=xe*et-(rt-ne*Fe-xe*Fe-ne*et),Yt=Lt*mt,$=Qe*Lt,ne=$-($-Lt),xe=Lt-ne,$=Qe*mt,Fe=$-($-mt),et=mt-Fe,gr=xe*et-(Yt-ne*Fe-xe*Fe-ne*et),j=Ee-gr,B=Ee-j,At[0]=Ee-(j+B)+(B-gr),Q=rt+j,B=Q-rt,Le=rt-(Q-B)+(j-B),j=Le-Yt,B=Le-j,At[1]=Le-(j+B)+(B-Yt),tn=Q+j,B=tn-Q,At[2]=Q-(tn-B)+(j-B),At[3]=tn;const Vi=sr(hi,Ze,4,At,Ke);return Ke[Vi-1]}function Pt(ue,D,z,se,be,ke){const Ht=(D-ke)*(z-be),Mt=(ue-be)*(se-ke),Lt=Ht-Mt,mt=Math.abs(Ht+Mt);return Math.abs(Lt)>=te*mt?Lt:-dr(ue,D,z,se,be,ke,mt)}const fn=(ue,D)=>ue.x*D.y-ue.y*D.x,cn=(ue,D)=>ue.x*D.x+ue.y*D.y,Lr=(ue,D,z)=>{const se=Pt(ue.x,ue.y,D.x,D.y,z.x,z.y);return se>0?-1:se<0?1:0},Fn=ue=>Math.sqrt(cn(ue,ue)),Sn=(ue,D,z)=>{const se={x:D.x-ue.x,y:D.y-ue.y},be={x:z.x-ue.x,y:z.y-ue.y};return fn(be,se)/Fn(be)/Fn(se)},Jr=(ue,D,z)=>{const se={x:D.x-ue.x,y:D.y-ue.y},be={x:z.x-ue.x,y:z.y-ue.y};return cn(be,se)/Fn(be)/Fn(se)},bi=(ue,D,z)=>D.y===0?null:{x:ue.x+D.x/D.y*(z-ue.y),y:z},Gn=(ue,D,z)=>D.x===0?null:{x:z,y:ue.y+D.y/D.x*(z-ue.x)},zi=(ue,D,z,se)=>{if(D.x===0)return Gn(z,se,ue.x);if(se.x===0)return Gn(ue,D,z.x);if(D.y===0)return bi(z,se,ue.y);if(se.y===0)return bi(ue,D,z.y);const be=fn(D,se);if(be==0)return null;const ke={x:z.x-ue.x,y:z.y-ue.y},Ht=fn(ke,D)/be,Mt=fn(ke,se)/be,Lt=ue.x+Mt*D.x,mt=z.x+Ht*se.x,N=ue.y+Mt*D.y,B=z.y+Ht*se.y,$=(Lt+mt)/2,ne=(N+B)/2;return{x:$,y:ne}};class bn{static compare(D,z){const se=bn.comparePoints(D.point,z.point);return se!==0?se:(D.point!==z.point&&D.link(z),D.isLeft!==z.isLeft?D.isLeft?1:-1:Aa.compare(D.segment,z.segment))}static comparePoints(D,z){return D.x<z.x?-1:D.x>z.x?1:D.y<z.y?-1:D.y>z.y?1:0}constructor(D,z){D.events===void 0?D.events=[this]:D.events.push(this),this.point=D,this.isLeft=z}link(D){if(D.point===this.point)throw new Error("Tried to link already linked events");const z=D.point.events;for(let se=0,be=z.length;se<be;se++){const ke=z[se];this.point.events.push(ke),ke.point=this.point}this.checkForConsuming()}checkForConsuming(){const D=this.point.events.length;for(let z=0;z<D;z++){const se=this.point.events[z];if(se.segment.consumedBy===void 0)for(let be=z+1;be<D;be++){const ke=this.point.events[be];ke.consumedBy===void 0&&se.otherSE.point.events===ke.otherSE.point.events&&se.segment.consume(ke.segment)}}}getAvailableLinkedEvents(){const D=[];for(let z=0,se=this.point.events.length;z<se;z++){const be=this.point.events[z];be!==this&&!be.segment.ringOut&&be.segment.isInResult()&&D.push(be)}return D}getLeftmostComparator(D){const z=new Map,se=be=>{const ke=be.otherSE;z.set(be,{sine:Sn(this.point,D.point,ke.point),cosine:Jr(this.point,D.point,ke.point)})};return(be,ke)=>{z.has(be)||se(be),z.has(ke)||se(ke);const{sine:Ht,cosine:Mt}=z.get(be),{sine:Lt,cosine:mt}=z.get(ke);return Ht>=0&&Lt>=0?Mt<mt?1:Mt>mt?-1:0:Ht<0&&Lt<0?Mt<mt?-1:Mt>mt?1:0:Lt<Ht?-1:Lt>Ht?1:0}}}let Pn=0;class Aa{static compare(D,z){const se=D.leftSE.point.x,be=z.leftSE.point.x,ke=D.rightSE.point.x,Ht=z.rightSE.point.x;if(Ht<se)return 1;if(ke<be)return-1;const Mt=D.leftSE.point.y,Lt=z.leftSE.point.y,mt=D.rightSE.point.y,N=z.rightSE.point.y;if(se<be){if(Lt<Mt&&Lt<mt)return 1;if(Lt>Mt&&Lt>mt)return-1;const B=D.comparePoint(z.leftSE.point);if(B<0)return 1;if(B>0)return-1;const $=z.comparePoint(D.rightSE.point);return $!==0?$:-1}if(se>be){if(Mt<Lt&&Mt<N)return-1;if(Mt>Lt&&Mt>N)return 1;const B=z.comparePoint(D.leftSE.point);if(B!==0)return B;const $=D.comparePoint(z.rightSE.point);return $<0?1:$>0?-1:1}if(Mt<Lt)return-1;if(Mt>Lt)return 1;if(ke<Ht){const B=z.comparePoint(D.rightSE.point);if(B!==0)return B}if(ke>Ht){const B=D.comparePoint(z.rightSE.point);if(B<0)return 1;if(B>0)return-1}if(ke!==Ht){const B=mt-Mt,$=ke-se,ne=N-Lt,xe=Ht-be;if(B>$&&ne<xe)return 1;if(B<$&&ne>xe)return-1}return ke>Ht?1:ke<Ht||mt<N?-1:mt>N?1:D.id<z.id?-1:D.id>z.id?1:0}constructor(D,z,se,be){this.id=++Pn,this.leftSE=D,D.segment=this,D.otherSE=z,this.rightSE=z,z.segment=this,z.otherSE=D,this.rings=se,this.windings=be}static fromRing(D,z,se){let be,ke,Ht;const Mt=bn.comparePoints(D,z);if(Mt<0)be=D,ke=z,Ht=1;else if(Mt>0)be=z,ke=D,Ht=-1;else throw new Error(`Tried to create degenerate segment at [${D.x}, ${D.y}]`);const Lt=new bn(be,!0),mt=new bn(ke,!1);return new Aa(Lt,mt,[se],[Ht])}replaceRightSE(D){this.rightSE=D,this.rightSE.segment=this,this.rightSE.otherSE=this.leftSE,this.leftSE.otherSE=this.rightSE}bbox(){const D=this.leftSE.point.y,z=this.rightSE.point.y;return{ll:{x:this.leftSE.point.x,y:D<z?D:z},ur:{x:this.rightSE.point.x,y:D>z?D:z}}}vector(){return{x:this.rightSE.point.x-this.leftSE.point.x,y:this.rightSE.point.y-this.leftSE.point.y}}isAnEndpoint(D){return D.x===this.leftSE.point.x&&D.y===this.leftSE.point.y||D.x===this.rightSE.point.x&&D.y===this.rightSE.point.y}comparePoint(D){if(this.isAnEndpoint(D))return 0;const z=this.leftSE.point,se=this.rightSE.point,be=this.vector();if(z.x===se.x)return D.x===z.x?0:D.x<z.x?1:-1;const ke=(D.y-z.y)/be.y,Ht=z.x+ke*be.x;if(D.x===Ht)return 0;const Mt=(D.x-z.x)/be.x,Lt=z.y+Mt*be.y;return D.y===Lt?0:D.y<Lt?-1:1}getIntersection(D){const z=this.bbox(),se=D.bbox(),be=at(z,se);if(be===null)return null;const ke=this.leftSE.point,Ht=this.rightSE.point,Mt=D.leftSE.point,Lt=D.rightSE.point,mt=wt(z,Mt)&&this.comparePoint(Mt)===0,N=wt(se,ke)&&D.comparePoint(ke)===0,B=wt(z,Lt)&&this.comparePoint(Lt)===0,$=wt(se,Ht)&&D.comparePoint(Ht)===0;if(N&&mt)return $&&!B?Ht:!$&&B?Lt:null;if(N)return B&&ke.x===Lt.x&&ke.y===Lt.y?null:ke;if(mt)return $&&Ht.x===Mt.x&&Ht.y===Mt.y?null:Mt;if($&&B)return null;if($)return Ht;if(B)return Lt;const ne=zi(ke,this.vector(),Mt,D.vector());return ne===null||!wt(be,ne)?null:ht.round(ne.x,ne.y)}split(D){const z=[],se=D.events!==void 0,be=new bn(D,!0),ke=new bn(D,!1),Ht=this.rightSE;this.replaceRightSE(ke),z.push(ke),z.push(be);const Mt=new Aa(be,Ht,this.rings.slice(),this.windings.slice());return bn.comparePoints(Mt.leftSE.point,Mt.rightSE.point)>0&&Mt.swapEvents(),bn.comparePoints(this.leftSE.point,this.rightSE.point)>0&&this.swapEvents(),se&&(be.checkForConsuming(),ke.checkForConsuming()),z}swapEvents(){const D=this.rightSE;this.rightSE=this.leftSE,this.leftSE=D,this.leftSE.isLeft=!0,this.rightSE.isLeft=!1;for(let z=0,se=this.windings.length;z<se;z++)this.windings[z]*=-1}consume(D){let z=this,se=D;for(;z.consumedBy;)z=z.consumedBy;for(;se.consumedBy;)se=se.consumedBy;const be=Aa.compare(z,se);if(be!==0){if(be>0){const ke=z;z=se,se=ke}if(z.prev===se){const ke=z;z=se,se=ke}for(let ke=0,Ht=se.rings.length;ke<Ht;ke++){const Mt=se.rings[ke],Lt=se.windings[ke],mt=z.rings.indexOf(Mt);mt===-1?(z.rings.push(Mt),z.windings.push(Lt)):z.windings[mt]+=Lt}se.rings=null,se.windings=null,se.consumedBy=z,se.leftSE.consumedBy=z.leftSE,se.rightSE.consumedBy=z.rightSE}}prevInResult(){return this._prevInResult!==void 0?this._prevInResult:(this.prev?this.prev.isInResult()?this._prevInResult=this.prev:this._prevInResult=this.prev.prevInResult():this._prevInResult=null,this._prevInResult)}beforeState(){if(this._beforeState!==void 0)return this._beforeState;if(!this.prev)this._beforeState={rings:[],windings:[],multiPolys:[]};else{const D=this.prev.consumedBy||this.prev;this._beforeState=D.afterState()}return this._beforeState}afterState(){if(this._afterState!==void 0)return this._afterState;const D=this.beforeState();this._afterState={rings:D.rings.slice(0),windings:D.windings.slice(0),multiPolys:[]};const z=this._afterState.rings,se=this._afterState.windings,be=this._afterState.multiPolys;for(let Mt=0,Lt=this.rings.length;Mt<Lt;Mt++){const mt=this.rings[Mt],N=this.windings[Mt],B=z.indexOf(mt);B===-1?(z.push(mt),se.push(N)):se[B]+=N}const ke=[],Ht=[];for(let Mt=0,Lt=z.length;Mt<Lt;Mt++){if(se[Mt]===0)continue;const mt=z[Mt],N=mt.poly;if(Ht.indexOf(N)===-1)if(mt.isExterior)ke.push(N);else{Ht.indexOf(N)===-1&&Ht.push(N);const B=ke.indexOf(mt.poly);B!==-1&&ke.splice(B,1)}}for(let Mt=0,Lt=ke.length;Mt<Lt;Mt++){const mt=ke[Mt].multiPoly;be.indexOf(mt)===-1&&be.push(mt)}return this._afterState}isInResult(){if(this.consumedBy)return!1;if(this._isInResult!==void 0)return this._isInResult;const D=this.beforeState().multiPolys,z=this.afterState().multiPolys;switch(Wt.type){case"union":{const se=D.length===0,be=z.length===0;this._isInResult=se!==be;break}case"intersection":{let se,be;D.length<z.length?(se=D.length,be=z.length):(se=z.length,be=D.length),this._isInResult=be===Wt.numMultiPolys&&se<be;break}case"xor":{const se=Math.abs(D.length-z.length);this._isInResult=se%2===1;break}case"difference":{const se=be=>be.length===1&&be[0].isSubject;this._isInResult=se(D)!==se(z);break}default:throw new Error(`Unrecognized operation type found ${Wt.type}`)}return this._isInResult}}class Zi{constructor(D,z,se){if(!Array.isArray(D)||D.length===0)throw new Error("Input geometry is not a valid Polygon or MultiPolygon");if(this.poly=z,this.isExterior=se,this.segments=[],typeof D[0][0]!="number"||typeof D[0][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");const be=ht.round(D[0][0],D[0][1]);this.bbox={ll:{x:be.x,y:be.y},ur:{x:be.x,y:be.y}};let ke=be;for(let Ht=1,Mt=D.length;Ht<Mt;Ht++){if(typeof D[Ht][0]!="number"||typeof D[Ht][1]!="number")throw new Error("Input geometry is not a valid Polygon or MultiPolygon");let Lt=ht.round(D[Ht][0],D[Ht][1]);Lt.x===ke.x&&Lt.y===ke.y||(this.segments.push(Aa.fromRing(ke,Lt,this)),Lt.x<this.bbox.ll.x&&(this.bbox.ll.x=Lt.x),Lt.y<this.bbox.ll.y&&(this.bbox.ll.y=Lt.y),Lt.x>this.bbox.ur.x&&(this.bbox.ur.x=Lt.x),Lt.y>this.bbox.ur.y&&(this.bbox.ur.y=Lt.y),ke=Lt)}(be.x!==ke.x||be.y!==ke.y)&&this.segments.push(Aa.fromRing(ke,be,this))}getSweepEvents(){const D=[];for(let z=0,se=this.segments.length;z<se;z++){const be=this.segments[z];D.push(be.leftSE),D.push(be.rightSE)}return D}}class Ma{constructor(D,z){if(!Array.isArray(D))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");this.exteriorRing=new Zi(D[0],this,!0),this.bbox={ll:{x:this.exteriorRing.bbox.ll.x,y:this.exteriorRing.bbox.ll.y},ur:{x:this.exteriorRing.bbox.ur.x,y:this.exteriorRing.bbox.ur.y}},this.interiorRings=[];for(let se=1,be=D.length;se<be;se++){const ke=new Zi(D[se],this,!1);ke.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ke.bbox.ll.x),ke.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ke.bbox.ll.y),ke.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ke.bbox.ur.x),ke.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ke.bbox.ur.y),this.interiorRings.push(ke)}this.multiPoly=z}getSweepEvents(){const D=this.exteriorRing.getSweepEvents();for(let z=0,se=this.interiorRings.length;z<se;z++){const be=this.interiorRings[z].getSweepEvents();for(let ke=0,Ht=be.length;ke<Ht;ke++)D.push(be[ke])}return D}}class To{constructor(D,z){if(!Array.isArray(D))throw new Error("Input geometry is not a valid Polygon or MultiPolygon");try{typeof D[0][0][0]=="number"&&(D=[D])}catch(se){}this.polys=[],this.bbox={ll:{x:Number.POSITIVE_INFINITY,y:Number.POSITIVE_INFINITY},ur:{x:Number.NEGATIVE_INFINITY,y:Number.NEGATIVE_INFINITY}};for(let se=0,be=D.length;se<be;se++){const ke=new Ma(D[se],this);ke.bbox.ll.x<this.bbox.ll.x&&(this.bbox.ll.x=ke.bbox.ll.x),ke.bbox.ll.y<this.bbox.ll.y&&(this.bbox.ll.y=ke.bbox.ll.y),ke.bbox.ur.x>this.bbox.ur.x&&(this.bbox.ur.x=ke.bbox.ur.x),ke.bbox.ur.y>this.bbox.ur.y&&(this.bbox.ur.y=ke.bbox.ur.y),this.polys.push(ke)}this.isSubject=z}getSweepEvents(){const D=[];for(let z=0,se=this.polys.length;z<se;z++){const be=this.polys[z].getSweepEvents();for(let ke=0,Ht=be.length;ke<Ht;ke++)D.push(be[ke])}return D}}class Ce{static factory(D){const z=[];for(let se=0,be=D.length;se<be;se++){const ke=D[se];if(!ke.isInResult()||ke.ringOut)continue;let Ht=null,Mt=ke.leftSE,Lt=ke.rightSE;const mt=[Mt],N=Mt.point,B=[];for(;Ht=Mt,Mt=Lt,mt.push(Mt),Mt.point!==N;)for(;;){const $=Mt.getAvailableLinkedEvents();if($.length===0){const Fe=mt[0].point,et=mt[mt.length-1].point;throw new Error(`Unable to complete output ring starting at [${Fe.x}, ${Fe.y}]. Last matching segment found ends at [${et.x}, ${et.y}].`)}if($.length===1){Lt=$[0].otherSE;break}let ne=null;for(let Fe=0,et=B.length;Fe<et;Fe++)if(B[Fe].point===Mt.point){ne=Fe;break}if(ne!==null){const Fe=B.splice(ne)[0],et=mt.splice(Fe.index);et.unshift(et[0].otherSE),z.push(new Ce(et.reverse()));continue}B.push({index:mt.length,point:Mt.point});const xe=Mt.getLeftmostComparator(Ht);Lt=$.sort(xe)[0].otherSE;break}z.push(new Ce(mt))}return z}constructor(D){this.events=D;for(let z=0,se=D.length;z<se;z++)D[z].segment.ringOut=this;this.poly=null}getGeom(){let D=this.events[0].point;const z=[D];for(let mt=1,N=this.events.length-1;mt<N;mt++){const B=this.events[mt].point,$=this.events[mt+1].point;Lr(B,D,$)!==0&&(z.push(B),D=B)}if(z.length===1)return null;const se=z[0],be=z[1];Lr(se,D,be)===0&&z.shift(),z.push(z[0]);const ke=this.isExteriorRing()?1:-1,Ht=this.isExteriorRing()?0:z.length-1,Mt=this.isExteriorRing()?z.length:-1,Lt=[];for(let mt=Ht;mt!=Mt;mt+=ke)Lt.push([z[mt].x,z[mt].y]);return Lt}isExteriorRing(){if(this._isExteriorRing===void 0){const D=this.enclosingRing();this._isExteriorRing=D?!D.isExteriorRing():!0}return this._isExteriorRing}enclosingRing(){return this._enclosingRing===void 0&&(this._enclosingRing=this._calcEnclosingRing()),this._enclosingRing}_calcEnclosingRing(){let D=this.events[0];for(let be=1,ke=this.events.length;be<ke;be++){const Ht=this.events[be];bn.compare(D,Ht)>0&&(D=Ht)}let z=D.segment.prevInResult(),se=z?z.prevInResult():null;for(;;){if(!z)return null;if(!se)return z.ringOut;if(se.ringOut!==z.ringOut)return se.ringOut.enclosingRing()!==z.ringOut?z.ringOut:z.ringOut.enclosingRing();z=se.prevInResult(),se=z?z.prevInResult():null}}}class Ia{constructor(D){this.exteriorRing=D,D.poly=this,this.interiorRings=[]}addInterior(D){this.interiorRings.push(D),D.poly=this}getGeom(){const D=[this.exteriorRing.getGeom()];if(D[0]===null)return null;for(let z=0,se=this.interiorRings.length;z<se;z++){const be=this.interiorRings[z].getGeom();be!==null&&D.push(be)}return D}}class Ta{constructor(D){this.rings=D,this.polys=this._composePolys(D)}getGeom(){const D=[];for(let z=0,se=this.polys.length;z<se;z++){const be=this.polys[z].getGeom();be!==null&&D.push(be)}return D}_composePolys(D){const z=[];for(let se=0,be=D.length;se<be;se++){const ke=D[se];if(!ke.poly)if(ke.isExteriorRing())z.push(new Ia(ke));else{const Ht=ke.enclosingRing();Ht.poly||z.push(new Ia(Ht)),Ht.poly.addInterior(ke)}}return z}}class no{constructor(D){let z=arguments.length>1&&arguments[1]!==void 0?arguments[1]:Aa.compare;this.queue=D,this.tree=new We(z),this.segments=[]}process(D){const z=D.segment,se=[];if(D.consumedBy)return D.isLeft?this.queue.remove(D.otherSE):this.tree.remove(z),se;const be=D.isLeft?this.tree.add(z):this.tree.find(z);if(!be)throw new Error(`Unable to find segment #${z.id} [${z.leftSE.point.x}, ${z.leftSE.point.y}] -> [${z.rightSE.point.x}, ${z.rightSE.point.y}] in SweepLine tree.`);let ke=be,Ht=be,Mt,Lt;for(;Mt===void 0;)ke=this.tree.prev(ke),ke===null?Mt=null:ke.key.consumedBy===void 0&&(Mt=ke.key);for(;Lt===void 0;)Ht=this.tree.next(Ht),Ht===null?Lt=null:Ht.key.consumedBy===void 0&&(Lt=Ht.key);if(D.isLeft){let mt=null;if(Mt){const B=Mt.getIntersection(z);if(B!==null&&(z.isAnEndpoint(B)||(mt=B),!Mt.isAnEndpoint(B))){const $=this._splitSafely(Mt,B);for(let ne=0,xe=$.length;ne<xe;ne++)se.push($[ne])}}let N=null;if(Lt){const B=Lt.getIntersection(z);if(B!==null&&(z.isAnEndpoint(B)||(N=B),!Lt.isAnEndpoint(B))){const $=this._splitSafely(Lt,B);for(let ne=0,xe=$.length;ne<xe;ne++)se.push($[ne])}}if(mt!==null||N!==null){let B=null;mt===null?B=N:N===null?B=mt:B=bn.comparePoints(mt,N)<=0?mt:N,this.queue.remove(z.rightSE),se.push(z.rightSE);const $=z.split(B);for(let ne=0,xe=$.length;ne<xe;ne++)se.push($[ne])}se.length>0?(this.tree.remove(z),se.push(D)):(this.segments.push(z),z.prev=Mt)}else{if(Mt&&Lt){const mt=Mt.getIntersection(Lt);if(mt!==null){if(!Mt.isAnEndpoint(mt)){const N=this._splitSafely(Mt,mt);for(let B=0,$=N.length;B<$;B++)se.push(N[B])}if(!Lt.isAnEndpoint(mt)){const N=this._splitSafely(Lt,mt);for(let B=0,$=N.length;B<$;B++)se.push(N[B])}}}this.tree.remove(z)}return se}_splitSafely(D,z){this.tree.remove(D);const se=D.rightSE;this.queue.remove(se);const be=D.split(z);return be.push(se),D.consumedBy===void 0&&this.tree.add(D),be}}const qs=typeof ee!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_QUEUE_SIZE||1e6,Rs=typeof ee!="undefined"&&{NODE_ENV:"production",PUBLIC_PATH:"/"}.POLYGON_CLIPPING_MAX_SWEEPLINE_SEGMENTS||1e6;class ts{run(D,z,se){Wt.type=D,ht.reset();const be=[new To(z,!0)];for(let B=0,$=se.length;B<$;B++)be.push(new To(se[B],!1));if(Wt.numMultiPolys=be.length,Wt.type==="difference"){const B=be[0];let $=1;for(;$<be.length;)at(be[$].bbox,B.bbox)!==null?$++:be.splice($,1)}if(Wt.type==="intersection")for(let B=0,$=be.length;B<$;B++){const ne=be[B];for(let xe=B+1,Fe=be.length;xe<Fe;xe++)if(at(ne.bbox,be[xe].bbox)===null)return[]}const ke=new We(bn.compare);for(let B=0,$=be.length;B<$;B++){const ne=be[B].getSweepEvents();for(let xe=0,Fe=ne.length;xe<Fe;xe++)if(ke.insert(ne[xe]),ke.size>qs)throw new Error("Infinite loop when putting segment endpoints in a priority queue (queue size too big).")}const Ht=new no(ke);let Mt=ke.size,Lt=ke.pop();for(;Lt;){const B=Lt.key;if(ke.size===Mt){const ne=B.segment;throw new Error(`Unable to pop() ${B.isLeft?"left":"right"} SweepEvent [${B.point.x}, ${B.point.y}] from segment #${ne.id} [${ne.leftSE.point.x}, ${ne.leftSE.point.y}] -> [${ne.rightSE.point.x}, ${ne.rightSE.point.y}] from queue.`)}if(ke.size>qs)throw new Error("Infinite loop when passing sweep line over endpoints (queue size too big).");if(Ht.segments.length>Rs)throw new Error("Infinite loop when passing sweep line over endpoints (too many sweep line segments).");const $=Ht.process(B);for(let ne=0,xe=$.length;ne<xe;ne++){const Fe=$[ne];Fe.consumedBy===void 0&&ke.insert(Fe)}Mt=ke.size,Lt=ke.pop()}ht.reset();const mt=Ce.factory(Ht.segments);return new Ta(mt).getGeom()}}const Wt=new ts;var Ki={union:function(ue){for(var D=arguments.length,z=new Array(D>1?D-1:0),se=1;se<D;se++)z[se-1]=arguments[se];return Wt.run("union",ue,z)},intersection:function(ue){for(var D=arguments.length,z=new Array(D>1?D-1:0),se=1;se<D;se++)z[se-1]=arguments[se];return Wt.run("intersection",ue,z)},xor:function(ue){for(var D=arguments.length,z=new Array(D>1?D-1:0),se=1;se<D;se++)z[se-1]=arguments[se];return Wt.run("xor",ue,z)},difference:function(ue){for(var D=arguments.length,z=new Array(D>1?D-1:0),se=1;se<D;se++)z[se-1]=arguments[se];return Wt.run("difference",ue,z)}};return Ki})},18041:function(Qt,re,U){var ee=U(14224);var ve;(function(_){(function(fe){var Z=typeof U.g=="object"?U.g:typeof self=="object"?self:typeof this=="object"?this:Function("return this;")(),he=ce(_);typeof Z.Reflect=="undefined"?Z.Reflect=_:he=ce(Z.Reflect,he),fe(he);function ce(Ge,oe){return function(We,qe){typeof Ge[We]!="function"&&Object.defineProperty(Ge,We,{configurable:!0,writable:!0,value:qe}),oe&&oe(We,qe)}}})(function(fe){var Z=Object.prototype.hasOwnProperty,he=typeof Symbol=="function",ce=he&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ge=he&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",oe=typeof Object.create=="function",We={__proto__:[]}instanceof Array,qe=!oe&&!We,pt={create:oe?function(){return ts(Object.create(null))}:We?function(){return ts({__proto__:null})}:function(){return ts({})},has:qe?function(Wt,xr){return Z.call(Wt,xr)}:function(Wt,xr){return xr in Wt},get:qe?function(Wt,xr){return Z.call(Wt,xr)?Wt[xr]:void 0}:function(Wt,xr){return Wt[xr]}},vt=Object.getPrototypeOf(Function),bt=typeof ee=="object"&&ee["env"]&&ee["env"].REFLECT_METADATA_USE_MAP_POLYFILL==="true",Et=!bt&&typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:no(),Dt=!bt&&typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:qs(),wt=!bt&&typeof WeakMap=="function"?WeakMap:Rs(),at=new wt;function Tt(Wt,xr,Gr,nn){if(Pt(Gr)){if(!zi(Wt))throw new TypeError;if(!Pn(xr))throw new TypeError;return ie(Wt,xr)}else{if(!zi(Wt))throw new TypeError;if(!Lr(xr))throw new TypeError;if(!Lr(nn)&&!Pt(nn)&&!fn(nn))throw new TypeError;return fn(nn)&&(nn=void 0),Gr=Gn(Gr),W(Wt,xr,Gr,nn)}}fe("decorate",Tt);function wr(Wt,xr){function Gr(nn,Nn){if(!Lr(nn))throw new TypeError;if(!Pt(Nn)&&!Aa(Nn))throw new TypeError;Ze(Wt,xr,nn,Nn)}return Gr}fe("metadata",wr);function pr(Wt,xr,Gr,nn){if(!Lr(Gr))throw new TypeError;return Pt(nn)||(nn=Gn(nn)),Ze(Wt,xr,Gr,nn)}fe("defineMetadata",pr);function lr(Wt,xr,Gr){if(!Lr(xr))throw new TypeError;return Pt(Gr)||(Gr=Gn(Gr)),Oe(Wt,xr,Gr)}fe("hasMetadata",lr);function Ot(Wt,xr,Gr){if(!Lr(xr))throw new TypeError;return Pt(Gr)||(Gr=Gn(Gr)),Te(Wt,xr,Gr)}fe("hasOwnMetadata",Ot);function ht(Wt,xr,Gr){if(!Lr(xr))throw new TypeError;return Pt(Gr)||(Gr=Gn(Gr)),nt(Wt,xr,Gr)}fe("getMetadata",ht);function Ft(Wt,xr,Gr){if(!Lr(xr))throw new TypeError;return Pt(Gr)||(Gr=Gn(Gr)),De(Wt,xr,Gr)}fe("getOwnMetadata",Ft);function Qe(Wt,xr){if(!Lr(Wt))throw new TypeError;return Pt(xr)||(xr=Gn(xr)),Ke(Wt,xr)}fe("getMetadataKeys",Qe);function Nt(Wt,xr){if(!Lr(Wt))throw new TypeError;return Pt(xr)||(xr=Gn(xr)),At(Wt,xr)}fe("getOwnMetadataKeys",Nt);function sr(Wt,xr,Gr){if(!Lr(xr))throw new TypeError;Pt(Gr)||(Gr=Gn(Gr));var nn=te(xr,Gr,!1);if(Pt(nn)||!nn.delete(Wt))return!1;if(nn.size>0)return!0;var Nn=at.get(xr);return Nn.delete(Gr),Nn.size>0||at.delete(xr),!0}fe("deleteMetadata",sr);function ie(Wt,xr){for(var Gr=Wt.length-1;Gr>=0;--Gr){var nn=Wt[Gr],Nn=nn(xr);if(!Pt(Nn)&&!fn(Nn)){if(!Pn(Nn))throw new TypeError;xr=Nn}}return xr}function W(Wt,xr,Gr,nn){for(var Nn=Wt.length-1;Nn>=0;--Nn){var Ki=Wt[Nn],ue=Ki(xr,Gr,nn);if(!Pt(ue)&&!fn(ue)){if(!Lr(ue))throw new TypeError;nn=ue}}return nn}function te(Wt,xr,Gr){var nn=at.get(Wt);if(Pt(nn)){if(!Gr)return;nn=new Et,at.set(Wt,nn)}var Nn=nn.get(xr);if(Pt(Nn)){if(!Gr)return;Nn=new Et,nn.set(xr,Nn)}return Nn}function Oe(Wt,xr,Gr){var nn=Te(Wt,xr,Gr);if(nn)return!0;var Nn=Ta(xr);return fn(Nn)?!1:Oe(Wt,Nn,Gr)}function Te(Wt,xr,Gr){var nn=te(xr,Gr,!1);return Pt(nn)?!1:Jr(nn.has(Wt))}function nt(Wt,xr,Gr){var nn=Te(Wt,xr,Gr);if(nn)return De(Wt,xr,Gr);var Nn=Ta(xr);if(!fn(Nn))return nt(Wt,Nn,Gr)}function De(Wt,xr,Gr){var nn=te(xr,Gr,!1);if(!Pt(nn))return nn.get(Wt)}function Ze(Wt,xr,Gr,nn){var Nn=te(Gr,nn,!0);Nn.set(Wt,xr)}function Ke(Wt,xr){var Gr=At(Wt,xr),nn=Ta(Wt);if(nn===null)return Gr;var Nn=Ke(nn,xr);if(Nn.length<=0)return Gr;if(Gr.length<=0)return Nn;for(var Ki=new Dt,ue=[],D=0,z=Gr;D<z.length;D++){var se=z[D],be=Ki.has(se);be||(Ki.add(se),ue.push(se))}for(var ke=0,Ht=Nn;ke<Ht.length;ke++){var se=Ht[ke],be=Ki.has(se);be||(Ki.add(se),ue.push(se))}return ue}function At(Wt,xr){var Gr=[],nn=te(Wt,xr,!1);if(Pt(nn))return Gr;for(var Nn=nn.keys(),Ki=Ma(Nn),ue=0;;){var D=Ce(Ki);if(!D)return Gr.length=ue,Gr;var z=To(D);try{Gr[ue]=z}catch(se){try{Ia(Ki)}finally{throw se}}ue++}}function dr(Wt){if(Wt===null)return 1;switch(typeof Wt){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return Wt===null?1:6;default:return 6}}function Pt(Wt){return Wt===void 0}function fn(Wt){return Wt===null}function cn(Wt){return typeof Wt=="symbol"}function Lr(Wt){return typeof Wt=="object"?Wt!==null:typeof Wt=="function"}function Fn(Wt,xr){switch(dr(Wt)){case 0:return Wt;case 1:return Wt;case 2:return Wt;case 3:return Wt;case 4:return Wt;case 5:return Wt}var Gr=xr===3?"string":xr===5?"number":"default",nn=Zi(Wt,ce);if(nn!==void 0){var Nn=nn.call(Wt,Gr);if(Lr(Nn))throw new TypeError;return Nn}return Sn(Wt,Gr==="default"?"number":Gr)}function Sn(Wt,xr){if(xr==="string"){var Gr=Wt.toString;if(bn(Gr)){var nn=Gr.call(Wt);if(!Lr(nn))return nn}var Nn=Wt.valueOf;if(bn(Nn)){var nn=Nn.call(Wt);if(!Lr(nn))return nn}}else{var Nn=Wt.valueOf;if(bn(Nn)){var nn=Nn.call(Wt);if(!Lr(nn))return nn}var Ki=Wt.toString;if(bn(Ki)){var nn=Ki.call(Wt);if(!Lr(nn))return nn}}throw new TypeError}function Jr(Wt){return!!Wt}function bi(Wt){return""+Wt}function Gn(Wt){var xr=Fn(Wt,3);return cn(xr)?xr:bi(xr)}function zi(Wt){return Array.isArray?Array.isArray(Wt):Wt instanceof Object?Wt instanceof Array:Object.prototype.toString.call(Wt)==="[object Array]"}function bn(Wt){return typeof Wt=="function"}function Pn(Wt){return typeof Wt=="function"}function Aa(Wt){switch(dr(Wt)){case 3:return!0;case 4:return!0;default:return!1}}function Zi(Wt,xr){var Gr=Wt[xr];if(Gr!=null){if(!bn(Gr))throw new TypeError;return Gr}}function Ma(Wt){var xr=Zi(Wt,Ge);if(!bn(xr))throw new TypeError;var Gr=xr.call(Wt);if(!Lr(Gr))throw new TypeError;return Gr}function To(Wt){return Wt.value}function Ce(Wt){var xr=Wt.next();return xr.done?!1:xr}function Ia(Wt){var xr=Wt.return;xr&&xr.call(Wt)}function Ta(Wt){var xr=Object.getPrototypeOf(Wt);if(typeof Wt!="function"||Wt===vt||xr!==vt)return xr;var Gr=Wt.prototype,nn=Gr&&Object.getPrototypeOf(Gr);if(nn==null||nn===Object.prototype)return xr;var Nn=nn.constructor;return typeof Nn!="function"||Nn===Wt?xr:Nn}function no(){var Wt={},xr=[],Gr=function(){function ue(D,z,se){this._index=0,this._keys=D,this._values=z,this._selector=se}return ue.prototype["@@iterator"]=function(){return this},ue.prototype[Ge]=function(){return this},ue.prototype.next=function(){var D=this._index;if(D>=0&&D<this._keys.length){var z=this._selector(this._keys[D],this._values[D]);return D+1>=this._keys.length?(this._index=-1,this._keys=xr,this._values=xr):this._index++,{value:z,done:!1}}return{value:void 0,done:!0}},ue.prototype.throw=function(D){throw this._index>=0&&(this._index=-1,this._keys=xr,this._values=xr),D},ue.prototype.return=function(D){return this._index>=0&&(this._index=-1,this._keys=xr,this._values=xr),{value:D,done:!0}},ue}();return function(){function ue(){this._keys=[],this._values=[],this._cacheKey=Wt,this._cacheIndex=-2}return Object.defineProperty(ue.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),ue.prototype.has=function(D){return this._find(D,!1)>=0},ue.prototype.get=function(D){var z=this._find(D,!1);return z>=0?this._values[z]:void 0},ue.prototype.set=function(D,z){var se=this._find(D,!0);return this._values[se]=z,this},ue.prototype.delete=function(D){var z=this._find(D,!1);if(z>=0){for(var se=this._keys.length,be=z+1;be<se;be++)this._keys[be-1]=this._keys[be],this._values[be-1]=this._values[be];return this._keys.length--,this._values.length--,D===this._cacheKey&&(this._cacheKey=Wt,this._cacheIndex=-2),!0}return!1},ue.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=Wt,this._cacheIndex=-2},ue.prototype.keys=function(){return new Gr(this._keys,this._values,nn)},ue.prototype.values=function(){return new Gr(this._keys,this._values,Nn)},ue.prototype.entries=function(){return new Gr(this._keys,this._values,Ki)},ue.prototype["@@iterator"]=function(){return this.entries()},ue.prototype[Ge]=function(){return this.entries()},ue.prototype._find=function(D,z){return this._cacheKey!==D&&(this._cacheIndex=this._keys.indexOf(this._cacheKey=D)),this._cacheIndex<0&&z&&(this._cacheIndex=this._keys.length,this._keys.push(D),this._values.push(void 0)),this._cacheIndex},ue}();function nn(ue,D){return ue}function Nn(ue,D){return D}function Ki(ue,D){return[ue,D]}}function qs(){return function(){function Wt(){this._map=new Et}return Object.defineProperty(Wt.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),Wt.prototype.has=function(xr){return this._map.has(xr)},Wt.prototype.add=function(xr){return this._map.set(xr,xr),this},Wt.prototype.delete=function(xr){return this._map.delete(xr)},Wt.prototype.clear=function(){this._map.clear()},Wt.prototype.keys=function(){return this._map.keys()},Wt.prototype.values=function(){return this._map.values()},Wt.prototype.entries=function(){return this._map.entries()},Wt.prototype["@@iterator"]=function(){return this.keys()},Wt.prototype[Ge]=function(){return this.keys()},Wt}()}function Rs(){var Wt=16,xr=pt.create(),Gr=nn();return function(){function z(){this._key=nn()}return z.prototype.has=function(se){var be=Nn(se,!1);return be!==void 0?pt.has(be,this._key):!1},z.prototype.get=function(se){var be=Nn(se,!1);return be!==void 0?pt.get(be,this._key):void 0},z.prototype.set=function(se,be){var ke=Nn(se,!0);return ke[this._key]=be,this},z.prototype.delete=function(se){var be=Nn(se,!1);return be!==void 0?delete be[this._key]:!1},z.prototype.clear=function(){this._key=nn()},z}();function nn(){var z;do z="@@WeakMap@@"+D();while(pt.has(xr,z));return xr[z]=!0,z}function Nn(z,se){if(!Z.call(z,Gr)){if(!se)return;Object.defineProperty(z,Gr,{value:pt.create()})}return z[Gr]}function Ki(z,se){for(var be=0;be<se;++be)z[be]=Math.random()*255|0;return z}function ue(z){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(z)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(z)):Ki(new Uint8Array(z),z):Ki(new Array(z),z)}function D(){var z=ue(Wt);z[6]=z[6]&79|64,z[8]=z[8]&191|128;for(var se="",be=0;be<Wt;++be){var ke=z[be];(be===4||be===6||be===8)&&(se+="-"),ke<16&&(se+="0"),se+=ke.toString(16).toLowerCase()}return se}}function ts(Wt){return Wt.__=void 0,delete Wt.__,Wt}})})(ve||(ve={}))},79801:function(Qt){(function(re,U){Qt.exports=U()})(this,function(){"use strict";var re=function(G){return G instanceof Uint8Array||G instanceof Uint16Array||G instanceof Uint32Array||G instanceof Int8Array||G instanceof Int16Array||G instanceof Int32Array||G instanceof Float32Array||G instanceof Float64Array||G instanceof Uint8ClampedArray},U=function(G,we){for(var Ye=Object.keys(we),Kt=0;Kt<Ye.length;++Kt)G[Ye[Kt]]=we[Ye[Kt]];return G},ee=`
`;function ve(G){return typeof atob!="undefined"?atob(G):"base64:"+G}function _(G){var we=new Error("(regl) "+G);throw console.error(we),we}function fe(G,we){G||_(we)}function Z(G){return G?": "+G:""}function he(G,we,Ye){G in we||_("unknown parameter ("+G+")"+Z(Ye)+". possible values: "+Object.keys(we).join())}function ce(G,we){re(G)||_("invalid parameter type"+Z(we)+". must be a typed array")}function Ge(G,we){switch(we){case"number":return typeof G=="number";case"object":return typeof G=="object";case"string":return typeof G=="string";case"boolean":return typeof G=="boolean";case"function":return typeof G=="function";case"undefined":return typeof G=="undefined";case"symbol":return typeof G=="symbol"}}function oe(G,we,Ye){Ge(G,we)||_("invalid parameter type"+Z(Ye)+". expected "+we+", got "+typeof G)}function We(G,we){G>=0&&(G|0)===G||_("invalid parameter type, ("+G+")"+Z(we)+". must be a nonnegative integer")}function qe(G,we,Ye){we.indexOf(G)<0&&_("invalid value"+Z(Ye)+". must be one of: "+we)}var pt=["gl","canvas","container","attributes","pixelRatio","extensions","optionalExtensions","profile","onDone"];function vt(G){Object.keys(G).forEach(function(we){pt.indexOf(we)<0&&_('invalid regl constructor argument "'+we+'". must be one of '+pt)})}function bt(G,we){for(G=G+"";G.length<we;)G=" "+G;return G}function Et(){this.name="unknown",this.lines=[],this.index={},this.hasErrors=!1}function Dt(G,we){this.number=G,this.line=we,this.errors=[]}function wt(G,we,Ye){this.file=G,this.line=we,this.message=Ye}function at(){var G=new Error,we=(G.stack||G).toString(),Ye=/compileProcedure.*\n\s*at.*\((.*)\)/.exec(we);if(Ye)return Ye[1];var Kt=/compileProcedure.*\n\s*at\s+(.*)(\n|$)/.exec(we);return Kt?Kt[1]:"unknown"}function Tt(){var G=new Error,we=(G.stack||G).toString(),Ye=/at REGLCommand.*\n\s+at.*\((.*)\)/.exec(we);if(Ye)return Ye[1];var Kt=/at REGLCommand.*\n\s+at\s+(.*)\n/.exec(we);return Kt?Kt[1]:"unknown"}function wr(G,we){var Ye=G.split(`
`),Kt=1,vr=0,er={unknown:new Et,0:new Et};er.unknown.name=er[0].name=we||at(),er.unknown.lines.push(new Dt(0,""));for(var jt=0;jt<Ye.length;++jt){var Br=Ye[jt],Pr=/^\s*#\s*(\w+)\s+(.+)\s*$/.exec(Br);if(Pr)switch(Pr[1]){case"line":var Yr=/(\d+)(\s+\d+)?/.exec(Pr[2]);Yr&&(Kt=Yr[1]|0,Yr[2]&&(vr=Yr[2]|0,vr in er||(er[vr]=new Et)));break;case"define":var Nr=/SHADER_NAME(_B64)?\s+(.*)$/.exec(Pr[2]);Nr&&(er[vr].name=Nr[1]?ve(Nr[2]):Nr[2]);break}er[vr].lines.push(new Dt(Kt++,Br))}return Object.keys(er).forEach(function(Hr){var en=er[Hr];en.lines.forEach(function(Or){en.index[Or.number]=Or})}),er}function pr(G){var we=[];return G.split(`
`).forEach(function(Ye){if(!(Ye.length<5)){var Kt=/^ERROR:\s+(\d+):(\d+):\s*(.*)$/.exec(Ye);Kt?we.push(new wt(Kt[1]|0,Kt[2]|0,Kt[3].trim())):Ye.length>0&&we.push(new wt("unknown",0,Ye))}}),we}function lr(G,we){we.forEach(function(Ye){var Kt=G[Ye.file];if(Kt){var vr=Kt.index[Ye.line];if(vr){vr.errors.push(Ye),Kt.hasErrors=!0;return}}G.unknown.hasErrors=!0,G.unknown.lines[0].errors.push(Ye)})}function Ot(G,we,Ye,Kt,vr){if(!G.getShaderParameter(we,G.COMPILE_STATUS)){var er=G.getShaderInfoLog(we),jt=Kt===G.FRAGMENT_SHADER?"fragment":"vertex";W(Ye,"string",jt+" shader source must be a string",vr);var Br=wr(Ye,vr),Pr=pr(er);lr(Br,Pr),Object.keys(Br).forEach(function(Yr){var Nr=Br[Yr];if(!Nr.hasErrors)return;var Hr=[""],en=[""];function Or($r,Bt){Hr.push($r),en.push(Bt||"")}Or("file number "+Yr+": "+Nr.name+`
`,"color:red;text-decoration:underline;font-weight:bold"),Nr.lines.forEach(function($r){if($r.errors.length>0){Or(bt($r.number,4)+"|  ","background-color:yellow; font-weight:bold"),Or($r.line+ee,"color:red; background-color:yellow; font-weight:bold");var Bt=0;$r.errors.forEach(function(ur){var Ur=ur.message,un=/^\s*'(.*)'\s*:\s*(.*)$/.exec(Ur);if(un){var Tr=un[1];switch(Ur=un[2],Tr){case"assign":Tr="=";break}Bt=Math.max($r.line.indexOf(Tr,Bt),0)}else Bt=0;Or(bt("| ",6)),Or(bt("^^^",Bt+3)+ee,"font-weight:bold"),Or(bt("| ",6)),Or(Ur+ee,"font-weight:bold")}),Or(bt("| ",6)+ee)}else Or(bt($r.number,4)+"|  "),Or($r.line+ee,"color:red")}),typeof document!="undefined"&&!window.chrome?(en[0]=Hr.join("%c"),console.log.apply(console,en)):console.log(Hr.join(""))}),fe.raise("Error compiling "+jt+" shader, "+Br[0].name)}}function ht(G,we,Ye,Kt,vr){if(!G.getProgramParameter(we,G.LINK_STATUS)){var er=G.getProgramInfoLog(we),jt=wr(Ye,vr),Br=wr(Kt,vr),Pr='Error linking program with vertex shader, "'+Br[0].name+'", and fragment shader "'+jt[0].name+'"';typeof document!="undefined"?console.log("%c"+Pr+ee+"%c"+er,"color:red;text-decoration:underline;font-weight:bold","color:red"):console.log(Pr+ee+er),fe.raise(Pr)}}function Ft(G){G._commandRef=at()}function Qe(G,we,Ye,Kt){Ft(G);function vr(Pr){return Pr?Kt.id(Pr):0}G._fragId=vr(G.static.frag),G._vertId=vr(G.static.vert);function er(Pr,Yr){Object.keys(Yr).forEach(function(Nr){Pr[Kt.id(Nr)]=!0})}var jt=G._uniformSet={};er(jt,we.static),er(jt,we.dynamic);var Br=G._attributeSet={};er(Br,Ye.static),er(Br,Ye.dynamic),G._hasCount="count"in G.static||"count"in G.dynamic||"elements"in G.static||"elements"in G.dynamic}function Nt(G,we){var Ye=Tt();_(G+" in command "+(we||at())+(Ye==="unknown"?"":" called from "+Ye))}function sr(G,we,Ye){G||Nt(we,Ye||at())}function ie(G,we,Ye,Kt){G in we||Nt("unknown parameter ("+G+")"+Z(Ye)+". possible values: "+Object.keys(we).join(),Kt||at())}function W(G,we,Ye,Kt){Ge(G,we)||Nt("invalid parameter type"+Z(Ye)+". expected "+we+", got "+typeof G,Kt||at())}function te(G){G()}function Oe(G,we,Ye){G.texture?qe(G.texture._texture.internalformat,we,"unsupported texture format for attachment"):qe(G.renderbuffer._renderbuffer.format,Ye,"unsupported renderbuffer format for attachment")}var Te=33071,nt=9728,De=9984,Ze=9985,Ke=9986,At=9987,dr=5120,Pt=5121,fn=5122,cn=5123,Lr=5124,Fn=5125,Sn=5126,Jr=32819,bi=32820,Gn=33635,zi=34042,bn=36193,Pn={};Pn[dr]=Pn[Pt]=1,Pn[fn]=Pn[cn]=Pn[bn]=Pn[Gn]=Pn[Jr]=Pn[bi]=2,Pn[Lr]=Pn[Fn]=Pn[Sn]=Pn[zi]=4;function Aa(G,we){return G===bi||G===Jr||G===Gn?2:G===zi?4:Pn[G]*we}function Zi(G){return!(G&G-1)&&!!G}function Ma(G,we,Ye){var Kt,vr=we.width,er=we.height,jt=we.channels;fe(vr>0&&vr<=Ye.maxTextureSize&&er>0&&er<=Ye.maxTextureSize,"invalid texture shape"),(G.wrapS!==Te||G.wrapT!==Te)&&fe(Zi(vr)&&Zi(er),"incompatible wrap mode for texture, both width and height must be power of 2"),we.mipmask===1?vr!==1&&er!==1&&fe(G.minFilter!==De&&G.minFilter!==Ke&&G.minFilter!==Ze&&G.minFilter!==At,"min filter requires mipmap"):(fe(Zi(vr)&&Zi(er),"texture must be a square power of 2 to support mipmapping"),fe(we.mipmask===(vr<<1)-1,"missing or incomplete mipmap data")),we.type===Sn&&(Ye.extensions.indexOf("oes_texture_float_linear")<0&&fe(G.minFilter===nt&&G.magFilter===nt,"filter not supported, must enable oes_texture_float_linear"),fe(!G.genMipmaps,"mipmap generation not supported with float textures"));var Br=we.images;for(Kt=0;Kt<16;++Kt)if(Br[Kt]){var Pr=vr>>Kt,Yr=er>>Kt;fe(we.mipmask&1<<Kt,"missing mipmap data");var Nr=Br[Kt];if(fe(Nr.width===Pr&&Nr.height===Yr,"invalid shape for mip images"),fe(Nr.format===we.format&&Nr.internalformat===we.internalformat&&Nr.type===we.type,"incompatible type for mip image"),!Nr.compressed)if(Nr.data){var Hr=Math.ceil(Aa(Nr.type,jt)*Pr/Nr.unpackAlignment)*Nr.unpackAlignment;fe(Nr.data.byteLength===Hr*Yr,"invalid data for image, buffer size is inconsistent with image format")}else Nr.element||Nr.copy}else G.genMipmaps||fe((we.mipmask&1<<Kt)===0,"extra mipmap data");we.compressed&&fe(!G.genMipmaps,"mipmap generation for compressed images not supported")}function To(G,we,Ye,Kt){var vr=G.width,er=G.height,jt=G.channels;fe(vr>0&&vr<=Kt.maxTextureSize&&er>0&&er<=Kt.maxTextureSize,"invalid texture shape"),fe(vr===er,"cube map must be square"),fe(we.wrapS===Te&&we.wrapT===Te,"wrap mode not supported by cube map");for(var Br=0;Br<Ye.length;++Br){var Pr=Ye[Br];fe(Pr.width===vr&&Pr.height===er,"inconsistent cube map face shape"),we.genMipmaps&&(fe(!Pr.compressed,"can not generate mipmap for compressed textures"),fe(Pr.mipmask===1,"can not specify mipmaps and generate mipmaps"));for(var Yr=Pr.images,Nr=0;Nr<16;++Nr){var Hr=Yr[Nr];if(Hr){var en=vr>>Nr,Or=er>>Nr;fe(Pr.mipmask&1<<Nr,"missing mipmap data"),fe(Hr.width===en&&Hr.height===Or,"invalid shape for mip images"),fe(Hr.format===G.format&&Hr.internalformat===G.internalformat&&Hr.type===G.type,"incompatible type for mip image"),Hr.compressed||(Hr.data?fe(Hr.data.byteLength===en*Or*Math.max(Aa(Hr.type,jt),Hr.unpackAlignment),"invalid data for image, buffer size is inconsistent with image format"):Hr.element||Hr.copy)}}}}var Ce=U(fe,{optional:te,raise:_,commandRaise:Nt,command:sr,parameter:he,commandParameter:ie,constructor:vt,type:oe,commandType:W,isTypedArray:ce,nni:We,oneOf:qe,shaderError:Ot,linkError:ht,callSite:Tt,saveCommandRef:Ft,saveDrawInfo:Qe,framebufferFormat:Oe,guessCommand:at,texture2D:Ma,textureCube:To}),Ia=0,Ta=0;function no(G,we){this.id=Ia++,this.type=G,this.data=we}function qs(G){return G.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}function Rs(G){if(G.length===0)return[];var we=G.charAt(0),Ye=G.charAt(G.length-1);if(G.length>1&&we===Ye&&(we==='"'||we==="'"))return['"'+qs(G.substr(1,G.length-2))+'"'];var Kt=/\[(false|true|null|\d+|'[^']*'|"[^"]*")\]/.exec(G);if(Kt)return Rs(G.substr(0,Kt.index)).concat(Rs(Kt[1])).concat(Rs(G.substr(Kt.index+Kt[0].length)));var vr=G.split(".");if(vr.length===1)return['"'+qs(G)+'"'];for(var er=[],jt=0;jt<vr.length;++jt)er=er.concat(Rs(vr[jt]));return er}function ts(G){return"["+Rs(G).join("][")+"]"}function Wt(G,we){return new no(G,ts(we+""))}function xr(G){return typeof G=="function"&&!G._reglType||G instanceof no}function Gr(G,we){return typeof G=="function"?new no(Ta,G):G}var nn={DynamicVariable:no,define:Wt,isDynamic:xr,unbox:Gr,accessor:ts},Nn={next:typeof requestAnimationFrame=="function"?function(G){return requestAnimationFrame(G)}:function(G){return setTimeout(G,16)},cancel:typeof cancelAnimationFrame=="function"?function(G){return cancelAnimationFrame(G)}:clearTimeout},Ki=typeof performance!="undefined"&&performance.now?function(){return performance.now()}:function(){return+new Date};function ue(){var G={"":0},we=[""];return{id:function(Ye){var Kt=G[Ye];return Kt||(Kt=G[Ye]=we.length,we.push(Ye),Kt)},str:function(Ye){return we[Ye]}}}function D(G,we,Ye){var Kt=document.createElement("canvas");U(Kt.style,{border:0,margin:0,padding:0,top:0,left:0}),G.appendChild(Kt),G===document.body&&(Kt.style.position="absolute",U(G.style,{margin:0,padding:0}));function vr(){var Br=window.innerWidth,Pr=window.innerHeight;if(G!==document.body){var Yr=G.getBoundingClientRect();Br=Yr.right-Yr.left,Pr=Yr.bottom-Yr.top}Kt.width=Ye*Br,Kt.height=Ye*Pr,U(Kt.style,{width:Br+"px",height:Pr+"px"})}var er;G!==document.body&&typeof ResizeObserver=="function"?(er=new ResizeObserver(function(){setTimeout(vr)}),er.observe(G)):window.addEventListener("resize",vr,!1);function jt(){er?er.disconnect():window.removeEventListener("resize",vr),G.removeChild(Kt)}return vr(),{canvas:Kt,onDestroy:jt}}function z(G,we){function Ye(Kt){try{return G.getContext(Kt,we)}catch(vr){return null}}return Ye("webgl")||Ye("experimental-webgl")||Ye("webgl-experimental")}function se(G){return typeof G.nodeName=="string"&&typeof G.appendChild=="function"&&typeof G.getBoundingClientRect=="function"}function be(G){return typeof G.drawArrays=="function"||typeof G.drawElements=="function"}function ke(G){return typeof G=="string"?G.split():(Ce(Array.isArray(G),"invalid extension array"),G)}function Ht(G){return typeof G=="string"?(Ce(typeof document!="undefined","not supported outside of DOM"),document.querySelector(G)):G}function Mt(G){var we=G||{},Ye,Kt,vr,er,jt={},Br=[],Pr=[],Yr=typeof window=="undefined"?1:window.devicePixelRatio,Nr=!1,Hr=function($r){$r&&Ce.raise($r)},en=function(){};if(typeof we=="string"?(Ce(typeof document!="undefined","selector queries only supported in DOM enviroments"),Ye=document.querySelector(we),Ce(Ye,"invalid query string for element")):typeof we=="object"?se(we)?Ye=we:be(we)?(er=we,vr=er.canvas):(Ce.constructor(we),"gl"in we?er=we.gl:"canvas"in we?vr=Ht(we.canvas):"container"in we&&(Kt=Ht(we.container)),"attributes"in we&&(jt=we.attributes,Ce.type(jt,"object","invalid context attributes")),"extensions"in we&&(Br=ke(we.extensions)),"optionalExtensions"in we&&(Pr=ke(we.optionalExtensions)),"onDone"in we&&(Ce.type(we.onDone,"function","invalid or missing onDone callback"),Hr=we.onDone),"profile"in we&&(Nr=!!we.profile),"pixelRatio"in we&&(Yr=+we.pixelRatio,Ce(Yr>0,"invalid pixel ratio"))):Ce.raise("invalid arguments to regl"),Ye&&(Ye.nodeName.toLowerCase()==="canvas"?vr=Ye:Kt=Ye),!er){if(!vr){Ce(typeof document!="undefined","must manually specify webgl context outside of DOM environments");var Or=D(Kt||document.body,Hr,Yr);if(!Or)return null;vr=Or.canvas,en=Or.onDestroy}jt.premultipliedAlpha===void 0&&(jt.premultipliedAlpha=!0),er=z(vr,jt)}return er?{gl:er,canvas:vr,container:Kt,extensions:Br,optionalExtensions:Pr,pixelRatio:Yr,profile:Nr,onDone:Hr,onDestroy:en}:(en(),Hr("webgl not supported, try upgrading your browser or graphics drivers http://get.webgl.org"),null)}function Lt(G,we){var Ye={};function Kt(jt){Ce.type(jt,"string","extension name must be string");var Br=jt.toLowerCase(),Pr;try{Pr=Ye[Br]=G.getExtension(Br)}catch(Yr){}return!!Pr}for(var vr=0;vr<we.extensions.length;++vr){var er=we.extensions[vr];if(!Kt(er))return we.onDestroy(),we.onDone('"'+er+'" extension is not supported by the current WebGL context, try upgrading your system or a different browser'),null}return we.optionalExtensions.forEach(Kt),{extensions:Ye,restore:function(){Object.keys(Ye).forEach(function(jt){if(Ye[jt]&&!Kt(jt))throw new Error("(regl): error restoring extension "+jt)})}}}function mt(G,we){for(var Ye=Array(G),Kt=0;Kt<G;++Kt)Ye[Kt]=we(Kt);return Ye}var N=5120,B=5121,$=5122,ne=5123,xe=5124,Fe=5125,et=5126;function j(G){for(var we=16;we<=1<<28;we*=16)if(G<=we)return we;return 0}function Q(G){var we,Ye;return we=(G>65535)<<4,G>>>=we,Ye=(G>255)<<3,G>>>=Ye,we|=Ye,Ye=(G>15)<<2,G>>>=Ye,we|=Ye,Ye=(G>3)<<1,G>>>=Ye,we|=Ye,we|G>>1}function Le(){var G=mt(8,function(){return[]});function we(er){var jt=j(er),Br=G[Q(jt)>>2];return Br.length>0?Br.pop():new ArrayBuffer(jt)}function Ye(er){G[Q(er.byteLength)>>2].push(er)}function Kt(er,jt){var Br=null;switch(er){case N:Br=new Int8Array(we(jt),0,jt);break;case B:Br=new Uint8Array(we(jt),0,jt);break;case $:Br=new Int16Array(we(2*jt),0,jt);break;case ne:Br=new Uint16Array(we(2*jt),0,jt);break;case xe:Br=new Int32Array(we(4*jt),0,jt);break;case Fe:Br=new Uint32Array(we(4*jt),0,jt);break;case et:Br=new Float32Array(we(4*jt),0,jt);break;default:return null}return Br.length!==jt?Br.subarray(0,jt):Br}function vr(er){Ye(er.buffer)}return{alloc:we,free:Ye,allocType:Kt,freeType:vr}}var rt=Le();rt.zero=Le();var Ee=3408,Yt=3410,gr=3411,tn=3412,Qr=3413,rr=3414,Xr=3415,zr=33901,Vr=33902,ei=3379,sn=3386,hi=34921,Vi=36347,ci=36348,Di=35661,Ei=35660,rs=34930,Qi=36349,Pa=34076,Si=34024,di=7936,Ai=7937,Oa=7938,vu=35724,ca=34047,wa=36063,Gl=34852,ds=3553,Ca=34067,vi=34069,ka=33984,na=6408,zo=5126,la=5121,ns=36160,$o=36053,Du=36064,vs=16384,_c=function(G,we){var Ye=1;we.ext_texture_filter_anisotropic&&(Ye=G.getParameter(ca));var Kt=1,vr=1;we.webgl_draw_buffers&&(Kt=G.getParameter(Gl),vr=G.getParameter(wa));var er=!!we.oes_texture_float;if(er){var jt=G.createTexture();G.bindTexture(ds,jt),G.texImage2D(ds,0,na,1,1,0,na,zo,null);var Br=G.createFramebuffer();if(G.bindFramebuffer(ns,Br),G.framebufferTexture2D(ns,Du,ds,jt,0),G.bindTexture(ds,null),G.checkFramebufferStatus(ns)!==$o)er=!1;else{G.viewport(0,0,1,1),G.clearColor(1,0,0,1),G.clear(vs);var Pr=rt.allocType(zo,4);G.readPixels(0,0,1,1,na,zo,Pr),G.getError()?er=!1:(G.deleteFramebuffer(Br),G.deleteTexture(jt),er=Pr[0]===1),rt.freeType(Pr)}}var Yr=typeof navigator!="undefined"&&(/MSIE/.test(navigator.userAgent)||/Trident\//.test(navigator.appVersion)||/Edge/.test(navigator.userAgent)),Nr=!0;if(!Yr){var Hr=G.createTexture(),en=rt.allocType(la,36);G.activeTexture(ka),G.bindTexture(Ca,Hr),G.texImage2D(vi,0,na,3,3,0,na,la,en),rt.freeType(en),G.bindTexture(Ca,null),G.deleteTexture(Hr),Nr=!G.getError()}return{colorBits:[G.getParameter(Yt),G.getParameter(gr),G.getParameter(tn),G.getParameter(Qr)],depthBits:G.getParameter(rr),stencilBits:G.getParameter(Xr),subpixelBits:G.getParameter(Ee),extensions:Object.keys(we).filter(function(Or){return!!we[Or]}),maxAnisotropic:Ye,maxDrawbuffers:Kt,maxColorAttachments:vr,pointSizeDims:G.getParameter(zr),lineWidthDims:G.getParameter(Vr),maxViewportDims:G.getParameter(sn),maxCombinedTextureUnits:G.getParameter(Di),maxCubeMapSize:G.getParameter(Pa),maxRenderbufferSize:G.getParameter(Si),maxTextureUnits:G.getParameter(rs),maxTextureSize:G.getParameter(ei),maxAttributes:G.getParameter(hi),maxVertexUniforms:G.getParameter(Vi),maxVertexTextureUnits:G.getParameter(Ei),maxVaryingVectors:G.getParameter(ci),maxFragmentUniforms:G.getParameter(Qi),glsl:G.getParameter(vu),renderer:G.getParameter(Ai),vendor:G.getParameter(di),version:G.getParameter(Oa),readFloat:er,npotTextureCube:Nr}};function ya(G){return!!G&&typeof G=="object"&&Array.isArray(G.shape)&&Array.isArray(G.stride)&&typeof G.offset=="number"&&G.shape.length===G.stride.length&&(Array.isArray(G.data)||re(G.data))}var Ji=function(G){return Object.keys(G).map(function(we){return G[we]})},Jt={shape:Kr,flatten:cr};function yn(G,we,Ye){for(var Kt=0;Kt<we;++Kt)Ye[Kt]=G[Kt]}function ge(G,we,Ye,Kt){for(var vr=0,er=0;er<we;++er)for(var jt=G[er],Br=0;Br<Ye;++Br)Kt[vr++]=jt[Br]}function Pe(G,we,Ye,Kt,vr,er){for(var jt=er,Br=0;Br<we;++Br)for(var Pr=G[Br],Yr=0;Yr<Ye;++Yr)for(var Nr=Pr[Yr],Hr=0;Hr<Kt;++Hr)vr[jt++]=Nr[Hr]}function _t(G,we,Ye,Kt,vr){for(var er=1,jt=Ye+1;jt<we.length;++jt)er*=we[jt];var Br=we[Ye];if(we.length-Ye===4){var Pr=we[Ye+1],Yr=we[Ye+2],Nr=we[Ye+3];for(jt=0;jt<Br;++jt)Pe(G[jt],Pr,Yr,Nr,Kt,vr),vr+=er}else for(jt=0;jt<Br;++jt)_t(G[jt],we,Ye+1,Kt,vr),vr+=er}function cr(G,we,Ye,Kt){var vr=1;if(we.length)for(var er=0;er<we.length;++er)vr*=we[er];else vr=0;var jt=Kt||rt.allocType(Ye,vr);switch(we.length){case 0:break;case 1:yn(G,we[0],jt);break;case 2:ge(G,we[0],we[1],jt);break;case 3:Pe(G,we[0],we[1],we[2],jt,0);break;default:_t(G,we,0,jt,0)}return jt}function Kr(G){for(var we=[],Ye=G;Ye.length;Ye=Ye[0])we.push(Ye.length);return we}var kn={"[object Int8Array]":5120,"[object Int16Array]":5122,"[object Int32Array]":5124,"[object Uint8Array]":5121,"[object Uint8ClampedArray]":5121,"[object Uint16Array]":5123,"[object Uint32Array]":5125,"[object Float32Array]":5126,"[object Float64Array]":5121,"[object ArrayBuffer]":5121},ji=5120,vo=5122,wo=5124,fo=5121,Ds=5123,Ms=5125,ep=5126,Af=5126,Yo={int8:ji,int16:vo,int32:wo,uint8:fo,uint16:Ds,uint32:Ms,float:ep,float32:Af},El=35048,Sl=35040,Lu={dynamic:El,stream:Sl,static:35044},Bu=Jt.flatten,Ju=Jt.shape,$c=35044,Ls=35040,Ya=5121,Al=5126,el=[];el[5120]=1,el[5122]=2,el[5124]=4,el[5121]=1,el[5123]=2,el[5125]=4,el[5126]=4;function Tf(G){return kn[Object.prototype.toString.call(G)]|0}function tp(G,we){for(var Ye=0;Ye<we.length;++Ye)G[Ye]=we[Ye]}function wf(G,we,Ye,Kt,vr,er,jt){for(var Br=0,Pr=0;Pr<Ye;++Pr)for(var Yr=0;Yr<Kt;++Yr)G[Br++]=we[vr*Pr+er*Yr+jt]}function hh(G,we,Ye,Kt){var vr=0,er={};function jt(Bt){this.id=vr++,this.buffer=G.createBuffer(),this.type=Bt,this.usage=$c,this.byteLength=0,this.dimension=1,this.dtype=Ya,this.persistentData=null,Ye.profile&&(this.stats={size:0})}jt.prototype.bind=function(){G.bindBuffer(this.type,this.buffer)},jt.prototype.destroy=function(){en(this)};var Br=[];function Pr(Bt,ur){var Ur=Br.pop();return Ur||(Ur=new jt(Bt)),Ur.bind(),Hr(Ur,ur,Ls,0,1,!1),Ur}function Yr(Bt){Br.push(Bt)}function Nr(Bt,ur,Ur){Bt.byteLength=ur.byteLength,G.bufferData(Bt.type,ur,Ur)}function Hr(Bt,ur,Ur,un,Tr,pn){var Mr;if(Bt.usage=Ur,Array.isArray(ur)){if(Bt.dtype=un||Al,ur.length>0){var ln;if(Array.isArray(ur[0])){Mr=Ju(ur);for(var Ar=1,on=1;on<Mr.length;++on)Ar*=Mr[on];Bt.dimension=Ar,ln=Bu(ur,Mr,Bt.dtype),Nr(Bt,ln,Ur),pn?Bt.persistentData=ln:rt.freeType(ln)}else if(typeof ur[0]=="number"){Bt.dimension=Tr;var jn=rt.allocType(Bt.dtype,ur.length);tp(jn,ur),Nr(Bt,jn,Ur),pn?Bt.persistentData=jn:rt.freeType(jn)}else re(ur[0])?(Bt.dimension=ur[0].length,Bt.dtype=un||Tf(ur[0])||Al,ln=Bu(ur,[ur.length,ur[0].length],Bt.dtype),Nr(Bt,ln,Ur),pn?Bt.persistentData=ln:rt.freeType(ln)):Ce.raise("invalid buffer data")}}else if(re(ur))Bt.dtype=un||Tf(ur),Bt.dimension=Tr,Nr(Bt,ur,Ur),pn&&(Bt.persistentData=new Uint8Array(new Uint8Array(ur.buffer)));else if(ya(ur)){Mr=ur.shape;var ai=ur.stride,rn=ur.offset,Dr=0,yr=0,tr=0,Ti=0;Mr.length===1?(Dr=Mr[0],yr=1,tr=ai[0],Ti=0):Mr.length===2?(Dr=Mr[0],yr=Mr[1],tr=ai[0],Ti=ai[1]):Ce.raise("invalid shape"),Bt.dtype=un||Tf(ur.data)||Al,Bt.dimension=yr;var Je=rt.allocType(Bt.dtype,Dr*yr);wf(Je,ur.data,Dr,yr,tr,Ti,rn),Nr(Bt,Je,Ur),pn?Bt.persistentData=Je:rt.freeType(Je)}else ur instanceof ArrayBuffer?(Bt.dtype=Ya,Bt.dimension=Tr,Nr(Bt,ur,Ur),pn&&(Bt.persistentData=new Uint8Array(new Uint8Array(ur)))):Ce.raise("invalid buffer data")}function en(Bt){we.bufferCount--,Kt(Bt);var ur=Bt.buffer;Ce(ur,"buffer must not be deleted already"),G.deleteBuffer(ur),Bt.buffer=null,delete er[Bt.id]}function Or(Bt,ur,Ur,un){we.bufferCount++;var Tr=new jt(ur);er[Tr.id]=Tr;function pn(Ar){var on=$c,jn=null,ai=0,rn=0,Dr=1;return Array.isArray(Ar)||re(Ar)||ya(Ar)||Ar instanceof ArrayBuffer?jn=Ar:typeof Ar=="number"?ai=Ar|0:Ar&&(Ce.type(Ar,"object","buffer arguments must be an object, a number or an array"),"data"in Ar&&(Ce(jn===null||Array.isArray(jn)||re(jn)||ya(jn),"invalid data for buffer"),jn=Ar.data),"usage"in Ar&&(Ce.parameter(Ar.usage,Lu,"invalid buffer usage"),on=Lu[Ar.usage]),"type"in Ar&&(Ce.parameter(Ar.type,Yo,"invalid buffer type"),rn=Yo[Ar.type]),"dimension"in Ar&&(Ce.type(Ar.dimension,"number","invalid dimension"),Dr=Ar.dimension|0),"length"in Ar&&(Ce.nni(ai,"buffer length must be a nonnegative integer"),ai=Ar.length|0)),Tr.bind(),jn?Hr(Tr,jn,on,rn,Dr,un):(ai&&G.bufferData(Tr.type,ai,on),Tr.dtype=rn||Ya,Tr.usage=on,Tr.dimension=Dr,Tr.byteLength=ai),Ye.profile&&(Tr.stats.size=Tr.byteLength*el[Tr.dtype]),pn}function Mr(Ar,on){Ce(on+Ar.byteLength<=Tr.byteLength,"invalid buffer subdata call, buffer is too small.  Can't write data of size "+Ar.byteLength+" starting from offset "+on+" to a buffer of size "+Tr.byteLength),G.bufferSubData(Tr.type,on,Ar)}function ln(Ar,on){var jn=(on||0)|0,ai;if(Tr.bind(),re(Ar)||Ar instanceof ArrayBuffer)Mr(Ar,jn);else if(Array.isArray(Ar)){if(Ar.length>0)if(typeof Ar[0]=="number"){var rn=rt.allocType(Tr.dtype,Ar.length);tp(rn,Ar),Mr(rn,jn),rt.freeType(rn)}else if(Array.isArray(Ar[0])||re(Ar[0])){ai=Ju(Ar);var Dr=Bu(Ar,ai,Tr.dtype);Mr(Dr,jn),rt.freeType(Dr)}else Ce.raise("invalid buffer data")}else if(ya(Ar)){ai=Ar.shape;var yr=Ar.stride,tr=0,Ti=0,Je=0,_i=0;ai.length===1?(tr=ai[0],Ti=1,Je=yr[0],_i=0):ai.length===2?(tr=ai[0],Ti=ai[1],Je=yr[0],_i=yr[1]):Ce.raise("invalid shape");var si=Array.isArray(Ar.data)?Tr.dtype:Tf(Ar.data),Kn=rt.allocType(si,tr*Ti);wf(Kn,Ar.data,tr,Ti,Je,_i,Ar.offset),Mr(Kn,jn),rt.freeType(Kn)}else Ce.raise("invalid data for buffer subdata");return pn}return Ur||pn(Bt),pn._reglType="buffer",pn._buffer=Tr,pn.subdata=ln,Ye.profile&&(pn.stats=Tr.stats),pn.destroy=function(){en(Tr)},pn}function $r(){Ji(er).forEach(function(Bt){Bt.buffer=G.createBuffer(),G.bindBuffer(Bt.type,Bt.buffer),G.bufferData(Bt.type,Bt.persistentData||Bt.byteLength,Bt.usage)})}return Ye.profile&&(we.getTotalBufferSize=function(){var Bt=0;return Object.keys(er).forEach(function(ur){Bt+=er[ur].stats.size}),Bt}),{create:Or,createStream:Pr,destroyStream:Yr,clear:function(){Ji(er).forEach(en),Br.forEach(en)},getBuffer:function(Bt){return Bt&&Bt._buffer instanceof jt?Bt._buffer:null},restore:$r,_initBuffer:Hr}}var ph=0,dh=0,rp=1,np=1,zp=4,Yc=4,Fu={points:ph,point:dh,lines:rp,line:np,triangles:zp,triangle:Yc,"line loop":2,"line strip":3,"triangle strip":5,"triangle fan":6},ip=0,qo=1,Xl=4,Tl=5120,Ks=5121,wl=5122,ui=5123,tl=5124,Bs=5125,Nu=34963,rl=35040,ap=35044;function $i(G,we,Ye,Kt){var vr={},er=0,jt={uint8:Ks,uint16:ui};we.oes_element_index_uint&&(jt.uint32=Bs);function Br($r){this.id=er++,vr[this.id]=this,this.buffer=$r,this.primType=Xl,this.vertCount=0,this.type=0}Br.prototype.bind=function(){this.buffer.bind()};var Pr=[];function Yr($r){var Bt=Pr.pop();return Bt||(Bt=new Br(Ye.create(null,Nu,!0,!1)._buffer)),Hr(Bt,$r,rl,-1,-1,0,0),Bt}function Nr($r){Pr.push($r)}function Hr($r,Bt,ur,Ur,un,Tr,pn){$r.buffer.bind();var Mr;if(Bt){var ln=pn;!pn&&(!re(Bt)||ya(Bt)&&!re(Bt.data))&&(ln=we.oes_element_index_uint?Bs:ui),Ye._initBuffer($r.buffer,Bt,ur,ln,3)}else G.bufferData(Nu,Tr,ur),$r.buffer.dtype=Mr||Ks,$r.buffer.usage=ur,$r.buffer.dimension=3,$r.buffer.byteLength=Tr;if(Mr=pn,!pn){switch($r.buffer.dtype){case Ks:case Tl:Mr=Ks;break;case ui:case wl:Mr=ui;break;case Bs:case tl:Mr=Bs;break;default:Ce.raise("unsupported type for element array")}$r.buffer.dtype=Mr}$r.type=Mr,Ce(Mr!==Bs||!!we.oes_element_index_uint,"32 bit element buffers not supported, enable oes_element_index_uint first");var Ar=un;Ar<0&&(Ar=$r.buffer.byteLength,Mr===ui?Ar>>=1:Mr===Bs&&(Ar>>=2)),$r.vertCount=Ar;var on=Ur;if(Ur<0){on=Xl;var jn=$r.buffer.dimension;jn===1&&(on=ip),jn===2&&(on=qo),jn===3&&(on=Xl)}$r.primType=on}function en($r){Kt.elementsCount--,Ce($r.buffer!==null,"must not double destroy elements"),delete vr[$r.id],$r.buffer.destroy(),$r.buffer=null}function Or($r,Bt){var ur=Ye.create(null,Nu,!0),Ur=new Br(ur._buffer);Kt.elementsCount++;function un(Tr){if(!Tr)ur(),Ur.primType=Xl,Ur.vertCount=0,Ur.type=Ks;else if(typeof Tr=="number")ur(Tr),Ur.primType=Xl,Ur.vertCount=Tr|0,Ur.type=Ks;else{var pn=null,Mr=ap,ln=-1,Ar=-1,on=0,jn=0;Array.isArray(Tr)||re(Tr)||ya(Tr)?pn=Tr:(Ce.type(Tr,"object","invalid arguments for elements"),"data"in Tr&&(pn=Tr.data,Ce(Array.isArray(pn)||re(pn)||ya(pn),"invalid data for element buffer")),"usage"in Tr&&(Ce.parameter(Tr.usage,Lu,"invalid element buffer usage"),Mr=Lu[Tr.usage]),"primitive"in Tr&&(Ce.parameter(Tr.primitive,Fu,"invalid element buffer primitive"),ln=Fu[Tr.primitive]),"count"in Tr&&(Ce(typeof Tr.count=="number"&&Tr.count>=0,"invalid vertex count for elements"),Ar=Tr.count|0),"type"in Tr&&(Ce.parameter(Tr.type,jt,"invalid buffer type"),jn=jt[Tr.type]),"length"in Tr?on=Tr.length|0:(on=Ar,jn===ui||jn===wl?on*=2:(jn===Bs||jn===tl)&&(on*=4))),Hr(Ur,pn,Mr,ln,Ar,on,jn)}return un}return un($r),un._reglType="elements",un._elements=Ur,un.subdata=function(Tr,pn){return ur.subdata(Tr,pn),un},un.destroy=function(){en(Ur)},un}return{create:Or,createStream:Yr,destroyStream:Nr,getElements:function($r){return typeof $r=="function"&&$r._elements instanceof Br?$r._elements:null},clear:function(){Ji(vr).forEach(en)}}}var Ci=new Float32Array(1),ou=new Uint32Array(Ci.buffer),mu=5123;function Cf(G){for(var we=rt.allocType(mu,G.length),Ye=0;Ye<G.length;++Ye)if(isNaN(G[Ye]))we[Ye]=65535;else if(G[Ye]===1/0)we[Ye]=31744;else if(G[Ye]===-1/0)we[Ye]=64512;else{Ci[0]=G[Ye];var Kt=ou[0],vr=Kt>>>31<<15,er=(Kt<<1>>>24)-127,jt=Kt>>13&1024-1;if(er<-24)we[Ye]=vr;else if(er<-14){var Br=-14-er;we[Ye]=vr+(jt+1024>>Br)}else er>15?we[Ye]=vr+31744:we[Ye]=vr+(er+15<<10)+jt}return we}function Za(G){return Array.isArray(G)||re(G)}var vh=function(G){return!(G&G-1)&&!!G},Rf=34467,Fs=3553,nl=34067,gu=34069,Cl=6408,mh=6406,yc=6407,sa=6409,xc=6410,il=32854,Rl=32855,gh=36194,qc=32819,fa=32820,Ml=33635,op=34042,al=6402,Kc=34041,Qc=35904,Mf=35906,ol=36193,$l=33776,Uu=33777,Jc=33778,bc=33779,Yl=35986,_h=35987,Ec=34798,Ns=35840,yh=35841,ef=35842,Sc=35843,Il=36196,zu=5121,ql=5123,If=5125,sl=5126,xh=10242,bh=10243,Eh=10497,Pf=33071,sp=33648,Va=10240,up=10241,Of=9728,lp=9729,Kl=9984,cp=9985,Zu=9986,da=9987,Ql=33170,Vu=4352,ul=4353,Li=4354,va=34046,su=3317,tf=37440,rf=37441,Qs=37443,fp=37444,kf=33984,Df=[Kl,Zu,cp,da],Jl=[0,sa,xc,yc,Cl],Co={};Co[sa]=Co[mh]=Co[al]=1,Co[Kc]=Co[xc]=2,Co[yc]=Co[Qc]=3,Co[Cl]=Co[Mf]=4;function ja(G){return"[object "+G+"]"}var nf=ja("HTMLCanvasElement"),Ac=ja("OffscreenCanvas"),io=ja("CanvasRenderingContext2D"),xn=ja("ImageBitmap"),ms=ja("HTMLImageElement"),Lf=ja("HTMLVideoElement"),Tc=Object.keys(kn).concat([nf,Ac,io,xn,ms,Lf]),is=[];is[zu]=1,is[sl]=4,is[ol]=2,is[ql]=2,is[If]=4;var ha=[];ha[il]=2,ha[Rl]=2,ha[gh]=2,ha[Kc]=4,ha[$l]=.5,ha[Uu]=.5,ha[Jc]=1,ha[bc]=1,ha[Yl]=.5,ha[_h]=1,ha[Ec]=1,ha[Ns]=.5,ha[yh]=.25,ha[ef]=.5,ha[Sc]=.25,ha[Il]=.5;function Bf(G){return Array.isArray(G)&&(G.length===0||typeof G[0]=="number")}function an(G){if(!Array.isArray(G))return!1;var we=G.length;return!(we===0||!Za(G[0]))}function ll(G){return Object.prototype.toString.call(G)}function af(G){return ll(G)===nf}function of(G){return ll(G)===Ac}function _u(G){return ll(G)===io}function Us(G){return ll(G)===xn}function Ff(G){return ll(G)===ms}function Nf(G){return ll(G)===Lf}function gs(G){if(!G)return!1;var we=ll(G);return Tc.indexOf(we)>=0?!0:Bf(G)||an(G)||ya(G)}function yu(G){return kn[Object.prototype.toString.call(G)]|0}function hp(G,we){var Ye=we.length;switch(G.type){case zu:case ql:case If:case sl:var Kt=rt.allocType(G.type,Ye);Kt.set(we),G.data=Kt;break;case ol:G.data=Cf(we);break;default:Ce.raise("unsupported texture type, must specify a typed array")}}function wc(G,we){return rt.allocType(G.type===ol?sl:G.type,we)}function Cc(G,we){G.type===ol?(G.data=Cf(we),rt.freeType(we)):G.data=we}function Uf(G,we,Ye,Kt,vr,er){for(var jt=G.width,Br=G.height,Pr=G.channels,Yr=jt*Br*Pr,Nr=wc(G,Yr),Hr=0,en=0;en<Br;++en)for(var Or=0;Or<jt;++Or)for(var $r=0;$r<Pr;++$r)Nr[Hr++]=we[Ye*Or+Kt*en+vr*$r+er];Cc(G,Nr)}function Js(G,we,Ye,Kt,vr,er){var jt;if(typeof ha[G]!="undefined"?jt=ha[G]:jt=Co[G]*is[we],er&&(jt*=6),vr){for(var Br=0,Pr=Ye;Pr>=1;)Br+=jt*Pr*Pr,Pr/=2;return Br}else return jt*Ye*Kt}function Zt(G,we,Ye,Kt,vr,er,jt){var Br={"don't care":Vu,"dont care":Vu,nice:Li,fast:ul},Pr={repeat:Eh,clamp:Pf,mirror:sp},Yr={nearest:Of,linear:lp},Nr=U({mipmap:da,"nearest mipmap nearest":Kl,"linear mipmap nearest":cp,"nearest mipmap linear":Zu,"linear mipmap linear":da},Yr),Hr={none:0,browser:fp},en={uint8:zu,rgba4:qc,rgb565:Ml,"rgb5 a1":fa},Or={alpha:mh,luminance:sa,"luminance alpha":xc,rgb:yc,rgba:Cl,rgba4:il,"rgb5 a1":Rl,rgb565:gh},$r={};we.ext_srgb&&(Or.srgb=Qc,Or.srgba=Mf),we.oes_texture_float&&(en.float32=en.float=sl),we.oes_texture_half_float&&(en.float16=en["half float"]=ol),we.webgl_depth_texture&&(U(Or,{depth:al,"depth stencil":Kc}),U(en,{uint16:ql,uint32:If,"depth stencil":op})),we.webgl_compressed_texture_s3tc&&U($r,{"rgb s3tc dxt1":$l,"rgba s3tc dxt1":Uu,"rgba s3tc dxt3":Jc,"rgba s3tc dxt5":bc}),we.webgl_compressed_texture_atc&&U($r,{"rgb atc":Yl,"rgba atc explicit alpha":_h,"rgba atc interpolated alpha":Ec}),we.webgl_compressed_texture_pvrtc&&U($r,{"rgb pvrtc 4bppv1":Ns,"rgb pvrtc 2bppv1":yh,"rgba pvrtc 4bppv1":ef,"rgba pvrtc 2bppv1":Sc}),we.webgl_compressed_texture_etc1&&($r["rgb etc1"]=Il);var Bt=Array.prototype.slice.call(G.getParameter(Rf));Object.keys($r).forEach(function(je){var nr=$r[je];Bt.indexOf(nr)>=0&&(Or[je]=nr)});var ur=Object.keys(Or);Ye.textureFormats=ur;var Ur=[];Object.keys(Or).forEach(function(je){var nr=Or[je];Ur[nr]=je});var un=[];Object.keys(en).forEach(function(je){var nr=en[je];un[nr]=je});var Tr=[];Object.keys(Yr).forEach(function(je){var nr=Yr[je];Tr[nr]=je});var pn=[];Object.keys(Nr).forEach(function(je){var nr=Nr[je];pn[nr]=je});var Mr=[];Object.keys(Pr).forEach(function(je){var nr=Pr[je];Mr[nr]=je});var ln=ur.reduce(function(je,nr){var Gt=Or[nr];return Gt===sa||Gt===mh||Gt===sa||Gt===xc||Gt===al||Gt===Kc||we.ext_srgb&&(Gt===Qc||Gt===Mf)?je[Gt]=Gt:Gt===Rl||nr.indexOf("rgba")>=0?je[Gt]=Cl:je[Gt]=yc,je},{});function Ar(){this.internalformat=Cl,this.format=Cl,this.type=zu,this.compressed=!1,this.premultiplyAlpha=!1,this.flipY=!1,this.unpackAlignment=1,this.colorSpace=fp,this.width=0,this.height=0,this.channels=0}function on(je,nr){je.internalformat=nr.internalformat,je.format=nr.format,je.type=nr.type,je.compressed=nr.compressed,je.premultiplyAlpha=nr.premultiplyAlpha,je.flipY=nr.flipY,je.unpackAlignment=nr.unpackAlignment,je.colorSpace=nr.colorSpace,je.width=nr.width,je.height=nr.height,je.channels=nr.channels}function jn(je,nr){if(!(typeof nr!="object"||!nr)){if("premultiplyAlpha"in nr&&(Ce.type(nr.premultiplyAlpha,"boolean","invalid premultiplyAlpha"),je.premultiplyAlpha=nr.premultiplyAlpha),"flipY"in nr&&(Ce.type(nr.flipY,"boolean","invalid texture flip"),je.flipY=nr.flipY),"alignment"in nr&&(Ce.oneOf(nr.alignment,[1,2,4,8],"invalid texture unpack alignment"),je.unpackAlignment=nr.alignment),"colorSpace"in nr&&(Ce.parameter(nr.colorSpace,Hr,"invalid colorSpace"),je.colorSpace=Hr[nr.colorSpace]),"type"in nr){var Gt=nr.type;Ce(we.oes_texture_float||!(Gt==="float"||Gt==="float32"),"you must enable the OES_texture_float extension in order to use floating point textures."),Ce(we.oes_texture_half_float||!(Gt==="half float"||Gt==="float16"),"you must enable the OES_texture_half_float extension in order to use 16-bit floating point textures."),Ce(we.webgl_depth_texture||!(Gt==="uint16"||Gt==="uint32"||Gt==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Ce.parameter(Gt,en,"invalid texture type"),je.type=en[Gt]}var dn=je.width,yi=je.height,ma=je.channels,pe=!1;"shape"in nr?(Ce(Array.isArray(nr.shape)&&nr.shape.length>=2,"shape must be an array"),dn=nr.shape[0],yi=nr.shape[1],nr.shape.length===3&&(ma=nr.shape[2],Ce(ma>0&&ma<=4,"invalid number of channels"),pe=!0),Ce(dn>=0&&dn<=Ye.maxTextureSize,"invalid width"),Ce(yi>=0&&yi<=Ye.maxTextureSize,"invalid height")):("radius"in nr&&(dn=yi=nr.radius,Ce(dn>=0&&dn<=Ye.maxTextureSize,"invalid radius")),"width"in nr&&(dn=nr.width,Ce(dn>=0&&dn<=Ye.maxTextureSize,"invalid width")),"height"in nr&&(yi=nr.height,Ce(yi>=0&&yi<=Ye.maxTextureSize,"invalid height")),"channels"in nr&&(ma=nr.channels,Ce(ma>0&&ma<=4,"invalid number of channels"),pe=!0)),je.width=dn|0,je.height=yi|0,je.channels=ma|0;var Ie=!1;if("format"in nr){var $e=nr.format;Ce(we.webgl_depth_texture||!($e==="depth"||$e==="depth stencil"),"you must enable the WEBGL_depth_texture extension in order to use depth/stencil textures."),Ce.parameter($e,Or,"invalid texture format");var $t=je.internalformat=Or[$e];je.format=ln[$t],$e in en&&("type"in nr||(je.type=en[$e])),$e in $r&&(je.compressed=!0),Ie=!0}!pe&&Ie?je.channels=Co[je.format]:pe&&!Ie?je.channels!==Jl[je.format]&&(je.format=je.internalformat=Jl[je.channels]):Ie&&pe&&Ce(je.channels===Co[je.format],"number of channels inconsistent with specified format")}}function ai(je){G.pixelStorei(tf,je.flipY),G.pixelStorei(rf,je.premultiplyAlpha),G.pixelStorei(Qs,je.colorSpace),G.pixelStorei(su,je.unpackAlignment)}function rn(){Ar.call(this),this.xOffset=0,this.yOffset=0,this.data=null,this.needsFree=!1,this.element=null,this.needsCopy=!1}function Dr(je,nr){var Gt=null;if(gs(nr)?Gt=nr:nr&&(Ce.type(nr,"object","invalid pixel data type"),jn(je,nr),"x"in nr&&(je.xOffset=nr.x|0),"y"in nr&&(je.yOffset=nr.y|0),gs(nr.data)&&(Gt=nr.data)),Ce(!je.compressed||Gt instanceof Uint8Array,"compressed texture data must be stored in a uint8array"),nr.copy){Ce(!Gt,"can not specify copy and data field for the same texture");var dn=vr.viewportWidth,yi=vr.viewportHeight;je.width=je.width||dn-je.xOffset,je.height=je.height||yi-je.yOffset,je.needsCopy=!0,Ce(je.xOffset>=0&&je.xOffset<dn&&je.yOffset>=0&&je.yOffset<yi&&je.width>0&&je.width<=dn&&je.height>0&&je.height<=yi,"copy texture read out of bounds")}else if(!Gt)je.width=je.width||1,je.height=je.height||1,je.channels=je.channels||4;else if(re(Gt))je.channels=je.channels||4,je.data=Gt,!("type"in nr)&&je.type===zu&&(je.type=yu(Gt));else if(Bf(Gt))je.channels=je.channels||4,hp(je,Gt),je.alignment=1,je.needsFree=!0;else if(ya(Gt)){var ma=Gt.data;!Array.isArray(ma)&&je.type===zu&&(je.type=yu(ma));var pe=Gt.shape,Ie=Gt.stride,$e,$t,Vt,ct,yt,St;pe.length===3?(Vt=pe[2],St=Ie[2]):(Ce(pe.length===2,"invalid ndarray pixel data, must be 2 or 3D"),Vt=1,St=1),$e=pe[0],$t=pe[1],ct=Ie[0],yt=Ie[1],je.alignment=1,je.width=$e,je.height=$t,je.channels=Vt,je.format=je.internalformat=Jl[Vt],je.needsFree=!0,Uf(je,ma,ct,yt,St,Gt.offset)}else if(af(Gt)||of(Gt)||_u(Gt))af(Gt)||of(Gt)?je.element=Gt:je.element=Gt.canvas,je.width=je.element.width,je.height=je.element.height,je.channels=4;else if(Us(Gt))je.element=Gt,je.width=Gt.width,je.height=Gt.height,je.channels=4;else if(Ff(Gt))je.element=Gt,je.width=Gt.naturalWidth,je.height=Gt.naturalHeight,je.channels=4;else if(Nf(Gt))je.element=Gt,je.width=Gt.videoWidth,je.height=Gt.videoHeight,je.channels=4;else if(an(Gt)){var He=je.width||Gt[0].length,dt=je.height||Gt.length,Me=je.channels;Za(Gt[0][0])?Me=Me||Gt[0][0].length:Me=Me||1;for(var gt=Jt.shape(Gt),It=1,hr=0;hr<gt.length;++hr)It*=gt[hr];var Rr=wc(je,It);Jt.flatten(Gt,gt,"",Rr),Cc(je,Rr),je.alignment=1,je.width=He,je.height=dt,je.channels=Me,je.format=je.internalformat=Jl[Me],je.needsFree=!0}je.type===sl?Ce(Ye.extensions.indexOf("oes_texture_float")>=0,"oes_texture_float extension not enabled"):je.type===ol&&Ce(Ye.extensions.indexOf("oes_texture_half_float")>=0,"oes_texture_half_float extension not enabled")}function yr(je,nr,Gt){var dn=je.element,yi=je.data,ma=je.internalformat,pe=je.format,Ie=je.type,$e=je.width,$t=je.height;ai(je),dn?G.texImage2D(nr,Gt,pe,pe,Ie,dn):je.compressed?G.compressedTexImage2D(nr,Gt,ma,$e,$t,0,yi):je.needsCopy?(Kt(),G.copyTexImage2D(nr,Gt,pe,je.xOffset,je.yOffset,$e,$t,0)):G.texImage2D(nr,Gt,pe,$e,$t,0,pe,Ie,yi||null)}function tr(je,nr,Gt,dn,yi){var ma=je.element,pe=je.data,Ie=je.internalformat,$e=je.format,$t=je.type,Vt=je.width,ct=je.height;ai(je),ma?G.texSubImage2D(nr,yi,Gt,dn,$e,$t,ma):je.compressed?G.compressedTexSubImage2D(nr,yi,Gt,dn,Ie,Vt,ct,pe):je.needsCopy?(Kt(),G.copyTexSubImage2D(nr,yi,Gt,dn,je.xOffset,je.yOffset,Vt,ct)):G.texSubImage2D(nr,yi,Gt,dn,Vt,ct,$e,$t,pe)}var Ti=[];function Je(){return Ti.pop()||new rn}function _i(je){je.needsFree&&rt.freeType(je.data),rn.call(je),Ti.push(je)}function si(){Ar.call(this),this.genMipmaps=!1,this.mipmapHint=Vu,this.mipmask=0,this.images=Array(16)}function Kn(je,nr,Gt){var dn=je.images[0]=Je();je.mipmask=1,dn.width=je.width=nr,dn.height=je.height=Gt,dn.channels=je.channels=4}function Yi(je,nr){var Gt=null;if(gs(nr))Gt=je.images[0]=Je(),on(Gt,je),Dr(Gt,nr),je.mipmask=1;else if(jn(je,nr),Array.isArray(nr.mipmap))for(var dn=nr.mipmap,yi=0;yi<dn.length;++yi)Gt=je.images[yi]=Je(),on(Gt,je),Gt.width>>=yi,Gt.height>>=yi,Dr(Gt,dn[yi]),je.mipmask|=1<<yi;else Gt=je.images[0]=Je(),on(Gt,je),Dr(Gt,nr),je.mipmask=1;on(je,je.images[0]),je.compressed&&(je.internalformat===$l||je.internalformat===Uu||je.internalformat===Jc||je.internalformat===bc)&&Ce(je.width%4===0&&je.height%4===0,"for compressed texture formats, mipmap level 0 must have width and height that are a multiple of 4")}function ho(je,nr){for(var Gt=je.images,dn=0;dn<Gt.length;++dn){if(!Gt[dn])return;yr(Gt[dn],nr,dn)}}var po=[];function Ii(){var je=po.pop()||new si;Ar.call(je),je.mipmask=0;for(var nr=0;nr<16;++nr)je.images[nr]=null;return je}function _o(je){for(var nr=je.images,Gt=0;Gt<nr.length;++Gt)nr[Gt]&&_i(nr[Gt]),nr[Gt]=null;po.push(je)}function xa(){this.minFilter=Of,this.magFilter=Of,this.wrapS=Pf,this.wrapT=Pf,this.anisotropic=1,this.genMipmaps=!1,this.mipmapHint=Vu}function yo(je,nr){if("min"in nr){var Gt=nr.min;Ce.parameter(Gt,Nr),je.minFilter=Nr[Gt],Df.indexOf(je.minFilter)>=0&&!("faces"in nr)&&(je.genMipmaps=!0)}if("mag"in nr){var dn=nr.mag;Ce.parameter(dn,Yr),je.magFilter=Yr[dn]}var yi=je.wrapS,ma=je.wrapT;if("wrap"in nr){var pe=nr.wrap;typeof pe=="string"?(Ce.parameter(pe,Pr),yi=ma=Pr[pe]):Array.isArray(pe)&&(Ce.parameter(pe[0],Pr),Ce.parameter(pe[1],Pr),yi=Pr[pe[0]],ma=Pr[pe[1]])}else{if("wrapS"in nr){var Ie=nr.wrapS;Ce.parameter(Ie,Pr),yi=Pr[Ie]}if("wrapT"in nr){var $e=nr.wrapT;Ce.parameter($e,Pr),ma=Pr[$e]}}if(je.wrapS=yi,je.wrapT=ma,"anisotropic"in nr){var $t=nr.anisotropic;Ce(typeof $t=="number"&&$t>=1&&$t<=Ye.maxAnisotropic,"aniso samples must be between 1 and "),je.anisotropic=nr.anisotropic}if("mipmap"in nr){var Vt=!1;switch(typeof nr.mipmap){case"string":Ce.parameter(nr.mipmap,Br,"invalid mipmap hint"),je.mipmapHint=Br[nr.mipmap],je.genMipmaps=!0,Vt=!0;break;case"boolean":Vt=je.genMipmaps=nr.mipmap;break;case"object":Ce(Array.isArray(nr.mipmap),"invalid mipmap type"),je.genMipmaps=!1,Vt=!0;break;default:Ce.raise("invalid mipmap type")}Vt&&!("min"in nr)&&(je.minFilter=Kl)}}function xo(je,nr){G.texParameteri(nr,up,je.minFilter),G.texParameteri(nr,Va,je.magFilter),G.texParameteri(nr,xh,je.wrapS),G.texParameteri(nr,bh,je.wrapT),we.ext_texture_filter_anisotropic&&G.texParameteri(nr,va,je.anisotropic),je.genMipmaps&&(G.hint(Ql,je.mipmapHint),G.generateMipmap(nr))}var Wa=0,Bo={},As=Ye.maxTextureUnits,bo=Array(As).map(function(){return null});function gi(je){Ar.call(this),this.mipmask=0,this.internalformat=Cl,this.id=Wa++,this.refCount=1,this.target=je,this.texture=G.createTexture(),this.unit=-1,this.bindCount=0,this.texInfo=new xa,jt.profile&&(this.stats={size:0})}function ls(je){G.activeTexture(kf),G.bindTexture(je.target,je.texture)}function ia(){var je=bo[0];je?G.bindTexture(je.target,je.texture):G.bindTexture(Fs,null)}function $n(je){var nr=je.texture;Ce(nr,"must not double destroy texture");var Gt=je.unit,dn=je.target;Gt>=0&&(G.activeTexture(kf+Gt),G.bindTexture(dn,null),bo[Gt]=null),G.deleteTexture(nr),je.texture=null,je.params=null,je.pixels=null,je.refCount=0,delete Bo[je.id],er.textureCount--}U(gi.prototype,{bind:function(){var je=this;je.bindCount+=1;var nr=je.unit;if(nr<0){for(var Gt=0;Gt<As;++Gt){var dn=bo[Gt];if(dn){if(dn.bindCount>0)continue;dn.unit=-1}bo[Gt]=je,nr=Gt;break}nr>=As&&Ce.raise("insufficient number of texture units"),jt.profile&&er.maxTextureUnits<nr+1&&(er.maxTextureUnits=nr+1),je.unit=nr,G.activeTexture(kf+nr),G.bindTexture(je.target,je.texture)}return nr},unbind:function(){this.bindCount-=1},decRef:function(){--this.refCount<=0&&$n(this)}});function Ri(je,nr){var Gt=new gi(Fs);Bo[Gt.id]=Gt,er.textureCount++;function dn(pe,Ie){var $e=Gt.texInfo;xa.call($e);var $t=Ii();return typeof pe=="number"?typeof Ie=="number"?Kn($t,pe|0,Ie|0):Kn($t,pe|0,pe|0):pe?(Ce.type(pe,"object","invalid arguments to regl.texture"),yo($e,pe),Yi($t,pe)):Kn($t,1,1),$e.genMipmaps&&($t.mipmask=($t.width<<1)-1),Gt.mipmask=$t.mipmask,on(Gt,$t),Ce.texture2D($e,$t,Ye),Gt.internalformat=$t.internalformat,dn.width=$t.width,dn.height=$t.height,ls(Gt),ho($t,Fs),xo($e,Fs),ia(),_o($t),jt.profile&&(Gt.stats.size=Js(Gt.internalformat,Gt.type,$t.width,$t.height,$e.genMipmaps,!1)),dn.format=Ur[Gt.internalformat],dn.type=un[Gt.type],dn.mag=Tr[$e.magFilter],dn.min=pn[$e.minFilter],dn.wrapS=Mr[$e.wrapS],dn.wrapT=Mr[$e.wrapT],dn}function yi(pe,Ie,$e,$t){Ce(!!pe,"must specify image data");var Vt=Ie|0,ct=$e|0,yt=$t|0,St=Je();return on(St,Gt),St.width=0,St.height=0,Dr(St,pe),St.width=St.width||(Gt.width>>yt)-Vt,St.height=St.height||(Gt.height>>yt)-ct,Ce(Gt.type===St.type&&Gt.format===St.format&&Gt.internalformat===St.internalformat,"incompatible format for texture.subimage"),Ce(Vt>=0&&ct>=0&&Vt+St.width<=Gt.width&&ct+St.height<=Gt.height,"texture.subimage write out of bounds"),Ce(Gt.mipmask&1<<yt,"missing mipmap data"),Ce(St.data||St.element||St.needsCopy,"missing image data"),ls(Gt),tr(St,Fs,Vt,ct,yt),ia(),_i(St),dn}function ma(pe,Ie){var $e=pe|0,$t=Ie|0||$e;if($e===Gt.width&&$t===Gt.height)return dn;dn.width=Gt.width=$e,dn.height=Gt.height=$t,ls(Gt);for(var Vt=0;Gt.mipmask>>Vt;++Vt){var ct=$e>>Vt,yt=$t>>Vt;if(!ct||!yt)break;G.texImage2D(Fs,Vt,Gt.format,ct,yt,0,Gt.format,Gt.type,null)}return ia(),jt.profile&&(Gt.stats.size=Js(Gt.internalformat,Gt.type,$e,$t,!1,!1)),dn}return dn(je,nr),dn.subimage=yi,dn.resize=ma,dn._reglType="texture2d",dn._texture=Gt,jt.profile&&(dn.stats=Gt.stats),dn.destroy=function(){Gt.decRef()},dn}function Gi(je,nr,Gt,dn,yi,ma){var pe=new gi(nl);Bo[pe.id]=pe,er.cubeCount++;var Ie=new Array(6);function $e(ct,yt,St,He,dt,Me){var gt,It=pe.texInfo;for(xa.call(It),gt=0;gt<6;++gt)Ie[gt]=Ii();if(typeof ct=="number"||!ct){var hr=ct|0||1;for(gt=0;gt<6;++gt)Kn(Ie[gt],hr,hr)}else if(typeof ct=="object")if(yt)Yi(Ie[0],ct),Yi(Ie[1],yt),Yi(Ie[2],St),Yi(Ie[3],He),Yi(Ie[4],dt),Yi(Ie[5],Me);else if(yo(It,ct),jn(pe,ct),"faces"in ct){var Rr=ct.faces;for(Ce(Array.isArray(Rr)&&Rr.length===6,"cube faces must be a length 6 array"),gt=0;gt<6;++gt)Ce(typeof Rr[gt]=="object"&&!!Rr[gt],"invalid input for cube map face"),on(Ie[gt],pe),Yi(Ie[gt],Rr[gt])}else for(gt=0;gt<6;++gt)Yi(Ie[gt],ct);else Ce.raise("invalid arguments to cube map");for(on(pe,Ie[0]),Ye.npotTextureCube||Ce(vh(pe.width)&&vh(pe.height),"your browser does not support non power or two texture dimensions"),It.genMipmaps?pe.mipmask=(Ie[0].width<<1)-1:pe.mipmask=Ie[0].mipmask,Ce.textureCube(pe,It,Ie,Ye),pe.internalformat=Ie[0].internalformat,$e.width=Ie[0].width,$e.height=Ie[0].height,ls(pe),gt=0;gt<6;++gt)ho(Ie[gt],gu+gt);for(xo(It,nl),ia(),jt.profile&&(pe.stats.size=Js(pe.internalformat,pe.type,$e.width,$e.height,It.genMipmaps,!0)),$e.format=Ur[pe.internalformat],$e.type=un[pe.type],$e.mag=Tr[It.magFilter],$e.min=pn[It.minFilter],$e.wrapS=Mr[It.wrapS],$e.wrapT=Mr[It.wrapT],gt=0;gt<6;++gt)_o(Ie[gt]);return $e}function $t(ct,yt,St,He,dt){Ce(!!yt,"must specify image data"),Ce(typeof ct=="number"&&ct===(ct|0)&&ct>=0&&ct<6,"invalid face");var Me=St|0,gt=He|0,It=dt|0,hr=Je();return on(hr,pe),hr.width=0,hr.height=0,Dr(hr,yt),hr.width=hr.width||(pe.width>>It)-Me,hr.height=hr.height||(pe.height>>It)-gt,Ce(pe.type===hr.type&&pe.format===hr.format&&pe.internalformat===hr.internalformat,"incompatible format for texture.subimage"),Ce(Me>=0&&gt>=0&&Me+hr.width<=pe.width&&gt+hr.height<=pe.height,"texture.subimage write out of bounds"),Ce(pe.mipmask&1<<It,"missing mipmap data"),Ce(hr.data||hr.element||hr.needsCopy,"missing image data"),ls(pe),tr(hr,gu+ct,Me,gt,It),ia(),_i(hr),$e}function Vt(ct){var yt=ct|0;if(yt!==pe.width){$e.width=pe.width=yt,$e.height=pe.height=yt,ls(pe);for(var St=0;St<6;++St)for(var He=0;pe.mipmask>>He;++He)G.texImage2D(gu+St,He,pe.format,yt>>He,yt>>He,0,pe.format,pe.type,null);return ia(),jt.profile&&(pe.stats.size=Js(pe.internalformat,pe.type,$e.width,$e.height,!1,!0)),$e}}return $e(je,nr,Gt,dn,yi,ma),$e.subimage=$t,$e.resize=Vt,$e._reglType="textureCube",$e._texture=pe,jt.profile&&($e.stats=pe.stats),$e.destroy=function(){pe.decRef()},$e}function Eo(){for(var je=0;je<As;++je)G.activeTexture(kf+je),G.bindTexture(Fs,null),bo[je]=null;Ji(Bo).forEach($n),er.cubeCount=0,er.textureCount=0}jt.profile&&(er.getTotalTextureSize=function(){var je=0;return Object.keys(Bo).forEach(function(nr){je+=Bo[nr].stats.size}),je});function gl(){for(var je=0;je<As;++je){var nr=bo[je];nr&&(nr.bindCount=0,nr.unit=-1,bo[je]=null)}Ji(Bo).forEach(function(Gt){Gt.texture=G.createTexture(),G.bindTexture(Gt.target,Gt.texture);for(var dn=0;dn<32;++dn)if(Gt.mipmask&1<<dn)if(Gt.target===Fs)G.texImage2D(Fs,dn,Gt.internalformat,Gt.width>>dn,Gt.height>>dn,0,Gt.internalformat,Gt.type,null);else for(var yi=0;yi<6;++yi)G.texImage2D(gu+yi,dn,Gt.internalformat,Gt.width>>dn,Gt.height>>dn,0,Gt.internalformat,Gt.type,null);xo(Gt.texInfo,Gt.target)})}return{create2D:Ri,createCube:Gi,clear:Eo,getTexture:function(je){return null},restore:gl}}var Re=36161,F=32854,eu=32855,_e=36194,Pl=33189,qa=36168,zs=34041,Ro=35907,_s=34836,Dn=34842,An=34843,as=[];as[F]=2,as[eu]=2,as[_e]=2,as[Pl]=2,as[qa]=1,as[zs]=4,as[Ro]=4,as[_s]=16,as[Dn]=8,as[An]=6;function os(G,we,Ye){return as[G]*we*Ye}var xu=function(G,we,Ye,Kt,vr){var er={rgba4:F,rgb565:_e,"rgb5 a1":eu,depth:Pl,stencil:qa,"depth stencil":zs};we.ext_srgb&&(er.srgba=Ro),we.ext_color_buffer_half_float&&(er.rgba16f=Dn,er.rgb16f=An),we.webgl_color_buffer_float&&(er.rgba32f=_s);var jt=[];Object.keys(er).forEach(function(Or){var $r=er[Or];jt[$r]=Or});var Br=0,Pr={};function Yr(Or){this.id=Br++,this.refCount=1,this.renderbuffer=Or,this.format=F,this.width=0,this.height=0,vr.profile&&(this.stats={size:0})}Yr.prototype.decRef=function(){--this.refCount<=0&&Nr(this)};function Nr(Or){var $r=Or.renderbuffer;Ce($r,"must not double destroy renderbuffer"),G.bindRenderbuffer(Re,null),G.deleteRenderbuffer($r),Or.renderbuffer=null,Or.refCount=0,delete Pr[Or.id],Kt.renderbufferCount--}function Hr(Or,$r){var Bt=new Yr(G.createRenderbuffer());Pr[Bt.id]=Bt,Kt.renderbufferCount++;function ur(un,Tr){var pn=0,Mr=0,ln=F;if(typeof un=="object"&&un){var Ar=un;if("shape"in Ar){var on=Ar.shape;Ce(Array.isArray(on)&&on.length>=2,"invalid renderbuffer shape"),pn=on[0]|0,Mr=on[1]|0}else"radius"in Ar&&(pn=Mr=Ar.radius|0),"width"in Ar&&(pn=Ar.width|0),"height"in Ar&&(Mr=Ar.height|0);"format"in Ar&&(Ce.parameter(Ar.format,er,"invalid renderbuffer format"),ln=er[Ar.format])}else typeof un=="number"?(pn=un|0,typeof Tr=="number"?Mr=Tr|0:Mr=pn):un?Ce.raise("invalid arguments to renderbuffer constructor"):pn=Mr=1;if(Ce(pn>0&&Mr>0&&pn<=Ye.maxRenderbufferSize&&Mr<=Ye.maxRenderbufferSize,"invalid renderbuffer size"),!(pn===Bt.width&&Mr===Bt.height&&ln===Bt.format))return ur.width=Bt.width=pn,ur.height=Bt.height=Mr,Bt.format=ln,G.bindRenderbuffer(Re,Bt.renderbuffer),G.renderbufferStorage(Re,ln,pn,Mr),Ce(G.getError()===0,"invalid render buffer format"),vr.profile&&(Bt.stats.size=os(Bt.format,Bt.width,Bt.height)),ur.format=jt[Bt.format],ur}function Ur(un,Tr){var pn=un|0,Mr=Tr|0||pn;return pn===Bt.width&&Mr===Bt.height||(Ce(pn>0&&Mr>0&&pn<=Ye.maxRenderbufferSize&&Mr<=Ye.maxRenderbufferSize,"invalid renderbuffer size"),ur.width=Bt.width=pn,ur.height=Bt.height=Mr,G.bindRenderbuffer(Re,Bt.renderbuffer),G.renderbufferStorage(Re,Bt.format,pn,Mr),Ce(G.getError()===0,"invalid render buffer format"),vr.profile&&(Bt.stats.size=os(Bt.format,Bt.width,Bt.height))),ur}return ur(Or,$r),ur.resize=Ur,ur._reglType="renderbuffer",ur._renderbuffer=Bt,vr.profile&&(ur.stats=Bt.stats),ur.destroy=function(){Bt.decRef()},ur}vr.profile&&(Kt.getTotalRenderbufferSize=function(){var Or=0;return Object.keys(Pr).forEach(function($r){Or+=Pr[$r].stats.size}),Or});function en(){Ji(Pr).forEach(function(Or){Or.renderbuffer=G.createRenderbuffer(),G.bindRenderbuffer(Re,Or.renderbuffer),G.renderbufferStorage(Re,Or.format,Or.width,Or.height)}),G.bindRenderbuffer(Re,null)}return{create:Hr,clear:function(){Ji(Pr).forEach(Nr)},restore:en}},Ba=36160,tu=36161,bu=3553,Eu=34069,oa=36064,mo=36096,Sh=36128,Ol=33306,zf=36053,cl=36054,ys=36055,ec=36057,Su=36061,Zf=36193,Rc=5121,sf=5126,Vf=6407,tc=6408,rc=6402,Ah=[Vf,tc],ss=[];ss[tc]=4,ss[Vf]=3;var Au=[];Au[Rc]=1,Au[sf]=4,Au[Zf]=2;var uf=32854,kl=32855,uu=36194,Th=33189,ju=36168,jf=34041,wh=35907,h=34836,v=34842,p=34843,g=[uf,kl,uu,wh,v,p,h],S={};S[zf]="complete",S[cl]="incomplete attachment",S[ec]="incomplete dimensions",S[ys]="incomplete, missing attachment",S[Su]="unsupported";function w(G,we,Ye,Kt,vr,er){var jt={cur:null,next:null,dirty:!1,setFBO:null},Br=["rgba"],Pr=["rgba4","rgb565","rgb5 a1"];we.ext_srgb&&Pr.push("srgba"),we.ext_color_buffer_half_float&&Pr.push("rgba16f","rgb16f"),we.webgl_color_buffer_float&&Pr.push("rgba32f");var Yr=["uint8"];we.oes_texture_half_float&&Yr.push("half float","float16"),we.oes_texture_float&&Yr.push("float","float32");function Nr(rn,Dr,yr){this.target=rn,this.texture=Dr,this.renderbuffer=yr;var tr=0,Ti=0;Dr?(tr=Dr.width,Ti=Dr.height):yr&&(tr=yr.width,Ti=yr.height),this.width=tr,this.height=Ti}function Hr(rn){rn&&(rn.texture&&rn.texture._texture.decRef(),rn.renderbuffer&&rn.renderbuffer._renderbuffer.decRef())}function en(rn,Dr,yr){if(rn)if(rn.texture){var tr=rn.texture._texture,Ti=Math.max(1,tr.width),Je=Math.max(1,tr.height);Ce(Ti===Dr&&Je===yr,"inconsistent width/height for supplied texture"),tr.refCount+=1}else{var _i=rn.renderbuffer._renderbuffer;Ce(_i.width===Dr&&_i.height===yr,"inconsistent width/height for renderbuffer"),_i.refCount+=1}}function Or(rn,Dr){Dr&&(Dr.texture?G.framebufferTexture2D(Ba,rn,Dr.target,Dr.texture._texture.texture,0):G.framebufferRenderbuffer(Ba,rn,tu,Dr.renderbuffer._renderbuffer.renderbuffer))}function $r(rn){var Dr=bu,yr=null,tr=null,Ti=rn;typeof rn=="object"&&(Ti=rn.data,"target"in rn&&(Dr=rn.target|0)),Ce.type(Ti,"function","invalid attachment data");var Je=Ti._reglType;return Je==="texture2d"?(yr=Ti,Ce(Dr===bu)):Je==="textureCube"?(yr=Ti,Ce(Dr>=Eu&&Dr<Eu+6,"invalid cube map target")):Je==="renderbuffer"?(tr=Ti,Dr=tu):Ce.raise("invalid regl object for attachment"),new Nr(Dr,yr,tr)}function Bt(rn,Dr,yr,tr,Ti){if(yr){var Je=Kt.create2D({width:rn,height:Dr,format:tr,type:Ti});return Je._texture.refCount=0,new Nr(bu,Je,null)}else{var _i=vr.create({width:rn,height:Dr,format:tr});return _i._renderbuffer.refCount=0,new Nr(tu,null,_i)}}function ur(rn){return rn&&(rn.texture||rn.renderbuffer)}function Ur(rn,Dr,yr){rn&&(rn.texture?rn.texture.resize(Dr,yr):rn.renderbuffer&&rn.renderbuffer.resize(Dr,yr),rn.width=Dr,rn.height=yr)}var un=0,Tr={};function pn(){this.id=un++,Tr[this.id]=this,this.framebuffer=G.createFramebuffer(),this.width=0,this.height=0,this.colorAttachments=[],this.depthAttachment=null,this.stencilAttachment=null,this.depthStencilAttachment=null}function Mr(rn){rn.colorAttachments.forEach(Hr),Hr(rn.depthAttachment),Hr(rn.stencilAttachment),Hr(rn.depthStencilAttachment)}function ln(rn){var Dr=rn.framebuffer;Ce(Dr,"must not double destroy framebuffer"),G.deleteFramebuffer(Dr),rn.framebuffer=null,er.framebufferCount--,delete Tr[rn.id]}function Ar(rn){var Dr;G.bindFramebuffer(Ba,rn.framebuffer);var yr=rn.colorAttachments;for(Dr=0;Dr<yr.length;++Dr)Or(oa+Dr,yr[Dr]);for(Dr=yr.length;Dr<Ye.maxColorAttachments;++Dr)G.framebufferTexture2D(Ba,oa+Dr,bu,null,0);G.framebufferTexture2D(Ba,Ol,bu,null,0),G.framebufferTexture2D(Ba,mo,bu,null,0),G.framebufferTexture2D(Ba,Sh,bu,null,0),Or(mo,rn.depthAttachment),Or(Sh,rn.stencilAttachment),Or(Ol,rn.depthStencilAttachment);var tr=G.checkFramebufferStatus(Ba);!G.isContextLost()&&tr!==zf&&Ce.raise("framebuffer configuration not supported, status = "+S[tr]),G.bindFramebuffer(Ba,jt.next?jt.next.framebuffer:null),jt.cur=jt.next,G.getError()}function on(rn,Dr){var yr=new pn;er.framebufferCount++;function tr(Je,_i){var si;Ce(jt.next!==yr,"can not update framebuffer which is currently in use");var Kn=0,Yi=0,ho=!0,po=!0,Ii=null,_o=!0,xa="rgba",yo="uint8",xo=1,Wa=null,Bo=null,As=null,bo=!1;if(typeof Je=="number")Kn=Je|0,Yi=_i|0||Kn;else if(!Je)Kn=Yi=1;else{Ce.type(Je,"object","invalid arguments for framebuffer");var gi=Je;if("shape"in gi){var ls=gi.shape;Ce(Array.isArray(ls)&&ls.length>=2,"invalid shape for framebuffer"),Kn=ls[0],Yi=ls[1]}else"radius"in gi&&(Kn=Yi=gi.radius),"width"in gi&&(Kn=gi.width),"height"in gi&&(Yi=gi.height);("color"in gi||"colors"in gi)&&(Ii=gi.color||gi.colors,Array.isArray(Ii)&&Ce(Ii.length===1||we.webgl_draw_buffers,"multiple render targets not supported")),Ii||("colorCount"in gi&&(xo=gi.colorCount|0,Ce(xo>0,"invalid color buffer count")),"colorTexture"in gi&&(_o=!!gi.colorTexture,xa="rgba4"),"colorType"in gi&&(yo=gi.colorType,_o?(Ce(we.oes_texture_float||!(yo==="float"||yo==="float32"),"you must enable OES_texture_float in order to use floating point framebuffer objects"),Ce(we.oes_texture_half_float||!(yo==="half float"||yo==="float16"),"you must enable OES_texture_half_float in order to use 16-bit floating point framebuffer objects")):yo==="half float"||yo==="float16"?(Ce(we.ext_color_buffer_half_float,"you must enable EXT_color_buffer_half_float to use 16-bit render buffers"),xa="rgba16f"):(yo==="float"||yo==="float32")&&(Ce(we.webgl_color_buffer_float,"you must enable WEBGL_color_buffer_float in order to use 32-bit floating point renderbuffers"),xa="rgba32f"),Ce.oneOf(yo,Yr,"invalid color type")),"colorFormat"in gi&&(xa=gi.colorFormat,Br.indexOf(xa)>=0?_o=!0:Pr.indexOf(xa)>=0?_o=!1:_o?Ce.oneOf(gi.colorFormat,Br,"invalid color format for texture"):Ce.oneOf(gi.colorFormat,Pr,"invalid color format for renderbuffer"))),("depthTexture"in gi||"depthStencilTexture"in gi)&&(bo=!!(gi.depthTexture||gi.depthStencilTexture),Ce(!bo||we.webgl_depth_texture,"webgl_depth_texture extension not supported")),"depth"in gi&&(typeof gi.depth=="boolean"?ho=gi.depth:(Wa=gi.depth,po=!1)),"stencil"in gi&&(typeof gi.stencil=="boolean"?po=gi.stencil:(Bo=gi.stencil,ho=!1)),"depthStencil"in gi&&(typeof gi.depthStencil=="boolean"?ho=po=gi.depthStencil:(As=gi.depthStencil,ho=!1,po=!1))}var ia=null,$n=null,Ri=null,Gi=null;if(Array.isArray(Ii))ia=Ii.map($r);else if(Ii)ia=[$r(Ii)];else for(ia=new Array(xo),si=0;si<xo;++si)ia[si]=Bt(Kn,Yi,_o,xa,yo);Ce(we.webgl_draw_buffers||ia.length<=1,"you must enable the WEBGL_draw_buffers extension in order to use multiple color buffers."),Ce(ia.length<=Ye.maxColorAttachments,"too many color attachments, not supported"),Kn=Kn||ia[0].width,Yi=Yi||ia[0].height,Wa?$n=$r(Wa):ho&&!po&&($n=Bt(Kn,Yi,bo,"depth","uint32")),Bo?Ri=$r(Bo):po&&!ho&&(Ri=Bt(Kn,Yi,!1,"stencil","uint8")),As?Gi=$r(As):!Wa&&!Bo&&po&&ho&&(Gi=Bt(Kn,Yi,bo,"depth stencil","depth stencil")),Ce(!!Wa+!!Bo+!!As<=1,"invalid framebuffer configuration, can specify exactly one depth/stencil attachment");var Eo=null;for(si=0;si<ia.length;++si)if(en(ia[si],Kn,Yi),Ce(!ia[si]||ia[si].texture&&Ah.indexOf(ia[si].texture._texture.format)>=0||ia[si].renderbuffer&&g.indexOf(ia[si].renderbuffer._renderbuffer.format)>=0,"framebuffer color attachment "+si+" is invalid"),ia[si]&&ia[si].texture){var gl=ss[ia[si].texture._texture.format]*Au[ia[si].texture._texture.type];Eo===null?Eo=gl:Ce(Eo===gl,"all color attachments much have the same number of bits per pixel.")}return en($n,Kn,Yi),Ce(!$n||$n.texture&&$n.texture._texture.format===rc||$n.renderbuffer&&$n.renderbuffer._renderbuffer.format===Th,"invalid depth attachment for framebuffer object"),en(Ri,Kn,Yi),Ce(!Ri||Ri.renderbuffer&&Ri.renderbuffer._renderbuffer.format===ju,"invalid stencil attachment for framebuffer object"),en(Gi,Kn,Yi),Ce(!Gi||Gi.texture&&Gi.texture._texture.format===jf||Gi.renderbuffer&&Gi.renderbuffer._renderbuffer.format===jf,"invalid depth-stencil attachment for framebuffer object"),Mr(yr),yr.width=Kn,yr.height=Yi,yr.colorAttachments=ia,yr.depthAttachment=$n,yr.stencilAttachment=Ri,yr.depthStencilAttachment=Gi,tr.color=ia.map(ur),tr.depth=ur($n),tr.stencil=ur(Ri),tr.depthStencil=ur(Gi),tr.width=yr.width,tr.height=yr.height,Ar(yr),tr}function Ti(Je,_i){Ce(jt.next!==yr,"can not resize a framebuffer which is currently in use");var si=Math.max(Je|0,1),Kn=Math.max(_i|0||si,1);if(si===yr.width&&Kn===yr.height)return tr;for(var Yi=yr.colorAttachments,ho=0;ho<Yi.length;++ho)Ur(Yi[ho],si,Kn);return Ur(yr.depthAttachment,si,Kn),Ur(yr.stencilAttachment,si,Kn),Ur(yr.depthStencilAttachment,si,Kn),yr.width=tr.width=si,yr.height=tr.height=Kn,Ar(yr),tr}return tr(rn,Dr),U(tr,{resize:Ti,_reglType:"framebuffer",_framebuffer:yr,destroy:function(){ln(yr),Mr(yr)},use:function(Je){jt.setFBO({framebuffer:tr},Je)}})}function jn(rn){var Dr=Array(6);function yr(Ti){var Je;Ce(Dr.indexOf(jt.next)<0,"can not update framebuffer which is currently in use");var _i={color:null},si=0,Kn=null,Yi="rgba",ho="uint8",po=1;if(typeof Ti=="number")si=Ti|0;else if(!Ti)si=1;else{Ce.type(Ti,"object","invalid arguments for framebuffer");var Ii=Ti;if("shape"in Ii){var _o=Ii.shape;Ce(Array.isArray(_o)&&_o.length>=2,"invalid shape for framebuffer"),Ce(_o[0]===_o[1],"cube framebuffer must be square"),si=_o[0]}else"radius"in Ii&&(si=Ii.radius|0),"width"in Ii?(si=Ii.width|0,"height"in Ii&&Ce(Ii.height===si,"must be square")):"height"in Ii&&(si=Ii.height|0);("color"in Ii||"colors"in Ii)&&(Kn=Ii.color||Ii.colors,Array.isArray(Kn)&&Ce(Kn.length===1||we.webgl_draw_buffers,"multiple render targets not supported")),Kn||("colorCount"in Ii&&(po=Ii.colorCount|0,Ce(po>0,"invalid color buffer count")),"colorType"in Ii&&(Ce.oneOf(Ii.colorType,Yr,"invalid color type"),ho=Ii.colorType),"colorFormat"in Ii&&(Yi=Ii.colorFormat,Ce.oneOf(Ii.colorFormat,Br,"invalid color format for texture"))),"depth"in Ii&&(_i.depth=Ii.depth),"stencil"in Ii&&(_i.stencil=Ii.stencil),"depthStencil"in Ii&&(_i.depthStencil=Ii.depthStencil)}var xa;if(Kn)if(Array.isArray(Kn))for(xa=[],Je=0;Je<Kn.length;++Je)xa[Je]=Kn[Je];else xa=[Kn];else{xa=Array(po);var yo={radius:si,format:Yi,type:ho};for(Je=0;Je<po;++Je)xa[Je]=Kt.createCube(yo)}for(_i.color=Array(xa.length),Je=0;Je<xa.length;++Je){var xo=xa[Je];Ce(typeof xo=="function"&&xo._reglType==="textureCube","invalid cube map"),si=si||xo.width,Ce(xo.width===si&&xo.height===si,"invalid cube map shape"),_i.color[Je]={target:Eu,data:xa[Je]}}for(Je=0;Je<6;++Je){for(var Wa=0;Wa<xa.length;++Wa)_i.color[Wa].target=Eu+Je;Je>0&&(_i.depth=Dr[0].depth,_i.stencil=Dr[0].stencil,_i.depthStencil=Dr[0].depthStencil),Dr[Je]?Dr[Je](_i):Dr[Je]=on(_i)}return U(yr,{width:si,height:si,color:xa})}function tr(Ti){var Je,_i=Ti|0;if(Ce(_i>0&&_i<=Ye.maxCubeMapSize,"invalid radius for cube fbo"),_i===yr.width)return yr;var si=yr.color;for(Je=0;Je<si.length;++Je)si[Je].resize(_i);for(Je=0;Je<6;++Je)Dr[Je].resize(_i);return yr.width=yr.height=_i,yr}return yr(rn),U(yr,{faces:Dr,resize:tr,_reglType:"framebufferCube",destroy:function(){Dr.forEach(function(Ti){Ti.destroy()})}})}function ai(){jt.cur=null,jt.next=null,jt.dirty=!0,Ji(Tr).forEach(function(rn){rn.framebuffer=G.createFramebuffer(),Ar(rn)})}return U(jt,{getFramebuffer:function(rn){if(typeof rn=="function"&&rn._reglType==="framebuffer"){var Dr=rn._framebuffer;if(Dr instanceof pn)return Dr}return null},create:on,createCube:jn,clear:function(){Ji(Tr).forEach(ln)},restore:ai})}var C=5126,O=34962;function X(){this.state=0,this.x=0,this.y=0,this.z=0,this.w=0,this.buffer=null,this.size=0,this.normalized=!1,this.type=C,this.offset=0,this.stride=0,this.divisor=0}function J(G,we,Ye,Kt,vr){for(var er=Ye.maxAttributes,jt=new Array(er),Br=0;Br<er;++Br)jt[Br]=new X;var Pr=0,Yr={},Nr={Record:X,scope:{},state:jt,currentVAO:null,targetVAO:null,restore:en()?Tr:function(){},createVAO:pn,getVAO:$r,destroyBuffer:Hr,setVAO:en()?Bt:ur,clear:en()?Ur:function(){}};function Hr(Mr){for(var ln=0;ln<jt.length;++ln){var Ar=jt[ln];Ar.buffer===Mr&&(G.disableVertexAttribArray(ln),Ar.buffer=null)}}function en(){return we.oes_vertex_array_object}function Or(){return we.angle_instanced_arrays}function $r(Mr){return typeof Mr=="function"&&Mr._vao?Mr._vao:null}function Bt(Mr){if(Mr!==Nr.currentVAO){var ln=en();Mr?ln.bindVertexArrayOES(Mr.vao):ln.bindVertexArrayOES(null),Nr.currentVAO=Mr}}function ur(Mr){if(Mr!==Nr.currentVAO){if(Mr)Mr.bindAttrs();else for(var ln=Or(),Ar=0;Ar<jt.length;++Ar){var on=jt[Ar];on.buffer?(G.enableVertexAttribArray(Ar),G.vertexAttribPointer(Ar,on.size,on.type,on.normalized,on.stride,on.offfset),ln&&ln.vertexAttribDivisorANGLE(Ar,on.divisor)):(G.disableVertexAttribArray(Ar),G.vertexAttrib4f(Ar,on.x,on.y,on.z,on.w))}Nr.currentVAO=Mr}}function Ur(){Ji(Yr).forEach(function(Mr){Mr.destroy()})}function un(){this.id=++Pr,this.attributes=[];var Mr=en();Mr?this.vao=Mr.createVertexArrayOES():this.vao=null,Yr[this.id]=this,this.buffers=[]}un.prototype.bindAttrs=function(){for(var Mr=Or(),ln=this.attributes,Ar=0;Ar<ln.length;++Ar){var on=ln[Ar];on.buffer?(G.enableVertexAttribArray(Ar),G.bindBuffer(O,on.buffer.buffer),G.vertexAttribPointer(Ar,on.size,on.type,on.normalized,on.stride,on.offset),Mr&&Mr.vertexAttribDivisorANGLE(Ar,on.divisor)):(G.disableVertexAttribArray(Ar),G.vertexAttrib4f(Ar,on.x,on.y,on.z,on.w))}for(var jn=ln.length;jn<er;++jn)G.disableVertexAttribArray(jn)},un.prototype.refresh=function(){var Mr=en();Mr&&(Mr.bindVertexArrayOES(this.vao),this.bindAttrs(),Nr.currentVAO=this)},un.prototype.destroy=function(){if(this.vao){var Mr=en();this===Nr.currentVAO&&(Nr.currentVAO=null,Mr.bindVertexArrayOES(null)),Mr.deleteVertexArrayOES(this.vao),this.vao=null}Yr[this.id]&&(delete Yr[this.id],Kt.vaoCount-=1)};function Tr(){var Mr=en();Mr&&Ji(Yr).forEach(function(ln){ln.refresh()})}function pn(Mr){var ln=new un;Kt.vaoCount+=1;function Ar(on){Ce(Array.isArray(on),"arguments to vertex array constructor must be an array"),Ce(on.length<er,"too many attributes"),Ce(on.length>0,"must specify at least one attribute");for(var jn=0;jn<ln.buffers.length;++jn)ln.buffers[jn].destroy();ln.buffers.length=0;var ai=ln.attributes;ai.length=on.length;for(var rn=0;rn<on.length;++rn){var Dr=on[rn],yr=ai[rn]=new X;if(Array.isArray(Dr)||re(Dr)||ya(Dr)){var tr=vr.create(Dr,O,!1,!0);yr.buffer=vr.getBuffer(tr),yr.size=yr.buffer.dimension|0,yr.normalized=!1,yr.type=yr.buffer.dtype,yr.offset=0,yr.stride=0,yr.divisor=0,yr.state=1,ln.buffers.push(tr)}else vr.getBuffer(Dr)?(yr.buffer=vr.getBuffer(Dr),yr.size=yr.buffer.dimension|0,yr.normalized=!1,yr.type=yr.buffer.dtype,yr.offset=0,yr.stride=0,yr.divisor=0,yr.state=1):vr.getBuffer(Dr.buffer)?(yr.buffer=vr.getBuffer(Dr.buffer),yr.size=(+Dr.size||yr.buffer.dimension)|0,yr.normalized=!!Dr.normalized||!1,"type"in Dr?(Ce.parameter(Dr.type,Yo,"invalid buffer type"),yr.type=Yo[Dr.type]):yr.type=yr.buffer.dtype,yr.offset=(Dr.offset||0)|0,yr.stride=(Dr.stride||0)|0,yr.divisor=(Dr.divisor||0)|0,yr.state=1,Ce(yr.size>=1&&yr.size<=4,"size must be between 1 and 4"),Ce(yr.offset>=0,"invalid offset"),Ce(yr.stride>=0&&yr.stride<=255,"stride must be between 0 and 255"),Ce(yr.divisor>=0,"divisor must be positive"),Ce(!yr.divisor||!!we.angle_instanced_arrays,"ANGLE_instanced_arrays must be enabled to use divisor")):"x"in Dr?(Ce(rn>0,"first attribute must not be a constant"),yr.x=+Dr.x||0,yr.y=+Dr.y||0,yr.z=+Dr.z||0,yr.w=+Dr.w||0,yr.state=2):Ce(!1,"invalid attribute spec for location "+rn)}return ln.refresh(),Ar}return Ar.destroy=function(){ln.destroy()},Ar._vao=ln,Ar._reglType="vao",Ar(Mr)}return Nr}var me=35632,ye=35633,Ae=35718,Ve=35721;function Ue(G,we,Ye,Kt){var vr={},er={};function jt(Bt,ur,Ur,un){this.name=Bt,this.id=ur,this.location=Ur,this.info=un}function Br(Bt,ur){for(var Ur=0;Ur<Bt.length;++Ur)if(Bt[Ur].id===ur.id){Bt[Ur].location=ur.location;return}Bt.push(ur)}function Pr(Bt,ur,Ur){var un=Bt===me?vr:er,Tr=un[ur];if(!Tr){var pn=we.str(ur);Tr=G.createShader(Bt),G.shaderSource(Tr,pn),G.compileShader(Tr),Ce.shaderError(G,Tr,pn,Bt,Ur),un[ur]=Tr}return Tr}var Yr={},Nr=[],Hr=0;function en(Bt,ur){this.id=Hr++,this.fragId=Bt,this.vertId=ur,this.program=null,this.uniforms=[],this.attributes=[],Kt.profile&&(this.stats={uniformsCount:0,attributesCount:0})}function Or(Bt,ur,Ur){var un,Tr,pn=Pr(me,Bt.fragId),Mr=Pr(ye,Bt.vertId),ln=Bt.program=G.createProgram();if(G.attachShader(ln,pn),G.attachShader(ln,Mr),Ur)for(un=0;un<Ur.length;++un){var Ar=Ur[un];G.bindAttribLocation(ln,Ar[0],Ar[1])}G.linkProgram(ln),Ce.linkError(G,ln,we.str(Bt.fragId),we.str(Bt.vertId),ur);var on=G.getProgramParameter(ln,Ae);Kt.profile&&(Bt.stats.uniformsCount=on);var jn=Bt.uniforms;for(un=0;un<on;++un)if(Tr=G.getActiveUniform(ln,un),Tr)if(Tr.size>1)for(var ai=0;ai<Tr.size;++ai){var rn=Tr.name.replace("[0]","["+ai+"]");Br(jn,new jt(rn,we.id(rn),G.getUniformLocation(ln,rn),Tr))}else Br(jn,new jt(Tr.name,we.id(Tr.name),G.getUniformLocation(ln,Tr.name),Tr));var Dr=G.getProgramParameter(ln,Ve);Kt.profile&&(Bt.stats.attributesCount=Dr);var yr=Bt.attributes;for(un=0;un<Dr;++un)Tr=G.getActiveAttrib(ln,un),Tr&&Br(yr,new jt(Tr.name,we.id(Tr.name),G.getAttribLocation(ln,Tr.name),Tr))}Kt.profile&&(Ye.getMaxUniformsCount=function(){var Bt=0;return Nr.forEach(function(ur){ur.stats.uniformsCount>Bt&&(Bt=ur.stats.uniformsCount)}),Bt},Ye.getMaxAttributesCount=function(){var Bt=0;return Nr.forEach(function(ur){ur.stats.attributesCount>Bt&&(Bt=ur.stats.attributesCount)}),Bt});function $r(){vr={},er={};for(var Bt=0;Bt<Nr.length;++Bt)Or(Nr[Bt],null,Nr[Bt].attributes.map(function(ur){return[ur.location,ur.name]}))}return{clear:function(){var Bt=G.deleteShader.bind(G);Ji(vr).forEach(Bt),vr={},Ji(er).forEach(Bt),er={},Nr.forEach(function(ur){G.deleteProgram(ur.program)}),Nr.length=0,Yr={},Ye.shaderCount=0},program:function(Bt,ur,Ur,un){Ce.command(Bt>=0,"missing vertex shader",Ur),Ce.command(ur>=0,"missing fragment shader",Ur);var Tr=Yr[ur];Tr||(Tr=Yr[ur]={});var pn=Tr[Bt];if(pn&&!un)return pn;var Mr=new en(ur,Bt);return Ye.shaderCount++,Or(Mr,Ur,un),pn||(Tr[Bt]=Mr),Nr.push(Mr),Mr},restore:$r,shader:Pr,frag:-1,vert:-1}}var lt=6408,Be=5121,st=3333,xt=5126;function Ut(G,we,Ye,Kt,vr,er,jt){function Br(Nr){var Hr;we.next===null?(Ce(vr.preserveDrawingBuffer,'you must create a webgl context with "preserveDrawingBuffer":true in order to read pixels from the drawing buffer'),Hr=Be):(Ce(we.next.colorAttachments[0].texture!==null,"You cannot read from a renderbuffer"),Hr=we.next.colorAttachments[0].texture._texture.type,er.oes_texture_float?(Ce(Hr===Be||Hr===xt,"Reading from a framebuffer is only allowed for the types 'uint8' and 'float'"),Hr===xt&&Ce(jt.readFloat,"Reading 'float' values is not permitted in your browser. For a fallback, please see: https://www.npmjs.com/package/glsl-read-float")):Ce(Hr===Be,"Reading from a framebuffer is only allowed for the type 'uint8'"));var en=0,Or=0,$r=Kt.framebufferWidth,Bt=Kt.framebufferHeight,ur=null;re(Nr)?ur=Nr:Nr&&(Ce.type(Nr,"object","invalid arguments to regl.read()"),en=Nr.x|0,Or=Nr.y|0,Ce(en>=0&&en<Kt.framebufferWidth,"invalid x offset for regl.read"),Ce(Or>=0&&Or<Kt.framebufferHeight,"invalid y offset for regl.read"),$r=(Nr.width||Kt.framebufferWidth-en)|0,Bt=(Nr.height||Kt.framebufferHeight-Or)|0,ur=Nr.data||null),ur&&(Hr===Be?Ce(ur instanceof Uint8Array,"buffer must be 'Uint8Array' when reading from a framebuffer of type 'uint8'"):Hr===xt&&Ce(ur instanceof Float32Array,"buffer must be 'Float32Array' when reading from a framebuffer of type 'float'")),Ce($r>0&&$r+en<=Kt.framebufferWidth,"invalid width for read pixels"),Ce(Bt>0&&Bt+Or<=Kt.framebufferHeight,"invalid height for read pixels"),Ye();var Ur=$r*Bt*4;return ur||(Hr===Be?ur=new Uint8Array(Ur):Hr===xt&&(ur=ur||new Float32Array(Ur))),Ce.isTypedArray(ur,"data buffer for regl.read() must be a typedarray"),Ce(ur.byteLength>=Ur,"data buffer for regl.read() too small"),G.pixelStorei(st,4),G.readPixels(en,Or,$r,Bt,lt,Hr,ur),ur}function Pr(Nr){var Hr;return we.setFBO({framebuffer:Nr.framebuffer},function(){Hr=Br(Nr)}),Hr}function Yr(Nr){return!Nr||!("framebuffer"in Nr)?Br(Nr):Pr(Nr)}return Yr}function ar(G){return Array.prototype.slice.call(G)}function qt(G){return ar(G).join("")}function fr(){var G=0,we=[],Ye=[];function Kt(Hr){for(var en=0;en<Ye.length;++en)if(Ye[en]===Hr)return we[en];var Or="g"+G++;return we.push(Or),Ye.push(Hr),Or}function vr(){var Hr=[];function en(){Hr.push.apply(Hr,ar(arguments))}var Or=[];function $r(){var Bt="v"+G++;return Or.push(Bt),arguments.length>0&&(Hr.push(Bt,"="),Hr.push.apply(Hr,ar(arguments)),Hr.push(";")),Bt}return U(en,{def:$r,toString:function(){return qt([Or.length>0?"var "+Or.join(",")+";":"",qt(Hr)])}})}function er(){var Hr=vr(),en=vr(),Or=Hr.toString,$r=en.toString;function Bt(ur,Ur){en(ur,Ur,"=",Hr.def(ur,Ur),";")}return U(function(){Hr.apply(Hr,ar(arguments))},{def:Hr.def,entry:Hr,exit:en,save:Bt,set:function(ur,Ur,un){Bt(ur,Ur),Hr(ur,Ur,"=",un,";")},toString:function(){return Or()+$r()}})}function jt(){var Hr=qt(arguments),en=er(),Or=er(),$r=en.toString,Bt=Or.toString;return U(en,{then:function(){return en.apply(en,ar(arguments)),this},else:function(){return Or.apply(Or,ar(arguments)),this},toString:function(){var ur=Bt();return ur&&(ur="else{"+ur+"}"),qt(["if(",Hr,"){",$r(),"}",ur])}})}var Br=vr(),Pr={};function Yr(Hr,en){var Or=[];function $r(){var Tr="a"+Or.length;return Or.push(Tr),Tr}en=en||0;for(var Bt=0;Bt<en;++Bt)$r();var ur=er(),Ur=ur.toString,un=Pr[Hr]=U(ur,{arg:$r,toString:function(){return qt(["function(",Or.join(),"){",Ur(),"}"])}});return un}function Nr(){var Hr=['"use strict";',Br,"return {"];Object.keys(Pr).forEach(function($r){Hr.push('"',$r,'":',Pr[$r].toString(),",")}),Hr.push("}");var en=qt(Hr).replace(/;/g,`;
`).replace(/}/g,`}
`).replace(/{/g,`{
`),Or=Function.apply(null,we.concat(en));return Or.apply(null,Ye)}return{global:Br,link:Kt,block:vr,proc:Yr,scope:er,cond:jt,compile:Nr}}var br="xyzw".split(""),jr=5121,Fr=1,hn=2,Un=0,Ln=1,zn=2,Ui=3,gn=4,ii="dither",pi="blend.enable",ri="blend.color",Qn="blend.equation",fi="blend.func",Jn="depth.enable",Xn="depth.func",Mo="depth.range",Ka="depth.mask",Io="colorMask",go="cull.enable",Ha="cull.face",Qa="frontFace",xs="lineWidth",bs="polygonOffset.enable",fl="polygonOffset.offset",Es="sample.alpha",lu="sample.enable",Zs="sample.coverage",Mc="stencil.enable",Hu="stencil.mask",Tu="stencil.func",nc="stencil.opFront",hl="stencil.opBack",cu="scissor.enable",pl="scissor.box",Po="viewport",ao="profile",Is="framebuffer",fu="vert",wu="frag",Bi="elements",Ko="primitive",oo="count",hu="offset",Ic="instances",Wu="vao",Ch="Width",Oo="Height",kr=Is+Ch,Vs=Is+Oo,Rh=Po+Ch,ko=Po+Oo,ru="drawingBuffer",Do=ru+Ch,pp=ru+Oo,ic=[fi,Qn,Tu,nc,hl,Zs,Po,pl,fl],dl=34962,Zp=34963,ag=35632,zv=35633,Hf=3553,dp=34067,Mh=2884,Dd=3042,Pc=3024,Ih=2960,Zv=2929,Ld=3089,og=32823,Vp=32926,Bd=32928,Fd=5126,jp=35664,Dl=35665,vp=35666,Oc=5124,Hp=35667,Ja=35668,Wf=35669,Gf=35670,vl=35671,lf=35672,kc=35673,Xf=35674,$f=35675,Dc=35676,Lc=35678,ac=35680,Wp=4,oc=1028,js=1029,mp=2304,Gp=2305,Xp=32775,Ph=32776,ml=519,Gu=7680,Nd=0,gp=1,Ud=32774,Oh=513,Bc=36160,$p=36064,Xu={0:0,1:1,zero:0,one:1,"src color":768,"one minus src color":769,"src alpha":770,"one minus src alpha":771,"dst color":774,"one minus dst color":775,"dst alpha":772,"one minus dst alpha":773,"constant color":32769,"one minus constant color":32770,"constant alpha":32771,"one minus constant alpha":32772,"src alpha saturate":776},_p=["constant color, constant alpha","one minus constant color, constant alpha","constant color, one minus constant alpha","one minus constant color, one minus constant alpha","constant alpha, constant color","constant alpha, one minus constant color","one minus constant alpha, constant color","one minus constant alpha, one minus constant color"],Fc={never:512,less:513,"<":513,equal:514,"=":514,"==":514,"===":514,lequal:515,"<=":515,greater:516,">":516,notequal:517,"!=":517,"!==":517,gequal:518,">=":518,always:519},Hs={0:0,zero:0,keep:7680,replace:7681,increment:7682,decrement:7683,"increment wrap":34055,"decrement wrap":34056,invert:5386},zd={frag:ag,vert:zv},sc={cw:mp,ccw:Gp};function kh(G){return Array.isArray(G)||re(G)||ya(G)}function Yf(G){return G.sort(function(we,Ye){return we===Po?-1:Ye===Po?1:we<Ye?-1:1})}function us(G,we,Ye,Kt){this.thisDep=G,this.contextDep=we,this.propDep=Ye,this.append=Kt}function Ss(G){return G&&!(G.thisDep||G.contextDep||G.propDep)}function Lo(G){return new us(!1,!1,!1,G)}function pu(G,we){var Ye=G.type;if(Ye===Un){var Kt=G.data.length;return new us(!0,Kt>=1,Kt>=2,we)}else if(Ye===gn){var vr=G.data;return new us(vr.thisDep,vr.contextDep,vr.propDep,we)}else return new us(Ye===Ui,Ye===zn,Ye===Ln,we)}var Yp=new us(!1,!1,!1,function(){});function cf(G,we,Ye,Kt,vr,er,jt,Br,Pr,Yr,Nr,Hr,en,Or,$r){var Bt=Yr.Record,ur={add:32774,subtract:32778,"reverse subtract":32779};Ye.ext_blend_minmax&&(ur.min=Xp,ur.max=Ph);var Ur=Ye.angle_instanced_arrays,un=Ye.webgl_draw_buffers,Tr={dirty:!0,profile:$r.profile},pn={},Mr=[],ln={},Ar={};function on(pe){return pe.replace(".","_")}function jn(pe,Ie,$e){var $t=on(pe);Mr.push(pe),pn[$t]=Tr[$t]=!!$e,ln[$t]=Ie}function ai(pe,Ie,$e){var $t=on(pe);Mr.push(pe),Array.isArray($e)?(Tr[$t]=$e.slice(),pn[$t]=$e.slice()):Tr[$t]=pn[$t]=$e,Ar[$t]=Ie}jn(ii,Pc),jn(pi,Dd),ai(ri,"blendColor",[0,0,0,0]),ai(Qn,"blendEquationSeparate",[Ud,Ud]),ai(fi,"blendFuncSeparate",[gp,Nd,gp,Nd]),jn(Jn,Zv,!0),ai(Xn,"depthFunc",Oh),ai(Mo,"depthRange",[0,1]),ai(Ka,"depthMask",!0),ai(Io,Io,[!0,!0,!0,!0]),jn(go,Mh),ai(Ha,"cullFace",js),ai(Qa,Qa,Gp),ai(xs,xs,1),jn(bs,og),ai(fl,"polygonOffset",[0,0]),jn(Es,Vp),jn(lu,Bd),ai(Zs,"sampleCoverage",[1,!1]),jn(Mc,Ih),ai(Hu,"stencilMask",-1),ai(Tu,"stencilFunc",[ml,0,-1]),ai(nc,"stencilOpSeparate",[oc,Gu,Gu,Gu]),ai(hl,"stencilOpSeparate",[js,Gu,Gu,Gu]),jn(cu,Ld),ai(pl,"scissor",[0,0,G.drawingBufferWidth,G.drawingBufferHeight]),ai(Po,Po,[0,0,G.drawingBufferWidth,G.drawingBufferHeight]);var rn={gl:G,context:en,strings:we,next:pn,current:Tr,draw:Hr,elements:er,buffer:vr,shader:Nr,attributes:Yr.state,vao:Yr,uniforms:Pr,framebuffer:Br,extensions:Ye,timer:Or,isBufferArgs:kh},Dr={primTypes:Fu,compareFuncs:Fc,blendFuncs:Xu,blendEquations:ur,stencilOps:Hs,glTypes:Yo,orientationType:sc};Ce.optional(function(){rn.isArrayLike=Za}),un&&(Dr.backBuffer=[js],Dr.drawBuffer=mt(Kt.maxDrawbuffers,function(pe){return pe===0?[0]:mt(pe,function(Ie){return $p+Ie})}));var yr=0;function tr(){var pe=fr(),Ie=pe.link,$e=pe.global;pe.id=yr++,pe.batchId="0";var $t=Ie(rn),Vt=pe.shared={props:"a0"};Object.keys(rn).forEach(function(dt){Vt[dt]=$e.def($t,".",dt)}),Ce.optional(function(){pe.CHECK=Ie(Ce),pe.commandStr=Ce.guessCommand(),pe.command=Ie(pe.commandStr),pe.assert=function(dt,Me,gt){dt("if(!(",Me,"))",this.CHECK,".commandRaise(",Ie(gt),",",this.command,");")},Dr.invalidBlendCombinations=_p});var ct=pe.next={},yt=pe.current={};Object.keys(Ar).forEach(function(dt){Array.isArray(Tr[dt])&&(ct[dt]=$e.def(Vt.next,".",dt),yt[dt]=$e.def(Vt.current,".",dt))});var St=pe.constants={};Object.keys(Dr).forEach(function(dt){St[dt]=$e.def(JSON.stringify(Dr[dt]))}),pe.invoke=function(dt,Me){switch(Me.type){case Un:var gt=["this",Vt.context,Vt.props,pe.batchId];return dt.def(Ie(Me.data),".call(",gt.slice(0,Math.max(Me.data.length+1,4)),")");case Ln:return dt.def(Vt.props,Me.data);case zn:return dt.def(Vt.context,Me.data);case Ui:return dt.def("this",Me.data);case gn:return Me.data.append(pe,dt),Me.data.ref}},pe.attribCache={};var He={};return pe.scopeAttrib=function(dt){var Me=we.id(dt);if(Me in He)return He[Me];var gt=Yr.scope[Me];gt||(gt=Yr.scope[Me]=new Bt);var It=He[Me]=Ie(gt);return It},pe}function Ti(pe){var Ie=pe.static,$e=pe.dynamic,$t;if(ao in Ie){var Vt=!!Ie[ao];$t=Lo(function(yt,St){return Vt}),$t.enable=Vt}else if(ao in $e){var ct=$e[ao];$t=pu(ct,function(yt,St){return yt.invoke(St,ct)})}return $t}function Je(pe,Ie){var $e=pe.static,$t=pe.dynamic;if(Is in $e){var Vt=$e[Is];return Vt?(Vt=Br.getFramebuffer(Vt),Ce.command(Vt,"invalid framebuffer object"),Lo(function(yt,St){var He=yt.link(Vt),dt=yt.shared;St.set(dt.framebuffer,".next",He);var Me=dt.context;return St.set(Me,"."+kr,He+".width"),St.set(Me,"."+Vs,He+".height"),He})):Lo(function(yt,St){var He=yt.shared;St.set(He.framebuffer,".next","null");var dt=He.context;return St.set(dt,"."+kr,dt+"."+Do),St.set(dt,"."+Vs,dt+"."+pp),"null"})}else if(Is in $t){var ct=$t[Is];return pu(ct,function(yt,St){var He=yt.invoke(St,ct),dt=yt.shared,Me=dt.framebuffer,gt=St.def(Me,".getFramebuffer(",He,")");Ce.optional(function(){yt.assert(St,"!"+He+"||"+gt,"invalid framebuffer object")}),St.set(Me,".next",gt);var It=dt.context;return St.set(It,"."+kr,gt+"?"+gt+".width:"+It+"."+Do),St.set(It,"."+Vs,gt+"?"+gt+".height:"+It+"."+pp),gt})}else return null}function _i(pe,Ie,$e){var $t=pe.static,Vt=pe.dynamic;function ct(He){if(He in $t){var dt=$t[He];Ce.commandType(dt,"object","invalid "+He,$e.commandStr);var Me=!0,gt=dt.x|0,It=dt.y|0,hr,Rr;return"width"in dt?(hr=dt.width|0,Ce.command(hr>=0,"invalid "+He,$e.commandStr)):Me=!1,"height"in dt?(Rr=dt.height|0,Ce.command(Rr>=0,"invalid "+He,$e.commandStr)):Me=!1,new us(!Me&&Ie&&Ie.thisDep,!Me&&Ie&&Ie.contextDep,!Me&&Ie&&Ie.propDep,function(On,En){var Tn=On.shared.context,Yn=hr;"width"in dt||(Yn=En.def(Tn,".",kr,"-",gt));var ni=Rr;return"height"in dt||(ni=En.def(Tn,".",Vs,"-",It)),[gt,It,Yn,ni]})}else if(He in Vt){var Er=Vt[He],Cr=pu(Er,function(On,En){var Tn=On.invoke(En,Er);Ce.optional(function(){On.assert(En,Tn+"&&typeof "+Tn+'==="object"',"invalid "+He)});var Yn=On.shared.context,ni=En.def(Tn,".x|0"),aa=En.def(Tn,".y|0"),Fo=En.def('"width" in ',Tn,"?",Tn,".width|0:","(",Yn,".",kr,"-",ni,")"),$u=En.def('"height" in ',Tn,"?",Tn,".height|0:","(",Yn,".",Vs,"-",aa,")");return Ce.optional(function(){On.assert(En,Fo+">=0&&"+$u+">=0","invalid "+He)}),[ni,aa,Fo,$u]});return Ie&&(Cr.thisDep=Cr.thisDep||Ie.thisDep,Cr.contextDep=Cr.contextDep||Ie.contextDep,Cr.propDep=Cr.propDep||Ie.propDep),Cr}else return Ie?new us(Ie.thisDep,Ie.contextDep,Ie.propDep,function(On,En){var Tn=On.shared.context;return[0,0,En.def(Tn,".",kr),En.def(Tn,".",Vs)]}):null}var yt=ct(Po);if(yt){var St=yt;yt=new us(yt.thisDep,yt.contextDep,yt.propDep,function(He,dt){var Me=St.append(He,dt),gt=He.shared.context;return dt.set(gt,"."+Rh,Me[2]),dt.set(gt,"."+ko,Me[3]),Me})}return{viewport:yt,scissor_box:ct(pl)}}function si(pe,Ie){var $e=pe.static,$t=typeof $e[wu]=="string"&&typeof $e[fu]=="string";if($t){if(Object.keys(Ie.dynamic).length>0)return null;var Vt=Ie.static,ct=Object.keys(Vt);if(ct.length>0&&typeof Vt[ct[0]]=="number"){for(var yt=[],St=0;St<ct.length;++St)Ce(typeof Vt[ct[St]]=="number","must specify all vertex attribute locations when using vaos"),yt.push([Vt[ct[St]]|0,ct[St]]);return yt}}return null}function Kn(pe,Ie,$e){var $t=pe.static,Vt=pe.dynamic;function ct(Me){if(Me in $t){var gt=we.id($t[Me]);Ce.optional(function(){Nr.shader(zd[Me],gt,Ce.guessCommand())});var It=Lo(function(){return gt});return It.id=gt,It}else if(Me in Vt){var hr=Vt[Me];return pu(hr,function(Rr,Er){var Cr=Rr.invoke(Er,hr),On=Er.def(Rr.shared.strings,".id(",Cr,")");return Ce.optional(function(){Er(Rr.shared.shader,".shader(",zd[Me],",",On,",",Rr.command,");")}),On})}return null}var yt=ct(wu),St=ct(fu),He=null,dt;return Ss(yt)&&Ss(St)?(He=Nr.program(St.id,yt.id,null,$e),dt=Lo(function(Me,gt){return Me.link(He)})):dt=new us(yt&&yt.thisDep||St&&St.thisDep,yt&&yt.contextDep||St&&St.contextDep,yt&&yt.propDep||St&&St.propDep,function(Me,gt){var It=Me.shared.shader,hr;yt?hr=yt.append(Me,gt):hr=gt.def(It,".",wu);var Rr;St?Rr=St.append(Me,gt):Rr=gt.def(It,".",fu);var Er=It+".program("+Rr+","+hr;return Ce.optional(function(){Er+=","+Me.command}),gt.def(Er+")")}),{frag:yt,vert:St,progVar:dt,program:He}}function Yi(pe,Ie){var $e=pe.static,$t=pe.dynamic;function Vt(){if(Bi in $e){var Me=$e[Bi];kh(Me)?Me=er.getElements(er.create(Me,!0)):Me&&(Me=er.getElements(Me),Ce.command(Me,"invalid elements",Ie.commandStr));var gt=Lo(function(hr,Rr){if(Me){var Er=hr.link(Me);return hr.ELEMENTS=Er,Er}return hr.ELEMENTS=null,null});return gt.value=Me,gt}else if(Bi in $t){var It=$t[Bi];return pu(It,function(hr,Rr){var Er=hr.shared,Cr=Er.isBufferArgs,On=Er.elements,En=hr.invoke(Rr,It),Tn=Rr.def("null"),Yn=Rr.def(Cr,"(",En,")"),ni=hr.cond(Yn).then(Tn,"=",On,".createStream(",En,");").else(Tn,"=",On,".getElements(",En,");");return Ce.optional(function(){hr.assert(ni.else,"!"+En+"||"+Tn,"invalid elements")}),Rr.entry(ni),Rr.exit(hr.cond(Yn).then(On,".destroyStream(",Tn,");")),hr.ELEMENTS=Tn,Tn})}return null}var ct=Vt();function yt(){if(Ko in $e){var Me=$e[Ko];return Ce.commandParameter(Me,Fu,"invalid primitve",Ie.commandStr),Lo(function(It,hr){return Fu[Me]})}else if(Ko in $t){var gt=$t[Ko];return pu(gt,function(It,hr){var Rr=It.constants.primTypes,Er=It.invoke(hr,gt);return Ce.optional(function(){It.assert(hr,Er+" in "+Rr,"invalid primitive, must be one of "+Object.keys(Fu))}),hr.def(Rr,"[",Er,"]")})}else if(ct)return Ss(ct)?ct.value?Lo(function(It,hr){return hr.def(It.ELEMENTS,".primType")}):Lo(function(){return Wp}):new us(ct.thisDep,ct.contextDep,ct.propDep,function(It,hr){var Rr=It.ELEMENTS;return hr.def(Rr,"?",Rr,".primType:",Wp)});return null}function St(Me,gt){if(Me in $e){var It=$e[Me]|0;return Ce.command(!gt||It>=0,"invalid "+Me,Ie.commandStr),Lo(function(Rr,Er){return gt&&(Rr.OFFSET=It),It})}else if(Me in $t){var hr=$t[Me];return pu(hr,function(Rr,Er){var Cr=Rr.invoke(Er,hr);return gt&&(Rr.OFFSET=Cr,Ce.optional(function(){Rr.assert(Er,Cr+">=0","invalid "+Me)})),Cr})}else if(gt&&ct)return Lo(function(Rr,Er){return Rr.OFFSET="0",0});return null}var He=St(hu,!0);function dt(){if(oo in $e){var Me=$e[oo]|0;return Ce.command(typeof Me=="number"&&Me>=0,"invalid vertex count",Ie.commandStr),Lo(function(){return Me})}else if(oo in $t){var gt=$t[oo];return pu(gt,function(Rr,Er){var Cr=Rr.invoke(Er,gt);return Ce.optional(function(){Rr.assert(Er,"typeof "+Cr+'==="number"&&'+Cr+">=0&&"+Cr+"===("+Cr+"|0)","invalid vertex count")}),Cr})}else if(ct)if(Ss(ct)){if(ct)return He?new us(He.thisDep,He.contextDep,He.propDep,function(Rr,Er){var Cr=Er.def(Rr.ELEMENTS,".vertCount-",Rr.OFFSET);return Ce.optional(function(){Rr.assert(Er,Cr+">=0","invalid vertex offset/element buffer too small")}),Cr}):Lo(function(Rr,Er){return Er.def(Rr.ELEMENTS,".vertCount")});var It=Lo(function(){return-1});return Ce.optional(function(){It.MISSING=!0}),It}else{var hr=new us(ct.thisDep||He.thisDep,ct.contextDep||He.contextDep,ct.propDep||He.propDep,function(Rr,Er){var Cr=Rr.ELEMENTS;return Rr.OFFSET?Er.def(Cr,"?",Cr,".vertCount-",Rr.OFFSET,":-1"):Er.def(Cr,"?",Cr,".vertCount:-1")});return Ce.optional(function(){hr.DYNAMIC=!0}),hr}return null}return{elements:ct,primitive:yt(),count:dt(),instances:St(Ic,!1),offset:He}}function ho(pe,Ie){var $e=pe.static,$t=pe.dynamic,Vt={};return Mr.forEach(function(ct){var yt=on(ct);function St(He,dt){if(ct in $e){var Me=He($e[ct]);Vt[yt]=Lo(function(){return Me})}else if(ct in $t){var gt=$t[ct];Vt[yt]=pu(gt,function(It,hr){return dt(It,hr,It.invoke(hr,gt))})}}switch(ct){case go:case pi:case ii:case Mc:case Jn:case cu:case bs:case Es:case lu:case Ka:return St(function(He){return Ce.commandType(He,"boolean",ct,Ie.commandStr),He},function(He,dt,Me){return Ce.optional(function(){He.assert(dt,"typeof "+Me+'==="boolean"',"invalid flag "+ct,He.commandStr)}),Me});case Xn:return St(function(He){return Ce.commandParameter(He,Fc,"invalid "+ct,Ie.commandStr),Fc[He]},function(He,dt,Me){var gt=He.constants.compareFuncs;return Ce.optional(function(){He.assert(dt,Me+" in "+gt,"invalid "+ct+", must be one of "+Object.keys(Fc))}),dt.def(gt,"[",Me,"]")});case Mo:return St(function(He){return Ce.command(Za(He)&&He.length===2&&typeof He[0]=="number"&&typeof He[1]=="number"&&He[0]<=He[1],"depth range is 2d array",Ie.commandStr),He},function(He,dt,Me){Ce.optional(function(){He.assert(dt,He.shared.isArrayLike+"("+Me+")&&"+Me+".length===2&&typeof "+Me+'[0]==="number"&&typeof '+Me+'[1]==="number"&&'+Me+"[0]<="+Me+"[1]","depth range must be a 2d array")});var gt=dt.def("+",Me,"[0]"),It=dt.def("+",Me,"[1]");return[gt,It]});case fi:return St(function(He){Ce.commandType(He,"object","blend.func",Ie.commandStr);var dt="srcRGB"in He?He.srcRGB:He.src,Me="srcAlpha"in He?He.srcAlpha:He.src,gt="dstRGB"in He?He.dstRGB:He.dst,It="dstAlpha"in He?He.dstAlpha:He.dst;return Ce.commandParameter(dt,Xu,yt+".srcRGB",Ie.commandStr),Ce.commandParameter(Me,Xu,yt+".srcAlpha",Ie.commandStr),Ce.commandParameter(gt,Xu,yt+".dstRGB",Ie.commandStr),Ce.commandParameter(It,Xu,yt+".dstAlpha",Ie.commandStr),Ce.command(_p.indexOf(dt+", "+gt)===-1,"unallowed blending combination (srcRGB, dstRGB) = ("+dt+", "+gt+")",Ie.commandStr),[Xu[dt],Xu[gt],Xu[Me],Xu[It]]},function(He,dt,Me){var gt=He.constants.blendFuncs;Ce.optional(function(){He.assert(dt,Me+"&&typeof "+Me+'==="object"',"invalid blend func, must be an object")});function It(Tn,Yn){var ni=dt.def('"',Tn,Yn,'" in ',Me,"?",Me,".",Tn,Yn,":",Me,".",Tn);return Ce.optional(function(){He.assert(dt,ni+" in "+gt,"invalid "+ct+"."+Tn+Yn+", must be one of "+Object.keys(Xu))}),ni}var hr=It("src","RGB"),Rr=It("dst","RGB");Ce.optional(function(){var Tn=He.constants.invalidBlendCombinations;He.assert(dt,Tn+".indexOf("+hr+'+", "+'+Rr+") === -1 ","unallowed blending combination for (srcRGB, dstRGB)")});var Er=dt.def(gt,"[",hr,"]"),Cr=dt.def(gt,"[",It("src","Alpha"),"]"),On=dt.def(gt,"[",Rr,"]"),En=dt.def(gt,"[",It("dst","Alpha"),"]");return[Er,On,Cr,En]});case Qn:return St(function(He){if(typeof He=="string")return Ce.commandParameter(He,ur,"invalid "+ct,Ie.commandStr),[ur[He],ur[He]];if(typeof He=="object")return Ce.commandParameter(He.rgb,ur,ct+".rgb",Ie.commandStr),Ce.commandParameter(He.alpha,ur,ct+".alpha",Ie.commandStr),[ur[He.rgb],ur[He.alpha]];Ce.commandRaise("invalid blend.equation",Ie.commandStr)},function(He,dt,Me){var gt=He.constants.blendEquations,It=dt.def(),hr=dt.def(),Rr=He.cond("typeof ",Me,'==="string"');return Ce.optional(function(){function Er(Cr,On,En){He.assert(Cr,En+" in "+gt,"invalid "+On+", must be one of "+Object.keys(ur))}Er(Rr.then,ct,Me),He.assert(Rr.else,Me+"&&typeof "+Me+'==="object"',"invalid "+ct),Er(Rr.else,ct+".rgb",Me+".rgb"),Er(Rr.else,ct+".alpha",Me+".alpha")}),Rr.then(It,"=",hr,"=",gt,"[",Me,"];"),Rr.else(It,"=",gt,"[",Me,".rgb];",hr,"=",gt,"[",Me,".alpha];"),dt(Rr),[It,hr]});case ri:return St(function(He){return Ce.command(Za(He)&&He.length===4,"blend.color must be a 4d array",Ie.commandStr),mt(4,function(dt){return+He[dt]})},function(He,dt,Me){return Ce.optional(function(){He.assert(dt,He.shared.isArrayLike+"("+Me+")&&"+Me+".length===4","blend.color must be a 4d array")}),mt(4,function(gt){return dt.def("+",Me,"[",gt,"]")})});case Hu:return St(function(He){return Ce.commandType(He,"number",yt,Ie.commandStr),He|0},function(He,dt,Me){return Ce.optional(function(){He.assert(dt,"typeof "+Me+'==="number"',"invalid stencil.mask")}),dt.def(Me,"|0")});case Tu:return St(function(He){Ce.commandType(He,"object",yt,Ie.commandStr);var dt=He.cmp||"keep",Me=He.ref||0,gt="mask"in He?He.mask:-1;return Ce.commandParameter(dt,Fc,ct+".cmp",Ie.commandStr),Ce.commandType(Me,"number",ct+".ref",Ie.commandStr),Ce.commandType(gt,"number",ct+".mask",Ie.commandStr),[Fc[dt],Me,gt]},function(He,dt,Me){var gt=He.constants.compareFuncs;Ce.optional(function(){function Er(){He.assert(dt,Array.prototype.join.call(arguments,""),"invalid stencil.func")}Er(Me+"&&typeof ",Me,'==="object"'),Er('!("cmp" in ',Me,")||(",Me,".cmp in ",gt,")")});var It=dt.def('"cmp" in ',Me,"?",gt,"[",Me,".cmp]",":",Gu),hr=dt.def(Me,".ref|0"),Rr=dt.def('"mask" in ',Me,"?",Me,".mask|0:-1");return[It,hr,Rr]});case nc:case hl:return St(function(He){Ce.commandType(He,"object",yt,Ie.commandStr);var dt=He.fail||"keep",Me=He.zfail||"keep",gt=He.zpass||"keep";return Ce.commandParameter(dt,Hs,ct+".fail",Ie.commandStr),Ce.commandParameter(Me,Hs,ct+".zfail",Ie.commandStr),Ce.commandParameter(gt,Hs,ct+".zpass",Ie.commandStr),[ct===hl?js:oc,Hs[dt],Hs[Me],Hs[gt]]},function(He,dt,Me){var gt=He.constants.stencilOps;Ce.optional(function(){He.assert(dt,Me+"&&typeof "+Me+'==="object"',"invalid "+ct)});function It(hr){return Ce.optional(function(){He.assert(dt,'!("'+hr+'" in '+Me+")||("+Me+"."+hr+" in "+gt+")","invalid "+ct+"."+hr+", must be one of "+Object.keys(Hs))}),dt.def('"',hr,'" in ',Me,"?",gt,"[",Me,".",hr,"]:",Gu)}return[ct===hl?js:oc,It("fail"),It("zfail"),It("zpass")]});case fl:return St(function(He){Ce.commandType(He,"object",yt,Ie.commandStr);var dt=He.factor|0,Me=He.units|0;return Ce.commandType(dt,"number",yt+".factor",Ie.commandStr),Ce.commandType(Me,"number",yt+".units",Ie.commandStr),[dt,Me]},function(He,dt,Me){Ce.optional(function(){He.assert(dt,Me+"&&typeof "+Me+'==="object"',"invalid "+ct)});var gt=dt.def(Me,".factor|0"),It=dt.def(Me,".units|0");return[gt,It]});case Ha:return St(function(He){var dt=0;return He==="front"?dt=oc:He==="back"&&(dt=js),Ce.command(!!dt,yt,Ie.commandStr),dt},function(He,dt,Me){return Ce.optional(function(){He.assert(dt,Me+'==="front"||'+Me+'==="back"',"invalid cull.face")}),dt.def(Me,'==="front"?',oc,":",js)});case xs:return St(function(He){return Ce.command(typeof He=="number"&&He>=Kt.lineWidthDims[0]&&He<=Kt.lineWidthDims[1],"invalid line width, must be a positive number between "+Kt.lineWidthDims[0]+" and "+Kt.lineWidthDims[1],Ie.commandStr),He},function(He,dt,Me){return Ce.optional(function(){He.assert(dt,"typeof "+Me+'==="number"&&'+Me+">="+Kt.lineWidthDims[0]+"&&"+Me+"<="+Kt.lineWidthDims[1],"invalid line width")}),Me});case Qa:return St(function(He){return Ce.commandParameter(He,sc,yt,Ie.commandStr),sc[He]},function(He,dt,Me){return Ce.optional(function(){He.assert(dt,Me+'==="cw"||'+Me+'==="ccw"',"invalid frontFace, must be one of cw,ccw")}),dt.def(Me+'==="cw"?'+mp+":"+Gp)});case Io:return St(function(He){return Ce.command(Za(He)&&He.length===4,"color.mask must be length 4 array",Ie.commandStr),He.map(function(dt){return!!dt})},function(He,dt,Me){return Ce.optional(function(){He.assert(dt,He.shared.isArrayLike+"("+Me+")&&"+Me+".length===4","invalid color.mask")}),mt(4,function(gt){return"!!"+Me+"["+gt+"]"})});case Zs:return St(function(He){Ce.command(typeof He=="object"&&He,yt,Ie.commandStr);var dt="value"in He?He.value:1,Me=!!He.invert;return Ce.command(typeof dt=="number"&&dt>=0&&dt<=1,"sample.coverage.value must be a number between 0 and 1",Ie.commandStr),[dt,Me]},function(He,dt,Me){Ce.optional(function(){He.assert(dt,Me+"&&typeof "+Me+'==="object"',"invalid sample.coverage")});var gt=dt.def('"value" in ',Me,"?+",Me,".value:1"),It=dt.def("!!",Me,".invert");return[gt,It]})}}),Vt}function po(pe,Ie){var $e=pe.static,$t=pe.dynamic,Vt={};return Object.keys($e).forEach(function(ct){var yt=$e[ct],St;if(typeof yt=="number"||typeof yt=="boolean")St=Lo(function(){return yt});else if(typeof yt=="function"){var He=yt._reglType;He==="texture2d"||He==="textureCube"?St=Lo(function(dt){return dt.link(yt)}):He==="framebuffer"||He==="framebufferCube"?(Ce.command(yt.color.length>0,'missing color attachment for framebuffer sent to uniform "'+ct+'"',Ie.commandStr),St=Lo(function(dt){return dt.link(yt.color[0])})):Ce.commandRaise('invalid data for uniform "'+ct+'"',Ie.commandStr)}else Za(yt)?St=Lo(function(dt){var Me=dt.global.def("[",mt(yt.length,function(gt){return Ce.command(typeof yt[gt]=="number"||typeof yt[gt]=="boolean","invalid uniform "+ct,dt.commandStr),yt[gt]}),"]");return Me}):Ce.commandRaise('invalid or missing data for uniform "'+ct+'"',Ie.commandStr);St.value=yt,Vt[ct]=St}),Object.keys($t).forEach(function(ct){var yt=$t[ct];Vt[ct]=pu(yt,function(St,He){return St.invoke(He,yt)})}),Vt}function Ii(pe,Ie){var $e=pe.static,$t=pe.dynamic,Vt={};return Object.keys($e).forEach(function(ct){var yt=$e[ct],St=we.id(ct),He=new Bt;if(kh(yt))He.state=Fr,He.buffer=vr.getBuffer(vr.create(yt,dl,!1,!0)),He.type=0;else{var dt=vr.getBuffer(yt);if(dt)He.state=Fr,He.buffer=dt,He.type=0;else if(Ce.command(typeof yt=="object"&&yt,"invalid data for attribute "+ct,Ie.commandStr),"constant"in yt){var Me=yt.constant;He.buffer="null",He.state=hn,typeof Me=="number"?He.x=Me:(Ce.command(Za(Me)&&Me.length>0&&Me.length<=4,"invalid constant for attribute "+ct,Ie.commandStr),br.forEach(function(On,En){En<Me.length&&(He[On]=Me[En])}))}else{kh(yt.buffer)?dt=vr.getBuffer(vr.create(yt.buffer,dl,!1,!0)):dt=vr.getBuffer(yt.buffer),Ce.command(!!dt,'missing buffer for attribute "'+ct+'"',Ie.commandStr);var gt=yt.offset|0;Ce.command(gt>=0,'invalid offset for attribute "'+ct+'"',Ie.commandStr);var It=yt.stride|0;Ce.command(It>=0&&It<256,'invalid stride for attribute "'+ct+'", must be integer betweeen [0, 255]',Ie.commandStr);var hr=yt.size|0;Ce.command(!("size"in yt)||hr>0&&hr<=4,'invalid size for attribute "'+ct+'", must be 1,2,3,4',Ie.commandStr);var Rr=!!yt.normalized,Er=0;"type"in yt&&(Ce.commandParameter(yt.type,Yo,"invalid type for attribute "+ct,Ie.commandStr),Er=Yo[yt.type]);var Cr=yt.divisor|0;"divisor"in yt&&(Ce.command(Cr===0||Ur,'cannot specify divisor for attribute "'+ct+'", instancing not supported',Ie.commandStr),Ce.command(Cr>=0,'invalid divisor for attribute "'+ct+'"',Ie.commandStr)),Ce.optional(function(){var On=Ie.commandStr,En=["buffer","offset","divisor","normalized","type","size","stride"];Object.keys(yt).forEach(function(Tn){Ce.command(En.indexOf(Tn)>=0,'unknown parameter "'+Tn+'" for attribute pointer "'+ct+'" (valid parameters are '+En+")",On)})}),He.buffer=dt,He.state=Fr,He.size=hr,He.normalized=Rr,He.type=Er||dt.dtype,He.offset=gt,He.stride=It,He.divisor=Cr}}Vt[ct]=Lo(function(On,En){var Tn=On.attribCache;if(St in Tn)return Tn[St];var Yn={isStream:!1};return Object.keys(He).forEach(function(ni){Yn[ni]=He[ni]}),He.buffer&&(Yn.buffer=On.link(He.buffer),Yn.type=Yn.type||Yn.buffer+".dtype"),Tn[St]=Yn,Yn})}),Object.keys($t).forEach(function(ct){var yt=$t[ct];function St(He,dt){var Me=He.invoke(dt,yt),gt=He.shared,It=He.constants,hr=gt.isBufferArgs,Rr=gt.buffer;Ce.optional(function(){He.assert(dt,Me+"&&(typeof "+Me+'==="object"||typeof '+Me+'==="function")&&('+hr+"("+Me+")||"+Rr+".getBuffer("+Me+")||"+Rr+".getBuffer("+Me+".buffer)||"+hr+"("+Me+'.buffer)||("constant" in '+Me+"&&(typeof "+Me+'.constant==="number"||'+gt.isArrayLike+"("+Me+".constant))))",'invalid dynamic attribute "'+ct+'"')});var Er={isStream:dt.def(!1)},Cr=new Bt;Cr.state=Fr,Object.keys(Cr).forEach(function(Yn){Er[Yn]=dt.def(""+Cr[Yn])});var On=Er.buffer,En=Er.type;dt("if(",hr,"(",Me,")){",Er.isStream,"=true;",On,"=",Rr,".createStream(",dl,",",Me,");",En,"=",On,".dtype;","}else{",On,"=",Rr,".getBuffer(",Me,");","if(",On,"){",En,"=",On,".dtype;",'}else if("constant" in ',Me,"){",Er.state,"=",hn,";","if(typeof "+Me+'.constant === "number"){',Er[br[0]],"=",Me,".constant;",br.slice(1).map(function(Yn){return Er[Yn]}).join("="),"=0;","}else{",br.map(function(Yn,ni){return Er[Yn]+"="+Me+".constant.length>"+ni+"?"+Me+".constant["+ni+"]:0;"}).join(""),"}}else{","if(",hr,"(",Me,".buffer)){",On,"=",Rr,".createStream(",dl,",",Me,".buffer);","}else{",On,"=",Rr,".getBuffer(",Me,".buffer);","}",En,'="type" in ',Me,"?",It.glTypes,"[",Me,".type]:",On,".dtype;",Er.normalized,"=!!",Me,".normalized;");function Tn(Yn){dt(Er[Yn],"=",Me,".",Yn,"|0;")}return Tn("size"),Tn("offset"),Tn("stride"),Tn("divisor"),dt("}}"),dt.exit("if(",Er.isStream,"){",Rr,".destroyStream(",On,");","}"),Er}Vt[ct]=pu(yt,St)}),Vt}function _o(pe,Ie){var $e=pe.static,$t=pe.dynamic;if(Wu in $e){var Vt=$e[Wu];return Vt!==null&&Yr.getVAO(Vt)===null&&(Vt=Yr.createVAO(Vt)),Lo(function(yt){return yt.link(Yr.getVAO(Vt))})}else if(Wu in $t){var ct=$t[Wu];return pu(ct,function(yt,St){var He=yt.invoke(St,ct);return St.def(yt.shared.vao+".getVAO("+He+")")})}return null}function xa(pe){var Ie=pe.static,$e=pe.dynamic,$t={};return Object.keys(Ie).forEach(function(Vt){var ct=Ie[Vt];$t[Vt]=Lo(function(yt,St){return typeof ct=="number"||typeof ct=="boolean"?""+ct:yt.link(ct)})}),Object.keys($e).forEach(function(Vt){var ct=$e[Vt];$t[Vt]=pu(ct,function(yt,St){return yt.invoke(St,ct)})}),$t}function yo(pe,Ie,$e,$t,Vt){var ct=pe.static,yt=pe.dynamic;Ce.optional(function(){var Tn=[Is,fu,wu,Bi,Ko,hu,oo,Ic,ao,Wu].concat(Mr);function Yn(ni){Object.keys(ni).forEach(function(aa){Ce.command(Tn.indexOf(aa)>=0,'unknown parameter "'+aa+'"',Vt.commandStr)})}Yn(ct),Yn(yt)});var St=si(pe,Ie),He=Je(pe,Vt),dt=_i(pe,He,Vt),Me=Yi(pe,Vt),gt=ho(pe,Vt),It=Kn(pe,Vt,St);function hr(Tn){var Yn=dt[Tn];Yn&&(gt[Tn]=Yn)}hr(Po),hr(on(pl));var Rr=Object.keys(gt).length>0,Er={framebuffer:He,draw:Me,shader:It,state:gt,dirty:Rr,scopeVAO:null,drawVAO:null,useVAO:!1,attributes:{}};if(Er.profile=Ti(pe,Vt),Er.uniforms=po($e,Vt),Er.drawVAO=Er.scopeVAO=_o(pe,Vt),!Er.drawVAO&&It.program&&!St&&Ye.angle_instanced_arrays){var Cr=!0,On=It.program.attributes.map(function(Tn){var Yn=Ie.static[Tn];return Cr=Cr&&!!Yn,Yn});if(Cr&&On.length>0){var En=Yr.getVAO(Yr.createVAO(On));Er.drawVAO=new us(null,null,null,function(Tn,Yn){return Tn.link(En)}),Er.useVAO=!0}}return St?Er.useVAO=!0:Er.attributes=Ii(Ie,Vt),Er.context=xa($t,Vt),Er}function xo(pe,Ie,$e){var $t=pe.shared,Vt=$t.context,ct=pe.scope();Object.keys($e).forEach(function(yt){Ie.save(Vt,"."+yt);var St=$e[yt];ct(Vt,".",yt,"=",St.append(pe,Ie),";")}),Ie(ct)}function Wa(pe,Ie,$e,$t){var Vt=pe.shared,ct=Vt.gl,yt=Vt.framebuffer,St;un&&(St=Ie.def(Vt.extensions,".webgl_draw_buffers"));var He=pe.constants,dt=He.drawBuffer,Me=He.backBuffer,gt;$e?gt=$e.append(pe,Ie):gt=Ie.def(yt,".next"),$t||Ie("if(",gt,"!==",yt,".cur){"),Ie("if(",gt,"){",ct,".bindFramebuffer(",Bc,",",gt,".framebuffer);"),un&&Ie(St,".drawBuffersWEBGL(",dt,"[",gt,".colorAttachments.length]);"),Ie("}else{",ct,".bindFramebuffer(",Bc,",null);"),un&&Ie(St,".drawBuffersWEBGL(",Me,");"),Ie("}",yt,".cur=",gt,";"),$t||Ie("}")}function Bo(pe,Ie,$e){var $t=pe.shared,Vt=$t.gl,ct=pe.current,yt=pe.next,St=$t.current,He=$t.next,dt=pe.cond(St,".dirty");Mr.forEach(function(Me){var gt=on(Me);if(!(gt in $e.state)){var It,hr;if(gt in yt){It=yt[gt],hr=ct[gt];var Rr=mt(Tr[gt].length,function(Cr){return dt.def(It,"[",Cr,"]")});dt(pe.cond(Rr.map(function(Cr,On){return Cr+"!=="+hr+"["+On+"]"}).join("||")).then(Vt,".",Ar[gt],"(",Rr,");",Rr.map(function(Cr,On){return hr+"["+On+"]="+Cr}).join(";"),";"))}else{It=dt.def(He,".",gt);var Er=pe.cond(It,"!==",St,".",gt);dt(Er),gt in ln?Er(pe.cond(It).then(Vt,".enable(",ln[gt],");").else(Vt,".disable(",ln[gt],");"),St,".",gt,"=",It,";"):Er(Vt,".",Ar[gt],"(",It,");",St,".",gt,"=",It,";")}}}),Object.keys($e.state).length===0&&dt(St,".dirty=false;"),Ie(dt)}function As(pe,Ie,$e,$t){var Vt=pe.shared,ct=pe.current,yt=Vt.current,St=Vt.gl;Yf(Object.keys($e)).forEach(function(He){var dt=$e[He];if(!($t&&!$t(dt))){var Me=dt.append(pe,Ie);if(ln[He]){var gt=ln[He];Ss(dt)?Me?Ie(St,".enable(",gt,");"):Ie(St,".disable(",gt,");"):Ie(pe.cond(Me).then(St,".enable(",gt,");").else(St,".disable(",gt,");")),Ie(yt,".",He,"=",Me,";")}else if(Za(Me)){var It=ct[He];Ie(St,".",Ar[He],"(",Me,");",Me.map(function(hr,Rr){return It+"["+Rr+"]="+hr}).join(";"),";")}else Ie(St,".",Ar[He],"(",Me,");",yt,".",He,"=",Me,";")}})}function bo(pe,Ie){Ur&&(pe.instancing=Ie.def(pe.shared.extensions,".angle_instanced_arrays"))}function gi(pe,Ie,$e,$t,Vt){var ct=pe.shared,yt=pe.stats,St=ct.current,He=ct.timer,dt=$e.profile;function Me(){return typeof performance=="undefined"?"Date.now()":"performance.now()"}var gt,It;function hr(Tn){gt=Ie.def(),Tn(gt,"=",Me(),";"),typeof Vt=="string"?Tn(yt,".count+=",Vt,";"):Tn(yt,".count++;"),Or&&($t?(It=Ie.def(),Tn(It,"=",He,".getNumPendingQueries();")):Tn(He,".beginQuery(",yt,");"))}function Rr(Tn){Tn(yt,".cpuTime+=",Me(),"-",gt,";"),Or&&($t?Tn(He,".pushScopeStats(",It,",",He,".getNumPendingQueries(),",yt,");"):Tn(He,".endQuery();"))}function Er(Tn){var Yn=Ie.def(St,".profile");Ie(St,".profile=",Tn,";"),Ie.exit(St,".profile=",Yn,";")}var Cr;if(dt){if(Ss(dt)){dt.enable?(hr(Ie),Rr(Ie.exit),Er("true")):Er("false");return}Cr=dt.append(pe,Ie),Er(Cr)}else Cr=Ie.def(St,".profile");var On=pe.block();hr(On),Ie("if(",Cr,"){",On,"}");var En=pe.block();Rr(En),Ie.exit("if(",Cr,"){",En,"}")}function ls(pe,Ie,$e,$t,Vt){var ct=pe.shared;function yt(He){switch(He){case jp:case Hp:case vl:return 2;case Dl:case Ja:case lf:return 3;case vp:case Wf:case kc:return 4;default:return 1}}function St(He,dt,Me){var gt=ct.gl,It=Ie.def(He,".location"),hr=Ie.def(ct.attributes,"[",It,"]"),Rr=Me.state,Er=Me.buffer,Cr=[Me.x,Me.y,Me.z,Me.w],On=["buffer","normalized","offset","stride"];function En(){Ie("if(!",hr,".buffer){",gt,".enableVertexAttribArray(",It,");}");var Yn=Me.type,ni;if(Me.size?ni=Ie.def(Me.size,"||",dt):ni=dt,Ie("if(",hr,".type!==",Yn,"||",hr,".size!==",ni,"||",On.map(function(Fo){return hr+"."+Fo+"!=="+Me[Fo]}).join("||"),"){",gt,".bindBuffer(",dl,",",Er,".buffer);",gt,".vertexAttribPointer(",[It,ni,Yn,Me.normalized,Me.stride,Me.offset],");",hr,".type=",Yn,";",hr,".size=",ni,";",On.map(function(Fo){return hr+"."+Fo+"="+Me[Fo]+";"}).join(""),"}"),Ur){var aa=Me.divisor;Ie("if(",hr,".divisor!==",aa,"){",pe.instancing,".vertexAttribDivisorANGLE(",[It,aa],");",hr,".divisor=",aa,";}")}}function Tn(){Ie("if(",hr,".buffer){",gt,".disableVertexAttribArray(",It,");",hr,".buffer=null;","}if(",br.map(function(Yn,ni){return hr+"."+Yn+"!=="+Cr[ni]}).join("||"),"){",gt,".vertexAttrib4f(",It,",",Cr,");",br.map(function(Yn,ni){return hr+"."+Yn+"="+Cr[ni]+";"}).join(""),"}")}Rr===Fr?En():Rr===hn?Tn():(Ie("if(",Rr,"===",Fr,"){"),En(),Ie("}else{"),Tn(),Ie("}"))}$t.forEach(function(He){var dt=He.name,Me=$e.attributes[dt],gt;if(Me){if(!Vt(Me))return;gt=Me.append(pe,Ie)}else{if(!Vt(Yp))return;var It=pe.scopeAttrib(dt);Ce.optional(function(){pe.assert(Ie,It+".state","missing attribute "+dt)}),gt={},Object.keys(new Bt).forEach(function(hr){gt[hr]=Ie.def(It,".",hr)})}St(pe.link(He),yt(He.info.type),gt)})}function ia(pe,Ie,$e,$t,Vt){for(var ct=pe.shared,yt=ct.gl,St,He=0;He<$t.length;++He){var dt=$t[He],Me=dt.name,gt=dt.info.type,It=$e.uniforms[Me],hr=pe.link(dt),Rr=hr+".location",Er;if(It){if(!Vt(It))continue;if(Ss(It)){var Cr=It.value;if(Ce.command(Cr!==null&&typeof Cr!="undefined",'missing uniform "'+Me+'"',pe.commandStr),gt===Lc||gt===ac){Ce.command(typeof Cr=="function"&&(gt===Lc&&(Cr._reglType==="texture2d"||Cr._reglType==="framebuffer")||gt===ac&&(Cr._reglType==="textureCube"||Cr._reglType==="framebufferCube")),"invalid texture for uniform "+Me,pe.commandStr);var On=pe.link(Cr._texture||Cr.color[0]._texture);Ie(yt,".uniform1i(",Rr,",",On+".bind());"),Ie.exit(On,".unbind();")}else if(gt===Xf||gt===$f||gt===Dc){Ce.optional(function(){Ce.command(Za(Cr),"invalid matrix for uniform "+Me,pe.commandStr),Ce.command(gt===Xf&&Cr.length===4||gt===$f&&Cr.length===9||gt===Dc&&Cr.length===16,"invalid length for matrix uniform "+Me,pe.commandStr)});var En=pe.global.def("new Float32Array(["+Array.prototype.slice.call(Cr)+"])"),Tn=2;gt===$f?Tn=3:gt===Dc&&(Tn=4),Ie(yt,".uniformMatrix",Tn,"fv(",Rr,",false,",En,");")}else{switch(gt){case Fd:Ce.commandType(Cr,"number","uniform "+Me,pe.commandStr),St="1f";break;case jp:Ce.command(Za(Cr)&&Cr.length===2,"uniform "+Me,pe.commandStr),St="2f";break;case Dl:Ce.command(Za(Cr)&&Cr.length===3,"uniform "+Me,pe.commandStr),St="3f";break;case vp:Ce.command(Za(Cr)&&Cr.length===4,"uniform "+Me,pe.commandStr),St="4f";break;case Gf:Ce.commandType(Cr,"boolean","uniform "+Me,pe.commandStr),St="1i";break;case Oc:Ce.commandType(Cr,"number","uniform "+Me,pe.commandStr),St="1i";break;case vl:Ce.command(Za(Cr)&&Cr.length===2,"uniform "+Me,pe.commandStr),St="2i";break;case Hp:Ce.command(Za(Cr)&&Cr.length===2,"uniform "+Me,pe.commandStr),St="2i";break;case lf:Ce.command(Za(Cr)&&Cr.length===3,"uniform "+Me,pe.commandStr),St="3i";break;case Ja:Ce.command(Za(Cr)&&Cr.length===3,"uniform "+Me,pe.commandStr),St="3i";break;case kc:Ce.command(Za(Cr)&&Cr.length===4,"uniform "+Me,pe.commandStr),St="4i";break;case Wf:Ce.command(Za(Cr)&&Cr.length===4,"uniform "+Me,pe.commandStr),St="4i";break}Ie(yt,".uniform",St,"(",Rr,",",Za(Cr)?Array.prototype.slice.call(Cr):Cr,");")}continue}else Er=It.append(pe,Ie)}else{if(!Vt(Yp))continue;Er=Ie.def(ct.uniforms,"[",we.id(Me),"]")}gt===Lc?Ie("if(",Er,"&&",Er,'._reglType==="framebuffer"){',Er,"=",Er,".color[0];","}"):gt===ac&&Ie("if(",Er,"&&",Er,'._reglType==="framebufferCube"){',Er,"=",Er,".color[0];","}"),Ce.optional(function(){function $u(Ll,td){pe.assert(Ie,Ll,'bad data or missing for uniform "'+Me+'".  '+td)}function bp(Ll){$u("typeof "+Er+'==="'+Ll+'"',"invalid type, expected "+Ll)}function Yu(Ll,td){$u(ct.isArrayLike+"("+Er+")&&"+Er+".length==="+Ll,"invalid vector, should have length "+Ll,pe.commandStr)}function ed(Ll){$u("typeof "+Er+'==="function"&&'+Er+'._reglType==="texture'+(Ll===Hf?"2d":"Cube")+'"',"invalid texture type",pe.commandStr)}switch(gt){case Oc:bp("number");break;case Hp:Yu(2,"number");break;case Ja:Yu(3,"number");break;case Wf:Yu(4,"number");break;case Fd:bp("number");break;case jp:Yu(2,"number");break;case Dl:Yu(3,"number");break;case vp:Yu(4,"number");break;case Gf:bp("boolean");break;case vl:Yu(2,"boolean");break;case lf:Yu(3,"boolean");break;case kc:Yu(4,"boolean");break;case Xf:Yu(4,"number");break;case $f:Yu(9,"number");break;case Dc:Yu(16,"number");break;case Lc:ed(Hf);break;case ac:ed(dp);break}});var Yn=1;switch(gt){case Lc:case ac:var ni=Ie.def(Er,"._texture");Ie(yt,".uniform1i(",Rr,",",ni,".bind());"),Ie.exit(ni,".unbind();");continue;case Oc:case Gf:St="1i";break;case Hp:case vl:St="2i",Yn=2;break;case Ja:case lf:St="3i",Yn=3;break;case Wf:case kc:St="4i",Yn=4;break;case Fd:St="1f";break;case jp:St="2f",Yn=2;break;case Dl:St="3f",Yn=3;break;case vp:St="4f",Yn=4;break;case Xf:St="Matrix2fv";break;case $f:St="Matrix3fv";break;case Dc:St="Matrix4fv";break}if(Ie(yt,".uniform",St,"(",Rr,","),St.charAt(0)==="M"){var aa=Math.pow(gt-Xf+2,2),Fo=pe.global.def("new Float32Array(",aa,")");Ie("false,(Array.isArray(",Er,")||",Er," instanceof Float32Array)?",Er,":(",mt(aa,function($u){return Fo+"["+$u+"]="+Er+"["+$u+"]"}),",",Fo,")")}else Yn>1?Ie(mt(Yn,function($u){return Er+"["+$u+"]"})):Ie(Er);Ie(");")}}function $n(pe,Ie,$e,$t){var Vt=pe.shared,ct=Vt.gl,yt=Vt.draw,St=$t.draw;function He(){var ni=St.elements,aa,Fo=Ie;return ni?((ni.contextDep&&$t.contextDynamic||ni.propDep)&&(Fo=$e),aa=ni.append(pe,Fo)):aa=Fo.def(yt,".",Bi),aa&&Fo("if("+aa+")"+ct+".bindBuffer("+Zp+","+aa+".buffer.buffer);"),aa}function dt(){var ni=St.count,aa,Fo=Ie;return ni?((ni.contextDep&&$t.contextDynamic||ni.propDep)&&(Fo=$e),aa=ni.append(pe,Fo),Ce.optional(function(){ni.MISSING&&pe.assert(Ie,"false","missing vertex count"),ni.DYNAMIC&&pe.assert(Fo,aa+">=0","missing vertex count")})):(aa=Fo.def(yt,".",oo),Ce.optional(function(){pe.assert(Fo,aa+">=0","missing vertex count")})),aa}var Me=He();function gt(ni){var aa=St[ni];return aa?aa.contextDep&&$t.contextDynamic||aa.propDep?aa.append(pe,$e):aa.append(pe,Ie):Ie.def(yt,".",ni)}var It=gt(Ko),hr=gt(hu),Rr=dt();if(typeof Rr=="number"){if(Rr===0)return}else $e("if(",Rr,"){"),$e.exit("}");var Er,Cr;Ur&&(Er=gt(Ic),Cr=pe.instancing);var On=Me+".type",En=St.elements&&Ss(St.elements);function Tn(){function ni(){$e(Cr,".drawElementsInstancedANGLE(",[It,Rr,On,hr+"<<(("+On+"-"+jr+")>>1)",Er],");")}function aa(){$e(Cr,".drawArraysInstancedANGLE(",[It,hr,Rr,Er],");")}Me?En?ni():($e("if(",Me,"){"),ni(),$e("}else{"),aa(),$e("}")):aa()}function Yn(){function ni(){$e(ct+".drawElements("+[It,Rr,On,hr+"<<(("+On+"-"+jr+")>>1)"]+");")}function aa(){$e(ct+".drawArrays("+[It,hr,Rr]+");")}Me?En?ni():($e("if(",Me,"){"),ni(),$e("}else{"),aa(),$e("}")):aa()}Ur&&(typeof Er!="number"||Er>=0)?typeof Er=="string"?($e("if(",Er,">0){"),Tn(),$e("}else if(",Er,"<0){"),Yn(),$e("}")):Tn():Yn()}function Ri(pe,Ie,$e,$t,Vt){var ct=tr(),yt=ct.proc("body",Vt);return Ce.optional(function(){ct.commandStr=Ie.commandStr,ct.command=ct.link(Ie.commandStr)}),Ur&&(ct.instancing=yt.def(ct.shared.extensions,".angle_instanced_arrays")),pe(ct,yt,$e,$t),ct.compile().body}function Gi(pe,Ie,$e,$t){bo(pe,Ie),$e.useVAO?$e.drawVAO?Ie(pe.shared.vao,".setVAO(",$e.drawVAO.append(pe,Ie),");"):Ie(pe.shared.vao,".setVAO(",pe.shared.vao,".targetVAO);"):(Ie(pe.shared.vao,".setVAO(null);"),ls(pe,Ie,$e,$t.attributes,function(){return!0})),ia(pe,Ie,$e,$t.uniforms,function(){return!0}),$n(pe,Ie,Ie,$e)}function Eo(pe,Ie){var $e=pe.proc("draw",1);bo(pe,$e),xo(pe,$e,Ie.context),Wa(pe,$e,Ie.framebuffer),Bo(pe,$e,Ie),As(pe,$e,Ie.state),gi(pe,$e,Ie,!1,!0);var $t=Ie.shader.progVar.append(pe,$e);if($e(pe.shared.gl,".useProgram(",$t,".program);"),Ie.shader.program)Gi(pe,$e,Ie,Ie.shader.program);else{$e(pe.shared.vao,".setVAO(null);");var Vt=pe.global.def("{}"),ct=$e.def($t,".id"),yt=$e.def(Vt,"[",ct,"]");$e(pe.cond(yt).then(yt,".call(this,a0);").else(yt,"=",Vt,"[",ct,"]=",pe.link(function(St){return Ri(Gi,pe,Ie,St,1)}),"(",$t,");",yt,".call(this,a0);"))}Object.keys(Ie.state).length>0&&$e(pe.shared.current,".dirty=true;")}function gl(pe,Ie,$e,$t){pe.batchId="a1",bo(pe,Ie);function Vt(){return!0}ls(pe,Ie,$e,$t.attributes,Vt),ia(pe,Ie,$e,$t.uniforms,Vt),$n(pe,Ie,Ie,$e)}function je(pe,Ie,$e,$t){bo(pe,Ie);var Vt=$e.contextDep,ct=Ie.def(),yt="a0",St="a1",He=Ie.def();pe.shared.props=He,pe.batchId=ct;var dt=pe.scope(),Me=pe.scope();Ie(dt.entry,"for(",ct,"=0;",ct,"<",St,";++",ct,"){",He,"=",yt,"[",ct,"];",Me,"}",dt.exit);function gt(On){return On.contextDep&&Vt||On.propDep}function It(On){return!gt(On)}if($e.needsContext&&xo(pe,Me,$e.context),$e.needsFramebuffer&&Wa(pe,Me,$e.framebuffer),As(pe,Me,$e.state,gt),$e.profile&&gt($e.profile)&&gi(pe,Me,$e,!1,!0),$t)$e.useVAO?$e.drawVAO?gt($e.drawVAO)?Me(pe.shared.vao,".setVAO(",$e.drawVAO.append(pe,Me),");"):dt(pe.shared.vao,".setVAO(",$e.drawVAO.append(pe,dt),");"):dt(pe.shared.vao,".setVAO(",pe.shared.vao,".targetVAO);"):(dt(pe.shared.vao,".setVAO(null);"),ls(pe,dt,$e,$t.attributes,It),ls(pe,Me,$e,$t.attributes,gt)),ia(pe,dt,$e,$t.uniforms,It),ia(pe,Me,$e,$t.uniforms,gt),$n(pe,dt,Me,$e);else{var hr=pe.global.def("{}"),Rr=$e.shader.progVar.append(pe,Me),Er=Me.def(Rr,".id"),Cr=Me.def(hr,"[",Er,"]");Me(pe.shared.gl,".useProgram(",Rr,".program);","if(!",Cr,"){",Cr,"=",hr,"[",Er,"]=",pe.link(function(On){return Ri(gl,pe,$e,On,2)}),"(",Rr,");}",Cr,".call(this,a0[",ct,"],",ct,");")}}function nr(pe,Ie){var $e=pe.proc("batch",2);pe.batchId="0",bo(pe,$e);var $t=!1,Vt=!0;Object.keys(Ie.context).forEach(function(hr){$t=$t||Ie.context[hr].propDep}),$t||(xo(pe,$e,Ie.context),Vt=!1);var ct=Ie.framebuffer,yt=!1;ct?(ct.propDep?$t=yt=!0:ct.contextDep&&$t&&(yt=!0),yt||Wa(pe,$e,ct)):Wa(pe,$e,null),Ie.state.viewport&&Ie.state.viewport.propDep&&($t=!0);function St(hr){return hr.contextDep&&$t||hr.propDep}Bo(pe,$e,Ie),As(pe,$e,Ie.state,function(hr){return!St(hr)}),(!Ie.profile||!St(Ie.profile))&&gi(pe,$e,Ie,!1,"a1"),Ie.contextDep=$t,Ie.needsContext=Vt,Ie.needsFramebuffer=yt;var He=Ie.shader.progVar;if(He.contextDep&&$t||He.propDep)je(pe,$e,Ie,null);else{var dt=He.append(pe,$e);if($e(pe.shared.gl,".useProgram(",dt,".program);"),Ie.shader.program)je(pe,$e,Ie,Ie.shader.program);else{$e(pe.shared.vao,".setVAO(null);");var Me=pe.global.def("{}"),gt=$e.def(dt,".id"),It=$e.def(Me,"[",gt,"]");$e(pe.cond(It).then(It,".call(this,a0,a1);").else(It,"=",Me,"[",gt,"]=",pe.link(function(hr){return Ri(je,pe,Ie,hr,2)}),"(",dt,");",It,".call(this,a0,a1);"))}}Object.keys(Ie.state).length>0&&$e(pe.shared.current,".dirty=true;")}function Gt(pe,Ie){var $e=pe.proc("scope",3);pe.batchId="a2";var $t=pe.shared,Vt=$t.current;xo(pe,$e,Ie.context),Ie.framebuffer&&Ie.framebuffer.append(pe,$e),Yf(Object.keys(Ie.state)).forEach(function(yt){var St=Ie.state[yt],He=St.append(pe,$e);Za(He)?He.forEach(function(dt,Me){$e.set(pe.next[yt],"["+Me+"]",dt)}):$e.set($t.next,"."+yt,He)}),gi(pe,$e,Ie,!0,!0),[Bi,hu,oo,Ic,Ko].forEach(function(yt){var St=Ie.draw[yt];St&&$e.set($t.draw,"."+yt,""+St.append(pe,$e))}),Object.keys(Ie.uniforms).forEach(function(yt){$e.set($t.uniforms,"["+we.id(yt)+"]",Ie.uniforms[yt].append(pe,$e))}),Object.keys(Ie.attributes).forEach(function(yt){var St=Ie.attributes[yt].append(pe,$e),He=pe.scopeAttrib(yt);Object.keys(new Bt).forEach(function(dt){$e.set(He,"."+dt,St[dt])})}),Ie.scopeVAO&&$e.set($t.vao,".targetVAO",Ie.scopeVAO.append(pe,$e));function ct(yt){var St=Ie.shader[yt];St&&$e.set($t.shader,"."+yt,St.append(pe,$e))}ct(fu),ct(wu),Object.keys(Ie.state).length>0&&($e(Vt,".dirty=true;"),$e.exit(Vt,".dirty=true;")),$e("a1(",pe.shared.context,",a0,",pe.batchId,");")}function dn(pe){if(!(typeof pe!="object"||Za(pe))){for(var Ie=Object.keys(pe),$e=0;$e<Ie.length;++$e)if(nn.isDynamic(pe[Ie[$e]]))return!0;return!1}}function yi(pe,Ie,$e){var $t=Ie.static[$e];if(!$t||!dn($t))return;var Vt=pe.global,ct=Object.keys($t),yt=!1,St=!1,He=!1,dt=pe.global.def("{}");ct.forEach(function(gt){var It=$t[gt];if(nn.isDynamic(It)){typeof It=="function"&&(It=$t[gt]=nn.unbox(It));var hr=pu(It,null);yt=yt||hr.thisDep,He=He||hr.propDep,St=St||hr.contextDep}else{switch(Vt(dt,".",gt,"="),typeof It){case"number":Vt(It);break;case"string":Vt('"',It,'"');break;case"object":Array.isArray(It)&&Vt("[",It.join(),"]");break;default:Vt(pe.link(It));break}Vt(";")}});function Me(gt,It){ct.forEach(function(hr){var Rr=$t[hr];if(nn.isDynamic(Rr)){var Er=gt.invoke(It,Rr);It(dt,".",hr,"=",Er,";")}})}Ie.dynamic[$e]=new nn.DynamicVariable(gn,{thisDep:yt,contextDep:St,propDep:He,ref:dt,append:Me}),delete Ie.static[$e]}function ma(pe,Ie,$e,$t,Vt){var ct=tr();ct.stats=ct.link(Vt),Object.keys(Ie.static).forEach(function(St){yi(ct,Ie,St)}),ic.forEach(function(St){yi(ct,pe,St)});var yt=yo(pe,Ie,$e,$t,ct);return Eo(ct,yt),Gt(ct,yt),nr(ct,yt),ct.compile()}return{next:pn,current:Tr,procs:function(){var pe=tr(),Ie=pe.proc("poll"),$e=pe.proc("refresh"),$t=pe.block();Ie($t),$e($t);var Vt=pe.shared,ct=Vt.gl,yt=Vt.next,St=Vt.current;$t(St,".dirty=false;"),Wa(pe,Ie),Wa(pe,$e,null,!0);var He;Ur&&(He=pe.link(Ur)),Ye.oes_vertex_array_object&&$e(pe.link(Ye.oes_vertex_array_object),".bindVertexArrayOES(null);");for(var dt=0;dt<Kt.maxAttributes;++dt){var Me=$e.def(Vt.attributes,"[",dt,"]"),gt=pe.cond(Me,".buffer");gt.then(ct,".enableVertexAttribArray(",dt,");",ct,".bindBuffer(",dl,",",Me,".buffer.buffer);",ct,".vertexAttribPointer(",dt,",",Me,".size,",Me,".type,",Me,".normalized,",Me,".stride,",Me,".offset);").else(ct,".disableVertexAttribArray(",dt,");",ct,".vertexAttrib4f(",dt,",",Me,".x,",Me,".y,",Me,".z,",Me,".w);",Me,".buffer=null;"),$e(gt),Ur&&$e(He,".vertexAttribDivisorANGLE(",dt,",",Me,".divisor);")}return $e(pe.shared.vao,".currentVAO=null;",pe.shared.vao,".setVAO(",pe.shared.vao,".targetVAO);"),Object.keys(ln).forEach(function(It){var hr=ln[It],Rr=$t.def(yt,".",It),Er=pe.block();Er("if(",Rr,"){",ct,".enable(",hr,")}else{",ct,".disable(",hr,")}",St,".",It,"=",Rr,";"),$e(Er),Ie("if(",Rr,"!==",St,".",It,"){",Er,"}")}),Object.keys(Ar).forEach(function(It){var hr=Ar[It],Rr=Tr[It],Er,Cr,On=pe.block();if(On(ct,".",hr,"("),Za(Rr)){var En=Rr.length;Er=pe.global.def(yt,".",It),Cr=pe.global.def(St,".",It),On(mt(En,function(Tn){return Er+"["+Tn+"]"}),");",mt(En,function(Tn){return Cr+"["+Tn+"]="+Er+"["+Tn+"];"}).join("")),Ie("if(",mt(En,function(Tn){return Er+"["+Tn+"]!=="+Cr+"["+Tn+"]"}).join("||"),"){",On,"}")}else Er=$t.def(yt,".",It),Cr=$t.def(St,".",It),On(Er,");",St,".",It,"=",Er,";"),Ie("if(",Er,"!==",Cr,"){",On,"}");$e(On)}),pe.compile()}(),compile:ma}}function qp(){return{vaoCount:0,bufferCount:0,elementsCount:0,framebufferCount:0,shaderCount:0,textureCount:0,cubeCount:0,renderbufferCount:0,maxTextureUnits:0}}var Zd=34918,Vv=34919,Vd=35007,Kp=function(G,we){if(!we.ext_disjoint_timer_query)return null;var Ye=[];function Kt(){return Ye.pop()||we.ext_disjoint_timer_query.createQueryEXT()}function vr(Ur){Ye.push(Ur)}var er=[];function jt(Ur){var un=Kt();we.ext_disjoint_timer_query.beginQueryEXT(Vd,un),er.push(un),Or(er.length-1,er.length,Ur)}function Br(){we.ext_disjoint_timer_query.endQueryEXT(Vd)}function Pr(){this.startQueryIndex=-1,this.endQueryIndex=-1,this.sum=0,this.stats=null}var Yr=[];function Nr(){return Yr.pop()||new Pr}function Hr(Ur){Yr.push(Ur)}var en=[];function Or(Ur,un,Tr){var pn=Nr();pn.startQueryIndex=Ur,pn.endQueryIndex=un,pn.sum=0,pn.stats=Tr,en.push(pn)}var $r=[],Bt=[];function ur(){var Ur,un,Tr=er.length;if(Tr!==0){Bt.length=Math.max(Bt.length,Tr+1),$r.length=Math.max($r.length,Tr+1),$r[0]=0,Bt[0]=0;var pn=0;for(Ur=0,un=0;un<er.length;++un){var Mr=er[un];we.ext_disjoint_timer_query.getQueryObjectEXT(Mr,Vv)?(pn+=we.ext_disjoint_timer_query.getQueryObjectEXT(Mr,Zd),vr(Mr)):er[Ur++]=Mr,$r[un+1]=pn,Bt[un+1]=Ur}for(er.length=Ur,Ur=0,un=0;un<en.length;++un){var ln=en[un],Ar=ln.startQueryIndex,on=ln.endQueryIndex;ln.sum+=$r[on]-$r[Ar];var jn=Bt[Ar],ai=Bt[on];ai===jn?(ln.stats.gpuTime+=ln.sum/1e6,Hr(ln)):(ln.startQueryIndex=jn,ln.endQueryIndex=ai,en[Ur++]=ln)}en.length=Ur}}return{beginQuery:jt,endQuery:Br,pushScopeStats:Or,update:ur,getNumPendingQueries:function(){return er.length},clear:function(){Ye.push.apply(Ye,er);for(var Ur=0;Ur<Ye.length;Ur++)we.ext_disjoint_timer_query.deleteQueryEXT(Ye[Ur]);er.length=0,Ye.length=0},restore:function(){er.length=0,Ye.length=0}}},jd=16384,Ps=256,yp=1024,xp=34962,Qp="webglcontextlost",qf="webglcontextrestored",Jp=1,jv=2,Hv=3;function Hd(G,we){for(var Ye=0;Ye<G.length;++Ye)if(G[Ye]===we)return Ye;return-1}function Wd(G){var we=Mt(G);if(!we)return null;var Ye=we.gl,Kt=Ye.getContextAttributes(),vr=Ye.isContextLost(),er=Lt(Ye,we);if(!er)return null;var jt=ue(),Br=qp(),Pr=er.extensions,Yr=Kp(Ye,Pr),Nr=Ki(),Hr=Ye.drawingBufferWidth,en=Ye.drawingBufferHeight,Or={tick:0,time:0,viewportWidth:Hr,viewportHeight:en,framebufferWidth:Hr,framebufferHeight:en,drawingBufferWidth:Hr,drawingBufferHeight:en,pixelRatio:we.pixelRatio},$r={},Bt={elements:null,primitive:4,count:-1,offset:0,instances:-1},ur=_c(Ye,Pr),Ur=hh(Ye,Br,we,Tr),un=J(Ye,Pr,ur,Br,Ur);function Tr($n){return un.destroyBuffer($n)}var pn=$i(Ye,Pr,Ur,Br),Mr=Ue(Ye,jt,Br,we),ln=Zt(Ye,Pr,ur,function(){jn.procs.poll()},Or,Br,we),Ar=xu(Ye,Pr,ur,Br,we),on=w(Ye,Pr,ur,ln,Ar,Br),jn=cf(Ye,jt,Pr,ur,Ur,pn,ln,on,$r,un,Mr,Bt,Or,Yr,we),ai=Ut(Ye,on,jn.procs.poll,Or,Kt,Pr,ur),rn=jn.next,Dr=Ye.canvas,yr=[],tr=[],Ti=[],Je=[we.onDestroy],_i=null;function si(){if(yr.length===0){Yr&&Yr.update(),_i=null;return}_i=Nn.next(si),As();for(var $n=yr.length-1;$n>=0;--$n){var Ri=yr[$n];Ri&&Ri(Or,null,0)}Ye.flush(),Yr&&Yr.update()}function Kn(){!_i&&yr.length>0&&(_i=Nn.next(si))}function Yi(){_i&&(Nn.cancel(si),_i=null)}function ho($n){$n.preventDefault(),vr=!0,Yi(),tr.forEach(function(Ri){Ri()})}function po($n){Ye.getError(),vr=!1,er.restore(),Mr.restore(),Ur.restore(),ln.restore(),Ar.restore(),on.restore(),un.restore(),Yr&&Yr.restore(),jn.procs.refresh(),Kn(),Ti.forEach(function(Ri){Ri()})}Dr&&(Dr.addEventListener(Qp,ho,!1),Dr.addEventListener(qf,po,!1));function Ii(){yr.length=0,Yi(),Dr&&(Dr.removeEventListener(Qp,ho),Dr.removeEventListener(qf,po)),Mr.clear(),on.clear(),Ar.clear(),ln.clear(),pn.clear(),Ur.clear(),un.clear(),Yr&&Yr.clear(),Je.forEach(function($n){$n()})}function _o($n){Ce(!!$n,"invalid args to regl({...})"),Ce.type($n,"object","invalid args to regl({...})");function Ri(Vt){var ct=U({},Vt);delete ct.uniforms,delete ct.attributes,delete ct.context,delete ct.vao,"stencil"in ct&&ct.stencil.op&&(ct.stencil.opBack=ct.stencil.opFront=ct.stencil.op,delete ct.stencil.op);function yt(St){if(St in ct){var He=ct[St];delete ct[St],Object.keys(He).forEach(function(dt){ct[St+"."+dt]=He[dt]})}}return yt("blend"),yt("depth"),yt("cull"),yt("stencil"),yt("polygonOffset"),yt("scissor"),yt("sample"),"vao"in Vt&&(ct.vao=Vt.vao),ct}function Gi(Vt){var ct={},yt={};return Object.keys(Vt).forEach(function(St){var He=Vt[St];nn.isDynamic(He)?yt[St]=nn.unbox(He,St):ct[St]=He}),{dynamic:yt,static:ct}}var Eo=Gi($n.context||{}),gl=Gi($n.uniforms||{}),je=Gi($n.attributes||{}),nr=Gi(Ri($n)),Gt={gpuTime:0,cpuTime:0,count:0},dn=jn.compile(nr,je,gl,Eo,Gt),yi=dn.draw,ma=dn.batch,pe=dn.scope,Ie=[];function $e(Vt){for(;Ie.length<Vt;)Ie.push(null);return Ie}function $t(Vt,ct){var yt;if(vr&&Ce.raise("context lost"),typeof Vt=="function")return pe.call(this,null,Vt,0);if(typeof ct=="function")if(typeof Vt=="number")for(yt=0;yt<Vt;++yt)pe.call(this,null,ct,yt);else if(Array.isArray(Vt))for(yt=0;yt<Vt.length;++yt)pe.call(this,Vt[yt],ct,yt);else return pe.call(this,Vt,ct,0);else if(typeof Vt=="number"){if(Vt>0)return ma.call(this,$e(Vt|0),Vt|0)}else if(Array.isArray(Vt)){if(Vt.length)return ma.call(this,Vt,Vt.length)}else return yi.call(this,Vt)}return U($t,{stats:Gt})}var xa=on.setFBO=_o({framebuffer:nn.define.call(null,Jp,"framebuffer")});function yo($n,Ri){var Gi=0;jn.procs.poll();var Eo=Ri.color;Eo&&(Ye.clearColor(+Eo[0]||0,+Eo[1]||0,+Eo[2]||0,+Eo[3]||0),Gi|=jd),"depth"in Ri&&(Ye.clearDepth(+Ri.depth),Gi|=Ps),"stencil"in Ri&&(Ye.clearStencil(Ri.stencil|0),Gi|=yp),Ce(!!Gi,"called regl.clear with no buffer specified"),Ye.clear(Gi)}function xo($n){if(Ce(typeof $n=="object"&&$n,"regl.clear() takes an object as input"),"framebuffer"in $n)if($n.framebuffer&&$n.framebuffer_reglType==="framebufferCube")for(var Ri=0;Ri<6;++Ri)xa(U({framebuffer:$n.framebuffer.faces[Ri]},$n),yo);else xa($n,yo);else yo(null,$n)}function Wa($n){Ce.type($n,"function","regl.frame() callback must be a function"),yr.push($n);function Ri(){var Gi=Hd(yr,$n);Ce(Gi>=0,"cannot cancel a frame twice");function Eo(){var gl=Hd(yr,Eo);yr[gl]=yr[yr.length-1],yr.length-=1,yr.length<=0&&Yi()}yr[Gi]=Eo}return Kn(),{cancel:Ri}}function Bo(){var $n=rn.viewport,Ri=rn.scissor_box;$n[0]=$n[1]=Ri[0]=Ri[1]=0,Or.viewportWidth=Or.framebufferWidth=Or.drawingBufferWidth=$n[2]=Ri[2]=Ye.drawingBufferWidth,Or.viewportHeight=Or.framebufferHeight=Or.drawingBufferHeight=$n[3]=Ri[3]=Ye.drawingBufferHeight}function As(){Or.tick+=1,Or.time=gi(),Bo(),jn.procs.poll()}function bo(){Bo(),jn.procs.refresh(),Yr&&Yr.update()}function gi(){return(Ki()-Nr)/1e3}bo();function ls($n,Ri){Ce.type(Ri,"function","listener callback must be a function");var Gi;switch($n){case"frame":return Wa(Ri);case"lost":Gi=tr;break;case"restore":Gi=Ti;break;case"destroy":Gi=Je;break;default:Ce.raise("invalid event, must be one of frame,lost,restore,destroy")}return Gi.push(Ri),{cancel:function(){for(var Eo=0;Eo<Gi.length;++Eo)if(Gi[Eo]===Ri){Gi[Eo]=Gi[Gi.length-1],Gi.pop();return}}}}var ia=U(_o,{clear:xo,prop:nn.define.bind(null,Jp),context:nn.define.bind(null,jv),this:nn.define.bind(null,Hv),draw:_o({}),buffer:function($n){return Ur.create($n,xp,!1,!1)},elements:function($n){return pn.create($n,!1)},texture:ln.create2D,cube:ln.createCube,renderbuffer:Ar.create,framebuffer:on.create,framebufferCube:on.createCube,vao:un.createVAO,attributes:Kt,frame:Wa,on:ls,limits:ur,hasExtension:function($n){return ur.extensions.indexOf($n.toLowerCase())>=0},read:ai,destroy:Ii,_gl:Ye,_refresh:bo,poll:function(){As(),Yr&&Yr.update()},now:gi,stats:Br});return we.onDone(null,ia),ia}return Wd})},48096:function(Qt){(function(re,U){Qt.exports=U()})(this,function(){"use strict";function re(Ot,ht,Ft,Qe,Nt,sr){if(!(Nt-Qe<=Ft)){var ie=Qe+Nt>>1;U(Ot,ht,ie,Qe,Nt,sr%2),re(Ot,ht,Ft,Qe,ie-1,sr+1),re(Ot,ht,Ft,ie+1,Nt,sr+1)}}function U(Ot,ht,Ft,Qe,Nt,sr){for(;Nt>Qe;){if(Nt-Qe>600){var ie=Nt-Qe+1,W=Ft-Qe+1,te=Math.log(ie),Oe=.5*Math.exp(2*te/3),Te=.5*Math.sqrt(te*Oe*(ie-Oe)/ie)*(W-ie/2<0?-1:1),nt=Math.max(Qe,Math.floor(Ft-W*Oe/ie+Te)),De=Math.min(Nt,Math.floor(Ft+(ie-W)*Oe/ie+Te));U(Ot,ht,Ft,nt,De,sr)}var Ze=ht[2*Ft+sr],Ke=Qe,At=Nt;for(ee(Ot,ht,Qe,Ft),ht[2*Nt+sr]>Ze&&ee(Ot,ht,Qe,Nt);Ke<At;){for(ee(Ot,ht,Ke,At),Ke++,At--;ht[2*Ke+sr]<Ze;)Ke++;for(;ht[2*At+sr]>Ze;)At--}ht[2*Qe+sr]===Ze?ee(Ot,ht,Qe,At):(At++,ee(Ot,ht,At,Nt)),At<=Ft&&(Qe=At+1),Ft<=At&&(Nt=At-1)}}function ee(Ot,ht,Ft,Qe){ve(Ot,Ft,Qe),ve(ht,2*Ft,2*Qe),ve(ht,2*Ft+1,2*Qe+1)}function ve(Ot,ht,Ft){var Qe=Ot[ht];Ot[ht]=Ot[Ft],Ot[Ft]=Qe}function _(Ot,ht,Ft,Qe,Nt,sr,ie){for(var W=[0,Ot.length-1,0],te=[],Oe,Te;W.length;){var nt=W.pop(),De=W.pop(),Ze=W.pop();if(De-Ze<=ie){for(var Ke=Ze;Ke<=De;Ke++)Oe=ht[2*Ke],Te=ht[2*Ke+1],Oe>=Ft&&Oe<=Nt&&Te>=Qe&&Te<=sr&&te.push(Ot[Ke]);continue}var At=Math.floor((Ze+De)/2);Oe=ht[2*At],Te=ht[2*At+1],Oe>=Ft&&Oe<=Nt&&Te>=Qe&&Te<=sr&&te.push(Ot[At]);var dr=(nt+1)%2;(nt===0?Ft<=Oe:Qe<=Te)&&(W.push(Ze),W.push(At-1),W.push(dr)),(nt===0?Nt>=Oe:sr>=Te)&&(W.push(At+1),W.push(De),W.push(dr))}return te}function fe(Ot,ht,Ft,Qe,Nt,sr){for(var ie=[0,Ot.length-1,0],W=[],te=Nt*Nt;ie.length;){var Oe=ie.pop(),Te=ie.pop(),nt=ie.pop();if(Te-nt<=sr){for(var De=nt;De<=Te;De++)Z(ht[2*De],ht[2*De+1],Ft,Qe)<=te&&W.push(Ot[De]);continue}var Ze=Math.floor((nt+Te)/2),Ke=ht[2*Ze],At=ht[2*Ze+1];Z(Ke,At,Ft,Qe)<=te&&W.push(Ot[Ze]);var dr=(Oe+1)%2;(Oe===0?Ft-Nt<=Ke:Qe-Nt<=At)&&(ie.push(nt),ie.push(Ze-1),ie.push(dr)),(Oe===0?Ft+Nt>=Ke:Qe+Nt>=At)&&(ie.push(Ze+1),ie.push(Te),ie.push(dr))}return W}function Z(Ot,ht,Ft,Qe){var Nt=Ot-Ft,sr=ht-Qe;return Nt*Nt+sr*sr}var he=function(Ot){return Ot[0]},ce=function(Ot){return Ot[1]},Ge=function(ht,Ft,Qe,Nt,sr){Ft===void 0&&(Ft=he),Qe===void 0&&(Qe=ce),Nt===void 0&&(Nt=64),sr===void 0&&(sr=Float64Array),this.nodeSize=Nt,this.points=ht;for(var ie=ht.length<65536?Uint16Array:Uint32Array,W=this.ids=new ie(ht.length),te=this.coords=new sr(ht.length*2),Oe=0;Oe<ht.length;Oe++)W[Oe]=Oe,te[2*Oe]=Ft(ht[Oe]),te[2*Oe+1]=Qe(ht[Oe]);re(W,te,Nt,0,W.length-1,0)};Ge.prototype.range=function(ht,Ft,Qe,Nt){return _(this.ids,this.coords,ht,Ft,Qe,Nt,this.nodeSize)},Ge.prototype.within=function(ht,Ft,Qe){return fe(this.ids,this.coords,ht,Ft,Qe,this.nodeSize)};var oe={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:function(Ot){return Ot}},We=Math.fround||function(Ot){return function(ht){return Ot[0]=+ht,Ot[0]}}(new Float32Array(1)),qe=function(ht){this.options=wr(Object.create(oe),ht),this.trees=new Array(this.options.maxZoom+1)};qe.prototype.load=function(ht){var Ft=this.options,Qe=Ft.log,Nt=Ft.minZoom,sr=Ft.maxZoom,ie=Ft.nodeSize;Qe&&console.time("total time");var W="prepare "+ht.length+" points";Qe&&console.time(W),this.points=ht;for(var te=[],Oe=0;Oe<ht.length;Oe++)ht[Oe].geometry&&te.push(vt(ht[Oe],Oe));this.trees[sr+1]=new Ge(te,pr,lr,ie,Float32Array),Qe&&console.timeEnd(W);for(var Te=sr;Te>=Nt;Te--){var nt=+Date.now();te=this._cluster(te,Te),this.trees[Te]=new Ge(te,pr,lr,ie,Float32Array),Qe&&console.log("z%d: %d clusters in %dms",Te,te.length,+Date.now()-nt)}return Qe&&console.timeEnd("total time"),this},qe.prototype.getClusters=function(ht,Ft){var Qe=((ht[0]+180)%360+360)%360-180,Nt=Math.max(-90,Math.min(90,ht[1])),sr=ht[2]===180?180:((ht[2]+180)%360+360)%360-180,ie=Math.max(-90,Math.min(90,ht[3]));if(ht[2]-ht[0]>=360)Qe=-180,sr=180;else if(Qe>sr){var W=this.getClusters([Qe,Nt,180,ie],Ft),te=this.getClusters([-180,Nt,sr,ie],Ft);return W.concat(te)}for(var Oe=this.trees[this._limitZoom(Ft)],Te=Oe.range(Dt(Qe),wt(ie),Dt(sr),wt(Nt)),nt=[],De=0,Ze=Te;De<Ze.length;De+=1){var Ke=Ze[De],At=Oe.points[Ke];nt.push(At.numPoints?bt(At):this.points[At.index])}return nt},qe.prototype.getChildren=function(ht){var Ft=this._getOriginId(ht),Qe=this._getOriginZoom(ht),Nt="No cluster with the specified id.",sr=this.trees[Qe];if(!sr)throw new Error(Nt);var ie=sr.points[Ft];if(!ie)throw new Error(Nt);for(var W=this.options.radius/(this.options.extent*Math.pow(2,Qe-1)),te=sr.within(ie.x,ie.y,W),Oe=[],Te=0,nt=te;Te<nt.length;Te+=1){var De=nt[Te],Ze=sr.points[De];Ze.parentId===ht&&Oe.push(Ze.numPoints?bt(Ze):this.points[Ze.index])}if(Oe.length===0)throw new Error(Nt);return Oe},qe.prototype.getLeaves=function(ht,Ft,Qe){Ft=Ft||10,Qe=Qe||0;var Nt=[];return this._appendLeaves(Nt,ht,Ft,Qe,0),Nt},qe.prototype.getTile=function(ht,Ft,Qe){var Nt=this.trees[this._limitZoom(ht)],sr=Math.pow(2,ht),ie=this.options,W=ie.extent,te=ie.radius,Oe=te/W,Te=(Qe-Oe)/sr,nt=(Qe+1+Oe)/sr,De={features:[]};return this._addTileFeatures(Nt.range((Ft-Oe)/sr,Te,(Ft+1+Oe)/sr,nt),Nt.points,Ft,Qe,sr,De),Ft===0&&this._addTileFeatures(Nt.range(1-Oe/sr,Te,1,nt),Nt.points,sr,Qe,sr,De),Ft===sr-1&&this._addTileFeatures(Nt.range(0,Te,Oe/sr,nt),Nt.points,-1,Qe,sr,De),De.features.length?De:null},qe.prototype.getClusterExpansionZoom=function(ht){for(var Ft=this._getOriginZoom(ht)-1;Ft<=this.options.maxZoom;){var Qe=this.getChildren(ht);if(Ft++,Qe.length!==1)break;ht=Qe[0].properties.cluster_id}return Ft},qe.prototype._appendLeaves=function(ht,Ft,Qe,Nt,sr){for(var ie=this.getChildren(Ft),W=0,te=ie;W<te.length;W+=1){var Oe=te[W],Te=Oe.properties;if(Te&&Te.cluster?sr+Te.point_count<=Nt?sr+=Te.point_count:sr=this._appendLeaves(ht,Te.cluster_id,Qe,Nt,sr):sr<Nt?sr++:ht.push(Oe),ht.length===Qe)break}return sr},qe.prototype._addTileFeatures=function(ht,Ft,Qe,Nt,sr,ie){for(var W=0,te=ht;W<te.length;W+=1){var Oe=te[W],Te=Ft[Oe],nt=Te.numPoints,De=void 0,Ze=void 0,Ke=void 0;if(nt)De=Et(Te),Ze=Te.x,Ke=Te.y;else{var At=this.points[Te.index];De=At.properties,Ze=Dt(At.geometry.coordinates[0]),Ke=wt(At.geometry.coordinates[1])}var dr={type:1,geometry:[[Math.round(this.options.extent*(Ze*sr-Qe)),Math.round(this.options.extent*(Ke*sr-Nt))]],tags:De},Pt=void 0;nt?Pt=Te.id:this.options.generateId?Pt=Te.index:this.points[Te.index].id&&(Pt=this.points[Te.index].id),Pt!==void 0&&(dr.id=Pt),ie.features.push(dr)}},qe.prototype._limitZoom=function(ht){return Math.max(this.options.minZoom,Math.min(Math.floor(+ht),this.options.maxZoom+1))},qe.prototype._cluster=function(ht,Ft){for(var Qe=[],Nt=this.options,sr=Nt.radius,ie=Nt.extent,W=Nt.reduce,te=Nt.minPoints,Oe=sr/(ie*Math.pow(2,Ft)),Te=0;Te<ht.length;Te++){var nt=ht[Te];if(!(nt.zoom<=Ft)){nt.zoom=Ft;for(var De=this.trees[Ft+1],Ze=De.within(nt.x,nt.y,Oe),Ke=nt.numPoints||1,At=Ke,dr=0,Pt=Ze;dr<Pt.length;dr+=1){var fn=Pt[dr],cn=De.points[fn];cn.zoom>Ft&&(At+=cn.numPoints||1)}if(At>Ke&&At>=te){for(var Lr=nt.x*Ke,Fn=nt.y*Ke,Sn=W&&Ke>1?this._map(nt,!0):null,Jr=(Te<<5)+(Ft+1)+this.points.length,bi=0,Gn=Ze;bi<Gn.length;bi+=1){var zi=Gn[bi],bn=De.points[zi];if(!(bn.zoom<=Ft)){bn.zoom=Ft;var Pn=bn.numPoints||1;Lr+=bn.x*Pn,Fn+=bn.y*Pn,bn.parentId=Jr,W&&(Sn||(Sn=this._map(nt,!0)),W(Sn,this._map(bn)))}}nt.parentId=Jr,Qe.push(pt(Lr/At,Fn/At,Jr,At,Sn))}else if(Qe.push(nt),At>1)for(var Aa=0,Zi=Ze;Aa<Zi.length;Aa+=1){var Ma=Zi[Aa],To=De.points[Ma];To.zoom<=Ft||(To.zoom=Ft,Qe.push(To))}}}return Qe},qe.prototype._getOriginId=function(ht){return ht-this.points.length>>5},qe.prototype._getOriginZoom=function(ht){return(ht-this.points.length)%32},qe.prototype._map=function(ht,Ft){if(ht.numPoints)return Ft?wr({},ht.properties):ht.properties;var Qe=this.points[ht.index].properties,Nt=this.options.map(Qe);return Ft&&Nt===Qe?wr({},Nt):Nt};function pt(Ot,ht,Ft,Qe,Nt){return{x:We(Ot),y:We(ht),zoom:1/0,id:Ft,parentId:-1,numPoints:Qe,properties:Nt}}function vt(Ot,ht){var Ft=Ot.geometry.coordinates,Qe=Ft[0],Nt=Ft[1];return{x:We(Dt(Qe)),y:We(wt(Nt)),zoom:1/0,index:ht,parentId:-1}}function bt(Ot){return{type:"Feature",id:Ot.id,properties:Et(Ot),geometry:{type:"Point",coordinates:[at(Ot.x),Tt(Ot.y)]}}}function Et(Ot){var ht=Ot.numPoints,Ft=ht>=1e4?Math.round(ht/1e3)+"k":ht>=1e3?Math.round(ht/100)/10+"k":ht;return wr(wr({},Ot.properties),{cluster:!0,cluster_id:Ot.id,point_count:ht,point_count_abbreviated:Ft})}function Dt(Ot){return Ot/360+.5}function wt(Ot){var ht=Math.sin(Ot*Math.PI/180),Ft=.5-.25*Math.log((1+ht)/(1-ht))/Math.PI;return Ft<0?0:Ft>1?1:Ft}function at(Ot){return(Ot-.5)*360}function Tt(Ot){var ht=(180-Ot*360)*Math.PI/180;return 360*Math.atan(Math.exp(ht))/Math.PI-90}function wr(Ot,ht){for(var Ft in ht)Ot[Ft]=ht[Ft];return Ot}function pr(Ot){return Ot.x}function lr(Ot){return Ot.y}return qe})},39918:function(Qt,re,U){var ee=U(91157).default;function ve(){"use strict";Qt.exports=ve=function(){return fe},Qt.exports.__esModule=!0,Qt.exports.default=Qt.exports;var _,fe={},Z=Object.prototype,he=Z.hasOwnProperty,ce=Object.defineProperty||function(De,Ze,Ke){De[Ze]=Ke.value},Ge=typeof Symbol=="function"?Symbol:{},oe=Ge.iterator||"@@iterator",We=Ge.asyncIterator||"@@asyncIterator",qe=Ge.toStringTag||"@@toStringTag";function pt(De,Ze,Ke){return Object.defineProperty(De,Ze,{value:Ke,enumerable:!0,configurable:!0,writable:!0}),De[Ze]}try{pt({},"")}catch(De){pt=function(Ke,At,dr){return Ke[At]=dr}}function vt(De,Ze,Ke,At){var dr=Ze&&Ze.prototype instanceof wr?Ze:wr,Pt=Object.create(dr.prototype),fn=new Te(At||[]);return ce(Pt,"_invoke",{value:ie(De,Ke,fn)}),Pt}function bt(De,Ze,Ke){try{return{type:"normal",arg:De.call(Ze,Ke)}}catch(At){return{type:"throw",arg:At}}}fe.wrap=vt;var Et="suspendedStart",Dt="suspendedYield",wt="executing",at="completed",Tt={};function wr(){}function pr(){}function lr(){}var Ot={};pt(Ot,oe,function(){return this});var ht=Object.getPrototypeOf,Ft=ht&&ht(ht(nt([])));Ft&&Ft!==Z&&he.call(Ft,oe)&&(Ot=Ft);var Qe=lr.prototype=wr.prototype=Object.create(Ot);function Nt(De){["next","throw","return"].forEach(function(Ze){pt(De,Ze,function(Ke){return this._invoke(Ze,Ke)})})}function sr(De,Ze){function Ke(dr,Pt,fn,cn){var Lr=bt(De[dr],De,Pt);if(Lr.type!=="throw"){var Fn=Lr.arg,Sn=Fn.value;return Sn&&ee(Sn)=="object"&&he.call(Sn,"__await")?Ze.resolve(Sn.__await).then(function(Jr){Ke("next",Jr,fn,cn)},function(Jr){Ke("throw",Jr,fn,cn)}):Ze.resolve(Sn).then(function(Jr){Fn.value=Jr,fn(Fn)},function(Jr){return Ke("throw",Jr,fn,cn)})}cn(Lr.arg)}var At;ce(this,"_invoke",{value:function(Pt,fn){function cn(){return new Ze(function(Lr,Fn){Ke(Pt,fn,Lr,Fn)})}return At=At?At.then(cn,cn):cn()}})}function ie(De,Ze,Ke){var At=Et;return function(dr,Pt){if(At===wt)throw new Error("Generator is already running");if(At===at){if(dr==="throw")throw Pt;return{value:_,done:!0}}for(Ke.method=dr,Ke.arg=Pt;;){var fn=Ke.delegate;if(fn){var cn=W(fn,Ke);if(cn){if(cn===Tt)continue;return cn}}if(Ke.method==="next")Ke.sent=Ke._sent=Ke.arg;else if(Ke.method==="throw"){if(At===Et)throw At=at,Ke.arg;Ke.dispatchException(Ke.arg)}else Ke.method==="return"&&Ke.abrupt("return",Ke.arg);At=wt;var Lr=bt(De,Ze,Ke);if(Lr.type==="normal"){if(At=Ke.done?at:Dt,Lr.arg===Tt)continue;return{value:Lr.arg,done:Ke.done}}Lr.type==="throw"&&(At=at,Ke.method="throw",Ke.arg=Lr.arg)}}}function W(De,Ze){var Ke=Ze.method,At=De.iterator[Ke];if(At===_)return Ze.delegate=null,Ke==="throw"&&De.iterator.return&&(Ze.method="return",Ze.arg=_,W(De,Ze),Ze.method==="throw")||Ke!=="return"&&(Ze.method="throw",Ze.arg=new TypeError("The iterator does not provide a '"+Ke+"' method")),Tt;var dr=bt(At,De.iterator,Ze.arg);if(dr.type==="throw")return Ze.method="throw",Ze.arg=dr.arg,Ze.delegate=null,Tt;var Pt=dr.arg;return Pt?Pt.done?(Ze[De.resultName]=Pt.value,Ze.next=De.nextLoc,Ze.method!=="return"&&(Ze.method="next",Ze.arg=_),Ze.delegate=null,Tt):Pt:(Ze.method="throw",Ze.arg=new TypeError("iterator result is not an object"),Ze.delegate=null,Tt)}function te(De){var Ze={tryLoc:De[0]};1 in De&&(Ze.catchLoc=De[1]),2 in De&&(Ze.finallyLoc=De[2],Ze.afterLoc=De[3]),this.tryEntries.push(Ze)}function Oe(De){var Ze=De.completion||{};Ze.type="normal",delete Ze.arg,De.completion=Ze}function Te(De){this.tryEntries=[{tryLoc:"root"}],De.forEach(te,this),this.reset(!0)}function nt(De){if(De||De===""){var Ze=De[oe];if(Ze)return Ze.call(De);if(typeof De.next=="function")return De;if(!isNaN(De.length)){var Ke=-1,At=function dr(){for(;++Ke<De.length;)if(he.call(De,Ke))return dr.value=De[Ke],dr.done=!1,dr;return dr.value=_,dr.done=!0,dr};return At.next=At}}throw new TypeError(ee(De)+" is not iterable")}return pr.prototype=lr,ce(Qe,"constructor",{value:lr,configurable:!0}),ce(lr,"constructor",{value:pr,configurable:!0}),pr.displayName=pt(lr,qe,"GeneratorFunction"),fe.isGeneratorFunction=function(De){var Ze=typeof De=="function"&&De.constructor;return!!Ze&&(Ze===pr||(Ze.displayName||Ze.name)==="GeneratorFunction")},fe.mark=function(De){return Object.setPrototypeOf?Object.setPrototypeOf(De,lr):(De.__proto__=lr,pt(De,qe,"GeneratorFunction")),De.prototype=Object.create(Qe),De},fe.awrap=function(De){return{__await:De}},Nt(sr.prototype),pt(sr.prototype,We,function(){return this}),fe.AsyncIterator=sr,fe.async=function(De,Ze,Ke,At,dr){dr===void 0&&(dr=Promise);var Pt=new sr(vt(De,Ze,Ke,At),dr);return fe.isGeneratorFunction(Ze)?Pt:Pt.next().then(function(fn){return fn.done?fn.value:Pt.next()})},Nt(Qe),pt(Qe,qe,"Generator"),pt(Qe,oe,function(){return this}),pt(Qe,"toString",function(){return"[object Generator]"}),fe.keys=function(De){var Ze=Object(De),Ke=[];for(var At in Ze)Ke.push(At);return Ke.reverse(),function dr(){for(;Ke.length;){var Pt=Ke.pop();if(Pt in Ze)return dr.value=Pt,dr.done=!1,dr}return dr.done=!0,dr}},fe.values=nt,Te.prototype={constructor:Te,reset:function(Ze){if(this.prev=0,this.next=0,this.sent=this._sent=_,this.done=!1,this.delegate=null,this.method="next",this.arg=_,this.tryEntries.forEach(Oe),!Ze)for(var Ke in this)Ke.charAt(0)==="t"&&he.call(this,Ke)&&!isNaN(+Ke.slice(1))&&(this[Ke]=_)},stop:function(){this.done=!0;var Ze=this.tryEntries[0].completion;if(Ze.type==="throw")throw Ze.arg;return this.rval},dispatchException:function(Ze){if(this.done)throw Ze;var Ke=this;function At(Fn,Sn){return fn.type="throw",fn.arg=Ze,Ke.next=Fn,Sn&&(Ke.method="next",Ke.arg=_),!!Sn}for(var dr=this.tryEntries.length-1;dr>=0;--dr){var Pt=this.tryEntries[dr],fn=Pt.completion;if(Pt.tryLoc==="root")return At("end");if(Pt.tryLoc<=this.prev){var cn=he.call(Pt,"catchLoc"),Lr=he.call(Pt,"finallyLoc");if(cn&&Lr){if(this.prev<Pt.catchLoc)return At(Pt.catchLoc,!0);if(this.prev<Pt.finallyLoc)return At(Pt.finallyLoc)}else if(cn){if(this.prev<Pt.catchLoc)return At(Pt.catchLoc,!0)}else{if(!Lr)throw new Error("try statement without catch or finally");if(this.prev<Pt.finallyLoc)return At(Pt.finallyLoc)}}}},abrupt:function(Ze,Ke){for(var At=this.tryEntries.length-1;At>=0;--At){var dr=this.tryEntries[At];if(dr.tryLoc<=this.prev&&he.call(dr,"finallyLoc")&&this.prev<dr.finallyLoc){var Pt=dr;break}}Pt&&(Ze==="break"||Ze==="continue")&&Pt.tryLoc<=Ke&&Ke<=Pt.finallyLoc&&(Pt=null);var fn=Pt?Pt.completion:{};return fn.type=Ze,fn.arg=Ke,Pt?(this.method="next",this.next=Pt.finallyLoc,Tt):this.complete(fn)},complete:function(Ze,Ke){if(Ze.type==="throw")throw Ze.arg;return Ze.type==="break"||Ze.type==="continue"?this.next=Ze.arg:Ze.type==="return"?(this.rval=this.arg=Ze.arg,this.method="return",this.next="end"):Ze.type==="normal"&&Ke&&(this.next=Ke),Tt},finish:function(Ze){for(var Ke=this.tryEntries.length-1;Ke>=0;--Ke){var At=this.tryEntries[Ke];if(At.finallyLoc===Ze)return this.complete(At.completion,At.afterLoc),Oe(At),Tt}},catch:function(Ze){for(var Ke=this.tryEntries.length-1;Ke>=0;--Ke){var At=this.tryEntries[Ke];if(At.tryLoc===Ze){var dr=At.completion;if(dr.type==="throw"){var Pt=dr.arg;Oe(At)}return Pt}}throw new Error("illegal catch attempt")},delegateYield:function(Ze,Ke,At){return this.delegate={iterator:nt(Ze),resultName:Ke,nextLoc:At},this.method==="next"&&(this.arg=_),Tt}},fe}Qt.exports=ve,Qt.exports.__esModule=!0,Qt.exports.default=Qt.exports},91157:function(Qt){function re(U){"@babel/helpers - typeof";return Qt.exports=re=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(ee){return typeof ee}:function(ee){return ee&&typeof Symbol=="function"&&ee.constructor===Symbol&&ee!==Symbol.prototype?"symbol":typeof ee},Qt.exports.__esModule=!0,Qt.exports.default=Qt.exports,re(U)}Qt.exports=re,Qt.exports.__esModule=!0,Qt.exports.default=Qt.exports},22887:function(Qt,re,U){var ee=U(39918)();Qt.exports=ee;try{regeneratorRuntime=ee}catch(ve){typeof globalThis=="object"?globalThis.regeneratorRuntime=ee:Function("r","regeneratorRuntime = r")(ee)}},13351:function(Qt,re,U){var ee;(function(ve){(function(_){var fe=typeof globalThis=="object"?globalThis:typeof U.g=="object"?U.g:typeof self=="object"?self:typeof this=="object"?this:oe(),Z=he(ve);typeof fe.Reflect!="undefined"&&(Z=he(fe.Reflect,Z)),_(Z,fe),typeof fe.Reflect=="undefined"&&(fe.Reflect=ve);function he(We,qe){return function(pt,vt){Object.defineProperty(We,pt,{configurable:!0,writable:!0,value:vt}),qe&&qe(pt,vt)}}function ce(){try{return Function("return this;")()}catch(We){}}function Ge(){try{return(0,eval)("(function() { return this; })()")}catch(We){}}function oe(){return ce()||Ge()}})(function(_,fe){var Z=Object.prototype.hasOwnProperty,he=typeof Symbol=="function",ce=he&&typeof Symbol.toPrimitive!="undefined"?Symbol.toPrimitive:"@@toPrimitive",Ge=he&&typeof Symbol.iterator!="undefined"?Symbol.iterator:"@@iterator",oe=typeof Object.create=="function",We={__proto__:[]}instanceof Array,qe=!oe&&!We,pt={create:oe?function(){return Ki(Object.create(null))}:We?function(){return Ki({__proto__:null})}:function(){return Ki({})},has:qe?function(ue,D){return Z.call(ue,D)}:function(ue,D){return D in ue},get:qe?function(ue,D){return Z.call(ue,D)?ue[D]:void 0}:function(ue,D){return ue[D]}},vt=Object.getPrototypeOf(Function),bt=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:Gr(),Et=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:nn(),Dt=typeof WeakMap=="function"?WeakMap:Nn(),wt=he?Symbol.for("@reflect-metadata:registry"):void 0,at=Rs(),Tt=ts(at);function wr(ue,D,z,se){if(Pt(z)){if(!zi(ue))throw new TypeError;if(!Pn(D))throw new TypeError;return W(ue,D)}else{if(!zi(ue))throw new TypeError;if(!Lr(D))throw new TypeError;if(!Lr(se)&&!Pt(se)&&!fn(se))throw new TypeError;return fn(se)&&(se=void 0),z=Gn(z),te(ue,D,z,se)}}_("decorate",wr);function pr(ue,D){function z(se,be){if(!Lr(se))throw new TypeError;if(!Pt(be)&&!Aa(be))throw new TypeError;Ze(ue,D,se,be)}return z}_("metadata",pr);function lr(ue,D,z,se){if(!Lr(z))throw new TypeError;return Pt(se)||(se=Gn(se)),Ze(ue,D,z,se)}_("defineMetadata",lr);function Ot(ue,D,z){if(!Lr(D))throw new TypeError;return Pt(z)||(z=Gn(z)),Oe(ue,D,z)}_("hasMetadata",Ot);function ht(ue,D,z){if(!Lr(D))throw new TypeError;return Pt(z)||(z=Gn(z)),Te(ue,D,z)}_("hasOwnMetadata",ht);function Ft(ue,D,z){if(!Lr(D))throw new TypeError;return Pt(z)||(z=Gn(z)),nt(ue,D,z)}_("getMetadata",Ft);function Qe(ue,D,z){if(!Lr(D))throw new TypeError;return Pt(z)||(z=Gn(z)),De(ue,D,z)}_("getOwnMetadata",Qe);function Nt(ue,D){if(!Lr(ue))throw new TypeError;return Pt(D)||(D=Gn(D)),Ke(ue,D)}_("getMetadataKeys",Nt);function sr(ue,D){if(!Lr(ue))throw new TypeError;return Pt(D)||(D=Gn(D)),At(ue,D)}_("getOwnMetadataKeys",sr);function ie(ue,D,z){if(!Lr(D))throw new TypeError;if(Pt(z)||(z=Gn(z)),!Lr(D))throw new TypeError;Pt(z)||(z=Gn(z));var se=xr(D,z,!1);return Pt(se)?!1:se.OrdinaryDeleteMetadata(ue,D,z)}_("deleteMetadata",ie);function W(ue,D){for(var z=ue.length-1;z>=0;--z){var se=ue[z],be=se(D);if(!Pt(be)&&!fn(be)){if(!Pn(be))throw new TypeError;D=be}}return D}function te(ue,D,z,se){for(var be=ue.length-1;be>=0;--be){var ke=ue[be],Ht=ke(D,z,se);if(!Pt(Ht)&&!fn(Ht)){if(!Lr(Ht))throw new TypeError;se=Ht}}return se}function Oe(ue,D,z){var se=Te(ue,D,z);if(se)return!0;var be=no(D);return fn(be)?!1:Oe(ue,be,z)}function Te(ue,D,z){var se=xr(D,z,!1);return Pt(se)?!1:Jr(se.OrdinaryHasOwnMetadata(ue,D,z))}function nt(ue,D,z){var se=Te(ue,D,z);if(se)return De(ue,D,z);var be=no(D);if(!fn(be))return nt(ue,be,z)}function De(ue,D,z){var se=xr(D,z,!1);if(!Pt(se))return se.OrdinaryGetOwnMetadata(ue,D,z)}function Ze(ue,D,z,se){var be=xr(z,se,!0);be.OrdinaryDefineOwnMetadata(ue,D,z,se)}function Ke(ue,D){var z=At(ue,D),se=no(ue);if(se===null)return z;var be=Ke(se,D);if(be.length<=0)return z;if(z.length<=0)return be;for(var ke=new Et,Ht=[],Mt=0,Lt=z;Mt<Lt.length;Mt++){var mt=Lt[Mt],N=ke.has(mt);N||(ke.add(mt),Ht.push(mt))}for(var B=0,$=be;B<$.length;B++){var mt=$[B],N=ke.has(mt);N||(ke.add(mt),Ht.push(mt))}return Ht}function At(ue,D){var z=xr(ue,D,!1);return z?z.OrdinaryOwnMetadataKeys(ue,D):[]}function dr(ue){if(ue===null)return 1;switch(typeof ue){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return ue===null?1:6;default:return 6}}function Pt(ue){return ue===void 0}function fn(ue){return ue===null}function cn(ue){return typeof ue=="symbol"}function Lr(ue){return typeof ue=="object"?ue!==null:typeof ue=="function"}function Fn(ue,D){switch(dr(ue)){case 0:return ue;case 1:return ue;case 2:return ue;case 3:return ue;case 4:return ue;case 5:return ue}var z=D===3?"string":D===5?"number":"default",se=Ma(ue,ce);if(se!==void 0){var be=se.call(ue,z);if(Lr(be))throw new TypeError;return be}return Sn(ue,z==="default"?"number":z)}function Sn(ue,D){if(D==="string"){var z=ue.toString;if(bn(z)){var se=z.call(ue);if(!Lr(se))return se}var be=ue.valueOf;if(bn(be)){var se=be.call(ue);if(!Lr(se))return se}}else{var be=ue.valueOf;if(bn(be)){var se=be.call(ue);if(!Lr(se))return se}var ke=ue.toString;if(bn(ke)){var se=ke.call(ue);if(!Lr(se))return se}}throw new TypeError}function Jr(ue){return!!ue}function bi(ue){return""+ue}function Gn(ue){var D=Fn(ue,3);return cn(D)?D:bi(D)}function zi(ue){return Array.isArray?Array.isArray(ue):ue instanceof Object?ue instanceof Array:Object.prototype.toString.call(ue)==="[object Array]"}function bn(ue){return typeof ue=="function"}function Pn(ue){return typeof ue=="function"}function Aa(ue){switch(dr(ue)){case 3:return!0;case 4:return!0;default:return!1}}function Zi(ue,D){return ue===D||ue!==ue&&D!==D}function Ma(ue,D){var z=ue[D];if(z!=null){if(!bn(z))throw new TypeError;return z}}function To(ue){var D=Ma(ue,Ge);if(!bn(D))throw new TypeError;var z=D.call(ue);if(!Lr(z))throw new TypeError;return z}function Ce(ue){return ue.value}function Ia(ue){var D=ue.next();return D.done?!1:D}function Ta(ue){var D=ue.return;D&&D.call(ue)}function no(ue){var D=Object.getPrototypeOf(ue);if(typeof ue!="function"||ue===vt||D!==vt)return D;var z=ue.prototype,se=z&&Object.getPrototypeOf(z);if(se==null||se===Object.prototype)return D;var be=se.constructor;return typeof be!="function"||be===ue?D:be}function qs(){var ue;!Pt(wt)&&typeof fe.Reflect!="undefined"&&!(wt in fe.Reflect)&&typeof fe.Reflect.defineMetadata=="function"&&(ue=Wt(fe.Reflect));var D,z,se,be=new Dt,ke={registerProvider:Ht,getProvider:Lt,setProvider:N};return ke;function Ht(B){if(!Object.isExtensible(ke))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case ue===B:break;case Pt(D):D=B;break;case D===B:break;case Pt(z):z=B;break;case z===B:break;default:se===void 0&&(se=new Et),se.add(B);break}}function Mt(B,$){if(!Pt(D)){if(D.isProviderFor(B,$))return D;if(!Pt(z)){if(z.isProviderFor(B,$))return D;if(!Pt(se))for(var ne=To(se);;){var xe=Ia(ne);if(!xe)return;var Fe=Ce(xe);if(Fe.isProviderFor(B,$))return Ta(ne),Fe}}}if(!Pt(ue)&&ue.isProviderFor(B,$))return ue}function Lt(B,$){var ne=be.get(B),xe;return Pt(ne)||(xe=ne.get($)),Pt(xe)&&(xe=Mt(B,$),Pt(xe)||(Pt(ne)&&(ne=new bt,be.set(B,ne)),ne.set($,xe))),xe}function mt(B){if(Pt(B))throw new TypeError;return D===B||z===B||!Pt(se)&&se.has(B)}function N(B,$,ne){if(!mt(ne))throw new Error("Metadata provider not registered.");var xe=Lt(B,$);if(xe!==ne){if(!Pt(xe))return!1;var Fe=be.get(B);Pt(Fe)&&(Fe=new bt,be.set(B,Fe)),Fe.set($,ne)}return!0}}function Rs(){var ue;return!Pt(wt)&&Lr(fe.Reflect)&&Object.isExtensible(fe.Reflect)&&(ue=fe.Reflect[wt]),Pt(ue)&&(ue=qs()),!Pt(wt)&&Lr(fe.Reflect)&&Object.isExtensible(fe.Reflect)&&Object.defineProperty(fe.Reflect,wt,{enumerable:!1,configurable:!1,writable:!1,value:ue}),ue}function ts(ue){var D=new Dt,z={isProviderFor:function(mt,N){var B=D.get(mt);return Pt(B)?!1:B.has(N)},OrdinaryDefineOwnMetadata:Ht,OrdinaryHasOwnMetadata:be,OrdinaryGetOwnMetadata:ke,OrdinaryOwnMetadataKeys:Mt,OrdinaryDeleteMetadata:Lt};return at.registerProvider(z),z;function se(mt,N,B){var $=D.get(mt),ne=!1;if(Pt($)){if(!B)return;$=new bt,D.set(mt,$),ne=!0}var xe=$.get(N);if(Pt(xe)){if(!B)return;if(xe=new bt,$.set(N,xe),!ue.setProvider(mt,N,z))throw $.delete(N),ne&&D.delete(mt),new Error("Wrong provider for target.")}return xe}function be(mt,N,B){var $=se(N,B,!1);return Pt($)?!1:Jr($.has(mt))}function ke(mt,N,B){var $=se(N,B,!1);if(!Pt($))return $.get(mt)}function Ht(mt,N,B,$){var ne=se(B,$,!0);ne.set(mt,N)}function Mt(mt,N){var B=[],$=se(mt,N,!1);if(Pt($))return B;for(var ne=$.keys(),xe=To(ne),Fe=0;;){var et=Ia(xe);if(!et)return B.length=Fe,B;var j=Ce(et);try{B[Fe]=j}catch(Q){try{Ta(xe)}finally{throw Q}}Fe++}}function Lt(mt,N,B){var $=se(N,B,!1);if(Pt($)||!$.delete(mt))return!1;if($.size===0){var ne=D.get(N);Pt(ne)||(ne.delete(B),ne.size===0&&D.delete(ne))}return!0}}function Wt(ue){var D=ue.defineMetadata,z=ue.hasOwnMetadata,se=ue.getOwnMetadata,be=ue.getOwnMetadataKeys,ke=ue.deleteMetadata,Ht=new Dt,Mt={isProviderFor:function(Lt,mt){var N=Ht.get(Lt);return Pt(N)?be(Lt,mt).length?(Pt(N)&&(N=new Et,Ht.set(Lt,N)),N.add(mt),!0):!1:N.has(mt)},OrdinaryDefineOwnMetadata:D,OrdinaryHasOwnMetadata:z,OrdinaryGetOwnMetadata:se,OrdinaryOwnMetadataKeys:be,OrdinaryDeleteMetadata:ke};return Mt}function xr(ue,D,z){var se=at.getProvider(ue,D);if(!Pt(se))return se;if(z){if(at.setProvider(ue,D,Tt))return Tt;throw new Error("Illegal state.")}}function Gr(){var ue={},D=[],z=function(){function Mt(Lt,mt,N){this._index=0,this._keys=Lt,this._values=mt,this._selector=N}return Mt.prototype["@@iterator"]=function(){return this},Mt.prototype[Ge]=function(){return this},Mt.prototype.next=function(){var Lt=this._index;if(Lt>=0&&Lt<this._keys.length){var mt=this._selector(this._keys[Lt],this._values[Lt]);return Lt+1>=this._keys.length?(this._index=-1,this._keys=D,this._values=D):this._index++,{value:mt,done:!1}}return{value:void 0,done:!0}},Mt.prototype.throw=function(Lt){throw this._index>=0&&(this._index=-1,this._keys=D,this._values=D),Lt},Mt.prototype.return=function(Lt){return this._index>=0&&(this._index=-1,this._keys=D,this._values=D),{value:Lt,done:!0}},Mt}(),se=function(){function Mt(){this._keys=[],this._values=[],this._cacheKey=ue,this._cacheIndex=-2}return Object.defineProperty(Mt.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),Mt.prototype.has=function(Lt){return this._find(Lt,!1)>=0},Mt.prototype.get=function(Lt){var mt=this._find(Lt,!1);return mt>=0?this._values[mt]:void 0},Mt.prototype.set=function(Lt,mt){var N=this._find(Lt,!0);return this._values[N]=mt,this},Mt.prototype.delete=function(Lt){var mt=this._find(Lt,!1);if(mt>=0){for(var N=this._keys.length,B=mt+1;B<N;B++)this._keys[B-1]=this._keys[B],this._values[B-1]=this._values[B];return this._keys.length--,this._values.length--,Zi(Lt,this._cacheKey)&&(this._cacheKey=ue,this._cacheIndex=-2),!0}return!1},Mt.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=ue,this._cacheIndex=-2},Mt.prototype.keys=function(){return new z(this._keys,this._values,be)},Mt.prototype.values=function(){return new z(this._keys,this._values,ke)},Mt.prototype.entries=function(){return new z(this._keys,this._values,Ht)},Mt.prototype["@@iterator"]=function(){return this.entries()},Mt.prototype[Ge]=function(){return this.entries()},Mt.prototype._find=function(Lt,mt){if(!Zi(this._cacheKey,Lt)){this._cacheIndex=-1;for(var N=0;N<this._keys.length;N++)if(Zi(this._keys[N],Lt)){this._cacheIndex=N;break}}return this._cacheIndex<0&&mt&&(this._cacheIndex=this._keys.length,this._keys.push(Lt),this._values.push(void 0)),this._cacheIndex},Mt}();return se;function be(Mt,Lt){return Mt}function ke(Mt,Lt){return Lt}function Ht(Mt,Lt){return[Mt,Lt]}}function nn(){var ue=function(){function D(){this._map=new bt}return Object.defineProperty(D.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),D.prototype.has=function(z){return this._map.has(z)},D.prototype.add=function(z){return this._map.set(z,z),this},D.prototype.delete=function(z){return this._map.delete(z)},D.prototype.clear=function(){this._map.clear()},D.prototype.keys=function(){return this._map.keys()},D.prototype.values=function(){return this._map.keys()},D.prototype.entries=function(){return this._map.entries()},D.prototype["@@iterator"]=function(){return this.keys()},D.prototype[Ge]=function(){return this.keys()},D}();return ue}function Nn(){var ue=16,D=pt.create(),z=se();return function(){function Lt(){this._key=se()}return Lt.prototype.has=function(mt){var N=be(mt,!1);return N!==void 0?pt.has(N,this._key):!1},Lt.prototype.get=function(mt){var N=be(mt,!1);return N!==void 0?pt.get(N,this._key):void 0},Lt.prototype.set=function(mt,N){var B=be(mt,!0);return B[this._key]=N,this},Lt.prototype.delete=function(mt){var N=be(mt,!1);return N!==void 0?delete N[this._key]:!1},Lt.prototype.clear=function(){this._key=se()},Lt}();function se(){var Lt;do Lt="@@WeakMap@@"+Mt();while(pt.has(D,Lt));return D[Lt]=!0,Lt}function be(Lt,mt){if(!Z.call(Lt,z)){if(!mt)return;Object.defineProperty(Lt,z,{value:pt.create()})}return Lt[z]}function ke(Lt,mt){for(var N=0;N<mt;++N)Lt[N]=Math.random()*255|0;return Lt}function Ht(Lt){return typeof Uint8Array=="function"?typeof crypto!="undefined"?crypto.getRandomValues(new Uint8Array(Lt)):typeof msCrypto!="undefined"?msCrypto.getRandomValues(new Uint8Array(Lt)):ke(new Uint8Array(Lt),Lt):ke(new Array(Lt),Lt)}function Mt(){var Lt=Ht(ue);Lt[6]=Lt[6]&79|64,Lt[8]=Lt[8]&191|128;for(var mt="",N=0;N<ue;++N){var B=Lt[N];(N===4||N===6||N===8)&&(mt+="-"),B<16&&(mt+="0"),mt+=B.toString(16).toLowerCase()}return mt}}function Ki(ue){return ue.__=void 0,delete ue.__,ue}})})(ee||(ee={}))}}]);
}());